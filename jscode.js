!function(exports){"use strict";var _Backbone$Model$exten,_BonusWorldView$exten,_$defaults,_$defaults2,_$defaults3,_$defaults4,_$defaults5,_$defaults6,_$defaults7,_$defaults8,_$defaults9,_$defaults10,socialNetwork;function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o,a,n,r,s=[],l=!0,d=!1;try{if(n=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(o=n.call(i)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){d=!0,a=e}finally{try{if(!l&&null!=i.return&&(r=i.return(),Object(r)!==r))return}finally{if(d)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var o=_superPropBase(e,t);if(o){var a=Object.getOwnPropertyDescriptor(o,t);return a.get?a.get.call(arguments.length<3?e:i):a.value}}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return r};var g,r={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,i){e[t]=i.value},t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",i=t.asyncIterator||"@@asyncIterator",o=t.toStringTag||"@@toStringTag";function n(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{n({},"")}catch(g){n=function(e,t,i){return e[t]=i}}function s(e,t,i,o){var n,r,s,l,a=t&&t.prototype instanceof w?t:w,d=Object.create(a.prototype),c=new W(o||[]);return u(d,"_invoke",{value:(n=e,r=i,s=c,l=p,function(e,t){if(l===f)throw new Error("Generator is already running");if(l===C){if("throw"===e)throw t;return{value:g,done:!0}}for(s.method=e,s.arg=t;;){var i=s.delegate;if(i){var o=F(i,s);if(o){if(o===y)continue;return o}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===p)throw l=C,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=f;var a=h(n,r,s);if("normal"===a.type){if(l=s.done?C:m,a.arg===y)continue;return{value:a.arg,done:s.done}}"throw"===a.type&&(l=C,s.method="throw",s.arg=a.arg)}})}),d}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}r.wrap=s;var p="suspendedStart",m="suspendedYield",f="executing",C="completed",y={};function w(){}function l(){}function d(){}var v={};n(v,a,function(){return this});var k=Object.getPrototypeOf,b=k&&k(k(R([])));b&&b!==e&&c.call(b,a)&&(v=b);var P=d.prototype=w.prototype=Object.create(v);function _(e){["next","throw","return"].forEach(function(t){n(e,t,function(e){return this._invoke(t,e)})})}function T(l,d){var t;u(this,"_invoke",{value:function(i,o){function e(){return new d(function(e,t){!function t(e,i,o,a){var n=h(l[e],l,i);if("throw"!==n.type){var r=n.arg,s=r.value;return s&&"object"==_typeof(s)&&c.call(s,"__await")?d.resolve(s.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):d.resolve(s).then(function(e){r.value=e,o(r)},function(e){return t("throw",e,o,a)})}a(n.arg)}(i,o,e,t)})}return t=t?t.then(e,e):e()}})}function F(e,t){var i=t.method,o=e.iterator[i];if(o===g)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=g,F(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,y;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=g),t.delegate=null,y):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function B(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function W(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(B,this),this.reset(!0)}function R(t){if(t||""===t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(c.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=g,e.done=!0,e};return o.next=o}}throw new TypeError(_typeof(t)+" is not iterable")}return u(P,"constructor",{value:l.prototype=d,configurable:!0}),u(d,"constructor",{value:l,configurable:!0}),l.displayName=n(d,o,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,o,"GeneratorFunction")),e.prototype=Object.create(P),e},r.awrap=function(e){return{__await:e}},_(T.prototype),n(T.prototype,i,function(){return this}),r.AsyncIterator=T,r.async=function(e,t,i,o,a){void 0===a&&(a=Promise);var n=new T(s(e,t,i,o),a);return r.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},_(P),n(P,o,"Generator"),n(P,a,function(){return this}),n(P,"toString",function(){return"[object Generator]"}),r.keys=function(e){var i=Object(e),o=[];for(var t in i)o.push(t);return o.reverse(),function e(){for(;o.length;){var t=o.pop();if(t in i)return e.value=t,e.done=!1,e}return e.done=!0,e}},r.values=R,W.prototype={constructor:W,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=g)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var o=this;function e(e,t){return n.type="throw",n.arg=i,o.next=e,t&&(o.method="next",o.arg=g),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],n=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var r=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(r&&s){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(r){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&c.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var n=a?a.completion:{};return n.type=e,n.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),S(i),y}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var a=o.arg;S(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:R(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=g),y}},r}function _wrapNativeSuper(e){var i="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _construct(e,t,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,i){var o=[null];o.push.apply(o,t);var a=new(Function.bind.apply(e,o));return i&&_setPrototypeOf(a,i.prototype),a}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(o){var a=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(o);if(a){var i=_getPrototypeOf(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){s=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var SocialAdapterBase=Backbone.Model.extend({init:function(){return Promise.resolve()},invite:function(e,t,i){this.finalInvite(e,t)},initialize:function(){this.on("openSocialWindow",function(){application.get("view")&&application.get("view").isFullScreen()&&application.get("view").exitFullScreen()})},uploadCanvas:function(e,t,i){e.toBlob?e.toBlob(_.bind(function(e){this.upload(e,t,i)},this)):e.msToBlob&&e.msToBlob(_.bind(function(e){this.upload(e,t,i)},this))},upload:function(e,t,i){alert("not implemented")},isSubscriptionPaymentSupported:function(){return Promise.resolve(!1)},showPaymentSubscription:function(e){return this._subscriptions=null,Promise.reject(!1)},checkSubscription:function(i){var e=this;return Promise.resolve().then(function(){if(!e._subscriptions)return service("../../../gems/site/service/paymentSubscription/updatefinishtime.php",{productId:i,status:3})}).then(function(){return e.getSubscriptionData()}).then(function(e){return!!e.find(function(e){var t=application.getCurrentServerTime()<Date.parse(e.finishDate.replace(/\s/,"T"))/1e3;return e.productId===i&&t})})},getSubscriptionData:function(){var t=this;return this._subscriptions?Promise.resolve(this._subscriptions):service("../../../gems/site/service/paymentSubscription/loaddata.php").then(function(e){return t._subscriptions=e})},createAlbumIfNotExist:function(t,i,o){t?this.checkExistAlbum(t,_.bind(function(e){e?o(t):this.createAlbum(i,o)},this)):this.createAlbum(i,o)},checkExistAlbum:function(e,t){alert("not implemented")},createAlbum:function(e,t){alert("not implemented")},groupsIsMember:function(e,t){},finalInvite:function(e,t){this._showInvite(e,function(e){e&&e.length&&(InviteKeeper.markInvited(e),t&&t(e))})},inviteWithCustomWindow:function(e,t,i){var o=this;e||(e=listFriendsNotInAppIds()),new SelectFriendWindow({massCallback:function(e){o.finalInvite(e)},callback:function(e){o.finalInvite([e])},type:"inviteFriendsByRequest",userIds:_.map(e,function(e){return e.toString()}),urgent:!i})},_showInvite:function(e,t){throw"Not implemented"},sendRequest:function(e){(e=new Object(e)).success=e.success||_.noop,e.cancel=e.cancel||_.noop,e.veryImportant=!!e.veryImportant,Array.isArray(e.userIds)||(e.userIds=[e.userIds])},publication:function(e){var t=(e=e||{}).type,i=e.success||function(){},o=e.image||messages[t+"Image"],a=e.message||RANDOM(messages[t+"Message"]),n=e.caption||messages[t+"Caption"],r=user.get("gender")||0;_.isArray(n)&&(n=n[r]),_.isArray(a)&&(a=a[r]),_doPublication(a,o,n,void 0,i,t)},showPromo:function(){},showPaymentPromo:function(){},makePhotoById:function(e,t){if(users[e]&&!1!==users[e].existphoto){users[e].photo;return 50<t&&users[e].bigPhoto&&users[e].bigPhoto,makeImg(users[e].photo,t)}if(!(e<0))return'<div class="no-photo gender-'+(users[e]&&users[e].gender?"female":"male")+'"></div>';var i=_.findWhere(Bots,{id:e});return i?makeImg(i.photo,t):void 0},addSticker:function(e){},addIntegrationEvent:function(e){return Promise.resolve(!0)},haveAccessToFriends:function(){return!0},takeAccessToFriends:function(){return Promise.resolve(!0)}}),UndefinedSocialAdapter=SocialAdapterBase.extend({invite:function(e,t,i){if(!window.phonegapNetwork)throw"Social adapter is not initialized for current network";switch(window.phonegapNetwork){case"vkontakte":(socialNetwork=new PhoneGapVkontakteSocialAdapter).invite(e,t,i);break;case"odnoklassniki":(socialNetwork=new PhoneGapOdnoklassnikiSocialAdapter).invite(e,t,i);break;case"facebook":(socialNetwork=new PhoneGapFacebookSocialAdapter).invite(e,t,i)}},sendRequest:function(e){if(window.phonegapNetwork)switch(window.phonegapNetwork){case"vkontakte":(socialNetwork=new PhoneGapVkontakteSocialAdapter).sendRequest(e);break;case"odnoklassniki":(socialNetwork=new PhoneGapOdnoklassnikiSocialAdapter).sendRequest(e);break;case"facebook":(socialNetwork=new PhoneGapFacebookSocialAdapter).sendRequest(e)}}});function getProductById(e){for(var t in prices)if(prices[t].product==e)return prices[t]}socialNetwork=new UndefinedSocialAdapter;var users={},allFriendsIds,friendsInAppIds,friendsNotInAppIds,lastProduct=!1,lastPromoProduct=!1,odChildFrame=!1,odChildFrameSuccess,odChildFrameFail;function reloadIfExpired(e){e&&console.log(e,e.msg),!e||102!=e.error_code&&103!=e.error_code||(location.href=gameUrl)}function newOdChildFrame(e,t,i,o){o?odChildFrame={newWindow:window.open(e,"_blank")}:((odChildFrame=document.createElement("iframe")).src=e,odChildFrame.width=odChildFrame.height="100%",odChildFrame.frameBorder="0",odChildFrame.style.position="absolute",odChildFrame.style.top=odChildFrame.style.left="0px",odChildFrame.style["background-color"]="white",odChildFrame.style["z-index"]=100,document.body.appendChild(odChildFrame)),odChildFrameSuccess=t,odChildFrameFail=i}function inOfficialGroup(a){FAPI.Client.call({method:"group.getUserGroupsByIds",group_id:groupId,uids:viewerId},function(e,t,i){reloadIfExpired(i);var o=!1;0<t.length&&"PASSIVE"!=t[0].status&&"UNKNOWN"!=t[0].status&&(o=!0),a(o)})}function listFriendsNotInAppIds(){if(!friendsNotInAppIds){friendsNotInAppIds=[];for(var e=0;e<allFriendsIds.length;e++)users[allFriendsIds[e]]&&!users[allFriendsIds[e]].inapp&&friendsNotInAppIds.push(String(allFriendsIds[e]))}return friendsNotInAppIds}function askRequestMobile(e,t,i,o,a,n){newOdChildFrame("widgetinvite.php?widget_id=WidgetSuggest&comment="+encodeURIComponent(e)+"&uids="+i.join(","),a,n)}var askRequestSocial=(eg=[],fg=0,kg=function e(){if(5e3<=_.now()-fg){var t=eg.shift();hg&&(hg.close(),hg=null),function(e,t,i,o,a,n){if(window.odRequestSuccess=a,window.odRequestCancel=n,void 0===o)o="";else{var r=[];for(var s in o)r.push(s+"_"+o[s]);o="___"+r.join("__")+"___"}if(socialNetwork.trigger("openSocialWindow"),void 0!==i){if("object"==_typeof(i)){if(0===i.length)return;i=i.slice(0,Math.min(20,i.length)).join(";")}FAPI.UI.showNotification(e,o,i)}else FAPI.UI.showNotification(e,o)}.apply(null,t),fg=_.now()}0<eg.length&&(hg||(hg=new WaitWindow),setTimeout(e,5e3-_.now()+fg))},function(e,t,i,o,a,n){eg.push([e,t,i,o,a,n]),kg()}),hg,eg,fg,kg;function askRequest(e,t,i,o,a,n){return window.mobile?askRequestMobile(e,t,i,o,a,n):askRequestSocial(e,t,i,o,a,n)}function odHasPermission(e,o){FAPI.Client.call({method:"users.hasAppPermission",ext_perm:e},function(e,t,i){reloadIfExpired(i),o(t)})}function checkAlbum(e,o){FAPI.Client.call({method:"photos.getAlbumInfo",aid:e},function(e,t,i){reloadIfExpired(i),o(null!==t)})}function mediaTopicPost(e,t,i,o){Log.error("Method is deprecated"),o&&o()}function checkPromo2(e){return!1}function _doPublication(e,t,i,o,a,n,r){var s=messages.odnoklassniki_public_link,l={media:[{type:"text",text:e},{type:"app",text:" ",images:[{url:publicationBaseUrl+t,title:RANDOM(s),mark:"media"}]}]};o&&l.media.push({type:"link",url:o}),window.mobile?newOdChildFrame("mediatopicpost.php?attachment="+encodeURIComponent(JSON.stringify(l)),a):(socialNetwork.trigger("openSocialWindow"),window.odPostMediatopicSuccess=a,window.odPostMediatopicCancel=r,FAPI.UI.postMediatopic(l,!0))}function promo1(e){var t=messages.bonusPublicationMessage;_doPublication(RANDOM(t),messages.bonusPublicationImage,messages.bonusPublicationCaption[0],null,e)}function promo2(e){promo1(e)}function checkPromo1(e){e(!1)}function setStatus(e,t,i){Log.error("Method is deprecated"),t&&t()}function getStatus(o){FAPI.Client.call({method:"users.getInfo",uids:viewerId,fields:"current_status"},function(e,t,i){reloadIfExpired(i),null!=t&&1==t.length&&t[0].current_status||o(""),o(t[0].current_status)})}function odBuyGift(e,t){socialNetwork.trigger("openSocialWindow"),lastPromoProduct={userId:t,giftId:e},FAPI.UI.showPromoPayment(t,e)}function odUploadPhoto(o,a,i){odHasPermission("PHOTO CONTENT",function(e){if(!e)return socialNetwork.trigger("openSocialWindow"),FAPI.UI.showPermissions("['PHOTO CONTENT']"),void(window.lastNoPermissionProcess=function(){odUploadPhoto(o,a,i)});var t={method:"photosV2.getUploadUrl"};void 0!==i&&(t.aid=i),FAPI.Client.call(t,function(e,t,i){reloadIfExpired(i),null!==t&&callService("../../../base/lib/odnoklassniki/uploadimage.php",function(e){},function(){},{uploadUrl:t.upload_url,imageUrl:o,text:a})})})}function createPhotoAlbum(t,o,i){odHasPermission("PHOTO CONTENT",function(e){if(!e)return socialNetwork.trigger("openSocialWindow"),FAPI.UI.showPermissions("['PHOTO CONTENT']"),void(window.lastNoPermissionProcess=function(){createPhotoAlbum(t,o,i)});void 0===i&&(i="public"),FAPI.Client.call({method:"photos.createAlbum",title:t,type:i},function(e,t,i){reloadIfExpired(i),o(t)})})}var odShowBuyNow=!1;function showBuy(e){if(!odShowBuyNow)if(odShowBuyNow=!0,setTimeout(function(){odShowBuyNow=!1},500),!0===window.mobile){params={},params.application_key=window.applicationKey,params.session_key=window.sessionKey,params.name=e.desc.product,params.price=e.price,params.code="mobile_"+e.product;var t=[];for(var i in params)t.push(i);t.sort(function(e,t){return e==t?0:e<t?-1:1});for(var o="",a=0;a<t.length;a++)o+=t[a]+"="+params[t[a]];o+=window.sessionSecretKey,params.sig=hexMD5(o);var n=[];for(var r in params)n.push(encodeURIComponent(r)+"="+encodeURIComponent(params[r]));newOdChildFrame("//m.ok.ru/api/show_payment?"+n.join("&"),function(){callService("../../../levelbase/src/services/getcoins.php",function(e){user.set({coins:new ObscureNumber(e)},{notSave:!0})},fail)},function(){},!0)}else socialNetwork.trigger("openSocialWindow"),lastProduct=e,FAPI.UI.showPayment(e.desc.product,e.desc.product,e.product,e.price,null,"[]","ok","true"),setTimeout(function(){socialNetwork.trigger("try_payment",e)},1e4)}function sendNotification(e,a){"object"!=_typeof(e)&&(e=[e]),100<a.length&&(a=a.substr(0,97)+"...");for(var t=function(o){FAPI.Client.call({method:"notifications.sendSimple",uid:o,text:a},function(e,t,i){reloadIfExpired(i),"505543558913"!=o&&"119119200269"!=o&&"113858779965"!=o||(Log.error(a),Log.error(e),Log.error(t),Log.error(i))})},i=0;i<e.length;i++){var o=e[i];"505543558913"!=o&&"119119200269"!=o&&"113858779965"!=o||(Log.error("sending to "+e[i]),Log.error(a)),t(e[i])}}function generateFieldsString(e){var t="uid";return"first_name"in e&&(t+=",first_name"),"last_name"in e&&(t+=",last_name"),"gender"in e&&(t+=",gender"),"photo"in e&&(t+=",pic_1"),"bigPhoto"in e&&(t+=",pic_3"),"profile"in e&&(t+=",url_profile"),"bthdate"in e&&(t+=",birthday"),"online"in e&&(t+=",online"),"last_online"in e&&(t+=",last_online"),"country"in e&&(t+=",location"),t}function addLoadedUser(e,t){var i=String(e.uid);if(void 0===users[i]&&(users[i]={}),"first_name"in t){var o=e.first_name;if(null===o)return void(users[i]=void 0);o=(o=o.replace("<","")).replace(">",""),users[i].first_name=o}if("last_name"in t){var a=e.last_name;a=(a=a.replace("<","")).replace(">",""),users[i].last_name=a}if("gender"in t&&(users[i].ok_gender=e.gender,users[i].gender="female"==e.gender?1:0),"photo"in t&&(users[i].photo=e.pic_1,users[i].existphoto=!(0<=e.pic_1.indexOf("stub")||!e.pic_1)),"bigPhoto"in t&&(users[i].bigPhoto=e.pic_3||e.pic_1.replace("photoType=4","photoType=5")),"profile"in t&&(users[i].profile=e.url_profile),"bthdate"in t&&(users[i].bthdate=!1,"birthday"in e)){var n=e.birthday.split("-");3==n.length&&(users[i].bthdate=n[0]+"-"+(String(n[1]).length<2?"0"+n[1]:n[1])+"-"+(String(n[2]).length<2?"0"+n[2]:n[2]))}"last_online"in t&&(users[i].last_online=e.last_online?e.last_online.substr(0,e.last_online.indexOf(" ")):"0"),"online"in t&&(users[i].online=0,e.online&&(users[i].online=1)),"country"in t&&(users[i].country=0,e.location&&(users[i].ok_location=_.clone(e.location),"RU"==e.location.countryCode&&(users[i].country=1)))}function loadUsers(a,n,r,s){void 0===s&&(s=0),s<a.length?FAPI.Client.call({method:"users.getInfo",uids:a.slice(s,Math.min(s+100,a.length)).join(","),fields:generateFieldsString(n)},function(e,t,i){reloadIfExpired(i),null==t&&(t=[]),void 0===t.push&&(t=[]);for(var o=0;o<t.length;o++)addLoadedUser(t[o],n);loadUsers(a,n,r,s+100)}):r()}function loadMeAndAllFriends(n,r){try{FAPI.Client.call({method:"friends.get"},function(e,a,t){if(reloadIfExpired(t),allFriendsIds=[],null==a&&(a=[]),void 0!==a.push)for(var i=0;i<a.length;i++)allFriendsIds.push(String(a[i]));else a=[];a.push(viewerId),"inapp"in n?FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,i){reloadIfExpired(i),null==t&&(t={}),void 0!==t.uids&&null!==t.uids||(t.uids=[]),void 0===t.uids.push&&(t.uids=[]),friendsInAppIds=[];for(var o=0;o<t.uids.length;o++)friendsInAppIds.push(String(t.uids[o]));loadUsers(a,n,function(){for(var e=0;e<allFriendsIds.length;e++)void 0!==users[allFriendsIds[e]]&&(users[allFriendsIds[e]].inapp=0);for(var t=0;t<friendsInAppIds.length;t++)void 0!==users[friendsInAppIds[t]]&&(users[friendsInAppIds[t]].inapp=1);void 0===users[viewerId]&&(users[viewerId]={}),users[viewerId].inapp=1,deleteUnloadedUsersFromFriendsInAppIds(),deleteUnloadedUsersFromAllFriendsIds(),r()})}):loadUsers(a,n,function(){deleteUnloadedUsersFromAllFriendsIds(),r()})})}catch(e){console.log("Error in load friends from OD"),console.log(e),users={},allFriendsIds=[],friendsInAppIds=[],friendsNotInAppIds=[],loadUsers([viewerId],n,r)}}function loadMeAndAllFriendsInApp(a,n){FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,i){reloadIfExpired(i),null==t&&(t={}),void 0!==t.uids&&null!==t.uids||(t.uids=[]),void 0===t.uids.push&&(t.uids=[]),friendsInAppIds=[];for(var o=0;o<t.uids.length;o++)friendsInAppIds.push(String(t.uids[o]));t.uids.push(viewerId),loadUsers(t.uids,a,function(){deleteUnloadedUsersFromFriendsInAppIds(),n()})})}window.getMobileWidgets=function(a){FAPI.Client.call({method:"widget.getWidgetContent",wid:"mobile-header-small"},function(e,t,i){if(reloadIfExpired(i),null!==t){var o=decodeURIComponent(escape(function(e){var t,i,o,a,n,r,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,d=0,c=[];if(!e)return e;for(e+="";t=(r=s.indexOf(e.charAt(l++))<<18|s.indexOf(e.charAt(l++))<<12|(a=s.indexOf(e.charAt(l++)))<<6|(n=s.indexOf(e.charAt(l++))))>>16&255,i=r>>8&255,o=255&r,c[d++]=64==a?String.fromCharCode(t):64==n?String.fromCharCode(t,i):String.fromCharCode(t,i,o),l<e.length;);return c.join("")}(t)));a(o)}else a(!1)})},window.API_callback=function(e,t,i){if(socialNetwork.trigger(e,t,i),$("body").css("display","none").css("display","block"),"showInvite"!=e||"ok"!=t)if("showNotification"!=e)if("showPayment"!=e)if("showPromoPayment"!=e||"ok"!=t){if("showPaymentSubscription"!=e||"ok"!=t)return"showConfirmation"==e&&"ok"==t?(lastPublishObject.resig=i,void FAPI.Client.call(lastPublishObject,function(e,t,i){reloadIfExpired(i),"ok"==e&&void 0!==window.odPublicationSuccess&&window.odPublicationSuccess()})):void("showPermissions"!=e||"ok"!=t?"postMediatopic"!=e?"prepareMidroll"!=e?"showMidroll"!=e?("ok"==t&&console.log("wrong arguments"),console.log(e,t,i)):"ok"==t?socialNetwork.trigger("success_showMidroll",i):socialNetwork.trigger("error_showMidroll",i):"ok"==t&&socialNetwork.trigger("success_prepareMidroll",i):"ok"==t?void 0!==window.odPostMediatopicSuccess&&window.odPostMediatopicSuccess():void 0!==window.odPostMediatopicCancel&&window.odPostMediatopicCancel():lastNoPermissionProcess());application.trigger("subscribed")}else!1!==lastPromoProduct&&(socialNetwork.trigger("success_odGiftPayment",lastPromoProduct),lastPromoProduct=!1);else"ok"==t?!1!==lastProduct&&(socialNetwork.trigger("success_payment",lastProduct),lastProduct=!1):socialNetwork.trigger("cancel_payment",lastProduct);else"ok"==t?void 0!==window.odRequestSuccess&&window.odRequestSuccess(i.split(",")):void 0!==window.odRequestCancel&&window.odRequestCancel();else void 0!==window.odInviteSuccess&&window.odInviteSuccess(i.split(","))};var OdnoklassnikiSocialAdapter=SocialAdapterBase.extend({init:function(){return FAPI.initState.wait()},invite:function(e,t,i){window.mobile?i?this.inviteWithCustomWindow(e,t,i):this._showInvite(e,t):this.finalInvite(e,t,i)},upload:function(n,e,r){FAPI.Client.call({method:"photosV2.getUploadUrl",aid:e},function(e,t,i){reloadIfExpired(i);var o=t.upload_url,a=new FormData;a.append("inputdata",n,"pic1"),$.ajax({type:"POST",url:o,data:a,dataType:"json",cache:!1,processData:!1,contentType:!1,success:function(e){var t=e.photos,i=_.first(_.keys(t)),o=t[i].token;FAPI.Client.call({method:"photosV2.commit",photo_id:i,token:o,comment:r.comment},function(e,t,i){reloadIfExpired(i)})}})})},showPaymentSubscription:function(e){var t=prices[e];return this._subscriptions=null,application.get("view").exitFullScreen(),Promise.resolve().then(function(){FAPI.invokeUIMethod("showPaymentSubscription",e,t.price)})},isSubscriptionPaymentSupported:function(){return Promise.resolve(!0)},createAlbumIfNotExist:function(t,i,o){odHasPermission("PHOTO CONTENT",_.bind(function(e){if(!e)return socialNetwork.trigger("openSocialWindow"),FAPI.UI.showPermissions("['PHOTO CONTENT']"),void(window.lastNoPermissionProcess=_.bind(function(){this.createAlbumIfNotExist.call(this,t,i,o)},this));SocialAdapterBase.prototype.createAlbumIfNotExist.call(this,t,i,o)},this))},checkExistAlbum:function(e,o){FAPI.Client.call({method:"photos.getAlbumInfo",aid:e},function(e,t,i){t?o(!0):(reloadIfExpired(i),o(!1))})},createAlbum:function(e,o){FAPI.Client.call({method:"photos.createAlbum",type:"public",title:e.title,description:e.description},function(e,t,i){reloadIfExpired(i),o(t)})},_showInvite:function(e,t){var i=messages.odnoklassniki_invite;"object"!=_typeof(i)&&(i=[i]);var o=RANDOM(i);window.mobile?newOdChildFrame("widgetinvite.php?widget_id=WidgetInvite&comment="+encodeURIComponent(o),t,function(){}):void 0===e?(this.trigger("openSocialWindow"),window.odInviteSuccess=t,FAPI.UI.showInvite(o)):this.sendRequest({message:o,userIds:e,success:t})},sendRequest:function(e){SocialAdapterBase.prototype.sendRequest.call(this,e),askRequest(e.message,void 0,e.userIds,void 0,e.success,e.cancel)},statsQueue:[],statsProcessQueue:[],_statsFlush:function(e){if(e||!this.statsProcessQueue.length&&this.statsQueue.length){for(;this.statsQueue.length&&this.statsProcessQueue.length<64;)this.statsProcessQueue.push(this.statsQueue.shift());var t={method:"sdk.reportStats",stats:JSON.stringify({stats:this.statsProcessQueue,version:"0.0.1",time:Date.now()})};FAPI.Client.call(t,function(e,t,i){"ok"===e?(this.statsProcessQueue.length=0,setTimeout(this._statsFlush.bind(this),1e3)):setTimeout(this._statsFlush.bind(this,!0),3e4)}.bind(this))}},reportStats:function(e,t){this.statsQueue.push({time:Date.now(),type:"status",id:e,data:t}),this._statsFlush()},onStartLevel:function(e){window.mobile||"gems"!==project||this.reportStats("start",[String(e)])},onCompleteLevel:function(e){window.mobile||"gems"!==project||this.reportStats("complete",[String(e)])},showPromo:function(){},showPaymentPromo:function(){window.mobile||FAPI.invokeUIMethod("showPaymentPromo")},addSticker:function(e){FAPI.Client.call({method:"sticker.addToMy",sticker_set_id:e},function(e,t,i){console.log(e,t,i)})},ui:function(e){for(var t=this,i=arguments.length,a=new Array(1<i?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return new Promise(function(i,o){t.once(e,function(e,t){"cancel"!==e&&"cancel"!==t?"error"!==e?i(t):o(t):o("cancel")}),FAPI.UI[e].apply(FAPI.UI,a)})}});socialNetwork=new OdnoklassnikiSocialAdapter,window.addEventListener("message",function(e){!1!==odChildFrame&&(0<e.origin.indexOf("ok.ru")&&"loaded"!=e.data?(odChildFrame.newWindow?odChildFrame.newWindow.close():odChildFrame.remove(),odChildFrame=!1,0<e.data.indexOf("error")?odChildFrameFail&&odChildFrameFail():odChildFrameSuccess&&odChildFrameSuccess()):("od_frame_success"==e.data&&(odChildFrame.newWindow?odChildFrame.newWindow.close():odChildFrame.remove(),odChildFrame=!1,odChildFrameSuccess&&odChildFrameSuccess()),"od_frame_fail"==e.data&&(odChildFrame.newWindow?odChildFrame.newWindow.close():odChildFrame.remove(),odChildFrame=!1,odChildFrameFail&&odChildFrameFail())))});var user=user||null;!function(){var l=["Script error.",'Error: Permission denied to access property "toString"',"NS_ERROR_NOT_AVAILABLE:","Uncaught SecurityError: Failed to read the 'contentDocument' property from 'HTMLIFrameElement': Blocked a frame with origin","Uncaught SecurityError: Blocked a frame with origin"],d=0;function t(t,e,i,o,a){if(t&&_.isString(t)){var n=Boolean(-1!=t.indexOf("Can't load resource:"));if(window.phonegapNetwork&&"candyvalley"==project&&(n=Boolean(1)),n);else{if(!(!Config.errorThrottle||Math.random()<Config.errorThrottle))return;if(d>Date.now()-3e3)return;if(d=Date.now(),_.find(l,function(e){return-1!=t.indexOf(e)}))return}var r=network;window.phonegapNetwork&&(r+=window.phonegapNetwork);var s={message:t,source:e||"",lineno:i||"",columnno:o||"",project:project,stack:a&&a.stack||"",network:r,viewerId:user&&user.get("userId")||"?",isMobile:window.mobile?1:0};$.ajax({url:"../../../base/lib/common/jslogger.php",dataType:"json",type:"POST",data:s,success:function(e){},error:function(){}})}}window.onerror=t,window.manualLogError=function(e){window.Log.error(e),t(e)}}(),window.console||(window.console={}),window.console.log||(window.console.log=function(e){});var RANDOM=function(e){return e[Math.floor(Math.random()*e.length)]};function createSeedRandomizer(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:49734321;return function(){return(268435455&(e=4294967295&(3042594569^(e=(e=4294967295&((e=(e=4294967295&(3345072700^(e=e+2127912214+(e<<12)&4294967295)^e>>>19))+374761393+(e<<5)&4294967295)+3550635116^e<<9))+4251993797+(e<<3)&4294967295)^e>>>16)))/268435456}}var preg_quote=function(e){return e.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};function getRandom(e,t){return Math.random()*(t-e+1)+e}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function callPushApi(e,t){if(Config.pushNotificationsSender){var i=[];for(var o in t)i.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));var a=document.createElement("script");a.src=Config.pushNotificationsSender+e+"?"+i.join("&"),a.async=!0,document.head.appendChild(a)}else console.log("Config.pushNotificationsSender not set!")}function deletePushGCMId(e){e||(e=user.pick("userId","GCMid","deviceType")),callPushApi("deletegcmid.php",{userId:e.userId,project:project,deviceType:e.deviceType})}function addPushTask(e,t,i){i||(i=user.pick("userId","GCMid","deviceType")),callPushApi("addpushtask.php",{userId:i.userId,messageType:e,GCMId:i.GCMId,deviceType:i.deviceType,locale:locale,sendTime:t,project:project})}function deletePushTask(e,t){t||(t=user.pick("userId","GCMid","deviceType")),callPushApi("deletepushtask.php",{userId:t.userId,messageType:e,deviceType:t.deviceType,project:project})}window.Log={write:function(){void 0===window.production&&(window.production=1)},error:function(){window.console.log.apply(window.console,arguments)},server:function(){if(errorReporting){for(var e=[],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):e.push(JSON.stringify(arguments[t]));var i="../service/logger.php?message="+encodeURIComponent(e.join(" "))+"&viewerId="+("undefined"!=typeof viewerId?viewerId:"")+"&ua="+encodeURIComponent(navigator.userAgent)+"&network="+network;"phonegap"==network&&(i=i+"&phonegapNetwork="+phonegapNetwork),(new Image).src=i,this.error.apply(this,arguments)}}};var updateOrientationTimeout=!1;function recentlyBirthday(e){if(void 0===e)return!1;var t=e.bthdate;if(!t)return!1;if(3!=(t=t.split("-")).length)return!1;for(var i=-1;i<=1;i++){var o=new Date((new Date).getFullYear()+i+"-"+t[1]+"-"+t[2]).getTime()-(new Date).getTime();if(-1728e5<o&&o<=0)return!0}return!1}function deleteUnloadedUsersFromFriendsInAppIds(){for(var e=[],t=0;t<friendsInAppIds.length;t++)void 0!==users[friendsInAppIds[t]]&&e.push(friendsInAppIds[t]);friendsInAppIds=e}function deleteUnloadedUsersFromAllFriendsIds(){for(var e=[],t=0;t<allFriendsIds.length;t++)void 0!==users[allFriendsIds[t]]&&e.push(allFriendsIds[t]);allFriendsIds=e}window.orientationChange=function(){window.adShowNow||(canvas.running&&canvas.pause(),$("#popMenuBlock").removeClass("transitionPopMenu"),$("body").css({width:"100%",height:"100%"}),!1!==updateOrientationTimeout&&clearTimeout(updateOrientationTimeout),updateOrientationTimeout=setTimeout(function(){updateOrientation(),canvas.running&&canvas.resume(),updateOrientationTimeout=setTimeout(function(){updateOrientationTimeout=!1,$("#popMenuBlock").addClass("transitionPopMenu")},100)},300))};var localStorageEnabled=void 0;function checkLocalStorage(){if(void 0!==localStorageEnabled)return localStorageEnabled;try{return localStorage.setItem("test","est"),localStorage.removeItem("test"),localStorageEnabled=!0}catch(e){return localStorageEnabled=!1}}function _getLocalStorage(e){var t=project+"_"+network,i=project;return e||(t+="_"+viewerId,i+="_"+viewerId),localStorage[t]&&JSON.parse(localStorage[t])||localStorage[i]&&JSON.parse(localStorage[i])||{}}function _setLocalStorage(e,t){var i=project+"_"+network;t||(i+="_"+viewerId),localStorage[i]=JSON.stringify(e)}function setLocalStorage(e,t,i){if(checkLocalStorage())try{var o=_getLocalStorage(i);o[e]=t,_setLocalStorage(o,i)}catch(e){console.log(e)}}function removeLocalStorage(e,t){if(checkLocalStorage())try{var i=_getLocalStorage(t);delete i[e],_setLocalStorage(i,t)}catch(e){console.log(e)}}function getLocalStorage(e,t,i){if(checkLocalStorage()){var o=_getLocalStorage(i);if(void 0!==o[e])return o[e]}return t}function setCookie(e,t,i){if("undefined"==typeof deviceType||1!=deviceType){var o=[];o.push(e+"="+escape(t)),o.push("path="+window.location.pathname),void 0===i&&(i=new Date((new Date).getTime()+5184e6).toUTCString()),o.push("expires="+i),o=o.join("; "),document.cookie=o}else localStorage["ie11_cookie_"+e]=t}function getCookie(e){if("undefined"!=typeof deviceType&&1==deviceType)return localStorage["ie11_cookie_"+e];var t=document.cookie;t=t.split("; ");for(var i=0;i<t.length;i++){var o=t[i].split("=");if(o[0]==e)return parseInt(o[1])}}function calcAmountDaysAfterDate(e){var t=(new Date).getTime()-new Date(e).getTime();return t<0&&(t=0),Math.floor(t/864e5)}function calcAge(e){if(!e)return 0;var t=e.split("-");if(3!=t.length)return 0;var i=new Date,o=i.getFullYear()-t[0]-1,a=i.getMonth()+1+"",n=i.getDate()+"";return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),(t[1]<a||t[1]==a&&t[2]<=n)&&o++,o}function formatDateForDB(e){return new Date(e.getTime()-1e3*e.getTimezoneOffset()*60).toISOString().slice(0,19).replace("T"," ")}function formatDateFromDB(e){if(!e||"string"!=typeof e)return null;return e.replace(/-/gim,"/")}function formatTime(e,t){var i=t%60;i<10&&(i="0"+i);var o=(t=Math.floor(t/60))%60,a=o;a<10&&(a="0"+a);var n=t=Math.floor(t/60);n<10&&(n="0"+n);var r=t%24,s=r;s<10&&(s="0"+s);var l=Math.floor(t/24),d=l;return d<10&&(d="0"+d),e=(e=(e=(e=(e=(e=(e=(e=e.replace(/%s/g,i)).replace(/%I/g,o)).replace(/%i/g,a)).replace(/%F/g,n)).replace(/%H/g,s)).replace(/%G/g,r)).replace(/%d/g,d)).replace(/%j/g,l)}function formatPeriod(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2]?"timeShortSimple":"timeShort",o=Math.round(e),a=[],n=o%60;0<n&&a.unshift(n+messages[i][0]);var r=(o=Math.floor(o/60))%24;0<r&&a.unshift(r+messages[i][1]);var s=Math.floor(o/24);return 0<s&&a.unshift(s+messages[i][2]),a=a.join(" "),t&&messages.timeShortDuration&&(a+=messages.timeShortDuration),a}function formatDuration(e){return formatTime(86400<e?"%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1]:"%H:%i:%s",e)}function removeSelection(){try{if(document.activeElement&&("TEXTAREA"==document.activeElement.tagName||"INPUT"==document.activeElement.tagName))return}catch(e){}"IE"!==application.system.browser?window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.clear&&document.selection.clear():document.selection&&document.selection.empty()}function needWord(e,t){return"ru"==locale?11<=e%100&&e%100<=14?t[0]:e%10==1?t[1]:2<=e%10&&e%10<=4?t[2]:t[0]:"en"==locale&&1==e?t[1]:t[0]}function plural(e,t){var i;switch(locale){case"ru":i=t%10==1&&t%100!=11?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2;break;case"br":case"en":case"fr":case"de":case"es":case"it":case"nl":case"tr":i=Number(1!=t);break;case"jp":i=0;break;case"lv":i=t%10==1&&t%100!=11?0:0!=t?1:2;break;case"pl":i=1==t?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2;break;default:i=0}if(void 0===i)console.log("Unknown locale");else{if(void 0!==e[i])return e[i];console.log("Missing required word form for n = "+t+" ("+JSON.stringify(e)+")")}return""}function pluralLocale(e,t,i){var o=locale;locale=i;var a=plural(e,t);return locale=o,a}function pluralRU(e,t){return pluralLocale(e,t,"ru")}function calcSig(e){var t=[];for(var i in e)("string"==typeof e[i]||"number"==typeof e[i]&&e[i]%1==0)&&t.push(i);t.sort();for(var o="",a=0;a<t.length;a++)o+=(e[t[a]]+"").trim();var n=network;return"phonegap"==n&&(n=window.phonegapNetwork),{keys:t,sig:hexMD5(n+o+(sessionId+1<<5))}}var hexMD5=function(e){function l(e,t){return e<<t|e>>>32-t}function d(e,t){var i,o,a,n,r;return a=2147483648&e,n=2147483648&t,r=(1073741823&e)+(1073741823&t),(i=1073741824&e)&(o=1073741824&t)?2147483648^r^a^n:i|o?1073741824&r?3221225472^r^a^n:1073741824^r^a^n:r^a^n}function t(e,t,i,o,a,n,r){var s;return d(l(e=d(e,d(d((s=t)&i|~s&o,a),r)),n),t)}function i(e,t,i,o,a,n,r){var s;return d(l(e=d(e,d(d(t&(s=o)|i&~s,a),r)),n),t)}function o(e,t,i,o,a,n,r){return d(l(e=d(e,d(d(t^i^o,a),r)),n),t)}function a(e,t,i,o,a,n,r){return d(l(e=d(e,d(d(i^(t|~o),a),r)),n),t)}function n(e){var t,i="",o="";for(t=0;t<=3;t++)i+=(o="0"+(e>>>8*t&255).toString(16)).substr(o.length-2,2);return i}var r,s,c,g,u,h,p,m,f,C=Array();for(C=function(e){for(var t,i=e.length,o=i+8,a=16*((o-o%64)/64+1),n=Array(a-1),r=0,s=0;s<i;)r=s%4*8,n[t=(s-s%4)/4]=n[t]|e.charCodeAt(s)<<r,s++;return r=s%4*8,n[t=(s-s%4)/4]=n[t]|128<<r,n[a-2]=i<<3,n[a-1]=i>>>29,n}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}(e)),h=1732584193,p=4023233417,m=2562383102,f=271733878,r=0;r<C.length;r+=16)p=a(p=a(p=a(p=a(p=o(p=o(p=o(p=o(p=i(p=i(p=i(p=i(p=t(p=t(p=t(p=t(c=p,m=t(g=m,f=t(u=f,h=t(s=h,p,m,f,C[r+0],7,3614090360),p,m,C[r+1],12,3905402710),h,p,C[r+2],17,606105819),f,h,C[r+3],22,3250441966),m=t(m,f=t(f,h=t(h,p,m,f,C[r+4],7,4118548399),p,m,C[r+5],12,1200080426),h,p,C[r+6],17,2821735955),f,h,C[r+7],22,4249261313),m=t(m,f=t(f,h=t(h,p,m,f,C[r+8],7,1770035416),p,m,C[r+9],12,2336552879),h,p,C[r+10],17,4294925233),f,h,C[r+11],22,2304563134),m=t(m,f=t(f,h=t(h,p,m,f,C[r+12],7,1804603682),p,m,C[r+13],12,4254626195),h,p,C[r+14],17,2792965006),f,h,C[r+15],22,1236535329),m=i(m,f=i(f,h=i(h,p,m,f,C[r+1],5,4129170786),p,m,C[r+6],9,3225465664),h,p,C[r+11],14,643717713),f,h,C[r+0],20,3921069994),m=i(m,f=i(f,h=i(h,p,m,f,C[r+5],5,3593408605),p,m,C[r+10],9,38016083),h,p,C[r+15],14,3634488961),f,h,C[r+4],20,3889429448),m=i(m,f=i(f,h=i(h,p,m,f,C[r+9],5,568446438),p,m,C[r+14],9,3275163606),h,p,C[r+3],14,4107603335),f,h,C[r+8],20,1163531501),m=i(m,f=i(f,h=i(h,p,m,f,C[r+13],5,2850285829),p,m,C[r+2],9,4243563512),h,p,C[r+7],14,1735328473),f,h,C[r+12],20,2368359562),m=o(m,f=o(f,h=o(h,p,m,f,C[r+5],4,4294588738),p,m,C[r+8],11,2272392833),h,p,C[r+11],16,1839030562),f,h,C[r+14],23,4259657740),m=o(m,f=o(f,h=o(h,p,m,f,C[r+1],4,2763975236),p,m,C[r+4],11,1272893353),h,p,C[r+7],16,4139469664),f,h,C[r+10],23,3200236656),m=o(m,f=o(f,h=o(h,p,m,f,C[r+13],4,681279174),p,m,C[r+0],11,3936430074),h,p,C[r+3],16,3572445317),f,h,C[r+6],23,76029189),m=o(m,f=o(f,h=o(h,p,m,f,C[r+9],4,3654602809),p,m,C[r+12],11,3873151461),h,p,C[r+15],16,530742520),f,h,C[r+2],23,3299628645),m=a(m,f=a(f,h=a(h,p,m,f,C[r+0],6,4096336452),p,m,C[r+7],10,1126891415),h,p,C[r+14],15,2878612391),f,h,C[r+5],21,4237533241),m=a(m,f=a(f,h=a(h,p,m,f,C[r+12],6,1700485571),p,m,C[r+3],10,2399980690),h,p,C[r+10],15,4293915773),f,h,C[r+1],21,2240044497),m=a(m,f=a(f,h=a(h,p,m,f,C[r+8],6,1873313359),p,m,C[r+15],10,4264355552),h,p,C[r+6],15,2734768916),f,h,C[r+13],21,1309151649),m=a(m,f=a(f,h=a(h,p,m,f,C[r+4],6,4149444226),p,m,C[r+11],10,3174756917),h,p,C[r+2],15,718787259),f,h,C[r+9],21,3951481745),h=d(h,s),p=d(p,c),m=d(m,g),f=d(f,u);return(n(h)+n(p)+n(m)+n(f)).toLowerCase()},recursiveReplaceDoublePointsBeforeLetter=function e(t){if("object"===_typeof(t))for(var i in t)t[i]=e(t[i]);else if("string"==typeof t){var o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(i=0;i<o.length;i++){var a=new RegExp("\\.\\."+o.charAt(i),"g");t=t.replace(a,"."+o.charAt(i))}}return t};function callService(o,a,n,r,s,l,d){void 0===r&&(r={}),void 0===s&&(s=2),void 0===l&&(l=1e4);var e={};for(var t in r)e[t]=r[t];if("function"==typeof customNetworkServiceParams){var i=customNetworkServiceParams();for(var t in i)e[t]=i[t]}var c=calcSig(e);e.mysig=c.sig,e.mysigparams=c.keys.join("|")||"none",e.script=o,"phonegap"==network?(e.network=window.phonegapNetwork,e.notUseSession=1):e.network=network,e.sessionid=sessionId,e.doublePointsBeforeLetter=1,window.mobile&&(e.isMobile=1),"facebook"===network&&void 0!==window.signedRequest&&(e.signed_request=window.signedRequest),"spmobage"===network&&(e.code_token=clientData.code);var g=$.ajax({url:window.callServiceUrl,dataType:"json",type:"POST",success:function(e){if(void 0!==e.error)return e.text&&window.Log.error(e.text),void(void 0!==n&&n(e.error));e=recursiveReplaceDoublePointsBeforeLetter(e),void 0!==a&&a(e)},timeout:l,data:e,error:function(e,t,i){1<s?callService(o,a,n,r,s-1,l,d):void 0!==d?d():void 0!==n&&n(t+" "+i)}});return{url:window.callServiceUrl,sendParams:e,xhr:g}}function service(o,a){return new Promise(function(e,t){var i=callService(o,e,function(e){i&&i.xhr?t(i.xhr.responseJSON):t(e)},a)})}function callServiceAddInQueue(e,t){var i=callService(e,function(){},fail,t,1,5e3,function(){setTimeout(function(){application.serviceQueue.add(i)},0)})}function callServiceOrLocalStorage(e,t,i,o,a){callService(e,function(e){setLocalStorage(o,e,!0),t(e)},function(){var e=getLocalStorage(o,a,!0);t(e)},i,1,2e4)}function changeLocalStorageValue(e,t,i,o){var a=getLocalStorage(e,t,!0);void 0===o?a=i:a[o]=i,setLocalStorage(e,a,!0)}void 0===window.callServiceUrl&&(window.callServiceUrl="../service/service.php"+location.search);var tuneSizeImages={};function tuneImage(e){return' style="border:0; visibility: hidden;" onload="tuneImageSize.call(this,'+e+')" '}function makeImg(e,t){return e&&""!==e||(e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs="),'<img src="'+e+'"'+tuneImage(t)+"/>"}function numberWithSeparator(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")}function deleteAllCookies(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var i=e[t],o=i.indexOf("="),a=-1<o?i.substr(0,o):i;document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path="+window.location.pathname}}function capitalizeWord(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getLocaleText(e,t){var i=messages[e];return(_.isArray(i)||_.isObject(i))&&(i=i[t]),i}window.tuneImageSize=function(e){if(this.width&&this.height){void 0===tuneSizeImages[this.src]&&(tuneSizeImages[this.src]=[this.width,this.height]);var t=tuneSizeImages[this.src][0],i=tuneSizeImages[this.src][1];t<i?(this.height=e*i/t,this.width=e):(this.width=e*t/i,this.height=e),this.style.visibility="visible"}else{var o=this;setTimeout(function(){tuneImageSize.call(o,e)},500)}},window.parseQueryString=function(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var t=e.split("&"),i={},o=0;o<t.length;o++){var a=t[o].split("=");a&&2===a.length&&(i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]))}return i},window.parseLocationHash=function(e){"#"===e.charAt(0)&&(e=e.substring(1));for(var t=e.split("&"),i={},o=0;o<t.length;o++){var a=t[o].split("=");a&&2===a.length&&(i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]))}return i},jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,i,o,a){return jQuery.easing[jQuery.easing.def](e,t,i,o,a)},easeInQuad:function(e,t,i,o,a){return o*(t/=a)*t+i},easeOutQuad:function(e,t,i,o,a){return-o*(t/=a)*(t-2)+i},easeInOutQuad:function(e,t,i,o,a){return(t/=a/2)<1?o/2*t*t+i:-o/2*(--t*(t-2)-1)+i},easeInCubic:function(e,t,i,o,a){return o*(t/=a)*t*t+i},easeOutCubic:function(e,t,i,o,a){return o*((t=t/a-1)*t*t+1)+i},easeInOutCubic:function(e,t,i,o,a){return(t/=a/2)<1?o/2*t*t*t+i:o/2*((t-=2)*t*t+2)+i},easeInQuart:function(e,t,i,o,a){return o*(t/=a)*t*t*t+i},easeOutQuart:function(e,t,i,o,a){return-o*((t=t/a-1)*t*t*t-1)+i},easeInOutQuart:function(e,t,i,o,a){return(t/=a/2)<1?o/2*t*t*t*t+i:-o/2*((t-=2)*t*t*t-2)+i},easeInQuint:function(e,t,i,o,a){return o*(t/=a)*t*t*t*t+i},easeOutQuint:function(e,t,i,o,a){return o*((t=t/a-1)*t*t*t*t+1)+i},easeInOutQuint:function(e,t,i,o,a){return(t/=a/2)<1?o/2*t*t*t*t*t+i:o/2*((t-=2)*t*t*t*t+2)+i},easeInSine:function(e,t,i,o,a){return-o*Math.cos(t/a*(Math.PI/2))+o+i},easeOutSine:function(e,t,i,o,a){return o*Math.sin(t/a*(Math.PI/2))+i},easeInOutSine:function(e,t,i,o,a){return-o/2*(Math.cos(Math.PI*t/a)-1)+i},easeInExpo:function(e,t,i,o,a){return 0==t?i:o*Math.pow(2,10*(t/a-1))+i},easeOutExpo:function(e,t,i,o,a){return t==a?i+o:o*(1-Math.pow(2,-10*t/a))+i},easeInOutExpo:function(e,t,i,o,a){return 0==t?i:t==a?i+o:(t/=a/2)<1?o/2*Math.pow(2,10*(t-1))+i:o/2*(2-Math.pow(2,-10*--t))+i},easeInCirc:function(e,t,i,o,a){return-o*(Math.sqrt(1-(t/=a)*t)-1)+i},easeOutCirc:function(e,t,i,o,a){return o*Math.sqrt(1-(t=t/a-1)*t)+i},easeInOutCirc:function(e,t,i,o,a){return(t/=a/2)<1?-o/2*(Math.sqrt(1-t*t)-1)+i:o/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeInElastic:function(e,t,i,o,a){var n=1.70158,r=0,s=o;if(0==t)return i;if(1==(t/=a))return i+o;if(r||(r=.3*a),s<Math.abs(o)){s=o;n=r/4}else n=r/(2*Math.PI)*Math.asin(o/s);return-s*Math.pow(2,10*(t-=1))*Math.sin((t*a-n)*(2*Math.PI)/r)+i},easeOutElastic:function(e,t,i,o,a){var n=1.70158,r=0,s=o;if(0==t)return i;if(1==(t/=a))return i+o;if(r||(r=.3*a),s<Math.abs(o)){s=o;n=r/4}else n=r/(2*Math.PI)*Math.asin(o/s);return s*Math.pow(2,-10*t)*Math.sin((t*a-n)*(2*Math.PI)/r)+o+i},easeInOutElastic:function(e,t,i,o,a){var n=1.70158,r=0,s=o;if(0==t)return i;if(2==(t/=a/2))return i+o;if(r||(r=a*(.3*1.5)),s<Math.abs(o)){s=o;n=r/4}else n=r/(2*Math.PI)*Math.asin(o/s);return t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*a-n)*(2*Math.PI)/r)*-.5+i:s*Math.pow(2,-10*(t-=1))*Math.sin((t*a-n)*(2*Math.PI)/r)*.5+o+i},easeInBack:function(e,t,i,o,a,n){return null==n&&(n=1.70158),o*(t/=a)*t*((n+1)*t-n)+i},easeOutBack:function(e,t,i,o,a,n){return null==n&&(n=1.70158),o*((t=t/a-1)*t*((n+1)*t+n)+1)+i},easeInOutBack:function(e,t,i,o,a,n){return null==n&&(n=1.70158),(t/=a/2)<1?o/2*(t*t*((1+(n*=1.525))*t-n))+i:o/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+i},easeInBounce:function(e,t,i,o,a){return o-jQuery.easing.easeOutBounce(e,a-t,0,o,a)+i},easeOutBounce:function(e,t,i,o,a){return(t/=a)<1/2.75?o*(7.5625*t*t)+i:t<2/2.75?o*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?o*(7.5625*(t-=2.25/2.75)*t+.9375)+i:o*(7.5625*(t-=2.625/2.75)*t+.984375)+i},easeInOutBounce:function(e,t,i,o,a){return t<a/2?.5*jQuery.easing.easeInBounce(e,2*t,0,o,a)+i:.5*jQuery.easing.easeOutBounce(e,2*t-a,0,o,a)+.5*o+i}});var _checkRules=function(e){var i,o=Promise.resolve(!0),t=_createForOfIteratorHelper(e);try{var a=function(){var t=i.value;o=o.then(function(e){return e?t():Promise.resolve(!1)})};for(t.s();!(i=t.n()).done;)a()}catch(e){t.e(e)}finally{t.f()}return o};function loadLevelJSON(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],t={},i=function(o){e.push(new Promise(function(e,t){var i=a[o];application.system&&"IE"===application.system.browser&&"phonegap"!=network?callService("../../../levelbase/src/services/loadjson.php",e,t,{path:i.substring(i.indexOf("levels")+7)}):$.ajax({url:i,dataType:"json",type:"GET",success:e,error:t})}).then(function(e){t[o]=e}))};for(var o in a)i(o);return Promise.all(e).then(function(){return t})}function removeSpine(e){if(e){e.pause();var t=e.canvas.getContext("webgl");e.canvas.remove(),setTimeout(function(){try{t.getExtension("WEBGL_lose_context").loseContext()}catch(e){console.log("   ",e)}},500)}}var SeedRandomizer=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:49734321;_classCallCheck(this,t),this._seed=e}return _createClass(t,[{key:"random",value:function(){return this._seed=this._seed+2127912214+(this._seed<<12)&4294967295,this._seed=4294967295&(3345072700^this._seed^this._seed>>>19),this._seed=this._seed+374761393+(this._seed<<5)&4294967295,this._seed=4294967295&(this._seed+3550635116^this._seed<<9),this._seed=this._seed+4251993797+(this._seed<<3)&4294967295,this._seed=4294967295&(3042594569^this._seed^this._seed>>>16),(268435455&this._seed)/268435456}}]),t}(),Random=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Math;_classCallCheck(this,t),this._randomizer=e}return _createClass(t,[{key:"random",value:function(){return this._randomizer.random()}},{key:"randomIntRange",value:function(e,t){return e+Math.floor(this.random()*(t-e+1))}},{key:"randomFloatRange",value:function(e,t){return e+this.random()*(t-e)}},{key:"randomArray",value:function(e){return e[Math.floor(this.random()*e.length)]}},{key:"chance",value:function(e){for(var t=this.random()*e.reduce(function(e,t){return e+t}),i=0,o=0;o<e.length;++o)if(i+=e[o],t<=i)return o}},{key:"objectChance",value:function(e){var t=this.chance(Object.values(e));return Object.keys(e)[t]}}]),t}(),randomizer=new Random,Settings=new(Backbone.Model.extend({defaults:{soundEffects:!0,musicEffects:!0},initialize:function(){this.on("change",function(e,t){t&&!0===t.notSave||this.save()},this),this.load()},load:function(){this.set(getLocalStorage("Settings",{},!0))},save:function(){for(var e=this.keys(),t={},i=0;i<e.length;i++){var o=e[i];t[o]=this.get(o)}setLocalStorage("Settings",t,!0),parent.postMessage({name:"setLocalStorage",key:"Settings",value:t},"*")},toggle:function(e){this.set(e,!this.get(e))}})),SM_FAILED=!1;function MySound(e){"undefined"!=typeof deviceType?1==deviceType&&null==winDesktop&&(SM_FAILED=!0):/IEMobile[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&(SM_FAILED=!0),this.url=e.url,this.onload=e.onload,this.loaded=!1,this.instance=!1,this.lastPalyedTime=0,SM_FAILED?this.onload&&(this.onload(),this.onload=!1):setTimeout(_.bind(function(){this.onload&&(this.onload(),this.onload=!1)},this),1e4)}function soundManagerFailed(){SM_FAILED||(window.Log.write("SoundManager failed"),SM_FAILED=!0,Settings.set({musicEffects:!1,soundEffects:!1},{notSave:!0}))}MySound.prototype.safeProcess=function(e){if(!SM_FAILED&&this.loaded)try{e.call(this)}catch(e){if(window.winDesktop)return;console.log("muscic error ",e),e instanceof TypeError?soundManagerFailed():function(){throw e}()}},MySound.prototype.onLoad=function(){this.loaded||(this.loaded=!0,this.onload&&(this.onload(),this.onload=!1))},MySound.prototype.play=function(t){this.loaded&&this.safeProcess(function(){var e=(new Date).getTime();this.lastPalyedTime<e-50&&(this.lastPalyedTime=e,this.instance=createjs.Sound.play(this.url),t&&this.instance.on("complete",function(){this.play(!0)},this),this.muted&&this.mute())})},MySound.prototype.stop=function(){this.safeProcess(function(){this.instance&&this.instance.stop()})},MySound.prototype.setVolume=function(e){this.safeProcess(function(){this.instance&&this.instance.setVolume(e)})},MySound.prototype.setPosition=function(e){this.safeProcess(function(){this.instance&&this.instance.setPosition(e)})},MySound.prototype.mute=function(){this.muted=!0,this.instance&&this.instance.setMute(!0)},MySound.prototype.unmute=function(){this.muted=!1,this.instance&&this.instance.setMute(!1)};var SoundManager=Backbone.Model.extend({initialize:function(){this.sounds=sounds||[],createjs.Sound.addEventListener("fileload",_.bind(function(e){if(this.sounds[e.id]){this.sounds[e.id].onLoad();var t=this.get("music");t===e.id&&(this.stopMusic(),this.playMusic(t))}},this)),this.listenTo(Settings,"change:musicEffects",this.onChangeMusicMute),this.listenTo(Settings,"change:soundEffects",this.onChangeSoundMute)},onChangeSoundMute:function(e,t){t||this.stopAllSounds()},onChangeMusicMute:function(e,t){var i=this.get("music");t?(this.set("music",null),this.playMusic(i)):this.sounds[i]&&this.sounds[i].stop()},load:function(e,t,i){this.sounds[e]=new MySound({url:t,onload:i})},stopAllSounds:function(){var e=this.get("music");for(var t in this.sounds)t!=e&&this.sounds[t].stop()},restartSounds:function(){application.playPageSound()},getSound:function(e){if(!1===e)return!1;if(Config.sounds){if(!1===Config.sounds[e])return!1;if(Config.sounds[e+"_"+episode.get("num")]){var t=Config.sounds[e+"_"+episode.get("num")];if(this.sounds[t])return this.sounds[t]}if(Config.sounds[e]){t=Config.sounds[e];return this.sounds[t]?this.sounds[t]:void 0}}return this.sounds[e]?this.sounds[e]:void 0},hasSound:function(e){return!!this.sounds[e]},playSound:function(e,t){if(!Settings.get("soundEffects"))return!1;var i=this.getSound(e);return i?(i.play(t&&t.loop),t&&t.volume&&i.setVolume(t.volume),!0):(!1!==i&&console.log('sound for "'+e+'" event is not exist'),!1)},stopSound:function(e){if(this.sounds[e])this.sounds[e].stop();else if(Config.sounds){var t=Config.sounds[e];if(this.sounds[t])return void this.sounds[t].stop()}},playMusic:function(e){var t=this.get("music");t!==e&&(t&&this.sounds[t]&&this.sounds[t].stop(),this.set("music",e),!this.get("pause")&&Settings.get("musicEffects")&&this.sounds[e]&&this.sounds[e].play(!0))},stopMusic:function(){var e=this.get("music");e&&this.sounds[e]&&this.sounds[e].stop(),this.set("music",null)},pause:function(){this.set("pause",!0);var e=this.get("music");e&&this.sounds[e]&&this.sounds[e].stop()},resume:function(){if(this.get("pause")){this.set("pause",!1);var e=this.get("music");this.stopMusic(),this.playMusic(e)}}});window.soundManager=new SoundManager,window.unload=function(){soundManager.stopAllSounds()};var RFMCategory={UNKNOWN:0,NEOPHYT:1,GUDGEON:2,CRUCIAN:3,DOLPHIN:4,SDOLPHIN:5,WHALE:6,SWHALE:7,CACHALOT:8};function addEmit(e){e.waitEvent=function(t){var i=this;return new Promise(function(e){i.once(t,e)})},e.emit=function(e){if(!this._events)return Promise.resolve();for(var t=Math.max(0,arguments.length-1),i=Array(t),o=0;o<t;o++)i[o]=arguments[o+1];return Promise.all(a(n,this._events,e,void 0,i))};var l=/\s+/,a=function e(t,i,o,a,n){var r,s=0;if(o&&"object"===_typeof(o)){void 0!==a&&"context"in n&&void 0===n.context&&(n.context=a);for(r=_.keys(o);s<r.length;s++)i=e(t,i,r[s],o[r[s]],n)}else if(o&&l.test(o))for(r=o.split(l);s<r.length;s++)i=t(i,r[s],a,n);else i=t(i,o,a,n);return i},n=function(e,t,i,o){var a=[];if(e){var n=e[t],r=e.all;n&&r&&(r=r.slice()),n&&(a=a.concat(s(n,o))),r&&(a=a.concat(s(r,[t].concat(o))))}return a},s=function(e,t){return e.map(function(e){return e.callback.apply(e.ctx,t)})}}function fail(e,t){if(e&&"script error"!==e){var i=e;t&&(i+=" "+String(t)),window.manualLogError(i)}Application.run?new ConnectionLostWindow({error:e}):showSystemErrorMessage(e)}function showSystemErrorMessage(e){var t=e||"default",i=messages.connectionLostTitle[t]||messages.connectionLostTitle.default,o=messages.connectionLostText[t]||messages.connectionLostText.default;alert(i+"\n\n"+o),location.reload()}addEmit(Backbone.Events),addEmit(Backbone.Model.prototype),addEmit(Backbone.Collection.prototype),addEmit(Backbone.View.prototype),Backbone.Collection.prototype._onModelEvent=function(e,t,i,o){if("add"!==e&&"remove"!==e||i===this)return"destroy"===e&&this.remove(t,o),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.emit.apply(this,arguments)};var requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},toRoman=function(e){var t=["I","V","X","L","C","D","M"],i=[1,5,10,50,100,500,1e3],o="";if(e)for(var a=t.length-1;0<=a;--a)for(;i[a]<=e;)4*i[a]<=e&&a!=t.length?(e-=4*i[a],o+=t[a],o+=t[a+1]):(e-=i[a],o+=t[a]);return o},application,usage,usekey;function delay(t){return new Promise(function(e){t?setTimeout(e,t):e()})}usekey=function(){};var DateUtil={addDays:function(e,t){var i=new Date(e);return i.setDate(i.getDate()+t),i}},nua=window.navigator.userAgent,is_android_browser=-1<nua.indexOf("Mozilla/5.0")&&-1<nua.indexOf("Android ")&&-1<nua.indexOf("AppleWebKit")&&!(-1<nua.indexOf("Chrome"));is_android_browser&&($(".network_"+network).css("overflow","visible"),$("#game").css("overflow","visible")),window.init=function(t){if(void 0===Application.started){if(Application.started=!0,$("#templates").html(templates),templates=void 0,Application.orientation?Application.orientation():$(window).on("resize",function(){canvas&&canvas.onChangeLayout&&canvas.onChangeLayout()}),void 0!==figureRulesProcess&&figureRulesProcess.process(),Config.requiredModernizrTests)for(var e=0;e<Config.requiredModernizrTests.length;e++)if(!Modernizr[Config.requiredModernizrTests[e]])return $("#badBrowserWindow").show(),void $("#prePreloadPage").hide();$(".frameContainer").on("mousemove touchmove",removeSelection),$(".frameContainer").on("mousedown touchstart",function(){setTimeout(removeSelection,0)}),$(".frameContainer").on("mouseup touchend",removeSelection),(application=new Application).initComponents(),application.afterInit(),application.on("run",function(){if(window.bannersContent){var e=window.bannersContent;e=(e=e.replace("&paid=@paid@","&paid="+Number(user.get("paid")))).replace("&gender=@gender@","&gender="+Number(user.get("gender"))),$("#banners").html(e)}window.bottomBtnBlock&&$(".bottomBtnBlockContainer").html(window.bottomBtnBlock),t&&t(),$(".viewerId").show().on("click touchend",function(){prompt("User ID:",viewerId)}),$(".viewerIdStroke").text("ID: "+viewerId)}),void 0===window.MapEditor||window.editor||(window.editor=new MapEditor),void 0!==Config.actions&&new CPView({actions:Config.actions})}else console.log("window.init second call")},$.fn.fadeIn=function(e,t){return this.css({opacity:0}).show(),this.ourAnimate({opacity:1},e,void 0,t)},$.fn.fadeOut=function(e,t){return this.ourAnimate({opacity:0},e,void 0,function(){$(this).hide(),t&&t.call(this)})},$.fn.distanceTo=function(e){var t=this.offset(),i=e.offset();return Math.sqrt((t.left-i.left)*(t.left-i.left)+(t.top-i.top)*(t.top-i.top))},$.fn.alignTo=function(e,t){var i=_.isNumber(e.left)?e:e.offset(),o=this.parent().offset();return t&&t.useMargin&&(i.left-=parseInt(this.css("margin-left")),i.top-=parseInt(this.css("margin-top"))),t&&t.ajust&&(i.left+=t.ajust.left,i.top+=t.ajust.top),Modernizr.csstransforms3d&&this.css({left:"0px",top:"0px"}),t&&t.css?this.css({left:i.left-o.left+"px",top:i.top-o.top+"px"}):this.setCoords({left:i.left-o.left+"px",top:i.top-o.top+"px"}),this},$.fn.setTransform=function(e,t,i,o){if(Modernizr.csstransforms3d)void 0!==e?(e=_.isString(e)&&0===e.indexOf("+=")?this.getData("translateX")+parseFloat(e.substr(2)):parseFloat(e),this.setData("translateX",e)):e=this.getData("translateX"),void 0!==t?(t=_.isString(t)&&0===t.indexOf("+=")?this.getData("translateY")+parseFloat(t.substr(2)):parseFloat(t),this.setData("translateY",t)):t=this.getData("translateY"),void 0!==i?(i=parseFloat(i),this.setData("rotateZ",i)):i=this.getData("rotateZ"),void 0!==o?this.setData("scale",o):o=this.getData("scale"),this.css(generateTransform(e,t,i,o));else{if(void 0!==e||void 0!==t){var a={};void 0!==e&&(a.left=e),void 0!==t&&(a.top=t),this.css(a)}void 0!==i&&this.rotate(i),void 0!==o&&this.scale(o)}return this},_.firstToUpperCase=function(e){return e.replace(/^./,function(e){return e.toUpperCase()})},$.fn.setCoords=function(e){return this.setTransform(e.left,e.top)},$.fn.setAngle=function(e){return this.setTransform(void 0,void 0,e)},$.fn.setScale=function(e){return this.setTransform(void 0,void 0,void 0,e)},$.fn.getData=function(e){var t=this.data(e);return void 0===t&&(t="scale"==e?1:0),t},$.fn.setData=function(e,t){"scale"==e&&1==t||"scale"!=e&&0===t?this.removeData(e):this.data(e,t)},$.fn.classForTime=function(t,e){var i=this;return i.addClass(t).delay(e).queue(function(e){i.removeClass(t),e()})};var calcFinishCssValue=function(e,t){if(void 0===t)return e;if("string"==typeof t){if(0===t.indexOf("+="))return e+parseFloat(t.substr(2));if(0===t.indexOf("-="))return e-parseFloat(t.substr(2))}return parseFloat(t)},generateTransform=function(e,t,i,o){var a="translateZ(0)";return 0!==e&&(a+="translateX("+e+"px)"),0!==t&&(a+="translateY("+t+"px)"),0!==i&&(a+="rotateZ("+i+"deg)"),1!==o&&(a+="scale("+o+","+o+")"),{transform:a,"-webkit-transform":a,"-o-transform":a,"-ms-transform":a,"-moz-transform":a}};function pad(e,t,i){return i=i||"0",(e=String(e)).length>=t?e:new Array(t-e.length+1).join(i)+e}function checkNoNumberAsString(e,t){if(!_.isObject(e))throw new Error("Argument is not an object, source: "+t);for(var i=_.keys(e),o=0;o<i.length;o++){var a=i[o],n=e[a];if(_.isString(n)&&n===Number(n).toString())throw new Error('Numeric value for "'+a+'" is string "'+n+'", source: '+t);_.isObject(n)&&checkNoNumberAsString(n,t)}return!0}function extend(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,(e.prototype.constructor=e).superclass=t.prototype}function duration(e){if("number"==typeof e||parseInt(e,10).toString()===e)return parseInt(e,10);for(var t,i={d:0,h:0,m:0,s:0},o=/([0-9]+)([dhms])/gm;t=o.exec(e);)i[t[2]]=parseInt(t[1],10)||0;return 24*i.d*60*60+60*i.h*60+60*i.m+i.s}function randomizedObjectKey(e){var t=randomChance(Object.values(e));return Object.keys(e)[t]}function randomChance(e){for(var t=Math.random()*e.reduce(function(e,t){return e+t}),i=0,o=0;o<e.length;++o)if(t<=(i+=e[o]))return o}$.fn.cssSpriteAnimation=function(e,t,i,o){var a=e+" "+t+"ms steps("+i+") forwards",n=$(":first-child",this);n.css({animation:a,"-webkit-animation":a}),this.css({opacity:1}),setTimeout(_.bind(function(){n.css({animation:"","-webkit-animation":""}),this.css({opacity:0}),o&&o()},this),t)},$.fn.ourAnimateCSS=function(e,t,i,o){if(!this.length)return this;if(e.target){var a=e.target.offset(),n=this.offsetParent().offset();void 0===e.ajust&&(e.ajust={left:0,top:0}),e.left=a.left-n.left+e.ajust.left+"px",e.top=a.top-n.top+e.ajust.top+"px",delete e.target}return this.animate(e,t,i,o)},$.fn.ourAnimate=function(o,t,e,i){if(!this.length)return this;if(o.target){var a=o.target.offset(),n=this.parent().offset();void 0===o.ajust&&(o.ajust={left:0,top:0}),o.left=a.left-n.left+o.ajust.left+"px",o.top=a.top-n.top+o.ajust.top+"px",delete o.target}if(Modernizr.csstransforms3d){if(void 0!==o.left||void 0!==o.top||void 0!==o.rotate||void 0!==o.scale){var r={},s={},l=this;if(l.queue(function(e){for(var t in r.translateX=l.getData("translateX"),s.translateX=calcFinishCssValue(r.translateX,o.left),r.translateY=l.getData("translateY"),s.translateY=calcFinishCssValue(r.translateY,o.top),r.rotateZ=l.getData("rotateZ"),s.rotateZ=calcFinishCssValue(r.rotateZ,o.rotate),r.scale=l.getData("scale"),s.scale=calcFinishCssValue(r.scale,o.scale),o)"left"!=t&&"top"!=t&&"rotate"!=t&&"scale"!=t&&(r[t]=parseFloat(l.css(t)),s[t]=calcFinishCssValue(r[t],o[t]));l.setData("translateX",s.translateX),l.setData("translateY",s.translateY),l.setData("rotateZ",s.rotateZ),l.setData("scale",s.scale),e()}),window.mobile)"function"==typeof e&&(i=e,e=void 0),l.queue(function(e){t=Math.round(100*t)/100,l.css({"-webkit-transition":"opacity "+t+"ms, -webkit-transform "+t+"ms",transition:"opacity "+t+"ms, transform "+t+"ms","-webkit-transition-timing-function":"linear","transition-timing-function":"linear"}),l.setTransform(s.translateX,s.translateY,s.rotateZ,s.scale),void 0!==s.opacity&&l.css({opacity:s.opacity}),setTimeout(_.bind(function(){l.css({"-webkit-transition":"",transition:""}),i&&i.call(this),e()},this),t)});else{l.animate({path:new function(){this.css=function(e){e=1-e;var t=generateTransform(r.translateX+(s.translateX-r.translateX)*e,r.translateY+(s.translateY-r.translateY)*e,r.rotateZ+(s.rotateZ-r.rotateZ)*e,r.scale+(s.scale-r.scale)*e);for(var i in o)"left"!=i&&"top"!=i&&"rotate"!=i&&"scale"!=i&&(t[i]=r[i]+(s[i]-r[i])*e);return l.css(t),{}}}},t,e,i)}}else this.css(generateTransform(this.getData("translateX"),this.getData("translateY"),this.getData("rotateZ"),this.getData("scale"))),this.animate(o,t,e,i);return this}return this.animate(o,t,e,i)},window.fixOperaAnimation=function(){},-1!==navigator.userAgent.toLowerCase().indexOf("opera")&&-1!==navigator.userAgent.toLowerCase().indexOf("version/12")&&(window.fixOperaAnimation=function(){$("#mainAppWrapper").addClass("fixOperaAnimation").removeClass("fixOperaAnimation"),setTimeout(function(){$("#mainAppWrapper").addClass("fixOperaAnimation").removeClass("fixOperaAnimation")},2e3)}),_.override=function(t,e){_.each(e,function(i,e){if(_.isFunction(i)){var o=t.prototype[e];t.prototype[e]=function(){var e=this.override;this.override=o;var t=i.apply(this,arguments);return this.override=e,t}}else t.prototype[e]=i})};var firstSessionLogger={logEvent:function(e){var t=-1!=["odnoklassniki","test","vkontakte","facebook","phonegap"].indexOf(network);if(application&&application.AUTHORIZATION_DATA&&application.AUTHORIZATION_DATA.firstTime&&Config&&Config.saveBeginStats&&t){var i=application.system.browser+" "+application.system.version;window.mobile&&application.system.device?i+=", "+application.system.device:i+=", "+application.system.os,callService("../../../levelbase/src/services/firstsession.php",_.noop,_.noop,{step:e,mobile:window.mobile?1:0,device:i})}}},util={duration:duration,randomChance:randomChance,randomizedObjectKey:randomizedObjectKey,bundle:function(a,n,e){var r=[],s=null;return function(){for(var t=this,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];r.push(i),clearTimeout(s),s=setTimeout(function(){var e=_.unzip(r);r=[],a.apply(t,e)},n||10)}},typeOfAny:function(e,t){for(var i=0;i<t.length;++i)if(t[i]&&e instanceof t[i])return!0;return!1},classOfAny:function(e,t){if(e)for(var i=0;i<t.length;++i)if(t[i]&&e.constructor===t[i])return!0;return!1},animateToPromise:function(i,o){for(var e=arguments.length,a=new Array(2<e?e-2:0),t=2;t<e;t++)a[t-2]=arguments[t];return new Promise(function(e,t){try{i.apply(o,[e].concat(a))}catch(e){t(e)}})}},EventReady=function(){function e(){var t=this;_classCallCheck(this,e),this._eventState=new Promise(function(e){t._resolve=e})}return _createClass(e,[{key:"wait",value:function(){return this._eventState}},{key:"ready",value:function(){return this._resolve()}}]),e}();Backbone.Events.Emitter=function(){},_.extend(Backbone.Events.Emitter.prototype,Backbone.Events);var Library={easingFunctions:{linear:function(e){return e}},collectFly:function(e,t){return t.easing&&(e=t.easing(e)),{x:this.baseValues.x+this.deltaValues.x*e,y:this.baseValues.y+(this.deltaValues.y+t.vy)*e*e-t.vy*e,scale:1-(1-t.targetScale)*e,rotate:t.rotate?t.rotate*e:0}},jumpBy:function(e,t){if(t.easing&&(e=t.easing(e)),this.baseValues){var i=e*t.jumps%1,o=4*t.height*i*(1-i);o+=this.deltaValues.y*e;var a=this.deltaValues.x*e;return{x:this.baseValues.x+a,y:this.baseValues.y+o,rotate:t.rotate?t.rotate*e:0}}},linearFly:function(e,t){return t.easing&&(e=t.easing(e)),{x:this.baseValues.x+this.deltaValues.x*e,y:this.baseValues.y+this.deltaValues.y*e,scale:1-(1-t.targetScale)*e,rotate:t.rotate?t.rotate*e:0}},ballFly:function(e,t){var i,o,a=((e=e||{}).startAngle||-90)+30*Math.random()-15,n=e&&e.speed||800,r=e&&e.radialSpeed||300,s=e.spriteAngle||90,l=Math.random(),d=_.once(function(){i=canvasTime});return{params:{x:0,y:0},options:{duration:1e5,callback:function(){this.set({rotate:0}),t&&t.call(this)},step:function(e,t){d(),(l-=o=(canvasTime-i)/1e3)<0&&(r*=-1,l=Math.random()),a+=r*o,this.baseValues.x+=n*Math.cos(a*Math.PI/180)*o,this.baseValues.y+=n*Math.sin(a*Math.PI/180)*o,i=canvasTime,(this.baseValues.x<-Config.cellWidth||this.baseValues.y<-Config.cellHeight||this.baseValues.x>canvas.canvasWidth||this.baseValues.y>canvas.canvasHeight)&&(t.options.duration=0),this.set({x:this.baseValues.x,y:this.baseValues.y,rotate:a+s})}}}},clamp:function(e,t,i){return e<t?t:i<e?i:e}};!function(){var i={};for(var e in _.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,t){i[e]=function(e){return Math.pow(e,t+2)}}),_.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t=4,i=Math.pow(2,--t);e<(i-1)/11;)i=Math.pow(2,--t);return 1/Math.pow(4,3-t)-7.5625*Math.pow((3*i-2)/22-e,2)}}),i)t(e,i[e]);function t(e,t){Library.easingFunctions["easeIn"+e]=t,Library.easingFunctions["easeOut"+e]=function(e){return 1-t(1-e)},Library.easingFunctions["easeInOut"+e]=function(e){return e<.5?t(2*e)/2:1-t(-2*e+2)/2}}}();var ObscureNumber=function(e){this.set(e)};ObscureNumber.prototype.get=function(){return this.a1^this.a2},ObscureNumber.prototype.set=function(e){return this.a1&&this.a2&&(this.a1^this.a2)!==e?.5<Math.random()?this.a1=this.a2^e:this.a2=this.a1^e:(this.a1=Math.floor(5e3*Math.random())+1e3,this.a2=e^this.a1),e},ObscureNumber.prototype.valueOf=ObscureNumber.prototype.get;var ActionQueue=function(){this.active=null,this.items=[]};ActionQueue.Priority={low:1,normal:5,high:10},ActionQueue.prototype._nextActivate=function(e){if(this.items=this.items.sort(function(e,t){return t.priority-e.priority}),this.active=this.items.shift(),this.active)try{var t=this;Promise.resolve().then(function(){return t.active.action.run()}).then(function(){t.active.resolve(),t._nextActivate()}).catch(function(e){t.active.reject(e),t._nextActivate()})}catch(e){this.active.reject(e),this._nextActivate()}},ActionQueue.prototype.isActive=function(e){return!!this.active&&(!e||this.active.action instanceof e)},ActionQueue.prototype.canAction=function(){return!!this.active||0<this.items.length},ActionQueue.prototype.push=function(i,o){var a=this;return console.assert(i.run,"You must implement method run"),new Promise(function(e,t){a.items.push({resolve:e,reject:t,action:i,priority:o||ActionQueue.Priority.normal}),a.active||(clearTimeout(a._defer),a._defer=setTimeout(a._nextActivate.bind(a),1))})},ActionQueue.prototype.wait=function(e,t){return this.push({run:function(){return Promise.resolve()}})};var AccumulativeQueue=Backbone.Model.extend({defaults:{maxItems:10},initialize:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._items=e.items||[],delete e.items,Model.prototype.initialize.call(this,e)},push:function(t){var i=this;return Promise.resolve().then(function(){var e=null;if(i._items.length>=i.get("maxItems")&&(e=i._items.shift()),i._items.push(t),e)return i.emit("itemShift",i,e)}).then(function(){return i.emit("itemPush",i,t)})},shift:function(){return this.emit("itemShift",this,this._items.shift())}}),SIGNALEVENT="activate",BaseSignal=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"activate",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.emit.apply(this,[SIGNALEVENT].concat(t))}}]),e}();_.extend(BaseSignal.prototype,Backbone.Events);var EventSignal=function(e){_inherits(a,BaseSignal);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this)).listenTo(t,e,i.activate),i}return _createClass(a)}(),LifeKeeper={askSendLifes:function(){var e=allFriendsIds;("facebook"===network||"draugiem"===network||"mixijp"===network||"phonegap"==network&&"facebook"==window.phonegapNetwork||"spmobage"===network)&&(e=friendsInAppIds),new SelectFriendWindow({massCallback:function(e){LifeKeeper.askSendLifesFromSelectedFriends(e)},callback:function(e){LifeKeeper.askSendLifesFromSelectedFriends([e])},type:"askLifes",userIds:_.map(e,function(e){return String(e)})})},askSendLifesFromSelectedFriends:function(e){var t=function(t){return function(e){e&&e.length&&callService("../../../levelbase/src/services/asklife.php",t,_.noop,{userIds:e.join(",")})}};t(function(e){e&&e.length&&socialNetwork.sendRequest({type:"askSendLife",verb:"askfor",ogobject:"life",userIds:e,message:RANDOM(messages.askLife),success:"odnoklassniki"===network?t(_.noop):_.noop})})(e)},checkCanFriendSendLife:function(e){return void 0===window.friendSendedLifeTime[e]||window.friendSendedLifeTime[e]<application.getCurrentServerTime()-this.getLifeAskInterval()},checkMeSendLifeToFriend:function(e){return void 0===window.meSendedLifeTime[e]||window.meSendedLifeTime[e]<application.getCurrentServerTime()-this.getLifeAskInterval()},getLifeAskInterval:function(){return"undefined"!=typeof askLiveInterval?askLiveInterval:86400},setMeSendedLifeToFriend:function(e){_.each(e,function(e){window.meSendedLifeTime[e]=application.getCurrentServerTime()}),setLocalStorage("meSendedLifeTime",window.meSendedLifeTime)},setFriendSendedLifeTime:function(e){_.each(e,function(e){window.friendSendedLifeTime[e]=application.getCurrentServerTime()}),setLocalStorage("friendSendedLifeTime",window.friendSendedLifeTime)},load:function(){window.friendSendedLifeTime=getLocalStorage("friendSendedLifeTime"),void 0===window.friendSendedLifeTime&&(window.friendSendedLifeTime={}),window.meSendedLifeTime=getLocalStorage("meSendedLifeTime"),void 0===window.meSendedLifeTime&&(window.meSendedLifeTime={})}},InviteKeeper={markInvited:function(e){for(var t=0;t<e.length;t++)window.friendsInvitedTimes[e[t]]?window.friendsInvitedTimes[e[t]]++:window.friendsInvitedTimes[e[t]]=1;setLocalStorage("friendsInvitedTimes",window.friendsInvitedTimes)},load:function(){window.friendsInvitedTimes=getLocalStorage("friendsInvitedTimes"),void 0===window.friendsInvitedTimes&&(window.friendsInvitedTimes={})}},BaseUser=Backbone.Model.extend({defaults:{photo:!1,name:!1,gender:!1,bthdate:!1,online:!1,last_online:!1,inapp:!1},initialize:function(){},calcWeight:function(){var e=0,t=calcAge(this.get("bthdate"));t<18&&(e+=3),18<=t&&t<28&&(e+=8),28<=t&&t<36&&(e+=14),36<=t&&t<46&&(e+=18),46<=t&&(e+=15),this.get("gender")&&(e*=2),this.get("online")&&(e+=30);var i=calcAmountDaysAfterDate(this.get("last_online"));return i<7&&(e+=2),i<31&&(e+=3),180<i&&(e-=100),this.get("inapp")?e+=100:window.friendsInvitedTimes[this.id]&&(e-=20*window.friendsInvitedTimes[this.id]),e}}),Users=Backbone.Collection.extend({model:BaseUser,comparator:function(e){return-e.calcWeight()},getBestForInvite:function(){for(var e=listFriendsNotInAppIds(),t=[],i=0;i<e.length;i++)t.push({id:e[i],weight:Math.random()*this.get(e[i]).calcWeight()});for(t.sort(function(e,t){return t.weight-e.weight}),e=[],i=0;i<t.length;i++)e.push(t[i].id);return e}},{create:function(e){var i=new Users;return _.each(e,function(e,t){i.add(_.extend({id:t},e))},this),i}}),Timer=Backbone.Model.extend({defaults:{timeToFinish:null,active:!0,pause:!1},initialize:function(){this.on("change:timeToFinish",this.refreshTick,this),this.refreshTick()},refreshTick:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null);var e=this.getTimer();0<e?(this.set("active",!0),this.timeout=setTimeout(_.bind(this.refreshTick,this),1e3*e)):(this.set("active",!1),this.get("timeToFinish")&&(this.onFinish(),this.trigger("finish"))),this.trigger("tick",this)},now:function(){return Math.floor(Date.now()/1e3)},getTimer:function(){return this.get("pause")?this.get("pause"):Math.max(0,this.get("timeToFinish")-this.now())},setTimer:function(e){e=util.duration(e),this.isPause()?this.set("pause",e):this.set("timeToFinish",this.now()+e),this.trigger("change",e)},addTime:function(e){e=util.duration(e),this.setTimer(this.getTimer()+e),this.trigger("add",e)},isActive:function(){return 0<this.getTimer()},isFinish:function(){return!!this.get("timeToFinish")&&!this.isActive()},onFinish:function(){},finish:function(){this.set("timeToFinish",this.now()),this.refreshTick()},cleanFinish:function(){this.set("timeToFinish",null)},setFinishTime:function(e){e instanceof Date&&(e=Math.round(e.getTime()/1e3)),this.set("pause",!1),this.set("timeToFinish",e||null),this.refreshTick()},getFinishTime:function(){return this.get("timeToFinish")?new Date(1e3*this.get("timeToFinish")):null},start:function(e){this.set("pause",!1),this.setTimer(e),this.trigger("start")},stop:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.set("timeToFinish",null),this.trigger("stop")},pause:function(){this.isPause()||(this.set("pause",this.getTimer()),this.stop())},resume:function(){this.isPause()&&this.start(this.get("pause"))},isPause:function(){return!1!==this.get("pause")}}),Locales=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,i),this._messages=e,this._prefix=t}return _createClass(i,[{key:"setParent",value:function(e){this._parent=e}},{key:"getParent",value:function(){return this._parent}},{key:"createSub",value:function(e){var t=new i(this._messages,e);return t.setParent(this),t}},{key:"get",value:function(e){return this._prefix?this._messages[this._prefix+this.capitalize(e)]:this._messages[e]}},{key:"find",value:function(e){for(var t=e.split("."),i=this.get(t[0]),o=1;o<t.length;++o){if(!i||void 0===i[t[o]])return this._parent?this._parent.find(e):null;i=i[t[o]]}return!i&&this._parent?this._parent.find(e):i}},{key:"printf",value:function(e,n){var r=this;return _.isArray(n)&&_.isObject(n[0])&&(n=n[0]),_.isString(e)?e.replace(/\{([^:^}]+):?(.*?)\}/gim,function(e,t,i){if(i){var o=i.indexOf("(");if(-1==o){if(r[i])return r[i](n[t])}else{var a=i.substring(o+1,i.indexOf(")")).split(",");if(i=i.substring(0,o),r[i])return a.unshift(n[t]),r[i].apply(r,a)}}return n[t]}):e}},{key:"print",value:function(e){var t=this.find(e)||"{undefined:"+e+"}";return _.isArray(t)&&(t=RANDOM(t)),this.printf(t,Array.prototype.slice.call(arguments,1))}},{key:"printForGender",value:function(e,t){var i=this.find(e)||"<undefined>";return _.isArray(i)&&((_.isArray(i[0])||2<i.length)&&(i=RANDOM(i)),_.isArray(i)&&(i="female"==t?i[1]:i[0])),this.printf(i,Array.prototype.slice.call(arguments,2))}},{key:"printOr",value:function(e,t){var i=this.find(e)||this.find(t)||"<undefined>";return this.printf(i,Array.prototype.slice.call(arguments,2))}},{key:"lpad",value:function(e,t,i){for(var o=(e||0).toString(),a=i||"0",n=o.length;n<t;++n)o=a+o;return o}},{key:"timer",value:function(e){var t=Math.floor(e/86400);e%=86400;var i=Math.floor(e/3600);e%=3600;var o=Math.floor(e/60);return e=Math.round(e%60),0<t?this.printf(this.get("timerDay"),{d:t,h:i,m:o,s:e}):0<i?this.printf(this.get("timer3"),{d:t,h:i,m:o,s:e}):0<o?this.printf(this.get("timer2"),{d:t,h:i,m:o,s:e}):this.printf(this.get("timer1"),{d:t,h:i,m:o,s:e})}},{key:"shortTimer",value:function(e){var t=Math.floor(e/86400);e%=86400;var i=Math.floor(e/3600);e%=3600;var o=Math.floor(e/60);return e=Math.round(e%60),0<t?this.printf(this.get("shortTimerDay"),{d:t,h:i,m:o,s:e}):0<i?this.printf(this.get("shortTimer3"),{d:t,h:i,m:o,s:e}):0<o?this.printf(this.get("shortTimer2"),{d:t,h:i,m:o,s:e}):this.printf(this.get("shortTimer1"),{d:t,h:i,m:o,s:e})}},{key:"maxLen",value:function(e,t){return e?e&&e.length<t?e:e.substr(0,t-1)+"":""}},{key:"duration",value:function(e){var t=util.duration(e),i=Math.floor(t/86400);t%=86400;var o=Math.floor(t/3600);t%=3600;var a=Math.floor(t/60);t=Math.round(t%60);var n=[];return i&&n.push(this.printf(this.get("days"),[i])),o&&n.push(this.printf(this.get("hours"),[o])),a&&n.push(this.printf(this.get("minutes"),[a])),t&&n.push(this.printf(this.get("seconds"),[t])),n.join(" ")}},{key:"plural",value:function(e){var t;switch(locale){case"ru":t=e%10==1&&e%100!=11?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2;break;case"br":case"en":case"de":case"es":t=Number(1!=e);break;case"fr":t=Number(1<e);break;case"ja":case"zh":case"zht":case"ko":t=0;break;case"lv":t=e%10==1&&e%100!=11?0:0!=e?1:2;break;case"pl":t=1==e?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2;break;default:return cc.log("Unknown locale: ",cc.sys.language),""}for(var i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return void 0!==o[t]?o[t].replace("$",e):(cc.log("Missing required word form for n = "+e+" ("+JSON.stringify(o)+")"),"")}},{key:"capitalize",value:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}}]),i}(),BaseApplicationComponent=Backbone.Model.extend({init:function(e){return Promise.resolve()},load:function(e){return Promise.resolve()}}),User=Backbone.Model.extend({initialize:function(){(user=this).processedPays=[];var e=application.AUTHORIZATION_DATA;if(Config.lifeRefillPrice=new ObscureNumber(Config.lifeRefillPrice),bonusForInvite=new ObscureNumber(bonusForInvite),publicationBonus=new ObscureNumber(publicationBonus),giftSentBonus=new ObscureNumber(giftSentBonus),giftReceivedBonus=new ObscureNumber(giftReceivedBonus),void 0!==e.coins&&(e.coins=new ObscureNumber(e.coins)),this.set(e),application.USERS[this.get("userId")]&&(this.set("photo",application.USERS[this.get("userId")].photo),this.set("bigPhoto",application.USERS[this.get("userId")].bigPhoto),this.set("name",application.USERS[this.get("userId")].first_name),this.set("gender",application.USERS[this.get("userId")].gender),this.set("profile",application.USERS[this.get("userId")].profile)),this.set("usedPowerUps",{}),this.updateLocalStorageProgress(),window.gcmIdToChange&&changeGCMId(window.gcmIdToChange),application.on("run",function(){this.on("change:episode",function(){this.calcAvailables(),this.updateLocalStorageProgress()},this),this.on("change:level",function(){this.calcAvailables(),this.updateLocalStorageProgress(),"vkontakte"==network&&setUserLevel(episode.absoluteLevelNumber(this.get("level")))},this)},this),this.get("GCMId")&&Config.pushNotificationsSender){var i=!1;this.on("change:lives",function(e,t){0===t?(addPushTask(0,Config.lifeRestoreTime*Config.maxLives),i=!1):i||(deletePushTask(0),i=!0)})}this.serverAttributes=["level","lives","livesLastRestored","coins","lastLogin","strip","powerUps","collectAction","amountCollectCoinsFromFriends","shownForces","bonusLevelPlayTime","bonusLevelDoneEpisode","everydayBonusSeria","everydayBonusCollected","withoutLoseSeria","todayGachaPlayTimes","achievements","gifts","spins","ban"];var t=3e4<user.get("coins")||user.get("ban");Config.statistics&&Config.statistics.general&&!t&&(this.serverAttributes.push("actionName"),this.serverAttributes.push("actionEpisode"),this.serverAttributes.push("actionLevel"),this.serverAttributes.push("actionPrice")),"phonegap"===network&&this.serverAttributes.push("paid"),this.on("change",this.changeListener,this),window.collectCoinsFriendTime=getLocalStorage("collectCoinsFriendTime"),void 0===window.collectCoinsFriendTime&&(window.collectCoinsFriendTime={}),this.powerUps=new PowerUps(Config.listPowerUps());for(var o=this.get("powerUps"),a=0;a<Config.powerUpIdsOrder.length;a++)user.powerUps.get(Config.powerUpIdsOrder[a]).set("amount",o%100),o=Math.floor(o/100);this.on("buyBonusLevelTime",function(){Game.set({timeout:1e3*Config.bonusLevelBuyTimeAmount,buyedTime:1,running:!0,fullRunning:!0}),new BonusLevelTimeAddWindow}),this.on("buyBonusLevelRefresh",function(){user.set({bonusLevelPlayTime:0},{notSave:!0}),episode.bonusLevel.play()}),Application.on("ready",function(){user.getUnlockKeyTime()&&(this.serverAttributes.push("keyLastUnlocked"),this.serverAttributes.push("keyLastUnlockedEpisode")),this.livesIntervalFunction(),setInterval(_.bind(this.livesIntervalFunction,this),1e3),user.get("paid")&&""<user.get("curRefPlace")&&user.set({actionName:("ref_"+user.get("curRefPlace")).substr(0,20),actionEpisode:0,actionLevel:0,actionPrice:0})},this)},tournamentUserId:function(){return network.substr(0,2)+this.get("userId")},updateMaxLives:function(){this.get("lives")>Config.maxLives&&this.set("lives",Config.maxLives)},updateLocalStorageProgress:function(){if("phonegap"==network){var e=getLocalStorage("mu",{episode:1,level:1},!0);(this.get("episode")>e.episode||this.get("episode")==e.episode&&this.get("level")>e.level)&&(e.episode=this.get("episode"),e.level=this.get("level"),setLocalStorage("mu",e,!0))}},changeListener:function(i,e){if(!e||!0!==e.notSave)if(i.hasChanged("episode"))i.previous("episode")+1==i.get("episode")&&(this.get("keysBought")||callServiceAddInQueue("../../../levelbase/src/services/nextepisode.php",{episode:i.get("episode")}),setTimeout(function(){user.set({level:1,receivedKeys:[],keysBought:!1,friendsHelpSended:0},{notSave:!0})},0));else{this.cheatCheck();var t=_.intersection(_.keys(i.changedAttributes()),i.serverAttributes);if(0<t.length||!_.isEmpty(user.processedPays)){var o={};_.each(t,function(e){var t=i.get(e);o[e]=void 0===t.get?t:t.get()}),void 0!==o.lives&&(o.livesLastRestored=i.get("livesLastRestored")),void 0!==o.livesLastRestored&&(o.lives=i.get("lives")),_.isEmpty(user.processedPays)||(o.processedPays=user.processedPays.join(",")),callServiceAddInQueue("../../../levelbase/src/services/updateuser.php",o),o.actionName&&(user.set({actionName:!1,actionEpisode:!1,actionLevel:!1,actionPrice:!1},{notSave:!0}),user.processedPays=[])}}},cheatCheck:function(){if(!this.get("ban")){var e=this.get("coins")-this.previous("coins");if(0!==e&&"phonegap"!==network){var t=new Date(1e3*application.getCurrentServerTime()),i="income_"+t.getUTCFullYear()+(t.getUTCMonth()+1),o="outcome_"+t.getUTCFullYear()+(t.getUTCMonth()+1);if(this.get("actionName"))-1!=this.get("actionName").indexOf("$product")&&(this._payNow=!0,setLocalStorage(i,0),setLocalStorage(o,0));if(!(this._payNow||this.get("episode")<6)){var a=application.getCurrentServerTime()-new Date(user.get("lastPayDate")).getTime()/1e3;if(!(a<1209600)){var n=0;6e3<e&&(n=n||1);var r=getLocalStorage(i,0),s=getLocalStorage(o,0);0<e?setLocalStorage(i,r+=e):setLocalStorage(o,s-=e);var l=Math.max(r,s),d=a<5184e3;d&&5e4<=l&&(n=n||2),!d&&3e4<=l&&(n=n||3),n&&this.set("ban",n,{notSave:!0})}}}}},isShownForces:function(e){return this.get("shownForces")&1<<e},clearShownForces:function(e){this.set("shownForces",this.get("shownForces")&~(1<<e))},setShownForces:function(e){this.set("shownForces",this.get("shownForces")|1<<e)},initAchievements:function(){if(Config.achievementsOrder){this.achievements=new Achievements;for(var e=this.get("achievements"),t=0;t<Config.achievementsOrder.length;t++){var i=Config.achievementsOrder[t];this.achievements.add(new i({level:e%10,order:t})),e=Math.floor(e/10)}}},calcChangedAchievements:function(e,t){var i,o=[],a=this.get("achievements");for(i=0;i<Config.achievementsOrder.length;i++)o.push(a%10),a=Math.floor(a/10);for(o[e]=t,a=0,i=Config.achievementsOrder.length-1;0<=i;i--)a=10*a+o[i];return a},changeAchievement:function(e,t){this.set("achievements",this.calcChangedAchievements(e,t))},needForceNow:function(){return!window.testRun&&episode.get("about").force&&episode.get("about").force[application.level.num]&&!application.playedLevels[episode.absoluteLevelNumber(application.level.num)]&&(!episode.scores.findWhere({level:application.level.num})||!1)},getRandomFriendForGift:function(){if(!this.selectedForGifts)return!1;if(0===this.selectedForGifts.length)return!1;var e=this.selectedForGifts.shift();if("mobage"===network){for(;this.selectedForGifts.length&&users[e].age<18;)e=this.selectedForGifts.shift();if(users[e].age<18)return!1}return this.selectedForGifts.push(e),void 0!==users[e]&&e},calcPowerUps:function(){for(var e=0,t=Config.powerUpIdsOrder.length-1;0<=t;t--){e=100*e+this.powerUps.get(Config.powerUpIdsOrder[t]).get("amount")}return e},defaultPublication:function(e,t){if(messages[e+"Message"]){var i=RANDOM(messages[e+"Message"]),o=messages[e+"Image"],a=messages[e+"Caption"][this.get("gender")];_.isArray(i)&&(i=i[this.get("gender")]),_doPublication(i,o,a,void 0,t,e)}else console.log("no publication for: "+e)},setPowerUpAmount:function(e,t,i){var o=this.powerUps.get(e);t<100?o.set("amount",t):o.set("amount",99),i||this.set("powerUps",this.calcPowerUps())},getPowerUpAmount:function(e){return this.powerUps.get(e).get("amount")},buyPowerUp:function(e){this.set({coins:new ObscureNumber(this.get("coins")-Math.abs(e.get("price")))},{validate:!0})},usePowerUp:function(e){this.trigger("usedPowerUp",e);var t=this.get("usedPowerUps"),i={};for(var o in t)i[o]=t[o];void 0===i[e.id]&&(i[e.id]=0),i[e.id]++,this.set("usedPowerUps",i),0<e.get("amount")?this.setPowerUpAmount(e.id,e.get("amount")):this.set({coins:new ObscureNumber(this.get("coins")-Math.abs(e.get("price"))),actionName:e.id,actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:e.get("price")},{validate:!0})},getLifes:function(e){if(0!==e.length){var t=this.get("lives");(t+=e.length)>Config.maxLives&&(t=Config.maxLives),this.set({lives:t},{notSave:!0})}},checkCanCollectCoinsFromFriend:function(e){return void 0===window.collectCoinsFriendTime[e]||window.collectCoinsFriendTime[e]<window.dayBeginTime},checkNeedHelpFriends:function(){return!(0===needHelpFriends.length||this.get("level")<10&&1==this.get("episode"))},neverPlayedBefore:function(){return 1==this.get("episode")&&1==this.get("level")},inviteBestFriends:function(){socialNetwork.invite(allUsers.getBestForInvite())},tryOpenShopRecommendedWindow:function(){if(application.canOpenNotMatterWindow()&&Config.shopRecommened&&!(user.get("episode")<Config.shopRecommened.episode||user.get("episode")==Config.shopRecommened.episode&&user.get("level")<Config.shopRecommened.level)){var e=getLocalStorage("lastShopRecommendedWindow");if(void 0===e&&(e=0),!(e>application.getCurrentServerTime()-86400*Config.shopRecommened.interval)){var t=[];_.each(Config.shopRecommened.types,function(e){"good"==e.type&&goods.checkProduct(e.name)||t.push(e)}),0<t.length&&(setLocalStorage("lastShopRecommendedWindow",application.getCurrentServerTime()),new ShopRecommendedWindow({type:RANDOM(t)}))}}},getRealLevel:function(){return this.get("level")+(this.get("episode")-1)*Config.levelsInEpisode},getCurrentLevel:function(){var e=this.get("level"),t=this.get("episode");return e=e<Config.levelsInEpisode?e:Config.levelsInEpisode,(t-1)*Config.levelsInEpisode+e},getPassedLevels:function(){return this.getCurrentLevel()-(this.isCurrentLevelPassed()?0:1)},isCurrentLevelPassed:function(){return this.get("level")>Config.levelsInEpisode},getPreviousLevel:function(){var e=this.previous("level"),t=this.previous("episode");return e=e<Config.levelsInEpisode?e:Config.levelsInEpisode,(t-1)*Config.levelsInEpisode+e},isAllLevelsCompleted:function(){return this.getPassedLevels()>=Config.levelsInEpisode*Config.episodesAmount},getMaxLevel:function(){return Config.episodesAmount*Config.levelsInEpisode},calcAvailables:function(){this.calcShopAvailable(),this.calcMyAchievmentsAvailable(),this.calcBonusWorldAvailable(),this.calcGachaAvailable(),this.calcBonusGameAvailable(),this.calcAdditionalLivesAvailable()},calcShopAvailable:function(){!1!==Config.shopAvailable&&(this.get("episode")>Config.shopAvailable.episode||this.get("episode")==Config.shopAvailable.episode&&this.get("level")>=Config.shopAvailable.level)?this.set("shopAvailable",!0):this.set("shopAvailable",!1)},calcMyAchievmentsAvailable:function(){!1!==Config.myAchievmentsAvailable&&void 0!==Config.myAchievmentsAvailable&&(this.get("episode")>Config.myAchievmentsAvailable.episode||this.get("episode")==Config.myAchievmentsAvailable.episode&&this.get("level")>=Config.myAchievmentsAvailable.level)?this.set("myAchievmentsAvailable",!0):this.set("myAchievmentsAvailable",!1)},calcBonusWorldAvailable:function(){this.get("bonusWorldAvailable")||(this.set("bonusWorldAvailable",!1),Config.bonusWorlds&&_.each(_.result(Config,"bonusWorlds"),_.bind(function(t){var e=!0;if(t instanceof BonusWorld||(t=new t.class(t)),e=t.get("production"),t.get("withFriends")&&"phonegap"==network&&e&&(e="phonegap"!=phonegapNetwork),(this.get("episode")<t.get("episode")||this.get("episode")==t.get("episode")&&this.get("level")<t.get("level"))&&(e=!1),void 0!==t.get("networks")&&e&&(e="phonegap"===network?-1!==t.get("networks").indexOf(phonegapNetwork):"wizq"===network?-1!==t.get("networks").indexOf(wizqnetwork):-1!==t.get("networks").indexOf(network)),void 0!==t.get("uids")&&e&&(e=-1!==t.get("uids").indexOf(viewerId)),void 0!==t.get("gender")&&t.get("gender")!=this.get("gender")&&(e=!1),void 0!==t.get("age")){var i=calcAge(users[this.get("userId")].bthdate);(!i||i<t.get("age")[0]||i>t.get("age")[1])&&(e=!1)}void 0!==t.get("country")&&users[this.get("userId")].country!=t.get("country")&&(e=!1),e&&t.checkAvailability(_.bind(function(e){e&&(Config.bonusWorld||(Config.bonusWorld=t),this.set("bonusWorldAvailable",e),this.trigger("bonusWorldAvailable",this,e)),t.set("active",e)},this))},this)))},calcGachaAvailable:function(){Config.gacha&&Config.gacha.episode&&Config.gacha.level&&(this.get("episode")>Config.gacha.episode||this.get("episode")==Config.gacha.episode&&this.get("level")>=Config.gacha.level)?this.set("gachaAvailable",!0):this.set("gachaAvailable",!1)},calcBonusGameAvailable:function(){this.set("bonusGameAvailable",this.getBonusGameAvailable())},getBonusGameAvailable:function(){var e=this.get("bonusGameAvailable");return void 0===e&&(e=Config.bonusGame&&Config.bonusGame.enabled&&Config.bonusGame.minLevel<=this.getRealLevel())&&Config.bonusGame.networks&&(e=-1<Config.bonusGame.networks.indexOf(network)),e},calcAdditionalLivesAvailable:function(){Config.goods&&Config.goods.additionalLifes?this.getRealLevel()<Config.goods.additionalLifes.available?this.set("additionalLivesAvailable",!1):goods.checkProduct("unlimitedLifes")?this.set("additionalLivesAvailable",!1):this.get("returned")?this.set("additionalLivesAvailable",!1):this.set("additionalLivesAvailable",!0):this.set("additionalLivesAvailable",!1)},validate:function(e){return e.coins<0?"nocoins":e.lives<0?"nolives":void 0},getAmountKeys:function(){if(this.get("episode")==Config.episodesAmount)return 0;var e=user.get("receivedKeys").length;return(3<e||user.get("keysBought"))&&(e=3),e},amountKeys:function(){var e=user.getAmountKeys(),t=user.getUnlockKeyTime();if(t){var i=application.getCurrentServerTime()-user.get("keyLastUnlocked");e+=Math.floor(i/t),3<e&&(e=3)}return"candyvalley"!=Config.project&&"gems"!=Config.project||1!=user.get("episode")||(e=3),void 0!==goods&&goods.checkProduct("unlimitedKeys")&&(e=3),e},refillLives:function(){return this.set({coins:new ObscureNumber(this.get("coins")-Math.abs(Number(Config.lifeRefillPrice))),lives:Config.maxLives,actionName:"refill lifes",actionEpisode:this.get("episode"),actionLevel:this.get("level"),actionPrice:Number(Config.lifeRefillPrice)},{validate:!0})},livesIntervalFunction:function(){if(this.get("lives")<Config.maxLives){var e=this.get("livesLastRestored")+Config.lifeRestoreTime-application.getCurrentServerTime();this.set("timeToNextLife",e,{notSave:!0}),this.get("timeToNextLife")<0&&(this.set({lives:Math.min(this.get("lives")+1,Config.maxLives),livesLastRestored:this.get("livesLastRestored")+Config.lifeRestoreTime},{notSave:!0}),this.livesIntervalFunction())}else this.set("timeToNextLife",-1)},nextLevel:function(){this.get("level")<=Config.levelsInEpisode&&this.set({level:this.get("level")+1,receivedKeys:[],keysBought:!1,friendsHelpSended:0},{notSave:!0})},addLifeOnWin:function(){goods.checkProduct("unlimitedLifes")||this.get("lives")<Config.maxLives&&this.set("lives",Math.min(this.get("lives")+1,Config.maxLives))},addAndRemoveLifeOnLoseGame:function(){var e={actionName:"lose game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0,lives:this.get("lives"),livesLastRestored:this.get("livesLastRestored"),withoutLoseSeria:0};this.countLose(),this.countNealyWin(),goods.checkProduct("unlimitedLifes")?this.set(e):(e.lives<Config.maxLives&&e.lives++,e.lives==Config.maxLives&&(e.livesLastRestored=application.getCurrentServerTime()),e.lives--,this.set(e,{validate:!0}))},countNealyWin:function(){var i=[" "],o=0,a=0;if(gameView.tasksView.tasks.each(function(e){var t=e.getCompletion();o+=t,a++,i.push(e.get("cssClass")+" "+t)}),0<a){var e=Math.round(100*o/a);if(i.push(" %: "+e),85<=e){var t=95<=e?"#95":"#85";user.set({actionName:"nearly win "+t,actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0})}}},countLose:function(){var e=20*(episode.get("num")-1)+application.level.num,t=20*(user.get("episode")-1)+user.get("level");t==e&&(getLocalStorage("lastLoseLevel")!==t&&(setLocalStorage("lastLoseLevel",t),setLocalStorage("lastLoseCount",0)),setLocalStorage("lastLoseCount",getLocalStorage("lastLoseCount")+1))},removeLifeOnStartGame:function(){var e={actionName:"start game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0};return 1===episode.get("num")&&1===application.level.num&&firstSessionLogger.logEvent("start 1st game"),user.get("firstTime")||1!==episode.get("num")||0!==episode.scores.length||1!==application.level.num||(e.actionName="not first #1"),goods.checkProduct("unlimitedLifes")?(this.set(e),!0):(this.get("lives")==Config.maxLives&&(e.livesLastRestored=application.getCurrentServerTime()),e.lives=this.get("lives"),this.set(e,{validate:!0}))},askSendKeys:function(){var e=allFriendsIds;("facebook"===network||"mxijp"===network||"phonegap"===network&&"facebook"==window.phonegapNetwork)&&(e=friendsInAppIds),new SelectFriendWindow({massCallback:function(e){user.askSendKeysFromSelectedFriends(e)},callback:function(e){user.askSendKeysFromSelectedFriends([e])},type:"askKeys",onClose:function(){new EpisodeLockedWindow},userIds:_.map(e,function(e){return String(e)})})},askSendKeysFromSelectedFriends:function(e){var t=function(e){e&&e.length&&callServiceAddInQueue("../../../levelbase/src/services/askkey.php",{userIds:e.join(",")})};t(e),socialNetwork.sendRequest({type:"askSendKey",verb:"askfor",ogobject:"key",userIds:e,message:RANDOM(messages.askKey),success:"odnoklassniki"==network?t:_.noop})},buyKeys:function(){var e=Number(this.getUnlockKeyPrice());if(this.set({coins:new ObscureNumber(this.get("coins")-Math.abs(e))},{validate:!0,notSave:!0})){this.set("keysBought",!0,{notSave:!0});var t={coins:this.get("coins").get(),episode:this.get("episode"),level:this.get("level")};return Config.statistics&&Config.statistics.general&&(t.price=e),callServiceAddInQueue("../../../levelbase/src/services/buykeys.php",t),!0}return!1},getUnlockKeyTime:function(){var e=this.get("episode")+1;return Config.unlockEpisodeConfig?(Config.unlockEpisodeConfig[e]||(e=0),Config.unlockEpisodeConfig[e].autoUnlockTime):Config.autoUnlockEpisodeTime?Config.autoUnlockEpisodeTime:0},getUnlockKeyPrice:function(){var e=this.get("episode")+1,t=user.amountKeys();return Config.unlockEpisodeConfig?(Config.unlockEpisodeConfig[e]||(e=0),new ObscureNumber(Config.unlockEpisodeConfig[e].price[t])):Config.autoUnlockEpisodeTime?new ObscureNumber(Config.unlockEpisodePrice()):new ObscureNumber(0)},unlockEpisode:function(){var e=_.bind(function(){this.set({episode:user.get("episode")+1,level:1,friendsHelpSended:0})},this);Config.changeEpisodeAnimation?Config.changeEpisodeAnimation(e):e()},isFreeHelpAvailable:function(){return!0},addSpins:function(e){this.set("spins",this.get("spins")+e),this.showGachaWindow()},showGachaWindow:function(){}}),UserInfo=Backbone.Model.extend({defaults:{id:null,userId:null,episode:null,level:null,firstName:null,lastName:null,photoUrl:null,inapp:!1,gender:null,birthday:null,stars:0},getAvatar:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:80;return this.get("photoUrl")?makeImg(this.get("photoUrl"),e):'<div class="no-photo gender-'+(this.get("gender")?"female":"male")+'"></div>'}}),UserView=Backbone.View.extend({el:"#user",initialize:function(){this.$(".mapAva").html(socialNetwork.makePhotoById(user.get("userId"),Config.basePhotoSize)),episode.scores.on("add remove",this.renderUser,this),application.on("pinsUpdated",this.renderUser,this),episode.on("backToFirstLevel",function(){application.once("main",function(){var o=500,a=1500;window.mobile&&"gems"==Config.project&&(a=o=0),this.backToFirstLevelTimeout=setTimeout(_.bind(function(){this.backToFirstLevelTimeout=!1;var e=parseInt($("#level1").css("left")),t=parseInt($("#level1").css("top"));$("#main").addClass("levelFailedGoBack"),$(".levels .level").removeClass("levelNow");for(var i=0;i<Config.levelsInEpisode;++i)$("#main").removeClass("levelNow"+i);$(".wayPieces .wayPiece").removeClass("wayPieceOpen"),episode.backToFirstLevelSound&&application.playSound(episode.backToFirstLevelSound),this.$el.delay(o).animate({left:e+"px",top:t+"px"},a,"linear",_.bind(function(){episode.backToFirstLevelSound&&application.stopSound(episode.backToFirstLevelSound),$("#main").removeClass("levelFailedGoBack"),$("#level1").addClass("levelNow"),$("#main").addClass("levelNow1"),$(".outerLevelAnimation").css({left:this.$el.css("left"),top:this.$el.css("top")})},this))},this),o)},this)},this),episode.on("episodeLoaded",this.renderUser,this),episode.on("episodeStartLoad",this.stopEpisodeAnimation,this)},stopEpisodeAnimation:function(){this.backToFirstLevelTimeout&&clearTimeout(this.backToFirstLevelTimeout),this.$el.clearQueue().stop(),episode.backToFirstLevelSound&&application.stopSound(episode.backToFirstLevelSound)},renderUser:function(){var e="";Config.needShowEpisodes&&(e=" #levelsBlock"+(((episode.isBonusWorld()?episode.previous("num"):episode.get("num"))-1)%Config.needShowEpisodes+1)+" ");$(e+".levels .level").removeClass("levelNow"),$(e+".wayPieces .wayPiece").removeClass("wayPieceOpen"),this.$el.hide(),$(e+"#ship").hide(),$(e+".outerLevelAnimation").removeClass("currentEpisodeLevelAnimation");for(var t=0;t<Config.levelsInEpisode;++t)$("#main").removeClass("levelNow"+t);if($("#main"+e).removeClass("episodeFinished"),$("#main"+e).removeClass("episodeAllRumRecieved"),$("#main"+e).removeClass("episodeCurrent"),$(e+".finalPoint").removeClass("finished"),$(e+"#ship").removeClass("userOnShipNow"),(user.get("episode")>episode.get("num")||3===user.amountKeys()&&!Config.needShowEpisodes&&1<user.get("episode"))&&$("#main"+e).addClass("episodeAllRumRecieved"),episode.isCurrent()&&$("#main"+e).addClass("episodeCurrent"),episode.isFinished()&&!episode.isBonusWorld()&&($(e+".wayPieces .wayPiece").addClass("wayPieceOpen"),$("#main"+e).addClass("episodeFinished"),$(e+".finalPoint").addClass("finished")),!episode.isBonusWorld()&&Config.needShowEpisodes&&$(e+"#ship").show(),episode.isCurrent()||episode.isBonusWorld()){var i=user.get("level");episode.isBonusWorld()&&(i=Config.bonusWorld.getCurrentLevel()),!episode.isBonusWorld()&&Config.lockEpisodeShow&&i>episode.levelsInEpisode()&&(i=1),$(e+".wayPieces .wayPiece").slice(0,i-1).addClass("wayPieceOpen"),episode.isBonusWorld()||$(e+"#ship").show(),this.$el.hasClass("disabled")&&this.$el.removeClass("disabled"),$("#main").addClass("levelNow"+i),$(e+"#level"+i).addClass("levelNow"),this.$el.addClass("level"+i),this.$el.show(),$(e+".outerLevelAnimation").addClass("currentEpisodeLevelAnimation");var o=parseInt($(e+"#level"+i).css("left")),a=parseInt($(e+"#level"+i).css("top"));episode.scores.length==episode.levelsInEpisode()?($("#main"+e).addClass("episodeFinished"),$(e+".finalPoint").addClass("finished"),o=parseInt($(e+"#ship").css("left")),a=parseInt($(e+"#ship").css("top")),this.$el.addClass("userOnShip"),user.get("episode")!==episode.get("num")||Config.lockEpisodeShow||$(e+"#ship").addClass("userOnShipNow"),episode.isBonusWorld()&&this.$el.addClass("disabled")):this.$el.removeClass("userOnShip"),Config.lockEpisodeShow&&(user.get("episode")+1===episode.get("num")&&user.get("level")>episode.levelsInEpisode()?(o=parseInt($(e+"#ship").css("left")),a=parseInt($(e+"#ship").css("top")),this.$el.addClass("userOnShip")):$(e+"#ship").hide()),this.adjustUserPosition(o,a),$(e+".outerLevelAnimation").css({left:this.$el.css("left"),top:this.$el.css("top")})}},adjustUserPosition:function(e,t){this.$el.css({left:e+"px",top:t+"px"}),application.trigger("userViewAdjusted",this,this.$el)}}),LevelPinsView=Backbone.View.extend({el:".levels",currPins:0,initialize:function(){application.once("main",this.initEpisodeTracking,this)},initEpisodeTracking:function(){episode.on("change:num",this.setLevelPins,this),episode.scores.on("reset",this.updatePinScores,this),episode.scores.on("add change",this.renderScore,this),this.setLevelPins(episode)},setLevelPins:function(e){var t=e.levelsInEpisode();if(this.currPins!==t){this.currPins=t,this.$el.empty();for(var i=1;i<=t;i++){var o=$(".invisible .level").clone();o.attr("id","level"+i),o.attr("data-level",i),o.find(".levelNum").html(i),this.$el.append(o),o.find(".levelNum").attr("data-level",i),o.find(".levelNowAnimation").attr("data-level",i),o.find(".animationSprite").attr("data-level",i)}}this.updatePinScores(e.scores),this.updatePinNums(e),application.trigger("pinsUpdated",this)},updatePinNums:function(e){for(var t=1;t<=this.currPins;++t)this.$el.find("#level"+t+" .levelNum").html(e.absoluteLevelNumber(t))},updatePinScores:function(e){this.$(".level").removeClass("levelPassed0").removeClass("levelPassed1").removeClass("levelPassed2").removeClass("levelPassed3"),e.each(this.renderScore,this)},renderScore:function(e){this.$("#level"+e.get("level")).removeClass("levelPassed0").removeClass("levelPassed1").removeClass("levelPassed2").removeClass("levelPassed3").addClass("levelPassed"+e.get("stars"))}}),ToastView=Backbone.View.extend({el:"#toast",events:{click:"onClick"},initialize:function(e){this.options=e||{},this.$el.hide()},onClick:function(){this.options.onClick&&this.options.onClick.call(this),this.hide()},showMessage:function(e){var t=_.bind(function(){this.hide(_.bind(this._showMessage,this,e))},this);e.withoutWait?t():application.windows.runAfterCloseAllWindows(t)},_showMessage:function(e){var t=(this.options=e).title||messages.toastTitle||"",i=e.message||"",o=e.duration||5e3,a=e.className||"";e.withoutWait&&this.$el.css("z-index",100),this.$el.removeClass(),this.$(".title").text(t),this.$(".message").html(i),this.$el.addClass(a),this.$el.show(300).addClass("visible"),this._timer=setTimeout(_.bind(function(){this.hide()},this),o)},_removeTimer:function(){this._timer&&(clearTimeout(this._timer),delete this._timer)},hide:function(e){var t=this;this.options.withoutWait&&this.$el.css("z-index",""),this.options.onClose&&(this.options.onClose.call(this),delete this.options.onClose),this._removeTimer(),this.$el.removeClass("visible"),setTimeout(function(){t.$el.hide(),e&&e()},300)}}),ServiceQueue=Backbone.Model.extend({processOneByOne:function(e){if(0===this.queue.length)$("body").removeClass("offline").addClass("online"),e();else{var t=_.bind(function(){this.queue.shift(),setLocalStorage("sq",this.queue,!0),this.processOneByOne(e)},this);this.queue[0].sendParams.notUseSession=1,this.queue[0].sendParams.syncQueue=1,$.ajax({url:this.queue[0].url,dataType:"json",type:"POST",success:t,timeout:5e3,data:this.queue[0].sendParams,error:_.bind(function(){callService("../../../levelbase/src/services/checkconnect.php",t,e)},this)})}},process:function(e){0<this.queue.length?this.processOneByOne(_.bind(function(){0<this.queue.length&&setTimeout(_.bind(this.process,this),6e4),void 0!==e&&e()},this)):void 0!==e&&e()},initialize:function(){this.queue=getLocalStorage("sq",[],!0),0<this.queue.length&&$("body").removeClass("online").addClass("offline")},add:function(e){$("body").removeClass("online").addClass("offline"),this.queue.push(e);var t=this.queue.length;setLocalStorage("sq",this.queue,!0),this.queue=getLocalStorage("sq",[],!0),this.queue.length!==t?fail():1==this.queue.length&&setTimeout(_.bind(this.process,this),6e4)}}),ApplicationBase=Backbone.Model.extend({initialize:function(){this.actionQueue=new ActionQueue,this.windows=new Windows,this.preloader=new Preloader,this.preloader.on("complete",_.bind(function(){void 0===Application.run?(Application.run=!0,Application.trigger("beforeRun",this),this.run(),Application.trigger("ready",this),this.trigger("ready",this),this.windows.init()):console.log("Application.run second call")},this));var e=(new UAParser).getResult(),t={os:e.os.name+" "+e.os.version,name:e.browser.name,version:e.browser.version,device:void 0};e.device&&e.device.vendor&&("Apple"===e.device.vendor?t.device=t.os+" "+e.device.model:(t.device=e.device.vendor,e.device.model&&(t.device+=" "+e.device.model))),this.system={os:t.os.toString(),browser:t.name,version:isNaN(parseFloat(t.version))?0:parseFloat(t.version),device:t.device,isMobile:function(){var e=["android","webos","iphone","ipad","blackberry"];for(var t in e)if(navigator.userAgent.match(new RegExp(e[t],"i")))return!0;return!1}()},this.system.isMobile&&$("html").addClass("isMobile"),"IE"===this.system.browser&&$("html").addClass("ie"),"Microsoft Edge"===this.system.browser&&$("html").addClass("msEdge"),this.on("change:page",function(e,t){this.trigger(t)},this),this.getCurrentServerTime(),setInterval(_.bind(this.getCurrentServerTime,this),3e5)},getPageSound:function(){return this.get("page")+"music"},canOpenNotMatterWindow:function(){for(var e=0;e<this.windows.views.length;e++){if(!(void 0!==MessageCenterWindow&&this.windows.views[e]instanceof MessageCenterWindow||void 0!==EverydayBonusWindow&&this.windows.views[e]instanceof EverydayBonusWindow))return!1}return!0},inviteFriendsWindow:function(){var e=allUsers.getBestForInvite();if(0<e.length&&application.canOpenNotMatterWindow()){var t=getLocalStorage("inviteFriendsByRequestTime");if(void 0===t||t<(new Date).getTime()-864e5)if(setLocalStorage("inviteFriendsByRequestTime",(new Date).getTime()),"facebook"===network||window.mobile)socialNetwork.invite(e,void 0,!0);else{new SelectFriendWindow({massCallback:function(e){socialNetwork.sendRequest({type:"invite",userIds:e,message:RANDOM(messages.odnoklassniki_invite),success:InviteKeeper.markInvited})},type:"inviteFriendsByRequest",userIds:e})}}},giftLivesWindow:function(){if(0<friendsInAppIds.length&&application.canOpenNotMatterWindow()&&"wizq"!==network){var e=getLocalStorage("lastGiftLifesTime");(void 0===e||e<(new Date).getTime()-864e5)&&(setLocalStorage("lastGiftLifesTime",(new Date).getTime()),new SelectFriendWindow({massCallback:function(e){messageCenter.askedLifesProcess(e)},type:"giftLifes",userIds:friendsInAppIds}))}},playSound:function(e,t){return soundManager.playSound(e,t)},stopSound:function(e){return soundManager.stopSound(e)},playPageSound:function(){soundManager.stopAllSounds(),soundManager.playMusic(this.getPageSound())},getCurrentServerTime:function(){var e=Math.floor((new Date).getTime()/1e3)+window.phpAndJsTimeDiff;return void 0!==this.prevServerTime&&(this.prevServerTime>e+60||this.prevServerTime+600<e)?(this.reloadServerTime(),this.prevServerTime):this.prevServerTime=e},reloadServerTime:function(){this.reloadServerTimeNow||(this.reloadServerTimeNow=!0,callService("../../../base/src/services/getservertime.php",_.bind(function(e){this.reloadServerTimeNow=!1,e&&(window.phpAndJsTimeDiff=e.serverTime-Math.floor((new Date).getTime()/1e3),this.prevServerTime=e.serverTime)},this),_.bind(function(){this.reloadServerTimeNow=!1,setTimeout(_.bind(this.reloadServerTime,this),1e4)},this),{},1))},checkAuthDataSig:function(e){var t=e.mysig;return delete e.mysig,t===calcSig(e).sig},runOnIdle:function(e,t){if(!Modernizr.touch&&!window.mobile){t=t||120;var i=0;setInterval(function(){application.windows.anyWindowOpen()?i=0:t<++i&&(i=0,e())},1e3),$(document).on("mousemove touchmove mousedown touchstart mouseup touchend",function(){i=0})}},waitPageAndEpisode:function(i,o){return new Promise(function(t){var e=function e(){application.get("page")===i&&episode.get("num")===o&&(application.off(i,e),episode.off("change:num",e),t())};application.on(i,e),episode.on("change:num",e),e()})},waitPage:function(t){var i=this;return new Promise(function(e){i.get("page")==t?e():i.once(t,e)})},waitPageAndRun:function(e,t){application.get("page")==e?t():application.once(e,t)},getExternalWorld:function(){return this.getComponent(WorldsComponent).getActiveWorlds().find(function(e){return e.get("active")&&e.isAvailability()&&e.isAvailabilityEnter()})},startCurrentLevel:function(e){episodeView.goHome(!1,!0).then(function(){episode.isBonusWorld()?Config.bonusWorld.playCurrentLevel(e):episode.get("num")>user.get("episode")?new EpisodeLockedWindow:episode.playLevel(user.get("level"),e)})},getBonusWorlds:function(){var e=Config.bonusWorlds;return this.cmp("bonusworld")&&(e=e.concat(this.cmp("bonusworld").getActiveWorlds())),e},getWorldByName:function(t){return this.getBonusWorlds().find(function(e){return e.getName()===t})},getFreeEpisode:function(){var e=this.getWorldByName(Config.freeEpisodeName);return user.isAllLevelsCompleted()&&e}}),user,friends,goods,messageCenter,episode,episodeView,allUsers;_.extend(ApplicationBase,Backbone.Events);var Application=ApplicationBase.extend({initialize:function(){Config.episodesAmount=this.getEpisodesAmount(),this.ln=new Locales(messages),this._components=new Backbone.Collection,this.levelResultsCache=new AsyncCache,this.playedLevels={},ApplicationBase.prototype.initialize.call(this),this.applyPhonegap()},addComponent:function(e){var t=this;return this._components.add(e),e.load(this).then(function(){return e.init(t)}).catch(function(e){console.error(e)})},cmp:function(e){return this.getComponent(e)},getComponent:function(t){return"string"==typeof t?this._components.get(t):this._components.find(function(e){return e instanceof t})},hasComponent:function(e){return(e=this.getComponent(e))&&e.get("active")},applyPhonegap:function(){if("phonegap"==network){var e=window.screen.width*window.devicePixelRatio,t=window.screen.height*window.devicePixelRatio;Math.max(e,t)<1100&&(Config.imageQuality="low",$("#mainAppWrapper").addClass("low-res")),Application.on("ready",function(){Application.system_native&&application.system&&(application.system.device=Application.system_native.model,application.system.os=Application.system_native.platform+" "+Application.system_native.version)})}},getPageSound:function(){if("game"==this.get("page")){if("bonus"===application.level.num&&soundManager.hasSound("bonuslevelmusic"))return null;if(void 0!==episode.get("about").music){if("string"==typeof episode.get("about").music)return episode.get("about").music;if(void 0!==episode.get("about").music[application.level.num])return episode.get("about").music[application.level.num]}}else{if(("main"==this.get("page")||"rewardChain"==this.get("page"))&&episode.get("about").mainmusic)return episode.get("about").mainmusic;if(Config.bonusWorld&&Config.bonusWorld instanceof BaseWorld&&Config.bonusWorld.get("music"))return Config.bonusWorld.get("music")}return ApplicationBase.prototype.getPageSound.call(this)},afterInit:function(){var t=this;"phonegap"==network&&(this.socialLogin=new SocialLogin),this.set("view",new ApplicationView);var e=new PreloadTask({name:"serviceQueue",task:function(e){application.serviceQueue=new ServiceQueue,application.serviceQueue.process(e)}});this.preloader.add(e);var i=e;"phonegap"==network&&(i=new PreloadTask({name:"phonegapSync",parent:e,task:function(e){application.phonegapSync=new PhonegapSync,application.phonegapSync.sync(e,!0)}}),this.preloader.add(i));var o=new PreloadTask({name:"initSocial",parent:i,task:function(e){socialNetwork.init().then(function(){e()}).catch(function(e){return console.error("[initSocial]",e)})}});this.preloader.add(o);var a=new PreloadTask({name:"authorization",parent:o,task:function(o){var e={adsRef:window.adsRef,userInviter:window.userInviter||"",os:application.system.os,browser:application.system.browser,version:application.system.version,localeGame:locale};if(Config.specialWorld&&Config.specialWorld.object&&(e.worldName=Config.specialWorld.object.get("name")),"phonegap"==network)try{e.deviceId=deviceUid,e.appsflyerId=appsflyerId}catch(e){}callService("../../../levelbase/src/services/authorization.php",function(e){window.sessionId=e.sessionId;var t=application.checkAuthDataSig(e);if(e&&e.userId&&t)MessageCenter.Messages=e.messages,delete e.messages,application.AUTHORIZATION_DATA=e,window.viewerId=e.userId,window.phpAndJsTimeDiff=e.serverTime-Math.floor((new Date).getTime()/1e3),window.dayBeginTime=e.dayBeginTime,InviteKeeper.load(),LifeKeeper.load(),o();else{var i="authorization.php";e?e.userId||(i+=" !data.userId"):i+=" !data",t||(i+=" !signValid"),fail("authorization failed",i)}},function(e){"phonegap"==network&&"phonegap"!=phonegapNetwork&&application.socialLogin.showSocialLoginWindow(),fail("authorization failed",e instanceof String?e:JSON.stringify(e))},e)}});this.preloader.add(a);var n=new PreloadTask({name:"loadFriendsData",parent:a,task:function(e){loadMeAndAllFriends({first_name:1,last_name:1,photo:1,bigPhoto:1,gender:1,profile:1,inapp:1,online:1,bthdate:1,age:1,last_online:1,country:1,city:1},function(){application.USERS=users,user=new User,allUsers=new Users.create(application.USERS),application.get("view").listenToUser(),friendsInAppIds=friendsInAppIds.slice(0,Math.min(friendsInAppIds.length,300)),e()})}});this.preloader.add(n);var r=new PreloadTask({name:"loadFriends",parent:n,task:function(e){friends=new Friends,t.loadFriends(e)}});this.preloader.add(r);var s=new PreloadTask({name:"selectFriendsForGifts",parent:r,task:function(t){var i=[];if(user.selectedForGifts=[],_.each(friends.where({canSentGift:!0}),function(e){i.push(e.id)}),i=(i=_.shuffle(i)).slice(0,8),"facebook"!==network&&("phonegap"!==network||-1===["facebook","vkontakte"].indexOf(phonegapNetwork))){var e=allUsers.getBestForInvite();_.each(e,function(e){i.length<15&&i.push(e)})}0===i.length?t():(i=_.shuffle(i),callService("../../../levelbase/src/services/listsentgifts.php",function(e){user.selectedForGifts=user.selectedForGifts.concat(e),0<user.selectedForGifts.length||i.length<15?t():0===(i=listFriendsNotInAppIds()).length?t():(i=_.shuffle(i).slice(0,15),callService("../../../levelbase/src/services/listsentgifts.php",function(e){user.selectedForGifts=user.selectedForGifts.concat(e),t()},t,{friends:i.join(",")}))},t,{friends:i.join(",")}))}});this.preloader.add(s),this.preloader.add(new PreloadTask({name:"loadEpisode",parent:s,task:function(i){user.get("episode")>Config.episodesAmount&&user.set({episode:Config.episodesAmount,level:Config.levelsInEpisode+1},{notSave:!0}),episode=new Episode,episodeView=new EpisodeView,new UserView;var o=user.get("episode");if(Config.lockEpisodeShow&&user.get("level")>Config.levelsInEpisode&&user.get("episode")<Config.episodesAmount&&o++,Config.needShowEpisodes){var a=o-1-(o-1)%Config.needShowEpisodes+1;application.currentFirstEpisode=a;!function e(t){t!=Config.needShowEpisodes?episode.load(a+t,function(){e(t+1)}):episode.load(o,function(){episode.trigger("scrollToCurrent"),i()})}(0)}else episode.load(o,i)}})),Config.bonusWorlds.forEach(function(t){this.preloader.add(new PreloadTask({name:"loadArtifactWorkshop",parent:a,task:function(e){t.preload(e)}}))},this);var l=new PreloadTask({name:"dispatcherPreloader",parent:a,task:function(e){t.emit("preload").then(e)}});this.preloader.add(l),"phonegap"==network?this.socialLogin.preloadNetworkScripts(_.bind(function(){this.preloader.run()},this)):this.preloader.run()},loadFriends:function(o){var e=function(e){e.push({id:user.get("userId"),episode:user.get("episode"),level:user.get("level"),gifts:user.get("gifts"),needHelp:!1,canSentGift:!1,GCMId:!1,deviceType:!1}),friends.set(e);var t=friends.length-1;t>Config.collectCoinsFromFriendDayAmount&&(t=Config.collectCoinsFromFriendDayAmount),t-=user.get("amountCollectCoinsFromFriends"),friends.each(function(e){e.id!=user.get("userId")&&user.checkCanCollectCoinsFromFriend(e.id)&&0<t&&(t--,e.set("canCollectCoins",!0))}),window.needHelpFriends=friends.where({needHelp:!0});var i=Config.maxHelpFriends||4;window.needHelpFriends.length>i&&(window.needHelpFriends=window.needHelpFriends.slice(0,i)),o()};0<friendsInAppIds.length?callService("../../../levelbase/src/services/friendsdata.php",e,function(){e([])},{friends:friendsInAppIds.join(",")}):e([])},filterMessage:function(e){return _.filter(e,function(e){return Boolean("Admin"===e.userFrom||application.USERS[e.userTo]&&application.USERS[e.userFrom])})},notAllow:function(){this.trigger("notAllow")},getCurrentServerDay:function(){var e=this.getCurrentServerTime()-user.get("beginTime");return{dayNumber:Math.floor(e/86400),untilDayEnd:86400-e%86400}},canOpenNotMatterWindow:function(){return!episode.isBonusWorld()&&ApplicationBase.prototype.canOpenNotMatterWindow.call(this)},removeForcesInWindowQueue:function(){for(var e=1;e<this.windows.views.length;e++)if(this.windows.views[e]instanceof BaseForceView)return this.windows.views=this.windows.views.slice(e,1),void this.removeForcesInWindowQueue()},isAvailability:function(e,t){if(e){if(_.isFunction(e))return e.call(t);if(e.langs&&-1===e.langs.indexOf(locale))return!1;if(e.maxEpisode){if(!user)return!1;if(e.maxEpisode<user.get("episode"))return!1;if(e.maxLevel&&e.maxEpisode===user.get("episode")&&e.maxLevel<user.get("level"))return!1}if(e.minLevel){if(!user)return!1;if(e.minLevel>user.getCurrentLevel())return!1}if(e.maxLevel){if(!user)return!1;if(e.maxLevel<user.getCurrentLevel())return!1}if(e.episode){if(!user)return!1;if(e.episode>user.get("episode"))return!1;if(e.level&&e.episode==user.get("episode")&&e.level>user.get("level"))return!1}if(e.beginDate&&e.beginDate.getTime()>application.getCurrentServerTime())return!1;if(e.endDate&&e.endDate.getTime()<application.getCurrentServerTime())return!1;if(e.weekDays){var i=new Date(1e3*application.getCurrentServerTime()).getDay();if(!_.includes(e.weekDays,i))return!1}if(void 0!==e.paid&&user.get("paid")!==e.paid)return!1;if(e.network&&-1===e.network.indexOf(network))return!1;if(e.notNetwork&&-1!==e.notNetwork.indexOf(network))return!1}return!0},run:function(){var e=MessageCenter.addExternalMessages(MessageCenter.Messages);if(e=application.filterMessage(e),messageCenter=new MessageCenter(e),0<_.intersection(messageCenter.pluck("type"),["sentLifes","askedKeys","askedLifes","sentHelp"]).length&&new MessageCenterWindow({collection:messageCenter}),Config.initialize(),user.initAchievements(),application.strip=new Strip,new StripView({strip:application.strip}),_.each(Config.forces,function(e){new e}),window.mobile||_.each(Config.bonusWorldsForces,function(e){new e}),episode.get("num")===Config.episodesAmount&&episode.isFinished()&&episodeView.comingSoonEpisode(),1==user.get("episode")&&1==user.get("level")&&0===episode.scores.length?("vkontakte"==network&&setUserLevel(1),application.set("page","main"),Config.skipFirstEpisodeWindows||new NewEpisodeWindow):application.set("page","main"),void 0!==OffersView&&new OffersView,user.on("change:episode",this.removeForcesInWindowQueue,this),!user.get("everydayBonusCollected")&&Config.everydayBonus&&(user.get("episode")>Config.everydayBonus.episode||user.get("episode")==Config.everydayBonus.episode&&user.get("level")>=Config.everydayBonus.level)&&new EverydayBonusWindow({seria:user.get("everydayBonusSeria")}),30<user.getRealLevel()&&"wizq"!==network&&"facebook"!==network&&"mobage"!==network&&"draugiem"!==network&&"spmobage"!==network&&("phonegap"!==network||"facebook"!==phonegapNetwork&&"phonegap"!==phonegapNetwork)){var t=this;setTimeout(function(){t.inviteFriendsWindow(),t.giftLivesWindow()},50)}var i=function(e){var t=Config.goods[e.get("name")].noPromo;e.get("active")||e.get("alreadySeen")||t||new GoodsPromoWindow({productType:e.get("type"),productName:e.get("name")})},o=[];for(var a in Config.goods)Config.goods[a]&&o.push({type:Config.goods[a].productId,amount:Config.goods[a].amount,viewClass:Config.goods[a].viewClass,shopWindowPage:Config.goods[a].shopWindowPage});if((goods=new Goods(user.get("goods"))).each(i),o.forEach(function(t){goods.any(function(e){return e.get("type")===t.type})||goods.add(t)}),goods.on("change:active",function(e,t){t||("main"==application.get("page")?i(e):application.once("main",function(){i(e)}))}),"vkontakte"==network){var n=[];_.each(user.selectedForGifts,function(e){users[e].inapp||n.push(e)}),user.selectedForGifts=_.difference(user.selectedForGifts,n)}application.once("game",function(){application.once("main",function(){application.canOpenNotMatterWindow()&&user.get("canGetCoinsForInvite")&&1<user.get("episode")&&!window.mobile&&new GetCoinsForInviteWindow})}),this.trigger("run"),setTimeout(function(){application.strip.calcActive(),user.calcAvailables(),"gems"!==Config.project&&"phonegap"!==network&&"spmobage"!==network&&"yahoo"!==network&&application.canOpenNotMatterWindow()&&(5<user.get("level")||1<user.get("episode"))&&user.get("prizePublication")&&!getCookie("notPublish")&&("odnoklassniki"===network?checkPromo1(function(e){e||new PublicationForBonusWindow}):new PublicationForBonusWindow)},50),void 0!==BoringWindow&&BoringWindow.process(),0<$("#toast").length?this.toast=new ToastView:this.toast=null,socialNetwork.showPaymentPromo()},checkEpisodesAvailable:function(e){if(e.network){if("wizq"===network&&e.network!==wizqnetwork)return!1;if(e.network!==network)return!1}return!(e.beginDate>new Date)},getEpisodesAmount:function(){for(var e=0;e<Config.episodesAvailables.length;++e){var t=Config.episodesAvailables[e];if(this.checkEpisodesAvailable(t))return t.amount}}});Application.onReady=function(e){Application.isReady&&e(),Application.on("ready",e)},Application.on("ready",function(){Application.isReady=!0,firstSessionLogger.logEvent("app ready"),user.get("episode")<20&&callService("../../../levelbase/src/services/levelpassstat.php",_.noop,_.noop,{action:"session",firstSession:user.get("firstTime")}),application.on("share",function(e){var t=e&&e.tag||"share";user.set({actionName:"@"+String(t).substr(0,19),actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:0})})});var Score=Backbone.Model.extend({defaults:{level:0,score:0},calcStarsInternal:function(e){var t=episode.get("levels")[this.get("level")].score;return application.level&&"game"==application.get("page")&&application.level.num===this.get("level")&&(t=application.level.score),e<.5*t?0:e<.75*t?1:e<t?2:3},calcStars:function(){return this.calcStarsInternal(this.get("score"))},initialize:function(){void 0===this.get("stars")&&this.set("stars",this.calcStars()),this.on("change:score",function(){this.set("stars",this.calcStars())},this)}}),Scores=Backbone.Collection.extend({model:Score,initialize:function(){this.on("add",function(e){void 0!==Config.withoutLoseSeriaCalc&&((user.get("episode")>Config.withoutLoseSeriaCalc.episode||user.get("episode")==Config.withoutLoseSeriaCalc.episode&&user.get("level")>=Config.withoutLoseSeriaCalc.level)&&user.set("withoutLoseSeria",user.get("withoutLoseSeria")+1,{notSave:!0}));if(episode.isBonusWorld()){var t={episode:episode.get("num"),level:e.get("level"),score:e.get("score"),stars:e.get("stars"),bonusWorld:!0,withoutLoseSeria:user.get("withoutLoseSeria")};episode.isFreeEpisode()&&(user.trigger("recievedOrIncreasedStarsOnLevel",e.get("stars")),t.level=0),callServiceAddInQueue("../../../levelbase/src/services/addscore.php",t)}else episode.isForceEpisode()||(user.nextLevel(),user.trigger("recievedOrIncreasedStarsOnLevel",e.get("stars")),callServiceAddInQueue("../../../levelbase/src/services/addscore.php",{episode:episode.get("num"),level:e.get("level"),userLevel:user.get("level"),score:e.get("score"),stars:e.get("stars"),withoutLoseSeria:user.get("withoutLoseSeria")}))}),this.on("change:score",function(e){!episode.isBonusWorld()&&e.get("stars")>e.previous("stars")&&user.trigger("recievedOrIncreasedStarsOnLevel",e.get("stars")-e.previous("stars")),callServiceAddInQueue("../../../levelbase/src/services/changescore.php",{episode:episode.get("num"),level:e.get("level"),score:e.get("score"),stars:e.get("stars")})})},addOrUpdateScore:function(e,t){var i,o=this.findWhere({level:e});if(o?(i=o.calcStarsInternal(t),o.get("stars")<i?o.set({stars:i,score:t}):o.get("stars")==i&&o.get("score")<t&&o.set("score",t)):(o=new Score({level:e,score:t}),this.add(o),i=o.get("stars")),!window.mobile||"gems"!=Config.project){for(var a=getLocalStorage("myr_"+episode.get("num"),{scores:[],bonusLevelFinished:0},!0),n=!1,r=0;r<a.scores.length;r++)if(a.scores[r].level==e){n=r;break}!1===n?a.scores.push({level:e,score:t,stars:i}):a.scores[n].stars<i?(a.scores[n].stars=i,a.scores[n].score=t):a.scores[n].stars==i&&a.scores[n].score<t&&(a.scores[n].score=t),setLocalStorage("myr_"+episode.get("num"),a,!0)}}}),PrizesItem=Backbone.Model.extend({defaults:{actualStars:0,requiredStars:0,coins:[100,200],done:!1},execute:function(){if(this.get("addPrizes"))for(var e=this.get("addPrizes"),t=0,i=e.length;t<i;t++){var o=e[t];switch(o.type){case"powerUp":var a=user.getPowerUpAmount(o.name)+o.amount;user.setPowerUpAmount(o.name,a,!0);break;case"good":goods.goodBuyed(o.name,o.amount);break;case"gacha":user.set("spins",user.get("spins")+o.amount),user.set("freeGacha",!0),new GachaWindow({firstPriority:!0})}}if(user.set("powerUps",user.calcPowerUps()),this.get("coins")&&0<this.get("coins")){var n=new ObscureNumber(user.get("coins")+this.get("coins"));user.set("coins",n)}},selectOneOfMany:function(e){this.set("coins",this.get("variants")[e].coins||0);var t=this.get("variants")[e],i=[],o=[];t.powerUps?o=t.powerUps:t.powerUp&&o.push({powerUp:t.powerUp,powerUpAmount:t.powerUpAmount}),_.each(o,_.bind(function(e){i.push({type:"powerUp",name:e.powerUp,amount:e.powerUpAmount})},this));var a=[];t.goods?a=t.goods:t.good&&a.push({good:t.good,goodHours:t.goodHours}),_.each(a,_.bind(function(e){i.push({type:"good",name:e.good,amount:e.goodHours})},this)),t.gacha&&i.push({type:"gacha",name:"gacha",amount:t.gacha}),this.set("addPrizes",i)},initialize:function(){if(this.has("oneOfManyGame"))this.set("variants",_.shuffle(this.get("variants")));else{var e=this.get("coins")[0]+100*Math.floor((this.get("coins")[1]-this.get("coins")[0]+50)*Math.random()/100);if(this.set("coins",new ObscureNumber(e)),this.get("addition")){var t,i=[];for(t=0;t<this.get("addition").length;t++)this.get("addition")[t].available&&(user.get("episode")-1)*Config.levelsInEpisode+user.get("level")<this.get("addition")[t].available||i.push(this.get("addition")[t]);if(0<i.length){var o={},a=Math.floor(Math.random()*i.length);for(t in i[a])o[t]=i[a][t];var n=o.amount[0]+Math.floor((o.amount[1]-o.amount[0]+1)*Math.random());100<o.amount[1]&&(n=100*Math.floor((n+50)/100)),o.amount=n,"coins"==o.type?this.set("coins",new ObscureNumber(this.get("coins")+o.amount)):this.set("addPrize",o)}}}this.on("change:actualStars",function(e,t){if(t>=this.get("requiredStars")){if(this.set("actualStars",this.get("requiredStars")),episode.isBonusWorld())return;this.set("done",!0)}}),episode.scores.each(function(e){this.set("actualStars",this.get("actualStars")+e.get("stars"))},this),episode.scores.on("change",function(e){this.set("actualStars",this.get("actualStars")+e.get("stars")-e.previous("stars"))},this),episode.scores.on("add",function(e){this.set("actualStars",this.get("actualStars")+e.get("stars"))},this)},open:function(){new PrizeDoneWindow({prize:this})}}),Prizes=Backbone.Collection.extend({model:PrizesItem}),MapBonusLevel=Backbone.Model.extend({defaults:{refreshInterval:!1,removed:!1},play:function(){gameView.gameStarted||(this.get("opened")?this.get("finished")?new BonusLevelInfoWindow({type:"finished"}):this.get("refreshed")?(user.set({bonusLevelPlayTime:application.getCurrentServerTime()}),gameView.start("bonus")):new BonusLevelInfoWindow({type:"notRefreshed"}):new BonusLevelInfoWindow({type:"notOpened"}))},stopRefreshInterval:function(){!1!==this.get("refreshInterval")&&(clearInterval(this.get("refreshInterval")),this.set("refreshInterval",!1))},finish:function(){this.set("finished",!0),application.set("page","main");user.get("coins");new UserPrizes(episode.bonusLevel.get("prize")).take("bonusLevelDone",episode.get("num"),0,0,!1,{bonusLevelPlayTime:0,bonusLevelDoneEpisode:episode.get("num")})},runRefreshInterval:function(){this.get("removed")||(this.stopRefreshInterval(),this.set({refreshed:!1,refreshTimeout:1}),!this.get("finished")&&this.get("opened")&&"main"===application.get("page")&&(this.set("refreshInterval",setInterval(_.bind(function(){this.set("refreshTimeout",user.get("bonusLevelPlayTime")+Config.bonusLevelRefreshTime-application.getCurrentServerTime())},this),1e3)),this.set("refreshTimeout",user.get("bonusLevelPlayTime")+Config.bonusLevelRefreshTime-application.getCurrentServerTime())))},init:function(e){application.trigger("initMapBonusLevel",this,e),void 0!==e?($("#mapBonusLevelBlock").show(),this.on("change:actualStars",function(e,t){t>=this.get("requiredStars")&&(this.set("actualStars",this.get("requiredStars")),this.set("opened",!0))},this),this.on("change:refreshTimeout",function(e,t){t<=0&&(this.set("refreshed",!0),this.stopRefreshInterval())},this),user.on("change:bonusLevelPlayTime",this.runRefreshInterval,this),application.on("change:page",this.runRefreshInterval,this),episode.scores.on("change",function(e){this.set("actualStars",this.get("actualStars")+e.get("stars")-e.previous("stars"))},this),episode.scores.on("add",function(e){this.set("actualStars",this.get("actualStars")+e.get("stars"))},this),this.view=new MapBonusLevelView({model:this}),this.set({opened:!1,requiredStars:Config.bonusLevelStars,prize:e.prize}),this.view.initPrizeBlock(e.prize),e.finished?this.set("finished",!0):this.set("finished",!1),this.set("actualStars",0),episode.scores.each(function(e){this.set("actualStars",this.get("actualStars")+e.get("stars"))},this),this.on("change:opened",function(){user.set({bonusLevelPlayTime:0}),application.once("main",function(){new BonusLevelInfoWindow({type:"nowOpened"})},this)},this),this.runRefreshInterval(),episode.once("change:num",function(){this.set("removed",!0),this.off(),this.view.clear(),this.stopRefreshInterval()},this)):$("#mapBonusLevelBlock").hide()}}),Windows=function(){this.views=[],this.run=!1};Windows.prototype.init=function(){this.run=!0,this.up()},Windows.prototype.add=function(e,t){if(!this.run&&t.urgent&&(t.firstPriority=!0,t.urgent=!1),t.onTop)this.views.unshift(e),this.up();else if(t.urgent)if(this.views.length){if(this.views[0].closed){for(var i=this.views.length-1;1<=i;i--)this.views[i+1]=this.views[i];return void(this.views[1]=e)}this.blocked=!0,this.views[0].hide(_.bind(function(){this.views.unshift(e),this.blocked=!1,this.up()},this))}else this.views.push(e),this.up();else t.firstPriority&&1<=this.views.length?this.views[0].shown||this.run?this.views.splice(1,0,e):this.views.unshift(e):this.views.push(e),this.up()},Windows.prototype.getById=function(t){return this.views.find(function(e){return e.$el.attr("id")===t})},Windows.prototype.closeAll=function(){this.anyWindowOpen()&&(this.closeRest(),this.views[0].close())},Windows.prototype.closeRest=function(){this.anyWindowOpen()&&(this.views=this.views.slice(0,1))},Windows.prototype.remove=function(){if(this.views.shift(),this.views.length)this.up();else{var e=$("#container");e&&e.hasClass("windowOpened")&&e.removeClass("windowOpened"),e.addClass("lastWindowClosing"),setTimeout(function(){e.removeClass("lastWindowClosing")},600),application.trigger("windowsClosed")}},Windows.prototype.isOpen=function(e){return 0!==this.views.length&&this.views[0]instanceof e},Windows.prototype.isSameOpen=function(t){return _.any(this.views,function(e){return e instanceof t})},Windows.prototype.anyWindowOpen=function(){return 0<this.views.length},Windows.prototype.anyVisibleWindow=function(){return _.any(this.views,function(e){return e.shown&&!e.closed})},Windows.prototype.up=function(){if(!this.blocked&&!1!==this.run){for(;this.views.length&&!this.views[0].canOpenNow();)this.views.shift();if(this.views.length){this.views[0].trigger("open");var e=$("#container");e&&!e.hasClass("windowOpened")&&e.addClass("windowOpened"),application.trigger("windowOpened",this.views[0]),application.trigger(this.views[0].$el.attr("id")+"Opened"),this.views[0].shown||this.views[0].show()}}},Windows.prototype.runAfterCloseAll=function(){return this.anyWindowOpen()?new Promise(function(e){application.once("windowsClosed",e)}):Promise.resolve()},Windows.prototype.runAfterCloseAllWindows=function(e){this.anyWindowOpen()?application.once("windowsClosed",e):e()},Windows.prototype.waitWindow=function(i){var o=this;return new Promise(function(t){var e=function e(){o.views[0]&&o.views[0]instanceof i&&(application.off("windowOpened",e),t())};application.on("windowOpened",e),e()})};var TexturePack=function(e,t){this.image=t,this.textures={};for(var i=0;i<e.frames.length;i++){var o=_Figure.scaleImages[t];this.textures[e.frames[i].filename]={x:e.frames[i].frame.x*o,y:e.frames[i].frame.y*o,width:e.frames[i].frame.w*o,height:e.frames[i].frame.h*o,spriteSourceSize:{x:e.frames[i].spriteSourceSize.x*o,y:e.frames[i].spriteSourceSize.y*o},widthRatio:e.frames[i].frame.w/e.frames[i].sourceSize.w,heightRatio:e.frames[i].frame.h/e.frames[i].sourceSize.h}}};TexturePack.prototype.draw=function(e,t,i,o,a,n){var r=_Figure.imageByFilename(this.image);if(r){var s=this.textures[n];e.drawImage(r,s.x,s.y,s.width,s.height,t+s.spriteSourceSize.x,i+s.spriteSourceSize.y,o*s.widthRatio,a*s.heightRatio)}};var PreloadTask=Backbone.Model.extend({defaults:{parent:null,runned:!1,preloaded:0,preloadAmount:1,finish:!1},run:function(){this.trigger("run",this),void 0===this.get("task")&&console.log(this),0===this.get("preloadAmount")?this.done():this.get("task")(_.bind(this.doneSimpleTask,this))},doneSimpleTask:function(){this.get("preloaded")<this.get("preloadAmount")&&(this.set("preloaded",this.get("preloaded")+1),this.get("preloaded")==this.get("preloadAmount")&&this.done())},done:function(){this.trigger("done",this)}}),Preloader=Backbone.Collection.extend({model:PreloadTask,resourceStatus:{},closePrePreloader:function(){clearInterval(window.prepreloadInterval),$("#prePreloadPage").remove(),$(".containerApplication").show()},calcPercent:function(){var t=0,i=0;this.each(function(e){t+=e.get("preloadAmount"),i+=e.get("preloaded")}),this.trigger("percent",Math.floor(i/t*100))},preloadCss:function(e,t){if(!e)return window.manualLogError("preloadCss css=undefined"),void t();var i="stylesheet",o=$('<link rel="'+i+'" type="text/css" href="'+e+'" />'),a=_.once(t);o.load(a).error(function(){a()}),$("head").append(o),setTimeout(a,5e3)},updateCss:function(){},loadSounds:function(e,t,a){var i=function(e){var t=e.substr(e.lastIndexOf("/")+1);return t.substr(0,t.indexOf("."))},o={};_.each(t,function(e){o[i(e)]=[e]}),_.each(e,function(e){o[i(e)]=_.union(o[i(e)],[e])});var n=[],r=this;_.each(o,function(e,t){var i="sound_"+t;if(r.resourceStatus[i])a();else{var o=e[0];0<=e[1].indexOf(".ogg")&&(o=e[1]),r.resourceStatus[i]=Preloader.BEGIN_PRELOAD,n.push({id:t,src:o}),soundManager.load(t,o,function(){r.resourceStatus[i]=Preloader.FINISH_PRELOAD,a()})}}),createjs.Sound.registerManifest(n)},preloadJs:function(e,t){var i=document.createElement("script"),o=!1;i.src=e,i.async=!0,i.onload=i.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,i.onload=i.onreadystatechange=null,i&&i.parentNode&&(i.parentNode.removeChild(i),t()))},document.head.appendChild(i)},preloadTexturePacks:function(i,o){if(void 0===i||this.resourceStatus[i])o();else{this.resourceStatus[i]=Preloader.BEGIN_PRELOAD;var a=this;$.getJSON(i,function(e){var t=i.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")+"/"+e.meta.image;a.figureRuleImages.push(t),_Figure.textureCache[i]=new TexturePack(e,t),t&&(a.preloadImage(t,o),a.resourceStatus[i]=Preloader.FINISH_PRELOAD)})}},preloadImage:function(e,t,i,o){if(void 0===e||this.resourceStatus[e])t();else{var a=e;o&&(a+="?rnd="+Math.floor(1e6*Math.random())),this.resourceStatus[e]=Preloader.BEGIN_PRELOAD;var n=this,r=new Image;r.onload=function(){n.resourceStatus[e]=Preloader.FINISH_PRELOAD,_.contains(n.figureRuleImages,e)&&_Figure.preloadImage(e,r),t(),r=void 0},r.onerror=function(){(n.resourceStatus[e]=void 0)===i||i<=2?setTimeout(function(){n.preloadImage(e,t,(i||0)+1,!0)},5e3):(window.manualLogError("Can't load resource: '"+e+"'"),fail())},r.src=a}},getFeatureStatus:function(e){var t="feature_"+e;return this.resourceStatus[t]},preloadFeature:function(e,t){var i="feature_"+e;if(this.resourceStatus[i])t();else{this.resourceStatus[i]=Preloader.BEGIN_PRELOAD;var o=soundFeatures[e]||{mp3:[],ogg:[]},a=imageFeatures[e]||[],n=this;Episode.cacheResources(a,[],o,[],function(){n.resourceStatus[i]=Preloader.FINISH_PRELOAD,t()})}},run:function(){var t=_.bind(function(){this.process()},this);if("undefined"==typeof deviceType||1!=deviceType||null!=winDesktop){var e=[];createjs.FlashPlugin.swfPath="wizq"===network?baseUrl+"../../base/site/lib/createjs-old/":"../../../base/site/lib/createjs-old/",createjs.Sound.alternateExtensions=["mp3"];var i="mobage"==network||"mixi"==network||"yahoojp"==network||"wizq"==network||"nk"==network||"hangame"==network;if(e="Firefox"!==application.system.browser||i?[createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]:[createjs.FlashPlugin,createjs.WebAudioPlugin,createjs.HTMLAudioPlugin],createjs.Sound.registerPlugins(e),null===createjs.Sound.activePlugin&&soundManagerFailed(),createjs.Sound.activePlugin instanceof createjs.FlashPlugin){var o=0;!function e(){createjs.Sound.activePlugin.flashReady?t():o<3?(++o,setTimeout(e,100)):(createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin]),t())}()}else t()}else t()},filterResourceByQuality:function(e){var t=/@.{1,4}[.]/i,i=_.filter(e,function(e){return t.test(e)}),o=_.object(_.map(i,function(e){return e.replace(/@.+[.]/,".")}),!0);return _.filter(e,function(e){var t=e.replace(/@.+[.]/,".");return!o.hasOwnProperty(t)||(!Config.imageQuality&&e==t||!!Config.imageQuality&&-1!=e.indexOf("@"+Config.imageQuality+"."))})},process:function process(){this.each(function(e){"string"==typeof e.get("parent")&&e.set("parent",this.findWhere({name:e.get("parent")}))},this),imagesToPreload=this.filterResourceByQuality(imagesToPreload),preloadImages=this.filterResourceByQuality(preloadImages),this.on("change:preloaded",this.calcPercent,this),this.on("done",function(e){void 0!==firstSessionLogger&&firstSessionLogger.logEvent(e.get("name")),e.set("finish",!0);var t=this.where({parent:e});_.each(t,function(e){e.set("parent",null)}),0===this.where({finish:!1}).length?this.trigger("complete"):this.runTasks()},this);var preloadPageTask=new PreloadTask({name:"preloadPage"});this.figureRuleImages=[],void 0!==FigureRules&&_.each(FigureRules,_.bind(function(e){_.isFunction(e)||_.each(e,_.bind(function(e){e.params["background-image"]&&this.figureRuleImages.push(e.params["background-image"])},this))},this)),void 0!==FigureAnimations&&_.each(FigureAnimations,_.bind(function(e){if(!_.isFunction(e)){_.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){var i=e[t];i.params["background-image"]&&this.figureRuleImages.push(i.params["background-image"])}}},this)),this.figureRuleImages=_.sortBy(this.figureRuleImages,_.identity),this.figureRuleImages=_.uniq(this.figureRuleImages,!0),preloadPageTask.set("task",_.bind(function(e){var t;for(t=0;t<preloadImages.length;t++)application.preloader.preloadImage(preloadImages[t],e);for(t=0;t<window.beginCSSFiles.length;t++)application.preloader.preloadCss(window.beginCSSFiles[t],e);application.preloader.loadSounds(preloadSounds.mp3,preloadSounds.ogg,e)},preloadPageTask));var touchTask=!1;preloadPageTask.on("done",function(){application.preloader.updateCss(),application.preloader.closePrePreloader(),!1===touchTask?application.preloader.trigger("loaded"):application.set("page","clickToPreloadPage")}),preloadPageTask.set("preloadAmount",preloadImages.length+preloadSounds.ogg.length+window.beginCSSFiles.length),this.add(preloadPageTask),!window.mobile||"phonegap"==network||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/Chrome/i)||(touchTask=new PreloadTask({name:"touchTask",parent:preloadPageTask}),touchTask.set("task",function(e){$("#clickToPreloadPage").show(),$("#clickToPreloadPage").on("touchstart click",function(){$("#clickToPreloadPage").off(),application.preloader.trigger("loaded"),e()})}),this.add(touchTask));var resourcesTask=new PreloadTask({name:"resources",parent:!1===touchTask?preloadPageTask:touchTask}),firstTask=this.findWhere({name:"authorization"});if(firstTask){for(;firstTask.get("parent");)firstTask=firstTask.get("parent");firstTask.set({parent:!1===touchTask?preloadPageTask:touchTask})}resourcesTask.set("task",_.bind(function(e){var t;for(t=0;t<imagesToPreload.length;t++)application.preloader.preloadImage(imagesToPreload[t],e);application.preloader.loadSounds(soundsToPreload.mp3,soundsToPreload.ogg,e)},resourcesTask)),resourcesTask.set("preloadAmount",imagesToPreload.length+soundsToPreload.ogg.length),this.add(resourcesTask),void 0!==Config&&void 0!==Config.preloadTasks&&_.each(Config.preloadTasks,function(preloadTaskClassName){var classObj=eval(preloadTaskClassName),task=new classObj;task.get("parentName")&&task.set("parent",this.findWhere({name:task.get("parentName")})),this.add(task)},this),this.runTasks()},runTasks:function(){var e=this.where({parent:null,runned:!1});_.each(e,function(e){e.set("runned",!0)}),_.each(e,function(e){e.run()})}},{BEGIN_PRELOAD:1,FINISH_PRELOAD:2,Config:{registerCell:function(e,i){var o=this;_.each(e.split(""),function(e){var t="map_"+e;o[t]||(o[t]=[]),o[t].push(i)})}}}),AsyncCache=function(e){this.loader=e,this.cache={}};AsyncCache.prototype.get=function(t,i,e){return void 0!==this.cache[t]?(i(this.cache[t]),!1):(this.loader(t,_.bind(function(e){this.cache[t]=e,i(this.cache[t])},this),e),!0)},AsyncCache.prototype.set=function(e,t){this.cache[e]=t},AsyncCache.prototype.inCache=function(e){return void 0!==this.cache[e]},AsyncCache.prototype.changeSubValue=function(e,t,i){this.cache[e][t]=i};var Result=Backbone.Model.extend({initialize:function(){this.set("photo",application.USERS[this.id].photo),this.set("name",application.USERS[this.id].first_name)}}),Bot=Result.extend({initialize:function(){}}),Results=Backbone.Collection.extend({model:Result,addBots:function(){_.each(Bots,function(e){this.add(new Bot(e))},this)},comparator:function(e){return-e.get("score")}}),StripModelItem=Backbone.Model.extend({defaults:{id:"",checked:!1,action:function(){},update:function(){},processed:!1},initialize:function(){this.set("checked",!!localStorage.getItem("strip_"+this.get("id"))),this.on("change:checked",function(){this.get("checked")&&localStorage.setItem("strip_"+this.get("id"),"1")},this),this.update()},update:function(){this.get("update").call(this);var e=setInterval(_.bind(function(){this.get("checked")?clearInterval(e):!this.get("processed")&&application.windows.isOpen(StripWindow)&&this.get("update").call(this)},this),3e3)}}),StripModel=Backbone.Collection.extend({Model:StripModelItem,initialize:function(){this.revarded=!1,this.on("change:checked",function(e,t){this.isCompleted()&&this.trigger("complete")},this)},getRevard:function(){if(this.isCompleted()&&!this.revarded){this.revarded=!0;var e=user.get("strip");return user.set({stripRevard:!0,strip:e+1,coins:new ObscureNumber(user.get("coins")+Number(Config.stripBonus[e])),actionName:"strip"+(e+1)+" complete",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0}),!0}return!1},isCompleted:function(){return this.every(function(e){return e.get("checked")})},getCompleteCount:function(){return this.where({checked:!0}).length}}),stripModel1=function(){return[new StripModelItem({id:"install",update:function(){this.set("checked",!0)}}),new StripModelItem({id:"status",action:function(){promo1(_.bind(function(){this.set("checked",!0)},this))},update:function(){checkPromo1(_.bind(function(e){e&&this.set("checked",!0)},this))}}),new StripModelItem({id:"group",action:function(e){-1!==["wizq","facebook","mobage","yahoo","mixijp"].indexOf(network)&&"A"===e.target.tagName&&this.set("checked",!0)},editHtml:function(){$("a").attr("href",officialGroupUrl)},update:function(){this.get("checked")||(this.set("processed",!0),inOfficialGroup(_.bind(function(e){this.set("processed",!1),this.set("checked",e)},this)))}}),new StripModelItem({id:"friend",action:function(){user.inviteBestFriends()},update:function(){2<=friends.length&&this.set("checked",!0)}})]},stripModel2=function(){return[new StripModelItem({id:"episode1done",update:function(){this.set("checked",!0)}}),new StripModelItem({id:"gifttofriend",action:function(){var t=user.getRandomFriendForGift();if(!1!==t){var e=RANDOM(messages.sendGift);socialNetwork.sendRequest({type:"giftSent",userIds:t,message:e[user.get("gender")],success:_.bind(function(){var e=[t];e&&e.length&&(user.selectedForGifts=_.difference(user.selectedForGifts,e),user.set("sometimeMakeAGift",1),callServiceAddInQueue("../../../levelbase/src/services/sendgifts.php",{userIds:e.join(","),fromAddMoves:1}),this.set("checked",!0))},this),veryImportant:!0})}},update:function(){(user.get("sometimeMakeAGift")||0===user.selectedForGifts.length)&&this.set("checked",!0)}}),new StripModelItem({id:"shareadlink",action:function(){promo2(_.bind(function(){this.set("checked",!0)},this))},update:function(){checkPromo2(_.bind(function(){this.set("checked",!0)},this))}}),new StripModelItem({id:"fivefriends",action:function(){user.inviteBestFriends()},update:function(){5<=friends.length&&this.set("checked",!0)}})]},TWindow=Backbone.View.extend({events:{"click .close":"close"},canOpenNow:function(){return!0},onOpenSound:"showwindow",fadeDuration:200,initialize:function(e){this.options=e||{},application.beforeGameStart&&!this.ignoreBeforeGameStart||(this.closed=this.shown=!1,this.once("open",this.open,this),application.windows.add(this,this.options))},onOpen:function(){void 0!==this.options.onOpen&&this.options.onOpen.call(this)},shadowOpenAnimation:function(){window.mobile?$("#windowShadow").show():$("#windowShadow").is(":visible")?$("#windowShadow").stop().clearQueue().ourAnimate({opacity:1},this.fadeDuration):$("#windowShadow").stop().clearQueue().fadeIn(this.fadeDuration)},shadowCloseOpenAnimation:function(){application.windows.anyVisibleWindow()||(window.mobile?$("#windowShadow").hide():$("#windowShadow").stop().clearQueue().fadeOut(this.fadeDuration))},openAnimation:function(){this.$el.show().addClass("visible").removeClass("hidden")},closeAnimation:function(e){this.$el.removeClass("visible").addClass("hidden"),setTimeout(e,window.mobile?0:300)},open:function(){this.options.templateClass&&(this.templateClass=this.options.templateClass);var e=$(this.templateClass);if(0===e.length)throw new Error("Template "+this.templateClass+" not found.");this.setElement($(e.html())),$(".wrapper").append(this.$el),this.onOpen(),this.show()},show:function(){this.shown||(application.trigger("windowShow",this),this.onOpenSound&&application.playSound(this.onOpenSound),this.shadowOpenAnimation(),this.shown=!0,this.$el.css({"margin-left":-this.$el.outerWidth()/2,"margin-top":-this.$el.outerHeight()/2}),$("#container,#mainAppWrapper").addClass("window-open window-"+this.$el.attr("id")),this.openAnimation())},hide:function(e){this.shown&&(this.shown=!1,this.closeAnimation(_.bind(function(){$("#container,#mainAppWrapper").removeClass("window-open window-"+this.$el.attr("id")),this.shadowCloseOpenAnimation(),e&&e()},this)))},close:function(){this.closed||(this.closed=!0,this.stopListening(),this.undelegateEvents(),this.shown?this.closeAnimation(_.bind(function(){$("#container,#mainAppWrapper").removeClass("window-open window-"+this.$el.attr("id")),this.shadowCloseOpenAnimation(),application.windows.remove(this),this.onClose(),this.remove()},this)):(application.windows.remove(this),this.onClose(),this.remove()),this.trigger("close"),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0))},onClose:function(){void 0!==this.options.onClose&&this.options.onClose()},rememberCheckboxState:function(){this.needPublic?user.unset("checkboxOff"+this.templateClass):user.set("checkboxOff"+this.templateClass,!0)},applyCheckboxState:function(){"function"==typeof this.onPublicCheckbox&&"function"==typeof this.offPublicCheckbox&&(user.has("checkboxOff"+this.templateClass)?this.offPublicCheckbox():this.onPublicCheckbox())}}),Episode=Backbone.Model.extend({initialize:function(){user.on("change:bonusLevelDoneEpisode",function(e,t){t==this.get("num")&&(changeLocalStorageValue("myr_"+t,{scores:[],bonusLevelFinished:0},1,"bonusLevelFinished"),this.cachedEpisodes.get(this.get("num"),_.bind(function(e){e.about.bonusLevel.finished=!0,this.cachedEpisodes.changeSubValue(this.get("num"),"about",e.about)},this)))},this),this.cachedEpisodes=new AsyncCache(function(n,r,e){var s={},t=function(){var t=function(){var i=[],e=[];window.mobile&&void 0!==s.about.mobileResources&&0<s.about.mobileResources.length?(i=s.about.mobileResources||[],e=s.about.mobileSpineResources||[]):(i=s.about.resources||[],e=s.about.spineResources||[]);var o=[],a={mp3:[],ogg:[]},t=("episode"+n).match(/\D*/)[0];csssnowball["episode"+n]?(o.push(csssnowball["episode"+n]),csssnowball["episode"+n]=void 0):csssnowball[t]&&(o.push(csssnowball[t]),csssnowball[t]=void 0),_.each(function(){var e,t=[];if(Config.bonusWorld&&Config.bonusWorld.name===n){for(e=1;e<=Config.bonusWorld.get("episode");e++)t.push(e);return t.push(n),t}for(e=1;e<=n;e++)t.push(e);return t}(),function(e){if(snowball["episode"+e]&&(i=i.concat(snowball["episode"+e]),snowball["episode"+e]=void 0),_.isNumber(e)){var t=10*Math.floor(e/10)+"-"+(10*(Math.floor(e/10)+1)-1);csssnowball["episodes"+t]&&(o.push(csssnowball["episodes"+t]),csssnowball["episodes"+t]=void 0)}else csssnowball["episode"+e]&&(o.push(csssnowball["episode"+e]),csssnowball["episode"+e]=void 0);soundssnowball["episode"+e]&&(a.mp3=a.mp3.concat(soundssnowball["episode"+e].mp3),a.ogg=a.ogg.concat(soundssnowball["episode"+e].ogg),soundssnowball["episode"+e]=void 0)}),Episode.cacheResources(i,o,a,e,function(){if("forcelevel"!==n){var e=function(e){var t=Config.levelsInEpisode;Config.bonusWorld&&Config.bonusWorld.name===n&&Config.bonusWorld.levelsInEpisode&&(t=Config.bonusWorld.levelsInEpisode);for(var i=1;i<=t;i++)e[i]?application.levelResultsCache.set(n+"_"+i,e[i]):application.levelResultsCache.set(n+"_"+i,[]);Config.bonusWorld&&Config.bonusWorld.get("name")===n?Config.bonusWorld.preloadEpisode(s,function(){r(s)}):r(s)},t=friends.filter(function(e){return!(e.id==user.get("userId")||!(_.isString(n)||e.get("episode")>=n))}),i=_.pluck(t,"id");0<(i=i.slice(0,Math.min(i.length,100))).length?callServiceOrLocalStorage("../../../levelbase/src/services/episoderesults.php",e,{friends:i.join(","),episode:n},"fr_"+n,[]):e([])}else r(s)})};if(s.scores=[],"string"==typeof n&&"forcelevel"!==n||n<=user.get("episode")){var e=0;void 0!==s.about.bonusLevel&&(e=1);var i=_.max(_.map(_.keys(s.levels),function(e){return parseInt(e)}));callServiceOrLocalStorage("../../../levelbase/src/services/loadmyepisodescores.php",function(e){e.bonusLevelFinished&&(s.about.bonusLevel.finished=!0),s.scores=e.scores,t()},{episode:n,checkBonusLevel:e,levelsInEpisode:i},"myr_"+n,{scores:[],bonusLevelFinished:0})}else t()},i=Config.bonusWorld&&Config.bonusWorld.get("name")===n;!i||i&&Config.bonusWorld.get("includeLevels")?loadLevelJSON({about:episodesData[n].about,levels:episodesData[n].levels}).then(function(e){s.about=e.about,s.levels=e.levels,t()}):(s.about={},s.levels={},t())}),this.scores=new Scores,this.prizes=new Prizes,this.scores.on("change:score",this.updateScoresInCache,this),this.scores.on("reset",this.updateScoresInCache,this),this.scores.on("add",this.updateScoresInCache,this),this.episodeCollectionController=new EpisodeCollection.EpisodeCollectionController,this.episodeCollectionDropper=new EpisodeCollection.EpisodeCollectionDropper,this.episodeCollectionDropper.on(this.episodeCollectionDropper.event,function(e){this.episodeCollectionController.get("externalDropper")||this.episodeCollectionController.addItem(e)},this),this.on("change:episodeCollection",function(e,t){this.episodeCollectionDropper.set("collection",t),this.episodeCollectionController.set("collection",t)},this)},backToFirstLevel:function(){this.trigger("backToFirstLevel"),this.scores.reset()},levelsInEpisode:function(){var e=Config.levelsInEpisode;return this.isBonusWorld()&&(Config.bonusWorld.get("levelsInEpisode")?e=Config.bonusWorld.get("levelsInEpisode"):Config.bonusWorld.levelsInEpisode&&(e=Config.bonusWorld.levelsInEpisode)),e},updateScoresInCache:function(){setTimeout(_.bind(function(){this.cachedEpisodes.changeSubValue(this.get("num"),"scores",this.scores.toJSON())},this),0)},absoluteLevelNumber:function(e){return this.isBonusWorld()?Config.bonusWorld.absoluteLevelNumber(e):(this.get("num")-1)*Config.levelsInEpisode+1*e},loaded:function(e){return this.cachedEpisodes.inCache(e)},getWorld:function(){if(Config.bonusWorld.name===this.get("num"))return Config.bonusWorld},isBonusWorld:function(){return!!Config.bonusWorld&&Config.bonusWorld.name===this.get("num")},isFreeEpisode:function(){return!!Config.bonusWorld&&(Config.bonusWorld.name===this.get("num")&&Config.bonusWorld.get("isFreeEpisode"))},isEpisodeOrFreeEpisode:function(){return!this.isBonusWorld()||this.isFreeEpisode()},isForceEpisode:function(){return"forcelevel"===this.get("num")},isFinished:function(){return user.get("episode")>this.get("num")||user.get("episode")===this.get("num")&&user.get("level")>this.levelsInEpisode()},isCurrent:function(){return Config.lockEpisodeShow?user.get("episode")==this.get("num")&&user.get("level")<=this.levelsInEpisode()||user.get("episode")+1==this.get("num")&&user.get("level")>this.levelsInEpisode():user.get("episode")==this.get("num")},isLocked:function(){return this.get("num")>user.get("episode")},beefUpLevels:function(){var e=this.get("levels");for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i.cellAttribute=this.beefUpLevelLayer(i.cellAttribute,"."),i.cellSecondAttribute=this.beefUpLevelLayer(i.cellSecondAttribute||[[]],"."),i.decorators=this.beefUpLevelLayer(i.decorators,"."),i.floorAttribute=this.beefUpLevelLayer(i.floorAttribute,"0"),i.map=this.beefUpLevelLayer(i.map," ")}},load:function(l,d,e){var c=_.isNumber(l)?l:this.get("num");return this.trigger("episodeStartLoad"),this.cachedEpisodes.get(l,_.bind(function(e){var t;if(Config.needShowEpisodes){var i="#levelsBlock"+((c-1)%Config.needShowEpisodes+1);episodeView.setElement(i),episodeView.scoresView.setElement(i),episodeView.prizesView.setElement(i)}var o=e.about.episodeCollection;if(this.set({levels:e.levels,about:e.about,episodeCollection:o}),this.beefUpLevels(),this.backToFirstLevelSound=void 0,this.isBonusWorld()&&Config.bonusWorld.backToFirstLevelAfterFail)for(this.backToFirstLevelSound=Config.bonusWorld.backToFirstLevelSound,t=0;t<e.scores.length;t++)if(0===e.scores[t].score){callServiceAddInQueue("../../../levelbase/src/services/removescores.php",{episode:l}),e.scores=[];break}if(user.get("episode")>=l&&(!Config.bonusWorld||Config.bonusWorld.name!==l)){var a=Config.levelsInEpisode;for(user.get("episode")==l&&(a=user.get("level")-1),t=0;t<e.scores.length;t++)e.scores[t].level>a&&(a=e.scores[t].level);for(var n=1;n<=a;n++){var r=!1;for(t=0;t<e.scores.length;t++)if(e.scores[t].level==n){r=!0;break}r||e.scores.push({level:n,score:50})}}if(this.scores.reset(e.scores),this.set("num",l),this.patchUserLevel(),!this.isBonusWorld()){var s=e.about.prizes||Config.prizes||[];this.prizes.reset(s)}void 0!==MapBonusLevel&&(this.bonusLevel&&this.bonusLevel.view&&(this.bonusLevel.set("removed",!0),this.bonusLevel.off(),this.bonusLevel.view.clear(),this.bonusLevel.stopRefreshInterval()),this.bonusLevel=new MapBonusLevel,this.bonusLevel.init(e.about.bonusLevel)),fixOperaAnimation(),void 0!==d?(d(),this.trigger("episodeLoaded")):Config.needShowEpisodes&&this.trigger("episodeLoaded")},this),_.bind(function(){void 0!==e&&e()},this))},beefUpLevelLayer:function(e,i){for(e[0].length<Config.rows&&(e=e.map(function(e){for(var t=e.length;t<Config.rows;++t)e+=i;return e}));e.length<Config.cols;){for(var t="",o=t.length;o<Config.cols;++o)t+=i;e.push(t)}return e},getNum:function(){var e=this.get("num");return Config.bonusWorldsEpisodesNum&&_.isString(e)&&Config.bonusWorldsEpisodesNum[e]?Config.bonusWorldsEpisodesNum[e]:e},getNumForStatistics:function(){var e=this.get("num");return Config.bonusWorldsEpisodesNum&&_.isString(e)&&Config.bonusWorldsEpisodesNum[e]?Config.bonusWorldsEpisodesNum[e]:e},patchUserLevel:function(){this.get("num")===user.get("episode")&&user.get("level")<=this.scores.length&&user.set("level",this.scores.length+1)},isSpecialLevel:function(e){var t=this.get("about");return Boolean(Config.specialLevels&&Config.specialLevels.enabled&&t.specialLevels&&-1!=t.specialLevels.indexOf(e))},getSpecialLevels:function(){return Config.specialLevels&&Config.specialLevels.enabled&&this.get("about").specialLevels||[]},getEpisodeName:function(){return _.isNumber(this.get("num"))?"episode"+this.get("num"):this.get("num")},playLevel:function(e,t){var i=this;if(gameView.gameStarted)return!1;if(this.isBonusWorld()){if(Config.bonusWorld.get("actionQueue").canAction()&&!(application.windows.views[0]instanceof BaseForceView))return!1;if(e>this.levelsInEpisode())return!1;if(e>Config.bonusWorld.getCurrentLevel()&&!Config.bonusWorld.get("isFreeEpisode"))return!1;if(Config.bonusWorld.levelCheckAvailable)return Config.bonusWorld.levelCheckAvailable(e,function(e){return i.launchLevel(e,t)}),!1}else if(this.get("num")>user.get("episode")||this.get("num")==user.get("episode")&&e>user.get("level"))return!1;this.launchLevel(e,t)},launchLevel:function(e,t){var i=t&&t.showStatistics,o=t&&t.showWithoutResult,a=this.scores.findWhere({level:e});if((a||o)&&i)new StatisticBeforeWindow({level:e,score:a?a.get("score"):0,stars:a?a.get("stars"):0});else if(application.hasComponent(StagePowerupMakerComponent)&&!this.isBonusWorld()){var n=this.get("levels")[e];new StartLevelWindow({level:e,absoluteLevel:user.getCurrentLevel(),launchOptions:t,levelData:n,episode:this})}else gameView.start(e,t)}},{cacheResources:function(e,t,i,o,a){if(0!==e.length+i.ogg.length+t.length){var n=e.filter(function(e){return-1!==e.indexOf(".png")}),r=e.filter(function(e){return-1!==e.indexOf(".json")}),s=_.after(n.length+r.length+i.ogg.length+t.length+o.length,function(){0<t.length&&application.preloader.updateCss(),a()});if(_.each(r,function(e){application.preloader.preloadTexturePacks(e,s)}),_.each(n,function(e){application.preloader.preloadImage(e,s)}),application.preloader.loadSounds(i.mp3,i.ogg,s),_.each(t,function(e){application.preloader.preloadCss(e,s)}),spine&&spine.AssetManager){var l=new spine.AssetManager;_.each(o,function(e){l.loadText(e,s,s)})}}else a()}}),Friend=Backbone.Model.extend({defaults:{canCollectCoins:!1},initialize:function(){this.set("photo",application.USERS[this.id].photo),this.set("name",application.USERS[this.id].first_name),this.set("gender",application.USERS[this.id].gender),this.set("fullLevel",this.calcFullLevel()),this.on("change:level",function(){this.set("fullLevel",this.calcFullLevel())}),this.on("change:canCollectCoins",function(){this.get("canCollectCoins")||(window.collectCoinsFriendTime[this.id]=application.getCurrentServerTime(),setLocalStorage("collectCoinsFriendTime",window.collectCoinsFriendTime))},this)},calcFullLevel:function(){return this.get("level")+Config.levelsInEpisode*(this.get("episode")-1)}}),Friends=Backbone.Collection.extend({model:Friend,initialize:function(){user.on("change:level",this.updateUser,this)},upFriendsOnLevelWindow:function(){if(1!=user.get("level")&&"main"!=application.get("page")){var e=this.get(user.get("userId")).calcFullLevel()-1;if(!(void 0!==Config.upFriendsNotifMinLevel&&e<Config.upFriendsNotifMinLevel)){for(var t=this.where({fullLevel:e}),i=[],o=0;o<t.length;o++)t[o].id!==user.get("userId")&&i.push(t[o].id);0<i.length&&application.once("main",function(){new LevelOvertakenWindow({uids:i})})}}},updateUser:function(){this.get(user.get("userId")).set({level:user.get("level"),episode:user.get("episode")}),this.upFriendsOnLevelWindow(),this.sort()},comparator:function(e){return-e.get("fullLevel")}}),BoosterTypes={Shuffle:"Shuffle",DeleteColumn:"DeleteColumn",DeleteRow:"DeleteRow",DeleteCell:"DeleteCell"},UserPrize=Backbone.Model.extend({defaults:{type:"coins",name:"",amount:1,cssClass:""}}),GoodTypes={unlimitedLifes:"unlimitedLifes",starInField:"starInField",addThreeMoves:"addThreeMoves",unlimitedKeys:"unlimitedKeys",unlimitedFirstBonusWorldLives:"unlimitedFirstBonusWorldLives",unlimitedBonusWorldLives:"unlimitedBonusWorldLives",unlimitedBonusWorldLives2:"unlimitedBonusWorldLives2",unlimitedBonusWorldLives3:"unlimitedBonusWorldLives3"},UserPrizes=Backbone.Collection.extend({model:UserPrize,constructor:function(e,t){Backbone.Collection.call(this,(e||[]).filter(function(e){if("tickets"===e.type)if(e.world){var t=application.getWorldByName(e.world);if(!t||!t.hasComponent(TicketsComponent))return!1}else if(!application.hasComponent(TicketsComponent))return!1;return"IntegrationEventPrize"!==e.type||e.networks.some(function(e){return e===network})})),this.actionName=t},getComponent:function(e,t){var i=e.get("world")?e.get("world"):Config.bonusWorld;return _.isString(i)&&(i=application.getWorldByName(i)),i?i.getComponent(t):(console.error("     "+e.get("type")+" "+e.get("world")),null)},take:function(e,t,i,o,C,a){var y=this,w=user.get("coins"),v=user.get("spins");this.each(function(e){if(!e.get("tease")){if(e.get("networks"))if("phonegap"===network){if(-1===e.get("networks").indexOf(phonegapNetwork))return}else if("wizq"===network){if(-1===e.get("networks").indexOf(wizqnetwork))return}else if(-1===e.get("networks").indexOf(network))return;if("coins"==e.get("type")&&(w=new ObscureNumber(w.get()+e.get("amount"))),"powerUp"==e.get("type")&&user.setPowerUpAmount(e.get("name"),user.getPowerUpAmount(e.get("name"))+e.get("amount"),!0),"good"==e.get("type")&&goods.goodBuyed(e.get("name"),e.get("amount"),C||!1),"gift"==e.get("type")&&void 0!==Gifts&&Gifts.receiveGift(Gifts.findGiftById(e.get("giftId"))),"spins"===e.get("type")&&(v+=e.get("amount")),"tickets"===e.get("type")){var t=null;if(e.get("world")){var i=application.getWorldByName(e.get("world"));i?t=i.getComponent(TicketsComponent):console.error("     "+e.get("world"))}else t=application.getComponent(TicketsComponent);t&&t.addTickets(e.get("amount"))}if("PrizePointsProduct"===e.get("type")){var o=y.getComponent(e,PrizeController);o&&o.addPoints(e.get("amount"))}if("TicketsProduct"===e.get("type")){var a=y.getComponent(e,e.get("componentId"));a&&a.addTickets(e.get("amount"))}if("GiftAbilityProduct"===e.get("type")){var n=y.getComponent(e,"trinkets");if(n)for(var r=0;r<e.get("amount");++r){var s=n.getTrinkets().find(function(e){return 0===e.getAmount()});s&&s.addAmount(1)}else 0}if("PartProduct"===e.get("type")){var l=y.getComponent(e,"parts");if(l){var d=l.getPartById(e.get("partId"));d&&d.addAmount(e.get("amount"))}else 0}if("ExactArtifactPartProduct"===e.get("type")){var c="string"==typeof e.get("world")?application.getWorldByName(e.get("world")):e.get("world");if(c&&c.artifactController){var g=c.artifactController.getArtifactWorkshop();g.receiveExactPart(e.get("partId")),g.save()}else if(c&&c.getComponent("parts")){var u=c.getComponent("parts").getParts().get(e.get("partId"));u&&u.addAmount(e.get("amount"))}else 0}if("episodeCollectionPart"===e.get("type")&&e.get("world")&&episode.get("num")===e.get("world")){var h=episode.episodeCollectionController;h&&h.addItem(e.get("partId"),e.get("amount"))}if("IntegrationEventPrize"===e.get("type")&&e.get("networks").some(function(e){return e===network})&&socialNetwork.addIntegrationEvent(e.get("eventType")).then(function(){console.log("[IntegrationEventProduct] success")}).catch(function(e){throw console.error("[IntegrationEventProduct] error ",e),e}),"ContinuityStageProduct"===e.get("type")){var p=y.getComponent(e,"continuity");if(p)application.getWorldByName(e.get("world")).get("actionQueue").push({run:function(){return p.giveReward(e.get("stage"))}},ActionQueue.Priority.low);else 0}if("PrizePoolProduct"===e.get("type")){var m=e.get("prizePool");if(m){application.getWorldByName(e.get("world"));m.givePrize(e.get("prizeId"))}else console.error("    ")}if("RollStockProduct"===e.get("type")){var f=y.getComponent(e,e.get("componentId")||"diceRoller");f&&f.set("rollStock",f.get("rollStock")+e.get("amount"))}"prolong"===e.get("type")&&(e.get("world")&&e.get("world").cmp("prolongate")?e.get("world").cmp("prolongate").prolongate():console.error("    ,       ."))}}),user.set(_.assign({spins:v,powerUps:user.calcPowerUps(),coins:w,actionName:e||this.actionName||"userprize",actionEpisode:void 0===t?user.get("episode"):t,actionLevel:void 0===i?user.get("level"):i,actionPrice:o||0},a))},prepare:function(){var r=[];return this.each(function(e){if("RandomArtifactPartProduct"===e.get("type")){var t=e.get("world"),i=t.cmp("parts").getParts(),o=util.randomChance(e.get("parts").map(function(e){return e.chance})),a=i.at(o).get("material"),n=RANDOM(i.filter(function(e){return e.get("material")===a}));r.push({type:"ExactArtifactPartProduct",world:t,partId:n.get("id")})}else r.push(e)}),Promise.resolve(r)}},{convertFromCocos:function(e){var t={DeleteCell:"deleteCellPowerUp",DeleteColumn:"lightingPowerUp",DeleteRow:"deleteRowPowerUp",Shuffle:"shufflePowerUp"};return e.products.map(function(e){switch(e.type){case"CoinsProduct":e.type="coins",e.cssClass="coinsbonuswindow";break;case"BoosterProduct":e.type="powerUp",e.cssClass=t[e.boosterId],e.name=t[e.boosterId];break;case"GoodProduct":e.type="good",e.cssClass=e.goodId,e.name=e.goodId;break;case"SpinProduct":e.type="spins",e.name="spins",e.cssClass="spins";break;case"ExactArtifactPartProduct":e.type="ExactArtifactPartProduct",e.name="ExactArtifactPartProduct"+e.partId,e.cssClass="part"+e.partId;break;case"PartProduct":e.type="PartProduct",e.name="PartProduct"+e.partId,e.cssClass="part"+e.partId;break;case"ContinuityStageProduct":e.type="ContinuityStageProduct",e.name="ContinuityStageProduct"+e.stage,e.cssClass="ContinuityStageProduct"+e.stage;default:e.cssClass=e.type}return e.amount=e.addTime?duration(e.addTime)/3600:e.amount,e})}}),Prize=Backbone.Model.extend({defaults:{type:"SimplePrize",active:!0},constructor:function(e){e.products=new UserPrizes(UserPrizes.convertFromCocos(e)),Backbone.Model.call(this,e)},take:function(){var e=this;return this.get("active")?Promise.resolve().then(function(){return e.get("products").take(e.getName())}):Promise.resolve()},getName:function(){return this.get("name")||"userprize"},isActive:function(){return this.get("active")},getUserPrizes:function(){return this.get("products")},getProducts:function(){return this.get("products")},prepare:function(){var t=this;return this.getProducts().prepare().then(function(e){return new Prize({name:t.get("name"),products:e})})}});UserPrizes.sum=function(e){var t,i=(t=[]).concat.apply(t,_toConsumableArray(e)),o=_.map(_.groupBy(i,function(e){return e.get("type")+e.get("name")+(e.get("componentId")||"")}),function(e){return _.assign({},e[0].attributes,{amount:e.map(function(e){return e.get("amount")}).reduce(function(e,t){return e+t})})});return new UserPrizes(o)};var BattlePassPrize=Prize.extend({initialize:function(e){Prize.prototype.initialize.call(this,e),this.get("world")&&(this.onCheckAvailability(),this.listenTo(this.get("world"),"change:hasBattlePass",this.onCheckAvailability))},onCheckAvailability:function(){this.set("active",this.get("world").get("hasBattlePass"))}});Prize.sum=function(){for(var e=[],t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];for(var a=0;a<i.length;++a)e.push(i[a].getProducts().toArray());var n=new Prize({products:[]});return n.set("products",UserPrizes.sum(e)),n},Prize.create=function(e){switch(e.type){case"BattlePassPrize":return new BattlePassPrize(e);default:return new Prize(e)}};var SimplePrizeCreater=function(){function t(e){_classCallCheck(this,t),_.assign(this,e)}return _createClass(t,[{key:"getProducts",value:function(){return this.getPrize().getProducts()}},{key:"getPrize",value:function(){var t=this;return Prize.create(_.assign({},this,{products:this.products.map(function(e){return e.world=t.world,e})}))}},{key:"take",value:function(){return this.getPrize().take()}}]),t}(),ConditionPrizeCreater=function(e){_inherits(i,SimplePrizeCreater);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"getPrize",value:function(){var t=this;return this.condition(this)?Prize.create(_.assign({name:this.name},this.trueVariant,{products:this.trueVariant.products.map(function(e){return e.world=t.world,e})})):Prize.create(_.assign({name:this.name},this.falseVariant,{products:this.falseVariant.products.map(function(e){return e.world=t.world,e})}))}}]),i}(),RandomPrizeCreater=function(e){_inherits(i,SimplePrizeCreater);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"getPrize",value:function(){for(var t=this,e=this;e.variants;)e=e.variants[util.randomChance(e.variants.map(function(e){return e.chance||1}))];return Prize.create(_.assign({},this,{products:e.products.map(function(e){return e.world=t.world,e})}))}}]),i}(),MultiplePrizeCreator=function(e){_inherits(i,SimplePrizeCreater);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"getPrize",value:function(){return Prize.sum.apply(Prize,_toConsumableArray(this.prizes))}}]),i}(),InviteFriend=Friend.extend({initialize:function(){}}),FriendsOnPanel=Backbone.Collection.extend({model:Friend,initialize:function(){this.offset=0,this.size=void 0===Config.friendsPanelSize?6:Config.friendsPanelSize,this.numElements=Math.max(friends.length+2,this.size),window.mobile&&this.size<this.numElements&&(this.size=this.numElements),this.animation=!1,this.frindsForInvite=allUsers.getBestForInvite(),friends.on("sort",this.update,this),friends.on("update",this.update,this)},update:function(){this.reset();for(var e=0;e<this.size;e++)this.add(this.getFriendById(e+this.offset));this.trigger("updateFrend")},getFriendById:function(e){if(this.size<friends.length){if(0===e)return this.makeInvitaion();--e}return e<friends.length?friends.at(e):this.makeInvitaion(e-friends.length)},makeInvitaion:function(e){var t;return t=0===this.frindsForInvite.length?null:e<this.frindsForInvite.length?allUsers.get(this.frindsForInvite[e]):allUsers.get(RANDOM(this.frindsForInvite)),new InviteFriend({friend:t})},stop:function(){this.run=!1},left:function(){0<this.offset&&!this.animation&&(this.run=!0,this.animation=!0,this.offset--,this.pop(),this.unshift(this.getFriendById(this.offset)),this.trigger("left",_.bind(function(){this.animation=!1,this.run&&this.left()},this)))},right:function(){this.offset+this.size<this.numElements&&!this.animation&&(this.run=!0,this.animation=!0,this.offset++,this.shift(),this.push(this.getFriendById(this.offset+this.size-1)),this.trigger("right",_.bind(function(){this.animation=!1,this.run&&this.right()},this)))}}),Strip=Backbone.Model.extend({defaults:{active:!1},calcActive:function(){if("phonegap"!=network){if((!user.get("stripRevard")||!0===Config.renderStripAfterComplete)&&"spmobage"!==network)switch(user.get("strip")){case 0:if(11<=user.get("level")||1<user.get("episode"))return void this.set("active",1);case 1:if(1<user.get("episode"))return void this.set("active",2)}this.set("active",!1)}else 2==user.get("strip")&&"phonegap"!=phonegapNetwork&&Config.mobilePromo&&new MobilePromoDoneWindow},initialize:function(){user.on("change:level",this.calcActive,this),user.on("change:strip",this.calcActive,this)}}),WaitWindow=Backbone.View.extend({el:"#waitWindow",initialize:function(t){application.set("waitWindowLoading",!0),t=t||{},(this.options=t).decrease?this.$el.addClass("decrease"):this.$el.removeClass("decrease"),this.$el.fadeIn(50,_.bind(function(){var e=t.operation;e&&e.call(this,_.bind(this.close,this))},this))},close:function(){this.$el.fadeOut(50),application.unset("waitWindowLoading")}}),rules={CommonRule:function(t){return function(){if(t){if(_.isFunction(t))return t;if(t.maxEpisode){if(t.maxEpisode<user.get("episode"))return!1;if(t.maxLevel&&t.maxEpisode===user.get("episode")&&t.maxLevel<user.get("level"))return!1}if(t.minLevel&&t.minLevel>user.getCurrentLevel())return!1;if(t.maxLevel&&t.maxLevel<user.getCurrentLevel())return!1;if(t.episode){if(t.episode>user.get("episode"))return!1;if(t.level&&t.episode==user.get("episode")&&t.level>user.get("level"))return!1}if(t.beginDate&&t.beginDate.getTime()/1e3>application.getCurrentServerTime())return!1;if(t.endDate&&t.endDate.getTime()/1e3<application.getCurrentServerTime())return!1;if(t.notPaidTimeout&&user.get("paid")){if(user.get("lastPayDate")){var e=util.duration(t.notPaidTimeout);if(application.getCurrentServerTime()-new Date(user.get("lastPayDate")).getTime()/1e3<e)return!1}}else if(void 0!==t.paid&&user.get("paid")!==t.paid)return!1;if(t.network&&-1===t.network.indexOf(network))return!1;if(t.notNetwork&&-1!==t.notNetwork.indexOf(network)){if(!t.notWizqNetwork)return!1;if(t.notWizqNetwork&&-1!==t.notWizqNetwork.indexOf(wizqnetwork))return!1}}return!0}},MinLevel:function(e){return function(){return e>=user.getCurrentLevel()}},NotFullScreen:function(){return function(){return!application.get("view").isFullScreen()}},EveryTimePerSessionRule:function(e){var t=0;return function(){return++t%e==0}},EveryTimePerRule:function(i,o,a){return function(){var e=o(),t=parseInt(e.getItem(a))||0;return++t,e.setItem(a,t.toString()),t%i==0}},EveryDayBonusCollected:function(){return function(){return Boolean(user.get("everydayBonusCollected"))}},NoRewardRule:function(e){throw new Error(" ")},GameOffsetRule:function(e){var t=0;return application.on("afterWin",function(){++t}),function(){return t-e==0}},ForOldUsers:function(e){return function(){return new Date(user.get("dayBeginTime"))<e}},HasBattlePass:function(e){return function(){return e.get("hasBattlePass")}},NoBattlePass:function(e){return function(){return!e.get("hasBattlePass")}},IsSubscribed:function(e){return function(){return socialNetwork.checkSubscription(e)}},IsNotSubscribed:function(e){return function(){return socialNetwork.checkSubscription(e).then(function(e){return!e})}},OrRule:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(){for(var t=!1,e=[],i=0,o=n;i<o.length;i++){var a=(0,o[i])();if(a instanceof Promise)e.push(a.then(function(e){e&&(t=!0)}));else if(a){t=!0;break}}return 0<e.length?Promise.all(e).then(function(){return t}):t}},Rule:function(e){return function(){return e()}}},HttpError=function(e){_inherits(a,_wrapNativeSuper(Error));var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,t)).code=e,i}return _createClass(a)}(),HttpClient=function(){function t(e){_classCallCheck(this,t),this._host=e}return _createClass(t,[{key:"_makeUrl",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this._host+"/"+e,o=[];for(var a in t)o.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return 0<o.length&&(i+="?"+o.join("&")),i}},{key:"getXMLHttpRequest",value:function(){var e=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");return void 0===e.ontimeout&&(e._timeoutId=-1),e}},{key:"get",value:function(o,a){var n=this;return new Promise(function(e,t){var i=n.getXMLHttpRequest();i.open("GET",n._makeUrl(o,a),!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.onload=function(){if(200<=i.status&&i.status<300)return i.responseText?e(JSON.parse(i.responseText)):e(null);t(new HttpError(i.status||500,i.statusText))},i.onerror=function(){t(new HttpError(i.status||500,i.statusText))},i.send()})}},{key:"post",value:function(o){var a=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(e,t){var i=a.getXMLHttpRequest();i.open("POST",a._makeUrl(o,n),!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.onload=function(){if(200<=i.status&&i.status<300)return i.responseText?e(JSON.parse(i.responseText)):e(null);t(new HttpError(i.status||500,i.statusText))},i.onerror=function(){t(new HttpError(i.status||500,i.statusText))},i.send(JSON.stringify(r))})}}]),t}(),HttpClientMethod=function(){function t(e){_classCallCheck(this,t),this._httpClient=e.httpClient,this._path=e.path}return _createClass(t,[{key:"post",value:function(e){return this._httpClient.post(this._path,{},e)}}]),t}(),__awaiter=function(e,r,s,l){return new(s||(s=Promise))(function(i,t){function o(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}n((l=l.apply(e,r||[])).next())})},BundleAnalyticsProvider=function(){function t(e){_classCallCheck(this,t),this._lastId=0,this._maxLastId=1e6,this._maxSize=10,this._connect=e.connect,this._timeout=e.timeout||100,this._maxSize=e.maxSize||10,this._buffer=[]}return _createClass(t,[{key:"logEvent",value:function(i,o){var a=this;return this._time||(this._time=setTimeout(function(){return a._post()},this._timeout)),new Promise(function(e,t){a._buffer.push({resolve:e,reject:t,event:i,properties:o})})}},{key:"_post",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function e(){var i,t,o,a,n,r,s,l,d,c,g,u,h,p=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._time),i={},t=this._buffer.splice(0,this._maxSize).map(function(e){p._lastId>=p._maxLastId&&(p._lastId=0);var t=++p._lastId;return{id:t,name:(i[t]=e).event,data:e.properties}}),e.prev=3,e.next=6,this._connect.post(t);case 6:o=e.sent,a=_createForOfIteratorHelper(o);try{for(a.s();!(n=a.n()).done;)r=n.value,i[r.id]&&(r.success||console.warn("[Analitics] Failed to send event",r,r.error),i[r.id].resolve(),delete i[r.id])}catch(e){a.e(e)}finally{a.f()}for(s in i)i[s].reject();e.next=15;break;case 12:if(e.prev=12,e.t0=e.catch(3),e.t0.code<500){console.warn("[Analitics] Failed to send event",e.t0.message),l=_createForOfIteratorHelper(t);try{for(l.s();!(d=l.n()).done;)c=d.value,i[c.id]&&(i[c.id].resolve(),delete i[c.id])}catch(e){l.e(e)}finally{l.f()}}else{g=_createForOfIteratorHelper(t);try{for(g.s();!(u=g.n()).done;)h=u.value,i[h.id]&&(i[h.id].reject(),delete i[h.id])}catch(e){g.e(e)}finally{g.f()}}case 15:this._time=null,this._buffer.length&&(this._time=setTimeout(function(){return p._post()},this._timeout));case 17:case"end":return e.stop()}},e,this,[[3,12]])}))}},{key:"init",value:function(){return Promise.resolve(void 0)}},{key:"setUserId",value:function(e){return Promise.resolve(void 0)}}]),t}(),AnalyticsServer=function(e){var l=_.assign({host:"http://localhost:3005",timeout:1e4,maxBundleSize:100,name:"analyticsbundle",bundleTimeMin:5e3,bundleTimeMax:6e4,storage:null},e),t=this,d=l.bundleTimeMin,a=0,n=[];function r(){l.storage.setItem(l.name,JSON.stringify(n.map(function(e){return[e.id,e.service,e.params]})))}console.log("[Analytic] host: ",l.host),this.createHttpRequest=function(){if("undefined"==typeof cc){var e=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");return void 0===e.ontimeout&&(e._timeoutId=-1),e}return cc.loader.getXMLHttpRequest()},this.post=function(r,s){var e=this;return new Promise(function(i,o){var a=e.createHttpRequest();a.timeout=l.timeout,a.open("POST",l.host+"/"+r,!0),a.setRequestHeader("Content-Type","application/json; charset=utf-8");var n=setTimeout(function(){a.abort(),o(new Error("timeout "+r))},l.timeout);a.onload=function(){if(clearTimeout(n),d=l.bundleTimeMin,200==a.status)try{i(JSON.parse(a.response))}catch(e){console.error("Url<"+r+">: "+e),o(e)}else{var t;try{var e=JSON.parse(a.response);(t=new Error(e.error)).code=e.code}catch(e){(t=new Error(a.response+" url:"+l.host+"/"+r+" params: "+JSON.stringify(s)+" status:"+a.statusText)).code=a.status||500}o(t)}},a.onerror=function(){clearTimeout(n);var e=new Error("server connect error "+l.host+"/"+r+" params: "+JSON.stringify(s));e.code=a.status||500,(d+=5e3)>l.bundleTimeMax&&(d=l.bundleTimeMax),o(e)},a.send(JSON.stringify(s))})},this.bundle=function(i,o){return new Promise(function(e,t){n.length>l.maxBundleSize?t(new Error("[Analytic]   ")):(n.push({id:++a,service:i,params:o,resolve:e,reject:t}),r())})};var i,o={};this.log=function(i,e){return(o[i]||[]).reduce(function(e,t){return e.then(function(e){return t(e,i)})},Promise.resolve(e)).then(function(e){return console.log("[Analytic] ",i,JSON.stringify(e)),t.bundle("log",{event:i,data:e}).then(function(e){console.log("[Analytic] ",i," result: ",JSON.stringify(e))}).catch(function(e){throw console.log("[Analytic] ",i," err: ",e.toString()),e})})},this.addPrepare=function(e,t){o[e]||(o[e]=[]),o[e].push(t)},function e(){setTimeout(function(){(function(){if(n.length){var e=n.filter(function(e){return"send"!==e.state}).map(function(e){return e.state="send",{id:e.id,service:e.service,params:e.params}});if(e.length)return r(),t.post("bundle",e).then(function(e){for(var t=0;t<e.length;++t){e[t].data;var i=_.findWhere(n,{id:e[t].id});i&&(e[t].error?e[t].code<500?(i.state="sended",i.reject&&i.reject(e[t])):(console.error("[Analytic] "+e[t].error),i.state=null):(i.state="sended",i.resolve&&i.resolve(e[t].data)))}n=n.filter(function(e){return"sended"!==e.state}),r()}).catch(function(e){413==e.code?n=[]:n.forEach(function(e){e.state=null}),r(),console.error("[Analytic] "+e.message)})}return Promise.resolve()})().then(function(){e()})},d)}(),(i=l.storage.getItem(l.name))&&(n=JSON.parse(i).map(function(e){return{id:e[0],service:e[1],params:e[2]}}),a=Math.max.apply(Math,[a].concat(_toConsumableArray(n.map(function(e){return e.id})))))},AnalyticsComponent=BaseApplicationComponent.extend({initialize:function(){this.stat2=new BundleAnalyticsProvider({connect:new HttpClientMethod({httpClient:new HttpClient(this.get("host2")),path:"event"})}),this.stat=new AnalyticsServer({host:this.get("host"),storage:{getItem:function(e){return getLocalStorage(e,null,!0)},setItem:function(e,t){setLocalStorage(e,t,!0)}}}),this._startTime=Date.now(),this._session_number=Date.now()},uuidv4:function(){return window.crypto&&crypto.getRandomValues?"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(e){return(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)}):""},logEvent:function(e,t){return this.stat2.logEvent(e,Object.assign({},t,{id:this.uuidv4(),event_client_dt:Date.now(),user_created_dt:new Date(user.get("firstLogin")),user_id:(user.get("userId")||"").toString(),level_number:user.getCurrentLevel(),session_number:this._session_number,total_time:Math.max(0,Date.now()-this._startTime),additional_ids:{},version:"1",country:locale,platform:this.get("platform"),network:network}))},load:function(t){return new Promise(function(e){return t.once("run",e)})},init:function(t){var i=this;this.logEvent("session_start"),user.on("buyProduct",function(e){i.logEvent("payment_real",{name:"product_"+e.product,price:e.priceCurrency.RUB,currency:"RUB",transaction_id:Date.now().toString()})}),t.on("playGame",function(e){i.logEvent("level_start",{name:"game",episode:episode.get("num").toString(),level:(t.level.num||"").toString()}),e.on("win",function(){i.logEvent("level_end",{name:"game",episode:episode.get("num").toString(),level:(t.level.num||"").toString(),points:e.getScore(),steps:e.getMoves()})}),e.on("fail",function(){i.logEvent("level_fail",{name:"game",episode:episode.get("num").toString(),level:(t.level.num||"").toString(),points:e.getScore(),steps:e.getMoves()})})}),t.hasComponent("interstitial")&&t.getComponent("interstitial").on("showed",function(e){setTimeout(function(){i.stat.log("adsShowed",{created:1e3*t.getCurrentServerTime(),platform:i.get("platform"),userId:user.get("userId"),type:"interstitial",tag:e.get("tag"),episode:"game"===t.get("page")?episode.get("num").toString():"none",level:"game"===t.get("page")?t.level.num:0})},200)}),t.on("rewardad",function(e){i.stat.log("adsShowed",{created:1e3*t.getCurrentServerTime(),platform:i.get("platform"),userId:user.get("userId"),type:"reward",tag:e.get("tag"),episode:"game"===t.get("page")?episode.get("num").toString():"none",level:"game"===t.get("page")?t.level.num:0})})}}),OutOfMovesWindow=TWindow.extend({templateClass:".outOfMovesWindow_template",events:{"click .outOfMovesBuy":"buy","click .outOfMovesForFriends":"addMovesByFriendGift","click .outOfMovesForAd":"addMovesByShowAd","click .close":"close"},onOpenSound:"losegame",exitGameOnCancel:!0,renderFriend:function(){if(!0!==gameView.selectedFriendForAddMoves&&gameView.selectedFriendForAddMoves&&users[gameView.selectedFriendForAddMoves]){var e=Config.friendsPanelAvatarSize||Config.basePhotoSize;this.$(".outOfMovesPhoto").html(socialNetwork.makePhotoById(gameView.selectedFriendForAddMoves,e)).attr("title",users[gameView.selectedFriendForAddMoves].first_name)}else this.$el.removeClass("haveFriendForMoves")},onOpen:function(){this.$el.removeClass("haveFriendForMoves").removeClass("addMovesByAd");var e="vkontakte"!=network&&"vkontakte"!=window.phonegapNetwork;user.isFreeHelpAvailable()&&(!(Config.rewardAdForMoves&&Config.outOfMoves.movesByAd&&Config.rewardAdForMoves.checkAvailable())||Game.get("buyedMoves")||Game.get("adShowed")&&!(Game.get("adShowed")<Config.outOfMoves.countAd)||episode.isBonusWorld()&&Config.bonusWorld&&Config.bonusWorld.get("dontShowAd")?e&&(!0===gameView.selectedFriendForAddMoves&&(gameView.selectedFriendForAddMoves=user.getRandomFriendForGift()),!1!==gameView.selectedFriendForAddMoves&&(this.$el.addClass("haveFriendForMoves"),this.$(".addMovesByInviteAmount").html(Config.amountMovesByInviteFriend)),this.renderFriend()):(this.$el.addClass("addMovesByAd"),this.$(".addMovesByAdAmount").html(Config.outOfMoves.movesByAd))),this.$(".outOfMovesMoves").html(Config.outOfMoves.moves),Game.set("fullRunning",!1),Config.outOfMoves.product?(this.$(".outOfMovesPrice").html(Number(prices[Config.outOfMoves.product].desc.price)),this.$(".inlineCoinBuy").remove(),this.listenToOnce(user,"buyAddMoves",this.onBuyMovesByMoney)):this.$(".outOfMovesPrice").html(Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves")),this.$el.addClass("withoutCounter"),this.$(".coins").html(user.get("coins").get()),this.renderTasks(),!episode.isBonusWorld()&&Config.outOfMovesPrize&&1==Game.get("buyedMoves")&&(this.$el.addClass("outOfMovesSpecialPrize").addClass(Config.outOfMovesPrize),this.$el.find(".outofMovesBonus").html(Config.outOfMoves.moves)),Config.bonusWorld&&this.$(".bottomTextBlock > .bottomText").html(messages[Config.bonusWorld.get("name")+"ItemLevelExitWarning"]),TWindow.prototype.onOpen.call(this)},renderTasks:function(){var o=this.$(".tasks");gameView.tasksView.tasks.each(function(e){var t=$(".invisible .task."+e.get("cssClass"));0===t.length&&(t=$(".invisible .task.noClass"));var i=t.clone().addClass(e.get("cssClass")).removeClass("noClass");i.find(".taskNeedAmount").text(Math.max(e.get("beginAmount"),e.get("amount"),1*e.get("amount")+e.get("collectedAmount"))),i.find(".taskAmount").text(e.get("amount")),i.find(".taskCollectAmount").text(e.get("collectedAmount")),i.find(".taskName").text(e.get("name")),e.get("completed")&&i.addClass("complete"),e.get("cellClass")===BossCell&&i.addClass(application.level.bossName+"Task"),o.append(i)},this)},addMovesByShowAd:function(){TWindow.prototype.close.call(this),Config.rewardAdForMoves.set("subtag",Game.get("adShowed")||""),Game.set("adShowed",(Game.get("adShowed")||0)+1),Config.rewardAdForMoves.showAd(function(){this.onBuyMoves(Config.outOfMoves.movesByAd,0),gameView.selectedFriendForAddMoves=!1},function(){new this.constructor},this)},addMovesByFriendGift:function(){gameView.addMoves(_.bind(function(){TWindow.prototype.close.call(this),Game.set({fullRunning:!0}),user.set({actionName:"addMovesByGift_"+(window.mobile?"m":"s"),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0},{validate:!1})},this),_.bind(function(){this.renderFriend()},this))},onBuyMovesByMoney:function(){TWindow.prototype.close.call(this),this.onBuyMoves(Config.outOfMoves.moves,1)},onBuyMoves:function(e,t){Game.set({moves:new ObscureNumber(e),fullRunning:!0,buyedMoves:Game.get("buyedMoves")+t}),Game.trigger("addMoves"),application.playSound("buyMoves"),!episode.isBonusWorld()&&Config.outOfMovesPrize&&2==Game.get("buyedMoves")&&("starInField"==Config.outOfMovesPrize?gameView.processStarInField(!0):(user.setPowerUpAmount(Config.outOfMovesPrize,user.getPowerUpAmount(Config.outOfMovesPrize)+1,!0),user.set({powerUps:user.calcPowerUps()})))},buy:function(){Config.outOfMoves.product?showBuy(prices[Config.outOfMoves.product]):(TWindow.prototype.close.call(this),user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves"))),actionName:"add moves"+(Game.get("buyedMoves")?Game.get("buyedMoves"):""),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves")},{validate:!0})?this.onBuyMoves(Config.outOfMoves.moves,1):new this.constructor(this.options))},close:function(){(episode.isBonusWorld()&&Config.bonusWorld||application.getExternalWorld())&&Game.trigger("refuseBuyMoves",this),this.exitGameOnCancel&&Game.exit(),this.trigger("cancel"),TWindow.prototype.close.call(this)}}),BombExplodeWindow=TWindow.extend({templateClass:".bombExplodeWindow_template",events:{"click .bombExplodeBuy":"buy","click .bombExplodeBuyForFriends":"addBombMovesByFriendGift","click .bombExplodeBuyForAd":"addMovesByShowAd","click .close":"close"},onOpenSound:"losegame",addMovesByShowAd:function(){TWindow.prototype.close.call(this),Game.set("adShowedForBomb",!0),Config.rewardAdForBombs.showAd(function(){this.movesForAd(),gameView.selectedFriendForAddBombMoves=!1},function(){new this.constructor},this)},addBombMovesByFriendGift:function(){gameView.addBombMoves(_.bind(function(){TWindow.prototype.close.call(this),Game.set({running:!0,fullRunning:!0})},this),_.bind(function(){this.renderFriend()},this))},renderFriend:function(){this.$(".bombExplodePhoto").html(socialNetwork.makePhotoById(gameView.selectedFriendForAddBombMoves,Config.basePhotoSize)).attr("title",users[gameView.selectedFriendForAddBombMoves].first_name)},onOpen:function(){var e=user.isFreeHelpAvailable(),t=Boolean(e&&Config.rewardAdForBombs&&Config.rewardAdForBombs.checkAvailable()&&!Game.get("adShowedForBomb"));this.$(".bombsForAdBlock .addMovesByAdAmount").text(Config.bombExplode.movesByAd),this.$(".bombsForAdBlock").toggle(t),this.$el.toggleClass("adEnabled",t),!0===gameView.selectedFriendForAddBombMoves&&(gameView.selectedFriendForAddBombMoves=user.getRandomFriendForGift()),e&&!1!==gameView.selectedFriendForAddBombMoves&&!t?(this.$el.addClass("haveFriendForBombs"),this.renderFriend()):this.$el.removeClass("haveFriendForBombs"),Game.has("buyedBombsMoves")||Game.set("buyedBombsMoves",0),Config.bombExplode.product?(this.$(".bombExplodePrice").html(prices[Config.bombExplode.product].desc.price),this.$(".inlineCoinBuy").remove(),this.$(".coinsBlock").addClass("withProduct"),this.listenToOnce(user,"buyAddMoves",this.onBuyMovesByMoney)):this.$(".bombExplodePrice").html(Config.bombExplode.price+Config.bombExplode.upPrice*Game.get("buyedBombsMoves")),this.$(".bombExplodeMoves").html(Config.bombExplode.moves),this.options.color&&this.$el.addClass("color_"+this.options.color),this.$(".coins").html(user.get("coins").get()),TWindow.prototype.onOpen.call(this)},buy:function(){if(Config.bombExplode.product)showBuy(prices[Config.bombExplode.product]);else{var e=user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(Config.bombExplode.price+Config.bombExplode.upPrice*Game.get("buyedBombsMoves"))),actionName:"add bombs"+(Game.get("buyedBombsMoves")?Game.get("buyedBombsMoves"):""),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:Config.bombExplode.price+Config.bombExplode.upPrice*Game.get("buyedBombsMoves")},{validate:!0});TWindow.prototype.close.call(this),e?this.movesBuyed():new BombExplodeWindow({color:this.options.color})}},onBuyMovesByMoney:function(){TWindow.prototype.close.call(this),this.movesBuyed()},movesBuyed:function(){BombCell.addBombMoves(Config.bombExplode.moves),Game.set({running:!0,fullRunning:!0,buyedBombsMoves:Game.get("buyedBombsMoves")+1}),application.playSound("buyBombMoves")},movesForAd:function(){TWindow.prototype.close.call(this),BombCell.addBombMoves(Config.bombExplode.movesByAd),Game.set({running:!0,fullRunning:!0,buyedBombsMoves:Game.get("buyedBombsMoves")+1}),application.playSound("buyBombMoves")},close:function(){BombCell.explodeBomb(function(){Game.exit()}),TWindow.prototype.close.call(this)}}),StatisticWindow=TWindow.extend({templateClass:".statisticWindow_template",share:function(){var e=episode.isBonusWorld()?Config.bonusWorld.name+"LevelPassedBonusWorld":"levelPassed",t=messages[e+"Image"],i=RANDOM(messages[e+"Message"]),o=messages.levelPassedCaption[user.get("gender")];_doPublication(sprintf(i[user.get("gender")],{score:this.options.score,scoreWord:needWord(this.options.score,messages.scores),level:episode.absoluteLevelNumber(this.score.get("level"))}),t,o,void 0,_.bind(function(){episode&&episode.isBonusWorld()&&Config.bonusWorld&&Config.bonusWorld.onPublish&&Config.bonusWorld.onPublish(),this.close()},this),e)},onOpen:function(){this.$el.removeClass("levelPassed").removeClass("overtaken").removeClass("highscore").removeClass("vs"),this.score=new Score({level:this.options.level,score:this.options.score,stars:this.options.stars});var e=episode.currentLevelNumber?episode.currentLevelNumber:episode.absoluteLevelNumber(this.score.get("level"));if(episode.isBonusWorld()&&Config.bonusWorld.getComponent("progressSimpleIncrement")&&this instanceof StatisticAfterWindow&&e--,episode.isBonusWorld()){var t=Config.bonusWorld.getCurrentLevel();$("#statisticWindow").addClass("levelNow"+t)}if(this.$(".statisticLevel").html(e),this.$(".statisticScore").html(this.score.get("score")),window.mobile&&($(".statisticScore").attr("data-text",this.score.get("score")),$(".statisticHighscore").attr("data-text",this.score.get("score"))),this.$el.addClass("level_"+e),(window.mobile&&"odnoklassniki"==network||window.mobile&&"mailru"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption"),application.levelResultsCache.get(episode.get("num")+"_"+this.options.level,_.bind(function(e){this.displayResults(e),TWindow.prototype.onOpen.call(this)},this)),!episode.isBonusWorld()){var i=episode.prizes.find(function(e){return!e.get("done")||e.changed.done});i||(i=episode.prizes.last()),new PirateGameProgressBarView({model:i,el:this.$el})}},displayResults:function(e){var t=new Results(e);t.addBots();var i=episode.scores.findWhere({level:this.options.level});t.add({id:user.get("userId"),score:i?i.get("score"):0}),this.$("#friendsScoresList").empty();var o=t.indexOf(t.get(user.get("userId"))),a=Config.statisticScoresListSize||4,n=o<=a?a:a-1,r=0;t.each(function(e,t){r<a&&(e.id===user.get("userId")||t<n)&&(this.renderResult(e,t),r++)},this),this.tune(t)},renderResult:function(e,t){var i=this.$(".invisible .scoresCard").clone();e.get("id")==viewerId&&i.addClass("self"),i.addClass(t%2==0?"odd":"even"),i.find(".scoresCardPlace").html(t+1),i.find(".scoresCardPhoto").html(socialNetwork.makePhotoById(e.get("id"),Config.basePhotoSize)),i.find(".scoresCardName").html(e.get("name")),i.addClass("resultNumber"+(t+1)),t<3&&i.find(".scoresCardCup").addClass("cup"+(t+1)),i.find(".scoresCardScoreBlock").html('<span class="score">'+e.get("score")+'</span> <span class="score-desc">'+needWord(e.get("score"),messages.scores)+"</span>"),this.$("#friendsScoresList").append(i)}}),StatisticBeforeWindow=StatisticWindow.extend({events:{"click .close":"close","click .statisticPlayGame":"play"},play:function(){this.onClose=function(){gameView.start(this.options.level)||new StatisticBeforeWindow(this.options)},this.close()},tune:function(e){application.prev={place:e.indexOf(e.get(user.get("userId"))),level:this.options.level},this.$(".statisticStarOn").removeClass("statisticStarOn");for(var t=1;t<=this.score.get("stars");t++)this.$("#statisticStar"+t).addClass("statisticStarOn");if(Config.cantPlayOnOldLevels)this.$el.addClass("levelPassed");else{var i=e.first();if(i.id===user.get("userId"))this.$el.addClass("highscore"),this.$(".statisticHighscore").html(episode.scores.findWhere({level:this.options.level}).get("score"));else{this.$el.addClass("vs"),window.results=e;var o=this.$(".statisticMyCard");o.find(".vsCardName").html(user.get("name")),o.find(".vsCardScore").html(this.options.score),o.find(".vsCardPhoto").html(socialNetwork.makePhotoById(user.get("userId"),Config.basePhotoSize)),(o=this.$(".statisticFriendCard")).find(".vsCardName").html(i.get("name")),o.find(".vsCardScore").text(i.get("score")),o.find(".vsCardPhoto").html(socialNetwork.makePhotoById(i.get("id"),Config.basePhotoSize))}}}}),StatisticAfterWindow=StatisticWindow.extend({events:{"click .close":"close","click .publicStatistic":"share","click .nextLevelStatistic":"playNextLevel","click .closeWindowStatistic":"close","click .needPublicCheckbox":"togglePublicCheckbox","click .replay":"replayCurrentLevel"},initialize:function(e){StatisticWindow.prototype.initialize.call(this,e),this.hasClickByReplayButton=!1},backToMain:function(){application.set("page","main")},onOpen:function(){var t=this;StatisticWindow.prototype.onOpen.call(this),this.needPublic=this.$(".needPublicCheckbox").hasClass("checkboxOn"),1==user.get("episode")&&user.get("level")<10&&(this.offPublicCheckbox(),this.$el.addClass("hidePublication"));var e=this.options.level+1;if(episode.get("levels")[e]&&!episode.scores.findWhere({level:e})?this.$el.removeClass("alreadyPassed"):this.$el.addClass("alreadyPassed"),episode.isBonusWorld()){var i=this.$el.find(".mProgress"),o=this.$el.find(".mProgressLabel");if(Config.bonusWorld.view&&Config.bonusWorld.view.showPrizeProgress)Config.bonusWorld.view.showPrizeProgress(i,o);else{var a=_.find(Config.bonusWorld.get("prizes"),function(e){return e.level>=t.options.level&&"middlePrize"===e.type});a&&(this.$el.addClass("hasPrizeProgress"),i.css("width",this.options.level/a.level*100+"%"),o.html(this.options.level+"/"+a.level))}Game.isCancelNext()||Config.bonusWorld.get("alwaysCancelNext")||this.$el.find(".closeWindowStatistic").addClass("invisible")}},onClose:function(){var e=function(e){return-1!==e&&-2!==e&&-3!==e};if(!episode.isBonusWorld()&&void 0===Config.overtakenAndChampionWindowsMinLevel||!episode.isBonusWorld()&&episode.absoluteLevelNumber(this.score.get("level"))>=Config.overtakenAndChampionWindowsMinLevel){if(0===this.newPlace&&0!==this.prevPlace&&(e(this.secondPlace.id)||e(this.thirdPlace.id)))return void new ChampionWindow({level:this.score.get("level"),places:[this.firstPlace,this.secondPlace,this.thirdPlace],backToMain:this.backToMain});if(this.prevUser&&e(this.prevUser.id))return void new OvertakenWindow({level:this.score.get("level"),score:this.options.score,overtakenFriend:this.prevUser,myPlace:this.newPlace+1,friendPlace:this.newPlace+2,backToMain:this.backToMain})}this.backToMain()},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},close:function(){_.times(this.score.get("stars"),function(e){this.$("#statisticStar"+(e+1)).stop().clearQueue().setScale(1).css("z-index",0)},this),StatisticWindow.prototype.close.call(this),this.trigger("close",this)},onOpenSound:"finishwindow",tune:function(e){application.prev||(application.prev={}),this.prevPlace=application.prev.place,void 0!==this.prevPlace&&application.prev.level==this.options.level||(this.prevPlace=e.length-1),this.$(".statisticStarOn").removeClass("statisticStarOn"),this.starsAnimation(),this.prevUser=!1,this.newPlace=e.indexOf(e.get(user.get("userId"))),this.newPlace<this.prevPlace&&(this.prevUser=e.at(e.indexOf(e.get(user.get("userId")))+1)),0===this.newPlace&&(this.firstPlace=e.at(0),this.secondPlace=e.at(1),this.thirdPlace=e.at(2)),this.$el.addClass("levelPassed")},starsAnimation:function(){_.times(this.score.get("stars"),function(t){this.$("#statisticStar"+(t+1)).delay(1e3*t+1e3).queue(function(e){application.playSound("star"+(t+1)),window.mobile?$(this).addClass("statisticStarOn"):($(this).css("z-index",2).addClass("statisticStarOn").ourAnimate({scale:4},0).ourAnimate({scale:1},300,function(){$(this).css("z-index","auto")}),e())})},this)},playNextLevel:function(){var e=this,t=episode.isBonusWorld()&&Config.bonusWorld&&Config.bonusWorld.get("skipLevelPublication");return this.needPublic&&!t&&this.share(),Game&&Game.isCancelNext()?(this.backToMain(),void this.close()):Promise.resolve().then(function(){return e.close()}).then(function(){return episode.isBonusWorld()&&Config.bonusWorld.prepareNextLevel?Config.bonusWorld.prepareNextLevel():e.options.level+1}).then(function(t){(episode.noScores||episode.get("levels")[t]&&!episode.scores.findWhere({level:t}))&&(e.backToMain=function(){application.trigger("main");var e=function(){gameView.start(t)&&application.playPageSound()};application.windows.anyWindowOpen()?application.once("windowsClosed",e):e()})})},replayCurrentLevel:function(){this.onClose=function(){var e=_.extend(application.level.startParams,{replayBonusLevel:!0});gameView.start(this.options.level,e)?soundManager.playMusic(this.options.music):application.once("windowsClosed",function(){var e=this.options;e=_.extend(e,{noAnimation:!0}),new FailedWindow(e)},this)},this.hasClickByReplayButton=!0,this.close()}}),StartLevelWindow=TWindow.extend({templateClass:".startLevelWindow_template",events:{"click .oneAltBtn":"startLevel","click .close":"close"},taskItemWidth:80,onOpen:function(){this.render(),TWindow.prototype.onOpen.call(this)},render:function(){this.$(".statisticLevel").html(this.options.absoluteLevel),episode.isSpecialLevel(this.options.level)&&this.$el.addClass("levelSpecial"),this.renderTasks()},renderTasks:function(){for(var e=this.options.levelData,t=this.$(".taskList"),i=Tasks.getTasks(e),o=0;o<i.length;o++){var a=this.$(".invisible .taskItem").clone();if(a.find(".task").addClass(i[o].cssClass),e.bossName&&(a.find(".task").addClass(e.bossName+"Task"),a.find(".amount").addClass(e.bossName+"Task")),i[o].amount){var n=a.find(".amount");n.html("0/"+i[o].amount),n.addClass(i[o].cssClass)}t.append(a)}var r=this.$(".tasksPane").width()-40,s=this.taskItemWidth*i.length,l=Math.min(1,r/s);t.scale(l)},startLevel:function(){var e=this.options.level,t=this.options.launchOptions;gameView.start(e,t),this.close()}}),NewEpisodeWindow=TWindow.extend({templateClass:".newEpisodeWindow_template",events:{"click .close":"close","click #newEpisodeWindowStart":"close"},close:function(){1===episode.get("num")&&application.windows.runAfterCloseAllWindows(function(){gameView.start(1),firstSessionLogger.logEvent("ok_startgame")}),2===episode.get("num")&&application.windows.runAfterCloseAllWindows(function(){gameView.start(1)}),episode.isBonusWorld()&&!this.options.silent&&(Config.bonusWorld.onClickBonusWorldTutorial?Config.bonusWorld.onClickBonusWorldTutorial():1===Config.bonusWorld.getCurrentLevel()&&episode.get("num")!==Config.bonusWorld.get("name")&&gameView.start(1)),episode.trigger("startWindowClosed",episode),TWindow.prototype.close.call(this)},onOpen:function(){if(episode.isBonusWorld()&&Config.bonusWorld.onShowBBonusWorldTutorial&&Config.bonusWorld.onShowBBonusWorldTutorial(),1===episode.get("num")&&firstSessionLogger.logEvent("tutorial"),this.$el.removeClass().addClass("window"),episode.isBonusWorld()||this.options.world){var e=this.options.world||Config.bonusWorld;this.$el.addClass("bonusWorldEpisode"),this.$el.addClass("episode_"+e.getName()),this.$(".newEpisodeName").html(messages[e.get("name")+"NewBonusWorldName"]),this.$(".newEpisodeText").html(e.isIntegrationEvent()&&messages[e.get("name")+"NewBonusWorldTextVK"]||messages[e.get("name")+"NewBonusWorldText"]),Config.bonusWorld.onShowBonusWorldTutorial&&Config.bonusWorld.onShowBonusWorldTutorial(this)}else this.$el.addClass("episode"+user.get("episode")),this.$(".newEpisodeName").html(messages.newEpisodeName[user.get("episode")-1]),this.$(".newEpisodeText").html(messages.newEpisodeText[user.get("episode")-1]);if(this.$(".prizes").empty(),episode.isBonusWorld()){if(Config.bonusWorld.get("prizes").length<=0)return;this.$el.addClass("withPrizes");var t=_.findWhere(Config.bonusWorld.get("prizes"),{type:"finalPrize"});t&&t.prize&&this.prize&&new UserPrizesView({model:new UserPrizes(t.prize),el:this.$(".prizes"),isGroup:!0})}TWindow.prototype.onOpen.call(this)}}),FailedWindow=TWindow.extend({templateClass:".failedWindow_template",events:{"click .close":"close","click .closeBtn":"close","click #replay":"play","click .showAd":"showAd"},onOpen:function(){this.options.music||(this.options.music=soundManager.get("music")),soundManager.stopMusic(),this.$("#replay").show(),this.$(".closeBtn").hide(),episode.isBonusWorld()&&(Config.bonusWorld.backToFirstLevelAfterFail&&1<this.options.level&&(episode.backToFirstLevel(),this.$("#replay").hide(),this.$(".closeBtn").show()),Config.bonusWorld.get("dontBuyLives")&&0==Config.bonusWorld.livesController.getLives()&&(this.$("#replay").hide(),this.$(".closeBtn").show())),episode.isBonusWorld()&&Config.bonusWorld.hasOwnLives()?this.$el.toggleClass("withLifes",Config.bonusWorld.hasLives()):(this.$el.toggleClass("withLifes",0<user.get("lives")||goods.checkProduct("unlimitedLifes")),user.isFreeHelpAvailable()&&Config.rewardAdForLives&&0===user.get("lives")&&!goods.checkProduct("unlimitedLifes")&&this.$el.toggleClass("advert",Config.rewardAdForLives.checkAvailable())),this.options.noAnimation?this.$(".brokenHeart").addClass("alreadyBroken").removeClass("broken"):this.$(".brokenHeart").removeClass("alreadyBroken").removeClass("broken").delay(700).queue(function(e){application.playSound("failedWindowLostLife"),$(this).addClass("broken"),e()}),TWindow.prototype.onOpen.call(this)},onClose:function(){application.set("page","main"),user.tryOpenShopRecommendedWindow()},play:function(){this.onClose=function(){if(gameView.start(this.options.level,application.level.startParams))soundManager.playMusic(this.options.music);else{var e=this.options;e=_.extend(e,{noAnimation:!0}),new FailedWindow(e)}},this.close()},showAd:function(){this.onClose=function(){var e=this.options;e=_.extend(e,{noAnimation:!0}),Config.rewardAdForLives.showAd(_.once(function(){user.set({lives:Math.min(user.get("lives")+1,Config.maxLives),actionName:"lifes for ad",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0},{validate:!0}),new FailedWindow(e)}),function(){new FailedWindow(e)},this)},this.close()}}),PrizeDoneWindow=TWindow.extend({templateClass:".boxOpenedWindow_template",events:{"click #boxOpenedPublic":"close","click .needPublicCheckbox":"togglePublicCheckbox"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},initialize:function(e){e.prize.has("oneOfManyGame")?new PrizeDoneOneOfManyWindow(e):TWindow.prototype.initialize.apply(this,arguments)},onClose:function(){this.options.prize.execute(),this.needPublic&&"spmobage"!==network&&user.defaultPublication("pizeDonePublication")},onOpen:function(){this.$(".prizes").empty();var e=this.$(".invisible .boxOpenedOnePrize").clone();if(e.addClass("boxOpenedWindowCoins"),e.find(".amount").html(this.options.prize.get("coins")),this.$(".prizes").append(e),this.options.prize.get("addPrize")){var t=this.$(".invisible .boxOpenedOnePrize").clone();t.addClass("boxOpenedWindow"+this.options.prize.get("addPrize").name),t.find(".amount").html(this.options.prize.get("addPrize").amount),this.$(".prizes").append(t)}this.$("#boxOpenedCoins").html(this.options.prize.get("coins")),this.$(".openBox").removeClass("openBoxAnimation").removeClass("blinkBoxAnimation").removeClass("openBoxAnimationDone"),this.$(".actualStars, .requiredStars").html(this.options.prize.get("requiredStars")),this.onPublicCheckbox(),setTimeout(_.bind(function(){this.$(".openBox").addClass("openBoxAnimation"),setTimeout(_.bind(function(){this.$(".openBox").addClass("openBoxAnimationDone").removeClass("openBoxAnimation").addClass("blinkBoxAnimation")},this),750)},this),500),TWindow.prototype.onOpen.call(this)}}),PrizeDoneOneOfManyWindow=TWindow.extend({templateClass:".boxOpenedChoiceWindow_template",variantsNumber:3,onOpenSound:!1,events:{"click .getBoxPrize":"getPrize","click .close":"close","click .needPublicCheckbox":"togglePublicCheckbox","click .boxOpenedChoicePrize":"openPrize"},initialize:function(e){this.variantsNumber=e.prize.get("variants").length;for(var t=0;t<this.variantsNumber;t++){var i="box_"+t;PrizeDoneOneOfManyWindow.prototype["select"+t]=function(e){return function(){this.setSelected(e)}}(t),this.events["click ."+i]="select"+t}Touchable(PrizeDoneOneOfManyWindow),TWindow.prototype.initialize.call(this,e)},openPrize:function(e){},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},isPowerUpAvalible:function(e){return!!e.powerUp},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onClose:function(){this.needPublic&&"spmobage"!==network&&user.defaultPublication("pizeDonePublication")},openBox:function(e,t){e.removeClass("disabled").addClass("animated")},createPrizeItem:function(e,t){var i=$(".invisible .prizeItem").clone();return i.addClass(e),i.find(".amount").html(t),i},setPrizeView:function(e,t){var i=e.find(".prize");t.coins&&i.append(this.createPrizeItem("coins",t.coins)),t.rubies&&i.append(this.createPrizeItem("rubies",t.rubies));var o=[];t.powerUps?o=t.powerUps:t.powerUp&&o.push({powerUp:t.powerUp,powerUpAmount:t.powerUpAmount}),_.each(o,_.bind(function(e){this.isPowerUpAvalible(e)&&i.append(this.createPrizeItem(e.powerUp,e.powerUpAmount))},this));var a=[];t.goods?a=t.goods:t.good&&a.push({good:t.good,goodHours:t.goodHours}),_.each(a,_.bind(function(e){i.append(this.createPrizeItem(e.good,e.goodHours+messages.timeShort[1]))},this)),t.gacha&&i.append(this.createPrizeItem("gacha",t.gacha)),e.addClass("prizeSet_"+t.set)},getPrize:function(){if(!1!==this.selected&&!this.prizeGetted){this.prizeGetted=!0,this.options.prize.execute(),this.$(".box_"+this.selected).addClass("disabled"),application.playSound("oneOfManyBoxOpen");for(var e=0;e<this.variantsNumber;e++)if(this.selected!=e){var t=this.options.prize.get("variants")[e],i=this.$(".box_"+e);this.openBox(i,t)}setTimeout(_.bind(function(){this.$el.removeClass("prizeIsChosen").addClass("otherPrizes");for(var e=0;e<this.variantsNumber;e++)this.selected!=e&&this.$(".box_"+e).removeClass("animated").addClass("opened");(window.mobile&&"odnoklassniki"==network||window.mobile&&"mailru"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption")},this),this.options.prize.get("openAnimationTimeout"))}},setSelected:function(e){if(!1===this.selected){this.selected=e;var t=this.options.prize.get("variants")[this.selected];this.options.prize.selectOneOfMany(e);var o=this.$(".box_"+this.selected);o.addClass("selected"),this.openBox(o,t),application.playSound("oneOfManyBoxOpen");for(var i=0;i<this.variantsNumber;i++)this.selected!=i&&this.$(".box_"+i).addClass("disabled notSelected");var a=this.$(".textPrizeIsChosen");this.setPrizeView(a,t,"textPrize"),setTimeout(_.bind(function(){o.removeClass("animated").addClass("opened");for(var e=0;e<this.variantsNumber;e++){var t=this.options.prize.get("variants")[e],i=this.$(".box_"+e);this.setPrizeView(i,t,"box")}this.$el.removeClass("prizeNotChosen").addClass("prizeIsChosen"),application.playSound("oneOfManyBoxOpened")},this),this.options.prize.get("openAnimationTimeout"))}},onOpen:function(){this.$el.addClass("boxes_"+this.variantsNumber);for(var e=$(".invisible .boxOpenedChoicePrize"),t=this.$(".prizesBlock"),i=0;i<this.variantsNumber;i++){var o="box_"+i,a=e.clone();a.data("boxId",i),a.addClass(o),t.append(a)}this.selected=!1,this.onPublicCheckbox(),setTimeout(function(){application.playSound("oneOfManyWindowOpen")},0)}}),PrizeClosedWindow=TWindow.extend({templateClass:".boxClosedWindow_template",onOpen:function(){var e=this.options.prize;this.$(".actualStars").text(e.get("actualStars")),this.$(".requiredStars").text(e.get("requiredStars")),this.$(".notEnoughStarsAmount").text(e.get("requiredStars")-e.get("actualStars")),TWindow.prototype.onOpen.apply(this,arguments)}}),BonusLevelDoneWindow=TWindow.extend({templateClass:".bonusLevelDoneWindow_template",onOpenSound:"finishwindow",events:{"click .public":"close","click .needPublicCheckbox":"togglePublicCheckbox"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onClose:function(){episode.bonusLevel.finish(),this.needPublic&&"spmobage"!==network&&"yahoo"!==network&&user.defaultPublication("bonusLevelPublication")},onOpen:function(){this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")),this.$(".crystalAmount").html(gameView.tasksView.taskNeed),this.$(".crystalNeeded").html(gameView.tasksView.taskNeed),this.$(".prizes").empty();var e=episode.bonusLevel.get("prize");_.each(e,_.bind(function(e){var t=this.$(".invisible .onePrize").clone();"good"===e.type?t.find(".amount").html(formatPeriod(60*e.amount)):t.find(".amount").html(e.amount),t.addClass(e.cssClass),this.$(".prizes").append(t)},this)),this.onPublicCheckbox(),(window.mobile&&"odnoklassniki"==network||window.mobile&&"mailru"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption"),TWindow.prototype.onOpen.call(this)}}),BonusLevelInfoWindow=TWindow.extend({templateClass:".bonusLevelInfoWindow_template",events:{"click .close":"close","click .refreshBonusLevel":"refreshBonusLevel","click .play":"play"},getRefreshProduct:function(){for(var e in prices)if("bonusLevelRefresh"===prices[e].type)return prices[e]},refreshBonusLevel:function(){showBuy(this.getRefreshProduct()),this.close()},play:function(){user.set({bonusLevelPlayTime:application.getCurrentServerTime()}),gameView.start("bonus"),this.close()},onOpen:function(){this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")).addClass(this.options.type),this.$(".bonusLevelRefreshPrice").html(this.getRefreshProduct().desc.price),this.$(".requiredStars").html(episode.bonusLevel.get("requiredStars")),"game"==application.get("page")&&this.$(".play").hide(),TWindow.prototype.onOpen.call(this)}}),BonusLevelBeginWindow=TWindow.extend({templateClass:".bonusLevelBeginWindow_template",events:{"click .bonusLevelBegin":"close","click .close":"close"},onClose:function(){setTimeout(function(){Game.set("fullRunning",!0)},500)},onOpen:function(){this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")),this.$(".crystalsAmount").html(application.level.crystals),this.$(".levelTimeOut").html(application.level.moves),TWindow.prototype.onOpen.call(this)}}),BonusLevelTimeoutWindow=TWindow.extend({templateClass:".bonusLevelTimeoutWindow_template",onOpenSound:"losegame",events:{"click .close":"fail","click .buyTime":"buyTime"},getProduct:function(){for(var e in prices)if("bonusLevelTime"===prices[e].type)return prices[e]},initialize:function(){Game.get("buyedTime")<1?TWindow.prototype.initialize.apply(this,arguments):Game.exit()},fail:function(){Game.exit(),setTimeout(_.bind(function(){this.close()},this),50)},buyTime:function(){showBuy(this.getProduct())},onClose:function(){user.off("buyBonusLevelTime",this.close,this)},onOpen:function(){user.on("buyBonusLevelTime",this.close,this),soundManager.stopMusic(),this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")),this.$(".buyTimeAmount").html(Config.bonusLevelBuyTimeAmount),this.$(".buyTimePrice").html(this.getProduct().desc.price),this.$(".taskAmount").html(gameView.tasksView.taskNeed-gameView.tasksView.model.get("amount")),this.$(".taskNeed").html(gameView.tasksView.taskNeed),TWindow.prototype.onOpen.call(this)}}),BonusLevelTimeAddWindow=TWindow.extend({templateClass:".bonusLevelTimeAddWindow_template",onOpenSound:"finishwindow",events:{"click .close":"close","click .continueGame":"close"},onClose:function(){soundManager.playMusic("bonuslevelmusic")},onOpen:function(){this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")),this.$(".addedTime").html(Config.bonusLevelBuyTimeAmount),TWindow.prototype.onOpen.call(this)}}),BonusLevelFailWindow=TWindow.extend({templateClass:".bonusLevelFailWindow_template",onOpenSound:"losegame",events:{"click .close":"close","click .tryAgainButton":"tryAgain"},tryAgain:function(){this.close(),application.once("main",function(){episode.bonusLevel.play()})},onClose:function(){application.set("page","main")},onOpen:function(){this.$el.removeClass().addClass("window").addClass("episode_"+episode.get("num")),this.$(".crystalAmount").html(gameView.tasksView.taskNeed-gameView.tasksView.model.get("amount")),this.$(".crystalNeeded").html(gameView.tasksView.taskNeed),TWindow.prototype.onOpen.call(this)}}),HappyBirthdayWindow=TWindow.extend({templateClass:".happyBirthdayWindow_template",onOpenSound:"happybirthday",events:{"click .thankyou":"close","click .close":"close","click .needPublicCheckbox":"togglePublicCheckbox"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onOpen:function(){if(TWindow.prototype.onOpen.apply(this,arguments),this.needPublic=this.$(".needPublicCheckbox").hasClass("checkboxOn"),Config.birthdayGifts)for(var e=0;e<Config.birthdayGifts.length;e++){var t=Config.birthdayGifts[e];if("sticker"!==t.type||gifts){var i=this.$el.find(".invisible .happyBirthdayWindowGift").clone().addClass(t.type);t.amount&&i.find(".amount").text(t.amount),"powerUp"===t.type&&i.addClass(t.powerUp),"sticker"===t.type&&i.addClass(t.id),i.appendTo(this.$(".gifts"))}}},onClose:function(){if(Config.birthdayGifts){for(var e=user.get("coins"),t=0;t<Config.birthdayGifts.length;t++){var i=Config.birthdayGifts[t];switch(i.type){case"coins":e=new ObscureNumber(e+i.amount);break;case"powerUp":user.setPowerUpAmount(i.powerUp,user.getPowerUpAmount(i.powerUp)+i.amount,!0);break;case"sticker":gifts&&gifts.processCoinsGift(i.id,user.get("userId"))}}user.set({powerUps:user.calcPowerUps(),coins:e})}callService("../../../levelbase/src/services/birthdaygiftreceived.php",function(){},function(){},{}),this.needPublic&&user.defaultPublication("happyBirthdayPublication")}});Application.on("ready",function(){!window.mobile&&recentlyBirthday(application.USERS[user.get("userId")])&&callService("../../../levelbase/src/services/checkbirthdaygiftavailable.php",function(e){e&&Config.birthdayGifts&&new HappyBirthdayWindow},_.noop,{})});var AreYouSureExitWindow=TWindow.extend({templateClass:".areYouSureExit_template",events:{"click .close, #continueGame":"close","click #exitGame":"exit"},onOpen:function(){Config.bonusWorld&&this.$(".bottomText").html(messages[Config.bonusWorld.get("name")+"ItemLevelExitWarning"]),TWindow.prototype.onOpen.call(this)},exit:function(){this.options.onExit(),this.close()}}),HelpFriendsWindow=TWindow.extend({templateClass:".helpFriendsWindow_template",events:{"click .close":"close","click .helpAllFriends":"helpAllFriends"},initialize:function(e){this.friendsToHelp=e.friendsToHelp,TWindow.prototype.initialize.call(this,e)},onOpen:function(){this.render(),setCookie("helpfriendswindow",1,new Date((new Date).getTime()+2592e5).toUTCString()),TWindow.prototype.onOpen.call(this)},helpAllFriends:function(){this.helpTo(this.friendsToHelp.map(function(e){return e.get("id")}))},sendHelp:function(t){if(0<t.length){for(var e=function(e){e.id==t[i]&&e.set("needHelp",!1)},i=0;i<t.length;i++)_.each(needHelpFriends,e);callService("../../../levelbase/src/services/sendhelp.php",function(){},function(){},{userIds:t.join(",")}),this.render()}},helpTo:function(e){if(0<e.length){var t="mailru"===network||"odnoklassniki"===network||"wizq"===network||"mobage"===network||"spmobage"===network||"facebook"===network||"nk"===network||"hangamejp"===network||"phonegap"==network&&"facebook"==window.phonegapNetwork||"phonegap"==network&&"odnoklassniki"==window.phonegapNetwork;t&&this.sendHelp(e);var i=RANDOM(messages.helpToFriend),o=_.bind(function(e){t||this.sendHelp(e),application.playSound("helpFriendsWindowSend")},this);socialNetwork.sendRequest({type:"helpSent",verb:"send",ogobject:"help",userIds:e,message:i[user.get("gender")],success:o})}},render:function(){var i=this,o=!1;this.$(".friendsNeedHelpList").empty(),this.friendsToHelp.forEach(function(e){var t=$(".invisible .friendNeedHelp").clone();t.find(".photo").attr("title",e.get("name")).html(socialNetwork.makePhotoById(e.get("id"),Config.basePhotoSize)),"wizq"!==network&&t.find(".needHelpText").html(messages.needHelpText[e.get("gender")]),t.find(".needHelpLevel").html(e.get("fullLevel")),e.get("needHelp")?o=!0:t.addClass("helpSended"),t.find(".helpFriend").on("click touchend",function(){return e.get("needHelp")&&i.helpTo([e.id]),!1}),i.$(".friendsNeedHelpList").append(t)}),o?this.$(".helpAllFriends").removeClass("disabled"):(this.$(".helpAllFriends").addClass("disabled"),$(".helpFriends").fadeOut(500),setTimeout(function(){i.close()},1e3))}}),LevelOvertakenWindow=TWindow.extend({templateClass:".levelOvertakenWindow_template",events:{"click .public":"publicAndClose","click .close":"close"},onOpenSound:"championwindow",publicAndClose:function(){var e=this.options.uids,t=RANDOM(messages.upFriends),i=episode.absoluteLevelNumber(user.get("level")-1);t=sprintf(t[user.get("gender")],{levelNum:i}),"vkontakte"===network&&(e=e[0]),socialNetwork.sendRequest({type:"levelOvertaking",userIds:e,message:t,success:_.bind(this.close,this)})},onClose:function(){this.$el.removeClass("levelOvertakenAnimation")},onOpen:function(){var e=this.options.uids,t=friends.get(e[0]),i=episode.absoluteLevelNumber(user.get("level")-1);this.$(".myCard .name").html(user.get("name")),this.$(".myCard .photo").html(socialNetwork.makePhotoById(user.get("userId"),Config.basePhotoSize)).attr("title",user.get("name")),this.$(".friendCard .name").html(t.get("name")),this.$(".friendCard .photo").html(socialNetwork.makePhotoById(t.get("id"),Config.basePhotoSize)).attr("title",t.get("name"));var o=episode.scores.findWhere({level:user.get("level")-1}),a=o?o.get("stars"):0;this.$(".levelPassedOvertaken").removeClass("levelPassed0").removeClass("levelPassed1").removeClass("levelPassed2").removeClass("levelPassed3").addClass("levelPassed"+a).find(".levelNumber").html(i),this.$(".levelNowOvertaken").removeClass("levelNow").find(".levelNumber").html(i+1),setTimeout(_.bind(function(){this.$el.addClass("levelOvertakenAnimation")},this),300),TWindow.prototype.onOpen.call(this)}}),NoCoinsWindow=TWindow.extend({templateClass:".notenoughcoinswindow_template",events:{"click .notEnoughCoinsYesBtn":"buyCoins","click .notEnoughCoinsNoBtn":"close","click .close":"close"},onOpen:function(){this.options.cantAddCoins?this.$el.addClass("cantAddCoins"):this.$el.removeClass("cantAddCoins")},buyCoins:function(){new AddCoinsWindow({firstPriority:!0}),this.close()}}),LootBoxWindow=TWindow.extend({templateClass:".lootBoxWindow_template",onOpen:function(){this.$el.addClass(this.options.classes);var t=this.$(".invisible .boxItem"),i=this.$el.find(".boxWrapper");this.options.partClasses.forEach(function(e){t.clone().addClass(e).appendTo(i)},this),setTimeout(this.close.bind(this),3e3)}}),ReturnRewardWindow=TWindow.extend({templateClass:".returnRewardWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),new UserPrizesView({model:this.options.prizes,el:this.$(".mPrizes")})}}),RunBonusWorldWindow=TWindow.extend({templateClass:".runBonusWorldWindow_template",events:{"click .close":"close","click #runBonusWorldStart":"run"},run:function(){application.windows.closeAll(),this.options.bonusworld.open(),TWindow.prototype.close.call(this)},onOpen:function(){this.$el.removeClass().addClass("window");var e=this.options.bonusworld;this.$el.addClass(e.get("name")),this.$(".runBonusWorldName").html(messages[e.get("name")+"NewBonusWorldName"]),this.$(".runBonusWorldText").html(e.isIntegrationEvent()&&messages[e.get("name")+"NewBonusWorldTextVK"]||messages[e.get("name")+"NewBonusWorldText"]),TWindow.prototype.onOpen.call(this)}});function BrightStat(e){var i,o,r={brandingId:e,userId:user.get("userId"),age:calcAge(users[user.get("userId")].bthdate),friendsCount:allFriendsIds.length?allFriendsIds.length:0};if("odnoklassniki"===network){r.sex=users[user.get("userId")].ok_gender||0;var t=users[user.get("userId")].ok_location;t?(r.country=t.countryName,r.city=t.city):(r.country="",r.city="")}else"vkontakte"===network?(r.country=users[user.get("userId")].country||0,r.city=users[user.get("userId")].city||0,r.sex=users[user.get("userId")].sex||0):"test"===network&&(o=!0);function a(t){var e="//brightstat.freetopay.ru/inp/checkAvailability.php?branding_id="+r.brandingId+"&user_id="+r.userId+"&user_data=null&jsonp=afterAvailableBrightStat";window.afterAvailableBrightStat=function(e){"status"in e&&e.status?t(o=!0):t(o=!1)},$.getScript(e)}this.checkAvailability=function(e){!0!==o?!1!==o?i?a(e):function(t){if(t=t||function(){},i)return t();var e="//brightstat.freetopay.ru/inp/init.php?branding_id="+r.brandingId+"&user_id="+r.userId+"&age="+r.age+"&sex="+r.sex+"&country="+r.country+"&city="+r.city+"&friends_count="+r.friendsCount+"&jsonp=afterInitBrightStat";window.afterInitBrightStat=function(e){e&&(i=!0,t())},$.getScript(e)}(function(){a(e)}):e(!1):e(!0)},this.getRedirectUrl=function(e){return i&&o?"//brightstat.freetopay.ru/inp/event_redirect.php?branding_id="+r.brandingId+"&event_id="+e+"&user_id="+r.userId+"&user_data=null":"#"};var s=0,n=function(e,t,i){var o="callbackBrightStat"+ ++s,a="//brightstat.freetopay.ru/inp/"+e+".php?branding_id="+r.brandingId+"&user_id="+r.userId+"&jsonp="+o;for(var n in t)a+="&"+n+"="+t[n];window[o]=function(e){delete window[o],i(e)},$.getScript(a)};this.eventComplete=function(e){i&&o&&n("event_complete",{event_id:e,user_data:"null"},function(e){})},this.checkSurveyAvailability=function(t){n("checkSurveyAvailability",{},function(e){"status"in e&&e.status?(o=i=!0,t(e.link)):t(!1)})}}var TasksWindow=TWindow.extend({templateClass:".tasksWindow_template",ignoreBeforeGameStart:!0,events:{"click .close":"close"},onOpen:function(){var a=this.$el.find(".tasks");this.collection.each(function(e){var t;t=$(".invisible .task."+e.get("cssClass")).length?$(".invisible .task."+e.get("cssClass")).clone():$(".invisible .task.noClass").clone().addClass(e.get("cssClass")).removeClass("noClass");var i=e.get("cellClass");i&&(i===BossCell||i.prototype instanceof BossCell)&&t.addClass(application.level.bossName+"Task"),t.find(".taskName").html(e.get("name")),t.find(".taskNeedAmount").html(e.get("amount")),t.find(".taskAmount").html(e.get("amount")),t.find(".taskCollectAmount").hide(),t.find(".taskAmountSlash").hide(),a.append(t);var o=e.get("taskName");o&&t.find(".taskIco").addClass(o)})}}),BaseOuterParamsComponent=BaseApplicationComponent.extend({defaults:{id:"outerParams"},initialize:function(){this._params={}},load:function(e){return new Promise(function(t){e.preloader.add(new PreloadTask({name:"outerParams",parent:"authorization",task:function(e){t(),e()}}))})},init:function(e){var t=this;return Promise.resolve().then(function(){return t._readParams()})},getParams:function(){return this._params},hasParam:function(e){return-1!==Object.keys(this.getParams()).indexOf(e)},getParam:function(e){return this.hasParam(e)?this.getParams()[e]:null},_readParams:function(){}}),OuterParamComponentSwitcher=BaseOuterParamsComponent.extend({init:function(e){var i=this;return Promise.all(this.get("items").map(function(e){return _checkRules(e.rules)})).then(function(e){var t=i.get("items")[e.indexOf(!0)];i._cmp=t.item}).then(function(){return i._cmp.init(e)})},getParams:function(){return this._cmp.getParams()},hasParam:function(e){return this._cmp.hasParam(e)},getParam:function(e){return this._cmp.getParam(e)}}),FromLocationHashParamsComponent=BaseOuterParamsComponent.extend({_readParams:function(){this._params=parseLocationHash(window.location.hash)}}),VKOuterParamsComponent=BaseOuterParamsComponent.extend({_readParams:function(){var e=parseQueryString(window.location.search).hash;e&&(this._params=parseLocationHash(e))}}),OdkOuterParamsComponent=BaseOuterParamsComponent.extend({_readParams:function(){var e=parseQueryString(window.location.search).custom_args;e&&(this._params=parseQueryString(e))}}),PrizeInfoWindow=TWindow.extend({templateClass:".prizeInfoWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.prefix||"",t=this.options.name;this.$el.addClass(e),this.$(".mTitle").html(messages[e+t].title),this.$(".mDescription").html(messages[e+t].description),new UserPrizesView({model:this.options.prize,el:this.$(".mPrizes")})}}),realFigures={},realFiguresBornTime={},createProxy=function(o,a,n){return a=a||100,function(e){void 0===e&&(e=n);var t=realFigures[e];if(!t||!t.length||realFiguresBornTime[e]+a<canvasTime)return t=o.apply(this,_.toArray(arguments).slice(1)),realFiguresBornTime[e]=canvasTime,realFigures[e]=t;var i=new ProxyFigure(t);return t.onRemove(function(){i.remove()}),i}},BuyPowerUpsWindow=TWindow.extend({templateClass:".buyPowerUpsWindow_template",events:{"click .close":"close","click .bigBtn":"buy"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.powerUp;this.$el.find(".buyPowerUpsBlock").addClass(e.get("id")),this.$el.find(".buyPowerUpBg."+e.get("id")).find(".prize").html(e.get("price")),this.$el.find(".haveCoinsBg").find(".haveCoins").html(user.get("coins").get())},buy:function(e){var t=this.options.powerUp;user.get("coins").get()>=t.get("price")?(user.buyPowerUp(t),user.setPowerUpAmount(t.get("id"),t.get("amount")+1)):new NoCoinsWindow({firstPriority:!0}),this.close()}}),WelcomeBackWindow=TWindow.extend({templateClass:".welcomeBackWindow_template",onOpenSound:"happybirthday",onOpen:function(){_.defer(_.bind(this.takeGift,this))},takeGift:function(){if(Config.welcomeBackGift){var e=Config.welcomeBackGift;switch(e.type){case"good":goods.goodBuyed(e.good,e.amount)}}}}),ApplicationBaseView=Backbone.View.extend({el:".wrapper",events:{"click #coinsBlock":"showAddCoinsWindow","click #menu .sound":"toggleSound","click #menu .music":"toggleMusic","click .fullScreen":"fullScreen","click .exitFullScreen":"exitFullScreen"},isFullScreen:function(){var e,t=this.fullScreenPrefix();if(!1!==t){if(e=""===t?"isFullScreen":t+"IsFullScreen",void 0!==document[e])return document[e];if(e=""===t?"fullScreen":t+"FullScreen",void 0!==document[e])return document[e]}return!1},fullScreenPrefix:function(){return(!window.mobile||"phonegap"!=network)&&(e=document.getElementById("container")?"container":"mainAppWrapper",document.getElementById(e).requestFullScreen?"":document.getElementById(e).webkitRequestFullScreen?"webkit":document.getElementById(e).mozRequestFullScreen?"moz":document.getElementById(e).oRequestFullScreen?"o":!!document.getElementById(e).msRequestFullScreen&&"ms");var e},fullScreen:function(){var e,t=this.fullScreenPrefix();!1!==t&&(t+=""===t?"requestFullScreen":"RequestFullScreen",e=document.getElementById("container")?"container":"mainAppWrapper",document.getElementById(e)[t].call(document.getElementById(e)))},exitFullScreen:function(){var e=this.fullScreenPrefix();!1!==e&&(e+=""===e?"cancelFullScreen":"CancelFullScreen",document[e].call(document))},toggleSound:function(){Settings.toggle("soundEffects")},toggleMusic:function(){Settings.toggle("musicEffects")},appendBottomMenu:function(){},initialize:function(){application.on("change:page",function(e,t){void 0!==application.previous("page")&&($("#"+application.previous("page")).hide(),$("#container").removeClass("page-"+application.previous("page"))),application.playPageSound(),$("#"+t).show(),$("#container").addClass("page-"+t)},this),!1===this.fullScreenPrefix()?$(".fullScreen").addClass("disabled"):$(window).resize(function(){void 0!==canvas&&canvas.init&&canvas.initContext(),void 0!==gameView&&gameView.fieldOffset&&(gameView.fieldOffset=_Figure.field.offset())}),new PreloaderView({preloader:application.preloader}),Settings.on("change:soundEffects",this.renderSndBtn,this),Settings.on("change:musicEffects",this.renderMusicBtn,this),this.renderSndBtn(Settings,Settings.get("soundEffects")),this.renderMusicBtn(Settings,Settings.get("musicEffects")),this.appendBottomMenu(),$("body").toggleClass("dev",!1)},renderSndBtn:function(e,t){t?$(".sound").removeClass("soundOff").addClass("soundOn"):$(".sound").removeClass("soundOn").addClass("soundOff")},renderMusicBtn:function(e,t){t?$(".music").removeClass("musicOff").addClass("musicOn"):$(".music").removeClass("musicOn").addClass("musicOff")},listenToUser:function(){this.renderCoins(),user.on("change:coins",function(){this.renderCoins(),void 0!==user.previous("coins")&&user.previous("coins").get()<user.get("coins").get()&&application.playSound("buyCoins")},this),user.on("invalid",function(e,t){switch(t){case"nocoins":void 0!==NoCoinsWindow?new NoCoinsWindow({urgent:!0}):new AddCoinsWindow;break;case"nolives":this.showAddLivesWindow()}},this)},showAddNoMatterCoinsWindow:function(){application.canOpenNotMatterWindow()&&new AddCoinsWindow},showAddCoinsWindow:function(){this.$("#coinsBlock").hasClass("disabled")||new AddCoinsWindow},renderCoins:function(){$("#coins").html(user.get("coins").get()),$(".userCoins").html(user.get("coins").get())}}),BonusWorldView=Backbone.View.extend({events:{"click .mExitBtn":"onExit","click .mShowFinalPrizeBtn":"showInfoFinalPrize","click .mPrizeControllerOuterProgressBar .markBig":"openRewardChain"},initialize:function(){var e=this;if($("body").delegate(".episode_"+this.model.get("name")+" .mShowFinalPrizeBtn","click",function(){return e.showInfoFinalPrize()}),this.listenTo(this.model,"enter",this.onEnter),this.listenTo(this.model,"onCompleteLevel",this.onCompleteLevel),this.listenTo(this.model,"failLevel",this.onFailLevel),this.$ui=$(".invisible.mainTemplates .bonusWorldUI").clone().appendTo(this.$el),this.$ui.addClass(this.model.get("name")),this.model.hasComponent(TicketsComponent)&&(this.ticketsInfoButton=new TicketInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.tickets=new TicketsView({el:$(".mainTemplates .tickets").clone().appendTo(this.$ui),model:this.model.getComponent(TicketsComponent)})),this.model.hasComponent(MiniTasksComponent)&&(this.miniTaskBtn=new MiniTaskButtonView({el:this.$ui.find(".mMiniTaskBtn"),model:this.model.getComponent(MiniTasksComponent)})),this.model.hasComponent(ForgeComponent)&&(this.forgeBtn=new ForgeButtonView({el:$(".mainTemplates .mForgeBtn").clone().appendTo(this.$ui),model:this.model.getComponent(ForgeComponent)})),this.model.hasComponent(BonusWorldContinuityComponent)&&(this.continuityProgressBtn=new ContinuityProgressButton({el:$(".mainTemplates .mContinuityButton").clone().appendTo(this.$ui),model:this.model.getComponent(BonusWorldContinuityComponent)})),this.model.hasComponent(ActionWorldComponent)&&(this.saleBtn=new ActionWorldButtonView({el:$(".mainTemplates .timeButton").clone().addClass("saleBtn").appendTo(this.$ui),model:this.model.getComponent(ActionWorldComponent)})),this.model.hasComponent(PartShopComponent)&&(this.partShopBtn=new PartShopButton({el:$(".mainTemplates .mPartShopButton").clone().appendTo(this.$ui),model:this.model.getComponent(PartShopComponent)})),this.model.hasComponent(ShootingRangeComponent)&&(this.shootingRange=new ShootingRangeView({el:$("#map"),model:this.model.getComponent(ShootingRangeComponent)})),this.model.hasComponent(SlotMachineComponent)){var t=$(".invisible.slotMachineTemplate .slotMachine").clone();t.addClass(this.model.get("name")+"SlotMachine"),t.appendTo($("#map")),this.slotMachine=new BonusWorldSlotMachineView({el:t,model:this.model.getComponent(SlotMachineComponent)})}if(this.model.hasComponent(StoryController)&&this.model.getComponent(StoryController).get("needShowComicButton")&&(this.comicBtn=new ComicButtonView({el:$(".mainTemplates .comicButton").clone().appendTo(this.$ui),model:this.model.getComponent(StoryController)})),this.model.get("chestsInProgressBar")){var i=$(".mainTemplates .mPrizeControllerOuterProgressBar").clone();i.appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper")),this.prizeControllerProgressbar=new LevelPrizeProgressBar({el:i,model:this.model})}var o=$(".mainTemplates .bonusWorldAnimations").clone();o.addClass(this.model.get("name")),o.appendTo("#map"),this.startLevel=new StartLevelView({model:this.model,el:this.$(".mStartBtn"),rules:this.model.cmp("rulsRunLevel")})},openRewardChain:function(){var e=this.model.cmp(PrizeController);e&&e.view&&e.view.show&&e.view.show()},onCompleteLevel:function(){},onFailLevel:function(){},onEnter:function(){if(this.shootingRange&&this.shootingRange.onEnter(),this.model.hasComponent(ChangeoverComponent)){var e=this.model.getComponent(ChangeoverComponent).getCause(TimeoutCause);e&&(this.timeoutCause=new TimerView({el:$(".mainTemplates .timeoutCause").clone().appendTo(this.$ui),model:e}))}this.prizeControllerProgressbar&&this.prizeControllerProgressbar.update()},onExit:function(){this.model.exit(),this.shootingRange&&this.shootingRange.onExit(),$("#map .bonusWorldAnimations"+this.model.get("name")).remove(),this.timeoutCause&&(this.timeoutCause.remove(),this.timeoutCause=null)},showInfoFinalPrize:function(){var e=_.findWhere(Config.bonusWorld.get("prizes"),{type:"finalPrize"});e&&new PrizeInfoWindow({prefix:this.model.get("name"),name:"FinalPrizeInfo",prize:new UserPrizes(e.prize)})}}),BonusWorldWithArtifacts=BonusWorldView.extend({initialize:function(e){var t=this;BonusWorldView.prototype.initialize.call(this,e),this.model.once("enter",function(){t.model.artifactController.createWorkShopView().$el.appendTo($("#map .scrolledBlock"))})}}),BonusworldListButtonView=Backbone.View.extend({el:"#bonusworldListButton",events:{click:"onClick"},initialize:function(e){var t=this;this.worlds=e.worlds,this.announceWorlds=Config.announceBonusWorlds.slice(),user.getRealLevel()<Config.minBonusworldLevel&&(this.$el.hide(),this.listenTo(user,"change:level",this.onMinBonusWorldLevel));for(var i=0;i<this.worlds.length;i++){this.worlds[i].on("change:notify",function(){t.checkNotify()})}this.checkNotify()},onMinBonusWorldLevel:function(){this.$el.show(),this.stopListening(user,"change:level")},checkNotify:function(){var e=!1;getLocalStorage("ShieldBonusWorldsFirstNotifyHided")||(e=!0);for(var t=0;t<this.worlds.length;t++)if(this.worlds[t].get("notify")){e=!0;break}this.$(".notify").toggleClass("hided",!e)},onClick:function(){if(setLocalStorage("ShieldBonusWorldsFirstNotifyHided",!0),this.checkNotify(),application.windows.anyWindowOpen()&&application.windows.isOpen(BaseForceView)){var e=application.windows.views[0].model.get("world");if(e)return void e.open()}new BonusworldListWindow({model:this})}}),SelectBonusWorldButtonView=Backbone.View.extend({el:".bonusWorldBlock",events:{click:"selectBonusWorld"},initialize:function(e){this.worlds=e.worlds,this.worlds.forEach(function(e){e.on("change:active",this.update,this),e.on("change:timer",this.updateTimer,this),e.on("change:progress",this.updateProgress,this)},this),episode.on("change:num",this.update,this)},render:function(){var i=$(".invisible .bonusworldInfoBlock");this.worlds.forEach(function(e){var t=i.clone();t.addClass(e.get("name")+"Info"),t.toggleClass("closed",!e.isOpenedForUser()),t.toggleClass("hasTimer",e.hasTimer()),this.$el.append(t),this.update(),this.updateTimer(e,e.get("timer")),this.updateProgress(e,e.get("progress"))},this),this.update()},update:function(){var e=this.getActiveWorlds();this.$el.removeClass("available available1 available2 available3 available4 available5"),0<e.length&&(1===e.length?this.$el.addClass("available"):this.$el.addClass("available"+e.length)),this.worlds.forEach(function(e){this.$("."+e.get("name")+"Info").toggleClass("disabled",!e.get("active")||!e.get("showProgress")),this.$el.toggleClass(e.get("name"),e.get("active"))},this)},updateTimer:function(e,t){var i;this.$("."+e.get("name")+"Info").toggleClass("hasTimer",e.hasTimer()),i=formatTime(86400<=t?"%j"+messages.bonusWorldLeftTime[2]+"%G"+messages.bonusWorldLeftTime[0]:"%H:%i:%s",t),this.$("."+e.get("name")+"Info").toggleClass("started",e.isStarted()),this.$("."+e.get("name")+"Info .bonusWorldTimer").html(i)},updateProgress:function(e,t){var i=this.$("."+e.get("name")+"Info .bonusWorldLevelProgress");if(t>e.get("levelsInEpisode"))return i.addClass("finished"),void i.html("");i.html(t)},selectBonusWorld:function(){var e=this.getActiveWorlds();if(application.windows.anyWindowOpen()&&application.windows.isOpen(BaseForceView)){var t=application.windows.views[0];if(t.model.get("world"))return void this.goToBonusWorld(t.model.get("world"))}1===e.length?this.goToBonusWorld(e[0]):this.showBonusWorldSelectWindow(e)},goToBonusWorld:function(e){e.open()},showBonusWorldSelectWindow:function(e){new BonusWorldSelectWindow({worlds:e})},getActiveWorlds:function(){return this.worlds.filter(function(e){return e.get("active")})},show:function(){this.$el.addClass("active")},hide:function(){this.$el.removeClass("active")}}),gameView,ApplicationView=ApplicationBaseView.extend({events:{"click #coinsBlock":"showAddCoinsWindow","click #livesBlock":"showAddLivesWindow","click #menu .sound":"toggleSound","click #menu .music":"toggleMusic","click #menu .fullScreen":"fullScreen","click #menu .exitFullScreen":"exitFullScreen","click .levels .level":"startLevel","click #startLevel":"startLevel","click #ship":"showNextEpisodeWindow","click .shop":"showShopWindow","click .gacha":"showGachaWindow","click .bonusgameAction":"showBonusgameWindow","click #menu .myAchievmentsBtn":"showAchievmentsWindow","click .menu .menuBtn":"toggleMenu","click .menu .exit":"exit","click .menu .exitBonusWorld":"exitBonusWorld","click .openMessageCenter":"messageCenterShow",click:"hideMenu"},messageCenterShow:function(e){$(e.currentTarget).hasClass("disabled")||new MessageCenterWindow({collection:messageCenter})},hideMenu:function(e){0===$(e.target).parents(".menu").length&&$(".menu").removeClass("opened")},toggleMenu:function(e){$(e.target).parents(".menu").toggleClass("opened")},exit:function(e){new AreYouSureExitWindow({onExit:function(){Game.exit()}})},exitBonusWorld:function(e){Config.bonusWorld&&(Config.bonusWorld.exit(),$(".menu").removeClass("opened"))},keyAction:function(e){var t=e.keyCode||e.which;if(27==t){var i=application.windows.views[0];i&&i.close()}107!=t&&109!=t&&187!=t&&189!=t||(107!=t&&187!=t||(TimeManager.speed+=.1),(109==t||189==t)&&.1<TimeManager.speed&&(TimeManager.speed-=.1),application.toast?application.toast.showMessage({message:"speed changed: "+TimeManager.speed.toFixed(1)}):console.log("speed changed: "+TimeManager.speed.toFixed(1))),13===t&&application&&application.trigger("enterKeyPressed")},showNextEpisodeWindow:function(){application.blockedLevelStart||episode.get("num")>=user.get("episode")&&new EpisodeLockedWindow},showShopWindow:function(e){var t=$(e.currentTarget).data("page");t&&(4!=t||gifts)||(t=0),new ShopWindow({page:t})},showGachaWindow:function(){new GachaWindow},showBonusgameWindow:function(){$(".bonusgameAction").hasClass("forceBlackout")&&!user.get("spins")&&user.set("spins",1),new BonusGameWindow({freeSteps:$(".bonusgameAction").hasClass("forceBlackout")?2:0})},showAchievmentsWindow:function(){new AchievmentsWindow},startLevel:function(e){e.stopPropagation(),e.preventDefault(),episode.playLevel(parseInt($(e.target).attr("data-level")),{showStatistics:!0})},initialize:function(){ApplicationBaseView.prototype.initialize.call(this),this.levelPinsView=new LevelPinsView,application.once("main",function(){$("#menu").show(),gameView=new Config.gameViewClass,application.friendsView=new FriendsView,application.friendsPanelView=new FriendsPanelView,$("#addFriendsBonus").on("click touchend",function(){return user.inviteBestFriends(),!1}),$("#addFriendsBonus").addClass("showAddBonus"),user.checkNeedHelpFriends()?$(".helpFriends").on("click touchend",function(){return new HelpFriendsWindow,!1}):$(".helpFriends").addClass("disabled"),this.bonusworldListButtonViev=new BonusworldListButtonView({worlds:Config.bonusWorlds.filter(function(e){return!e.isSatellite()}).concat(application.cmp(WorldsComponent).getActiveWorlds())}),this.bonusworldListButtonViev.render(),Config.advertisingNetworks&&-1<Config.advertisingNetworks.indexOf(network)&&Config.advertising&&Config.advertising.length&&_.each(Config.advertising,function(t){$("."+t+"Advertising").addClass("available").addClass("v"+(Math.floor(2*Math.random())+1));var e=function(){$("."+t+"Advertising").removeClass("blink").addClass("blink").delay(5e3).queue(function(e){$("."+t+"Advertising").removeClass("blink"),e()})};e(),setInterval(e,2e4)})})},listenToUser:function(){ApplicationBaseView.prototype.listenToUser.call(this),this.renderLives(),user.on("change:showOneMoreLive",this.renderLives,this),user.on("change:lives",this.renderLives,this),user.on("change:timeToNextLife",this.renderLives,this),user.on("createNewGame",this.renderLives,this),user.on("change:shopAvailable",this.renderShopAvailable,this),user.on("change:gachaAvailable",this.renderGachaAvailable,this),user.on("change:bonusGameAvailable",this.renderBonusGameAvailable,this),user.on("change:additionalLivesAvailable",this.renderAdditionalLivesAvailable,this),user.on("change:myAchievmentsAvailable",this.renderMyAchievmentsAvailable,this)},renderAdditionalLivesAvailable:function(){user.get("additionalLivesAvailable")?$(".livesAmulet").show():$(".livesAmulet").hide()},renderShopAvailable:function(){user.get("shopAvailable")?$(".shopBlock").show().addClass("shopBlockAppear"):$(".shopBlock").hide()},renderMyAchievmentsAvailable:function(){user.get("myAchievmentsAvailable")?$(".myAchievmentsBlock").show():$(".myAchievmentsBlock").hide()},renderGachaAvailable:function(){user.get("gachaAvailable")?$(".gachaBlock").show().addClass("gachaBlockAppear"):$(".gachaBlock").hide()},renderBonusGameAvailable:function(){user.get("bonusGameAvailable")?$(".bonusgameAction").show():$(".bonusgameAction").hide()},renderLives:function(){if(!(window.mobile&&Game&&Game.get("isPlaying"))){var e=user.get("lives");(Game&&Game.get("isPlaying")&&"bonus"!==application.level.num||user.get("showOneMoreLive"))&&(e=Math.min(e+1,Config.maxLives));var t=$("#livesBlock");t.find(".lifeProgress").css("width",100*e/Config.maxLives+"%"),t.find(".lifesBlockIco").html(e),t.find(".livesAmount").html(e),0===e?$("#addLifesBuy").removeClass("disabled"):$("#addLifesBuy").addClass("disabled"),e<Config.maxLives&&0<=user.get("timeToNextLife")?($("#addLivesTimer").html(formatTime("%i:%s",user.get("timeToNextLife"))),$("#addLivesTimerBlock").removeClass("fullLivesTimer"),t.addClass("timerOn")):($("#addLivesTimerBlock").addClass("fullLivesTimer"),$("#addLivesTimer").html(messages.fullLivesTimer),t.removeClass("timerOn"))}},showAddLivesWindow:function(){new AddLivesWindow}}),PunishCannon=Backbone.Model.extend({initialize:function(){$(".punish").hide(),Config.punish&&Config.punish.minLevel<=user.getRealLevel()&&"bonus"!==application.level.num&&(Game.on("endTurn",this.render,this),Game.on("change:fullRunning",function(){Game.punishShowed&&(Game.get("fullRunning")?$(".punish").addClass("stable"):$(".punish").removeClass("stable"))}))},render:function(){Game.get("moves").get()>Config.punish.showAfterMovesAmount&&void 0!==Config.punish.showAfterMovesAmount||this.show()},shot:function(e){Game.set("suggestSwitch",!1),application.playSound("star3"),$(".punish").addClass("using");var t=Game.animate(function(){$(".punish").removeClass("using")}),r=this.$gun?this.$gun:FigureView.createByTemplate(".invisible .punishCannon"),i=!!this.$gun;_Figure.blockedAnimations.append(r),r.animationByName("punishAppear").queue(function(n){r.addClass("animated");!function e(t){if(!t)return r.removeClass("animated"),void n();application.playSound("multicolor");var i=[];if(Game.each(function(e){e.isRemovable()&&i.push(e)}),0<i.length){i=_.shuffle(i);var o=!1;o||(o=i[0]);var a=FigureView.createByTemplate(".invisible .punishCannonExplosion");_Figure.blockedAnimations.append(a),a.alignTo(o.$div),a.sprite.on("round",function(){a.remove()}),o.remove()}canvas.timeManager.setTimeout(function(){e(t-1)},150)}(40)}).animationByName("punishDisappear").queue(function(e){i||r.remove(),e(),t()})},show:function(){if(!Game.punishShowed)if(window.mobile&&-1===_.indexOf(["mailru","odnoklassniki"],network)){Game.set("suggestSwitch",!1),application.playSound("star3"),this.$gun=FigureView.createByTemplate(".invisible .punishCannon");var e=Application.horizontalOrientation?"horizontal":"vertical";this.$gun.addClass(e),_Figure.blockedAnimations.append(this.$gun),this.$gun.addClass("appear").delay(1e3).queue(function(e){$(".punish").css("z-index",3).show(),user.get("freePunish")&&$(".punish").addClass("free"),Game.punishShowed=!0,e()})}else user.get("freePunish")&&$(".punish").addClass("free"),$(".punish").css("opacity",1).show().addClass("appear"),Game.punishAppearTimeout=canvas.timeManager.setTimeout(function(){$(".punish").removeClass("appear"),Game.get("fullRunning")&&$(".punish").addClass("stable"),Game.punishAppearTimeout=!1},Config.punish.appearTimeout),Game.punishShowed=!0},hide:function(){if(Game.punishShowed)if(window.mobile&&-1===_.indexOf(["mailru","odnoklassniki"],network)){if($(".punish").css("z-index",0).hide(),this.$gun){var t=this.$gun;t.addClass("disappear").delay(1e3).queue(function(e){t.remove(),Game.punishShowed=!1,e()})}}else $(".punish").removeClass("appear").removeClass("stable").fadeOut(300),Game.punishAppearTimeout&&(canvas.timeManager.clearTimeout(Game.punishAppearTimeout),Game.punishAppearTimeout=!1),Game.punishShowed=!1}}),Game,GameBaseView=Backbone.View.extend({el:"#game",events:{"click #exit":"exit"},exit:function(e){new AreYouSureExitWindow({onExit:function(){Game.exit()}})},getCell:function(e){e.originalEvent&&e.originalEvent.touches&&(e=e.originalEvent.touches[0]);var t=e.pageX-this.fieldOffset.left;t=Math.floor(t/Config.cellWidth);var i=e.pageY-this.fieldOffset.top;return i=Math.floor(i/Config.cellHeight),!!Game.inField(t,i)&&(!Game.field[i][t].forceDisabled&&Game.field[i][t])},fallDownExplodePiece:function(i){var o=i.getCoords(),a=300-Math.floor(600*Math.random()),n=Math.floor(400*Math.random()+300),r=1;a<0&&(r=-1),i.animate({},Math.floor(400*Math.random()+800),"linear",function(){i.remove()},function(e){var t=i.model;t.x=o.x+a*e,t.y=o.y-n*e+1500*e*e,t.rotate=400*e*r,i.modelChanged=!0})},fallDownExplodeWithoutRemove:function(e,t,i){if(e.length)for(var o=1;o<=t;o++){var a=GameBaseView.createFallDownExplodePieceProxy(i+o,i+o,i);_Figure.blockedAnimations.append(a),a.alignTo(e),window.mobile&&o++,a instanceof ProxyFigure||this.fallDownExplodePiece(a)}},fallDownExplode:function(e,t,i){if(e.length){for(var o=1;o<=t;o++){var a=GameBaseView.createFallDownExplodePieceProxy(i+o,i+o,i);_Figure.blockedAnimations.append(a),a.alignTo(e),window.mobile&&o++,a instanceof ProxyFigure||this.fallDownExplodePiece(a)}e.remove()}},createFieldBackground:function(){FigureView.findById("fieldBlock").empty(),Game.on("createFieldBackground",function(e,t,i){var o=FigureView.createByTemplate(".invisible .cellBgTemplate",["cellBg_"+(e+t)%2]);i.right&&o.addClass("cellBGLastHor"),i.down&&o.addClass("cellBGLastVer"),o.set({x:t*Config.cellWidth,y:e*Config.cellHeight}),FigureView.findById("fieldBlock").append(o)})},onWin:function(){if(this.clear(),this.gameStarted=!1,Config.noLifesInGame||"bonus"===application.level.num||(this.shouldUseBonusWorldLives()||user.addLifeOnWin(),episode.isBonusWorld()&&Config.bonusWorld.onWinBonusWorldLevel&&Config.bonusWorld.onWinBonusWorldLevel(episode.absoluteLevelNumber(application.level.num)),user.set({actionName:"win game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0})),episode.isForceEpisode())application.emit("winForceLevel").then(function(){return application.set("page","main")});else if("bonus"!==application.level.num){var e=!episode.scores.find({level:application.level.num});episode.scores.addOrUpdateScore(application.level.num,Game.get("score")),episode.isBonusWorld()&&Config.bonusWorld.onCompleteBonusWorldLevelBeforeStatistic&&Config.bonusWorld.onCompleteBonusWorldLevelBeforeStatistic(episode.absoluteLevelNumber(application.level.num),Game);var t=new StatisticAfterWindow({level:application.level.num,score:Game.get("score"),onOpen:function(){episode.isBonusWorld()&&Config.bonusWorld.onShowStatisticWindow(episode.absoluteLevelNumber(application.level.num),this)}});if(t.once("close",function(){t.hasClickByReplayButton||(episode.isBonusWorld()?Config.bonusWorld.onCompleteBonusWorldLevel&&Config.bonusWorld.onCompleteBonusWorldLevel(episode.absoluteLevelNumber(application.level.num),Game):socialNetwork.onCompleteLevel&&socialNetwork.onCompleteLevel(episode.absoluteLevelNumber(application.level.num)),1===episode.get("num")&&1===application.level.num&&firstSessionLogger.logEvent("win 1st game"))}),"phonegap"===network&&e){var i=20*(episode.get("num")-1)+application.level.num;10<=i&&(parent.postMessage({name:"logFbEvent",eventName:"fb_mobile_level_achieved",params:{fb_level:i}},"*"),parent.postMessage({name:"logAppsflyerEvent",eventName:"af_level_achieved",params:{af_level:i}},"*"),10==i&&parent.postMessage({name:"logAppsflyerEvent",eventName:"af_tutorial_completion",params:{}},"*"),61==i&&parent.postMessage({name:"logAppsflyerEvent",eventName:"af_lvl61",params:{}},"*"))}e&&user.get("episode")<20&&callService("../../../levelbase/src/services/levelpassstat.php",_.noop,_.noop,{action:"levelPass"})}else new BonusLevelDoneWindow;application.trigger("game_win",Game)},onFail:function(){if(this.clear(),this.gameStarted=!1,Config.noLifesInGame)Config.noLifesInGame&&application.set("page","main");else if(episode.isForceEpisode())application.set("page","main");else if("bonus"!==application.level.num){if(episode.isBonusWorld()&&Config.bonusWorld.onFailBonusWorldLevel&&Config.bonusWorld.onFailBonusWorldLevel(),this.shouldUseBonusWorldLives()){var e={actionName:"lose game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0};user.set(e)}else user.addAndRemoveLifeOnLoseGame();new FailedWindow({level:application.level.num})}else new BonusLevelFailWindow;application.trigger("game_fail")},shouldUseBonusWorldLives:function(){return episode.isBonusWorld()&&Config.bonusWorld.hasOwnLives()},clear:function(){canvas.stop(),Game.onFinishAnimations=function(){},Game.off(),user.set("usedPowerUps",{})},beforeStart:function(){application.set("page","game")},afterStart:function(){if(canvas.initLayout(),this.listenToGame(),application.trigger("playGame",Game),Game.on("start",fixOperaAnimation),window.testRun||(Game.on("win",this.onWin,this),Game.on("fail",this.onFail,this)),this.subscribeToFpsStat(),1===episode.get("num")&&1===application.level.num&&firstSessionLogger.logEvent("1st game started"),!getLocalStorage("hiRes")){var e=setTimeout(_.bind(this.checkHiRes,this),2e3);Game.on("win fail",function(){clearInterval(e)})}},subscribeToFpsStat:function(){var e=setTimeout(_.bind(this.saveFpsStat,this),2e4);Game.on("win fail",function(){clearInterval(e)})},checkHiRes:function(){var e=canvas.fpsCounter.getStats().getPercentile(10);(Config.fpsHires?Config.fpsHires:40)<=e&&(Config.hiRes=!0,getLocalStorage("hiRes")||setLocalStorage("hiRes",!0))},saveFpsStat:function(){if(Config.statistics){var e=!Config.statistics.throttle||Math.random()<Config.statistics.throttle;if(Config.statistics.fps&&e){var t=application.system.version;window.mobile&&(t=application.system.device?application.system.device:application.system.os);var i=canvas.fpsCounter.getStats();callService("../../../levelbase/src/services/fpsstat.php",_.noop,_.noop,{fps:i.getPercentile(10),mobile:window.mobile?1:0,browser:application.system.browser,version:t})}}},playNow:function(){var e=this;return Promise.resolve().then(function(){return application.emit("startLevel")}).then(function(){e.beforeStart(),Game=new Config.gameClass,e.afterStart(),canvas.start()})},start:function(e,t){if(application.level=JSON.parse(JSON.stringify(episode.get("levels")[e])),application.level.num=e,void 0===t&&(t={}),application.level.startParams=t,user.set("usedPowerUps",{}),!Config.noLifesInGame&&"bonus"!==application.level.num&&"forcelevel"!==episode.get("num"))if(this.shouldUseBonusWorldLives()){if(!Config.bonusWorld.hasLives()){var i=Config.bonusWorld.get("livesInstance");return i&&i.openAddLivesWindow(),!1}}else if(!user.removeLifeOnStartGame())return!1;this.gameStarted=!0;var o=_.bind(this.playNow,this);if(episode.isBonusWorld()){if(Config.bonusWorld.onStartBonusWorldLevel&&Config.bonusWorld.onStartBonusWorldLevel(e),Config.bonusWorld.backToFirstLevelAfterFail&&1<e&&callServiceAddInQueue("../../../levelbase/src/services/changescore.php",{episode:episode.get("num"),level:e,score:0,stars:0}),Config.bonusWorld.eachLevelRandom)return void new SelectRandomLevelWindow({callback:o,startLevel:e})}else socialNetwork.onStartLevel&&socialNetwork.onStartLevel(episode.absoluteLevelNumber(e));return this.preloadResource(o),!0},preloadResource:function(e){e()},listenToGame:function(){}},{createFallDownExplodePiece:function(e,t){var i=FigureView.createByTemplate(".invisible .fallDownPieceTemplate",t?[e,t]:[e]);return _Figure.blockedAnimations.append(i),i},createFallDownExplodePieceProxy:createProxy(function(e,t){return FigureView.createByTemplate(".invisible .fallDownPieceTemplate",t?[e,t]:[e])},100)});Application.on("ready",function(){getLocalStorage("hiRes")&&(Config.hiRes=!0)});var ThreeInRowBaseView=GameBaseView.extend({events:{"click #exit":"exit","click .exit":"exit","click .punish":"punishWindow"},punishWindow:function(){Game.get("fullRunning")&&!Game.isAnimationRunning()&&new PunishWindow},addMoves:function(e,t){var i=!!(this.lastAddMovesTime&&Date.now()-this.lastAddMovesTime<3e3);this.addMovesInProcess&&i||(this.addMovesInProcess=!0,this.lastAddMovesTime=Date.now(),this.addMovesOnSuccessCallback=e,this.addMovesOnCancelCallback=t,this.$(".addMoves").hide(),this.selectedFriendForAddMoves&&!0!==this.selectedFriendForAddMoves?socialNetwork.sendRequest({type:"addMovesThanks",userIds:[this.selectedFriendForAddMoves],message:RANDOM(messages.thanksForAddMoves),success:this.addMovesOnSuccess,cancel:this.addMovesOnCancel,veryImportant:!0}):this.addMovesOnCancel())},addMovesOnSuccess:function(){this.addMovesInProcess=!1;var e=[this.selectedFriendForAddMoves];e&&e.length&&(Game.set("moves",new ObscureNumber(Game.get("moves").get()+Config.amountMovesByInviteFriend)),application.playSound("addMoves"),callServiceAddInQueue("../../../levelbase/src/services/sendgifts.php",{userIds:e.join(","),fromAddMoves:1}),user.set("sometimeMakeAGift",1),user.selectedForGifts=_.difference(user.selectedForGifts,e),this.selectedFriendForAddMoves=!1,_.isFunction(this.addMovesOnSuccessCallback)&&this.addMovesOnSuccessCallback())},addMovesOnCancel:function(){this.addMovesInProcess=!1,_.isFunction(this.addMovesOnCancelCallback)&&this.addMovesOnCancelCallback()},addBombMoves:function(e,t){this.addBombsInProcess||(this.addBombsInProcess=!0,this.addBombMovesOnSuccessCallback=e,this.addBombMovesOnCancelCallback=t,this.selectedFriendForAddBombMoves&&!0!==this.selectedFriendForAddBombMoves?socialNetwork.sendRequest({type:"addMovesThanks",userIds:[this.selectedFriendForAddBombMoves],message:RANDOM(messages.thanksForAddMoves),success:this.addBombMovesOnSuccess,cancel:this.addBombMovesOnCancel,veryImportant:!0}):this.addBombMovesOnCancel())},addBombMovesOnSuccess:function(){this.addBombsInProcess=!1;var e=[this.selectedFriendForAddBombMoves];e&&e.length&&(BombCell.addBombMoves(Config.amountBombMovesByInviteFriend),application.playSound("addBombMoves"),callServiceAddInQueue("../../../levelbase/src/services/sendgifts.php",{userIds:e.join(","),fromAddMoves:1}),user.set("sometimeMakeAGift",1),user.selectedForGifts=_.difference(user.selectedForGifts,e),this.selectedFriendForAddBombMoves=!1,_.isFunction(this.addBombMovesOnSuccessCallback)&&this.addBombMovesOnSuccessCallback())},addBombMovesOnCancel:function(){this.addBombsInProcess=!1,_.isFunction(this.addBombMovesOnCancelCallback)&&this.addBombMovesOnCancelCallback()},clear:function(){GameBaseView.prototype.clear.call(this),Game.set("isPlaying",!1),void 0!==this.powerUpsView&&this.powerUpsView.off(),this.tasksView.off()},beforeStart:function(){var e=application.level.num;if(GameBaseView.prototype.beforeStart.call(this),episode.get("about").stack&&episode.get("about").stack[e]&&(application.level.stack=episode.get("about").stack[e]),"bonus"!=e){var t=episode.absoluteLevelNumber(application.level.num);this.$("#currentLevel").text(t).attr("class",function(e,t){return t.replace(/\bsize\d+\b/g,"")}).addClass("size"+String(t).length)}},initialize:function(){this.gameMessageView=new GameMessageView,void 0!==GameProgressView&&Config.gameProgressOnCanvasEnabled&&(this.gameProgressView=new GameProgressView),application.on("change:page",function(){Application.horizontalOrientation?$("#gameProgressLine").css("height","0%"):$("#gameProgressLine").css("width","0%"),$(".scoreMark").removeClass("complete")}),this.enableAddMove=0<this.$(".addMoves").size(),this.listenTo(Application,"changeOrientation",this.onChangeOrientation),_.bindAll(this,"addMovesOnSuccess","addMovesOnCancel","addBombMovesOnSuccess","addBombMovesOnCancel")},onChangeOrientation:function(){},renderExit:function(){Game.get("fullRunning")?$("#exit").show():$("#exit").hide()},createControllers:function(){MovesController(),FloorController(),FieldController()},clearAndHideForNewGame:function(){Application.horizontalOrientation?$("#gameProgressLine").css("height","0%"):$("#gameProgressLine").css("width","0%"),$("#gameScore").text(0),$(".scoreMark").removeClass("complete"),this.$(".addMoves").hide(),Game.set("coinsOnFieldProb",0),is_android_browser?FigureView.findById("fieldContainer").css({opacity:0}):$("#canvas").css({opacity:0}),$("#game").removeClass("canvasShow"),$("#tasksBlock").hide(),user.trigger("createNewGame")},createTasks:function(){this.tasksView=new TasksView({tasks:Game.tasks})},preparePowerUps:function(){var e=application.level.num;if(user.needForceNow()){var t=episode.get("about").force[e][0].powerUpForce;"forcelevel"!==episode.get("num")&&t&&user.setPowerUpAmount(t,3)}this.powerUpsView=new PowerUpsView({collection:user.powerUps})},isHelpFromFriendsApplicable:function(){return user.get("friendsHelpSended")&&0<user.get("friendsHelpSended")&&user.get("level")==application.level.num&&user.get("episode")==episode.get("num")},addMovesFromFriends:function(e){if(this.isHelpFromFriendsApplicable()){if(2===user.get("friendsHelpSended"))return Game.set("moves",new ObscureNumber(Game.get("moves")+Config.friendsHelpMoves)),void e();user.set("friendsHelpSended",2);var t=$(".invisible .plus3MessageBlock").clone();$(".blockedAnimations").addClass("plus3Moves").append(t),application.playSound("addMovesFromFriend"),t.hide().fadeIn(300).delay(500).queue(function(e){t.addClass("gameMessageBlockAnimation"),e()}).delay(1e3).queue(function(e){Game.set("moves",new ObscureNumber(Game.get("moves")+Config.friendsHelpMoves)),e()}).fadeOut(300,function(){$(".blockedAnimations").removeClass("plus3Moves"),t.remove(),e()})}else e()},appearTasks:function(t){var i=this.tasksView.tasks;$("#tasksBlock").toggleClass("oneTask",1===i.length).toggleClass("twoTasks",2===i.length).toggleClass("threeTasks",3===i.length).show().delay(300).queue(function(e){e(),Config.appearTasksWithoutWait?t():(i.each(_.bind(function(e,t){e.$div.find(".taskIco").delay(500*t).queue(function(e){e(),application.playSound("showTasks")}).ourAnimate({scale:1.5},250).ourAnimate({scale:1},250)},this)),setTimeout(t,500*i.length+500))})},appearField:function(e){if(application.playSound("showField"),is_android_browser?FigureView.findById("fieldContainer").show():$("#canvas").css({opacity:1}),$("#game").addClass("canvasShow"),episode.isBonusWorld()){var t=Config.bonusWorld.getCurrentLevel();$("#game").addClass("levelNow"+t)}setTimeout(e,1e3)},forceAndRun:function(){user.needForceNow()?(new ForceView({type:episode.get("about").force[application.level.num],step:1}),user.isBlockedByForce()||Game.set("fullRunning",!0)):Game.set("fullRunning",!0);var e=episode.absoluteLevelNumber(application.level.num);application.playedLevels[e]=!0},appearSimpleLevel:function(){this.createTasks(),this.preparePowerUps(),application.beforeGameStart=!0,application.trigger("beforeGameStart",Game),this.appearTasks(_.bind(function(){this.appearField(_.bind(function(){this.addMovesFromFriends(_.bind(this.forceAndRun,this)),Game.start()},this))},this))},afterStart:function(){GameBaseView.prototype.afterStart.call(this),this.createControllers(),this.clearAndHideForNewGame(),this.prepareLevel(),Game.prepare(),Config.gameControllers(),this.appearSimpleLevel()},prepareLevel:_.noop,renderPunish:function(){Game.get("moves").get()>Config.punish.showAfterMovesAmount&&void 0!==Config.punish.showAfterMovesAmount||this.showPunish()},hidePunish:function(){Game.punishShowed&&($(".punish").removeClass("appear").removeClass("stable").fadeOut(300),Game.punishAppearTimeout&&(canvas.timeManager.clearTimeout(Game.punishAppearTimeout),Game.punishAppearTimeout=!1),Game.punishShowed=!1)},showPunish:function(){Game.punishShowed||(user.get("freePunish")&&$(".punish").addClass("free"),$(".punish").css("opacity",1).show().addClass("appear"),Game.punishAppearTimeout=canvas.timeManager.setTimeout(function(){$(".punish").removeClass("appear"),Game.get("fullRunning")&&$(".punish").addClass("stable"),Game.punishAppearTimeout=!1},Config.punish.appearTimeout),Game.punishShowed=!0)},globalClasses:function(){var e=["episode_"+episode.get("num"),"level_"+application.level.num,"locale_"+locale,"network_"+network,"episode_common"];return episode.isBonusWorld()&&(e=e.concat(episode.getWorld().getGameClasses())),Application.horizontalOrientation?e.push("horizontalOrientation"):e.push("verticalOrientation"),e},listenToGame:function(){_Figure.blockedAnimations.removeClass("episode_"+episode.get("num"));var e=[$("#game"),FigureView.findById("layer")],i=this.globalClasses();_.each(e,function(t){t.removeClass(),_.each(i,function(e){t.addClass(e)})}),FigureView.findById("layer").addClass("layer"),FigureView.cachedTemplates={},FigureView.cacheTemplates(),$(".blockedAnimations").empty(),this.selectedFriendForAddMoves=!0,this.selectedFriendForAddBombMoves=!0,this.gameMessageView.listenToGame(),void 0!==this.gameProgressView&&this.gameProgressView.listenToGame(),void 0!==GameFieldPointsView&&new GameFieldPointsView,"gems"==project?this.punishCannon=new PunishCannon:($(".punish").hide(),Config.punish&&Config.punish.minLevel<=user.getRealLevel()&&"bonus"!==application.level.num&&(Game.on("endTurn",this.renderPunish,this),Game.on("change:fullRunning",function(){Game.punishShowed&&(Game.get("fullRunning")?$(".punish").addClass("stable"):$(".punish").removeClass("stable"))}))),Game.on("change:fullRunning",function(){this.renderExit(),Game.get("fullRunning")?$("#game").addClass("fullRunningNow"):$("#game").removeClass("fullRunningNow")},this),this.renderExit(),Game.once("change:fullRunning",function(){application.beforeGameStart=!1}),Game.on("outOfMoves",function(){application.windows.closeAll(),new OutOfMovesWindow}),Game.on("refuseBuyMoves",function(e){var t=!1,i=!episode.isBonusWorld()||Config.bonusWorld.get("isFreeEpisode")?application.getExternalWorld():Config.bonusWorld;i&&(i.getComponents().forEach(function(e){e.hasAnythingCollected&&e.hasAnythingCollected()&&(t=!0)}),t&&(e.exitGameOnCancel=!1,new TriesReminderWindow({})))}),this.createFieldBackground(),"bonus"!==application.level.num&&(this.scoreObject=new Score({level:application.level.num,score:0}),void 0===this.gameProgressView&&this.animateCompleteStars()),Game.on("vortex",function(e){application.playSound("vortex");var t=FigureView.createByTemplate(".invisible .vortexTemplate");_Figure.field.append(t),canvas.timeManager.setTimeout(function(){t.fadeOut(200,function(){this.remove(),e()})},300)});var t=window.mobile?2e3:20;Game.on("change:score",canvas.timeManager.throttle(this.onChangeScore,t,{leading:!1}),this)},onChangeScore:function(){},preloadResource:function preloadResource(callback){var level=application.level,bonusWorld=Config.bonusWorld,usedFeatures=["base"],key;if("string"==typeof episode.get("num")&&usedFeatures.push(episode.get("num")),_.each(_.uniq((level.map||[]).join("").split("").concat(level.colors.split(""))),function(e){var t="map_"+e;Preloader.Config[t]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[t])}),"bonus"===level.num&&usedFeatures.push("bonuslevel"+(episode.get("num")-1)%3),_.each(_.uniq((level.decorators||[]).join("").split("")),function(e){var t="decorators_"+e;Preloader.Config[t]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[t])}),_.isEmpty(level.bossName)||usedFeatures.push(level.bossName),level.gull&&usedFeatures.push("gull"),_.each(_.uniq((level.cellAttribute||[]).join("").split("")),function(e){var t="cellAttribute_"+e;Preloader.Config[t]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[t])}),_.each(_.uniq((level.cellSecondAttribute||[]).join("").split("")),function(e){var t="cellSecondAttribute_"+e;Preloader.Config[t]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[t])}),_.each(_.uniq((level.floorAttribute||[]).join("").split("")),function(e){var t="floorAttribute_"+e;Preloader.Config[t]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[t])}),level.squirrel&&(usedFeatures.push("squirrel"),usedFeatures.push("nut")),level.objects&&_.each(level.objects,function(data){var cls=eval(data.code),object=new cls(data);Array.prototype.push.apply(usedFeatures,object.getUsedFeatures())}),application.cmp(WorldsComponent).getActiveWorlds().forEach(function(e){var t=e.getComponent(PrizeMarksDropper);if(t){var i=t.get("markKey");Array.prototype.push.apply(usedFeatures,[i])}}),bonusWorld&&bonusWorld.get("name")===episode.get("num")){if(bonusWorld.getComponent(PrizeMarksDropper)){var prizeMarkKey=bonusWorld.getComponent(PrizeMarksDropper).get("markKey");Array.prototype.push.apply(usedFeatures,[prizeMarkKey])}if(bonusWorld.hasComponent("droppers")&&bonusWorld.getComponent("droppers").droppers.forEach(function(e){var t=e.get("markKey");Array.prototype.push.apply(usedFeatures,[t])}),bonusWorld.hasComponent(ArtifactController)){var dropper=bonusWorld.getComponent(ArtifactController).get("artifactWorkshop").partSource;dropper&&dropper.get("featureToPreloadResource")&&dropper.get("featureToPreloadResource").chars&&dropper.get("featureToPreloadResource").chars.split().forEach(function(e){e&&usedFeatures.push(Preloader.Config["map_".concat(e)])})}Array.prototype.push.apply(usedFeatures,bonusWorld.get("features"))}Array.prototype.push.apply(usedFeatures,featuresAdder.commonFeatures),_.each(level.task,function(task){"CollectType"!=task.type&&"CollectColor"!=task.type||(key="map_"+task.cell,Preloader.Config[key]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[key])),eval(task.type).prototype instanceof ClearCellAttributes&&(key="cellAttribute_"+task.cell,Preloader.Config[key]&&Array.prototype.push.apply(usedFeatures,Preloader.Config[key]))}),level.candyContent&&Preloader.Config["map_"+level.candyContent]&&(usedFeatures=usedFeatures.concat(Preloader.Config["map_"+level.candyContent]));var subFeatures=[];_.each(usedFeatures,function(e){var t="feature_"+e;Preloader.Config[t]&&Array.prototype.push.apply(subFeatures,Preloader.Config[t])}),subFeatures.length&&(usedFeatures=usedFeatures.concat(subFeatures));var needPreload=_.any(usedFeatures,function(e){return void 0===application.preloader.getFeatureStatus(e)});if(usedFeatures=_.unique(usedFeatures),level.usedFeatures=usedFeatures,needPreload){var waitWindow=new WaitWindow;setTimeout(function(){var t=_.after(usedFeatures.length+1,function(){waitWindow.close(),callback()});Promise.resolve().then(function(){return application.emit("preloadLevel")}).then(t),_.each(usedFeatures,function(e){application.preloader.preloadFeature(e,t)})},50)}else application.emit("preloadLevel").then(function(){return callback()})},animateCompleteStars:function(){this.scoreObject.on("change:stars",function(e,t){for(var i=1;i<=t;i++)$("#scoreMark"+i).addClass("complete"),i===t&&(window.mobile||$("#scoreMark"+i).find(".scoreMarkStars").ourAnimate({scale:1.5},300).ourAnimate({scale:1},300),gameView.lineTimeout=!1,application.playSound("getStar"))})}}),GemsView=ThreeInRowBaseView.extend({start:function(e,t){return!(window.mobile&&Config.specialLevelsTest&&episode.isSpecialLevel(e))||t&&t.startSpecialLevel?GameBaseView.prototype.start.call(this,e,t):(new SpecialLevelWindow({level:e}),!1)},punish:function(e){this.punishCannon.shot(e)},onWin:function(){var e=_.bind(function(){var g=0;if("bonus"!==application.level.num)if(0===Game.get("moves"))canvas.timeManager.setTimeout(_.bind(function(){_Figure.blockedAnimations.empty(),GameBaseView.prototype.onWin.call(this)},this),500);else{application.playSound("gameFinalBonus");for(var u=0,h=Game.get("moves").get(),e=function(t){var e,i;0===t&&(e=1,30<h?e=10:10<h&&(e=5),i=h-=e);var o=_Figure.blockedAnimations.offset(),a=$("#moves").offset();a.x=a.left-o.left+15,a.y=a.top-o.top-16;var n=$(".gameProgress").offset(),r={height:$(".gameProgress").height(),width:$(".gameProgress").width()},s=FigureView.find(".gameProgress");s.classes&&s.classes.gameProgress&&(n=s.offset(),r.height=s.attrs.height,r.width=s.attrs.width),Application.horizontalOrientation?(n.left=n.left-o.top-30,n.top=n.top-o.top+r.height*(.5*Math.random()+.3)-50):(n.top=n.top-o.top-30,n.left=n.left-o.left+r.width*(.5*Math.random()+.3)-50);var l=FigureView.createByTemplate(".invisible .fallingStar",[]),d=.5+.3*Math.random();l.set({x:a.x,y:a.y,opacity:0}),_Figure.blockedAnimations.append(l),l.delay(u).queue(function(e){0===t&&Game.set("moves",new ObscureNumber(i)),e()});var c=Math.floor(300*Math.random()+200);l.set({scale:0}),l.ourAnimate({scale:d,opacity:1},200,"linear");l.animate({},Math.floor(400*Math.random()+1e3),"linear",function(){0===t&&(Game.set("score",Game.get("score")+100*Math.floor(e*GameScores.leftMove*(3.5+Math.random())/100)),application.playSound("gameFinalBonusAddScores")),l.remove(),p()},function(e){l.set({x:a.x+(n.left-a.x)*e,y:a.y+(n.top-a.y+c)*e*e-c*e,rotate:600*e})}),u+=(200*Math.random()+300)/g},t=0;0<h;){g=Math.floor(3*Math.random())+1,window.mobile&&(g=1);for(var i=0;i<g;i++)++t,e(i)}var o=_.bind(function(){this.$gameScoreFigure&&(this.$gameScoreFigure.clearQueue(),this.$gameScoreFigure.reCalculateStylesRec()),_Figure.blockedAnimations.empty(),GameBaseView.prototype.onWin.call(this)},this),p=_.after(t,o);0===t&&o(),canvas.timeManager.setTimeout(function(){application.stopSound("gameFinalBonus")},u+900)}else soundManager.stopMusic(),this.tasksView.animateWin(_.bind(function(){_Figure.blockedAnimations.empty(),GameBaseView.prototype.onWin.call(this)},this))},this);FigureView.findById("fieldContainer").ourAnimate({opacity:0},1e3,"linear",function(){this.remove(),e()})},forceAndRun:function(){ThreeInRowBaseView.prototype.forceAndRun.call(this),user.skipLevelForceOnce=!1},processStarInField:function(e){if(e||goods.checkProduct("starInField")){if(Game.isAnimationRunning())return void Game.once("endTurn",this.processStarInField,this);var t=[];if(Game.each(function(e){e.constructor===Cell&&!e.decorator&&e.isRemovable()&&t.push({x:e.x,y:e.y})}),0<t.length){Game.set("fullRunning",!1);var i=RANDOM(t),o=Game.field[i.y][i.x],a=Game.animate(),n=$('<div class="starStuff"><div class="starStuffLightning"></div></div>');o.x<4&&n.addClass("rightStarStuff");var r=o.$div.offset(),s=$(".blockedAnimations").offset();n.css({left:r.left-s.left+"px",top:r.top-s.top+"px"}).css({opacity:0}),$(".blockedAnimations").append(n),n.animate({opacity:1},800,function(){application.playSound("processStarInField"),n.addClass("starStuffTurn").delay(200).queue(function(e){o.$div.ourAnimate({dy:-5},120,"linear").ourAnimate({dy:5},90,"linear").ourAnimate({dy:-5},60,"linear").ourAnimate({dy:5},40,"linear"),o.$div.ourAnimate({dy:-5},30,"linear").ourAnimate({dy:5},30,"linear",function(){o.bRemoveByStar=!0,o.remove(!0);var e=new MultiColorCell(i.y,i.x);Game.addItem(e,!0),Game.set("fullRunning",!0),a()}),$(this).addClass("starStuffLightingProcess").delay(500).queue(function(e){$(this).removeClass("starStuffLightingProcess").animate({opacity:0},500,function(){$(this).remove()}),e()}),e()})})}}},processAddThreeMoves:function(){if(goods.checkProduct("addThreeMoves")){if(Game.isAnimationRunning())return void Game.once("endTurn",this.processAddThreeMoves,this);var e=Game.animate(),t=$('<div class="sandClock"></div>');this.$("#movesBlock").append(t),window.mobile?$("#moves").css({transition:"font 0.3s ease","font-size":"40px"}):$("#moves").delay(600).ourAnimate({scale:1.15},200,"linear"),application.playSound("processAddThreeMoves"),t.hide().fadeIn(800).ourAnimate({rotate:"+=120deg"},400,"linear",function(){application.playSound("processAddThreeMovesAnimation"),Game.set("moves",new ObscureNumber(Game.get("moves").get()+1))}).ourAnimate({rotate:"+=120deg"},400,"linear",function(){application.playSound("processAddThreeMovesAnimation"),Game.set("moves",new ObscureNumber(Game.get("moves").get()+1))}).ourAnimate({rotate:"+=120deg"},400,"linear",function(){application.playSound("processAddThreeMovesAnimation"),Game.set("moves",new ObscureNumber(Game.get("moves").get()+1)),e(),$(this).fadeOut(300,function(){$(this).remove(),window.mobile&&$("#moves").css({transition:"none","font-size":"34px"})}),$("#moves").ourAnimate({scale:1},300,"linear")})}},processPassives:function(){"bonus"!=application.level.num&&(this.processStarInField(),this.processAddThreeMoves())},prepareLevel:function(){"bonus"===application.level.num&&this.prepareBonusLevel()},prepareBonusLevel:function(){this.$("#bonusLevelPrizes").css({left:"672px",top:"564px",width:"76px",height:"62px"}).removeClass("bonusLevelPrizeOpen"),Game.set({crystalsOnField:!0,fallDownCrystalCells:application.level.crystals});for(var e=0;e<Config.rows;e++)for(var t=0;t<Config.cols;t++)"A"==application.level.map[e].charAt(t)&&Game.set({crystalsOnField:!1,fallDownCrystalCells:Game.get("fallDownCrystalCells")-1})},animate:function(e,t,i,o,a){var n=featuresAdder.getActiveFeatureStyle(e),r=animationConfig.getMethod(n,t);r?r(i,o,a):i()},appearSimpleLevel:function(){"bonus"===application.level.num?this.appearBonusLevel():ThreeInRowBaseView.prototype.appearSimpleLevel.call(this)},appearBonusLevel:function(){soundManager.stopMusic(),Game.once("change:fullRunning",function(){soundManager.playMusic("bonuslevelmusic")});var e=new CollectCrystals({amount:application.level.crystals});this.tasksView=new BonusLevelTaskView({model:e}),this.appearField(function(){new(BonusLevelBeginWindow.extend({onOpen:function(){Game.start(),BonusLevelBeginWindow.prototype.onOpen.call(this)}}))})},appearTasks:function(t){if(window.mobile){var i;$("#tasksBlock")[0].style.display="",this.$task=$(".beforeGameTask"),this.$task.removeClass().addClass("beforeGameTask"),$(".beforeGameTasks").empty(),Game.each(function(e){if(e instanceof BossCell&&!(e instanceof CoinChestCell))return i=e.name,!1}),gameView.tasksView.tasks.each(_.bind(function(e){var t;t=$(".invisible .task."+e.get("cssClass")).length?$(".invisible .task."+e.get("cssClass")).clone():$(".invisible .task.noClass").clone().addClass(e.get("cssClass")).removeClass("noClass"),"CollectType"===e.get("description").type&&"q"===e.get("description").cell&&i&&(t.addClass(i+"Task"),t.find(".maxLife").text(BossCell.LIFE)),"CollectComplexTask"!==e.get("description").type&&"CollectComplexCellAttributes"!==e.get("description").type||(t.find(".currentLife").text(0),t.find(".maxLife").text(e.get("amount"))),t.find(".taskAmount").html(e.get("amount")),$(".beforeGameTasks").append(t)},this)),this.$task.find(".beforeGameTaskBubble").hide(),$("#game").append(this.$task),$(".beforeGameTaskBack").fadeIn(300),this.showLevelAnimation=!0,this.$task.css({top:"189px"}).show().queue(_.bind(function(e){this.$task.find(".beforeGameTaskBubble").show(),setTimeout(_.bind(function(){this.$task.hide(),$(".beforeGameTaskBack").hide(),this.$task.find(".beforeGameTaskBubble").hide(),t()},this),2e3),e()},this))}else{$("#tasksBlock")[0].style.display="";var e=new TasksWindow({collection:this.tasksView.tasks});setTimeout(function(){e.close(),t()},2e3)}},afterStart:function(){this.lineTimeout=!1,ThreeInRowBaseView.prototype.afterStart.call(this),application.level.gull?this.gull=new Gull:this.gull&&delete this.gull,Game.once("change:fullRunning",function(){this.processPassives()},this)},drawProgressLine:function(e){var t=Game.get("score")/application.level.score*100;100<t&&(t=100),Application.horizontalOrientation?$("#gameProgressLine").css({width:"",height:t+"%"}):$("#gameProgressLine").css({width:t+"%",height:""})},globalClasses:function(){var e=ThreeInRowBaseView.prototype.globalClasses();return e.push("bonusLevelMod3_"+(episode.get("num")-1)%3),e},showSuggestArrows:function(){Game.each(function(e){if(e instanceof DroppableCell&&!e.isBlocked("movable")&&!e.decorator){var t=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(t),t.alignTo(e.$div);var i=Game.gravityDirection||"bottom",o=[{direction:"bottom",angle:0,dx:!1,dy:Config.cellHeight/1.5},{direction:"left",angle:90,dx:-Config.cellWidth/1.5,dy:!1},{direction:"top",angle:180,dx:!1,dy:-Config.cellHeight/1.5},{direction:"right",angle:270,dx:Config.cellWidth/1.5,dy:!1}],a=_.findWhere(o,{direction:i});t.set("rotate",a.angle);var n={opacity:0};a.dx?n.dx=a.dx:n.dy=a.dy,t.addClass("suggestArrow").ourAnimate(n,1500,"linear",function(){t.remove()})}})},listenToGame:function(){ThreeInRowBaseView.prototype.listenToGame.call(this),Game.on("change:suggest",function(e,t){t?this.intervalId||(this.showSuggestArrows(),this.intervalId=setInterval(this.showSuggestArrows,2e3)):this.intervalId&&(clearInterval(this.intervalId),this.intervalId=!1)},this);var i=!1;Game.on("change:timeout",function(e,t){t<0&&(t=0),(t=Math.ceil(t/1e3))<=10?this.$("#gameTimeBlock").hasClass("notEnoughTime")||this.$("#gameTimeBlock").addClass("notEnoughTime"):this.$("#gameTimeBlock").hasClass("notEnoughTime")&&this.$("#gameTimeBlock").removeClass("notEnoughTime"),!1!==i&&t<i&&t<=10&&(5<t?application.playSound("countdown",{volume:.3}):3<t?application.playSound("countdown",{volume:.6}):2<t?application.playSound("countdown",{volume:.8}):1<t?application.playSound("countdown",{volume:.9}):application.playSound("countdown",{volume:1})),FigureView.findById("gameTimeBlock").html(t),i=t},this),Game.on("outOfTime",function(){new BonusLevelTimeoutWindow}),"bonus"!==application.level.num&&(window.mobile||(this.$gameScoreFigure=FigureView.find(".gameScore"),this.$gameScoreFigure.html(Game.get("score"))))},onChangeScore:function(e){if("bonus"!=application.level.num&&void 0===this.gameProgressView){var t=e.get("score");this.scoreObject.set("score",t),window.mobile||(this.$gameScoreFigure.html(t),this.$gameScoreFigure.animationQueue.length<=1&&this.$gameScoreFigure.animationByName("scoreAnimation")),gameView.drawProgressLine()}}});Application.on("ready",function(){var e=getLocalStorage("sessionWinCount");1<=e&&user.set({actionName:"sessionWinCount_"+Math.min(e,20),actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:0}),setLocalStorage("sessionWinCount",0),""<user.get("curRefPlace")&&-1!=user.get("curRefPlace").indexOf("rb_")&&user.set({actionName:("rf_"+user.get("curRefPlace")).substr(0,20),actionEpisode:0,actionLevel:0,actionPrice:0})});var FigureAnimations=FigureAnimations||{},GameMessageView=Backbone.View.extend({el:".wrapper",listenToGame:function(){var a=FigureView.fromTemplate('<div class="gameMessageBlock"><div class="gameMessageBlockBg"></div><span class="gameMessage"></span></div>');a.hide(),canvas.layer.append(a),FigureAnimations&&FigureAnimations.gameMessageBlockShow||(FigureAnimations.gameMessageBlockShow={params:{opacity:[0,1]},duration:200}),FigureAnimations&&FigureAnimations.gameMessageBlockHide||(FigureAnimations.gameMessageBlockHide={params:{opacity:[1,0]},duration:200}),Game.on("showMessage",function(e,t,i){if(i=i||700,e){var o=a.find(".gameMessage");o.html(e),a.clearQueue(),o.clearQueue(),t&&a.addClass(t),$("#container").addClass("message-show"),window.mobile&&"gems"==Config.project?(a.show(),application.playSound("gameMessage"),canvas.timeManager.setTimeout(function(){a.hide(),t&&a.removeClass(t),$("#container").removeClass("message-show")},1e3)):a.show().animationByName("gameMessageBlockShow").queue(function(t){o.animationByName("gameMessageShow").queue(function(e){e(),t()}),application.playSound("gameMessage")}).delay(i).queue(function(t){o.animationByName("gameMessageHide").queue(function(e){e(),t()})}).animationByName("gameMessageBlockHide").queue(function(e){a.hide(),t&&a.removeClass(t),$("#container").removeClass("message-show"),e()})}})}}),EpisodeView=Backbone.View.extend({el:"#main",events:{"click #prevMapBtn":"previous","click #nextMapBtn":"next","click #backFromComingSoonEpisode":"backFromComingSoonEpisode","click .livesAmulet":"showAdditionalLivesWindow","click .finalPoint":"finalPoint","click .bonusWorldFriends":"getMoreFriends","click .scrollButton":"scrollBg"},onScroll:function(){var e=this.$wayMainPage.scrollTop()<this.$wayMainPage.width()/8;("main"!=application.get("page")||"wayMain"!=application.get("subPage")||episode.isBonusWorld())&&(e=!1),this.onTop!=e&&(this.onTop=e,this.$wrapper.toggleClass("scroll-top",!!e))},finalPoint:function(){episode.isBonusWorld()&&new BonusWorldTargetWindow},showAdditionalLivesWindow:function(){new AdditionalLivesWindow},initialize:function(){this.onScroll=_.bind(this.onScroll,this),this.$wayMainPage=$("#wayMainPage"),this.$wrapper=$(".wrapper"),this.$wayMainPage.on("scroll",this.onScroll),this.listenTo(application,"change:page",this.onScroll),this.listenTo(application,"change:subPage",this.onScroll),this.cloudAnimationView=new CloudAnimationView({world:this}),episode.on("change:num",this.render,this),this.scoresView=new ScoresView,this.prizesView=new PrizesView({model:episode.prizes}),this.mapController=BigMapControllerFactory.create({el:this.$("#map"),bgEl:this.$(".scrolledBlock"),mainEl:this.$("#user"),keyIntervalTime:15}),episode.on("change:num",this.centerScreen,this),application.on("change:page",this.centerScreen,this),user.on("change:episode",function(e){(!window.mobile||"gems"!=Config.project&&"candyvalley"!=Config.project)&&this.changeEpisode(user.get("episode"),_.bind(function(){Config.skipEpisodeWindows||new NewEpisodeWindow,this.render()},this))},this),episode.on("startWindowClosed",function(e){var t=Promise.resolve(),i=messages.episodeTalks["episode"+e.get("num")],o=Config.bonusWorlds.find(function(e){return e.get("name")===Config.freeEpisodeName});if(!e.isBonusWorld()&&o&&o.needEndDialog&&t.then(function(){return o.showEndDialog()}),i&&messages.episodeTalks["episode"+e.get("num")].startTalk){var a=messages.episodeCharacters,n=messages.episodeTalks["episode"+e.get("num")].startTalk;t.then(function(){new StoryTalkWindow({owner:e,dialog:n,characters:a,line:0})})}})},render:function(){Config.needShowEpisodes?this.$el.removeClass().addClass("levelsBlock episodeMap_"+episode.get("num")):this.$el.removeClass().addClass("episode_"+episode.get("num")),this.$el.toggleClass("episodeLast",episode.get("num")==Config.episodesAmount),$("#game").removeClass().addClass("episode_"+episode.get("num")),user.get("bonusWorldAvailable")&&this.$el.addClass("bonusWorldShow"),episode.isCurrent()&&this.$el.addClass("episodeCurrent");var e=_.find(Config.bonusWorlds,function(e){return e.name===episode.previous("num")});e&&e.onExit(),episode.isBonusWorld()?($(".wrapper").removeClass("inNotBonusWorldNow").addClass("inBonusWorldNow").addClass("bonusworld_"+episode.get("num")),this.$(".bonusWorldBlock").addClass("inBonusEpisode").removeClass("inMainPage"),episode.isFreeEpisode()?$(".wrapper").removeClass("isNotFreeEpisode").addClass("isFreeEpisode"):$(".wrapper").removeClass("isFreeEpisode").addClass("isNotFreeEpisode"),Config.bonusWorld.onEnterBonusWorld&&Config.bonusWorld.onEnterBonusWorld(),Config.needShowEpisodes&&($(".levelsBlock").hide(),this.$el.show())):(this.$(".bonusWorldBlock").removeClass("inBonusEpisode").addClass("inMainPage"),$(".wrapper").removeClass("inBonusWorldNow").addClass("inNotBonusWorldNow"),$(".wrapper").removeClass("isFreeEpisode"),Config.needShowEpisodes&&$(".levelsBlock").show()),this.$el.removeClass("evenEpisode oddEpisode"),episode.get("num")%2==0?this.$el.addClass("evenEpisode"):this.$el.addClass("oddEpisode"),user.get("episode")<episode.get("num")?this.$el.addClass("notAvailable"):this.$el.removeClass("notAvailable"),"gems"==Config.project&&""!==$(".episodeNumber").text()||this.$(".episodeNumber").text(episode.get("num")),this.$(".episodeTitleOnMain").text(messages.newEpisodeName[episode.get("num")-1]),episode.get("episodeCollection")&&this.$el.addClass("episodeWithCollection"),this.checkRum()},checkRum:function(){this.$el.toggleClass("episodeRumReceived",0<user.amountKeys()),this.$el.toggleClass("episodeAllRumRecieved",3===user.amountKeys())},previous:function(){1!=episode.get("num")&&(Config.needShowEpisodes?1<application.currentFirstEpisode&&this.changeEpisode(application.currentFirstEpisode-1):this.changeEpisode(episode.get("num")-1))},next:function(){Config.needShowEpisodes?application.currentFirstEpisode+Config.needShowEpisodes-1<Config.episodesAmount&&this.changeEpisode(application.currentFirstEpisode+Config.needShowEpisodes):episode.get("num")<Config.episodesAmount?this.changeEpisode(episode.get("num")+1):this.comingSoonEpisode()},scrollBg:function(e){var t=$(e.target),i=t.data("direction");if(this.mapController&&this.mapController.scrollEnabled){var o=setInterval(_.bind(function(){this.mapController[i](),this.mapController.moveBgByControls()},this),30);t.one("mouseup mouseleave",function(){clearTimeout(o)})}},backFromComingSoonEpisode:function(){this.$("#comingSoonEpisode").hide(),$(".onGameButtonWrapper").removeClass("needRum")},comingSoonEpisode:function(){var e=Config.bonusWorlds.find(function(e){return e.get("name")===Config.freeEpisodeName});episode.isFinished()&&e&&e.isOpenedForUser()?e.open():(this.$("#comingSoonEpisode").removeClass().show(),(user.get("episode")<Config.episodesAmount||user.get("level")<=Config.levelsInEpisode)&&this.$("#comingSoonEpisode").addClass("notAllLevelPassed"))},centerScreen:function(){var e=this;setTimeout(function(){e.mapController.focusMainElement(!0)},1)},goHome:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=Config.bonusWorlds.find(function(e){return e.get("name")===Config.freeEpisodeName});if(!user.isAllLevelsCompleted()||!i||episode.get("num")===i.get("name")&&e){var o=user.get("episode");return t&&user.get("level")>Config.levelsInEpisode&&o++,this.changeEpisode(o),Promise.resolve()}return i.open()},changeEpisode:function(a,e){var t=!1;episode.get("num")>a&&(t=!0);var n=_.bind(function(){application.playPageSound(),this.backFromComingSoonEpisode(),e&&e(),this.animation&&this.animation()},this),r=_.now();if(Config.needShowEpisodes&&_.isNumber(a)){var s=a-1-(a-1)%Config.needShowEpisodes+1;if(s!==application.currentFirstEpisode||episode.isBonusWorld())return application.currentFirstEpisode=s,void new WaitWindow({decrease:t,operation:function(){var o=_.bind(function(e){if(e==Config.needShowEpisodes){var t=_.bind(function(){episode.load(a,function(){episode.trigger("scrollToCurrent"),n()}),this.close()},this),i=_.now();return!Config.switchEpisodeMinTime||i-r>=Config.switchEpisodeMinTime?void setTimeout(t,0):void setTimeout(t,Config.switchEpisodeMinTime-(i-r))}setTimeout(function(){episode.load(s+e,function(){o(e+1)})},0)},this);o(0)}})}episode.loaded(a)&&!Config.switchEpisodeMinTime?episode.load(a,n):new WaitWindow({decrease:t,operation:function(){episode.load(a,_.bind(function(){var e=_.bind(function(){n(),this.close()},this),t=_.now();!Config.switchEpisodeMinTime||t-r>=Config.switchEpisodeMinTime?e():setTimeout(e,Config.switchEpisodeMinTime-(t-r))},this),_.bind(function(){this.close()},this))}})},remove:function(){this.$wayMainPage.off("scroll"),Backbone.View.prototype.remove.call(this)},getMoreFriends:function(){new BonusWorldMoreFriendsWindow({bonusWorld:Config.bonusWorld.name})}}),dda,eda;EpisodeView.prototype.initialize=(dda=EpisodeView.prototype.initialize,function(){dda.call(this),episode.scores.on("add remove reset",this.setLevelsClasses,this),episode.on("episodeLoaded",this.setLevelsClasses,this)}),EpisodeView.prototype.render=(eda=EpisodeView.prototype.render,function(){eda.call(this),this.setLevelsClasses()}),EpisodeView.prototype.setLevelsClasses=function(){var e,t,i=this.getCurrentLevel();episode.get("about")&&(e=episode.get("about").cssClasses),episode.previous("about")&&(t=episode.previous("about").cssClasses),t&&_.each(t,_.bind(function(e){this.$el.removeClass(e)},this)),e&&_.each(e,_.bind(function(e,t){this.$el.toggleClass(e,parseInt(t)<i)},this))},EpisodeView.prototype.getCurrentLevel=function(){if(!episode.scores.length)return 0;if(episode.isFinished())return 0;var e=_.map(episode.scores.pluck("level"),function(e){return parseInt(e)});return e.push(0),_.max(e)+1};var ForceView=Backbone.View.extend({el:"#force",events:{"click .skipBtn":"skip"},constructor:function(t){var i=t.type[t.step-1];if(i.moveId&&i.moveId!=Game.getMoveId()){Game.on("afterEndTurn",function e(){i.moveId===Game.getMoveId()&&(Game.off("afterEndTurn",e),Game.collectablesContainer&&0<Game.collectablesContainer.length&&new ForceView(t))})}else Backbone.View.call(this,t)},addToHolder:function(e){e.hasClass("fieldDisabledCell")?this.$disabledCellHolder.append(e):this.$disabledHolder.append(e)},baseBlackRectangle:function(e,t,i,o){var a;this.type[this.step-1];(a=FigureView.createByTemplate(".invisible .forceFieldDisabled")).css({width:i+"px",height:o+"px",left:e+"px",top:t+"px"}),this.addToHolder(a)},addPowerUpArrow:function(){var e=this.type[this.step-1],t=gameView.powerUpsView.$("#"+e.powerUpForce).offset(),i=$("#game").offset(),o=t.left-i.left,a=t.top-i.top,n=gameView.powerUpsView.$("#"+e.powerUpForce).width(),r=(gameView.powerUpsView.$("#"+e.powerUpForce).height(),FigureView.createByTemplate(".invisible .forceFieldDisabledArrow",["fieldDisabledCell"]));r.css({left:o+Math.floor(n/2)+"px",top:a+"px"}),r.addClass(e.powerUpForce+"Arrow"),this.addToHolder(r)},addPowerUpTargetArrow:function(){var e=this.type[this.step-1].cells[0],t=Game.field[e.y][e.x].$div.offset(),i=$("#game").offset(),o=t.left-i.left,a=t.top-i.top,n=Config.cellWidth;this.$disabledHolder.find("fieldDisabledArrow").remove();var r=FigureView.createByTemplate(".invisible .forceFieldDisabledArrow");r.css({left:o+Math.floor(n/2)+"px",top:a+"px"}),this.addToHolder(r)},initialize:function(e){this.type=e.type,this.step=e.step,$("#game").addClass("forceNow"),$(".wrapper").addClass("gameForceNow"),this.$disabledWrapper=FigureView.createByTemplate(".invisible .emptyTemplate",["disabledWrapper"]).set("opacity",0).appendTo(canvas.layer),this.$disabledHolder=FigureView.createByTemplate(".invisible .emptyTemplate",["disabledHolder"]),this.$disabledWrapper.append(this.$disabledHolder),this.$disabledCellHolder=FigureView.createByTemplate(".invisible .emptyTemplate",["disabledCellHolder"]),this.$disabledWrapper.append(this.$disabledCellHolder),application.windows.closeAll();var t=this.type[this.step-1];if(this.$el.removeClass().addClass(t.cssClass),this.$(".forceText").html(messages.ForceTexts[t.cssClass]),this.$el.show(),t.powerUpForce&&(application.forcePowerUp=t.powerUpForce),this.render(),!t.cells){var i=$('<div class="forceButton"></div>'),o="";o=t.buttonText?messages.ForceButtonTexts[t.buttonText]:"OK",i.html(o);var a=function(){i.off(),$("#game").removeClass("forceNowActive");var e=this.forceEndFunction(!0);this.$disabledHolder.fadeOut(300,_.bind(function(){this.$disabledHolder.remove()},this)),this.$disabledCellHolder.fadeOut(300,_.bind(function(){this.$disabledCellHolder.remove(),e()},this)),this.$el.hide()};i.on("click touchend",_.bind(a,this)),this.$(".forceText").append(i),window.mobile&&$("#canvas").one("click touchend",_.bind(a,this))}if(episode.get("num")%2==0?this.$el.addClass("evenEpisode"):this.$el.addClass("oddEpisode"),t.powerUpForce)this.$el.addClass("powerUpForce"),gameView.powerUpsView.$("."+t.powerUpForce).addClass("inForce").addClass("active"),Game.once("change:selectedPowerUp",function(){application.forcePowerUp=!1,$(".fieldDisabledArrow").remove();t.cells&&t.cssClass2?(this.addPowerUpTargetArrow(),this.$disabledCellHolder.fadeOut(300,_.bind(function(){this.$disabledCellHolder.remove()},this)),this.$el.removeClass(t.cssClass).addClass(t.cssClass2),this.$(".forceText").html(messages.ForceTexts[t.cssClass2])):(gameView.powerUpsView.$("."+t.powerUpForce+" .opacityPowerUpBg").ourAnimate({opacity:0},300,"linear"),gameView.powerUpsView.$("."+t.powerUpForce).removeClass("inForce"),this.close()),Game.once("change:selectedPowerUp",function(){$(".fieldDisabledArrow").remove(),t.cssClass2&&(this.$el.hide(),gameView.powerUpsView.$("."+t.powerUpForce+" .opacityPowerUpBg").ourAnimate({opacity:0},300,"linear"),this.$disabledHolder.fadeOut(300,_.bind(function(){this.$disabledHolder.remove(),gameView.powerUpsView.$("."+t.powerUpForce).removeClass("inForce")},this))),Game.once("endTurn",this.forceEndFunction,this)},this)},this);else if(t.storytellerWeapon)this.forceStorytellerWeapon(t);else if($("#game").addClass("forceNowActive"),this.$el.removeClass("powerUpForce"),t.cells){var n=Game.field[t.cells[0].y][t.cells[0].x],r=Game.field[t.cells[1].y][t.cells[1].x];Game.set("suggest",{first:n,second:r}),Game.once("startAnimation",function(){this.close(),Game.once("endTurn",this.forceEndFunction,this)},this)}if(t.affectedElements)for(var s=0;s<t.affectedElements.length;s++)$(t.affectedElements[s]).addClass("inForce");this.$disabledWrapper.fadeIn(300,function(){}),this.listenTo(Application,"changeOrientation",this.render)},close:function(){$("#game").removeClass("forceNowActive"),this.$disabledWrapper.fadeOut(300,_.bind(function(){this.$disabledWrapper.remove()},this)),this.$el.hide()},render:function(){this.$disabledCellHolder.empty(),this.$disabledHolder.empty();var e,t=FigureView.findById("fieldContainer").offset(),i=this.type[this.step-1],o=t.top-canvas.position.top,a=t.left-canvas.position.left,n=Config.cellHeight*Config.rows,r=Config.cellWidth*Config.cols;this.baseBlackRectangle(0,0,$("#game").width(),o),this.baseBlackRectangle(0,o+n,$("#game").width(),$("#game").height()-o-n),this.baseBlackRectangle(0,o,a,n),this.baseBlackRectangle(a+r,o,$("#game").width()-a-r,n);for(var s=0;s<Config.rows;s++)for(var l=0;l<Config.cols;l++){var d=!1;if(i.cells)for(e=0;e<i.cells.length;e++)if(i.cells[e].x==l&&i.cells[e].y==s){d=!0;break}if(Game.inField(l,s)&&(Game.field[s][l].forceDisabled=void 0),!d||i.powerUpForce){var c=FigureView.createByTemplate(".invisible .forceFieldDisabled");if(d&&i.powerUpForce&&c.addClass("fieldDisabledCell"),Game.inField(l,s)&&!d&&(Game.field[s][l].forceDisabled=!0),c.css({width:Config.cellWidth+"px",height:Config.cellHeight+"px",left:l*Config.cellWidth+a+"px",top:s*Config.cellHeight+o+"px"}),i.lightCells){for(e=0;e<i.lightCells.length;e++)if(i.lightCells[e].x==l&&i.lightCells[e].y==s){d=!0;break}d&&c.addClass("fieldDisabledNoOpacity")}this.addToHolder(c)}}application.forcePowerUp?this.addPowerUpArrow():i.powerUpForce&&i.cells&&i.cssClass2&&this.addPowerUpTargetArrow()},skip:function(){this.step=this.type.length,Game.off(null,null,this),this.forceEndFunction(),this.close()},forceEndFunction:function(e){var t;this.$el.off(),this.stopListening();var i=_.noop,o=this.type[this.step-1];if(o.affectedElements)for(t=0;t<o.affectedElements.length;t++)$(o.affectedElements[t]).removeClass("inForce");if(this.type.length>this.step)i=_.bind(function(){new ForceView({type:this.type,step:this.step+1})},this),e||i();else{for(t=0;t<Config.rows;t++)for(var a=0;a<Config.cols;a++)Game.inField(a,t)&&(Game.field[t][a].forceDisabled=void 0);Game.set("fullRunning",!0),$("#game").removeClass("forceNow"),$(".wrapper").removeClass("gameForceNow"),e||window.mobile||Game.tasks.where({completed:!0}).length===Game.tasks.length||Game.trigger("showMessage",messages.forceEnd)}if(window.force)return i},forceStorytellerWeapon:function(){}}),ScoresView=Backbone.View.extend({el:"#map",initialize:function(){application.on("run",function(){episode.isCurrent()&&episode.isLocked()&&(user.get("episode")<Config.episodesAmount?new EpisodeLockedWindow:episodeView.comingSoonEpisode())},this),episode.scores.on("add",function(){episode.isBonusWorld()?Config.bonusWorld.getCurrentLevel()>episode.levelsInEpisode()&&application.once("change:page",function(){Config.bonusWorld.onCompleteBonusWorld()}):episode.get("num")==user.get("episode")&&episode.scores.length==episode.levelsInEpisode()&&application.once("change:page",function(){if(1001<=user.getRealLevel()&&user.getRealLevel()%1e3==1&&void 0!==ThousandthLevelWindow){var e=user.getRealLevel()-1;new ThousandthLevelWindow({level:e,prize:Prize.create({name:"thousandlevel",products:Config.thousandthLevelPrizes[e]||Config.thousandthLevelPrizes.common})})}episodeView.completeMobile?new EpisodeFinishedWindow({onClose:function(){$(".backToMenuMainPage").click(),episodeView.completeMobile()}}):Config.skipEpisodeFinishWindows?user.get("episode")<Config.episodesAmount?new EpisodeLockedWindow:episodeView.comingSoonEpisode():new EpisodeFinishedWindow({onClose:function(){user.get("episode")<Config.episodesAmount?Config.lockEpisodeShow?episodeView.changeEpisode(user.get("episode")+1,function(){$("#main").addClass("episodeOpened"),new EpisodeLockedWindow}):new EpisodeLockedWindow:episodeView.comingSoonEpisode()}})})})}}),PrizesView=Backbone.View.extend({el:"#main",events:{"click .box":"clickOnBox"},initialize:function(){this.$prototype=$("#boxByDifficultLevels"),this.model.on("reset",this.render,this),this.model.on("change",this.renderItem,this),this.model.on("reset",this.renderCurrent,this),this.model.on("change",this.renderCurrent,this),this.model.on("change:done",this.done,this)},render:function(){$("#prizes").empty(),this.model.each(this.renderItem,this)},done:function(e){"main"==application.get("page")?e.open(this.getItem(e)):application.once("main",function(){e.open(this.getItem(e))},this)},getItem:function(e){var t=this.$(e.get("cssSelector")||"#"+(e.id||e.cid));return 0==t.length&&(t=this.$prototype.clone().attr("id",e.id||e.cid).appendTo("#prizes").addClass(e.get("cls"))),t},renderItem:function(e){var t=this.getItem(e);e.get("actualStars")>e.get("requiredStars")?t.addClass("open"):t.removeClass("open"),e.get("done")?t.addClass("done"):t.removeClass("done"),this.renderStars(e,t)},renderStars:function(e,t){(t=t||this.getItem(e)).find(".actualStars").html(e.get("actualStars")),t.find(".requiredStars").html(e.get("requiredStars")),t.find(".boxProgress").css("width",e.get("actualStars")/e.get("requiredStars")*100+"%"),Config.prizesNotNeedTitle||(e.get("done")?t.attr("title",messages.prizeCollectText):t.attr("title",messages.prizeNeedStarsText[0]+e.get("requiredStars")+messages.prizeNeedStarsText[1]))},renderCurrent:function(){this.$(".currentBox").removeClass("currentBox");var t=!1;this.model.each(function(e){this.$(e.get("cssSelector")).addClass("notCurrentBox"),0==t&&(t=e),t.get("done")?e.get("done")?e.get("requiredStars")>t.get("requiredStars")&&(t=e):t=e:!e.get("done")&&e.get("requiredStars")<t.get("requiredStars")&&(t=e)},this),t&&this.getItem(t).removeClass("notCurrentBox").addClass("currentBox")},clickOnBox:function(e){if(!application.blockedLevelStart&&Config.prizeClosedWindowEnabled){var t=this.model.get(e.currentTarget.id);t||(t=this.model.findWhere({cssSelector:"#"+e.currentTarget.id})),t&&!t.get("done")&&(t.get("actualStars")>t.get("requiredStars")?t.open(this.getItem(t)):new PrizeClosedWindow({prize:t,box:this.getItem(t)}))}}}),MapBonusLevelView=Backbone.View.extend({el:"#mapBonusLevelBlock",events:{"click .playBonusLevel":"playBonusLevel","click .bonusLevelShine":"playBonusLevel"},playBonusLevel:function(){this.model.play()},clear:function(){this.stopListening(),this.undelegateEvents()},initPrizeBlock:function(e){this.$(".bonusLevelPrizeBlock").html("").removeClass().addClass("bonusLevelPrizeBlock").addClass("bonusLevelPrizes"+e.length),_.each(e,function(e){var t=this.$(".invisible .bonusLevelPrize").clone();"good"===e.type?t.find(".amount").html(formatPeriod(60*e.amount,!0)):t.find(".amount").html(e.amount),t.addClass(e.cssClass).addClass(e.type).addClass(e.name),this.$(".bonusLevelPrizeBlock").append(t)},this)},initialize:function(){this.model.on("change:actualStars",function(e,t){this.$(".actualStars").html(t)},this),this.model.on("change:requiredStars",function(e,t){this.$(".requiredStars").html(t)},this),this.model.on("change:opened",function(e,t){t?this.$el.addClass("opened"):this.$el.removeClass("opened")},this),this.model.on("change:refreshed",function(e,t){t?this.$el.addClass("ready"):this.$el.removeClass("ready")},this),this.model.on("change:refreshTimeout",function(e,t){t<=0&&(t=0),this.$(".refreshTimeout").html(formatTime("%H:%i:%s",t))},this),this.model.on("change:finished",function(e,t){t?this.$el.addClass("finished"):this.$el.removeClass("finished")},this)}}),PreloaderView=Backbone.View.extend({el:"#preloadPage",initialize:function(e){var t=e.preloader;window.hideSplashScreen&&window.hideSplashScreen(),t.on("loaded",function(){$("#mainAppWrapper").addClass("preloadDone"),"undefined"!=typeof MenuSettingsView&&application.set("menuSettingsView",new MenuSettingsView),this.$("#preloadPageText").html(RANDOM(messages.preloadTexts)),application.set("page","preloadPage")},this),t.on("percent",function(e){this.render(e)},this),void 0!==Config.preloaderClasses&&this.$el.addClass(Config.preloaderClasses[Math.floor(Math.random()*Config.preloaderClasses.length)])},render:function(e){window.mobile?this.$("#preloadLineBorder").css({width:e+"%",transition:"width 0.2s"}):this.$("#preloadLine").css("width",e+"%"),100===e&&($("#preloadPage").remove(),$("#clickToPreloadPage").remove(),$("#prePreloadPage").remove()),this.$("#percent").html(e)}}),FriendsView=Backbone.View.extend({el:"#friends",initialize:function(){this.renderFriends(),episode.on("change",this.renderFriends,this)},renderFriends:function(){var e=this.getFriends(),i=episode.isBonusWorld();this.$el.find(".mapPlayerCard").each(function(){friends.trigger("removeMapFriend",$(this))}),this.$el.empty();var o={};_.each(e,function(e){var t=e.get(i?"bonusWorldLevel":"level");e.id===user.get("userId")||t>Config.levelsInEpisode||(o[t]||(o[t]=[]),o[t].length<3&&o[t].push(e))});var s=["firstCard","secondCard","thirdCard"];_.each(o,function(e,t){var i=$(".invisible .mapCardBlock").clone(),o=parseInt($("#level"+t).css("left")),a=parseInt($("#level"+t).css("top"));i.css({left:o+"px",top:a+"px"}),i.addClass("level"+t),this.$el.append(i);for(var n=e.length-1;0<=n;n--){var r=$(".invisible .mapPlayerCard").clone();r.addClass(s[n]),r.find(".mapAva").html(socialNetwork.makePhotoById(e[n].get("id"),Config.basePhotoSize)),friends.trigger("addMapFriend",r,e[n].id),i.append(r)}},this)},getFriends:function(){return episode.isBonusWorld()?friends.where({bonusWorldName:Config.bonusWorld.name}):friends.where({episode:episode.get("num")})}}),FriendsPanelBaseView=Backbone.View.extend({el:"#mainFriendsPannel",events:{"mousedown #prevFriends":"prev","touchstart #prevFriends":"prev","mousedown #nextFriends":"next","touchstart #nextFriends":"next","mouseout #prevFriends, #nextFriends":"stop","touchend #prevFriends, #nextFriends":"stop","mouseup #prevFriends, #nextFriends":"stop","click .inviteBtn":"inviteFriend"},prev:function(){return this.friendsOnPanel.left(),!1},next:function(){return this.friendsOnPanel.right(),!1},stop:function(){this.friendsOnPanel.stop()},inviteFriend:function(){"facebook"!==network&&socialNetwork.invite()},initialize:function(){var i=this;this.cssWidth=Config.friendsPanelViewCssWidth||100,this.friendsOnPanel=new FriendsOnPanel,this.friendsOnPanel.on("updateFrend",this.render,this),this.friendsOnPanel.update(),this.friendsOnPanel.on("left",function(t){this.renderFriend(this.friendsOnPanel.first(),!0),this.$("#friendList").ourAnimate({left:-this.friendsOnPanel.offset*this.cssWidth+"px"},200,"linear",function(){var e=$(this).children().last();i.friendsOnPanel.trigger("removeElement",e),e.remove(),t()})},this),this.friendsOnPanel.on("right",function(t){this.renderFriend(this.friendsOnPanel.last()),this.$("#friendList").ourAnimate({left:-this.friendsOnPanel.offset*this.cssWidth+"px"},200,"linear",function(){var e=$(this).children().first();i.friendsOnPanel.trigger("removeElement",e),e.remove(),t()})},this)},render:function(){this.$("#friendList").empty(),this.friendsOnPanel.each(function(e){this.renderFriend(e)},this)},renderFriend:function(e,t){var i,o=this.friendsOnPanel.indexOf(e)+this.friendsOnPanel.offset;e instanceof InviteFriend?(i=this.fillInviteCard(e),this.friendsOnPanel.trigger("renderNewElement",i,void 0)):(i=this.fillFriendCard(e),this.friendsOnPanel.trigger("renderNewElement",i,e.id)),i.css("left",o*this.cssWidth+"px"),t?this.$("#friendList").prepend(i):this.$("#friendList").append(i);var a=0<this.friendsOnPanel.offset,n=this.friendsOnPanel.offset<this.friendsOnPanel.numElements-this.friendsOnPanel.size;this.$("#prevFriends").toggleClass("visible",a),this.$("#nextFriends").toggleClass("visible",n)},fillInviteCard:function(){return $(".invisible .friendInviteCard").clone()}}),FriendsPanelView=FriendsPanelBaseView.extend({fillFriendCard:function(t){var l=$(".invisible .friendCard").clone(),e=Config.friendsPanelAvatarSize||Config.basePhotoSize;if(l.find(".friendCardPhoto").html(socialNetwork.makePhotoById(t.get("id"),e)),l.find(".friendCardName").html(t.get("name")),l.find(".friendCardLevel").html(t.get("fullLevel")),1e3<t.get("fullLevel")&&l.addClass("showMedal"+1e3*Math.floor((t.get("fullLevel")-1)/1e3)),t.get("canCollectCoins")&&!1!==Config.collectCoinsAvailable&&(user.get("episode")>Config.collectCoinsAvailable.episode||user.get("episode")==Config.collectCoinsAvailable.episode&&user.get("level")>=Config.collectCoinsAvailable.level)){var i=function(){i=_.noop,application.playSound("collectCoinsFromFriend"),setTimeout(function(){application.playSound("flightCollectedCoinsFromFriend")},500);var e=Number(Config.collectCoinsFromFriend);10<e&&(e=10);var s=_.after(e,function(){t.set("canCollectCoins",!1),user.set({coins:new ObscureNumber(user.get("coins")+Number(Config.collectCoinsFromFriend)),amountCollectCoinsFromFriends:user.get("amountCollectCoinsFromFriends")+1})});_.times(e,function(){var t=$(".invisible .flyCollectCoin").clone();$(".blockedAnimations").append(t),t.alignTo(l.find(".collectCoins"),{useMargin:!0}),t.find(".collectCoinsAmount").html(Number(Config.collectCoinsFromFriend));var i=Math.floor(200*Math.random()-100),o=Math.floor(200+400*Math.random()),a=Math.floor(1.1*o),n=function(e){return{top:-o*e+a*e*e,left:i*e}},r=0;t.animate({path:new function(){this.css=function(e){return e=1-e,t.setCoords({top:"+="+(n(e).top-n(r).top)+"px",left:"+="+(n(e).left-n(r).left)+"px"}),r=e,{}}}},200*Math.random()+300,"linear").delay(500*Math.random()),t.ourAnimate({target:$("#coins")},500,"linear",function(){s(),$(this).remove()})}),l.find(".collectCoins").remove()};l.find(".collectCoins").on("click touchend",function(e){t.get("canSentThanks")?socialNetwork.sendRequest({type:"collectCoinsThanks",userIds:t.id,message:RANDOM(messages.getHelp),success:i}):i(),e.preventDefault()}),user.trigger("canCollectCoins",l.find(".collectCoins"))}else l.find(".collectCoins").remove();return l}});Application.on("ready",function(){Config.collectCoinsFromFriend=new ObscureNumber(Config.collectCoinsFromFriend)}),FriendsPanelView.prototype.initialize=function(){var a=this;this.cssWidth=Config.friendsPanelViewCssWidth||100,this.friendsOnPanel=new FriendsOnPanel,this.friendsOnPanel.on("updateFrend",this.render,this),this.friendsOnPanel.update();this.friendsOnPanel.on("left",function(e){this.renderFriend(this.friendsOnPanel.first(),!0);var i=this.$("#friendList").children(),o=_.after(i.length,function(){_.each(a.$("#friendList").children(),function(e,t){$(e).css("z-index",2).setTransform(t*a.cssWidth)}),e()});i.first().setScale(.5),_.each(i,function(e,t){t==i.length-1?$(e).css("z-index",1).ourAnimate({scale:.5,opacity:0},300,"easeOutQuart",function(){var e=$(this);a.friendsOnPanel.trigger("removeElement",e),e.remove(),o()}):0===t?$(e).css("z-index",1).css("opacity",0).ourAnimate({scale:1,opacity:1},300,"easeOutQuart",o):$(e).ourAnimate({left:t*a.cssWidth},300,"linear",o)})},this),this.friendsOnPanel.on("right",function(e){this.renderFriend(this.friendsOnPanel.last());var i=this.$("#friendList").children(),o=_.after(i.length,function(){_.each(a.$("#friendList").children(),function(e,t){$(e).css("z-index",2).setTransform(t*a.cssWidth)}),e()});i.last().setScale(.5),_.each(i,function(e,t){t==i.length-1?$(e).css("z-index",1).css("opacity",0).ourAnimate({scale:1,opacity:1},300,"easeOutQuart",o):0===t?$(e).css("z-index",1).ourAnimate({scale:.5,opacity:0},300,"easeOutQuart",function(){var e=$(this);a.friendsOnPanel.trigger("removeElement",e),e.remove(),o()}):$(e).ourAnimate({left:t*a.cssWidth-a.cssWidth},300,"linear",o)})},this)},FriendsPanelView.prototype.renderFriend=function(e,t){var i,o=this.friendsOnPanel.indexOf(e);e instanceof InviteFriend?(i=this.fillInviteCard(e),this.friendsOnPanel.trigger("renderNewElement",i,void 0)):(i=this.fillFriendCard(e),this.friendsOnPanel.trigger("renderNewElement",i,e.id)),0===friends.indexOf(e)&&i.addClass("first"),i.setTransform(o*this.cssWidth),i.css("z-index",2),t?this.$("#friendList").prepend(i):this.$("#friendList").append(i);var a=0<this.friendsOnPanel.offset,n=this.friendsOnPanel.offset<this.friendsOnPanel.numElements-this.friendsOnPanel.size;this.$("#prevFriends").toggleClass("visible",a),this.$("#nextFriends").toggleClass("visible",n)};var MapAnimationsView=Backbone.View.extend({el:"#map",initialize:function(){episode.on("episodeLoaded",this.render,this),application.on("change:page",this.render,this),this.render(),Config.boxBlinkEnabled&&(this.runBlinkInterval(),application.on("change:page",this.runBlinkInterval,this),episode.on("episodeLoaded",this.runBlinkInterval,this))},stopBlinkInterval:function(){clearInterval(this.blinkInt)},runBlinkInterval:function(){this.stopBlinkInterval(),"main"==application.get("page")&&(this.blinkBox=0,this.blinkInt=setInterval(_.bind(this.blink,this),3e3))},blink:function(){$("#box"+(this.blinkBox+1)+" .boxImg").addClass("boxImgBlink").delay(1e3).queue(function(e){$(this).removeClass("boxImgBlink"),e()}),this.blinkBox=(this.blinkBox+1)%3},render:function(){this.$(".mapAnimationsDown").remove(),this.$(".mapAnimationsUp").remove(),"main"==application.get("page")&&(this.$el.prepend($(".invisible .mapAnimationsDown").clone()),this.$el.append($(".invisible .mapAnimationsUp").clone()))}});Application.on("ready",function(){new MapAnimationsView});var GameFieldPointsView=Backbone.View.extend({initialize:function(){window.mobile||(this.points={},Game.on("showFieldPoints",this.onShowFieldPoints,this))},getSuchPointsId:function(e,t){if("collectTaskElem"==e||"damageBoss"==e||"damageBossTask"==e)return e+" "+_.first(t.classes)+(canvasTime/300).toFixed()},onShowFieldPoints:function(e,t,i){if((GameFieldPointsView.pointForTask||"collectTaskElem"!=i)&&e.length){0<i.indexOf(" ")&&(i=i.substr(0,i.indexOf(" ")));var o=this.getSuchPointsId(i,e);if(o&&this.points[o]){var a=this.points[o];return a.points+=t,void a.$figure.html(GameFieldPointsView.formatValue(a.points,i))}var n=FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints",i]);(_Figure.blockedAnimations2||_Figure.blockedAnimations).append(n),n.css({opacity:0}),n.alignTo(e),o&&(this.points[o]={points:t,$figure:n}),n.html(GameFieldPointsView.formatValue(t,i));var r=this;n.animate({opacity:1},300,"linear").animate({dy:-18},600,"linear").animate({opacity:0,dy:-6},200,"linear",function(){o&&delete r.points[o],this.remove()})}}},{pointForTask:!0,addMinusForBoss:!0,addPlusSign:!1,formatValue:function(e,t){var i="";return 0<e&&(GameFieldPointsView.addMinusForBoss&&"damageBoss"==t?i="-":GameFieldPointsView.addPlusSign&&(i="+")),i+e}}),PowerUpsAndCoinsWindowBlock=Backbone.View.extend({initialize:function(){var e,t=$('<div class="playerPowerupsItem"></div>');t.append($('<div class="playerPowerupItemIco"></div>')),t.append($('<div class="playerPowerupItemAmount amount"></div>')),this.$(".playerPowerupsList").empty();for(var i=0;i<Config.powerUpIdsOrder.length;i++)(e=t.clone()).find(".amount").html(user.getPowerUpAmount(Config.powerUpIdsOrder[i])),e.addClass("player_"+Config.powerUpIdsOrder[i]+"_item"),this.$(".playerPowerupsList").append(e);(e=t.clone()).find(".amount").html(user.get("coins").get()),e.addClass("player_coins_item .amount"),this.$(".playerPowerupsList").append(e),(e=t.clone()).find(".amount").html(user.get("spins")),e.addClass("player_spins_item .amount"),this.$(".playerPowerupsList").append(e),user.on("change:coins",this.changeCoins,this),user.on("change:powerUps",this.changePowerUps,this),user.on("change:spins",this.changeSpins,this)},changeSpins:function(){var e=parseInt(this.$(".player_spins_item .amount").html());this.changeItemAnimation(".player_spins_item",user.get("spins"),user.get("spins")-e)},changeCoins:function(){var e=parseInt(this.$(".player_coins_item .amount").html());this.changeItemAnimation(".player_coins_item",user.get("coins").get(),user.get("coins").get()-e)},changePowerUps:function(){for(var e=0;e<Config.powerUpIdsOrder.length;e++){var t=Config.powerUpIdsOrder[e];if(this.$(".player_"+t+"_item .amount").length){var i=user.getPowerUpAmount(t),o=parseInt(this.$(".player_"+t+"_item .amount").html());i!=o&&this.changeItemAnimation(".player_"+t+"_item",i,i-o)}}},close:function(){user.off("change:coins",this.changeCoins,this),user.off("change:powerUps",this.changePowerUps,this),this.stopListening()},changeItemAnimation:function(t,i,o){this.$(t).ourAnimate({scale:1.3},300,_.bind(function(){if(this.$(t+" .amount").html(i),!window.mobile){var e=$('<div class="changeItemDiff"></div>');0<o?o="+"+o:e.addClass("changeItemDiffTakeMoney"),e.html(o),this.$(t).parent().append(e),e.alignTo(this.$(t)),e.ourAnimate({top:(0<o?"-":"+")+"=30px",opacity:0},2e3,function(){$(this).remove()})}},this)).ourAnimate({scale:1},300)}}),OffersView=Backbone.View.extend({findBestOffer:function(o){var a=function(e){return!("test"==network&&!e.test)&&("vkontakte"==network&&e.test?!!(e.testUsers&&0<=e.testUsers.indexOf(user.get("userId"))):!(user.get("episode")<e.episode)&&(!(user.get("episode")==e.episode&&user.get("level")<e.level)&&((void 0===e.gender||e.gender==user.get("gender"))&&((void 0===e.paid||e.paid==user.get("paid"))&&(void 0===e.country||e.country==users[viewerId].country)))))};if("test"==network&&!window.mobile){for(var e=0;e<Config.offers.length;e++)if(a(Config.offers[e]))return void o(Config.offers[e]);o(!1)}"vkontakte"==network&&VK.api("account.getActiveOffers",{},function(e){if(e.response)for(var t=0;t<Config.offers.length;t++)for(var i=0;i<e.response.length;i++)if(Config.offers[t].id==e.response[i].id&&a(Config.offers[t]))return void o(Config.offers[t]);o(!1)})},showOfferWindow:function(){new OfferWindow({offer:this.offer}),this.offer.onShowOfferWindow&&this.offer.onShowOfferWindow()},initialize:function(){"vkontakte"!==network&&"test"!==network||Config.offers&&(getCookie("lastCompletedOfferTime")&&application.getCurrentServerTime()-getCookie("lastCompletedOfferTime")<86400||(this.findBestOffer(_.bind(function(e){!1!==e&&(this.offer=e,setTimeout(_.bind(function(){application.canOpenNotMatterWindow()&&!getCookie("offer_"+e.id)&&this.showOfferWindow()},this),0),$(".offerButton").addClass("offerButton"+e.name).addClass("active"),$(".offerButton").find(".offerPrize").html("+"+e.prize),$(".offerButton").addClass("offerButton"+e.name).on("click touchend",_.bind(function(){return this.showOfferWindow(),this.offer.onClickOfferButton&&this.offer.onClickOfferButton(),!1},this)),this.offer.onShowOfferButton&&this.offer.onShowOfferButton())},this)),user.on("completeOffer",function(e){$(".offerButton").removeClass("active");for(var t=0;t<Config.offers.length;t++)if(Config.offers[t].id==e){new CompleteOfferWindow({offer:Config.offers[t]});break}})))}}),StripView=Backbone.View.extend({el:"#stripMain",events:{click:"openWindow"},openWindow:function(){var e=this.strip;1==e.get("active")&&this.createStripWindow({templateClass:".stripWindow1_template",strip:e,model:e.get("model1")}),2==e.get("active")&&this.createStripWindow({templateClass:".stripWindow2_template",strip:e,model:e.get("model2")}),3==e.get("active")&&new Strip3Window({strip:e})},createStripModel:function(e){return new StripModel(e)},createStripWindow:function(e){return new StripWindow(e)},render:function(){this.strip.get("active")?this.$el.fadeIn(200):this.$el.fadeOut(200)},initialize:function(e){this.strip=e.strip,this.$el.hide(),this.strip.on("change:active",function(){var e=this.strip;1==e.get("active")&&(e.has("model1")||e.set("model1",this.createStripModel(stripModel1()))),2==e.get("active")&&(e.has("model2")||e.set("model2",this.createStripModel(stripModel2()))),this.render()},this)}}),StripModelItemView=Backbone.View.extend({events:{click:"action"},action:function(e){this.item.get("checked")||this.item.get("action").call(this.item,e)},renderChecked:function(){this.item.get("checked")?(this.$el.addClass("checked"),this.$("a").length&&this.$(".description").html(this.$("a").html())):this.$el.removeClass("checked")},initialize:function(e){this.item=e.item,this.item.get("editHtml")&&this.item.get("editHtml").call(this),this.item.on("change:checked",this.renderChecked,this),this.renderChecked()}}),GameProgress=Backbone.Model.extend({defaults:{score:0,percent:0,stars:0},initialize:function(){this.speed=Config.gameProgressSpeedCoeff||.5;var e=window.mobile?500:20;this.listenTo(Game,"change:score",canvas.timeManager.throttle(this.update,e,{leading:!1}),this)},update:function(){var e=Game.get("score"),t=e/application.level.score*100;100<t&&(t=100);var i=0;i=t<50?0:t<75?1:t<100?2:3,this.set({score:e,percent:t,stars:i})}}),GameProgressView=Backbone.View.extend({initialize:function(){FigureAnimations.scoreAnimation&&FigureAnimations.scoreAnimation.duration&&(this.scoreAnimation=canvas.timeManager.throttle(this.scoreAnimation,FigureAnimations.scoreAnimation.duration))},listenToGame:function(){this.model=new GameProgress,this.init(),this.render(),this.listenTo(this.model,"change",this.render,this),this.listenTo(application,"change:horizontalOrientation",this.reset,this)},init:function(){this.figure=FigureView.createByTemplate(".invisible .gameProgress",[]),this.gameProgressBg=this.figure.find(".gameProgressBg"),this.gameProgressLine=this.figure.find(".gameProgressLine"),this.gameScore=this.figure.find(".gameScore"),this.stars=[],this.stars.push(this.figure.find(".scoreMark1 .scoreMarkStars")),this.stars.push(this.figure.find(".scoreMark2 .scoreMarkStars")),this.stars.push(this.figure.find(".scoreMark3 .scoreMarkStars")),_.each(this.stars,function(e){e.removeClass("complete")}),this.appendToCanvas()},appendToCanvas:function(){FigureView.find(".bottomGamePanel").append(this.figure),$(".gameProgress").hide()},reset:function(){this.figure.remove(),this.init(),this.model.set("percent",this.model.get("percent")),_.delay(_.bind(this.render,this),300)},render:function(){this.renderScore(),this.renderProgressLine(),this.renderStars()},renderScore:function(){this.gameScore.html(String(this.model.get("score"))),this.scoreAnimation()},scoreAnimation:function(){this.gameScore.animationByName("scoreAnimation")},renderProgressLine:function(){var e=this.model.get("percent"),t=e-this.model.previous("percent");this.changeProgress(e,t)},renderStars:function(){var i=this.model.get("stars");_.each(this.stars,function(e,t){t<i?e.addClass("complete"):e.removeClass("complete")}),this.model.changed.stars&&(this.stars[i-1].animate({scale:1.5},300).animate({scale:1},300),application.playSound("getStar"))},changeProgress:function(e,t){var i=t*Game.get("speed")*this.model.speed,o=this.gameProgressLine.parent().attrs.width*e/100;t?this.gameProgressLine.animate({width:o},i,"linear"):this.gameProgressLine.attrs.width=o}}),Lia;GameProgressView.prototype.init=(Lia=GameProgressView.prototype.init,function(){Lia.call(this),this.gameScore=FigureView.find(".gameScore")});var Message=Backbone.Model.extend({}),MessageCenterBase=Backbone.Collection.extend({model:Message,constructor:function(e){var t=_.filter(e,function(e){return void 0!==application.USERS[e.userFrom]&&("gift"!=e.type||void 0!==Gifts)});Backbone.Collection.call(this,t),this.on("change remove add reset",this.updateButtonMessageCenter,this),this.updateButtonMessageCenter()},updateButtonMessageCenter:function(){0===this.length?$(".openMessageCenter").addClass("disabled").find(".num").html(this.length):$(".openMessageCenter").removeClass("disabled").find(".num").html(this.length)},askedLifesProcess:function(e){e&&e.length&&callService("../../../levelbase/src/services/sendlifes.php",_.bind(this.askedLifesProcessOnSuccess,this),_.noop,{userIds:e.join(",")})},askedLifesProcessOnSuccess:function(e){if(e&&e.length){user.trigger("sendlifes",e),LifeKeeper.setMeSendedLifeToFriend(e);var t=RANDOM(messages.sendLife);_.isArray(t)&&(t=t[user.get("gender")]),socialNetwork.sendRequest({type:"lifeSent",verb:"send",ogobject:"life",userIds:e,message:t})}},processGift:function(e){var t=Gifts.findGiftByUid(e.get("uid"));callServiceAddInQueue("../../../base/src/services/deletegiftmessage.php",{transactionId:e.get("transactionId")}),Gifts.receiveGift(t),socialNetwork.sendRequest({type:"giftReceived",userIds:e.get("userFrom"),message:messages.gifts.receivedRequest}),this.remove(e)},process:function(e,t){var i=this.listSenders(e);this[e+"Process"](i,e,t),this.clear(e),this.remove(this.where({type:e}))},listSenders:function(e){return _.invoke(this.where({type:e}),"get","userFrom")},clear:function(e){callServiceAddInQueue("../../../levelbase/src/services/removemessages.php",{type:e})},isAvailableMessageArtifactPart:function(){return _.find(Config.bonusWorlds,function(e){return e.get("active")&&e.artifactController})},receiveArtifactPart:function(e){if(this.isAvailableMessageArtifactPart()){var t=this.findWhere({type:e}),i=_.find(Config.bonusWorlds,function(e){return e.get("active")&&e.artifactController});if(i){var o=i.artifactController.getArtifactWorkshop();t&&o&&(o.receiveArtifactPart(t.get("partId"),this.listSenders(e)),this.remove(t))}}}}),MessageCenter=MessageCenterBase.extend({updateCallbacks:[],giftsReceivedProcess:function(e){user.set("coins",new ObscureNumber(user.get("coins")+Number(giftReceivedBonus)*e.length)),socialNetwork.sendRequest({type:"giftRecieved",userIds:e,message:RANDOM(messages.getGift)})},giftsAvailableProcess:function(t){var e=RANDOM(messages.sendGift);socialNetwork.sendRequest({type:"giftSent",verb:"send",ogobject:"gift",userIds:t,message:e[user.get("gender")],success:function(e){user.selectedForGifts=_.difference(user.selectedForGifts,t),"vkontakte"!==network?user.set({coins:new ObscureNumber(user.get("coins")+Number(giftSentBonus)*t.length),sometimeMakeAGift:1},{notSave:!0}):user.set({sometimeMakeAGift:1},{notSave:!0}),callServiceAddInQueue("../../../levelbase/src/services/sendgifts.php",{userIds:t.join(",")})}})},congrateFriendsWith:function(t){var e=this.listSenders(t+"Congrate");_.each(e,function(e){window[t+"Congrates"][e]=1}),setLocalStorage(t+"Congrates",window[t+"Congrates"]),setLocalStorage(t+"CongrateTime",(new Date).getTime()),socialNetwork.sendRequest({type:"congrates",userIds:e,message:messages[t+"Congrate"]}),this.remove(this.where({type:t+"Congrate"}))},helpReceivedProcess:function(e){user.set("friendsHelpSended",1),"mixijp"===network&&(e=_.intersection(e,friendsInAppIds)),socialNetwork.sendRequest({type:"helpReceived",userIds:e,message:RANDOM(messages.getHelp)})},askedKeysProcess:function(e){callService("../../../levelbase/src/services/sendkeys.php",_.bind(function(e){var t=RANDOM(messages.sendKey);socialNetwork.sendRequest({type:"keySent",verb:"send",ogobject:"key",userIds:e,message:t[user.get("gender")]})},this),function(){},{userIds:e.join(",")})},sentLifesProcess:function(e){callService("../../../levelbase/src/services/getlifes.php",_.bind(function(e){user.getLifes(e),LifeKeeper.setFriendSendedLifeTime(e)},this),function(){},{userIds:e.join(",")})},update:function(e){var i=this;if(this.updateCallbacks.push(e||_.noop),!this.onUpdate){this.onUpdate=!0;var t=this.getRequestParams();Promise.resolve().then(function(){return application.emit("beforeLoadMessage",i,t)}).then(function(){return service("../../../levelbase/src/services/messages.php",t)}).then(function(e){var t=_.flatten([e.messages,_.where(i.toJSON(),{initial:!0})]);t=application.filterMessage(t),t=MessageCenter.uniqMessages(t),i.refreshReceivedKeys(t.filter(function(e){return"receivedKey"===e.type})),i.reset(t.filter(function(e){return"receivedKey"!==e.type})),i.refreshAdvMessage(),user.get("checkedDeferredPrizes")||i.checkDeferredPrizes(t),i.onUpdate=!1,_.each(i.updateCallbacks,function(e){e()},i),i.updateCallbacks=[]})}},getRequestParams:function(){return{}},showAdv:function(){var e=this;Config.rewardAdMsg.showAd(_.once(function(){user.set({coins:new ObscureNumber(user.get("coins")+Number(Config.rewardAdMsg.get("prize"))),actionName:"coins for ad",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0}),e.refreshAdvMessage()}))},refreshAdvMessage:function(){var e=Boolean(Config.rewardAdMsg&&Config.rewardAdMsg.checkAvailable()),t=this.get("adv");if(e){if(!t){var i=new Message({id:"adv",userTo:window.viewerId,type:"adv",userFrom:[],initial:!0});this.push(i)}}else t&&this.remove(t)},refreshReceivedKeys:function(e){if(0<e.length&&e.length>user.get("receivedKeys").length){var t=[];e.forEach(function(e){return t.push(e.userFrom)}),user.set("receivedKeys",t)}},checkDeferredPrizes:function(e){var t=e.filter(function(e){return"deferredPrize"===e.type});user.set("checkedDeferredPrizes",!0),t&&t.forEach(function(e){new AnimatedPrizesWindow({prizes:new UserPrizes(UserPrizes.convertFromCocos(JSON.parse(e.prizes))),world:"deferredPrizes",message:e.messageType,onClose:function(){callService("../../../levelbase/src/services/confirmprizes.php",_.noop,_.noop,{messageType:e.messageType})}})})}},{requestParams:{},addExternalMessages:function(e){var t;if(e=e.slice(),!user.neverPlayedBefore()){if(user.get("canMakeAGift")&&user.getRealLevel()>=Config.makeGiftLevel){var i=user.getRandomFriendForGift();!1!==i&&e.push({userTo:window.viewerId,type:"giftsAvailable",userFrom:i,initial:!0})}var o=0;if("mobage"!=network&&"wizq"!=network&&user.getRealLevel()>=Config.congratesLevel){var a=getLocalStorage("birthdayCongrateTime");if(!a||a<(new Date).getTime()-864e5)for(window.birthdayCongrates=getLocalStorage("birthdayCongrates"),void 0===window.birthdayCongrates&&(window.birthdayCongrates={}),t=0;t<allFriendsIds.length&&o<20;t++)void 0===window.birthdayCongrates[allFriendsIds[t]]&&recentlyBirthday(application.USERS[allFriendsIds[t]])&&(e.push({userTo:window.viewerId,type:"birthdayCongrate",userFrom:allFriendsIds[t],initial:!0}),o++)}if(user.has("congrateType")&&0===o&&user.getRealLevel()>=Config.congratesLevel){var n=getLocalStorage(user.get("congrateType")+"CongrateTime");if(!n||n<(new Date).getTime()-864e5){var r=function(e){return void 0!==application.USERS[e]&&("march8"!=user.get("congrateType")||1===application.USERS[e].gender)};window[user.get("congrateType")+"Congrates"]=getLocalStorage(user.get("congrateType")+"Congrates"),void 0===window[user.get("congrateType")+"Congrates"]&&(window[user.get("congrateType")+"Congrates"]={});var s=[];for(t=0;t<friendsInAppIds.length;t++)void 0===window[user.get("congrateType")+"Congrates"][friendsInAppIds[t]]&&r(friendsInAppIds[t])&&s.push(friendsInAppIds[t]);s=_.shuffle(s);var l=allUsers.getBestForInvite(),d=[];for(t=0;t<l.length;t++)void 0===window[user.get("congrateType")+"Congrates"][l[t]]&&r(l[t])&&d.push(l[t]);for(var c=[];s.length||d.length;)s.length&&c.push(s.shift()),d.length&&c.push(d.shift());for(t=0;t<20&&t<c.length;t++)e.push({userTo:window.viewerId,type:user.get("congrateType")+"Congrate",userFrom:c[t],initial:!0})}}}return e},uniqMessages:function(e){var t=[];return _.each(e,function(e){_.find(t,{userFrom:e.userFrom,userTo:e.userTo,type:e.type,world:e.world})||t.push(e)}),t}}),MessageCenterController={initialized:!1,timer:!1,timeout:3e5,lastUpdateTime:_.now(),init:function(){this.initialized||(this.initialized=!0,this.update(),this.handle(),application.on("change:page",this.handle,this),user.on("createNewGame",this.handle,this))},handle:function(){_.now()-this.lastUpdateTime>=this.timeout?this.update():"main"===application.get("page")?!1===this.timer&&(this.timer=setTimeout(_.bind(this.update,this),this.timeout)):this.timer&&(clearTimeout(this.timer),this.timer=!1)},update:function(){void 0!==messageCenter&&(this.lastUpdateTime=_.now(),messageCenter.update(_.bind(this.handle,this)))}};Application.on("ready",MessageCenterController.init,MessageCenterController);var MessageCenterBaseWindow=TWindow.extend({templateClass:".messageCenterWindow_template",events:{"click .close":"close","click #messageBirthdayGift .gift":"giftBuy","click #messageLifes .messageItemBtn":"sendLifes","click #messageGivenLifes .messageItemBtn":"getLifes"},doMassOperation:function(){for(var e in this.selectedActions)this.$("#"+e+" .messageItemBtn").click();this.selectedActions={}},toggleSelectAllAction:function(e){for(var t in this.selectedActions)this.$("#"+t+" .checkbox").click();$(e.currentTarget).hasClass("checkboxOn")?$(e.currentTarget).removeClass("checkboxOn"):($(e.currentTarget).addClass("checkboxOn"),this.$(".selectOneCheckbox .checkbox").click())},toggleSelectOneAction:function(e){var t=$(e.currentTarget).parent().parent().attr("id");void 0===this.selectedActions[t]?(this.selectedActions[t]=!0,$(e.currentTarget).addClass("checkboxOn")):(delete this.selectedActions[t],$(e.currentTarget).removeClass("checkboxOn"))},onOpen:function(){this.selectedActions={},this.render(),TWindow.prototype.onOpen.call(this),this.collection.on("remove",function(){0===this.collection.length&&this.close()},this)},onClose:function(){this.collection.off("remove",null,this)},sendLifes:function(){this.collection.process("askedLifes"),this.$("#messageLifes").hide()},getLifes:function(){this.collection.process("sentLifes"),this.$("#messageGivenLifes").hide()},giftBuy:function(e){var t=$(e.currentTarget).parents(".playerBlock"),i=Gifts.findGiftById(t.data("gift"));new MessageCenterWindow({collection:this.collection,firstPriority:!0}),Gifts.giftForUser(i,t.data("friend")),this.close()},renderGifts:function(n){0<this.collection.where({type:"gift"}).length&&void 0!==Gifts?(this.$(n).show(),this.$(n+" .giftsList").empty(),_.each(this.collection.where({type:"gift"}),_.bind(function(e,t){var i=$($("#giftMessageCardTpl").html()),o=application.USERS[e.get("userFrom")];i.find(".messageAva").html(socialNetwork.makePhotoById(e.get("userFrom"),Config.basePhotoSize)).attr("title",o.first_name),i.find(".giftText").html(messages.giftGender[o.gender]);var a=Gifts.findGiftByUid(e.get("uid"));"money"==a.buyType?i.find(".giftName").html(prices[a.id].desc.product):i.find(".giftName").html(messages.gifts[a.id]),i.find(".gift").addClass(a.id),i.addClass("giftNumber_"+t),i.find(".messageItemBtn").on("click touchend",_.bind(function(){this.collection.processGift(e),this.$(n+" .giftsList .giftNumber_"+t).remove(),0===this.collection.where({type:"gift"}).length&&this.$(n).hide()},this)),this.$(n+" .giftsList").append(i)},this))):this.$(n).hide()},renderBirthday:function(e,a){if(0<this.collection.where({type:e}).length)if(this.$(a).show(),window.mobile){var t=this.collection.findWhere({type:e}),i=application.USERS[t.get("userFrom")];this.$(a).find(".messageAva").html(socialNetwork.makePhotoById(t.get("userFrom"),Config.basePhotoSize)).attr("title",i.first_name)}else{this.$(a+" .messageFriendList").empty();var o=8;Config.messageCenterFriendsAmountInOneLine&&(o=Config.messageCenterFriendsAmountInOneLine);var n=this.collection.where({type:e});this.$(a+" .messageFriendList").removeClass().addClass("messageFriendList").addClass("amountRows"+(Math.floor((n.length-1)/o)+1)),_.each(n,function(e){var t,i=RANDOM(Gifts.findGifts("birthday",!0));i?((t=$($("#birthdayMessagePlayerCardTpl").html())).addClass(i.id).data("gift",i.id),t.addClass(i.buyType),"money"==i.buyType||"odgifts"==i.buyType?t.find(".price").html(prices[i.id].desc.price):"coins"==i.buyType&&t.find(".price").html(Number(i.price))):t=$($("#messagePlayerCardTpl").html());var o=application.USERS[e.get("userFrom")];t.find(".messageAva").html(socialNetwork.makePhotoById(e.get("userFrom"),Config.basePhotoSize)).attr("title",o.first_name),t.data("friend",e.get("userFrom")),this.$(a+" .messageFriendList").append(t)},this)}else this.$(a).hide()},renderGroup:function(e,o){if(0<this.collection.where({type:e}).length)if(this.$(o).show(),window.mobile){var t=this.collection.findWhere({type:e}),i=application.USERS[t.get("userFrom")];this.$(o).find(".messageAva").html(socialNetwork.makePhotoById(t.get("userFrom"),Config.basePhotoSize)).attr("title",i.first_name)}else{this.$(o+" .messageFriendList").empty();var a=4;Config.messageCenterFriendsAmountInOneLine&&(a=Config.messageCenterFriendsAmountInOneLine);var n=this.collection.where({type:e});this.$(o+" .messageFriendList").removeClass().addClass("messageFriendList").addClass("amountRows"+(Math.floor((n.length-1)/a)+1)),_.each(n,function(e){var t=$($("#messagePlayerCardTpl").html()),i=application.USERS[e.get("userFrom")];t.find(".messageAva").html(socialNetwork.makePhotoById(e.get("userFrom"),Config.basePhotoSize)).attr("title",i.first_name),this.$(o+" .messageFriendList").append(t)},this)}else this.$(o).hide()},renderAdv:function(e,t){0<this.collection.where({type:e}).length?(this.$(t).show(),this.$(t+" .prize").text(Number(Config.rewardAdMsg.get("prize")))):this.$(t).hide()},render:function(){this.renderGroup("askedLifes","#messageLifes"),this.renderGroup("sentLifes","#messageGivenLifes")}}),MessageCenterWindow=MessageCenterBaseWindow.extend({events:_.extend(MessageCenterBaseWindow.prototype.events,{"click #messageGifts .messageItemBtn":"sendGifts","click #messageGiftsReceived .messageItemBtn":"getGifts","click #messageAskKey .messageItemBtn":"sendKeys","click #messageHelpReceived .messageItemBtn":"getHelp","click #messageNewYearGift .messageItemBtn":"congrateFriendsWithNewYear","click #messageMarch8Gift .messageItemBtn":"congrateFriendsWithMarch8","click #messageMay1Gift .messageItemBtn":"congrateFriendsWithMay1","click #messageBirthdayGift .messageItemBtn":"congrateFriendsWithBirthday","click #messageEasterGift .messageItemBtn":"congrateFriendsWithEaster","click #advMsgReward .messageItemBtn":"showAdv","click .selectOneCheckbox .checkbox":"toggleSelectOneAction","click .selectAllCheckbox .checkbox":"toggleSelectAllAction","click .messageDoMassOperation":"doMassOperation","click .refresh":"update","click .sentArtifactPart":"receiveArtifactPart","click .askedArtifactPart":"sendArtifactPart","click .cancelArtifactPart":"cancelSendArtifactPart"}),initialize:function(e){MessageCenterBaseWindow.prototype.initialize.call(this,e),this.update()},update:function(){if(this.$(".refresh").hasClass("disabled"))return!1;this.$(".refresh").addClass("disabled"),messageCenter.update(_.bind(this.render,this))},getGifts:function(){this.collection.process("giftsReceived"),this.$("#messageGiftsReceived").hide()},sendGifts:function(){this.collection.process("giftsAvailable"),this.$("#messageGifts").hide()},getHelp:function(){this.collection.process("helpReceived"),this.$("#messageHelpReceived").hide()},congrateFriendsWithNewYear:function(){this.collection.congrateFriendsWith("newYear"),this.$("#messageNewYearGift").hide()},congrateFriendsWithMarch8:function(){this.collection.congrateFriendsWith("march8"),this.$("#messageMarch8Gift").hide()},congrateFriendsWithMay1:function(){this.collection.congrateFriendsWith("may1"),this.$("#messageMay1Gift").hide()},congrateFriendsWithEaster:function(){this.collection.congrateFriendsWith("easter"),this.$("#messageEasterGift").hide()},congrateFriendsWithBirthday:function(){this.collection.congrateFriendsWith("birthday"),this.$("#messageBirthdayGift").hide()},sendKeys:function(){this.collection.process("askedKeys"),this.$("#messageAskKey").hide()},showAdv:function(){this.collection.showAdv(),this.$("#advMsgReward").hide()},receiveArtifactPart:function(e){var t=$(e.target).parent().data("part-id"),i=$(e.target).parent().data("world"),o="sentArtifactPart"+t,a=this.collection,n=a.where({type:o,world:i});if(0<n.length){var r,s;if(application.getBonusWorlds().find(function(e){e.getArtifactPartsPrefix()===i&&(r=e)}),!r)return;if(r.hasComponent(ArtifactController)?s=r.artifactController.getArtifactWorkshop():r.hasComponent("parts")&&(s=r.getComponent("parts")),!s)return;s.receiveArtifactPart(parseInt(t),_.invoke(n,"get","userFrom")),a.remove(n)}$(e.target).parent().hide()},sendArtifactPart:function(t){var e=$(t.target).parent().data("part-id"),i=$(t.target).parent().data("world"),o="askedArtifactPart"+e,a=this.collection,n=a.where({type:o,world:i});if(0<n.length){var r,s,l;if(application.getBonusWorlds().find(function(e){e.getArtifactPartsPrefix()===i&&(r=e)}),!r)return;if(r.hasComponent(ArtifactController)){if(!(l=r.getComponent(ArtifactController).getArtifactWorkshop()))return;s=l.parts.get(parseInt(e))}else r.hasComponent("parts")&&(l=r.getComponent("parts"),s=l.getParts().get(parseInt(e)));if(!s)return;if(s){this.close();var d=new SelectFriendWindow({firstPriority:!0,type:"sendArtifactPart",userIds:_.invoke(n,"get","userFrom"),maxSelectUsers:s.getAmount(),maxSelectCounterCssSelector:".artifactParts",selectButtonText:"icetownArtifactSend"});d.on("open",function(){d.unselectAll()}),d.on("select",function(e){l.sendArtifactPart(s,e),a.remove(n),$(t.target).parent().hide()}),d.on("close",function(){a.length&&new MessageCenterWindow({collection:messageCenter})})}}},cancelSendArtifactPart:function(e){var t,i,o=$(e.target).parent().data("part-id"),a="askedArtifactPart"+o,n=$(e.target).parent().data("world");if(application.getBonusWorlds().find(function(e){e.getArtifactPartsPrefix()===n&&(t=e)}),t){t.getComponent(ArtifactController)?i=t.getComponent(ArtifactController).getArtifactWorkshop():t.getComponent("parts")&&(i=t.getComponent("parts"));var r=this.collection.where({type:a,world:n});i&&0<r.length&&(i.cancelAskedArtifactPart(o),this.collection.remove(r)),$(e.target).parent().hide()}},renderArtifact:function(t,i,o){if(t.artifactController){t.artifactController.getArtifactWorkshop().getParts().forEach(function(e){this.renderArtifactPartGroup(e,i,o,t.get("name"))},this)}else{var a=t.getComponent("parts");a.getParts().forEach(function(e){this.renderArtifactPartGroup(e,i,o,a.getPrefix())},this)}},renderArtifactPartGroup:function(e,t,i,o){var a=t+e.id,n=this.collection.where({type:a,world:o});if(0<n.length){var r=this.$(i).clone().attr("id",a+o).data("part-id",e.id).data("world",o).addClass(o).show();if(r.find(".partImage").addClass("partImage"+e.id),window.mobile){var s=application.USERS[message.get("userFrom")];r.find(".messageAva").html(socialNetwork.makePhotoById(message.get("userFrom"),Config.basePhotoSize)).attr("title",s.first_name)}else{r.find(".messageFriendList").empty();var l=4;Config.messageCenterFriendsAmountInOneLine&&(l=Config.messageCenterFriendsAmountInOneLine),r.find(".messageFriendList").removeClass().addClass("messageFriendList").addClass("amountRows"+(Math.floor((n.length-1)/l)+1)),_.each(n,function(e){var t=$($("#messagePlayerCardTpl").html()),i=application.USERS[e.get("userFrom")];t.find(".messageAva").html(socialNetwork.makePhotoById(e.get("userFrom"),Config.basePhotoSize)).attr("title",i.first_name),r.find(" .messageFriendList").append(t)})}this.$("#artifactPartMessages").append(r)}},render:function(){MessageCenterBaseWindow.prototype.render.call(this),this.$("#giftCoinsAmountMessage").html(Number(giftSentBonus)),this.$("#giftCoinsGetMessage").html(Number(giftReceivedBonus)),this.renderGifts("#messageGameGifts"),this.renderGroup("giftsAvailable","#messageGifts"),this.renderGroup("giftsReceived","#messageGiftsReceived"),this.renderGroup("askedKeys","#messageAskKey"),this.renderGroup("helpReceived","#messageHelpReceived"),this.renderGroup("newYearCongrate","#messageNewYearGift"),this.renderGroup("march8Congrate","#messageMarch8Gift"),this.renderGroup("may1Congrate","#messageMay1Gift"),this.renderGroup("easterCongrate","#messageEasterGift"),this.renderBirthday("birthdayCongrate","#messageBirthdayGift");var e=application.getBonusWorlds().filter(function(e){return e.get("active")&&(e.hasComponent(ArtifactController)||e.hasComponent("parts"))});(this.$("#artifactPartMessages").empty(),$("#messageReceiveArtifactPart").hide(),$("#messageSendArtifactPart").hide(),0<e.length)&&_.unique(e,function(e){return e.hasComponent("parts")?e.cmp("parts").getPrefix():e.get("name")}).forEach(function(e){this.renderArtifact(e,"sentArtifactPart","#messageReceiveArtifactPart"),this.renderArtifact(e,"askedArtifactPart","#messageSendArtifactPart")},this);this.renderAdv("adv","#advMsgReward"),0<this.collection.length?this.$el.removeClass("emptyList"):this.$el.addClass("emptyList"),this.$(".refresh").removeClass("disabled")}});function Gull(){Config.gullAppearEpisode&&Config.gullAppearLevel&&episode.get("num")===Config.gullAppearEpisode&&application.level.num===Config.gullAppearLevel?this.processCounter=-1:this.processCounter=0}Gull.prototype.process=function(){var s,l,d;if(++this.processCounter%4==0&&(Game.each(function(e){if(e instanceof FishCell&&e.isMovable()&&(!s||e.y>s.y))for(var t=3;0<t;t--){var i=Game.inField(e.x,e.y-t);if(i&&i.isMovable())return s=e,l=i,!1}}),s&&l)){var c=Game.animate();(d=FigureView.createByTemplate(".gull")).set({x:canvas.canvasWidth,y:canvas.canvasHeight}),_Figure.blockedAnimations.append(d);var g={x:Math.floor(Config.cellWidth/2),y:Math.floor(Config.cellHeight/2)};application.playSound("gullMove"),d.ourAnimate({target:s.$div,ajust:g},d.distanceTo(s.$div)/300*1e3,"linear",function(){var e=s.$div.clone();e.set({x:0,y:0}),d.addClass("snatch"),d.find(".paw").append(e);var t=l.y;s.$div.hide();for(var i=1,o=s.x,a=s.y-1,n=0;a>=l.y;a--,n++){var r=Game.inField(o,a);r&&r.isMovable()?(Game.field[a][o]=void 0,(Game.field[a+i][o]=r).fallDown(a+i,n,o),i=1):i++}d.ourAnimate({target:l.$div,ajust:g},d.distanceTo(l.$div)/300*1e3,"linear",function(){d.removeClass("snatch").addClass("free"),e.remove(),s.$div.set("y",t*Config.cellHeight),s.setY(t),(Game.field[t][l.x]=s).$div.show(),d.ourAnimate({x:-100,y:-100},(d.distanceTo(_Figure.blockedAnimations)+140)/300*1e3,"linear",c)})})}},Gull.process=function(){gameView.gull&&gameView.gull.process()};var AddLivesWindow=TWindow.extend({templateClass:".addLifesWindow_template",events:{"click #addLifesBuy":"refill","click #askLifePublic":"askLife","click #unlimitedLifesBuy":"buyUnlimitedLifes","click #unlimitedLifesDayBuy":"buyUnlimitedLifesDay","click .bonusWorldLivesBlock .playButton":"playBonusWorld","click .showAd":"showAd","click .close":"close"},onClose:function(){user.off("change:lives",this.renderCurrentLife,this),user.off("change:timeToNextLife",this.renderTimeToNextLife,this)},renderCurrentLife:function(){this.$(".currentLife").html(user.get("lives"))},renderTimeToNextLife:function(){user.get("lives")<Config.maxLives?this.$(".addLivesTimer").show().html(formatTime("%i:%s",user.get("timeToNextLife"))):this.$(".addLivesTimer").hide()},onOpen:function(){Config.twoUnlim&&this.$el.addClass("twoUnlim"),0!==user.get("lives")&&this.$("#addLifesBuy").addClass("disabled"),Config.keyForLives&&Config.keyForLives.networks&&(-1!=Config.keyForLives.networks.indexOf(network)||-1!=Config.keyForLives.networks.indexOf(network+"_"+window.phonegapNetwork))&&this.$el.addClass("keyForLives");var e=this.getBonusWorldWithLives();e&&0===user.get("lives")&&(this.$el.addClass("hasWorldWithLives").addClass("hasWorldWithLives_"+e.get("name")),this.$(".mWorldLives").html(e.get("livesInstance").get("lives"))),this.$(".coinsBlock .mAmount").html(user.get("coins").get()),this.$(".maxLife").html(Config.maxLives),this.$(".addLifeIcoTextAmount").html(Config.maxLives),user.on("change:lives",this.renderCurrentLife,this),this.renderCurrentLife(),user.on("change:timeToNextLife",this.renderTimeToNextLife,this),this.renderTimeToNextLife(),this.$("#addLifesPrice").html(Number(Config.lifeRefillPrice)),prices.unlimitedLifes&&this.$("#unlimitedLifesPrice").html(prices.unlimitedLifes.desc.price),prices.unlimitedLifesDay&&this.$("#unlimitedLifesPriceDay").html(prices.unlimitedLifesDay.desc.price),Config.rewardAdForLives&&Config.livesForAd&&0===user.get("lives")&&(this.$(".lifesCountForAd").text(Config.livesForAd),this.$el.toggleClass("advert",Config.rewardAdForLives.checkAvailable())),TWindow.prototype.onOpen.call(this)},askLife:function(){this.close(),LifeKeeper.askSendLifes()},buyUnlimitedLifes:function(){this.close(),showBuy(prices.unlimitedLifes)},buyUnlimitedLifesDay:function(){this.close(),showBuy(prices.unlimitedLifesDay)},refill:function(){0===user.get("lives")&&(this.close(),user.refillLives()?(application.playSound("buyLives"),user.trigger("refillLives")):new AddLivesWindow)},showAd:function(){this.close(),Config.rewardAdForLives.showAd(_.once(function(){user.set({lives:Math.min(user.get("lives")+Config.livesForAd,Config.maxLives),actionName:"lifes for ad",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0},{validate:!0})}),function(){new this.constructor},this)},getBonusWorldWithLives:function(){for(var e=0;e<Config.bonusWorlds.length;++e){var t=Config.bonusWorlds[e];if(t.get("active")&&!t.get("finished")&&t.get("livesInstance")&&t.get("suggestPlayForLife")&&t.get("minRealLevelToEnter")-1<user.getRealLevel()&&(0<t.get("livesInstance").get("lives")||t.checkUnlimitedLives()))return t}return!1},playBonusWorld:function(){var e=this.getBonusWorldWithLives();e&&(application.windows.closeAll(),application.set("page","main"),e.open())}}),zna;Application.on("ready",function(){user.on("buyProduct",function(e){if(Config.keyForLives&&Config.keyForLives.networks&&(-1!=Config.keyForLives.networks.indexOf(network)||-1!=Config.keyForLives.networks.indexOf(network+"_"+window.phonegapNetwork))&&e&&"unlimitedLifes"===e.goodName){var t=prices.unlimitedKeys;if(!t)return;goods.goodBuyed(t.goodName,e.workHours,!1)}})}),AddLivesWindow.prototype.onOpen=(zna=AddLivesWindow.prototype.onOpen,function(){prices.unlimitedLifesMini&&this.$("#unlimitedLifesPriceMini").html(prices.unlimitedLifesMini.desc.price),zna.call(this),Config.unlimMiniTest&&!this.$el.hasClass("advert")&&this.$el.addClass("unlimMiniTest")}),AddLivesWindow.prototype.events["click #unlimitedLifesMiniBuy"]="buyUnlimitedLifesMini",AddLivesWindow.prototype.buyUnlimitedLifesMini=function(){this.close(),showBuy(prices.unlimitedLifesMini)};var EpisodeLockedWindow=TWindow.extend({templateClass:".episodeLockedWindow_template",events:{"click .close":"close","click #askKeyButton":"askKey","click .askKey":"askKey","click #buyKeysButton":"buyKeys","click #unlockEpisodeButton":"unlockEpisode"},onOpenSound:!1,canOpenNow:function(){return"main"==application.get("page")},onOpen:function(){var e=this;this.autoUnlockEpisodeTime=user.getUnlockKeyTime(),this.render(),user.on("change:keysBought",function(){user.get("keysBought")&&(user.off("change:keysBought"),this.render())},this),user.on("change:receivedKeys",function(){e.render()}),messageCenter.update(),TWindow.prototype.onOpen.call(this)},onClose:function(){user.off("change:keysBought"),user.off("change:receivedKeys")},askKey:function(){this.close(),user.askSendKeys()},buyKeys:function(){!1!==this.findUnlimitedKeysShopPage()?(new EpisodeLockedWindow({firstPriority:!0}),new ShopWindow({page:this.findUnlimitedKeysShopPage(),firstPriority:!0}),this.close()):user.buyKeys()||(this.close(),new EpisodeLockedWindow)},unlockEpisode:function(){this.close(),user.unlockEpisode(),application.windows.runAfterCloseAllWindows(function(){$("#main").addClass("episodeOnStart"),setTimeout(function(){$("#main").removeClass("episodeOnStart")},5e3)})},findUnlimitedKeysShopPage:function(){for(var e=0;e<Config.shopProducts.length;e++)for(var t=0;t<Config.shopProducts[e].length;t++)if("unlimitedKeys"==Config.shopProducts[e][t].name)return e;return!1},updateTimerUnlimitedKeys:function(e,t){var i;i=formatTime(86400<=t?"%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1]:"%H:%i:%s",t);var o=this.$(".timer");o.text()!=i&&o.text(i)},render:function(){episode.isCurrent()&&episode.isFinished()||Config.lockEpisodeShow&&user.get("episode")+1==episode.get("num")&&user.get("level")>episode.levelsInEpisode()?(this.$el.removeClass("episodeNotDone"),episode.get("num")!=Config.episodesAmount||Config.lockEpisodeShow?this.renderLocked():(this.$el.addClass("finalEpisode"),application.playSound("episodeLockedWindow"))):(this.$el.removeClass("finalEpisode").addClass("episodeNotDone"),application.playSound("episodeLockedWindow"))},renderLocked:function(){(this.$el.toggleClass("notFriend",0===allFriendsIds.length),EpisodeLockedWindow.instance=this,void 0!==goods&&goods.checkProduct("unlimitedKeys"))?(this.$el.addClass("unlimitedKeys"),goods.findWhere({name:"unlimitedKeys"}).on("change:timeToFinish",this.updateTimerUnlimitedKeys,this)):this.$el.removeClass("unlimitedKeys");this.autoUnlockEpisodeTime&&(this.$el.addClass("autoUnlockEpisodeTime"),user.get("keyLastUnlockedEpisode")!=user.get("episode")&&user.set({keyLastUnlocked:application.getCurrentServerTime(),keyLastUnlockedEpisode:user.get("episode")}));var e=user.get("receivedKeys"),t=user.amountKeys();this.$el.removeClass("finalEpisode"),this.$("#buyKeysButtonPrice").text(Number(user.getUnlockKeyPrice())),3==t?(application.playSound("episodeLockedWindowKeysCollected"),this.$el.removeClass("episodeClosed").addClass("episodeOpened"),this.$("#episodeClosed").hide(),this.$("#episodeOpened").show(),$("#autoUnlockEpisodeTimerBlock").removeClass("key1TimerOn key2TimerOn key3TimerOn"),this.autoUnlockEpisodeTime&&user.set("timeToAutoUnlockKey",-1),$(".chargingAnimate").removeClass("chargingAnimate")):(application.playSound("episodeLockedWindow"),this.$el.removeClass("episodeOpened").addClass("episodeClosed"),this.$("#episodeClosed").show(),this.$("#episodeOpened").hide(),!1!==this.findUnlimitedKeysShopPage()&&this.$("#buyKeysButton").html(messages.buyNow),$("#main").removeClass("episodeAllRumRecieved"),$("#autoUnlockEpisodeTimerBlock").removeClass("key1TimerOn key2TimerOn key3TimerOn").addClass("key"+(t+1)+"TimerOn"),$(".chargingAnimate").removeClass("chargingAnimate"),$("#key_"+(t+1)).addClass("chargingAnimate"),this.autoUnlockEpisodeTime&&this.runUnlockTimer());for(var i=0;i<3;i++){var o=this.$("#key_"+(i+1));if(i<t){o.removeClass("keySendedByFriend noKey");var a=e[i];users[a]&&(o.addClass("keySendedByFriend"),o.find(".keySednedName").text(users[a].first_name),o.find(".keySednedPhoto").html(socialNetwork.makePhotoById(a,Config.episodeLockedWindowPhotoSize)))}else o.removeClass("keySendedByFriend").addClass("noKey")}episodeView.checkRum()},runUnlockTimer:function(){EpisodeLockedWindow.autoUnlockKeyIntervalFunction(),EpisodeLockedWindow.isTimerRunned||(EpisodeLockedWindow.isTimerRunned=!0,EpisodeLockedWindow.unlockKeyTimer=setInterval(EpisodeLockedWindow.autoUnlockKeyIntervalFunction,1e3))}},{amountKeys:function(){return user.amountKeys()},autoUnlockEpisodeTimer:function(){var e=user.getUnlockKeyTime(),t=e-(application.getCurrentServerTime()-user.get("keyLastUnlocked"))%e;if(0<t){var i=formatTime("%H:%i:%s",t);$(".shipWater").html(i),$("#autoUnlockEpisodeTimer").html(i),$(".chargingAnimate .autoUnlockEpisodeColoredBg").css("height",parseInt(100-100*t/e)+"%")}},autoUnlockKeyIntervalFunction:function(){var e=user.amountKeys();if(EpisodeLockedWindow.prevAmountKeys!=e&&(EpisodeLockedWindow.prevAmountKeys=e,EpisodeLockedWindow.instance.renderLocked()),3===e)return clearInterval(EpisodeLockedWindow.unlockKeyTimer),void(EpisodeLockedWindow.isTimerRunned=!1);EpisodeLockedWindow.autoUnlockEpisodeTimer()}}),doa;EpisodeLockedWindow.prototype.events["click .showAd"]="showAd",EpisodeLockedWindow.prototype.onOpen=(doa=EpisodeLockedWindow.prototype.onOpen,function(){var e=user.amountKeys();this.$el.removeClass("key1 key2 key3").addClass("keys"+(e+1));var t=this.$el.find(".showAd");return t&&(t.hide(),Config.rewardAdForRum&&e<3&&!goods.checkProduct("unlimitedKeys")&&Config.rewardAdForRum.checkAvailable()&&(this.$el.addClass("adsAvailable"),t.show())),doa.call(this)}),EpisodeLockedWindow.prototype.showAd=function(){Config.rewardAdForRum.showAd(_.once(function(){var e=this.$el.find(".showAd");e&&e.hide(),user.set({keyLastUnlocked:user.get("keyLastUnlocked")-3600,keyLastUnlockedEpisode:user.get("episode"),actionName:"rum for ad",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0},{validate:!0})}),function(){},this)};var SelectFriendWindow=TWindow.extend({templateClass:".SelectFriendWindow_template",initialize:function(){"phonegap"!=network||"phonegap"!=window.phonegapNetwork?socialNetwork.haveAccessToFriends()?(TWindow.prototype.initialize.apply(this,arguments),this.mouseMove=!1):new FriendPermissionWindow({onClose:function(){}}):application.socialLogin.showSocialLoginWindow()},events:{"click .close":"close","keyup #selectFriendMask":"render","touchend #selectFriendMask":"setFocusInput","click .friendAsk":"select","click .selectOneCheckbox .checkbox":"toggleSelectOneAction","click .selectAllCheckbox .checkbox":"toggleSelectAllAction","click .selectFriendDoMassOperation":"doMassOperation","click .selectFriendGiveLifeOperation":"doMassOperation","click .closeSelectFriend":"clearSelectFriendMask","touchstart .selectOneCheckbox":"touchStartCheck","touchmove .selectOneCheckbox":"touchMoveCheck"},touchStartCheck:function(){this.mouseMove=!1},touchMoveCheck:function(){this.mouseMove=!0},setFocusInput:function(){$("#selectFriendMask").focus()},clearSelectFriendMask:function(){""!==this.$("#selectFriendMask").val()&&(this.$("#selectFriendMask").val(""),this.render())},_updateMaxSelectCounter:function(){this.options.maxSelectUsers&&this.options.maxSelectCounterCssSelector&&this.$el.find(this.options.maxSelectCounterCssSelector).text(Math.max(this.options.maxSelectUsers-this.amountSelected(),0))},doMassOperation:function(){for(var e in this.selectedCheckbox){var t=e.substr(15);this.selectedIds.push(t)}0<this.selectedIds.length&&(this.options.massCallback?this.options.massCallback(this.selectedIds):this.options.callback instanceof Function&&_.each(this.selectedIds,_.bind(function(e){this.options.callback(e)},this)),this.trigger("select",this.selectedIds),this.close())},toggleSelectAllAction:function(e){var t=$(e.currentTarget),i=t.hasClass("checkboxOn");t.toggleClass("checkboxOn",!i),this.unselectAll(),i||this.$(".selectOneCheckbox .checkbox").click()},unselectAll:function(){for(var e in this.selectedCheckbox)this.$("#"+e+" .checkbox").click()},toggleSelectOneAction:function(e){if(!this.mouseMove){var t=$(e.currentTarget).parent().parent();if(!t.hasClass("cantSend")){var i=t.attr("id");if(void 0===this.selectedCheckbox[i]){if(0===this.limitSelect||this.limitSelect&&this.amountSelected()==this.limitSelect)return;this.selectedCheckbox[i]=!0,$(e.currentTarget).addClass("checkboxOn")}else delete this.selectedCheckbox[i],$(e.currentTarget).removeClass("checkboxOn");this.$(".amountSelected").html(this.amountSelected()),this.limitSelect&&(this.amountSelected()==this.limitSelect?this.$(".selectFriendBlock").addClass("friendLimit"):this.$(".selectFriendBlock").removeClass("friendLimit")),this.amountSelected()>=this.amountAll?this.$(".selectAllCheckbox .checkbox").addClass("checkboxOn"):this.limitSelect>=this.amountAll&&this.$(".selectAllCheckbox .checkbox").removeClass("checkboxOn")}this._updateMaxSelectCounter()}},amountSelected:function(){var e=0;for(var t in this.selectedCheckbox)e++;return e},_preRender:function(){switch(this.selectOneFriend=!1,("sendDecor"==this.options.type||this.options.selectOneFriend)&&(this.selectOneFriend=!0),this.selectOneFriend||(window.mobile||"test"==network||"facebook"==network)&&this.$el.addClass("selectFewFriendWindow"),this.limitSelect=!1,this.options.customCssClass&&this.$el.addClass(this.options.customCssClass),this.options.type){case"inviteFriendsByRequest":this.$el.addClass("callFewFriends"),this.$(".selectFriendDoMassOperation").html(messages.invite),this.amountAll=Math.min(Config.maxFriendsInviteOneTime,this.options.userIds.length),this.limitSelect=Config.maxFriendsInviteOneTime;break;case"giftLifes":this.$el.addClass("giveLifeFriendWindow"),this.amountAll=Math.min(Config.maxLifesGiftOneTime,this.options.userIds.length),this.limitSelect=Config.maxLifesGiftOneTime;break;case"inviteFriends":this.$el.addClass("inviteSelectFriendWindow"),this.$(".selectFriendDoMassOperation").html(messages.invite),this.amountAll=this.options.userIds.length;break;case"giveHelp":this.$el.addClass("giveHelpFriendWindow"),this.$(".selectFriendDoMassOperation").html(messages.giveHelp),this.amountAll=Math.min(Config.maxLifesGiftOneTime,this.options.userIds.length),this.limitSelect=Config.maxLifesGiftOneTime;break;case"askHelp":this.$el.addClass("askHelpFriendWindow"),this.$(".selectFriendDoMassOperation").html(messages.ask),this.amountAll=Math.min(Config.maxLifesGiftOneTime,this.options.userIds.length),this.limitSelect=Config.maxLifesGiftOneTime;break;case"sendArtifactPart":this.$el.addClass("sendArtifactPart"),this.$el.addClass("selectFewFriendWindow"),this.$(".selectFriendDoMassOperation").html(messages.ask),this.limitSelect=this.options.maxSelectUsers,this.amountAll=Math.min(this.limitSelect,this.options.userIds.length);break;default:this.$(".selectFriendDoMassOperation").html(messages.ask),this.$el.addClass("askSelectFriendWindow"),this.amountAll=this.options.userIds.length}this.options.selectButtonText&&this.$(".selectFriendDoMassOperation").text(messages[this.options.selectButtonText]),this.$(".amountAll").html(this.amountAll),this.$("#selectFriendMask").val(""),this.selectedCheckbox={},this.selectedIds=[],this.userIds=[];var e,t=[];for(e=0;e<this.options.userIds.length;e++)t.push({id:this.options.userIds[e],weight:user.get("userId")==this.options.userIds[e]?1/0:Math.random()*allUsers.get(this.options.userIds[e]).calcWeight()});for(t.sort(function(e,t){return t.weight-e.weight}),e=0;e<t.length;e++)this.userIds.push(t[e].id)},_postRender:function(){this.limitSelect?this.$(".selectOneCheckbox .checkbox").click():(this.$(".selectAllCheckbox .checkbox").removeClass("checkboxOn"),"test"!=network&&"facebook"!=network||this.$(".selectAllCheckbox .checkbox").click()),this._updateMaxSelectCounter()},onOpen:function(){this._preRender(),this.render(),TWindow.prototype.onOpen.call(this),this._postRender()},select:function(e){var t=$(e.currentTarget).parent(),i=t.attr("id").substr(15);this.selectOneFriend||t.hide(),"boolean"==typeof this.options.hideSelected&&t.hide(),this.selectedIds.push(i),this.options.callback instanceof Function&&this.options.callback(i),this.trigger("select",[i]),this.selectedIds.length===this.userIds.length?this.close():this.selectOneFriend&&("boolean"==typeof this.options.autoClose?this.options.autoClose&&this.close():this.close())},onClose:function(){void 0!==this.options.onClose&&this.options.onClose()},setUserIds:function(e){this.options.userIds=e,this._preRender(),this.render(),this._postRender()},setShowTextNoFriends:function(e){this.options.showTextNoUsers=!!e},render:function(){this.$(".selectFriendBlock").removeClass("noFriends").empty(),this.limitSelect||"gems"===Config.project||(this.selectedCheckbox={});for(var e=(this.$("#selectFriendMask").val()||"").toUpperCase(),t=user.get("receivedKeys"),i=this.userIds,o=0,a=0;a<i.length;a++)if(!(0<=this.selectedIds.indexOf(i[a]))){var n=i[a],r=users[n].first_name||"",s=users[n].last_name||"",l=(r+" "+s).toUpperCase(),d=(s+" "+r).toUpperCase();if(0<=l.indexOf(e)||0<=d.indexOf(e)){var c=$($("#selectOneFriendTpl").html());c.find(".friendPhoto").html(socialNetwork.makePhotoById(n,Config.basePhotoSize));var g=users[n].first_name+" "+users[n].last_name;c.find(".friendName").html(g),c.attr("title",g),"sendDecor"==this.options.type&&c.find(".friendAsk").html(messages.compliment),"beginGame"==this.options.type&&c.find(".friendAsk").html(messages.beginGame),c.attr("id","selectFriendId_"+n),this.selectedCheckbox["selectFriendId_"+n]&&c.find(".checkbox").addClass("checkboxOn");var u=!0;"askLifes"!=this.options.type||LifeKeeper.checkCanFriendSendLife(n)||(u=!1),"askKeys"==this.options.type&&0<=t.indexOf(i[a])&&(u=!1),"giftLifes"!=this.options.type||LifeKeeper.checkMeSendLifeToFriend(n)||(u=!1),u||(c.find(".friendAsk").remove(),c.append($(".invisible .cantSendLife").clone()),c.addClass("cantSend").attr("title",c.find(".cantSendLife").attr("title"))),n==user.get("userId")&&c.addClass("self"),this.$(".selectFriendBlock").append(c),o++;var h=30;if(window.mobile&&"gems"==Config.project&&(h=4),h<=o&&window.mobile||200<=o)break}}this.options.showTextNoUsers&&0===i.length&&this.$(".selectFriendBlock").addClass("noFriends").text(messages.outOfMovesTextArr.noFriends)}}),EpisodeFinishedWindow=TWindow.extend({templateClass:".episodeFinishedWindow_template",events:{"click .close":"doClose","click .needPublicCheckbox":"togglePublicCheckbox","click #episodeFinishedPublic":"doPublic"},onOpenSound:"buymoves",doPublic:function(){var e,t;if(Config.everyEpisodeOwnPublication)e=messages.episodeDonePublicationMessage[episode.get("num")-1][user.get("gender")],t=messages.episodeDonePublicationImage[episode.get("num")-1];else{var i=messages.episodeDonePublicationMessage,o=RANDOM(i);e=o[user.get("gender")][0]+messages.treasureName[episode.get("num")-1]+o[user.get("gender")][1],t=Config.everyEpisodeOwnPublicationImage?messages.episodeDonePublicationImage[episode.get("num")-1]:messages.episodeDonePublicationImage}_doPublication(e,t,messages.episodeDonePublicationCaption[user.get("gender")],void 0,_.noop,"episodeDone")},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox(),this.rememberCheckboxState()},doClose:function(){this.needPublic&&this.doPublic(),this.close()},onOpen:function(){this.applyCheckboxState();for(var e=1;e<=Config.episodesAmount;e++)this.$el.removeClass("episode"+e);this.$el.addClass("episode"+user.get("episode")),this.$(".treasureName").html(messages.treasureName[episode.get("num")-1]),(window.mobile&&"odnoklassniki"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption"),TWindow.prototype.onOpen.call(this)}}),ThousandthLevelWindow=TWindow.extend({templateClass:".thousandthLevelWindow_template",events:{"click .close":"close","click .getPrize":"getPrize","click .needPublicCheckbox":"togglePublicCheckbox"},togglePublicCheckbox:function(){this.needPublic=!this.needPublic,this.$(".needPublicCheckbox").toggleClass("checkboxOn")},onOpen:function(){void 0===this.options.level&&(this.options.level=2e3),this.prize=new UserPrizesView({el:this.$(".mPrize"),model:this.options.prize.getUserPrizes()}),this.needPublic=!0,this.$el.addClass("level"+this.options.level),this.$(".level").html(this.options.level),this.$(".needPublicCheckbox").addClass("checkboxOn"),TWindow.prototype.onOpen.call(this)},getPrize:function(){this.options.prize.take(),this.needPublic&&user.defaultPublication("thousandthLevel"+this.options.level+"Publication"),this.close()}}),MyTreasuresWindow=TWindow.extend({templateClass:".myTreasuresWindow_template",events:{"click .myTreasureArrowLeft":"leftPage","click .myTreasureArrowRight":"rightPage","click .close":"close","click .myTreasure":"goToEpisode","touchend .myTreasure":"goToEpisode"},leftPage:function(){!this.$(".myTreasureArrowLeft").hasClass("disabled")&&0<this.page&&(this.page=this.page-1,this.render())},rightPage:function(){!this.$(".myTreasureArrowRight").hasClass("disabled")&&this.page<this.pageTotal()-1&&(this.page=this.page+1,this.render())},pageTotal:function(){return Math.ceil(user.get("episode")/this.pageData().treasuresInPage)},isTreasureFinded:function(e){return user.get("episode")>e||user.get("episode")==e&&user.get("level")>Config.levelsInEpisode},pageData:function(){return{treasuresInRow:Config.treasuresInRowInWindow,treasuresRows:Config.treasuresRowsInWindow,treasuresInPage:Config.treasuresInRowInWindow*Config.treasuresRowsInWindow}},goToEpisode:function(e){var t=$(e.currentTarget).data("episode");if(!window.mobile||!$("#main").hasClass("episode_"+t))return t&&(this.isTreasureFinded(t)||user.get("episode")==t)&&"main"==application.get("page")&&(this.close(),episodeView.changeEpisode(t)),!1},render:function(){var o=this.pageData();this.$("#myTreasures").empty();for(var e=_.bind(function(e){var t=this.page*o.treasuresInPage+e+1,i=$(".invisible .myTreasure").clone();i.addClass("episode"+t).addClass("row"+(Math.floor(e/o.treasuresInRow)+1)),i.attr("data-episode",t),t==user.get("episode")&&i.addClass("windowTreasureCurrent"),this.isTreasureFinded(t)&&(i.addClass("windowTreasureOpened"),i.find(".windowTreasureName").html(messages.treasureName[t-1])),i.find(".windowTreasureNumber").html(t),this.$("#myTreasures").append(i)},this),t=0;t<o.treasuresInPage;t++)e(t);var i=(this.page+1)*o.treasuresInPage+1;0!=this.page||this.isTreasureFinded(i)?(this.$(".myTreasureArrowLeft").show(),this.$(".myTreasureArrowRight").show()):(this.$(".myTreasureArrowLeft").hide(),this.$(".myTreasureArrowRight").hide()),0==this.page?this.$(".myTreasureArrowLeft").addClass("disabled"):this.$(".myTreasureArrowLeft").removeClass("disabled"),this.page>=this.pageTotal()-1?this.$(".myTreasureArrowRight").addClass("disabled"):this.$(".myTreasureArrowRight").removeClass("disabled"),this.$(".page").html(this.page+1),this.$(".page-total").html(this.pageTotal())},onOpen:function(){var e=this.pageData(),t=user.get("episode")-1;user.get("level")>Config.levelsInEpisode&&t++,0<t&&t--,this.page=Math.floor(t/e.treasuresInPage),this.render(),TWindow.prototype.onOpen.call(this)}});Application.once("ready",function(){$("body").on("click touchend",".showMyTreasuresWindow",function(){new MyTreasuresWindow})}),_.override(MyTreasuresWindow,{render:function(){var o=this.override,e=this.$el.find(".myTreasure"),t=_.bind(function(){if(o.call(this,arguments),this.$(".myTreasureArrowLeft").show(),this.$(".myTreasureArrowRight").show(),!window.mobile)for(var t=this.pageData(),e=_.bind(function(e){var i=this.page*t.treasuresInPage+e+1;if(i<=Config.episodesAmount){var o=this.$el;callServiceOrLocalStorage("../../../levelbase/src/services/loadmyepisodescores.php",function(e){var t=0;e.scores&&e.scores.length&&_.each(e.scores,function(e){e.stars&&(t+=e.stars)},this),o.find(".episode"+i+" .windowTreasureStars").html(t),o.find(".episode"+i+" .windowTreasureBonusLevel").toggleClass("bonusLevelFinished",e.bonusLevelFinished)},{episode:i,checkBonusLevel:1},"myr_"+i,{scores:[],bonusLevelFinished:0})}},this),i=0;i<t.treasuresInPage;i++)e(i);this.$el.find(".myTreasure .windowTreasure").each(function(){$(this).css({opacity:0}).setScale(.5).ourAnimate({scale:1,opacity:1},300,"easeOutBack")})},this);if(0===e.length)t();else{var i=_.after(e.length,t);e.find(".windowTreasure").each(function(){$(this).ourAnimate({scale:.5,opacity:0},200,"linear",i)})}},onOpen:function(){var e=this.pageData();this.page=Math.ceil(user.get("episode")/e.treasuresInPage)-1,this.render(),TWindow.prototype.onOpen.call(this)}});var GoodsPromoWindow=TWindow.extend({templateClass:".goodsPromoWindow_template",events:{"click .close":"close","click .goodsPromoClose":"close","click #buyAgain":"buy"},getProductName:function(){return Config.goodsPromo&&Config.goodsPromo[this.options.productName]?Config.goodsPromo[this.options.productName].product:this.options.productName},canOpenNow:function(){return!goods.findOrCreate({type:this.options.productType}).get("active")},onOpen:function(){goods.findOrCreate({type:this.options.productType}).set("alreadySeen",1).save(),this.$("#goodsInfo").removeClass().addClass(this.options.productName),this.$(".goodsPromoText").html(messages.goodPromoInfo[this.options.productName].text),"additionalLifes"==this.options.productName?this.$(".goodPrice").html(Config.goods.additionalLifes.coinsPrice):this.$(".goodPrice").html(prices[this.getProductName()].desc.price),this.$(".goodsPromoTitle").html(messages.goodPromoInfo[this.options.productName].title),this.$("#buyAgain").html(messages.goodPromoInfo[this.options.productName].buyAgain),TWindow.prototype.onOpen.call(this)},buy:function(){if(this.close(),"additionalLifes"==this.options.productName){var e=new ObscureNumber(user.get("coins").get()-Config.goods.additionalLifes.coinsPrice);user.set({coins:e},{validate:!0})?(goods.goodBuyed("additionalLifes",Config.goods.additionalLifes.workHours),user.set("lives",Config.maxLives),new AdditionalLivesWindow):(this.close(),new GoodsPromoWindow(this.options))}else showBuy(prices[this.getProductName()])}}),ChampionWindow=TWindow.extend({templateClass:".championWindow_template",events:{"click .share":"share","click .close":"close"},onClose:function(){this.options.backToMain.call(this)},onOpenSound:"championwindow",onOpen:function(){this.$(".level").html(episode.absoluteLevelNumber(this.options.level));for(var e=0;e<3;e++)window.mobile||(this.$("#placeColumn"+(e+1)).css({top:"0px"}),this.$("#placeColumn"+(e+1)).setCoords({top:(Config.championWindowColumnsBeginTop||200)+"px"})),this.$("#placeColumn"+(e+1)+" .photo").html(socialNetwork.makePhotoById(this.options.places[e].get("id"),Config.basePhotoSize)).attr("title",this.options.places[e].get("name")),this.$(".placeColumnScoreBlock"+(e+1)+" .score").html(this.options.places[e].get("score"));window.mobile||(this.$("#placeColumn1").delay(1300).ourAnimate({top:(Config.championWindowColumnsHeight&&Config.championWindowColumnsHeight[0]||100)+"px"},1e3,"linear"),this.$("#placeColumn2").delay(800).ourAnimate({top:(Config.championWindowColumnsHeight&&Config.championWindowColumnsHeight[1]||130)+"px"},1e3,"linear"),this.$("#placeColumn3").delay(300).ourAnimate({top:(Config.championWindowColumnsHeight&&Config.championWindowColumnsHeight[2]||160)+"px"},1e3,"linear")),(window.mobile&&"odnoklassniki"==network||window.mobile&&"mailru"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption"),TWindow.prototype.onOpen.call(this)},share:function(){var e=episode.isBonusWorld()?Config.bonusWorld.name+"ChampionBonusWorld":"champion",t=RANDOM(messages[e+"Message"]);_doPublication(t[0]+episode.absoluteLevelNumber(this.options.level)+t[1],messages[e+"Image"],messages.championCaption[user.get("gender")],void 0,_.bind(function(){this.close()},this),e)}}),OvertakenWindow=TWindow.extend({templateClass:".overtakenWindow_template",events:{"click #overtakenPublicBtn":"share","click .close":"close"},onClose:function(){this.options.backToMain.call(this)},onOpenSound:"championwindow",onOpen:function(){this.$el.removeClass("overtakenWindowStartAnimation"),setTimeout(_.bind(function(){this.$el.addClass("overtakenWindowStartAnimation")},this),500),this.$(".level").html(episode.absoluteLevelNumber(this.options.level));var e=this.$(".overtakenMyCard");e.find(".name").html(user.get("name")),e.find(".score").html(this.options.score),e.find(".photo").html(socialNetwork.makePhotoById(user.get("userId"),Config.basePhotoSize)).attr("title",user.get("name")),this.$(".statisticArrowUp").find(".place").html(this.options.myPlace),(e=this.$(".overtakenFriendCard")).find(".name").html(this.options.overtakenFriend.get("name")),e.find(".score").html(this.options.overtakenFriend.get("score")),e.find(".photo").html(socialNetwork.makePhotoById(this.options.overtakenFriend.get("id"),Config.basePhotoSize)).attr("title",this.options.overtakenFriend.get("name")),this.$(".statisticArrowDown").find(".place").html(this.options.friendPlace),(window.mobile&&"odnoklassniki"==network||window.mobile&&"mailru"==network||window.mobile&&"test"==network||"phonegap"==network&&("facebook"==window.phonegapNetwork||"vkontakte"==window.phonegapNetwork||"odnoklassniki"==window.phonegapNetwork))&&this.$el.addClass("hasShareOption"),TWindow.prototype.onOpen.call(this)},share:function(){var e=RANDOM(messages.upFriendOnLevel);episode.isBonusWorld()&&(e=RANDOM(messages[Config.bonusWorld.name+"UpFriendOnLevelBonusWorld"])),e=sprintf(e[user.get("gender")],{levelNum:episode.absoluteLevelNumber(this.options.level)});var t=_.bind(this.close,this);"wizq"==network?_doPublication(this.options.overtakenFriend.get("name")+e,messages.upFriendOnLevelImage,messages.upFriendOnLevelCaption[user.get("gender")],void 0,t):socialNetwork.sendRequest({type:"scoreOvertaking",userIds:this.options.overtakenFriend.id,message:e,success:t})}}),ShopWindow=TWindow.extend({templateClass:".shopWindow_template",events:{"click .close":"close","click .shopTabItem":"selectTab","click .buyItem":"buy","click .giftItem":"gift","click .shopArrowLeft":"leftTab","click .shopArrowRight":"rightTab"},canOpenNow:function(){return user.get("shopAvailable")},leftTab:function(){0<this.page&&this.renderPage(this.page-1)},rightTab:function(){this.page<Config.shopProducts.length-1&&this.renderPage(this.page+1)},onOpen:function(){this.page=this.options.page?this.options.page:0,this.renderTabs(),this.renderPage(this.page),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),TWindow.prototype.onOpen.call(this)},selectTab:function(e){var t=$(e.currentTarget).data("page");if(this.page!==t){var i=_.bind(function(){this.renderPage(t),this.$el.find(".shopList .shopItem").each(function(){$(this).css({opacity:0}).setScale(.5).ourAnimate({scale:1,opacity:1},300,"easeOutBack")})},this),o=this.$(".shopList .shopItem");if(0<o.length){var a=_.after(o.length,i);o.each(function(){$(this).ourAnimate({scale:.5,opacity:0},200,"linear",a)})}else i()}},renderTabs:function(){var i=$(".invisible .shopTabItem"),o=this.$(".tabbar");_.each(Config.shopProducts,function(e,t){i.clone().appendTo(o).addClass("page"+t).data("page",t).find(".title").html(messages.shopTabsTitle[t])},this)},renderPage:function(e){this.$(".tabbar .shopTabItem").removeClass("selected"),this.$(".tabbar .shopTabItem.page"+e).addClass("selected"),void 0===gifts?this.$el.addClass("notGifts"):this.$el.removeClass("notGifts"),this.$el.removeClass("page"+this.page).addClass("page"+e);var r=this.$(".shopList").removeClass("page"+this.page).addClass("page"+e);r.empty(),_.each(Config.shopProducts[e],function(t){if(!t.networks||!t.networks.length||-1!==t.networks.indexOf(network)){var i=$(".invisible .shopItem."+t.tpl).clone().appendTo(r).addClass(t.type+"Type").addClass(t.name).addClass(t.name+"Product").data("product",t);if(i.find(".itemTitle").html(messages.shopProducts[t.name][0]),i.find(".itemDescription").html(messages.shopProducts[t.name][1]),i.find(".timeAmount").html(messages.shopProducts[t.name][2]||""),t.addPowerUpAmount&&(_.each(t.addPowerUps,_.bind(function(e){user.getPowerUpAmount(e)>=99-t.addPowerUpAmount&&i.find(".buyItem").addClass("disabled")},this)),i.find(".amount").html(t.addPowerUpAmount)),"money"==t.type){var e=prices[t.name];if(e&&(i.find(".price").html(e.desc.price),e.goodName&&(i.addClass(e.goodName),goods.checkProduct(e.goodName)))){var o=goods.findWhere({name:e.goodName});o.set("timeToFinish",o.get("timeToFinish")+1),o.refresh(),i.addClass("shopItemDisabled")}}else"coins"==t.type&&i.find(".price").html(Number(_.result(t,"price")));if(i.find(".buyItem").addClass(t.type),"refillKeys"==t.name&&(Config.episodesAmount==user.get("episode")||goods.checkProduct("unlimitedKeys")||user.get("level")-1!=Config.levelsInEpisode||3==user.amountKeys()?(i.find(".buyItem").addClass("disabled"),i.addClass("keys3")):(i.addClass("keys"+(3-user.amountKeys())),i.find(".buyItem").removeClass("disabled"))),t.giftId&&void 0!==Gifts){var a=Gifts.findGiftById(t.giftId);if(a){var n=i.hasClass("giftItem")?i:i.find(".giftItem");n.addClass(a.buyType),"money"==a.buyType||"odgifts"==a.buyType?n.find(".price").html(prices[a.id].desc.price):"coins"==a.buyType&&n.find(".price").html(Number(a.price))}}else i.addClass("notGifts");t.discount?i.find(".sale").html(t.discount):i.find(".discount").remove()}}),this.page=e},buy:function(e){if(!$(e.currentTarget).hasClass("disabled")){var t=$(e.currentTarget).parents(".shopItem").data("product");if("coins"==t.type){var i=_.result(t,"price");if(user.get("coins")>=i){if(void 0!==t.addPowerUps&&(_.each(t.addPowerUps,_.bind(function(e){user.setPowerUpAmount(e,user.getPowerUpAmount(e)+t.addPowerUpAmount,!0)},this)),user.set({powerUps:user.calcPowerUps(),coins:new ObscureNumber(user.get("coins")-Math.abs(i)),actionName:t.name,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:i}),application.playSound("buyShopProduct")),"refillKeys"==t.name)return user.buyKeys(),void this.close();this.renderPage(this.page)}else new ShopWindow({page:this.page,firstPriority:!0}),new NoCoinsWindow({firstPriority:!0}),this.close()}else{var o=prices[t.name];o&&(showBuy(o),this.close())}}},gift:function(e){if(gifts){var t=$(e.currentTarget);if(t.hasClass("shopItem")||(t=t.parents(".shopItem")),!t.hasClass("disabled")){var i=t.data("product");if(i.giftId){var o=Gifts.findGiftById(i.giftId);if(o){var a=[];if(-1!=i.name.indexOf("gift_sticker")&&a.push(user.get("userId")),new ShopWindow({selectedUser:this.options.selectedUser,page:this.page,firstPriority:!0}),this.options.selectedUser)this.giftForUser(o,this.options.selectedUser);else new SelectFriendWindow({selectOneFriend:!0,firstPriority:!0,customCssClass:"shopSelectUser",callback:_.bind(function(e){this.giftForUser(o,e)},this),userIds:a.concat(friendsInAppIds)}).render=function(){SelectFriendWindow.prototype.render.call(this),this.$(".selectOneFriend").each(function(){$(".friendAsk",this).html(this.id=="selectFriendId_"+user.get("userId")?messages.shopBuyButton:messages.shopGiftButton)})},this.close()}else console.warn("    giftId  Config.gifts")}else console.warn("  giftId")}}},giftForUser:function(e,t){Gifts.giftForUser(e,t),this.close()}}),BundleShopWindow=TWindow.extend({templateClass:".bundleShopWindow_template",events:{"click .close":"close","click .jsBuy":"buyProduct"},buyProduct:function(e){var t=$(e.currentTarget).attr("data-priceId");this.close(),showBuy(prices[t])},onOpen:function(){for(var e in TWindow.prototype.onOpen.call(this),prices){var t=prices[e];if("bundle"===t.type){var i=this.$(".invisible .jsBundle").clone();i.addClass(e),i.find(".jsBuy").attr("data-priceId",e),t.desc&&t.desc.description&&i.find(".jsDescription").html(t.desc.description),t.desc&&t.desc.price&&i.find(".jsPrice").html(t.desc.price),i.appendTo(this.$(".jsBundlesList"))}}}}),ShopRecommendedWindow=TWindow.extend({templateClass:".shopRecommendedWindow_template",events:{"click .close":"close","click .try":"tryProduct"},tryProduct:function(){new ShopWindow({page:this.options.type.page}),this.close()},onOpen:function(){this.$el.removeClass().addClass("window").addClass(this.options.type.name+"RecommendedWindow"),this.$(".shopRecommendedTitle").html(messages.shopRecommendedTexts[this.options.type.name].title),this.$(".shopRecommendedText").html(messages.shopRecommendedTexts[this.options.type.name].text),TWindow.prototype.onOpen.call(this)}}),GachaWindow=TWindow.extend({templateClass:".gachaWindow_template",initialGachaSize:{w:$(".gachaRound").width(),h:$(".gachaRound").height()},events:{"click .close":"close","click .start":"start"},close:function(){window.mobile&&this.processed||(TWindow.prototype.close.call(this),this.$(".gachaRound").clearQueue().stop(),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),$(".gachaBlock").fadeIn(300),window.mobile&&($("#topMenu").css("z-index",3),$("#coinsBlock").removeClass("disabled").css("z-index","auto")))},getSectors:function(){return Config.gacha.sectors},onOpen:function(){this.listenTo(user,"buyProduct",this.onProductBuy,this),$(".gachaBlock").hide(),this.currentSector=0,this.currentDeg=0,this.shadow=!1,this.$el.addClass(Config.gacha.cls),this.$(".gachaRound").setAngle("0deg"),this.$(".gachaSectors").empty(),this.$(".gachaBlackout").hide(),this.$(".gachaCharacter").removeClass("gachaCharacterSad gachaCharacterHappy gachaCharacterAnimation"),this.$(".infoBlock").find(".text").html(messages.gachaText),this.renderButton(),this.listenTo(user,"change:spins",this.renderButton),this.listenTo(user,"change:gachaAvailable",this.renderButton),this.renderSectors(),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),window.mobile&&($("#topMenu").css("z-index","auto"),$("#coinsBlock").addClass("disabled").css("z-index",20)),TWindow.prototype.onOpen.call(this)},onProductBuy:function(e){"gachaSpin"===e.type&&0<user.get("spins")&&this.start()},renderSectors:function(){for(var e=this.$(".gachaSectors").empty(),t=$(".invisible .gachaSector"),i=this.getSectors(),o=0;o<i.length;o++){var a=t.clone();a.addClass("gachaSector"+(o+1)),a.find(".gachaItem").addClass(i[o].cssClass),e.append(a)}},renderButton:function(){"coins"===Config.gacha.type?(this.price=Config.gacha.price,this.$(".gachaPrice").html(this.price)):"product"===Config.gacha.type&&Config.gacha.product&&prices[Config.gacha.product]&&(this.price=prices[Config.gacha.product].desc.price),0<user.get("spins")?this.$(".start").html(messages.gachaStartSpin):this.again?this.$(".start").html(messages.gachaAgainBtn):this.$(".start").html(messages.gachaStartBtn),this.$(".gachaPrice").html(this.price),this.$(".start").toggleClass("visible",Boolean(user.get("gachaAvailable"))),this.$el.toggleClass("notAvailable",Boolean(user.get("gachaAvailable")))},calcWinSector:function(){return Math.floor(Math.random()*this.getSectors().length)},getPrize:function(){var t=this.getSectors()[this.currentSector];switch(t.type){case"coins":user.set({coins:new ObscureNumber(user.get("coins")+t.amount),todayGachaPlayTimes:user.get("todayGachaPlayTimes")+1,actionName:"wingacha"+this.currentSector,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:this.price});break;case"powerUps":_.each(t.powerUps,_.bind(function(e){user.setPowerUpAmount(e,user.getPowerUpAmount(e)+t.amount,!0)},this)),user.set({powerUps:user.calcPowerUps(),todayGachaPlayTimes:user.get("todayGachaPlayTimes")+1,actionName:"wingacha"+this.currentSector,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:this.price}),application.playSound("gachaWindowPowerUpsPrize");break;case"good":if(user.set({todayGachaPlayTimes:user.get("todayGachaPlayTimes")+1}),goods.goodBuyed(t.name,t.amount),application.playSound("gachaWindowGoodPrize"),!this.openshop){var e=["unlimitedKeys","addThreeMoves","starInField"].indexOf(t.name);0<=e&&(this.openshop=!0,new ShopWindow({page:e}))}}this.renderButton()},start:function(e){if(this.processed)return!1;0<user.get("spins")?(user.set("spins",user.get("spins")-1),this.process()):"coins"===Config.gacha.type?user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(this.price)),actionName:"buygacha",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:this.price},{validate:!0})?this.process():(this.close(),new GachaWindow):"product"===Config.gacha.type&&Config.gacha.product&&prices[Config.gacha.product]&&showBuy(prices[Config.gacha.product])},process:function(){user.trigger("gachaProcess"),this.again=!0,this.processed=!0,this.$el.addClass("process"),this.$(".start").addClass("disabled"),this.$(".gachaCharacter").removeClass("gachaCharacterSad gachaCharacterHappy").addClass("gachaCharacterAnimation"),this.$(".gachaCenter").removeClass("gachaCenterHappy").addClass("gachaCenterAnimation"),application.playSound("gachaWindowThumbler");var e=_.bind(function(){for(var e=this.calcWinSector(),t=1448,o=this.currentDeg,a=this.getSectors();this.currentSector!=e;)this.currentSector=(this.currentSector+a.length-1)%a.length,t+=360/a.length;var n=this.$(".gachaRound"),r=2*t/(.36-.16),s=.2*r/Math.sqrt(.6),l=0;n.animate({path:new function(){this.css=function(e){var t=0;(e=1-e)<.2?t+=r*e*e/2:(t+=.2*r*.2/2,(e-=.2)<.2?t+=.2*r*e:(t+=.2*r*.2,t+=.2*r*(e-=.2)-2*s*e*Math.sqrt(e)/3));var i=Math.round(t*a.length/360);return i!=l&&(l=i,application.playSound("gachaWindowWhip")),n.setAngle(o+t+"deg"),{}}}},8e3,"linear");var i=_.bind(function(){this.currentDeg+=t-8,this.$(".gachaCharacter").removeClass("gachaCharacterAnimation"),this.$(".gachaCenter").removeClass("gachaCenterAnimation"),this.$(".gachaBlackout").fadeIn(300,_.bind(function(){this.shadow=!0,this.renderButton(),"fail"!==a[this.currentSector].type?(this.$(".gachaSector"+(this.currentSector+1)).find(".gachaItem").delay(300).ourAnimate({scale:1.5},300,"linear").ourAnimate({scale:1},300,"linear"),this.$(".infoBlock").find(".text").html(this.getPrizeText(this.currentSector)),application.playSound("gachaWindowWin"),this.$(".gachaCharacter").addClass("gachaCharacterHappy"),this.$(".gachaCenter").addClass("gachaCenterHappy")):(this.$(".infoBlock").find(".text").html(messages.gachaFail),application.playSound("gachaWindowLose"),this.$(".gachaCharacter").addClass("gachaCharacterSad")),setTimeout(_.bind(function(){this.getPrize(),this.$el.removeClass("process"),this.$(".start").removeClass("disabled"),this.processed=!1},this),1300)},this))},this);n.ourAnimate({rotate:"-=8deg"},1e3,"easeInOutQuad",i)},this);this.shadow?this.$(".gachaBlackout").fadeOut(300,e):setTimeout(e,300)},getPrizeText:function(e){return messages.gachaPrizes[e]}}),EverydayBonusWindow=TWindow.extend({templateClass:".everydayBonusWindow_template",events:{"click .getPrize":"getPrize","click .close":"close","click .needPublicCheckbox":"togglePublicCheckbox"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},findPrizeOnDay:function(e){return this.prizes[e]},getPrize:function(){if(this.prize){var e={everydayBonusSeria:(this.seria+1)%this.days,everydayBonusCollected:1};this.prize.take(),user.set(e),this.prize.findWhere({type:"spins"})&&new GachaWindow({firstPriority:!0}),this.prize=null,this.needPublic&&"spmobage"!==network&&user.defaultPublication("everydayBonusPublication");var t=this;return setTimeout(function(){t.close()},this.powerUpsAndCoinsWindowBlock?1e3:0),application.emit("getDailyPrize")}},calculatePrize:function(){this.seria=this.options.seria,this.seria>this.days&&(this.seria=0),this.prize=this.findPrizeOnDay(this.seria)},close:function(){TWindow.prototype.close.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0)},getPrizes:function(e){return e.prizes.map(function(e){if(_.isArray(e))for(var t=0;t<e.length;++t)if(!(e[t].minLevel&&e[t].minLevel>user.getCurrentLevel())){e=e[t];break}return new UserPrizes(e.products,"everydaybonus")})},onOpen:function(){this.prizes=this.getPrizes(Config.everydayBonus),this.days=this.prizes.length,this.calculatePrize(),this.onPublicCheckbox();for(var e=0;e<this.days;e++){var t=this.findPrizeOnDay(e);new UserPrizesView({model:t,el:this.$(".prizeOnDay_"+e+" .mPrizes")})}this.$(".collected").removeClass("collected"),this.$(".today").removeClass("today");for(e=0;e<this.seria;e++)this.$(".prizeOnDay_"+e).addClass("collected");this.$(".prizeOnDay_"+this.seria).addClass("today"),setTimeout(_.bind(function(){application.playSound("everydayBonusWindow"),window.mobile||this.$(".prizeOnDay_"+this.seria+" .prizeCollectedBg").fadeIn(4e3),this.$(".prizeOnDay_"+this.seria+" .prizeIco").delay(500).ourAnimate({scale:1.3},250).ourAnimate({scale:1},250,"",function(){this.style.transform=""})},this),700),0<this.$(".playerPowerupsBlock").length&&(this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")})),TWindow.prototype.onOpen.call(this)}}),OfferWindow=TWindow.extend({events:{"click .setupOfferBtn":"start","click .close":"close"},initialize:function(e){this.templateClass=".advWindow"+e.offer.name+"_template",TWindow.prototype.initialize.apply(this,arguments)},start:function(){"vkontakte"==network&&(vkLastProduct=!1,VK.callMethod("showOrderBox",{type:"offers",offer_id:this.options.offer.id}),this.checkInterval=setInterval(_.bind(this.checkSuccess,this),1e3)),"test"==network&&(this.close(),user.trigger("completeOffer",this.options.offer.id)),this.options.offer.onClickOfferWindow&&this.options.offer.onClickOfferWindow()},checkSuccess:function(){callService("../../../levelbase/src/services/checkoffercompleted.php",_.bind(function(e){"yes"!=e||this.closed||(this.close(),user.trigger("completeOffer",this.options.offer.id),setCookie("lastCompletedOfferTime",application.getCurrentServerTime()))},this),function(){},{offerId:this.options.offer.id})},onOpen:function(){this.$el.removeClass("addedToGroup").addClass("notAddedToGroup"),this.checkInterval=!1,TWindow.prototype.onOpen.call(this),"vkontakte"==network&&this.checkSuccess()},close:function(){!1!==this.checkInterval&&clearInterval(this.checkInterval);var e=new Date((new Date).getTime()+6048e5).toUTCString();setCookie("offer_"+this.options.offer.id,1,e),TWindow.prototype.close.call(this)}}),CompleteOfferWindow=TWindow.extend({events:{"click .setupOfferBtn":"close","click .close":"close"},initialize:function(e){this.templateClass=".advWindow"+e.offer.name+"_template",TWindow.prototype.initialize.apply(this,arguments)},open:function(){TWindow.prototype.open.call(this),user.set("coins",new ObscureNumber(user.get("coins")+this.options.offer.prize),{notSave:!0}),this.$el.removeClass("notAddedToGroup").addClass("addedToGroup")}}),Good=Backbone.Model.extend({idAttribute:"type",defaults:{type:0,buyedTime:0,alreadySeen:0,workHours:0,amount:0,name:null,active:!1,timeToFinish:null,needToUse:!1},initialize:function(){var e=Goods.NAMES[this.get("type")],t=Config.goods[e];_.bindAll(this,"refresh"),this.set("world",t.world),this.set("name",e),this.set("shopWindowPage",t.shopWindowPage),this.has("workHours")||this.set("workHours",t.workHours),this.has("buyedTime")||this.set("buyedTime",application.getCurrentServerTime()),this.calcTimeToFinish()<=0?this.set("active",!1):this.set("active",!0),new t.viewClass({model:this}),this.refresh()},calcTimeToFinish:function(){var e=this.get("buyedTime")+3600*this.get("workHours")-application.getCurrentServerTime();return e<0&&(e=0),e},refreshTick:function(){var e=this.calcTimeToFinish();this.set("timeToFinish",e),e<=0&&(this.set("active",!1),this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=!1))},refresh:function(){this.refreshTick(),0<this.get("timeToFinish")&&!this.refreshInterval&&(this.set("active",!0),this.refreshInterval=setInterval(_.bind(this.refreshTick,this),1e3))},save:function(){var e=this.toJSON(),t=user.get("ABTestGroup");if(callServiceAddInQueue("../../../levelbase/src/services/goods.php",{good:JSON.stringify(e)}),!this.get("gift")&&t&&Config.project&&"candyvalley"===Config.project&&-1<[3,5,6].indexOf(this.get("type"))&&0===this.get("workHours")){var i={delta:e.amount-this.previousAttributes().amount,type:this.get("type"),group:t.id};0!==i.delta&&callServiceAddInQueue("../../../levelbase/src/services/goodshistory.php",i)}this.set("gift",!1)}}),Goods=Backbone.Collection.extend({model:Good,constructor:function(e){for(var t in Goods.NAMES={},Config.goods)Goods.NAMES[Config.goods[t].productId]=t;Backbone.Collection.prototype.constructor.call(this,e.filter(function(e){return void 0!==Goods.NAMES[e.type]}))},buyGood:function(e){showBuy(this.getGoodProduct(e))},goodBuyed:function(e,t,i){application.playSound("buyGood");var o=Config.goods[e].productId,a=this.any({type:o}),n=this.find({type:o})||new Good({type:o,workHours:t});t=t||Config.goods[e].workHours,a&&n.get("active")?(n.set("buyedTime",n.get("buyedTime")-this.calcTimeShift(n,t)),t=n.get("workHours")+Math.ceil(t)):(n.set("buyedTime",application.getCurrentServerTime()-this.calcTimeShift(n,t)),t=Math.ceil(t)),n.set({workHours:t,alreadySeen:0}),n.refresh(),a||this.add(n),this.trigger(n.get("name")+"Buyed"),n.save(),i&&void 0!==n.get("shopWindowPage")&&!application.windows.isOpen(ShopWindow)&&new ShopWindow({page:n.get("shopWindowPage")})},getGoodProduct:function(e){return _.find(prices,{type:"good",goodName:e})},checkProduct:function(e){var t=this.find({name:e});return!!t&&(t.get("active")||t.get("needToUse"))},useProduct:function(e){var t=this.find({name:e});t&&(t.get("active")||t.get("amount")&&(t.set("amount",t.get("amount")-1),t.save()))},findOrCreate:function(e){return this.find(e)||this.create(e)},calcTimeShift:function(e,t){var i=t-Math.floor(t);return 0===i?0:3600*(1-i)}}),UnlimitedLifesView=Backbone.View.extend({el:"#livesBlock",initialize:function(){this.$timeToFinish=this.$(".unlimitedLifesBlock .timeToFinish"),this.model.on("change:active",this.renderActive,this),this.model.on("change:timeToFinish",this.renderTimeToFinish,this),this.renderActive()},renderActive:function(){this.model.get("active")?(this.$el.addClass("unlimitedLifes"),$(".livesAmulet").addClass("unlimAvailable")):(this.$el.removeClass("unlimitedLifes"),$(".livesAmulet").removeClass("unlimAvailable"))},renderTimeToFinish:function(e,t){var i;i=formatTime(86400<t?"%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1]:"%H:%i:%s",t),this.$timeToFinish.text()!=i&&this.$timeToFinish.text(i)}}),UnlimitedBonusWorldLivesView=Backbone.View.extend({el:"#livesBlockBonusWorld",initialize:function(){var e=$("#menu .templates.invisible").find(".unlimitedLifesBlock").clone();e.addClass(this.model.get("world")),this.$el.append(e),this.$timeToFinish=e.find(".timeToFinish"),episode.on("change:num",this.onChangeEpisode,this),this.onChangeEpisode()},onChangeEpisode:function(){var e=Config.bonusWorlds.getByName(this.model.get("world")),t=Config.bonusWorlds.getByName(episode.get("num"));e&&t&&e===t&&(e.get("livesInstance")===t.get("livesInstance")?(this.model.on("change:active",this.renderActive,this),this.model.on("change:timeToFinish",this.renderTimeToFinish,this)):(this.model.off("change:active",this.renderActive,this),this.model.off("change:timeToFinish",this.renderTimeToFinish,this)),this.renderActive())},renderActive:function(){var t=this;Config.bonusWorlds.forEach(function(e){t.$el.removeClass(e.get("name"))}),this.$el.toggleClass("unlimitedLives",this.model.get("active"))},renderTimeToFinish:function(){var e,t=Math.ceil(this.model.get("timeToFinish"));e=formatTime(86400<=t?"%j"+messages.timeShort[2]+"%H"+messages.timeShort[1]+"%i"+messages.timeShort[0]:"%H:%i:%s",t),this.$timeToFinish.html(e)}}),GoodInShopView=Backbone.View.extend({initialize:function(){this.model.on("change:active",this.renderActive,this),this.model.on("change:timeToFinish",this.onTimeToFinish,this),this.renderActive()},renderActive:function(){this.model.get("active")?$("#shopWindow ."+this.model.get("name")).addClass("shopItemDisabled"):$("#shopWindow ."+this.model.get("name")).removeClass("shopItemDisabled")},onTimeToFinish:function(e,t){var i;i=formatTime(86400<=t?"%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1]:"%H:%i:%s",t);var o=$("#shopWindow ."+this.model.get("name")+" .shopBuyedTimeout");o.text()!=i&&o.text(i)}}),Task=Backbone.Model.extend({defaults:{active:!0,collectedAmount:0,completed:!1},interimCounter:0,sourceSize:null,objCellAmount:void 0,initialize:function(){this.set("beginAmount",this.get("amount")),this.set("cssClass",Config.tasks[this.get("type")].cssClass),this.set("name",Config.tasks[this.get("type")].name),Game.on(this.get("event"),this.onEvent,this)},getGroupId:function(){return this.get("type")},precalc:function(e,t){var i=this.sourceSize?this.sourceSize.width:Config.cellWidth,o=this.sourceSize?this.sourceSize.height:Config.cellHeight,a=this.sourceSize?this.sourceSize.marginTop:0,n=this.sourceSize?this.sourceSize.marginLeft:0;e=e||this.$div.find(".taskIco"),this.objCellAmount=t||this.objCellAmount,e.length&&(this.target=e,void 0===this.icoSize&&(this.icoSize=parseInt(this.target.css("width"))),void 0===this.objCellAmount&&(this.objCellAmount=1),this.koef=this.icoSize/((i-n)*this.objCellAmount),this.ajust={x:-(1-this.koef)*((i-n)*this.objCellAmount)/2,y:-(1-this.koef)*((o-a)*this.objCellAmount)/2})},turnOff:function(){return!0},isActive:function(){return this.get("active")},onBeforeTick:function(e){this.get("completed"),this.interimCounter+=1,this.trigger("beforeCompleted",this,e)},canCollect:function(){return!0},onEvent:function(e){this.isActive()&&this.canCollect(e)&&!this.isCollected()&&((e.collectedTask=this).onBeforeTick(e),this.tick(e))},isCollected:function(){return Number(this.get("amount"))-this.interimCounter<=0},updateSourceSize:function(e,t){var i=e?e.width():0,o=e?e.height():0,a=e?e.attrs["margin-top"]:0,n=e?e.attrs["margin-left"]:0;0<i&&0<o&&(this.sourceSize={width:i,height:o,marginTop:a,marginLeft:n},this.precalc(t))},tick:function(e){e=e||1,this.interimCounter-=e,this.get("completed")&&e<0||(this.get("collectedAmount")+e<0&&(e=-this.get("collectedAmount")),this.set("collectedAmount",this.get("collectedAmount")+e),0<this.get("amount")&&(this.set("amount",this.get("amount")-e),this.get("amount")<=0&&(this.set("completed",!0),this.turnOff()&&Game.off(this.get("event"),this.onEvent,this))))},animateCollect:function(e,t,i,o,a){if(this.sourceSize||this.updateSourceSize(e,a),e.length){var n=e.clone(),r=Game.animate();_Figure.blockedAnimations.append(n),n.set({"margin-left":0,"margin-top":0}),n.alignTo(e),n.addClass("animateCollect"),n.find(".arrow").remove(),n.find(".decorator").remove(),void 0!==o&&n.delay(o);var s=360;this instanceof Task?(a&&a!=this.target&&this.precalc(a),s=this.getAnimateCollectRotation()):Task.prototype.precalc.call(this,a),n.ourAnimate({scale:1.2},3*Game.get("speed")).queue(function(e){r(),e()}).ourAnimate({target:this.target,ajust:this.ajust,scale:.75,rotate:s},6*Game.get("speed"),void 0,_.bind(function(){Game.set("score",Math.max(0,Game.get("score")+t)),this.showPoints(n,t),i()},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){n.remove()})}else i()},showPoints:function(e,t){Game.trigger("showFieldPoints",e,t,"collectTaskElem")},getAnimateCollectRotation:function(){return 360},getCompletion:function(){return Math.min(1,this.get("collectedAmount")/this.get("beginAmount"))}});Task.getTaskData=function(e,t){var i=this.getCssClass(t),o=t.amount;return o&&"auto"!==o||(o=this.getTaskAmount(e,t)),{cssClass:i,amount:o}},Task.countCellsInMap=function(e,t){for(var i=0,o=new RegExp(t,"g"),a=0;a<e.length;a++){var n=e[a].match(o);n&&(i+=n.length)}return i},Task.getCssClass=function(e){var t=e.cell,i=Config.tasks[e.type].cssClass;return t&&(i+="_"+t),i},Task.getTaskAmount=function(e,t){return this.countCellsInMap(e.map,"[^. ]")};var Tasks=Backbone.Collection.extend({model:Task,initialize:function initialize(){_.each(application.level.task,function(description){var taskClass=eval(description.type);this.add(new taskClass({description:description}))},this),this.on("change:completed",function(){this.findWhere({completed:!1})||this.onAllComplate()})},onAllComplate:function(){Game.set("fullRunning",!1),Game.win()},isComplate:function(){return!this.findWhere({completed:!1})}});Tasks.getTasks=function(levelData){for(var tasks=levelData.task,result=[],i=0;i<tasks.length;i++){var taskClass=eval(tasks[i].type),taskData=taskClass.getTaskData(levelData,tasks[i]);result.push(taskData)}return result};var inChangeProcess=!1,GameClass=Backbone.Model.extend({defaults:{score:0,scoreCoefficient:0,isPlaying:!0,selectedPowerUp:!1,running:!1,fullRunning:!1,maxSpeed:80,minSpeed:50,buyedMoves:0,buyedTime:0,amountAfterTurnProcess:1e3,useFallDownSpecialCells:!1,cancelNext:!1},_animation:0,_endTurnAnimation:0,_falldownCount:0,actionId:0,speedUp:function(){this.set("speed",this.get("speed")-10,{validate:!0})},validate:function(e){if(e.speed<this.get("minSpeed"))return this.set("speed",this.get("minSpeed")),"too low"},neighbors:function(e,t){t||(t=function(e){return!0});for(var i=[],o=[[0,-1],[0,1],[-1,0],[1,0]],a=0;a<o.length;a++){var n=e.x+o[a][0],r=e.y+o[a][1];Game.inField(n,r)&&t(Game.field[r][n])&&i.push(Game.field[r][n])}return i.filter(function(e){return e})},each:function(e,t){for(var i=0;i<Config.rows;i++)for(var o=0;o<Config.cols;o++)Game.inField(o,i)&&e.call(t,Game.field[i][o],o,i)},filter:function(e,t){for(var i=[],o=0;o<Config.rows;o++)for(var a=0;a<Config.cols;a++)Game.inField(a,o)&&e.call(t,this.field[o][a],a,o)&&i.push(this.field[o][a]);return i},getField:function(e,t){return this.field[t]&&this.field[t][e]?this.field[t][e]:null},find:function(e,t){for(var i=0;i<Config.rows;i++)for(var o=0;o<Config.cols;o++)if(Game.inField(o,i)&&e.call(t,this.field[i][o],o,i))return this.field[i][o];return null},_updateScoreByCoefficient:function(e,t,i){if(!i.isSetByScoreCoefficient){var o=t-this.previous("score"),a=t+Math.round(o*this.getScoreCoefficient());this.set("score",a,{isSetByScoreCoefficient:!0})}},getScoreCoefficient:function(){return this.get("scoreCoefficient")},setScoreCoefficient:function(e){this.set("scoreCoefficient",e)},getScore:function(){return this.get("score")},getPureScore:function(){return Math.round(this.getScore()/(1+this.getScoreCoefficient()))},initialize:function(){this.fallDownSpecialCells=[],this.collectablesContainer=new Backbone.Collection,this.setupAvailableColors(),this.createAfterTurnProcessor(),this.createAfterAnimationProcessor(),this.createAfterEveryAnimationProcessor(),this.on("change:running",function(e,t){t?this.isAnimationRunning()||this.endTurn():(this.set("fullRunning",!1),this.unset("selected"))},this),this.set("speed",this.get("maxSpeed")),this.on("endTurn",function(){this.set("speed",this.get("maxSpeed"))}),this.on("change:score",this._updateScoreByCoefficient,this),this.configureSuggest()},setupAvailableColors:function(){for(var e=application.level,t="",i=0;i<Cell.chars.length;i++)0<=e.colors.indexOf(Cell.chars.charAt(i))&&(t+=Cell.chars.charAt(i));e.availableColors=t},setAvailableColorsTo:function(e){var t=application.level,i=Math.min(Cell.chars.length,e),o=t.colors;if(o.length<i){for(var a=0;a<i;a++)if(-1===o.indexOf(Cell.chars.charAt(a))){o+=Cell.chars.charAt(a);break}}else o=o.substring(0,i);t.colors=o},isAnimationRunning:function(){return 0<this._animation},isEndTurn:function(){return 0===this._animation&&0===this._endTurnAnimation},onChangeAnimations:function(){0!==this._animation||inChangeProcess||this.onFinishAnimations()},isOnField:function(e){return this.field[e.y]&&this.field[e.y][e.x]===e},cancelNext:function(){this.set("cancelNext",!0)},isCancelNext:function(){return this.get("cancelNext")},onFinishAnimations:function(){GameClass.prevFallDown&&(GameClass.prevFallDown=!1,application.stopSound("falldown")),inChangeProcess=!0,!1===this.isAnimationRunning()&&(Game.afterEveryAnimatonProcess(),this.isAnimationRunning())?this.onFinishAnimations():(this.explode(),!1===this.isAnimationRunning()&&(Game.trigger("fallDownStart"),GameClass.prevFallDown=this.fallDown(),GameClass.prevFallDown&&application.playSound("fallDown"),this.speedUp(),!1===this.isAnimationRunning()&&(this.afterAnimatonProcess(),this.get("running")&&(!1===this.isAnimationRunning()&&this.trigger("afterTurn"),!1===this.isAnimationRunning()&&this.afterTurnProcess()),this.isEndTurn()&&this.endTurn())),inChangeProcess=!1)},currentLevel:function(){return episode.isBonusWorld()?Config.bonusWorld.getCurrentLevel()===episode.absoluteLevelNumber(application.level.num):user.getPassedLevels()<episode.absoluteLevelNumber(application.level.num)}});GameClass.prevFallDown=!1,GameClass.prototype.configureSuggest=function(){this.on("change:suggestSwitch",function(e,t){t?this.set("suggestTimeout",canvas.timeManager.setTimeout(_.bind(function(){this.get("suggestFromForce")?this.set("suggest",this.get("suggestFromForce")):this.set("suggest",this.findValidMove())},this),Config.suggestTimeout)):(this.get("suggestTimeout")&&canvas.timeManager.clearTimeout(this.get("suggestTimeout")),this.set("suggest",!1))},this),this.on("change:selectedPowerUp",function(e,t){!1!==t&&this.set("suggestSwitch",!1)},this);var i=function(){Game.get("fullRunning")&&(Game.set("suggestSwitch",!1),Game.set("suggestSwitch",!0))};this.on("change:fullRunning",function(e,t){t?i():this.set("suggestSwitch",!1)},this),this.on("validMove",function(){this.set("suggestSwitch",!1),this.set("suggest",!1)},this),this.on("invalidMove",i),this.on("addMoves",i),this.on("endTurn",i),this.on("change:selected",function(e,t){t&&i()},this)},GameClass.prototype.isValidMove=function(e){console.log("isValiedMove")},GameClass.prototype.isRealValidMove=function(e){return e.first.isMovable()&&e.second.isMovable()&&this.isValidMove(e)},GameClass.prototype.makeMove=function(e){console.log("makeMove")},GameClass.prototype.explode=function(){console.log("explode")},GameClass.prototype.existValidMove=function(){console.log("exist valid move")},GameClass.prototype.noExistingMove=function(){console.log("exist valid move")},GameClass.prototype.animate=function(e,t){this._animation++,this.trigger("startAnimation");var i=this;return function(){e&&Game===i&&e.call(t),i._animation--,i.onChangeAnimations()}},GameClass.prototype.endTurnAnimate=function(e,t){this._endTurnAnimation++;var i=this;return function(){e&&Game===i&&e.call(t),i._endTurnAnimation--,i.onChangeAnimations()}},GameClass.prototype.canMove=function(){var e=!0;return void 0!==this.get("moves")&&(e=0<this.get("moves").get()),this.isEndTurn()&&!1===this.get("selectedPowerUp")&&e&&!inChangeProcess},GameClass.prototype.move=function(e){this.isRealValidMove(e)?("move"==this.get("playType")?0<this.get("moves").get()&&(this._moveId++,this.set("moves",new ObscureNumber(this.get("moves"))),this.trigger("beginUserMove"),this.set("amountAfterTurnProcess",0),this.get("moves")==Config.lessMovesAmount&&this.once("afterEndTurn",function(){if(this.get("running")&&!application.windows.anyWindowOpen()&&this.get("moves")==Config.lessMovesAmount){var e=sprintf(messages.lessMovesText,{numMoves:Config.lessMovesAmount});this.trigger("showMessage",e,"lessMovesText")}},this)):this.set("amountAfterTurnProcess",0),this.trigger("validMove",e,Game.animate(function(){this.makeMove(e)},this))):this.trigger("invalidMove",e,Game.animate())},GameClass.prototype.triggerEndTurn=function(){this.trigger("endTurn"),this.trigger("afterEndTurn")},GameClass.prototype.endTurn=function(){this.get("running")&&!this.existValidMove()?this.noExistingMove():this.triggerEndTurn()},GameClass.prototype.runGameTimer=function(){this.set("gameTimer",setInterval(_.bind(function(){this.get("running")&&this.get("fullRunning")&&0<this.get("timeout")&&!application.windows.anyWindowOpen()&&(this.set("timeout",this.get("timeout")-100),this.get("timeout")<=0&&(this.isAnimationRunning()?this.once("endTurn",function(){this.get("running")&&(this.set("running",!1),this.trigger("outOfTime"))},this):(this.set("running",!1),this.trigger("outOfTime"))))},this),100))},GameClass.prototype.stopGameTimer=function(){this.has("gameTimer")&&(clearInterval(this.get("gameTimer")),this.unset("gameTimer"))},GameClass.prototype.prepare=function(){if("bonus"!==application.level.num){var e=application.level.moves;this.set({moves:new ObscureNumber(e),playType:"move"}),this.on("endTurn",function(){canvas.timeManager.setTimeout(_.bind(function(){0===this.get("moves").get()&&this.get("running")&&this.trigger("outOfMoves")},this),0)},this)}else this.set({timeout:1e3*application.level.moves,playType:"time"});this._animation=0,this._moveId=0,this.createField(),this.createFieldBackground(),this.tasks=new Tasks,this.trigger("prepared")},GameClass.prototype.createAfterTurnProcessor=function(){this.afterTurnProcessor=new Processor("amountAfterTurnProcess",[])},GameClass.prototype.createAfterAnimationProcessor=function(){this.afterAnimatonProcess=_.noop},GameClass.prototype.createAfterEveryAnimationProcessor=function(){this.afterEveryAnimatonProcess=_.noop},GameClass.prototype.afterTurnProcess=function(){this.afterTurnProcessor.run()},GameClass.prototype.start=function(){user.set("gameCount",user.get("gameCount")+1||1),application.trigger("gameStart",this),this.trigger("start"),"time"==this.get("playType")&&this.runGameTimer(),this.set("running",!0),this.existValidMove()||this.noExistingMove()},GameClass.prototype.exit=function(){this.set("running",!1),"time"==this.get("playType")&&this.stopGameTimer(),this.trigger("fail")},GameClass.prototype.win=function(){this.set("running",!1),this.listenTo(this,"afterExplode",this.changeColorsCountByMatchExplode),"time"==this.get("playType")&&this.stopGameTimer();var e=episode.get("about").force||[],t=application.level.num;if(e&&e[t]){var i=e[t].find(function(e){return e.powerUpForce}),o=i&&Config.forceCodes[i.powerUpForce];_.isNumber(o)&&user.setShownForces(o)}this.isEndTurn()?this.onBeforeWin():this.once("endTurn",this.onBeforeWin,this)},GameClass.prototype.changeColorsCountByMatchExplode=function(){this.set("matchExplodeCount",1+(this.get("matchExplodeCount")||0)),10<this.get("matchExplodeCount")?(this.setAvailableColorsTo(6),this.stopListening(this,"afterExplode",this.changeColorsCountByMatchExplode)):5<this.get("matchExplodeCount")&&application.level.availableColors.length<5&&this.setAvailableColorsTo(5)},GameClass.prototype.onBeforeWin=function(){this.trigger("beforeWin"),this.isEndTurn()?this.onEndTurn():this.once("endTurn",this.onEndTurn,this)},GameClass.prototype.onBeforeGameFinish=function(){this._isWin=!0;var t=0;this.each(function(e){e.beforeGameFinish()&&t++}),0===t?this.trigger("win"):this.once("endTurn",this.onBeforeGameFinish,this)},GameClass.prototype.onEndTurn=function(){this.onBeforeGameFinish()},GameClass.prototype.inField=function(e,t){return!(e<0||t<0||e>=Config.cols||t>=Config.rows)&&this.field[t][e]},GameClass.prototype.addItem=function(e,t,i,o){void 0===i&&(i=e.y),(this.field[i][e.x]=e).onField=!0,!1!==t&&(e.createDiv(),e.y<0?e.$div.css({opacity:0}):e.$div.css({opacity:1})),o&&this.trigger("addItem",e)},GameClass.prototype.initCellForFallDown=function(e,t){if(0<this.fallDownSpecialCells.length&&this.get("useFallDownSpecialCells")&&Game.get("fullRunning")&&(this.set("useFallDownSpecialCells",!1),this.fallDownSpecialCells[0].offset--,this.fallDownSpecialCells[0].offset<0)){var i=this.fallDownSpecialCells[0].cellClass,o=this.fallDownSpecialCells[0].type,a=this.fallDownSpecialCells[0].afterCreate||_.noop;return this.fallDownSpecialCells.shift(),a(r=new i(e,t,!1,o)),r}var n;this._falldownCount++,application.level.stack&&0<application.level.stack.length?(n=application.level.stack.charAt(0),application.level.stack=application.level.stack.substr(1)):n=application.level.colors.charAt(Math.floor(Math.random()*application.level.colors.length));var r=CellsRegistry.initCell(n,e,t,!1,n);return this.trigger("initCellForFallDown",r,this),this.addAttributeForCell(r),r},GameClass.prototype.addAttributeForCell=function(e){},window.lastFallDownSound=0,GameClass.prototype.fallDown=function(){this.set("useFallDownSpecialCells",!0);for(var e,t=!1,i=0;i<Config.cols;i++){var o=0;for(e=Config.rows-1;0<=e;e--)if(this.field[e][i]&&this.field[e][i].isMovable())for(var a=Config.rows-1;e<a;a--)if(void 0===this.field[a][i]){this.field[a][i]=this.field[e][i],this.field[e][i]=void 0,this.field[a][i].fallDown(a,o),o++;break}var n=-1;for(e=Config.rows-1;0<=e;e--)void 0===this.field[e][i]&&(t=!0,this.addItem(this.initCellForFallDown(n,i),!0,e),this.field[e][i].setY(n),this.field[e][i].fallDown(e,o),o++,n--)}return t},GameClass.prototype.createFieldBackground=function(){for(var e=0;e<Config.rows;e++)for(var t=0;t<Config.cols;t++)if(" "!=application.level.map[e].charAt(t)){var i={left:!1,right:!1,up:!1,down:!1};0!==e&&" "!=application.level.map[e-1].charAt(t)||(i.up=!0),e!==Config.rows-1&&" "!=application.level.map[e+1].charAt(t)||(i.down=!0),0!==t&&" "!=application.level.map[e].charAt(t-1)||(i.left=!0),t!==Config.cols-1&&" "!=application.level.map[e].charAt(t+1)||(i.right=!0),this.trigger("createFieldBackground",e,t,i)}},GameClass.prototype.createField=function(){var e,t;for(this.field=[],e=0;e<Config.rows;e++)for(this.field.push([]),t=0;t<Config.cols;t++)this.field[e].push(null);for(e=0;e<Config.rows;e++)for(t=0;t<Config.cols;t++)" "!=application.level.map[e].charAt(t)&&this.addItem(CellsRegistry.initCell(application.level.map[e].charAt(t),e,t,!0),!1)},GameClass.prototype.getMoveId=function(){return this._moveId};var PowerUp=Backbone.Model.extend({defaults:{id:"",price:0,amount:0,selected:!1},run:function(){++Game.actionId,this.set("runned",!0),this.execute()},initialize:function(){this.on("change:used",function(e,t){!e.isInfinityOnLevel()&&t&&user.usePowerUp(e)})},isInfinityOnLevel:function(){var e=application.level.infinityBoosters;return!!e&&-1!==e.indexOf(this.id)},isAvailable:function(){return!!episode.isForceEpisode()||(episode.absoluteLevelNumber(application.level.num)>=this.get("available")||episode.isBonusWorld())},execute:function(){},select:function select(event){var selected=this.collection.findWhere({selected:!0});if(selected&&selected.unSelect(),this.isAvailable()){if(!this.isInfinityOnLevel()){if(0===this.get("amount")&&window.mobile)return void new BuyPowerUpsWindow({powerUp:this});if(0===this.get("amount")&&Config.shopPowerUps&&Config.shopPowerUps[this.get("id")])return void new ShopPowerUpsWindow({name:this.get("id"),offers:Config.shopPowerUps[this.get("id")].map(function(e){return new Offer(e)})});if(0===this.get("amount")&&user.get("coins").get()<this.get("price"))return void user.buyPowerUp(this)}this.set({selected:!0,used:!1,runned:!1}),Game.set("selectedPowerUp",this),Config.usePowerUpSound&&(this.silent||application.playSound("usePowerUpSound"));var viewClass=eval(this.get("view")),view=new viewClass({model:this,startEvent:event})}},unSelect:function(){this.set({selected:!1,used:!1,runned:!1}),Game.set("selectedPowerUp",!1)}}),PowerUps=Backbone.Collection.extend({model:PowerUp}),LikeWindow=TWindow.extend({templateClass:".likeWindow_template",links:{facebook:"https://www.facebook.com/games/manage"},guides:{facebook:"//gems-ok.akamaized.net/gems/gems/site/img/videoGuides/facebook/facebook.be6d06ad05.gif",vkontakte:"//gems-ok.akamaized.net/gems/gems/site/img/videoGuides/vkontakte/vkontakte.1bcbf76bda.gif",mailru:"//gems-ok.akamaized.net/gems/gems/site/img/videoGuides/mailru/mailru.65fa3269d1.gif",yahoo:"../img/videoGuides/yahoo/yahoo.gif",test:"//gems-ok.akamaized.net/gems/gems/site/img/videoGuides/test/test.a43caac5bc.gif"},events:{"click .close":"close","click .likeWindowBtn":"clickSmall","click .likeWindowBtnBig":"evaluation"},onOpen:function(){var e=this;if("phonegap"==network){var t=this.$(".windowTitle");return $("<div/>").addClass("assessmentImage").insertAfter(t),void $("<div/>").addClass("oneWindowBtn likeWindowBtnBig").text(messages.likeWindowBtn).insertAfter(this.$(".assessmentImage"))}var i=new Image;i.setAttribute("draggable",!1),i.onload=function(){TWindow.prototype.onOpen.call(e)},i.src=this.guides[network];var o=this.$(".videoGuideBorder").empty();_.extend(this.links,Config.linksLikeWindow),this.links[network]&&"phonegap"!=network?($("<a/>").attr("target","_blank").attr("href",this.links[network]).addClass("videoGuideBtn").append(i).appendTo(o),$("<a/>").attr("target","_blank").attr("href",this.links[network]).addClass("oneWindowBtn likeWindowBtn").text(messages.likeWindowBtn).insertAfter(o)):(o.append($(i).addClass("videoGuideBtn")),$("<div/>").addClass("oneWindowBtn likeWindowBtn").text(messages.likeWindowBtn).insertAfter(o))},clickSmall:function(){void 0!==this.options.afterRate&&this.options.afterRate(),this.close()},evaluation:function(){likeMobile(),this.clickSmall()}}),CoinsForAdsBtnView=Backbone.View.extend({el:"#videoBtn",events:{click:"showRewardVideo"},initialize:function(){if(this.$rewardedVideoBtn=this.$el,this.$rewardedVideoBtn&&0===this.$rewardedVideoBtn.length)this.$rewardedVideoBtn=void 0;else{var e=this;e.rewardVideoBtnSetVisibility(),setInterval(function(){e.rewardVideoBtnSetVisibility()},3e3)}},showRewardVideo:function(){var e=this;this.isAvailable()&&Config.rewardAdMsg.showAd(_.once(function(){user.set({coins:new ObscureNumber(user.get("coins")+Number(Config.rewardAdMsg.get("prize"))),actionName:"coins for ad btn",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0}),e.rewardVideoBtnSetVisibility()}),function(){e.rewardVideoBtnSetVisibility()})},rewardVideoBtnSetVisibility:function(){this.$rewardedVideoBtn&&"main"==application.get("page")&&this.$rewardedVideoBtn.toggleClass("visible",this.isAvailable())},isAvailable:function(){return Boolean(Config.rewardAdMsg&&Config.rewardAdMsg.checkAvailable())}}),BaseCoinsWindow=TWindow.extend({templateClass:".addCoinsWindow_template",events:{"click .inviteFriendForBonus":"inviteFriend","click .coinsWindowCoinsBuy":"buyProduct","click .close":"close"},inviteFriend:function(){this.close(),user.inviteBestFriends()},buyProduct:function(e){var t=$(e.currentTarget).attr("data-priceId");this.close(),showBuy(prices[t])},onOpen:function(){this.render(),TWindow.prototype.onOpen.call(this)},fillProductTemplate:function(e,t){t.oldAmount&&e.find(".oldCoinsAmount").html(t.oldAmount),t.sale&&(e.addClass("saleAction"+t.sale),e.find(".sale").text(t.sale)),e.find(".addCoinsAmount").html(Number(t.amount)),e.find(".addCoinsPrice").html(t.desc.price),e.find(".coinsWindowCoinsBuy").attr("data-priceId",t.priceId),e.attr("data-priceId",t.priceId)},getPrices:function(e){var t=[];for(var i in prices){var o=prices[i];o.action===e&&(o.refToProduct&&(i=o.refToProduct,o=prices[i]),!e&&"coins"!==o.type||o.superOffer||(o.amount=new ObscureNumber(o.amount),t.push(_.extend({priceId:i},o))))}return t},render:function(e){this.$(".bonusForInvite").html(Number(bonusForInvite)),this.$(".coinsWindowProducts").empty();var t=this.getPrices(e);0===t.length&&(t=this.getPrices()),_.each(t,function(e,t){var i=this.$(".invisible .addCoinsProduct").clone();i.addClass("addCoinsProduct"+(t+1)),this.fillProductTemplate(i,e),this.$(".coinsWindowProducts").append(i)},this)}}),AddCoinsWindow=BaseCoinsWindow.extend(),BaseCoinsAction=Backbone.Model.extend({checkIsRunningNow:function(){if(!user.get("coinsAction")||1==user.get("level")&&1==user.get("episode"))return!1;if(user.get("coinsAction").start>application.getCurrentServerTime()||user.get("coinsAction").end<application.getCurrentServerTime())return!1;if(user.get("coinsAction").networks)if("phonegap"===network){if(-1===user.get("coinsAction").networks.indexOf(phonegapNetwork))return!1}else if(-1===user.get("coinsAction").networks.indexOf(network))return!1;return!(user.get("coinsAction").episode&&user.get("coinsAction").episode>user.get("episode"))},stop:function(){$("#main .coinsAction").off("click touchend").hide()},openActionWindow:function(){new AddCoinsWindow},runTimer:function(){var i,e=_.bind(function(){var e=user.get("coinsAction").end-application.getCurrentServerTime();if(e<=0)this.stop(),$("#coinsBlock,#container").removeClass("specialOfferOn"),$("#main .coinsAction").removeClass(user.get("coinsAction").type+"CoinsAction"),clearInterval(i);else{var t="";t=e<3600?formatTime("%i:%s",e):formatPeriod(e<86400?Math.round(e/60):60*Math.round(e/60/60)),$(".coinsBlockSpecialOffer .timeout").html(t)}},this);i=setInterval(e,1e3),e()},process:function(){function e(){user.get("coinsAction").type,user.get("coinsAction").start;!getCookie("id")&&2<=user.get("episode")&&(new AddCoinsWindow({firstPriority:!0}),setCookie("id",1,new Date((new Date).getTime()+864e5).toUTCString()))}function t(){return _.any(_.pluck(prices,"price"),function(e){return 0<e})}$("#coinsBlock,#container").addClass("specialOfferOn"),$("#main .coinsAction").addClass(user.get("coinsAction").type+"CoinsAction").show().on("click touchend",this.openActionWindow),this.runTimer(),this.run(),t()?e():setTimeout(function(){t()&&e()},1e3)},initialize:function(){this.checkIsRunningNow()&&this.process()}}),BaseActionCoinsWindow=BaseCoinsWindow.extend({onOpen:function(){var i=user.get("coinsAction");this.render(i.name),TWindow.prototype.onOpen.call(this),i.name&&this.$el.addClass(i.name);var e=_.bind(function(){var e=i.end-application.getCurrentServerTime();if(e<=0?(clearInterval(this.updateCoinsActionInterval),delete this.updateCoinsActionInterval,this.close()):this.$(".payActionTimer").html(formatPeriod(Math.round(e/60))),"odnoklassniki"===network){var t=FAPI.Util.getRequestParameters();t&&t.payment_promo_active&&this.$el.addClass("doubleAction")}},this);this.updateCoinsActionInterval=setInterval(e,1e3),e()},onClose:function(){this.updateCoinsActionInterval&&clearInterval(this.updateCoinsActionInterval),BaseCoinsWindow.prototype.onClose.apply(this,arguments)}});Application.on("ready",function(){var e=user.get("coinsAction");if(e&&"okonly"==e.name){if("test"==network)return;if("odnoklassniki"==network&&FAPI.Util){var t=FAPI.Util.getRequestParameters();t&&t.payment_promo_active||user.unset("coinsAction")}else user.unset("coinsAction")}});var InfoAction=BaseCoinsAction.extend({checkIsRunningNow:function(){return!(!BaseCoinsAction.prototype.checkIsRunningNow.call(this)||"info"!=user.get("coinsAction").type)},stop:function(){AddCoinsWindow=this.previousAddCoinsWindow},run:function(){this.previousAddCoinsWindow=AddCoinsWindow,AddCoinsWindow=InfoActionCoinsWindow}}),InfoActionCoinsWindow=BaseActionCoinsWindow.extend({templateClass:".infoActionCoinsWindow_template",getPrices:function(){var e=[];for(var t in prices){var i=prices[t];"coins"!==i.type||i.superOffer||i.action||e.push(_.extend({priceId:t},i))}return e}});Application.on("ready",function(){new InfoAction});var GiftAction=BaseCoinsAction.extend({checkIsRunningNow:function(){return!(!BaseCoinsAction.prototype.checkIsRunningNow.call(this)||"gift"!=user.get("coinsAction").type)},stop:function(){user.off("buyProduct",this.onProductBuy,this),AddCoinsWindow=this.previousAddCoinsWindow},run:function(){user.on("buyProduct",this.onProductBuy,this),this.previousAddCoinsWindow=AddCoinsWindow,AddCoinsWindow=GiftActionCoinsWindow},onProductBuy:function(e){if("coins"===e.type){var t=user.get("coinsAction").prizes;for(var i in prices)if(e===prices[i]&&t[i]){var o=t[i];switch(o.type){case"powerUp":user.setPowerUpAmount(o.name,user.getPowerUpAmount(o.name)+(o.amount||1));break;case"good":goods.goodBuyed(o.name,o.workHours,!0);break;case"coins":user.set({coins:new ObscureNumber(user.get("coins")+o.amount)})}}}}}),GiftActionCoinsWindow=BaseActionCoinsWindow.extend({templateClass:".giftActionCoinsWindow_template",render:function(){BaseCoinsWindow.prototype.render.apply(this,arguments);var e=user.get("coinsAction").prizes,t=user.get("coinsAction").name;if(e){var i=user.get("coinsAction"),o=function(e,t){var i="addCoinsGiftText"+t;return network===e?messages[i]:"phonegap"===network&&phonegapNetwork===e?messages[i]:void 0},a=o("odnoklassniki","OK")||o("vkontakte","VK")||o("mailru","ML")||o("facebook","FB")||messages["addCoinsGiftText_"+t]||messages.addCoinsGiftText;for(var n in"odnoklassniki"==network&&i&&i.start2&&i.end2&&messages.addCoinsGiftTextOK2&&i.start2<application.getCurrentServerTime()&&i.end2>application.getCurrentServerTime()&&(a=messages.addCoinsGiftTextOK2),a!==messages.addCoinsGiftText&&this.$(".addCoinsGiftText .text").html(a),e){var r,s=e[n];switch(s.type){case"good":(r=this.$(".invisible ."+s.name+"Gift").clone()).find(".time").html(formatPeriod(60*s.workHours,!0));break;case"powerUp":(r=this.$(".invisible ."+s.name+"Gift").clone()).find(".amount").text(s.amount);break;case"coins":(r=this.$(".invisible .coinsGift").clone()).find(".amount").text(s.amount)}r&&this.$('.addCoinsProduct[data-priceId="'+n+'"] .productGifts').append(r)}}}});Application.on("ready",function(){new GiftAction});var MoreCoinsAction=BaseCoinsAction.extend({checkIsRunningNow:function(){return!(!BaseCoinsAction.prototype.checkIsRunningNow.call(this)||"morecoins"!=user.get("coinsAction").type)},stop:function(){user.off("buyProduct",this.onProductBuy,this),AddCoinsWindow=this.previousAddCoinsWindow},run:function(){user.on("buyProduct",this.onProductBuy,this),this.previousAddCoinsWindow=AddCoinsWindow,AddCoinsWindow=MoreCoinsActionWindow},onProductBuy:function(e){if("coins"===e.type){var t=user.get("coinsAction"),i=Math.round(e.amount*t.addCoinsPct/100);user.set({coins:new ObscureNumber(user.get("coins")+i)})}}}),MoreCoinsActionWindow=BaseActionCoinsWindow.extend({templateClass:".moreCoinsActionWindow_template",render:function(){BaseCoinsWindow.prototype.render.apply(this,arguments);var t=user.get("coinsAction");this.$el.find(".coinsWindowProducts .addCoinsProduct").each(function(){var e=$(this).data("priceid");prices[e]&&$(this).find(".addCoinsPriceAdd").html(prices[e].amount*t.addCoinsPct/100)})}});Application.on("ready",function(){new MoreCoinsAction});var PrizeCoinsAction=BaseCoinsAction.extend({checkIsRunningNow:function(){return!(!BaseCoinsAction.prototype.checkIsRunningNow.call(this)||"prizecoins"!=user.get("coinsAction").type)},stop:function(){user.off("buyProduct",this.onProductBuy,this),AddCoinsWindow=this.previousAddCoinsWindow},run:function(){user.on("buyProduct",this.onProductBuy,this),this.previousAddCoinsWindow=AddCoinsWindow,AddCoinsWindow=PrizeCoinsActionWindow},onProductBuy:function(e){e.amount>=user.get("coinsAction").minCoins&&new SelectPrizeCoinsActionWindow({collection:user.get("coinsAction").prizes})}}),SelectPrizeCoinsActionWindow=TWindow.extend({templateClass:".selectPrizeCoinsActionWindow_template",events:{"click .close":"close","click .actionSelect":"select","click .actionPickUp":"pickUp","click .needPublicCheckbox":"needPublicCheckbox"},needPublic:!1,needPublicCheckbox:function(e){$(e.currentTarget).toggleClass("checkboxOn")},onOpen:function(){this.$el.addClass("step1"),this.needPublic||this.$(".needPublicBlock").hide()},pickUp:function(){this.needPublic&&this.$(".needPublicCheckbox").hasClass("checkboxOn")&&user.defaultPublication("prizeCoinsActionPublication"),this.close()},select:function(e){this.$el.removeClass("step1").addClass("step2").addClass($(e.currentTarget).data("type")+"Type");this.$(".invisible .prize");var t=RANDOM(this.collection);t.cls&&this.$el.addClass(t.cls),this.prize=new UserPrizes(t.products),new UserPrizesView({model:this.prize,el:this.$(".prizes")}),removeLocalStorage("boughtRandomAction"),new AnimatedPrizesWindow({prizes:this.prize,notGive:!0}),this.prize.take("randomGiftAction",void 0,void 0,void 0,!0)}}),PrizeCoinsActionWindow=BaseActionCoinsWindow.extend({templateClass:".prizeCoinsActionWindow_template",events:_.extend({"click .openInfoWindow":"openInfoWindow"},BaseActionCoinsWindow.prototype.events),openInfoWindow:function(){this.close(),new PrizeCoinsActionInfoWindow}}),PrizeCoinsActionInfoWindow=TWindow.extend({templateClass:".prizeCoinsActionInfoWindow_template",events:{"click .close":"close"},onOpen:function(){this.render()},render:function(){var e=user.get("coinsAction").prizes,t=this.$(".prizes"),i=this.$(".invisible .addCoinsPrize"),n=this.$(".invisible .addCoinsPrizeItem");_.each(e,function(e){var o=i.clone(),a=o.find(".variants");_.each(e.items,function(e){var t=n.clone(),i="good"==e.type?e.workHours/24+messages.timeShort[2]:e.amount;t.find(".count").html(i),t.addClass(e.name),t.appendTo(a),o.addClass(e.name)}),o.appendTo(t)})},onClose:function(){new PrizeCoinsActionWindow}});Application.on("ready",function(){new PrizeCoinsAction});var X2ActionCoinsWindow=BaseActionCoinsWindow.extend({templateClass:".X2ActionCoinsWindow_template",render:function(){user.unset("x2ActionDisabled"),BaseCoinsWindow.prototype.render.apply(this,arguments)},switchWindow:function(){this.close(),user.set("x2ActionDisabled",!0),new BaseCoinsWindow({firstPriority:!0})}});X2ActionCoinsWindow.prototype.events["click .otherActions"]="switchWindow";var BoringWindow=TWindow.extend({templateClass:".boringWindowNoFriends_template",events:{"click .close":"close","click .oneWindowBtn":"close"}},{process:function(){var e=0;setInterval(function(){Config.boringWindowPages&&Config.boringWindowPages.indexOf(application.get("page"))<0?e=0:application.windows.anyWindowOpen()?e=0:120<++e&&"game"===application.get("page")&&new BoringWindow},1e3),$(document).on("mousemove touchmove mousedown touchstart mouseup touchend",function(){e=0})}}),ConnectionLostWindow=TWindow.extend({templateClass:".connectionLost_template",events:{"click #connectionLostRefresh":"refresh","click #connectionLostClose":"close"},onOpenSound:"losegame",onOpen:function(){var e=this.options.error&&_.isString(this.options.error)?this.options.error:"default",t=messages.connectionLostTitle[e]||messages.connectionLostTitle.default,i=messages.connectionLostText[e]||messages.connectionLostText.default;this.$(".connectionLostTitle").html(t),this.$(".connectionLostText").html(i),this.options.close?(this.$("#connectionLostRefresh").hide(),this.$("#connectionLostClose").show()):(this.$("#connectionLostRefresh").show(),this.$("#connectionLostClose").hide()),this.$el.addClass("error_"+e.replace(" ","_")),TWindow.prototype.onOpen.call(this)},initialize:function(e){this.options=e||{},ConnectionLostWindow.allreadyOpened||(ConnectionLostWindow.allreadyOpened=!0,application.windows.closeAll(),this.closed=this.shown=!1,this.once("open",this.open,this),application.windows.add(this,this.options))},refresh:function(){location.reload()}}),FriendsStillNotPlay=TWindow.extend({templateClass:".friendsstillnotplay_template",events:{"click .close":"close","click #intiveMissingFriends":"inviteFriends"},initialize:function(){this.notInAppIds=allUsers.getBestForInvite(),3<=this.notInAppIds.length&&TWindow.prototype.initialize.apply(this,arguments),setCookie("notInvite",1,new Date((new Date).getTime()+6048e5).toUTCString())},onOpen:function(){this.render(),TWindow.prototype.onOpen.call(this)},inviteFriends:function(){this.close(),socialNetwork.invite(this.notInAppIds)},render:function(){this.$(".addFriendBonus").html(Number(bonusForInvite)),this.$("#missingFriendsBlock").empty();for(var e=0;e<3&&e<this.notInAppIds.length;e++){var t=$($("#missingFriendCardTpl").html()),i=this.notInAppIds[e];t.find(".missingFriendName").text(users[i].first_name),t.find(".missingFriendPhoto").html(socialNetwork.makePhotoById(i,Config.basePhotoSize)),t.appendTo(this.$("#missingFriendsBlock"))}}}),GetCoinsForInviteWindow=TWindow.extend({templateClass:".getCoinsForInviteWindow_template",events:{"click .close":"close","click #intiveFriendsForCoins":"inviteFriends"},initialize:function(){this.notInAppIds=allUsers.getBestForInvite(),this.friendsInvited=!1,3<=this.notInAppIds.length&&("odnoklassniki"==network||"mailru"==network||"test"==network)&&TWindow.prototype.initialize.apply(this,arguments)},onClose:function(){var t=0;this.friendsInvited&&(t=Number(Config.coinsForInvite)),callService("../../../levelbase/src/services/getcoinsforinvite.php",function(e){"ok"==e&&0<t&&user.set({coins:new ObscureNumber(user.get("coins")+t)},{notSave:!0})},function(){},{coins:t})},onOpen:function(){this.render(),TWindow.prototype.onOpen.call(this)},inviteFriends:function(){socialNetwork.invite(this.notInAppIds,_.bind(function(e){0<e.length&&(this.friendsInvited=!0,this.close())},this))},render:function(){this.$(".coinsForInviteBonus").html(Number(Config.coinsForInvite)),this.$("#freeCoinsFriendsBlock").empty();for(var e=0;e<3&&e<this.notInAppIds.length;e++){var t=$(".invisible .coinsForInviteFriend").clone();t.find(".name").text(users[this.notInAppIds[e]].first_name),t.find(".photo").html(socialNetwork.makePhotoById(this.notInAppIds[e],Config.basePhotoSize)),this.$("#freeCoinsFriendsBlock").append(t)}}});Application.on("ready",function(){Config.coinsForInvite=new ObscureNumber(Config.coinsForInvite)});var PublicationForBonusWindow=TWindow.extend({templateClass:".publicationforbonuswindow_template",events:{"click .close":"close","click #publishForBonus":"publish"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$(".publishForBonusAmount").text(Number(publicationBonus))},onClose:function(){setCookie("notPublish",1,new Date((new Date).getTime()+2592e5).toUTCString())},publish:function(){this.close(),user.defaultPublication("bonusPublication",function(){user.set("coins",new ObscureNumber(user.get("coins")+Number(publicationBonus)),{notSave:!0}),callService("../../../levelbase/src/services/addpublicationbonus.php",function(){},function(){})})}}),StripWindow=TWindow.extend({events:{"click .close":"close","click .getStripRevard":"getRevard"},getRevard:function(){this.options.model.getRevard()&&this.close()},onOpen:function(){var e=this.options.model;e.each(function(e){new StripModelItemView({el:this.$(".bonusOption."+e.get("id")),item:e})},this),e.on("change:checked",this.renderProgress,this),this.renderProgress(),e.once("complete",this.renderComplete,this),this.renderComplete(),this.$(".stripAmount").html(Number(Config.stripBonus[user.get("strip")])),TWindow.prototype.onOpen.call(this)},renderProgress:function(){var e=this.options.model,t=e.where({checked:!0}).length;this.$(".stripCheckedAmount").html(t),this.$(".stripProgres").css("width",100*t/e.length+"%")},onClose:function(){this.options.model.off(null,null,this),this.options.strip.calcActive()},renderComplete:function(){this.options.model.isCompleted()?(this.$(".getStripRevard").removeClass("disabled"),this.$el.addClass("completed")):(this.$(".getStripRevard").addClass("disabled"),this.$el.removeClass("completed"))}});Application.on("ready",function(){for(var e=0;e<Config.stripBonus.length;e++)Config.stripBonus[e]=new ObscureNumber(Config.stripBonus[e])});var Strip3Window=TWindow.extend({templateClass:".stripWindow3_template",onOpen:function(){for(var e in window.closeStrip3=_.bind(function(){this.close()},this),this.$(".mobilePromoPrize").html(Config.mobilePromo.prize),Config.mobilePromo.links){var t='<a href="'+Config.mobilePromo.links[e]+'" target="_blank" onclick="window.closeStrip3();">'+messages.mobilePromo[e]+"</a>";this.$("."+e+"Promo").removeClass("comingSoon").html(t)}TWindow.prototype.onOpen.call(this)},onClose:function(){this.options.strip.calcActive()}}),SuperOfferWindow=TWindow.extend({templateClass:".superOfferWindow_template",initialize:function(){SuperOfferWindow.getSuperOfferProduct()&&TWindow.prototype.initialize.apply(this,arguments)},events:{"click .superOfferBuy":"buy","click .superOfferClose":"close"},buy:function(){this.close(),showBuy(SuperOfferWindow.getSuperOfferProduct())},onOpen:function(){var e=SuperOfferWindow.getSuperOfferProduct();this.$(".superOfferAmount").html(e.amount),this.$(".superOfferPrice").html(e.desc.price),TWindow.prototype.onOpen.call(this)},onClose:function(){setCookie("superoffer",1,new Date((new Date).getTime()+432e6).toUTCString())}},{getSuperOfferProduct:function(){for(var e in prices)if(prices[e].superOffer)return prices[e]}}),BaseEndlessTreasureWindow=TWindow.extend({events:_.defaults({"click .buyButton":"buy","touchend .buyButton":"buy"},TWindow.prototype.events),initialize:function(e){this.items=new Backbone.Collection,this.index=this.model.getStage(),this._process=!1;for(var t=0;t<this.screens*this.itemsToShow;++t)this.addItem();this.items.on("add",this.onAdd,this),this.items.on("remove",this.onRemove,this),this.items.on("change:active",this.onChangeActive,this),TWindow.prototype.initialize.call(this,e)},onRemove:function(e){},onAdd:function(e){},onOpen:function(){var e=this;TWindow.prototype.onOpen.call(this),this.$(".title").html(messages.endlessTreasuresWindow.title),this.updateTimer(),this.timer=setInterval(function(){return e.updateTimer()},1e3)},onClose:function(){TWindow.prototype.onClose.call(this),clearInterval(this.timer)},buy:function(e){var t=this,i=$(e.currentTarget),o=i.data("itemStage"),a=this.items.findWhere({itemStage:o});if(a&&!this._process)return a.get("active")?(this._process=!0,this.model.buy(a.get("offer")).then(function(){return t.animateGivePrize(a)}).then(function(){return t.animateChestOpen()}).then(function(){return t.animateBeforeRemove(a)}).then(function(){t._process=!1,t.items.remove(a),t.addItem(),t.updateChests()}).catch(function(e){t._process=!1})):void this.animateTip(i)},updateChests:function(){var t=this;this.items.forEach(function(e){return e.set("active",e.get("itemStage")===t.model.getStage())})},addItem:function(){var e=this.model.getFinalStage(),t=0<=this.index%e?this.index%e:this.index,i=this.model.getOffers().at(t);this.items.add({active:this.index===this.model.getStage(),offer:i,itemStage:t}),++this.index,this.index>=this.model.getFinalStage()&&(this.index=0)},onChangeActive:function(e){this.$(".offer"+e.get("itemStage")).toggleClass("active",e.get("active"))},updateTimer:function(){this.$("#timer").html(formatPeriod(Math.round(this.model.getTimer()/60)))},animateChestOpen:function(){var e=this.items.at(0),t=this.$(".offer"+e.get("itemStage"));return new Promise(function(e){t.addClass("animateOpen"),setTimeout(function(){t.removeClass("animateOpen"),t.addClass("opened"),e()},100)})},animateBeforeRemove:function(e){},animateGivePrize:function(i){var o=this;return new Promise(function(e){var t=!(i.get("offer")instanceof Prize);o.$el.addClass("chestAnimation"),t&&o.$el.addClass("animationPaid"),new UserPrizesView({el:o.$(".rewardSubwindow .mPrizes"),model:i.get("offer").getUserPrizes()}),setTimeout(function(){o.$el.removeClass("chestAnimation"),t&&o.$el.removeClass("animationPaid"),e()},2e3)})},animateTip:function(e){e.addClass("animateTip"),setTimeout(function(){e.removeClass("animateTip")},1e3)}}),EndlessTreasureWindow=BaseEndlessTreasureWindow.extend({templateClass:".endlessTreasureWindow_template",itemsToShow:3,screens:2,onOpen:function(){BaseEndlessTreasureWindow.prototype.onOpen.call(this),this.renderBg(),this.renderChests(),this.updateChests(),this.updateBackground()},renderBg:function(){for(var e=this.$(".invisible .background").clone(),t=this.$(".backgroundContainer"),i=1;i<=this.screens;++i){var o=e.clone(),a="background"+(i%2==0?"Even":"Odd");o.addClass(a),o.addClass("background"+i),o.appendTo(t)}},renderChests:function(){var t=this;this.items.forEach(function(e){return t.createChest(e)})},createChest:function(e){var t=this.$(".invisible .chestWrapper").clone(),i=e.get("itemStage"),o=!(e.get("offer")instanceof Prize),a=this.getTargetScreenNum(i),n=o?e.get("offer").getDisplayPrice():messages.endlessTreasuresWindow.button;new UserPrizesView({el:t.find(".mPrizes"),model:e.get("offer").getUserPrizes()}),t.addClass("chest"+(i+1)+"Wrapper"),t.toggleClass("paid",o),t.addClass("offer"+i),t.find(".chest").addClass("chest"+(i+1)),t.find(".buyButton").data("itemStage",i),t.find(".buyButton .mText").html(n),t.toggleClass("active",e.get("active")),t.find(".tipText").html(messages.endlessTreasuresWindow.text),t.appendTo(this.$(".background"+a+" .middleRow"))},updateBackground:function(){var e=this.items.at(0),t=this.getTargetScreenNum(e.get("itemStage")),i=this.$(".backgroundContainer"),o=t+1>this.screens?(t+1)%this.screens:t+1,a=this.$(".background"+t),n=this.$(".background"+o),r=-760*(e.get("itemStage")/this.itemsToShow%this.screens%1).toFixed(2);a.css("left",r+"px"),n.detach(),n.appendTo(i),n.css("left",r+"px")},onAdd:function(e){BaseEndlessTreasureWindow.prototype.onAdd.call(this,e),this.createChest(e)},onRemove:function(e){BaseEndlessTreasureWindow.prototype.onRemove.call(this,e);var t=this.$(".offer"+e.get("itemStage"));0<t.length&&t.remove()},getTargetScreenNum:function(e){return Math.floor(e/this.itemsToShow)%this.screens+1},animateBeforeRemove:function(e){var t=this.items.at(this.items.indexOf(e)+1),i=this.getTargetScreenNum(t.get("itemStage")),o=i+1>this.screens?(i+1)%this.screens:i+1,a=this.$(".background"+i),n=this.$(".background"+o),r=this.$(".backgroundContainer"),s=t.get("itemStage")/this.itemsToShow%this.screens;1<s&&(s=t.get("itemStage")/this.itemsToShow%this.screens%1),0===s&&(s=1);var l=-760*s.toFixed(2);return new Promise(function(e){a.animate({left:l},450,"linear",function(){}),n.animate({left:l},450,"linear",e)}).then(function(){n.position().left<-750&&(n.detach(),n.appendTo(r),n.css("left","0px"),a.css("left","0px"))})}}),EndlessTreasureChainedWindow=BaseEndlessTreasureWindow.extend({templateClass:".endlessTreasureChainedWindow_template",itemsToShow:6,screens:1,onOpen:function(){BaseEndlessTreasureWindow.prototype.onOpen.call(this),this.renderItems()},onAdd:function(e){BaseEndlessTreasureWindow.prototype.onAdd.call(this,e),this.createItem(e)},onRemove:function(e){var t=this;BaseEndlessTreasureWindow.prototype.onRemove.call(this,e);var i=this.$(".offer"+e.get("itemStage"));0<i.length&&i.remove(),this.$el.addClass("animateSlide"),setTimeout(function(){t.$el.removeClass("animateSlide")},1500)},renderItems:function(){var t=this;this.items.forEach(function(e){return t.createItem(e)})},createItem:function(e){var t=this.$(".invisible .itemWrapper").clone(),i=e.get("itemStage"),o=!(e.get("offer")instanceof Prize),a=o?e.get("offer").getDisplayPrice():messages.endlessTreasuresWindow.button,n=3<e.get("offer").getUserPrizes().length;new UserPrizesView({el:t.find(".mPrizes"),model:e.get("offer").getUserPrizes()}),t.toggleClass("paid",o),t.toggleClass("offer"+i),t.toggleClass("active",e.get("active")),t.find(".buyButton").data("itemStage",i),t.find(".buyButton .mText").html(a),t.find(".tipText").html(messages.endlessTreasuresWindow.text),t.toggleClass("displayChest",n),t.appendTo(this.$(".background"))}}),FlashRequiredWindow=TWindow.extend({templateClass:".flashRequiredWindow_template"}),BaseForceView=TWindow.extend({initialize:function(e){this.options=e||{};var t=(!application.get("forceOpenNow")||this.options.ignoreForceOpenNow||this.model&&this.model.get("ignoreForceOpenNow"))&&this.$el.length&&this.$el.is(":visible");if(this.options.buttonEl){var i={};i["click "+this.options.buttonEl]="close",i["touchend "+this.options.buttonEl]="close",this.delegateEvents(i)}else this.delegateEvents({click:"close",touchend:"close"});t?(application.set("forceOpenNow",!0),TWindow.prototype.initialize.apply(this,arguments)):setTimeout(_.bind(function(){this.stopListening(),this.undelegateEvents()},this),0),this.listenTo(this.model,"close",this.close),this.options.blockTargetBeforeShow&&this.$el.css("pointer-events","none")},open:function(){if(application.get("page")!==this.options.needPage)return application.windows.remove(),this.stopListening(),void this.undelegateEvents();this.shown=!0,$("#container").addClass("force");var e=parseInt($(".wrapper").css("width")),t=parseInt($(".wrapper").css("height")),i=parseInt(this.$el.css("width")),o=parseInt(this.$el.css("height"));this.model&&(this.model.get("additionalWidth")&&(i+=this.model.get("additionalWidth")),this.model.get("additionalHeight")&&(o+=this.model.get("additionalHeight")));var a=this.$el.offset(),n=$(".blockedAnimations").offset();a.left=Math.round(a.left),a.top=Math.round(a.top),n.left=Math.round(n.left),n.top=Math.round(n.top),a.top-=n.top,a.left-=n.left;var r,s,l='<div class="fieldDisabledBaseForce"><div class="fieldDisabledContent"></div></div>',d=$(l);if(d.attr("data-direction","top"),d.css({width:e+"px",height:a.top+"px",left:"0px",top:"0px"}),$(".blockedAnimations").append(d),(d=$(l)).attr("data-direction","bottom"),d.css({width:e+"px",height:t-a.top-o+"px",left:"0px",top:a.top+o+"px"}),$(".blockedAnimations").append(d),(d=$(l)).attr("data-direction","left"),d.css({width:a.left+"px",height:o+"px",left:"0px",top:a.top+"px"}),$(".blockedAnimations").append(d),(d=$(l)).attr("data-direction","right"),d.css({width:e-a.left-i+"px",height:o+"px",left:a.left+i+"px",top:a.top+"px"}),window.mobile&&d.css("position","absolute"),$(".blockedAnimations").append(d),this.model?(r=this.model.get("name"),s=this.model.get("textId")?this.model.get("textId"):this.model.get("name")):(r=this.options.name,s=this.options.name),!this.model||!this.model.get("notNeedDisabledBg")){d=$(l);var c=this.$el.position();d.css({width:i+"px",height:o+"px",left:parseInt(c.left)+"px",top:parseInt(c.top)+"px","z-index":0}),d.addClass(r+"Button"),this.model&&this.model.get("addZIndex")&&(this.currentZIndex=this.$el.css("z-index"),this.$el.css("z-index",30),d.css("z-index",30)),window.mobile&&(d.css("position","absolute"),this.$el.css("margin-left")&&d.css("margin-left",this.$el.css("margin-left")),this.$el.css("left").indexOf("%")&&d.css("left",this.$el.css("left")),this.$el.css("bottom")&&d.css("bottom",this.$el.css("bottom"))),this.$el.before(d)}this.model&&this.model.get("addCssClass")&&this.$el.addClass(this.model.get("addCssClass")),this.options.addCssClass&&this.$el.addClass(this.options.addCssClass),$("#force").removeClass().addClass(r),$("#container .wrapper").addClass(r);var g=messages.ForceTexts[s];$("#force .forceText").html($("<div class='text'>").html(g)),$(".fieldDisabledBaseForce").fadeIn(300),setTimeout(_.bind(function(){$(".levelAnimation").hide(),$("#force").show(),this.options.blockTargetBeforeShow&&this.$el.css("pointer-events","auto"),void 0!==BaseForceWithButtonView&&this instanceof BaseForceWithButtonView||((d=$('<div class="fieldDisabledArrow"><div class="fieldDisabledArrowContent"></div></div>')).addClass(r+"Arrow"),d.css({left:a.left+Math.floor(i/2)+"px",top:a.top+"px"}),$(".blockedAnimations").append(d),this.model.onAfterOpen&&this.model.onAfterOpen())},this),300)},clearForceElements:function(){$(".fieldDisabledArrow").remove(),$(".fieldDisabledBaseForce").remove(),$("#force").hide(),$(".levelAnimation").show(),$("#container").removeClass("force"),this.options.blockTargetBeforeShow&&this.$el.css("pointer-events","auto")},close:function(){this.model.canClose&&!this.model.canClose()||($(".fieldDisabledArrow").remove(),$(".fieldDisabledBaseForce").fadeOut(300),$("#force").hide(),$(".levelAnimation").show(),$("#container").removeClass("force"),this.options.blockTargetBeforeShow&&this.$el.css("pointer-events","none"),setTimeout(_.bind(function(){this.clearForceElements(),application.windows.remove(),this.onClose(),this.stopListening(),this.undelegateEvents(),this.model&&(this.model.done(),this.model.get("addZIndex")&&this.$el.css("z-index",this.currentZIndex),this.model.get("addCssClass")&&this.$el.removeClass(this.model.get("addCssClass"))),this.options.addCssClass&&this.$el.removeClass(this.options.addCssClass),$("#container .wrapper").removeClass(this.model.get("name")),application.set("forceOpenNow",!1)},this),300))}}),BonusWorldForceView=BaseForceView.extend({open:function(){BaseForceView.prototype.open.call(this),$("#force").addClass("bonusWorldForce")}}),NewBaseForceView=TWindow.extend({getMessage:function(){return this.model?messages.ForceTexts[this.model.get("name")]:messages.ForceTexts[this.name]},events:{click:"close"},getDisabledCss:function(){return{width:this.getWrapperWidth()+"px",height:this.getWrapperHeight()+"px",left:"0px",top:"0px"}},initialize:function(e){if(this.name=e.name,this.needPage=e.needPage,e.ignoreForceOpenNow)return application.set("forceOpenNow",!0),void TWindow.prototype.initialize.apply(this,arguments);!application.get("forceOpenNow")&&this.$el.length&&this.$el.is(":visible")?(application.set("forceOpenNow",!0),TWindow.prototype.initialize.apply(this,arguments)):setTimeout(_.bind(function(){this.stopListening(),this.undelegateEvents()},this),0)},getTemplate:function(){return'<div class="fieldDisabledBaseForce"><div class="fieldDisabledContent"></div></div>'},getWrapperWidth:function(){return parseInt($(".wrapper").css("width"))},getWrapperHeight:function(){return parseInt($(".wrapper").css("height"))},blockDiv:function(){var e=this.model?this.model.get("name"):this.name,t=$(".blockedAnimations").offset(),i=this.$el,o=parseInt(i.css("width")),a=i.offset();a.top-=t.top,a.left-=t.left;var n=$(this.getTemplate());n.css(this.getDisabledCss()),n.css("z-index",14),this.currentZIndex=this.$el.css("z-index"),this.$el.css("z-index",15).addClass("inNewBaseForce"),this.model&&this.model.get("visibleElements")&&(this.elemntsZIndexes={},_.each(this.model.get("visibleElements"),_.bind(function(e){this.elemntsZIndexes[e]=$(e).css("z-index"),$(e).on("click.inForce",function(){return!1}),$(e).css("z-index",15)},this))),this.$el.first().before(n),$("#force").removeClass().addClass(e),$("#force .forceText").html(this.getMessage(e)),$(".fieldDisabledBaseForce").fadeIn(300),setTimeout(_.bind(function(){$("#force").show(),void 0!==NewBaseForceWithButtonView&&this instanceof NewBaseForceWithButtonView||((n=$('<div class="fieldDisabledArrow"><div class="fieldDisabledArrowContent"></div></div>')).addClass(e+"DisabledArrow"),n.css({left:a.left+Math.floor(o/2)+"px",top:a.top+"px"}),$(".blockedAnimations").append(n))},this),300)},close:function(){if($(".fieldDisabledArrow").remove(),$(".fieldDisabledBaseForce").fadeOut(300),$("#force").hide(),setTimeout(_.bind(function(){this.$el.css("z-index",this.currentZIndex),this.$el.css("pointer-events","auto"),this.model&&this.model.get("visibleElements")&&_.each(this.model.get("visibleElements"),_.bind(function(e){$(e).css("z-index",this.elemntsZIndexes[e]),$(e).off(".inForce")},this));this.$el.removeClass("inNewBaseForce"),$(".fieldDisabledBaseForce").remove(),application.set("forceOpenNow",!1),this.stopListening(),this.undelegateEvents(),this.model&&this.model.done();this.onClose(),application.windows.remove()},this),300),this.$el.css("pointer-events","none"),this.model&&this.model.get("onClick"))return this.model.get("onClick").call(this.model),!1},open:function(){if(application.get("page")!==this.needPage)return this.onClose(),application.windows.remove(),this.stopListening(),void this.undelegateEvents();this.shown=!0,this.blockDiv()}});NewBaseForceView.prototype.getDisabledCss=function(){return{width:this.getWrapperWidth()+"px",height:this.getWrapperHeight()-110+"px",left:"0px",top:"110px"}};var NewBaseForceViewBlockDiv=NewBaseForceView.prototype.blockDiv;NewBaseForceView.prototype.blockDiv=function(){var e=$(this.getTemplate());e.css({width:this.getWrapperWidth()+"px",height:"110px",left:"0px",top:"0px"}),$(".blockedAnimations").append(e),NewBaseForceViewBlockDiv.call(this)};var BaseForceWithButtonView=BaseForceView.extend({events:{},initialize:function(e){e.customizeView&&(this.customizeView=e.customizeView),this.keydown=_.bind(this.keydown,this),this.closeForce=_.bind(this.closeForce,this),BaseForceView.prototype.initialize.apply(this,arguments)},open:function(){BaseForceView.prototype.open.call(this),this.$button=$('<div class="forceButton"></div>'),this.$button.html(messages.ForceButtonTexts[this.model.get("name")]),this.$button.on("click touchend",this.closeForce),$("body").on("keydown",this.keydown),$("#force .forceText").append(this.$button),this.customizeView&&this.customizeView(this)},keydown:function(e){27===e.keyCode&&this.closeForce()},closeForce:function(){return this.$button&&(this.$button.off(),$("body").off("keydown",this.keydown),this.close()),!1}}),NewBaseForceWithButtonView=NewBaseForceView.extend({events:{},initialize:function(e){e.customizeView&&(this.customizeView=e.customizeView),this.keydown=_.bind(this.keydown,this),this.closeForce=_.bind(this.closeForce,this),NewBaseForceView.prototype.initialize.apply(this,arguments)},open:function(){NewBaseForceView.prototype.open.call(this),this.$button=$('<div class="forceButton"></div>'),this.$button.html(messages.ForceButtonTexts[this.model.get("name")]),this.$button.on("click touchend",this.closeForce),$("body").on("keydown",this.keydown),$("#force .forceText").append(this.$button),this.customizeView&&this.customizeView(this)},keydown:function(e){27===e.keyCode&&this.closeForce()},closeForce:function(){return this.$button&&(this.$button.off(),$("body").off("keydown",this.keydown),this.close()),!1}}),BaseForce=Backbone.Model.extend({defaults:{id:!1,view:!1,needPage:"main",name:!1},done:function(){user.set("shownForces",user.get("shownForces")|1<<this.id),application.trigger("shownForces",this)},onOpen:function(){},process:function(){setTimeout(_.bind(function(){var e=this.get("view"),t=this.getEl();if(t.length){this.onOpen();var i={el:t,model:this,highlightedElements:this.getHighlightedElements(),needPage:this.get("needPage"),blockTargetBeforeShow:this.get("blockTargetBeforeShow")||!1};this.afterCreateViewOption(i),new e(i)}},this),50)},afterCreateViewOption:function(e){},needShow:function(){return!(user.get("shownForces")&1<<this.id)},canClose:function(){return!0},initialize:function(){this.needShow()&&(this.on("event",function(){this.off(),application.get("page")==this.get("needPage")?this.process():application.once(this.get("needPage"),this.process,this)},this),this.eventFunction())},getHighlightedElements:function(){return[]}}),ShopForce=BaseForce.extend({defaults:{id:0,view:BaseForceView,needPage:"main",name:"shopForce",addCssClass:"inForce"},getEl:function(){return $(".shop")},eventFunction:function(){user.on("change:shopAvailable",function(){user.get("shopAvailable")&&(user.get("episode")<Config.episodesAmount||user.get("level")<=Config.levelsInEpisode)&&setTimeout(_.bind(function(){this.trigger("event")},this),700)},this)}}),GachaForce=BaseForce.extend({defaults:{id:2,view:NewBaseForceView,needPage:"main",name:"gachaForce"},getEl:function(){return $(".gachaBlock")},done:function(){BaseForce.prototype.done.call(this),user.set("spins",1)},onOpen:function(){},eventFunction:function(){user.on("change:gachaAvailable",function(){user.get("gachaAvailable")&&(user.get("episode")<Config.episodesAmount||user.get("level")<=Config.levelsInEpisode)&&(window.mobile&&"menuMain"!==application.get("subPage")||setTimeout(_.bind(function(){this.trigger("event")},this),700))},this)}}),GiftsShopForce=BaseForce.extend({defaults:{id:10,view:NewBaseForceView,needPage:"main",name:"giftsShopForce"},getEl:function(){return $("#main .shopBlock.shop")},eventFunction:function(){application.on("giftsAvailable",function(){(5<user.get("level")||1<user.get("episode"))&&(1==user.get("level")||user.get("level")==Config.levelsInEpisode+1||episode.isBonusWorld()||this.trigger("event"))},this)}}),CollectCoinsForce=BaseForce.extend({defaults:{id:1,view:BaseForceView,needPage:"main",name:"collectCoinsForce",addZIndex:!0},getEl:function(){return this.get("el")},eventFunction:function(){5<user.get("episode")||user.on("canCollectCoins",function(e){this.has("el")||(this.set("el",e),this.trigger("event"))},this)}}),BonusLevelForce=BaseForce.extend({defaults:{id:3,view:NewBaseForceView,needPage:"main",name:"bonusLevelForce"},getEl:function(){return"#mapBonusLevelBlock"},eventFunction:function(){application.on("main",function(){(user.get("level")>=Math.floor(Config.bonusLevelStars/3)-1||1<user.get("episode"))&&(1==user.get("level")||user.get("level")==Config.levelsInEpisode+1||episode.isBonusWorld()||this.trigger("event"))},this)}}),StripForce=BaseForce.extend({defaults:{id:4,view:BaseForceView,needPage:"main",name:"stripForce"},getEl:function(){return $("#stripMain")},eventFunction:function(){application.strip.on("change:active",function(){!1!==application.strip.get("active")&&(user.get("episode")<Config.episodesAmount||user.get("level")<=Config.levelsInEpisode)&&(window.mobile&&"menuMain"!==application.get("subPage")||this.trigger("event"))},this)}}),BoxForce=BaseForce.extend({defaults:{id:5,view:NewBaseForceView,needPage:"main",name:"boxForce"},getEl:function(){return $(".currentBox")},eventFunction:function(){Config.boxForceLevel&&application.on("main",function(){if(Config.boxForceLevel<=user.getRealLevel()&&user.get("level")<=Config.levelsInEpisode){if(Config.boxForceMaxLevel&&user.getRealLevel()>Config.boxForceMaxLevel)return;this.trigger("event")}},this)}}),GemsShopForce=ShopForce.extend({done:function(){user.set("shownForces",user.get("shownForces")|1<<this.id|65536)}}),AddThreeMovesForce=ShopForce.extend({defaults:{id:16,view:BaseForceView,needPage:"main",name:"addThreeMovesForce"},needShow:function(){return!(user.get("shownForces")&1<<this.id)&&1&user.get("shownForces")}}),BaseActionActivator=function(e){_inherits(i,Backbone.Model);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e,t){return this._manager=e,this._app=t,Promise.resolve()}},{key:"activate",value:function(){}}]),i}();BaseActionActivator.prototype.defaults={rules:function(){return!0}};var DateRangeActivator=function(e){_inherits(a,BaseActionActivator);var t=_createSuper(a);function a(){return _classCallCheck(this,a),t.apply(this,arguments)}return _createClass(a,[{key:"getBeginDate",value:function(){return this.get("beginDate")}},{key:"getEndDate",value:function(){return this.get("endDate")}},{key:"init",value:function(e,t){var i=this;_get(_getPrototypeOf(a.prototype),"init",this).call(this,e,t);var o=new Date(1e3*application.getCurrentServerTime());if(this.get("beginDate")<o&&this.get("endDate")>o)return this.tryRun();this.get("beginDate")>o&&setTimeout(function(){return i.tryRun()},this.get("beginDate").getTime()-o.getTime())}},{key:"tryRun",value:function(){var i=this;Promise.resolve().then(function(){return i.get("rules")()}).then(function(e){if(e){var t=i.getAction();return t.set("activator",i),t.activate()}})}},{key:"getAction",value:function(){var e=this._manager.getById(this.get("actionId"));if(!e)throw new Error("Not finde action ".concat(this.get("actionId")));return e}},{key:"getTimer",value:function(){return(this.get("endDate").getTime()-1e3*application.getCurrentServerTime())/1e3}}]),a}(),BaseAction=function(e){_inherits(i,Backbone.Model);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){this._app=e}},{key:"loadData",value:function(){return Promise.resolve()}},{key:"open",value:function(){}},{key:"isActive",value:function(){return this.get("active")}},{key:"neadShow",value:function(){return!0}},{key:"run",value:function(){return this.get("showOnStart")&&this.neadShow()&&this.open(),Promise.resolve()}},{key:"activate",value:function(){var e=this;return this.set("active",!0),Promise.resolve().then(function(){return e.loadData()}).then(function(){if(e.isActive())return e.run()})}}]),i}();BaseAction.prototype.defaults={active:!1,showOnStart:!0};var EndlessTreasureAction=function(e){_inherits(i,BaseAction);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){var t=this;return Promise.resolve().then(function(){return BaseAction.prototype.init.call(t,e)}).then(function(){var e=t.get("items")();t.set("offers",new Backbone.Collection(e))})}},{key:"open",value:function(){new(this.get("windowClass"))({model:this})}},{key:"setStage",value:function(e){if(e>=this.getFinalStage()&&(e=0),this.get("stage")!==e)return this.set("stage",e),this.updateData()}},{key:"getStage",value:function(){return this.get("stage")}},{key:"buy",value:function(e){var t=this;return e?e.take().catch(function(e){throw e}).then(function(){return t.setStage(t.get("stage")+1)}):Promise.resolve()}},{key:"initOffers",value:function(){var i=this,o=this.get("stage")+this.get("itemsToShow"),e=this.get("items").map(function(e,t){if(t>i.get("stage")&&t<o)return application.offers.get(e)});this.set("offers",e)}},{key:"loadData",value:function(){var i=this;return service("../../../gems/site/service/endlesstreasureaction/loaddata.php",{actionName:this.get("name")}).then(function(e){var t=0;e&&e.endDate&&e.stage&&(Date.parse(e.endDate)/1e3>application.getCurrentServerTime()&&(t=e.stage));i.setStage(t)})}},{key:"updateData",value:function(){return service("../../../gems/site/service/endlesstreasureaction/savedata.php",{actionName:this.get("name"),endDate:formatDateForDB(this.get("activator").getEndDate()),stage:this.get("stage")})}},{key:"getTimer",value:function(){return this.get("activator").getTimer()}},{key:"getOffers",value:function(){return this.get("offers")}},{key:"getOfferByName",value:function(t){return this.getOffers().find(function(e){return e.getName()===t})}},{key:"isFinalStage",value:function(){return this.getOffers().length===this.get("stage")}},{key:"getFinalStage",value:function(){return this.getOffers().length}}]),i}();EndlessTreasureAction.prototype.defaults=_.defaults({name:"endlessTreasure",stage:0,items:[],windowClass:EndlessTreasureWindow},BaseAction.prototype.defaults);var DuoBundleActionWindow=TWindow.extend({templateClass:".duoBundleActionWindow_template",events:{"click .buy":"buy","click .close":"close"},onOpen:function(){var i=this;TWindow.prototype.onOpen.call(this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.$el.addClass(this.model.get("name")),this.listenTo(this.model,"change:active",function(e,t){t||i.close()}),this.listenTo(this.model,"change:process",this.updateProcess),this.listenTo(this.model,"change:process",this.updateBought);var a=this.$(".invisible .prize"),n=this.$(".invisible .box");this.model.getOffers().forEach(function(e,t){var i,o=n.clone().addClass("box"+(t+1)).addClass(e.get("productId"));o.find(".buy").data("productId",e.get("productId")),o.find(".title").html(e.getTitle()),o.find(".buy").html(e.getDisplayPrice()),e.getProducts().forEach(function(e){(i=a.clone()).appendTo(o.find(".prizes")),i.addClass(e.getType()).addClass(e.getName()),"good"===e.getType()?i.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):i.find(".amount").html(e.getDisplayAmount())},this),o.appendTo(this.$(".boxContainer"))},this),this.updateBought()},updateProcess:function(){this.$el.toggleClass("processBuy",this.model.get("process"))},updateBought:function(){var t=this;this.model.getOffers().forEach(function(e){t.$el.find(".box."+e.get("productId")).toggleClass("bought",e.get("bought")).find(".buy").toggleClass("bought",e.get("bought"))})},buy:function(e){var t=this,i=$(e.target).data("productId"),o=this.model.getOffer(i).getProducts(),a=this.$("."+i);this.model.takeBox(i,function(){t.model.get("process")||(a.addClass("openbox"),a.addClass("bought"),setTimeout(function(){a.removeClass("openbox"),new AnimatedPrizesWindow({urgent:!0,prizes:o,worldName:"salesDayActionPrizes",notGive:!0})},1e3))})},onClose:function(){TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0)}}),SalesDayActionWindow=TWindow.extend({templateClass:".salesDayActionWindow_template",events:{"click .buy":"buy","click .close":"close"},onOpen:function(){var i=this;TWindow.prototype.onOpen.call(this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.$el.addClass(this.model.get("name")),this.updateTimer(),this.timer=setInterval(function(){return i.updateTimer()},1e3),this.listenTo(this.model,"change:active",function(e,t){t||i.close()}),this.listenTo(this.model,"change:process",this.updateProcess),this.listenTo(this.model,"change:process",this.updateBoxes),this.updateBoxes();var l=this.$(".invisible .prize"),d=this.$(".invisible .box");this.model.getOffers().forEach(function(e,t){var i=d.clone().addClass("box"+(t+1)).addClass(e.get("productId"));i.toggleClass("bought",e.get("bought")),i.find(".buy").data("productId",e.get("productId")),i.find(".title").html(e.getTitle()),0<e.getPrice()?i.find(".buy").html(e.getDisplayPrice()):(i.addClass("free"),i.find(".oneAltBtn.buy").html(messages.shopPriceFree));var o,a,n=e.getProducts(),r=4<n.length;if(r)for(t=0;t<Config.powerUpIdsOrder.length;++t){var s=n.findWhere({type:"powerUp",name:Config.powerUpIdsOrder[t]});if(!s||o&&o!==s.get("amount")){r=!1;break}o=s.get("amount")}n.forEach(function(e){r&&"powerUp"===e.getType()||((a=l.clone()).appendTo(i.find(".prizes")),a.addClass(e.getType()).addClass(e.getName()),"good"===e.getType()?a.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):a.find(".amount").html(e.getDisplayAmount()))},this),r&&((a=l.clone()).appendTo(i.find(".prizes")),a.addClass("powerUp-group"),a.find(".amount").html('<span class="amountLessText">x</span>'+o)),i.appendTo(this.$(".boxContainer"))},this)},updateProcess:function(){this.$el.toggleClass("processBuy",this.model.get("process"))},updateBoxes:function(){var t=this;this.model.getOffers().forEach(function(e){t.$el.find(".box."+e.get("productId")).toggleClass("bought",e.get("bought"))})},buy:function(e){var t=this,i=$(e.target).data("productId"),o=this.model.getOffer(i).getProducts(),a=this.$("."+i);this.model.takeBox(i,function(){t.model.get("process")||(a.addClass("openbox"),a.addClass("bought"),setTimeout(function(){a.removeClass("openbox"),new AnimatedPrizesWindow({urgent:!0,prizes:o,worldName:"salesDayActionPrizes",notGive:!0})},1e3))})},onClose:function(){TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),clearInterval(this.timer)},updateTimer:function(){this.$("#timer").html(formatPeriod(Math.round(this.model.getTimer()/60)))}}),SalesDayAction=function(e){_inherits(i,BaseAction);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"loadData",value:function(){var e=this;return Promise.resolve().then(function(){return e.waitInitOffer()}).then(function(){return e.initOffers()})}},{key:"waitInitOffer",value:function(){var e=application.getComponent(ApplicationOffersComponent);if(e)return e.get("initialized")?Promise.resolve():this.offersComponent.waitEvent("offersInitialized");throw new Error("Not found offers component")}},{key:"neadShow",value:function(){return!this.isCompleted()}},{key:"initOffers",value:function(){application.getComponent(ApplicationOffersComponent);this.set("offers",new Backbone.Collection(this.get("items").map(function(e){return application.getComponent(ApplicationOffersComponent).getOfferById(e)}))),this.checkBought(),this.checkCompletion(),this.listenTo(user,"buyProduct",this.onBuyProduct)}},{key:"open",value:function(){new(this.get("window"))({model:this})}},{key:"isCompleted",value:function(){return this.get("completed")}},{key:"checkCompletion",value:function(){var e=this.getOffers().filter(function(e){return e.get("bought")}).length;this.set("completed",this.getOffers().length===e)}},{key:"getTimer",value:function(){return this.get("activator").getTimer()}},{key:"getOffers",value:function(){return this.get("offers")}},{key:"getOffer",value:function(e){return this.getOffers().findWhere({productId:e})}},{key:"takeBox",value:function(e,t){if(!this.get("process")){var i=this.getOffer(e);if(i)return this.set("process",!0),this.callback=t,i.buy(),void setTimeout(_.bind(function(){this.set("process",!1)},this),1e4)}t()}},{key:"onBuyProduct",value:function(e){var t=this.getOffers().findWhere({product:e.product});t&&t.set("bought",!0),this.onAfterBuyProduct(e),this.isActive()&&(this.set("process",!1),this.callback&&(this.callback(this),this.callback=null))}},{key:"onAfterBuyProduct",value:function(e){this.checkCompletion()}},{key:"checkBought",value:function(){this.getOffers().forEach(function(e){var t=!1,i=new Date(e.get("lastPayDate"));0<e.get("countPay")&&i>this.get("activator").getBeginDate()&&i<this.get("activator").getEndDate()&&(t=!0),e.set("bought",t)},this)}}]),i}();SalesDayAction.prototype.defaults=_.defaults({window:SalesDayActionWindow,completed:!1},BaseAction.prototype.defaults);var ChainSaleWithFreeGiftAction=function(e){_inherits(i,SalesDayAction);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initOffers",value:function(){_get(_getPrototypeOf(i.prototype),"initOffers",this).call(this),this.checkEnabled()}},{key:"open",value:function(){new ChainSaleWithFreeGiftWindow({model:this})}},{key:"onAfterBuyProduct",value:function(e){_get(_getPrototypeOf(i.prototype),"onAfterBuyProduct",this).call(this,e),this.checkEnabled()}},{key:"checkEnabled",value:function(){var t=!0;this.getOffers().forEach(function(e){e.set("enabled",t),e.get("bought")||(t=!1)})}}]),i}();ChainSaleWithFreeGiftAction.prototype.defaults=_.defaults({completed:!1},BaseAction.prototype.defaults);var ChainSaleWithFreeGiftWindow=TWindow.extend({templateClass:".chainSaleWithFreeGiftWindow_template",events:{"click .buy":"buy","click .close":"close"},onOpen:function(){var i=this,l=this.model.id;TWindow.prototype.onOpen.call(this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.$el.addClass(this.model.get("name")),this.$el.addClass("itemsCount"+this.model.get("items").length),new Date>new Date("2022/09/18 00:00:00")&&new Date<new Date("2022/09/19 00:00:00")&&this.$el.addClass("odkMessage"),this.updateTimer(),this.timer=setInterval(function(){return i.updateTimer()},1e3),this.listenTo(this.model,"change:active",function(e,t){t||i.close()});var e=this.model.getOffers();this.listenTo(this.model,"change:process",this.updateProcess),this.listenTo(e,"change:enabled",this.updateBoxes),this.listenTo(this.model,"change:completed",this.updateCompleted),this.updateBoxes();var d=this.$(".invisible .prize"),c=this.$(".invisible .box");this.$(".topBar .title").html(messages.chainSaleWithFreeGift.title),this.$(".description").html(messages.chainSaleWithFreeGift.description),this.updateCompleted(),e.forEach(function(e,t){var i=c.clone().addClass("box"+(t+1)).addClass(e.get("productId"));i.toggleClass("bought",e.get("bought")),i.toggleClass("enabled",e.get("enabled")),i.find(".buy").data("productId",e.get("productId")),i.find(".title").html(messages[l].offers[e.get("productId")]),i.find(".tipText").html(messages.chainSaleWithFreeGift.hint),0<e.getPrice()?i.find(".buy").html(e.getDisplayPrice()):(i.addClass("free"),i.find(".oneAltBtn.buy").html(messages.shopPriceFree));var o,a,n=e.getProducts(),r=4<n.length;if(r)for(t=0;t<Config.powerUpIdsOrder.length;++t){var s=n.findWhere({type:"powerUp",name:Config.powerUpIdsOrder[t]});if(!s||o&&o!==s.get("amount")){r=!1;break}o=s.get("amount")}n.forEach(function(e){r&&"powerUp"===e.getType()||((a=d.clone()).appendTo(i.find(".prizes")),a.addClass(e.getType()).addClass(e.getName()),"good"===e.getType()?a.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):a.find(".amount").html(e.getDisplayAmount()))},this),r&&((a=d.clone()).appendTo(i.find(".prizes")),a.addClass("powerUp-group"),a.find(".amount").html('<span class="amountLessText">x</span>'+o)),i.appendTo(this.$(".boxContainer"))},this)},updateCompleted:function(){this.$el.toggleClass("completed",this.model.get("completed"))},onChangeEnabled:function(e,t,i){i.toggleClass("enabled",e.get("enabled"))},animateTip:function(e){e.addClass("animateTip"),setTimeout(function(){e.removeClass("animateTip")},1e3)},updateProcess:function(){this.$el.toggleClass("processBuy",this.model.get("process"))},updateBoxes:function(){var t=this;this.model.getOffers().forEach(function(e){t.$el.find(".box."+e.get("productId")).toggleClass("bought",e.get("bought")),t.$el.find(".box."+e.get("productId")).toggleClass("enabled",e.get("enabled"))})},buy:function(e){var t=this,i=$(e.target).data("productId"),o=this.model.getOffer(i);if(o.get("enabled")){var a=o.getProducts(),n=this.$("."+i);this.model.takeBox(i,function(){t.model.get("process")||(n.addClass("openbox"),n.addClass("bought"),setTimeout(function(){n.removeClass("openbox"),new AnimatedPrizesWindow({urgent:!0,prizes:a,worldName:"salesDayActionPrizes",notGive:!0})},1e3))})}else this.animateTip($(e.target).parent())},onClose:function(){TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),clearInterval(this.timer)},updateTimer:function(){this.$("#timer").html(formatPeriod(Math.round(this.model.getTimer()/60)))}}),SaleTripleBenefitAction=function(e){_inherits(i,BaseAction);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"loadData",value:function(){var e=this;return Promise.resolve().then(function(){return e.waitInitOffer()}).then(function(){return e.initOffers()})}},{key:"waitInitOffer",value:function(){var e=application.getComponent(ApplicationOffersComponent);if(e)return e.get("initialized")?Promise.resolve():this.offersComponent.waitEvent("offersInitialized");throw new Error("Not found offers component")}},{key:"neadShow",value:function(){return!this.isCompleted()}},{key:"initOffers",value:function(){var t=application.getComponent(ApplicationOffersComponent);this.set("offers",new Backbone.Collection(this.get("items").map(function(e){return t.getOfferById(e)}))),this.checkBought(),this.checkCompletion(),this.listenTo(user,"buyProduct",this.onBuyProduct),this.checkEnabled()}},{key:"open",value:function(){new SaleTripleBenefitWindow({model:this})}},{key:"isCompleted",value:function(){return this.get("completed")}},{key:"isActive",value:function(){return this.get("active")}},{key:"checkCompletion",value:function(){this.set("completed",this.getOffers().some(function(e){return e.get("bought")}))}},{key:"getTimer",value:function(){return this.get("activator").getTimer()}},{key:"getOffers",value:function(){return this.get("offers")}},{key:"getOffer",value:function(e){return this.getOffers().findWhere({productId:e})}},{key:"takeBox",value:function(e,t){if(!this.get("process")){var i=this.getOffer(e);if(i)return this.set("process",!0),this.callback=t,i.buy(),void setTimeout(_.bind(function(){this.set("process",!1)},this),1e4)}t()}},{key:"onBuyProduct",value:function(e){var t=this.getOffers().findWhere({product:e.product});t&&t.set("bought",!0),this.onAfterBuyProduct(e),this.isActive()&&(this.set("process",!1),this.callback&&(this.callback(this),this.callback=null))}},{key:"onAfterBuyProduct",value:function(e){this.checkEnabled(),this.checkCompletion()}},{key:"checkBought",value:function(){this.getOffers().forEach(function(e){var t=!1,i=new Date(e.get("lastPayDate"));0<e.get("countPay")&&i>this.get("activator").getBeginDate()&&i<this.get("activator").getEndDate()&&(t=!0),e.set("bought",t)},this)}},{key:"checkEnabled",value:function(){var t=this.getOffers().every(function(e){return!e.get("bought")});this.getOffers().forEach(function(e){e.set("enabled",t)}),this.set("active",t)}}]),i}();SaleTripleBenefitAction.prototype.defaults=_.defaults({completed:!1,name:"saleTripleBenefit"},BaseAction.prototype.defaults);var SaleTripleBenefitWindow=TWindow.extend({templateClass:".saleTripleBenefitWindow_template",events:{"click .buy":"buy","click .close":"close"},onOpen:function(){var i=this,a=this.model.id;TWindow.prototype.onOpen.call(this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.$el.addClass(this.model.get("name")),this.$el.addClass("itemsCount"+this.model.get("items").length),new Date>new Date("2022/09/18 00:00:00")&&new Date<new Date("2022/09/19 00:00:00")&&this.$el.addClass("odkMessage"),this.updateTimer(),this.timer=setInterval(function(){return i.updateTimer()},1e3),this.listenTo(this.model,"change:active",function(e,t){t||i.close()});var e=this.model.getOffers();this.listenTo(this.model,"change:process",this.updateProcess),this.listenTo(e,"change:enabled",this.updateBoxes),this.listenTo(this.model,"change:completed",this.updateCompleted),this.updateBoxes();var n=this.$(".invisible .prize"),r=this.$(".invisible .box");this.$(".topBar .title").html(messages.saleTripleBenefit.title),this.$(".description").html(messages.saleTripleBenefit.description),this.updateCompleted(),e.forEach(function(e,t){var i,o=r.clone().addClass("box"+(t+1)).addClass(e.get("productId"));o.toggleClass("bought",e.get("bought")),o.toggleClass("enabled",e.get("enabled")),o.find(".buy").data("productId",e.get("productId")),o.find(".title").html(messages[a].offers[e.get("productId")]),o.find(".tipText").html(messages.saleTripleBenefit.hint),0<e.getPrice()?o.find(".buy").html(e.getDisplayPrice()):(o.addClass("free"),o.find(".oneAltBtn.buy").html(messages.shopPriceFree)),e.getProducts().forEach(function(e){(i=n.clone()).appendTo(o.find(".prizes")),i.addClass(e.getType()).addClass(e.getName()),"good"===e.getType()?i.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):i.find(".amount").html(e.getDisplayAmount())},this),o.appendTo(this.$(".boxContainer"))},this)},updateCompleted:function(){this.$el.toggleClass("completed",this.model.get("completed"))},onChangeEnabled:function(e,t,i){i.toggleClass("enabled",e.get("enabled"))},animateTip:function(e){e.addClass("animateTip"),setTimeout(function(){e.removeClass("animateTip")},1e3)},updateProcess:function(){this.$el.toggleClass("processBuy",this.model.get("process"))},updateBoxes:function(){var t=this;this.model.getOffers().forEach(function(e){t.$el.find(".box."+e.get("productId")).toggleClass("bought",e.get("bought")),t.$el.find(".box."+e.get("productId")).toggleClass("enabled",e.get("enabled"))})},buy:function(e){var t=this;$("#saleTripleBenefitWindow .buy").toggleClass("disabled",!0);var i=$(e.target).data("productId"),o=this.model.getOffer(i);if(o.get("enabled")){var a=o.getProducts(),n=this.$("."+i);this.model.takeBox(i,function(){t.model.get("process")||(n.addClass("openbox"),n.addClass("bought"),setTimeout(function(){n.removeClass("openbox"),new AnimatedPrizesWindow({urgent:!0,prizes:a,worldName:"salesDayActionPrizes",notGive:!0})},1e3))})}else this.animateTip($(e.target).parent())},onClose:function(){TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),clearInterval(this.timer)},updateTimer:function(){this.$("#timer").html(formatPeriod(Math.round(this.model.getTimer()/60)))}}),Offer=Backbone.Model.extend((_Backbone$Model$exten={defaults:{action:"none",price:0,countPay:0,supply:1/0,adapter:null},initialize:function(e){var t=this;Backbone.Model.prototype.initialize.call(this,e),this.products=new UserPrizes(this.get("products")),this.get("paymentAdapter")&&this.listenTo(this.get("paymentAdapter"),"change",function(){return t.trigger("change")})},buy:function(){return this.get("countPay")>=this.get("supply")?Promise.resolve(!1):this.get("paymentAdapter")?this._buyViaAdapter():user.set("coins",new ObscureNumber(user.get("coins")-this.get("coins")),{validate:!0})?this._buyForCoins():Promise.resolve(!1)},isSoldOut:function(){return this.get("supply")<=this.get("countPay")},purchase:function(){this.products.take(this.get("action"),episode.getNumForStatistics(),application.level&&application.level.num||0,this.get("coins")),this.set("countPay",this.get("countPay")+1)},_buyForCoins:function(){return this.purchase(),Promise.resolve(!0)},_buyViaAdapter:function(){var t=this,i=this.get("paymentAdapter"),o=this.get("price");return i.getAmount().then(function(e){return o<=e?i.charge(o).then(function(){return t.purchase()}).then(function(){return!0}):Promise.reject(" ")})},isLimitedSupply:function(){return this.get("supply")<1/0},getLimit:function(){return this.get("supply")-this.get("countPay")}},_defineProperty(_Backbone$Model$exten,"isSoldOut",function(){return this.get("supply")<=this.get("countPay")}),_defineProperty(_Backbone$Model$exten,"canBuy",function(){if(this.get("paymentAdapter")){var e=this.get("paymentAdapter"),t=this.get("price");return e.getAmount().then(function(e){return t<=e})}return Promise.resolve(!0)}),_defineProperty(_Backbone$Model$exten,"getTextPrice",function(){return this.get("price")}),_defineProperty(_Backbone$Model$exten,"getProducts",function(){return this.products}),_Backbone$Model$exten)),LinkOffer=Backbone.Model.extend({constructor:function(e){var t={name:e,offer:application.getComponent(ApplicationOffersComponent).getOfferById(e)};Backbone.Model.call(this,t)},take:function(){var e=this;return Promise.resolve().then(function(){return e.get("offer").buy()})},getName:function(){return this.get("name")},getUserPrizes:function(){return new UserPrizes(this.get("offer").products)},getDisplayPrice:function(){return prices[this.get("name")].desc.price}}),SlotMachineOffer=Offer.extend({defaults:_.defaults({multiply:1},Offer.prototype.defaults),getMultiply:function(){return this.get("multiply")}}),ActionsConfig=[new SalesDayAction({id:"salesDay",name:"salesDayAction1",items:["salesDayAction1","salesDayAction2","salesDayAction3"]}),new ChainSaleWithFreeGiftAction({id:"chainSaleWithFreeGift",name:"ChainSaleWithFreeGift",items:["salesDayAction2","salesDayAction3","salesDayAction1"]}),new ChainSaleWithFreeGiftAction({id:"chainSaleWithFreeGift4Item",name:"ChainSaleWithFreeGift4Item",items:["chainSaleAction1","chainSaleAction2","chainSaleAction3","chainSaleAction4"]}),new EndlessTreasureAction({id:"endlessTreasure",windowClass:EndlessTreasureChainedWindow,items:function(){return[new Prize({name:"endlessTreasure1",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}),new Prize({name:"endlessTreasure2",products:[{type:"CoinsProduct",amount:30}]}),new Prize({name:"endlessTreasure3",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]}),new LinkOffer("endlessTreasureOffer1"),new Prize({name:"endlessTreasure5",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}),new Prize({name:"endlessTreasure6",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}),new Prize({name:"endlessTreasure7",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}),new LinkOffer("endlessTreasureOffer2"),new Prize({name:"endlessTreasure9",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}),new Prize({name:"endlessTreasure10",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]}),new LinkOffer("endlessTreasureOffer3"),new Prize({name:"endlessTreasure12",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}),new Prize({name:"endlessTreasure13",products:[{type:"CoinsProduct",amount:50}]}),new LinkOffer("endlessTreasureOffer4"),new Prize({name:"endlessTreasure15",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"},{type:"CoinsProduct",amount:50}]}),new Prize({name:"endlessTreasure16",products:[{type:"CoinsProduct",amount:50}]}),new LinkOffer("endlessTreasureOffer5"),new Prize({name:"endlessTreasure18",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]})]}}),new SalesDayAction({window:DuoBundleActionWindow,id:"salesDay2",name:"salesDayAction2",items:["saleWithTwoBundles1","saleWithTwoBundles2"]}),new SaleTripleBenefitAction({id:"saleTripleBenefit",items:["saleTripleBenefit1","saleTripleBenefit2","saleTripleBenefit3","saleTripleBenefit4"]})],ActionActivatorsConfig=[new DateRangeActivator({beginDate:new Date("2024/03/30 00:00:00"),endDate:new Date("2024/04/02 00:00:00"),rules:rules.CommonRule({minLevel:21}),actionId:"chainSaleWithFreeGift"}),new DateRangeActivator({beginDate:new Date("2023/11/14 00:00:00"),endDate:new Date("2023/11/17 00:00:00"),rules:rules.CommonRule({minLevel:41}),actionId:"chainSaleWithFreeGift4Item"}),new DateRangeActivator({beginDate:new Date("2022/09/01 00:00:00"),endDate:new Date("2022/09/10 00:00:00"),rules:rules.CommonRule({minLevel:21}),actionId:"salesDay"}),new DateRangeActivator({beginDate:new Date("2024/04/29 00:00:00"),endDate:new Date("2024/05/02 00:00:00"),rules:rules.CommonRule({minLevel:21,notNetwork:["wizq"],notWizqNetwork:["hangame"]}),actionId:"endlessTreasure"}),new DateRangeActivator({beginDate:new Date("2024/05/05 00:00:00"),endDate:new Date("2024/05/07 00:00:00"),rules:rules.CommonRule({minLevel:21}),actionId:"salesDay2"}),new DateRangeActivator({beginDate:new Date("2024/06/06 00:00:00"),endDate:new Date("2024/06/10 00:00:00"),rules:rules.CommonRule({minLevel:21}),actionId:"saleTripleBenefit"})],ActionManagerComponent=BaseApplicationComponent.extend({initialize:function(e){this._actions=new Backbone.Collection(e.actions),this._activators=new Backbone.Collection(e.activators),delete e.actions},load:function(t){return new Promise(function(e){return t.once("main",e)})},init:function(){var t=this;return Promise.resolve().then(function(){return Promise.all(t._actions.map(function(e){return e.init(application)}))}).then(function(){return Promise.all(t._activators.map(function(e){return e.init(t,application)}))}).then(function(){return t.createButtons()})},getById:function(e){return this._actions.get(e)},createButtons:function(){var t=this;this._actions.forEach(function(e){t.toggleLabel(e),e.on("change:active",t.toggleLabel,t,e),e.isActive()&&e.getTimer&&setInterval(function(){return t.updateTimer(e)},1e3)})},toggleLabel:function(e){var t=$("#main .coinsAction");t.toggleClass("active_"+e.get("name"),e.isActive()),e.isActive()&&(t.addClass(e.get("name")),t.on("touchstart click",function(){return e.open()}))},updateTimer:function(e){$("#main .coinsAction .actionTimer").html(formatDuration(e.getTimer()))}}),CellsRegistry,Config={gameClass:GameClass,gameViewClass:GemsView,project:"gems",linksLikeWindow:{facebook:"https://www.facebook.com/games/piratetreasures/?fbs=106"},shopPowerUps:{deleteCellPowerUp:[{coins:900,action:"deleteCellPowerUp3",products:[{type:"powerUp",name:"deleteCellPowerUp",amount:3}]},{discount:10,coins:1600,action:"deleteCellPowerUp6",products:[{type:"powerUp",name:"deleteCellPowerUp",amount:6}]},{discount:20,coins:2100,action:"deleteCellPowerUp9",products:[{type:"powerUp",name:"deleteCellPowerUp",amount:9}]}],shufflePowerUp:[{coins:1200,action:"shufflePowerUp3",products:[{type:"powerUp",name:"shufflePowerUp",amount:3}]},{discount:10,coins:2100,action:"shufflePowerUp6",products:[{type:"powerUp",name:"shufflePowerUp",amount:6}]},{discount:20,coins:2800,action:"shufflePowerUp9",products:[{type:"powerUp",name:"shufflePowerUp",amount:9}]}],lightingPowerUp:[{coins:1500,action:"lightingPowerUp3",products:[{type:"powerUp",name:"lightingPowerUp",amount:3}]},{discount:10,coins:2700,action:"lightingPowerUp6",products:[{type:"powerUp",name:"lightingPowerUp",amount:6}]},{discount:20,coins:3600,action:"lightingPowerUp9",products:[{type:"powerUp",name:"lightingPowerUp",amount:9}]}],deleteRowPowerUp:[{coins:1500,action:"deleteRowPowerUp3",products:[{type:"powerUp",name:"deleteRowPowerUp",amount:3}]},{discount:10,coins:2700,action:"deleteRowPowerUp6",products:[{type:"powerUp",name:"deleteRowPowerUp",amount:6}]},{discount:20,coins:3600,action:"deleteRowPowerUp9",products:[{type:"powerUp",name:"deleteRowPowerUp",amount:9}]}]},vkPromos:[{promoId:34,name:"festival2024",prize:[{type:"good",name:"unlimitedLifes",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"starInField",amount:1}]}],okPromos:[{promoId:"prize",name:"smallChestOdk",prize:[{type:"good",name:"unlimitedLifes",amount:24},{type:"good",name:"starInField",amount:24},{type:"coins",amount:1e3}]}],tickets:{networks:["vkontakte","test"],endDate:new Date("2020/07/01"),addRandomToBonusLevel:[3,5]},timeRewardEnabled:!1,minBonusworldLevel:3,bonusWorldsEpisodesNum:{cloudislands:-1,cloverfields:-2,pushkin:-4,autumnworld:-5,bookoflove:-32,flowerfairy:-16,hornandmolasses:-17,dragonsworld:-9,halloween2019world:-10,happynewyear2019world:-13,wildwildwest:-14,fairytale2:-21,fairytale3:-22,birthday2020world:-25,birthday2019world:-26,birthdayworld:-27,halloween2020world:-29,thanksgivingday2020world:-30,newyear2020world:-31,veniceworld:-33,firstbonusworld2:-34,stpatricksday:-36,pashaworld:-37,spaceworld:-38,ticketevent:-40,cloudrace:-42,olympicgames:-47,cloudrace2:-48,deepsea:-50,birthday2021world:-51,bigfishgameworld:-52,halloween2021world:-53,thanksgivingday2021world:-54,dayoflove2022world:-59,eggs2021world:-61,openseaworld:-63,fishingjune2022:-64,mysterioustown:-66,poseidonstrident:-67,birthday2022world:-70,peachtreeworld:-73,halloween2022world:-72,valentinesday2023world1:-82,valentinesday2023world2:-83,valentinesday2023world3:-84,valentinesday2023world4:-85,simplesnatch:-87,royalregatta:-89,easterfishing:-91,aroundtheworld:-92,victorydayworld:-93,summersearchworld:-94,fireworkspartyworld:-98,archeologistsworld:-100,beachtreasures:-103,piratebirthdaycooking:-104,japanworld:-105,piratesdayworld:-106,halloween2023world:-107,leakypierworld:-108,thanksgivingday2022world1:-109,thanksgivingday2022world2:-110,thanksgivingday2022world3:-111,thanksgivingday2022world4:-112,happynewyear2021world:-113,winterfishing:-114,groundhogday:-115,chinesenewyear2024:-116,royaltreasury:-117,deliciousadventure:-118,wintertown:-119,fascinatinghike:-120,easterregatta:-121,springworld:-122,easterbanquet:-123,SummerFishing:-124,climbingstories:-125,pushkinbirthdayworld:-126},announceBonusWorlds:[],lootBoxEnable:function(){return!("wizq"===network&&"yahoojp"===wizqnetwork)},gameFriday:{actionId:23,name:"thanksgivingday2023world",items:["gameFriday1","gameFriday2","gameFriday3","gameFriday4","gameFriday5"],begin:"2023/11/24 00:00:00",end:"2023/11/27 00:00:00"},captainHat:{name:"captainHat",duration:86400,availability:{minLevel:16,weekDays:[1,2,3,4,5,6,0]}},premiumPrize:{type:"premium",products:[{type:"good",addTime:3600,goodId:"unlimitedLifes",cssClass:"unlimitedLifes",name:"unlimitedLifes",amount:1},{type:"coins",amount:100,cssClass:"coinsbonuswindow"},{type:"spins",amount:1,name:"spins",cssClass:"spins"}]},castes:[{id:1,daysInGameMax:7,paid:0},{id:2,paymentsCountMax:1},{id:3,paymentsCountMin:2,sumMax:.99},{id:4,sumAvgMin:1,sumAvgMax:2,paymentsCount:1},{id:5,sumAvgMin:1,sumAvgMax:2,paymentsCountMin:2},{id:6,sumAvgMin:2.01,sumAvgMax:4.99},{id:7,sumAvgMin:4.5}],birthdayGifts:[{type:"coins",amount:500},{type:"powerUp",powerUp:"lightingPowerUp",amount:1},{type:"sticker",id:"gift_sticker6"}],quickPurchase:{networks:["test","facebook"],products:["unlimitedLifes","coins300",["unlimitedKeys","starInFieldDay","addThreeMoves"]]},specialLevels:{enabled:!0,gamemusic:"bonusracoonmusic"},autoUnlockEpisodeTime:43200,unlockEpisodeConfig:{3:{autoUnlockTime:30,price:[20,20,20]},4:{autoUnlockTime:300,price:[50,40,30]},5:{autoUnlockTime:900,price:[100,70,50]},6:{autoUnlockTime:3600,price:[200,150,100]},7:{autoUnlockTime:7200,price:[500,350,250]},0:{autoUnlockTime:43200,price:[1e3,700,500]}},payPromo:{networks:["test","facebook"],episode:2,level:1,product:"payPromo",delay:5184e5},gameProgressOnCanvasEnabled:!1,powerupsOnCanvasEnabled:!0,bonusLevelTaskOnCanvasEnabled:!1,maxHelpFriends:3,levelToHelpFriends:10,statisticScoresListSize:3,tournamentPhotoSize:20,tournamentProfileWindowPhotoSize:60,tournamentTimerFormat:"%H:%i:%s",tournaments:[{networks:["test","odnoklassniki","vkontakte","mailru"],servers:[{nodePort:"10401",episodes:[3,12]},{nodePort:"10402",episodes:[13,20]},{nodePort:"10403",episodes:[21,40]},{nodePort:"10404",episodes:[41,60]},{nodePort:"10405",episodes:[61,80]},{nodePort:"10406",episodes:[81,90]},{nodePort:"10407",episodes:[91,120]},{nodePort:"10408",episodes:[121,150]},{nodePort:"10409",episodes:[151,190]},{nodePort:"10410",episodes:[191,220]},{nodePort:"10411",episodes:[221,240]},{nodePort:"10412",episodes:[241,260]},{nodePort:"10413",episodes:[261,310]},{nodePort:"10414",episodes:[311,2e3]}],prizes:[[{type:"powerUp",name:"deleteCellPowerUp",amount:1,cssClass:"deleteCellPowerUp"},{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"shufflePowerUp"},{type:"powerUp",name:"lightingPowerUp",amount:1,cssClass:"lightingPowerUp"}],[{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"shufflePowerUp"},{type:"powerUp",name:"lightingPowerUp",amount:1,cssClass:"lightingPowerUp"}],[{type:"powerUp",name:"deleteCellPowerUp",amount:1,cssClass:"deleteCellPowerUp"},{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"shufflePowerUp"}]]}],welcomeBackGift:{type:"good",good:"unlimitedLifes",amount:24},requiredModernizrTests:["canvas"],mobilePromo:{links:{android:"https://play.google.com/store/apps/details?id=com.orangeapps.piratetreasure",windowsPhone:"http://www.windowsphone.com/s?appid=9281ebd3-0cb1-4e07-83da-da3d0da3cbd9",iphone:"https://itunes.apple.com/ru/app/pirates-treasures/id990972073?l=ru&ls=1&mt=8"},prize:500},RPGPromoEnabled:!1,punish:{showAfterMovesAmount:7,appearTimeout:1500,minLevel:35},cellWidth:59,cellHeight:59,basePhotoSize:40,episodeLockedWindowPhotoSize:36,RPGLink:{test:"//vk.com/app4840912",vkontakte:"//vk.com/app4840912",odnoklassniki:"//ok.ru/game/sealegends",mailru:"//my.mail.ru/apps/731697"}[network],statistics:{general:!0,fps:!0,loadTime:!0,throttle:.05},rows:9,cols:9,levelsInEpisode:20,maxLives:7,lifeRestoreTime:1800,lifeRefillPrice:300,collectCoinsFromFriend:10,collectCoinsFromFriendDayAmount:6,upFriendsNotifMinLevel:3,maxLifesGiftOneTime:"facebook"===network?49:10,maxFriendsInviteOneTime:"facebook"===network?49:10,everyEpisodeOwnPublicationImage:!0,prizeClosedWindowEnabled:!0,openGraphEnabled:!0,amountMovesByInviteFriend:3,amountBombMovesByInviteFriend:3,crystalProbability:20,bonusLevelRefreshTime:14400,bonusLevelBuyTimeAmount:30,bonusLevelStars:30,treasuresInRowInWindow:4,treasuresRowsInWindow:3,boxForceLevel:6,boxForceMaxLevel:10,makeGiftLevel:10,congratesLevel:30,timeActions:[{name:"limitedAction",episode:2,level:1,product:"limited_pack",maxOffersAmount:3,begin:new Date("2022/07/21 00:00:00"),end:new Date("2022/07/24 00:00:00"),duration:86400,forNotPaid:!0,windowOptions:{title:"limitedActionTitle",oldPriceText:"limitedActionOldPriceText",timerText:"limitedActionTimerText",amountPrefix:"x",packAmountText:"limitedActionPackAmount"}}],everydayBonus:{episode:1,level:2,prizes:[{products:[{type:"coins",amount:50}]},{products:[{type:"coins",amount:100}]},{products:[{type:"coins",amount:200}]},[{products:[{type:"powerUp",name:"deleteCellPowerUp",amount:1,minLevel:5},{type:"tickets",amount:2}]},{products:[{type:"coins",amount:250},{type:"tickets",amount:2}]}],[{products:[{type:"spins",amount:1,minLevel:24},{type:"tickets",amount:5}]},{products:[{type:"coins",amount:300},{type:"tickets",amount:5}]}]]},withoutLoseSeriaCalc:{episode:2,level:1},likeWindowAvailable:{episode:3,level:10,networks:[]},saveBeginStats:!0,belkaAppName:"treasure",belkaSendLevel:10,stripBonus:[500,800],coinsForInvite:300,gullAppearEpisode:93,gullAppearLevel:1,crabMouseFarmAppearEpisode:96,crabMouseFarmAppearLevel:1,gacha:{sectors:[{type:"powerUps",powerUps:["shufflePowerUp"],amount:1,cssClass:"gachaShuffleItem"},{type:"good",name:"unlimitedLifes",amount:1,cssClass:"gachaUnlimitedLifes"},{type:"good",name:"starInField",amount:1,cssClass:"gachaStarInField"},{type:"coins",amount:500,cssClass:"gachaCoinsItem"},{type:"coins",amount:200,cssClass:"gachaFailItem"},{type:"powerUps",powerUps:["deleteRowPowerUp"],amount:1,cssClass:"gachaDeleteRow"},{type:"powerUps",powerUps:["deleteCellPowerUp"],amount:1,cssClass:"gachaHammerItem"},{type:"coins",amount:200,cssClass:"gachaFailItem"},{type:"powerUps",powerUps:["lightingPowerUp"],amount:1,cssClass:"gachaLightingItem"},{type:"good",name:"addThreeMoves",amount:1,cssClass:"gachaAddThreeMoves"},{type:"coins",amount:200,cssClass:"gachaFailItem"},{type:"powerUps",powerUps:["deleteCellPowerUp"],amount:1,cssClass:"gachaHammerItem"}],price:300,type:"product",product:"gacha",episode:2,level:3},goods:{unlimitedLifes:{productId:1,workHours:72,viewClass:UnlimitedLifesView},starInField:{productId:2,workHours:72,viewClass:GoodInShopView,shopWindowPage:2},addThreeMoves:{productId:3,workHours:24,viewClass:GoodInShopView,shopWindowPage:1},unlimitedKeys:{productId:4,workHours:240,viewClass:GoodInShopView,shopWindowPage:0},unlimitedBonusWorldLives:{productId:5,workHours:.2,noPromo:!0,world:"springworld",viewClass:UnlimitedBonusWorldLivesView},unlimitedBonusWorldLives2:{productId:6,workHours:.2,noPromo:!0,world:"SummerFishing",viewClass:UnlimitedBonusWorldLivesView},unlimitedFirstBonusWorldLives:{productId:7,workHours:.2,noPromo:!0,world:"firstbonusworld2",viewClass:UnlimitedBonusWorldLivesView},unlimitedBonusWorldLives3:{productId:8,workHours:.2,noPromo:!0,world:"easterbanquet",viewClass:UnlimitedBonusWorldLivesView}},goodsPromo:{starInField:{product:"starInFieldDay"},addThreeMoves:{product:"addThreeMoves"},unlimitedKeys:{product:"unlimitedKeys"}},friendsHelpMoves:3,lockEpisodeShow:!0,superOffer:{episode:3,level:1,showAfterNotPayDays:14},outOfMoves:{price:300,upPrice:200,moves:10,movesByAd:3,countAd:2},bombExplode:{price:300,upPrice:200,moves:5,movesByAd:3,countAd:1},popUpColor:{price:300,upPrice:200},hunter:{price:300,upPrice:200},lessMovesAmount:5,boxBlinkEnabled:!0,prizes:[{cssSelector:"#box1",requiredStars:20,oneOfManyGame:!0,openAnimationTimeout:250,variants:[{coins:500,set:1},{coins:200,powerUps:[{powerUp:"deleteCellPowerUp",powerUpAmount:1,available:16}],set:11},{powerUps:[{powerUp:"deleteRowPowerUp",powerUpAmount:1,available:16}],goods:[{good:"unlimitedLifes",goodHours:1}],set:18},{gacha:1,set:9},{coins:200,powerUps:[{powerUp:"shufflePowerUp",powerUpAmount:1,available:11}],set:10},{powerUps:[{powerUp:"deleteRowPowerUp",powerUpAmount:1,available:6}],set:19},{powerUps:[{powerUp:"shufflePowerUp",powerUpAmount:1,available:11},{powerUp:"deleteCellPowerUp",powerUpAmount:1,available:6}],set:14},{powerUps:[{powerUp:"lightingPowerUp",powerUpAmount:1,available:16}],set:21},{powerUps:[{powerUp:"lightingPowerUp",powerUpAmount:1,available:16}],goods:[{good:"unlimitedLifes",goodHours:1}],set:20}]},{cssSelector:"#box2",requiredStars:40,oneOfManyGame:!0,openAnimationTimeout:250,variants:[{coins:800,set:1},{coins:300,goods:[{good:"unlimitedLifes",goodHours:1}],set:3},{coins:300,goods:[{good:"unlimitedLifes",goodHours:2}],set:3},{powerUps:[{powerUp:"lightingPowerUp",powerUpAmount:1,available:6}],goods:[{good:"starInField",goodHours:1}],set:23},{coins:200,gacha:1,set:2},{powerUps:[{powerUp:"deleteCellPowerUp",powerUpAmount:1,available:6},{powerUp:"deleteRowPowerUp",powerUpAmount:1,available:16},{powerUp:"shufflePowerUp",powerUpAmount:1,available:11}],set:22},{powerUps:[{powerUp:"deleteCellPowerUp",powerUpAmount:1,available:6},{powerUp:"lightingPowerUp",powerUpAmount:1,available:16},{powerUp:"shufflePowerUp",powerUpAmount:1,available:11}],set:7},{coins:300,goods:[{good:"starInField",goodHours:2}],set:6},{powerUps:[{powerUp:"deleteRowPowerUp",powerUpAmount:1,available:16}],goods:[{good:"addThreeMoves",goodHours:1}],set:24}]},{cssSelector:"#box3",requiredStars:60,oneOfManyGame:!0,openAnimationTimeout:250,variants:[{coins:1500,set:1},{coins:800,gacha:1,set:2},{coins:800,goods:[{good:"unlimitedLifes",goodHours:2}],set:3},{coins:600,goods:[{good:"unlimitedLifes",goodHours:4}],set:3},{powerUps:[{powerUp:"deleteCellPowerUp",powerUpAmount:1,available:6},{powerUp:"lightingPowerUp",powerUpAmount:1,available:16},{powerUp:"deleteRowPowerUp",powerUpAmount:1,available:16},{powerUp:"shufflePowerUp",powerUpAmount:1,available:11}],set:26},{goods:[{good:"starInField",goodHours:2},{good:"unlimitedKeys",goodHours:24}],set:5},{coins:400,goods:[{good:"addThreeMoves",goodHours:2}],set:12},{coins:400,goods:[{good:"starInField",goodHours:2}],set:6},{coins:400,gacha:2,set:13}]}],thimblePrize:{oneOfManyGame:!0,openAnimationTimeout:1e3,shuffleAnimationTimeout:2e3,variants:[{coins:500},{powerUp:"lightingPowerUp",powerUpAmount:1},{good:"starInField",available:10}]},simpleCrossPromo:[{id:"legendary",enabled:!1,minLevel:43,requiredGender:0,targetLink:{test:"https://apps.facebook.com/legendaryarena",vkontakte:"https://vk.com/app5631487_82709542",odnoklassniki:"https://ok.ru/game/legendaryarena",facebook:"https://apps.facebook.com/legendaryarena"}},{id:"candy2",enabled:!1,minLevel:45,targetLink:{test:"https://apps.facebook.com/raspjam?our_source=pirates",facebook:"https://apps.facebook.com/raspjam?our_source=pirates"},fullLink:!0,includePaid:!0,oncePerDay:!0,randomCss:["first","second"]},{id:"melonsplash",enabled:!1,minLevel:43,includePaid:!1,targetLink:{test:"https://ok.ru/game/melonsplash",odnoklassniki:"https://ok.ru/game/melonsplash"},fullLink:!0,randomCss:["first","second"]}],suggestTimeout:3e3,interstitialEnable:!0,shopAvailable:{level:16,episode:1},myAchievmentsAvailable:{level:1,episode:1},collectCoinsAvailable:{level:12,episode:1},shopRecommened:!1,shopProducts:[[{name:"unlimitedKeys",type:"money",tpl:"rumProduct"},{name:"refillKeys",price:function(){return user.getUnlockKeyPrice()},type:"coins",tpl:"rumProduct"}],[{name:"addThreeMoves",giftId:-1!=["test","vkontakte","odnoklassniki","mailru"].indexOf(network)&&"gift_addThreeMoves",type:"money",tpl:"specialProduct"}],[{name:"starInFieldDay",giftId:-1!=["test","vkontakte","odnoklassniki","mailru"].indexOf(network)&&"gift_starInFieldDay",type:"money",tpl:"specialProduct"}],[{name:"shopItem1",addPowerUps:["deleteCellPowerUp","shufflePowerUp"],addPowerUpAmount:5,price:3200,type:"coins",discount:8,tpl:"boostersProduct"},{name:"shopItem2",addPowerUps:["deleteCellPowerUp","lightingPowerUp"],addPowerUpAmount:6,price:4300,type:"coins",discount:10,tpl:"boostersProduct"},{name:"shopItem3",addPowerUps:["shufflePowerUp","deleteRowPowerUp"],addPowerUpAmount:7,price:5300,type:"coins",discount:15,tpl:"boostersProduct"}]],listPowerUps:function(){return[new DeleteCell({id:"deleteCellPowerUp",price:300,available:5}),new Shuffle({id:"shufflePowerUp",price:400,available:7}),new DeleteColumn({id:"lightingPowerUp",price:500,available:10}),new DeleteRow({id:"deleteRowPowerUp",price:500,available:11})]},forceCodes:{shopForce:0,collectCoinsForce:1,gachaForce:2,bonusLevelForce:3,stripForce:4,boxForce:5,deleteCellPowerUp:6,shufflePowerUp:7,lightingPowerUp:8,additionalLifesForce:9,forceLevelSuperTile:10,deleteRowPowerUp:11,addThreeMoves:16},powerUpIdsOrder:["deleteCellPowerUp","shufflePowerUp","lightingPowerUp","deleteRowPowerUp"],initialize:function(){(CellsRegistry=new CellsRegistryClass).registerCellType("RGBYPW.",Cell),CellsRegistry.registerCellType("N",Cell,["well"]),CellsRegistry.registerCellType("U",Cell,["palm"]),CellsRegistry.registerCellType("#",WallCell,["wall","splash"]),CellsRegistry.registerCellType("`",HunterTargetCell,["huntertarget"]),CellsRegistry.registerCellType(">",GravityCell,["gravity","clocktower"]),CellsRegistry.registerCellType("%",CannonCell,["cannon"]),CellsRegistry.registerCellType("-|+",ArrowCell),CellsRegistry.registerCellType("@",MultiColorCell),CellsRegistry.registerCellType("",FrogCell,["frog"]),CellsRegistry.registerCellType("",FrogTargetCell,["frog"]),CellsRegistry.registerCellType(FrogFuelCell.chars,FrogFuelCell,["frog"]),CellsRegistry.registerCellType("F",FishCell,["fish"]),CellsRegistry.registerCellType("g",FishCell,["fish2"]),CellsRegistry.registerCellType("h",FishCell,["fish3"]),CellsRegistry.registerCellType("j",FishCell,["fish4"]),CellsRegistry.registerCellType("k",FishCell,["fish5"]),CellsRegistry.registerCellType("l",FishCell,["fish6"]),CellsRegistry.registerCellType("b",FishCell,["fish7"]),CellsRegistry.registerCellType("n",FishCell,["fish8"]),CellsRegistry.registerCellType("c",FishCell,["fish9"]),CellsRegistry.registerCellType("u",FishCell,["fish10"]),CellsRegistry.registerCellType("D",FishCell,["fish11"]),CellsRegistry.registerCellType("",FishCell,["boy"]),CellsRegistry.registerCellType("zxvm",PearlCell,["pearl","seashell_fall"]),CellsRegistry.registerCellType("opa",ParrotCell,["parrot"]),CellsRegistry.registerCellType("fJS",TurtleCell,["tortoise","seashell_fall"]),CellsRegistry.registerCellType("~",SharkCell,["shark"]),CellsRegistry.registerCellType("we",WellCell,["well","splash"]),CellsRegistry.registerCellType("q",BossCell,["life","boss"]),CellsRegistry.registerCellType("/",GenryMorganCell,["life","genrymorgan"]),CellsRegistry.registerCellType("X",BombCell,["bomb"]),CellsRegistry.registerCellType("!",BombAutoNewCell,["bomb"]),CellsRegistry.registerCellType("V",ChocolateFarmCell,["chocolatefarm","chocolate"]),CellsRegistry.registerCellType("M",SpiderwebFarmCell,["spiderwebfarm","spiderweb"]),CellsRegistry.registerCellType("Q",CrabFarmCell,["crabfarm","crab","crabdie"]),CellsRegistry.registerCellType("",CrabMouseFarmCell,["crabmousefarm","crabmouse","bulbremove","life"]),CellsRegistry.registerCellType("Z",TornadoCell,["tornado"]),CellsRegistry.registerCellType("I",PizzaLUCell,["pizza","crabdie","medusa"]),CellsRegistry.registerCellType("O",PizzaRUCell,["pizza","crabdie","medusa"]),CellsRegistry.registerCellType("K",PizzaLDCell,["pizza","crabdie","medusa"]),CellsRegistry.registerCellType("L",PizzaRDCell,["pizza","crabdie","medusa"]),CellsRegistry.registerCellType("A",CrystalCell,["bonuslevel"]),CellsRegistry.registerCellType("H",PumpkinCell,["pumpkin"]),CellsRegistry.registerCellType("E",GhostCell,["ghost"]),CellsRegistry.registerCellType("t",SkatCell,["skat","life","skateat"]),CellsRegistry.registerCellType("ryi",BulbCell,["bulb","bulbremove"]),CellsRegistry.registerCellType(EggCell.chars,EggCell,["egg"]),CellsRegistry.registerCellType("6",FlowerLUCell,["flower","crabdie"]),CellsRegistry.registerCellType("7",FlowerRUCell,["flower","crabdie"]),CellsRegistry.registerCellType("8",FlowerLDCell,["flower","crabdie"]),CellsRegistry.registerCellType(MouseFarmCell.chars,MouseFarmCell,["mouseFarm","farm","crabmousefarm","crabmouse","life"]),CellsRegistry.registerCellType("9",FlowerRDCell,["flower","crabdie"]),CellsRegistry.registerCellType("^",PalmCell,["palm","skateat"]),CellsRegistry.registerCellType("",ChestCell,["chest"]),CellsRegistry.registerCellType("",MedusaCell,["medusa","life","seashell_fall","snowmandamage"]),CellsRegistry.registerCellType(FishBallCell.SYMBOL,FishBallCell,["fishBall","life"]),CellsRegistry.registerCellType("",BigChestCell,["bigchest","skateat"]),CellsRegistry.registerCellType("",CoinChestCell,["coinchest","bigchest","skateat","coin"]),CellsRegistry.registerCellType(MagnetoCell.chars,MagnetoCell,["magneto","skateat"]),CellsRegistry.registerCellType(CaviarCell.chars,CaviarCell,["caviar","splash"]),CellsRegistry.registerCellType(PopUpColorCell.chars,PopUpColorCell,["popupcolor"]),CellsRegistry.registerCellType(CandyCell.chars,CandyCell,["candy","soundcandy"]),CellsRegistry.registerCellType(GroundCell.chars,GroundCell,["ground","bulb","catacomb","floor"]),CellsRegistry.registerCellType(FishnetCell.chars,FishnetCell,["fishnet"]),CellsRegistry.registerCellType(MermaidCell.chars,MermaidCell,["mermaid","life"]),CellsRegistry.registerCellType(FlamyCell.chars,FlamyCell,["flamy","life"]),CellsRegistry.registerCellType(EaterStarsCell.chars,EaterStarsCell,["eaterstars","life"]),CellsRegistry.registerCellType(MermaidPearlCell.chars,MermaidPearlCell,["mermaid"]),CellsRegistry.registerCellType(SeaweedKeyCell.chars,SeaweedKeyCell,["seaweed","soundcandy"]),CellsRegistry.registerCellType(MagicWandCell.chars,MagicWandCell,["magicwand"]),CellsRegistry.registerCellType(BarCell.chars,BarCell,["bar","chocolate"]),CellsRegistry.registerCellType(SeaHorseCell.chars,SeaHorseCell,["seahorse"]),CellsRegistry.registerCellType(GravityCoreCell.chars,GravityCoreCell,["gravitycore"]),CellsRegistry.registerCellType(BlackHoleCell.chars,BlackHoleCell,["blackhole","coralsound"]),CellsRegistry.registerCellType(CoralCell.chars,CoralCell,["coral","coralsound"]),CellsRegistry.registerCellType(ShooterCell.chars,ShooterCell,["shooter","monkey"]),CellsRegistry.registerCellType(ActiveShooterCell.chars,ActiveShooterCell,["activeshooter","shooter","monkey"]),CellsRegistry.registerCellType(FireFlowerCell.chars,FireFlowerCell,["fireFlower"]),CellsRegistry.registerCellType(TwinkleCell.chars,TwinkleCell,["twinkle"]),CellsRegistry.registerCellType(BugCell.chars,BugCell,["bug"]),CellsRegistry.registerCellType(StrongboxCell.chars,StrongboxCell,["strongbox"]),CellsRegistry.registerCellType(ArtifactPartCell.chars,ArtifactPartCell,["artifactpart"]),CellsRegistry.registerCellType("",IcebergCell,["iceberg","floor","frozenegg"]),CellsRegistry.registerCellType("",MuffinRackCell,["muffinrack"]),CellsRegistry.registerCellType(GravityGroundCell.chars,GravityGroundCell,["ground","bulb","catacomb","floor"]),CellsRegistry.registerCellType(PastureCell.chars,PastureCell,["pasture"]),CellsRegistry.registerCellType(GemStealerCell.chars,GemStealerCell,["gemstealer"]),CellsRegistry.registerCellType(ChestWithKeysCell.chars,ChestWithKeysCell,["chestWithKeys"]),CellsRegistry.registerCellType(ChestKeyCell.chars,ChestKeyCell,["chestKey"]),CellsRegistry.registerCellType(SeagullRockCell.chars,SeagullRockCell,["seagullRock"]),CellsRegistry.registerCellType(FortCell.chars,FortCell,["fort"]),CellsRegistry.registerCellType(GlowwormCell.chars,GlowwormCell,["glowworm"]),CellsRegistry.registerCellType(VaseBoxCell.chars,VaseBoxCell,["vasebox"]),CellsRegistry.registerCellType(BoxCell.chars,BoxCell,["box"]),CellsRegistry.registerCellType("",ManyCells),CellsRegistry.registerCellType(AnemoneCell.chars,AnemoneCell,["anemone"]),"wizq"!==network&&"spmobage"!==network||(Config.gacha.episode=!1,Config.gacha.level=!1,Config.gacha.type="coins"),Preloader.Config["cellAttribute_*"]=["key","bonuslevel0"],Preloader.Config.cellAttribute_$=["coin"],Preloader.Config.cellAttribute__=["falling"],Preloader.Config["cellSecondAttribute_"]=["prizePointMark"],"".split("").forEach(function(e){Preloader.Config["cellAttribute_"+e]=["girl"]}),Preloader.Config.floorAttribute_1=["floor"],Preloader.Config.floorAttribute_2=["floor"],Preloader.Config.floorAttribute_3=["floor"],HideDecorator.SYMBOL.split("").forEach(function(e){Preloader.Config["decorators_"+e]=["hide","chain"]}),BlockedDecorator.SYMBOL.split("").forEach(function(e){Preloader.Config["decorators_"+e]=["blocked","chain"]}),StickyChainDecorator.SYMBOL.split("").forEach(function(e){Preloader.Config["decorators_"+e]=["stickychain"]}),HunterDecorator.SYMBOL.split("").forEach(function(e){Preloader.Config["decorators_"+e]=["hunter"]}),Preloader.Config.decorators_R=["blocked","chain"],Preloader.Config["decorators_#"]=["chocolate"],Preloader.Config.decorators_C=["crab","crabdie"],Preloader.Config.decorators_M=["crab2","crab","crabdie"],Preloader.Config.decorators_Y=["crabmouse","bulbremove","life"],Preloader.Config["decorators_"]=["crabmouse","bulbremove","life"],Preloader.Config["decorators_"]=["crabmouse","bulbremove","life"],Preloader.Config["decorators_"]=["crabmouse","bulbremove","life"],Preloader.Config["decorators_:"]=["crabmedusa"],Preloader.Config["decorators_{"]=["crabmedusa"],Preloader.Config["decorators_}"]=["crabmedusa"],Preloader.Config["decorators_["]=["crabmedusa"],Preloader.Config["decorators_]"]=["crabmedusa"],Preloader.Config.decorators_q=["spiderweb"],Preloader.Config.decorators_E=["crabice","snowmandamage"],Preloader.Config.decorators_T=["crabice2","crabice","snowmandamage"],Preloader.Config.decorators_W=["crabbomb","crabice2","crabice","bomb"],Preloader.Config.decorators_l=["changecolor"],Preloader.Config["decorators_"]=["monkey"],Preloader.Config.decorators_P=["coin","greedypirate"],Preloader.Config["decorators_"]=["eel"]},gameControllers:function(){SwapMoveController()},tasks:{CollectColor:{name:"",cssClass:"CollectColor"},CollectType:{name:"",cssClass:"CollectType"},CollectBug:{name:"",cssClass:"CollectBug"},ClearCellAttributes:{name:" ",cssClass:"CollectRoll"},ClearCoinCellAttributes:{name:"",cssClass:"CollectCoin"},ClearFallingCellAttributes:{name:"  ,  ",cssClass:"CollectFallingAttribute"},ClearFloorAttributes:{name:"",cssClass:"CollectMap"},CollectCrystals:{name:"",cssClass:"CollectCrystals"},CollectPearl:{name:"",cssClass:"CollectPearl"},CollectParrot:{name:"",cssClass:"CollectParrot"},CollectFrogTarget:{name:"",cssClass:"CollectFrogTarget"},CollectTurtle:{name:" ",cssClass:"CollectTurtle"},CollectComplexTask:{name:"  ",cssClass:"CollectComplexTask"},CollectComplexCellAttributes:{name:"  ",cssClass:"CollectComplexCellAttributes"},CollectFrog:{name:" ",cssClass:"CollectFrog"},CollectFishBall:{name:" ",cssClass:"CollectFishBall"},CollectFrozen:{name:"",cssClass:"CollectFrozen"},CollectCaviar:{name:"",cssClass:"CollectCaviar"},CollectPopUpColor:{name:"",cssClass:"CollectPopUpColor"},MermaidCollect:{name:"MermaidCollect",cssClass:"MermaidCollect"},MermaidPearlCollect:{name:"MermaidPearlCollect",cssClass:"MermaidPearlCollect"},FlamyCollect:{name:"FlamyCollect",cssClass:"FlamyCollect"},BugCollect:{name:"BugCollect",cssClass:"BugCollect"},CollectCrabBomb:{name:"CollectCrabBomb",cssClass:"CollectCrabBomb"},CollectShooter:{name:"CollectShooter",cssClass:"CollectShooter"},CollectFireFlower:{name:"  ",cssClass:"CollectFireFlower"},CollectTwinkle:{name:"  ",cssClass:"CollectTwinkle"},CollectStrongbox:{name:"      ",cssClass:"StrongboxCellLoot"},CollectMuffin:{name:"  ",cssClass:"MuffinRackCellLoot"},CollectGemStealer:{name:"  -",cssClass:"CollectGemStealer"},CollectChestWithKeys:{name:"   ",cssClass:"ChestWithKeysCell"},CollectSeagullOnRock:{name:"    ",cssClass:"SeagullRockCell"},CollectFort:{name:"  ",cssClass:"FortCell"},CollectDecorator:{name:" ",cssClass:"CollectDecorator"},CollectEelDecorator:{name:"  ",cssClass:"CollectEelDecorator"},CollectPizzaCell:{name:"  ",cssClass:"CollectPizzaCell"},CollectGlowworm:{name:"  ",cssClass:"CollectGlowworm"},CollectVase:{name:" ",cssClass:"CollectVase"},CollectClownFish:{name:" -",cssClass:"CollectClownFish"}},errorThrottle:.1,overtakenAndChampionWindowsMinLevel:5,unlimMiniTest:!0,returnReward:{rewards:[{daysCount:1,name:"returnReward_1days"},{daysCount:3,name:"returnReward_3days"},{daysCount:7,name:"returnReward_7days",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"15m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"15m"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]},{daysCount:14,name:"returnReward_14days",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"2h"}]},{daysCount:28,name:"returnReward_28days",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"6h"},{type:"CoinsProduct",amount:500},{type:"SpinProduct",amount:1}]},{daysCount:60,name:"returnReward_60days",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"CoinsProduct",amount:1e3},{type:"SpinProduct",amount:1}]}],notificationTime:"20:30"},notificator:function(){switch(network){case"vk":return new VKNotification({network:"vk",host:"https://notifier.gems.g.tapclap.com",salt:"sd5fsdf7fs"});case"odnoklassniki":return new OdnoklassnikiNotification({network:"odnoklassniki",host:"https://notifier.gems.g.tapclap.com",salt:"sd5fsdf7fs"});default:return null}},thousandthLevelPrizes:{common:[{type:"BoosterProduct",boosterId:"DeleteCell",amount:1},{type:"BoosterProduct",boosterId:"DeleteColumn",amount:1},{type:"BoosterProduct",boosterId:"Shuffle",amount:1}],9000:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:1800},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1}],10000:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:7200},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:7200}]},botsLocaleByDefault:"en"},Direction={top:1,right:2,bottom:4,left:8,up:1,down:4,horizontal:10,vertical:5},DirectionDiv=[];DirectionDiv[Direction.top]={x:0,y:-1},DirectionDiv[Direction.bottom]={x:0,y:1},DirectionDiv[Direction.left]={x:-1,y:0},DirectionDiv[Direction.right]={x:1,y:0};var DirectionName=[];DirectionName[Direction.top]="top",DirectionName[Direction.bottom]="bottom",DirectionName[Direction.left]="left",DirectionName[Direction.right]="right",Config.unlockEpisodePrice=function(){for(var e=0;e<Config.shopProducts.length;e++)for(var t=0;t<Config.shopProducts[e].length;t++)if("refillKeys"==Config.shopProducts[e][t].name)return _.result(Config.shopProducts[e][t],"price");return 1e3},"yahoo"===network&&(Config.outOfMoves.product="addMoves"),Application.prototype.initComponents=function(){var e=rules.CommonRule,t=rules.IsSubscribed,i=rules.IsNotSubscribed,o=rules.EveryDayBonusCollected,a=rules.OrRule;this.addComponent(new WorldsComponent(WorldsConfig())),this.addComponent(new OuterParamComponentSwitcher({items:[{rules:[e({network:["odnoklassniki"]})],item:new OdkOuterParamsComponent},{rules:[e({network:["vkontakte"]})],item:new VKOuterParamsComponent},{rules:[],item:new FromLocationHashParamsComponent}]})),this.addComponent(new ApplicationOffersComponent),this.addComponent(new ApplicationHelpStuckFriendsComponent),this.addComponent(createInterstitialAdComponent()),this.addComponent(new AnalyticsComponent({platform:"social_"+network,host:"https://gems-statistics.g.tapclap.com",host2:"https://gems-statisticsv2.g.tapclap.com"})),application.addComponent(new ActionManagerComponent({id:"actionManager",activators:ActionActivatorsConfig,actions:ActionsConfig})),this.addComponent(new ShowActionComponent({items:[new ShowAction({actionName:"subscription_premium",activator:new EventActivator("ready"),enabled:!0,hideEvent:"subscribed",forced:!0,offerIds:["premium2week","premium4week"],window:PaymentSubscriptionWindow,windowOptions:{offerIds:["premium2week","premium4week"],prize:Config.premiumPrize},showWindowEvent:"getDailyPrize",shieldForWindows:[new PaymentSubscriptionWindowShield("tileShopWindow"),new PaymentSubscriptionAddLivesShield("addLifesWindow")],rules:[e({minLevel:20,network:["test","odnoklassniki"]}),i("premium2week"),i("premium4week")]}),new ShowAction({actionName:"subscription_premium_reward",activator:new EventActivator("ready subscribed"),enabled:!0,shieldForWindows:[new PaymentSubscriptionPrizeTimerShield("tileShopWindow")],rules:[e({minLevel:20,network:["test","odnoklassniki"]}),o(),a(t("premium2week"),t("premium4week"))]})]})),this.addComponent(new DispatcherComponent({items:[{activator:new EventActivator("ready subscribed"),strategy:new LivesStrategy({premiumMaxLives:10,defaultMaxLives:7,rules:[e({network:["test","odnoklassniki"]}),a(t("premium2week"),t("premium4week"))]})},{activator:new EventActivator("getDailyPrize subscribed"),strategy:new PrizesStrategy({prize:Config.premiumPrize,rules:[e({network:["test","odnoklassniki"]}),a(t("premium2week"),t("premium4week"))]})},{activator:new WithParamActivator("prize_link"),strategy:new ViaLinkPrizeStrategy({actionKeyParam:"prize_link",paramSrc:application.cmp("outerParams"),rules:[]})}]})),this.addComponent(new TimeNotificationComponent),this.addComponent(new ReturnRewardComponent(_.extend(Config.returnReward,{beforeShowWindow:function(){application.getComponent(ShowActionComponent)&&application.getComponent(ShowActionComponent).getAction("subscription_premium")&&application.getComponent(ShowActionComponent).getAction("subscription_premium").disable()}})))},Config.episodesAmount=503,Config.freeEpisodeName="openseaworld",Config.episodesAvailables=[{network:"mixi",amount:503},{network:"yahoojp",amount:503},{network:"hangame",amount:503},{network:"spmobage",amount:503},{network:"facebook",amount:503},{network:"nk",amount:378},{network:"draugiem",amount:503},{network:"yahoo",amount:127},{amount:503}],Config.forces=[StripForce,GemsShopForce,AddThreeMovesForce,CollectCoinsForce,GachaForce,BonusLevelForce,BoxForce],Config.bonusWorldsForces=[],Config.offers=[],Config.sounds={rewardChainmusic:"mainmusic",shooterMove:"spiderwebremove",carnivores:"carnivores",countdown:"countdown",tournamentPrizeWindow:"championwindow",giftUserNotSelected:"message",giftSended:"championwindow",giftReceived:"championwindow",medusaMove:"meduza_move",medusaDie:"seashell_fall",medusaDamage:"snowmandamage",chestOpen:"star3",chestOpened:"multicolorcollect",chestStarCreated:"explode1",oneOfManyBoxOpen:"showfield",oneOfManyBoxOpened:"finishwindow",oneOfManyWindowOpen:"gachawin",RPGReceiveMap:"showfield",crabMedusaMove:"medusaMove",crabMedusaRemove:"medusaRemove",removePearl:"seashell_fall",pearlTakeLevel:"seashell_open",removeParrot:"parrotremove",parrotTakeLevel1:"parrottakelife1",parrotTakeLevel2:"parrottakelife2",removeCatbox:"meau",catboxTakeLevel1:"meau",catboxTakeLevel2:"meau",removeTurtle:"seashell_fall",turtleTakeLevel1:"turtletakelife1",turtleTakeLevel2:"turtletakelife1",skatTakeLevel:"skateatarrow",fiveFigureRemove:"multicolorcollect",taskCompleted:"message",eggCollected:!1,skatEatArrow:"skateatarrow",dieSkat:"dieskat",bulbTakeLife:"bulbtakelife",bulbRemove:"bulbremove",clearCellAttribute:!1,spratFull:"spratfull",spratHalf:"sprathalf",spratFly:"spratfly",usePowerUpSound:"message",collectCrystalsTick:"fisheating",afterTornadoCellRemove:"aftertornado",crabFarmCellCreateCrab:"crabmove",crystalCellRemove:"explode1",crab2DecoratorRemove:"crabdie",crabDecoratorRemove:"crabdie",crabIce2DecoratorRemove:"createice",crabIceDecoratorDie:"snowmandeath",crabIceDecoratorOccupied:"createice",crabIceDecoratorRemove:"snowmandamage",crabBombDecoratorMove:"bombermanmove",crabBombDecoratorDie:"bombermanlose",crabBombDecoratorRemove:"bombermanhit",crabBombDecoratorBomb:"bombermanset",spiderWebDecoratorRemove:"spiderwebremove",spiderWebDecoratorOccupied:"spiderwebcreate",ghostCellIncLevel:"ghostup",ghostCellUpFish:"ghostmagic",pizzaCellTakeLife:"meduza_move",pizzaCellRemove:"crabdie",flowerCellTakeLife:"flowertakelife",flowerCellRemove:"crabdie",pumpkinCellTakeLife:"gundamage",pumpkinCellRemove:"gundamage",pumpkinCellProcess:"gunfire",sharkCellDamage:"shark_hit",sharkCellEatMove:"shark_attack",tornadoCellMove:"tornadoexplode",tornadoCellProcess:"tornadofly",gameFinalBonus:"finalbonus",gameFinalBonusAddScores:"addscores",bonusLevelPrizeOpen:"buymoves",processStarInField:"magicthing",processAddThreeMoves:"clockappear",processAddThreeMovesAnimation:"clocks",buyGood:"buymoves",buyCoins:"buymoves",buyLives:"buymoves",buyBombMoves:"buymoves",buyMoves:"buymoves",buyShopProduct:"buymoves",collectCoinsFromFriend:"friendcoins",flightCollectedCoinsFromFriend:"coinsfly",swapMove:"swapmove",swapMoveRollback:"swapmove",changeSelected:"click",fallDown:"falldown",showTask:"showtask",addMoves:"getstar",addBombMoves:"getstar",addMovesFromFriend:"message",showTasks:"initialshowtask",showField:"showfield",getStar:"getstar",vortex:"shuffle",gameMessage:"message",episodeLockedWindow:"showwindow",episodeLockedWindowKeysCollected:"buymoves",everydayBonusWindow:"showfield",failedWindowLostLife:"lostlife",gachaWindowPowerUpsPrize:"getstar",gachaWindowGoodPrize:"getstar",gachaWindowPassivesPrize:"getstar",gachaWindowThumbler:"gachathumbler",gachaWindowWhip:"gachawhip",gachaWindowWin:"gachawin",gachaWindowLose:"gachalose",helpFriendsWindowSend:"getstar",noExistingMovesShuffle:"shuffle",clearFloorAttributesTask:"ice",deleteCellExecution:"multicolor",deleteColumnExecution:"lightning",deleteRowExecution:"lightning",deleteCrossExecution:"blaster",fourFigureRemove:"arrowcollect",otherFigureRemove:"doublearrowcollect",arrowCellDoubleLightning:"doublelightning",arrowCellLightning:"lightning",fishCellRemove:"explode1",multiColorCellRemove:"multicolor",wellCellFlyWater:"flywater",wellCellChangeWater:"wellwater",bombCellExplode:"bombexplode",blockedDecoratorRemove:"chain",chocolateDecoratorRemove:"dirtremove",chocolateDecoratorCreate:"dirtcreate",pirateCoinsRelease:"piratecoinsrelease",pirateMove:"piratemove",pirateHit:"piratehit",hunterMove:"parrotjump",hunterHit:"parrothit",hunterGrab:"parrotgrab",hunterBuy:"parrothit",mouseMove:"mousemove",mouseSqueak:"mousesqueak",mouseRemove:"mousesqueak",crabMouseFarmCellCreateCrabMouse:"mousemove",mouseFarmCellCreateItem:"mousemove",monkeyRemove:"monkeyRemove",alligatordamage:"walrusdamage",gullMove:"seagull",lighthousedamage:"takelife",lighthousedeath:"takelife",snakedamage:"walrusdamage",snakedeath:"walrusdeath",palmCellFireAnimation:"skateatarrow",stickyChainDestroy:"chain",fishBallRemove:"s_fish_away",fishBallTakeLevel:"s_fish_hit",fishBallAdd:"s_fish_new",fishBallCollect:!1,bigChestdamage:"skateatarrow",bigChestdeath:"doublearrowcollect",coinChestdamage:"coinsfly",coinChestdeath:"friendcoins",genrymorganDamage:"genrymorgandamage",genrymorganDeath:"genrymorgandeath",genrymorganRightHand:"genrymorganrighthand",genrymorganLeftHand:"genrymorganlefthand",magnetoBzzz:"skateatarrow",maelstorm:"maelstorm",stream:"maelstorm",candyRemove:"candyRemove",candyTakeLife:"candyTakeLife",caviarTakeLife:"flywater",PopUpColor:"CollectPopUpHit",PopUpColorBuy:"buymoves",PopUpColorLose:"CollectPopUpLose",PopUpColorHit:"CollectPopUpHit",PopUpColorShow:"CollectPopUpShow",groundexplode:"bulbtakelife",FishnetRemoveRope:"FishnetRemoveRope",FishnetRelease:"FishnetRelease",MermaidCollect:"MermaidCollect",MermaidRemoval:"MermaidRemoval",seaweedRemove:"candyRemove",seaweedTakeLife:"candyTakeLife",eaterstarsCollect:"eaterstarsCollect",eaterstarsRemoval:"eaterstarsRemoval",magicWandTakeCharge:"arrowcollect",magicWandCharged:"magicWandCharged",magicWandLighting:"magicthing",magicWandUncharged:"magicWandUncharged",clockbite:"clockbite",clockgood:"clockgood",clocktowerBonusWorldFailedWindow:"bonusworldwindow",gravityRotation:"clockbite",cannonRotation:"cannonRotate",cannonBump:"cannonBump",cannonShot:"cannonShot",barLifeRemove:"barLifeRemove",barRemove:"barRemove",seahorse:"seahorse",seahorseBump:"seahorseBump",coralRemove:"coralhit",blackholeRemove:"coralhit",blackholeEat:"blackholechew",blackholeMove:"blackholemove",fireFlowerTakeLife:"fireFlowerTakeLife",fireFlowerAttack:"fireFlowerAttack",frogJump:"frogJump",frogEat:"frogEat",frogFinish:"frogFinish",FlamyCollect:"FlamyCollect",FlamyRemoval:"FlamyCollect",twinkleActivate:"star3",twinkleDeactivate:"star3",removeFrozenEgg:"removeFrozenEgg",warlockmagick:"warlockmagic",mirror:"mirror",babah:"babah",task:"task",muffinrackOpening:"muffinrackOpening",muffinrackRemove:"muffinrackRemove",throwmuffin:"throwmuffin",PastureRemoveSheep:"PastureRemoveSheep",PastureHideSheep:"PastureHideSheep",PastureTakeLife:"PastureTakeLife",gemStealerEating:"gemStealerEating",gemStealerDie:"gemStealerDie",seagullFly:"seagullFly",seagullTask:"seagullTask",seagullHit:"seagullHit",eelTask:"eelTask",eelBabality:"eelBabality",eelHit:"eelHit",fortActivation:"fortActivation",fortTask:"fortTask",collectPart:"task",slotMachineStart:"slotMachineStart",slotMachineSpin:"slotMachineSpin",slotMachineStop:"slotMachineStop",slotMachinePrize:"slotMachinePrize"};var Bots=[{id:-1,name:messages.botsNames[0],photo:"//gems-ok.akamaized.net/gems/gems/site/img/bots/bot1.14bdd7d554.jpg",score:3e3},{id:-2,name:messages.botsNames[1],photo:"//gems-ok.akamaized.net/gems/gems/site/img/bots/bot2.8e7e225d7d.jpg",score:200},{id:-3,name:messages.botsNames[2],photo:"//gems-ok.akamaized.net/gems/gems/site/img/bots/bot3.9b9795abe9.jpg",score:100}],GameScores={cell:100,arrow:300,multicolor:500,floor:1e3,attribute:1e3,attribute_animal:4e3,attributeCoin:500,collectColor:500,pasture:2e3,fish:5e3,fish2:3e3,fish3:2e3,fish4:1e3,fish5:3e3,fish6:3e3,fish7:3e3,fish8:3e3,fish9:3e3,fish10:3e3,fish11:3e3,artifactpart:3e3,leftMove:1e3,bomb:1e3,crab:500,pearl:3e3,shooter:300,boss:5e4,genrymorgan:5e4,coinchest:1e4,bulb:5e3,bossLife:1e3,egg:1e3,flower:1e3,mouse:3e3,crabBomb:500,monkey:3e3,complexTask:3e3,complexCellAtributesTask:3e3,fishBall:1e3,caviar:1e3,fishnet:1e3,frogTarget:1e3,mermaid:1e3,flamy:1e3,mermaidPearl:100,eaterstars:1e3,bar:3e3,blackhole:3e3,coral:1e3,fireFlower:1e3,fireFlowerTakeLife:100,frogfuel:100,glowworm:1500,twinkle:100,strongbox:2e3,twinklesAllActivated:3e3,bug:1e4,iceberg:4e3,muffin:2e3,muffinRack:4e3,gemStealer:3500,chestWithKeys:3e3,chestkey:200,bigChest:5e4,seagull:1600,fort:4e3,eel:2500,blocked:100,hide:100,pizza:3e3,sail:5e3,vaseBoxTakeLife:500,vaseBoxOpen:500,anemone:3e3,clownFish:500},Getter=function(){function t(e){_classCallCheck(this,t),this.func=e}return _createClass(t,[{key:"get",value:function(){return this.func()}}]),t}(),iMa;function _get2(e){return e instanceof Getter?e.get():e}GameClass.prototype.swap=function(e,t){this.field[e.y][e.x]=t;var i=(this.field[t.y][t.x]=e).x;e.x=t.x,t.x=i,i=e.y,e.y=t.y,t.y=i},GameClass.prototype.isNeighbors=function(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)==1},GameClass.prototype.tryMove=function(e,t){if(this.canMove())if(this.has("selected"))if(this.get("selected")!==e){var i=this.get("selected"),o=e;if(i)return this.isNeighbors(i,o)?(canvas.canvas_c.style.cursor="default",this.move({first:i,second:o}),void this.unset("selected")):void(t||this.set("selected",e));this.unset("selected")}else{if(t)return;this.unset("selected")}else{if(t)return;this.set("selected",e)}},GameClass.prototype.isThreeInRow=function(e,t){if(!this.field[t][e])return!1;var i=this.field[t][e].getCurrentColor();return!("none"===i||!i)&&(!!(2<=e&&this.field[t][e-1]&&this.field[t][e-2]&&this.field[t][e-1].getCurrentColor()===i&&this.field[t][e-2].getCurrentColor()===i)||(!!(1<=e&&e<Config.cols-1&&this.field[t][e-1]&&this.field[t][e+1]&&this.field[t][e-1].getCurrentColor()===i&&this.field[t][e+1].getCurrentColor()===i)||(!!(e<Config.cols-2&&this.field[t][e+1]&&this.field[t][e+2]&&this.field[t][e+1].getCurrentColor()===i&&this.field[t][e+2].getCurrentColor()===i)||(!!(2<=t&&this.field[t-1][e]&&this.field[t-2][e]&&this.field[t-1][e].getCurrentColor()===i&&this.field[t-2][e].getCurrentColor()===i)||(!!(1<=t&&t<Config.rows-1&&this.field[t-1][e]&&this.field[t+1][e]&&this.field[t-1][e].getCurrentColor()===i&&this.field[t+1][e].getCurrentColor()===i)||!!(t<Config.rows-2&&this.field[t+1][e]&&this.field[t+2][e]&&this.field[t+1][e].getCurrentColor()===i&&this.field[t+2][e].getCurrentColor()===i))))))},GameClass.prototype.findValidMove=function(){for(var e=0;e<Config.rows;e++)for(var t=0;t<Config.cols;t++)if(this.inField(t,e)){var i;if(this.inField(t+1,e)&&(i={first:this.field[e][t],second:this.field[e][t+1]},this.isRealValidMove(i)))return i;if(this.inField(t,e+1)&&(i={first:this.field[e][t],second:this.field[e+1][t]},this.isRealValidMove(i)))return i}return!1},GameClass.prototype.existValidMove=function(){return!1!==this.findValidMove()},GameClass.prototype.isFiveOrMoreInRow=function(e,t,i){var o=_.groupBy(e,function(e){return e.x*i+e.y*t});for(var a in o){var n=[];if(_.each(o[a],function(e){n.push(e.x*t+e.y*i)}),n.sort(),4<=_.last(n)-_.first(n))return!0}return!1},GameClass.prototype.calcItemsFigure=function(e){if(e[0]instanceof EggCell)return"egg";for(var t=0;t<e.length;t++){if(1<e[t].life)return"three";if(""!==e[t].getDecoratorName()&&!e[t].decorator.get("oneTimeRemove"))return"three"}return 3==e.length?"three":4==e.length?"four":this.isFiveOrMoreInRow(e,1,0)||this.isFiveOrMoreInRow(e,0,1)?"five":"other"},GameClass.prototype.matchSameTypeIsThreeInRow=function(e,t,i){var o=i[t][e];return!("none"===o||!o)&&(2<=e&&i[t][e-1]===o&&i[t][e-2]===o||(1<=e&&e<Config.cols-1&&i[t][e-1]===o&&i[t][e+1]===o||(e<Config.cols-2&&i[t][e+1]===o&&i[t][e+2]===o||(2<=t&&i[t-1][e]===o&&i[t-2][e]===o||(1<=t&&t<Config.rows-1&&i[t-1][e]===o&&i[t+1][e]===o||t<Config.rows-2&&i[t+1][e]===o&&i[t+2][e]===o)))))},GameClass.prototype.matchSameType=function(e,t,i){var o=[],a=0,n=i[t][e];for(i[t][e]=!1,o.push(this.field[t][e]);a<o.length;)e=o[a].x,t=o[a].y,a++,0<e&&i[t][e-1]===n&&(i[t][e-1]=!1,o.push(this.field[t][e-1])),e<Config.cols-1&&i[t][e+1]===n&&(i[t][e+1]=!1,o.push(this.field[t][e+1])),0<t&&i[t-1][e]===n&&(i[t-1][e]=!1,o.push(this.field[t-1][e])),t<Config.rows-1&&i[t+1][e]===n&&(i[t+1][e]=!1,o.push(this.field[t+1][e]));return o},GameClass.prototype.isValidMove=function(e){if(!this.inField(e.first.x,e.first.y)||!this.inField(e.second.x,e.second.y))return!1;if(!e.first.isMovable()||!e.second.isMovable())return!1;if(!(e.first.isRemovable()||e.second.isRemovable()||e.first.color||e.second.color))return!1;this.onlySwap(e);var t=this.isThreeInRow(e.first.x,e.first.y)||this.isThreeInRow(e.second.x,e.second.y);return this.onlySwap(e),t},GameClass.prototype.onlySwap=function(e){this.field[e.first.y][e.first.x]=e.second,this.field[e.second.y][e.second.x]=e.first;var t=e.first.x;e.first.x=e.second.x,e.second.x=t,t=e.first.y,e.first.y=e.second.y,e.second.y=t},GameClass.prototype.baseMakeMove=function(e){this.explodeChocolate=!1,this.explodeSpiderWeb=!1,this.explodeLiana=!1,this.field[e.first.y][e.first.x]=e.second,this.field[e.second.y][e.second.x]=e.first;var t=e.first.x;e.first.setX(e.second.x),e.second.setX(t),t=e.first.y,e.first.setY(e.second.y),e.second.setY(t)},GameClass.prototype.makeMove=function(e){this.baseMakeMove(e)},GameClass.prototype.explode=function(){var e,t,i=[];for(e=0;e<Config.rows;e++)for(i.push([]),t=0;t<Config.cols;t++)i[e].push(!1),this.field[e][t]&&(i[e][t]=this.field[e][t].getCurrentColor());for(e=0;e<Config.rows;e++)for(t=0;t<Config.cols;t++)i[e][t]&&(this.matchSameTypeIsThreeInRow(t,e,i)||(i[e][t]=!1));var o=[];for(e=0;e<Config.rows;e++)for(t=0;t<Config.cols;t++)i[e][t]&&o.push(this.matchSameType(t,e,i));for(e=0;e<o.length;e++)this.processMatch(o[e]);this.trigger("afterExplode")},GameClass.prototype.shuffleField=function(a){for(var e=0,o=[],n=[],t=_.bind(function(e,t){var i=n.pop();(Game.field[e][t]=i).x=t,i.y=e},this),i=_.bind(function(e,t){var i=o.pop();this.trigger("moveCell",i,{x:t*Config.cellWidth,y:e*Config.cellHeight},Game.animate(function(){(Game.field[e][t]=i).setX(t),i.setY(e)},Game))},this),r=function(e){for(var t=0;t<Config.rows;t++)for(var i=0;i<Config.cols;i++)if(Game.field[t][i]&&Game.field[t][i].isMovable()&&!Game.field[t][i].notShuffled){var o=!0;Game.field[t][i]instanceof DroppableCell&&!a&&(o=!1),Game.field[t][i]instanceof EggCell&&!a&&(o=!1),Game.field[t][i]instanceof GravityGroundCell&&!a&&(o=!1),Game.field[t][i]instanceof CandyCell&&(o=!1),o&&e(t,i)}},s=function(e,t){o.push(Game.field[e][t])};o=[],r(s),o=_.shuffle(o),n=_.clone(o),r(t),e++,!this.existValidMove()&&e<100;);this.existValidMove()?(r(i),Game.trigger("vortex",Game.animate())):(user.set({actionName:"no more combinations",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0}),this.exit())},GameClass.prototype.containsRect=function(o){return!this.objects.find(function(e){var t=e.get("width")||1,i=e.get("height")||1;return!(o.x>=e.get("x")+t||e.get("x")>=o.x+o.width||o.y>=e.get("y")+i||e.get("y")>=o.y+o.height)})},GameClass.prototype.createField=(iMa=GameClass.prototype.createField,function(){iMa.call(this);for(var e=0;++e<1e6;){for(var t=!0;t;){t=!1;for(var i=0;i<Config.rows;i++)for(var o=0;o<Config.cols;o++)this.isThreeInRow(o,i)&&(t=!0,this.field[i][o].setRandomColor,this.field[i][o].setRandomColor(!0))}if(!this.noExistingMove(!0))break}}),GameClass.prototype.addItem=function(e,t,i,o,a){void 0===i&&(i=e.y),void 0===a&&(a=e.x),(this.field[i][a]=e).onField=!0,!1!==t&&(e.createDiv(),e.y<0||e.y>Config.rows||e.x<0||e.x>Config.cols?e.$div.css({opacity:0}):e.$div.css({opacity:1})),o&&this.trigger("addItem",e)},GameClass.prototype.fallDown=function(){switch(++Game.actionId,this.set("useFallDownSpecialCells",!0),Game.gravityDirection||"bottom"){case"top":return this.fallDownToTop();case"right":return this.fallDownToRight();case"left":return this.fallDownToLeft()}return this.fallDownToBottom()},GameClass.prototype.fallDownToLeft=function(){var e,t,i=!1;for(e=0;e<=Config.rows-1;e++){var o=0;for(t=0;t<=Config.cols-1;t++)if(this.field[e][t]&&this.field[e][t].isFallDown())for(var a=0;a<t;a++)if(void 0===this.field[e][a]){this.field[e][a]=this.field[e][t],this.field[e][t]=void 0,this.field[e][a].fallDown(e,o,a),o++;break}var n=Config.rows+1;Config.cols;for(t=0;t<=Config.cols-1;t++)void 0===this.field[e][t]&&(i=!0,this.addItem(this.initCellForFallDown(e,n),!0,e,!1,t),this.field[e][t].setX(n),this.field[e][t].fallDown(e,o,t),o++,0,n++)}return i},GameClass.prototype.fallDownToRight=function(){var e,t,i=!1;for(e=Config.rows-1;0<=e;e--){var o=0;for(t=Config.cols-1;0<=t;t--)if(this.field[e][t]&&this.field[e][t].isFallDown())for(var a=Config.cols-1;t<a;a--)if(void 0===this.field[e][a]){this.field[e][a]=this.field[e][t],this.field[e][t]=void 0,this.field[e][a].fallDown(e,o,a),o++;break}var n=-1;for(t=Config.cols-1;0<=t;t--)void 0===this.field[e][t]&&(i=!0,this.addItem(this.initCellForFallDown(e,n),!0,e,!1,t),this.field[e][t].setX(n),this.field[e][t].fallDown(e,o,t),o++,0,n--)}return i},GameClass.prototype.fallDownToBottom=function(){for(var e,t=!1,i=0;i<Config.cols;i++){var o=0;for(e=Config.rows-1;0<=e;e--)if(this.field[e][i]&&this.field[e][i].isFallDown())for(var a=Config.rows-1;e<a;a--)if(void 0===this.field[a][i]){this.field[a][i]=this.field[e][i],this.field[e][i]=void 0,this.field[a][i].fallDown(a,o,i),o++;break}var n=-1;for(e=Config.rows-1;0<=e;e--){var r=Game.get("portal_out");r&&r.get("x")==i||void 0===this.field[e][i]&&(t=!0,this.addItem(this.initCellForFallDown(n,i),!0,e,!1,i),this.field[e][i].setY(n),this.field[e][i].fallDown(e,o,i),o++,n--,0)}}return t},GameClass.prototype.fallDownToTop=function(){for(var e,t=!1,i=Config.cols-1;0<=i;i--){var o=0;for(e=0;e<=Config.rows-1;e++)if(this.field[e][i]&&this.field[e][i].isFallDown())for(var a=0;a<e;a++)if(void 0===this.field[a][i]){this.field[a][i]=this.field[e][i],this.field[e][i]=void 0,this.field[a][i].fallDown(a,o,i),o++;break}Config.rows;var n=Config.cols+1;for(e=0;e<=Config.rows-1;e++)void 0===this.field[e][i]&&(t=!0,this.addItem(this.initCellForFallDown(n,i),!0,e,!1,i),this.field[e][i].setY(n),this.field[e][i].fallDown(e,o,i),o++,n++,0)}return t},GameClass.prototype.getMoves=function(){return this.get("moves").get()};var prev=GameClass.prototype.initialize;_.extend(GameClass.prototype,{initialize:function(){prev.call(this),this.lastMove={first:null,second:null},this.on("validMove",function(e){this.lastMove=e},this)},findCenterCell:function(e){var t;for(t=0;t<e.length;t++)if(e[t]==Game.lastMove.first||e[t]==Game.lastMove.second)return e[t];var i=0,o=0;for(t=0;t<e.length;t++)i+=e[t].x,o+=e[t].y;return i/=e.length,o/=e.length,_.min(e,function(e){return Math.abs(e.x-i)+Math.abs(e.y-o)})},processMatch:function(e){var t,i,o=this.calcItemsFigure(e),a={},n=[];for(t=0;t<e.length;t++)i=e[t],a[i.x+"_"+i.y]=!0;var r=function(e){var t=e.x+"_"+e.y;void 0===a[t]&&(a[t]=!0,n.push(e))};for(t=0;t<e.length;t++)(i=e[t]).decorator&&"three"==o&&"changecolor"!=i.getDecoratorName()||Game.neighbors(i,r);var s=this.findCenterCell(e);switch(RemoveFigureController.points(e,s),o){case"egg":RemoveFigureController.eggFigureRemove(e,s,n);break;case"three":RemoveFigureController.threeFigureRemove(e,s,n);break;case"five":RemoveFigureController.fiveFigureRemove(e,s,n);break;case"four":RemoveFigureController.fourFigureRemove(e,s,n);break;case"other":RemoveFigureController.otherFigureRemove(e,s,n)}}}),GameClass.prototype.createFloor=function(){this.floor=[];for(var e=0;e<Config.rows;e++){this.floor.push([]);for(var t=0;t<Config.cols;t++)application.level.floorAttribute?this.floor[e].push(parseInt(application.level.floorAttribute[e].charAt(t))):this.floor[e].push(0)}},GameClass.prototype.addFloor=function(e,t,i){if(void 0===t&&(t=1),this.floor[e.y][e.x]<t){if(0===this.floor[e.y][e.x]&&!i.noTask){var o=gameView.tasksView.tasks.findWhere({type:"ClearFloorAttributes"});o.set("amount",o.get("amount")+1)}this.floor[e.y][e.x]=t,this.trigger("createFloor",{x:e.x,y:e.y},Game.animate())}},GameClass.prototype.floorListen=function(){this.on("removedItem",function(e){if(this.floor[e.y]&&0<this.floor[e.y][e.x]){var t=this.floor[e.y][e.x];this.floor[e.y][e.x]--,0<this.floor[e.y][e.x]&&gameView.animate("floor","changeFloor",function(){},e,{level:this.floor[e.y][e.x],oldLevel:t}),0===this.floor[e.y][e.x]&&(this.trigger("removeFloor",{x:e.x,y:e.y}),gameView.animate("floor","removeFloor",function(){},e))}},this)},GameClass.prototype.createField=function(e){if(void 0===e)throw"Include floor.js after gems.js";return function(){this.createFloor(),this.floorListen(),e.call(this)}}(GameClass.prototype.createField),GameClass.prototype.noExistingMove=function(e){if(e){for(var t,i=!1,o=function(e){e instanceof Cell&&"none"!==e.getCurrentColor()&&"N"!==e.getCurrentColor()&&"U"!==e.getCurrentColor()&&t.push(e)};!this.existValidMove();){t=[],Game.each(o);for(var a=RANDOM(t),n=a.color,r=100;a.color===n&&0<r--;)a.setRandomColor();e||this.trigger("cellChangeColor",a,n,Game.animate(function(){},Game)),i=!0}return i}Game.trigger("showMessage",messages.noMovesShuffle,"noMovesShuffleMessage"),canvas.timeManager.setTimeout(Game.animate(function(){application.playSound("noExistingMovesShuffle"),this.shuffleField()},Game),1500)};var ProcessorGroup=function(e){this.name=e,this.items=[],this.add=function(e){this.items.push(e)},this.remove=function(e){var t=this.items.indexOf(e);-1!=t&&this.items.splice(t,1)},this.process=function(){for(var e=0;e<this.items.length;++e)this.items[e].process()}},Processor=function(e,t){this.name=e,this.line=t};Processor.prototype.add=function(e){this.line.push(e)},Processor.prototype.addToGroup=function(e,t){for(var i=null,o=0;o<this.line.length;++o)if(this.line[o]instanceof ProcessorGroup&&this.line[o].name===t){i=this.line[o];break}i||(i=new ProcessorGroup(t),this.line.push(i)),i.add(e)},Processor.prototype.remove=function(e){var t=this.line.indexOf(e);-1!=t&&this.line.splice(t,1)},Processor.prototype.run=function(){for(var e=Game.get(this.name);e<this.line.length;e++)if(this.line[e].process(),Game.set(this.name,e+1),Game.isAnimationRunning())return},GameClass.prototype.createAfterTurnProcessor=function(){var o=application.level.usedFeatures||[],a=[],e=[[ChocolateDecorator,"chocolate","chocolatefarm"],[CrabDecorator,"crab","crab2","crabbomb","crabfarm","crabice","crabmedusa","crabmouse","crabmousefarm"],[CrabFarmCell,"crabfarm"],[StrongboxCell,"strongbox"],[FarmCell,"farm"],[AfterTornadoCell,"tornado"],[TornadoCell,"tornado"],[ChangeColorDecorator,"changecolor"],[SpiderWebDecorator,"spiderweb","spiderwebfarm"],[PumpkinCell,"pumpkin"],[GhostCell,"ghost"],[SharkCell,"shark"],[BombCell,"bomb"],[SkatCell,"skat"],[TurtleCell,"tortoise"],[MedusaCell,"medusa"],[Gull,"gull"],[CrabMouseFarmCell,"crabmouse","crabmousefarm"],[GreedyPirateDecorator,"greedypirate"],[MagnetoCell,"magneto"],[GemStealerCell,"gemstealer"],[PopUpColorCell,"popupcolor"],[MagicWandCell,"magicwand"],[SeaHorseCell,"seahorse"],[GravityCoreCell,"gravitycore"],[BlackHoleCell,"blackhole"],[GenryMorganCell,"genrymorgan"],[ShooterCell,"shooter"],[FrogCell,"frog"],[HunterDecorator,"hunter"],[FireFlowerCell,"fireFlower"],[TwinkleCell,"twinkle"],[SeagullProcessor,"seagullRock"],[ChestWithKeysCellProcessor,"chestWithKeys"]];_.each(e,function(e){var t=e[0],i=e.slice(1);(0===i.length||0<_.intersection(o,i).length)&&a.push(t)}),this.afterTurnProcessor=new Processor("amountAfterTurnProcess",a)},GameClass.prototype.createAfterAnimationProcessor=function(){var i=application.level.usedFeatures||[],o={portal:PortalObject,gravity:GravityCell,cannon:CannonCell,gravitycore:GravityCoreCell,seahorse:SeaHorseCell,hunter:HunterDecorator,greedypirate:GreedyPirateDecorator,bigchest:BigChestCell,chest:ChestCell,coinchest:CoinChestCell,well:WellCell,palm:PalmCell,fireFlower:FireFlowerCell,twinkle:TwinkleCell,frog:FrogCell,iceberg:IcebergCell,sail:SailProcessor,fort:FortProcessor,activeshooter:ActiveShooterCell};this.afterAnimatonProcess=function(){for(var e in o){var t=o[e];if(-1!==i.indexOf(e)&&(t.process(!0),this.isAnimationRunning()))return}}},GameClass.prototype.createAfterEveryAnimationProcessor=function(){var i=application.level.usedFeatures||[],o={stickychain:StickyChainDecorator};this.afterEveryAnimatonProcess=function(){for(var e in o){var t=o[e];if(-1!==i.indexOf(e)&&(t.process(!0),this.isAnimationRunning()))return}}};var CollectColor=Task.extend({initialize:function(){this.set("color",this.get("description").cell),this.set("event","beforeRemovedItem"),this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.set("cssClass",this.get("cssClass")+"_"+this.get("color"))},getGroupId:function(){return this.get("type")+"_"+this.get("color")},canCollect:function(e){return this.get("color")===e.color&&(e.constructor===Cell||e instanceof ArrowCell)&&!e.collectedTask},tick:function(e){this.animateCollect(e.$div,GameScores.collectColor,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}});CollectColor.getCssClass=function(e){return"CollectColor_"+e.cell},CollectColor.getTaskAmount=function(e,t){return this.countCellsInMap(e.map,t.cell)};var CollectType=Task.extend({initialize:function(){if(this.set("autoNewElements",0),void 0!==this.get("description").cell&&(this.set("event","removedItem"),this.set("cellClass",CellsRegistry.getCellType(this.get("description").cell)),"auto"==this.get("description").amount||""===this.get("description").amount?this.set("amount",this.countCellsInField()):(this.set("amount",this.get("description").amount),this.get("cellClass")==FishCell&&this.set("autoNewElements",this.get("description").amount-this.countCellsInField())),this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.get("cellClass")&&this.get("cellClass").css?this.set("cssClass",this.get("cssClass")+"_"+this.get("cellClass").css):this.set("cssClass",this.get("cssClass")+"_"+this.get("description").cell),this.get("cellClass")==EggCell)){var e=application.level.colors;this.on("change:completed",function(e,t){t&&_.each(EggCell.chars,function(e){application.level.colors=application.level.colors.replace(e,"")})},this),Game.once("win fail",function(){application.level.colors=e},this),application.once("goToEditor",function(){application.level.colors=e})}void 0!==this.get("description").decorator&&(this.set("event","removedDecorator"),this.set("decoratorName",this.get("description").decorator),"auto"==this.get("description").amount||""===this.get("description").amount?this.set("amount",this.countDecoratorsInField()):this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.set("cssClass",this.get("cssClass")+"_"+this.get("description").decorator)),this.set("cssClass",this.get("cssClass").replace("/","genrymorgan").replace("@","multicolor").replace("&","coral").replace("*","blackhole")),this.listenTo(Game,"addItem",function(e){(this.has("decoratorName")?e.decorator&&this.canCollect(e.decorator):this.canCollect(e))&&("auto"!=this.get("description").amount&&""!==this.get("description").amount||this.set("amount",this.get("amount")+1))})},countCellsInField:function(){var t=0;return Game.each(function(e){this.canCollect(e)?t++:e instanceof CandyCell&&this.canCollect(e.createCell())&&t++},this),t},countDecoratorsInField:function(){var t=0;return Game.each(function(e){e.decorator&&this.canCollect(e.decorator)&&t++},this),t},canCollect:function(e){if(e instanceof MultiCell&&!e.isHead())return!1;if(e.collectedTask)return!1;if(this.has("decoratorName"))return e.get("name")==this.get("decoratorName");if(!(e instanceof this.get("cellClass")))return!1;if(e instanceof FishCell&&e.type!=FishCell.codeToType(this.get("description").cell))return!1;if(e instanceof EggCell&&0!==e.color)return!1;if(e instanceof BossCell&&!e.isHead())return!1;if(e instanceof CoinChestCell)return!1;var t=!1;return(void 0!==FlowerCell&&e instanceof FlowerCell||"undefined"!=typeof CakeCell&&e instanceof CakeCell)&&(t=!0),!t||!0===e.mainPart},collectAnimation:function(t,e,i){this.animateCollect(e,i,Game.endTurnAnimate(function(){if(Task.prototype.tick.call(this),this.playCollectSound(t),0<this.get("autoNewElements")){var e={offset:Math.floor(2*Math.random()+1),cellClass:this.get("cellClass")};e.type=t.type,Game.fallDownSpecialCells.push(e),this.set("autoNewElements",this.get("autoNewElements")-1)}},this))},tick:function(e){if(e instanceof BossCell||e instanceof BigChestCell)Task.prototype.tick.call(this);else if(this.has("decoratorName"))e.animateCollect(this.$div,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this));else{var t=!1;(void 0!==FlowerCell&&e instanceof FlowerCell||"undefined"!=typeof CakeCell&&e instanceof CakeCell)&&(t=!0);var i=e.$div;t&&(i=e.getDieDiv(),_Figure.blockedAnimations.append(i),i.alignTo(e.$div)),this.collectAnimation(e,i,GameScores[e.scoresId]),t&&i.remove()}},playCollectSound:function(e){e instanceof EggCell&&application.playSound("spratFly")},getCompletion:function(){var e=this.get("cellClass");return e&&e.getCompletionStatic?e.getCompletionStatic(this):Task.prototype.getCompletion.call(this)}});CollectType.getCssClass=function(e){var t=Config.tasks[e.type].cssClass+"_",i=e.decorator;if(i)return t+i;var o=e.cell,a=CellsRegistry.cellTypes[o];return a&&a.taskId?t+a.taskId:"CollectType_"+o},CollectType.getTaskAmount=function(e,t){if(e.bossName&&e.bossLife&&"q"===t.cell)return 1;if(t.decorator){var i=Object.values(Decorator.listDecorators()).find(function(e){return e.taskId===t.decorator}).SYMBOL,o=i||"[^\\.]";return this.countCellsInMap(e.decorators,o)}var a=t.cell||"",n=CellsRegistry.cellTypes[t.cell];n&&n.chars&&(a=n.chars);for(var r=0,s=0;s<a.length;s++)r+=this.countCellsInMap(e.map,a[s]);return r};var CollectFrog=CollectType.extend({getAnimateCollectRotation:function(){return 0},precalc:function(e,t){return CollectType.prototype.precalc.call(this,e,t)}});CollectFrog.getCssClass=function(e,t){return"CollectFrog_6"};var ClearFloorAttributes=Task.extend({initialize:function(){this.set("event","removeFloor"),this.set("amount",0);for(var e=0;e<Config.cols;e++)for(var t=Config.rows-1;0<=t;t--)this.isFloor(t,e)&&this.set("amount",this.get("amount")+1);this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.$collectMap=$("#tasks .CollectMap")},isFloor:function(e,t){return Game.floor[e][t]},tick:function(e){var t=FigureView.findById("floor_"+e.y+"_"+e.x);t&&this.animateCollect(t,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))},animateCollect:function(e,t){Game.set("score",Game.get("score")+GameScores.floor),Game.trigger("showFieldPoints",this.$collectMap,GameScores.floor,"collectTaskElem"),application.playSound("clearFloorAttributesTask"),t()}});ClearFloorAttributes.getCssClass=function(e){return"CollectMap"},ClearFloorAttributes.getTaskAmount=function(e,t){return this.countCellsInMap(e.floorAttribute,"[^0]")};var ClearCellAttributes=Task.extend({initialize:function(){var e=this.get("description").attribute||"key";this.set("event","removedAttribute_"+e),this.set("amount",0);for(var t=0;t<Config.cols;t++)for(var i=Config.rows-1;0<=i;i--)Game.field[i][t]&&Game.field[i][t].attribute==e&&this.set("amount",this.get("amount")+1);this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.set("cssClass",Config.tasks[this.get("type")].cssClass+" attribute-"+e)},onEvent:function(e){Task.prototype.onEvent.call(this,{cell:e})},tick:function(e){var t=e.cell;t.$div.find(".attribute").addClass("flying"),this.animateCollect(t.$div.find(".attribute"),GameScores["attribute_"+t.attribute]||GameScores.attribute,Game.endTurnAnimate(function(){application.playSound("clearCellAttribute"),Task.prototype.tick.call(this)},this),2*Game.get("speed"))}});ClearCellAttributes.getCssClass=function(e){var t=Config.tasks[e.type].cssClass,i=e.attribute;return i&&(t+=" attribute-"+i),t},ClearCellAttributes.getTaskAmount=function(e,t){var i="",o=Object.values(CellsRegistry.cellTypes).find(function(e){return e.taskId===t.attribute});o&&o.chars&&(i=o.chars);for(var a=0,n=0;n<i.length;n++)a+=this.countCellsInMap(e.cellAttribute,i[n]);return a||(a=this.countCellsInMap(e.cellAttribute,t.cell||"\\*")),a};var CollectDecorator=Task.extend({defaults:_.defaults({event:"removedDecorator_blocked",cssClass:"CollectDecorator",amount:0},Task.prototype.defaults),initialize:function(){var e=this.get("description"),t=e.amount,i=e.decorator,o=e.type;this.set({amount:t,cssClass:"".concat(this.get("cssClass"),"_").concat(i),event:"removedDecorator_".concat(i),name:Config.tasks[o].name,score:GameScores[i],type:o}),Game.on(this.get("event"),this.onEvent,this)},tick:function(e){Task.prototype.tick.call(this,1),Game.set("score",Game.get("score")+this.get("score")),Game.trigger("showFieldPoints",e.get("cell").$div,this.get("score"),"collectTaskElem")},getAnimateCollectRotation:function(){return 0}});CollectDecorator.getCssClass=function(e){return"CollectDecorator_"+e.decorator};var ClearFallingCellAttributes=ClearCellAttributes.extend({initialize:function(){var e,t,i=0;if(this.set("event","removedAttribute_falling"),this.set("amount",0),0===this.get("description").amount||void 0===this.get("description").amount||"auto"==this.get("description").amount)for(t=0;t<Config.cols;t++)for(e=Config.rows-1;0<=e;e--)Game.field[e][t]&&Game.field[e][t].attribute&&this.set("amount",this.get("amount")+1);else this.set("amount",this.get("description").amount);for(this.set("type",this.get("description").type),t=0;t<Config.cols;t++)for(e=Config.rows-1;0<=e;e--)Game.field[e][t]&&Game.field[e][t].attribute&&"falling"==Game.field[e][t].attribute&&i++;Cell.maxAttributeCount=this.get("amount")-i,Cell.maxAttributeCount<0&&(Cell.maxAttributeCount=0);var o,a=this;Game.addAttributeForCell=(o=Game.addAttributeForCell,function(e){o.call(this,e),a.addAttributeForCell(e)}),Task.prototype.initialize.call(this)},addAttributeForCell:function(e){if(Game.get("fullRunning")&&!e.attribute){var t=0;Game.each(function(e){"falling"===e.attribute&&t++}),this.get("beginAmount")-this.get("collectedAmount")-t<=0||e instanceof Cell&&0<Cell.maxAttributeCount&&Math.random()<.2&&(Cell.maxAttributeCount--,e.attribute="falling")}}}),ClearCoinCellAttributes=ClearCellAttributes.extend({initialize:function(){var e=this.get("description");e.attribute="coin",this.set("description",e),ClearCellAttributes.prototype.initialize.call(this);var t=this.get("description").amount;t&&0<t&&(this.set("amount",t),this.set("beginAmount",t))},tick:function(e){var t=e.cell;this.animateCollect(t.$div.find(".attribute"),GameScores.attributeCoin,Game.endTurnAnimate(function(){application.playSound("clearCellAttribute"),Task.prototype.tick.call(this)},this),2*Game.get("speed"))}}),CollectCrystals=Task.extend({initialize:function(){this.set("event","removedAttribute_crystal"),this.set("type","CollectCrystals"),Task.prototype.initialize.call(this),this.on("change:completed",function(){Game.win()})},tick:function(e){this.trigger("collect",e),_.defer(_.bind(Task.prototype.tick,this))}}),CollectComplexCellAttributes=Task.extend({initialize:function(){this.set("type","CollectComplexCellAttributes"),this.set("taskName",this.get("description").taskName),this.set("parts",this.get("description").parts),this.set("event","removedAttribute");var t={};this.get("description").associate;this.get("parts").split(",").forEach(function(e){t[e]=!1}),this.set("leftParts",t),this.set("amount",_.keys(t).length),this.set("collectedAmount",0),Task.prototype.initialize.call(this)},onEvent:function(e){Task.prototype.onEvent.call(this,{cell:e})},isWin:function(){var e=this.get("leftParts");for(var t in e)if(!e[t])return!1;return!0},collectPartAnimation:function(e,t,i,o,a){this.animateCollect(t,i,Game.endTurnAnimate(function(){this.trigger("collectPart",this,a),this.isWin()&&this.set("completed",!0)},this),void 0,o)},canCollect:function(e){var t=e.cell.attribute;t.charCodeAt(0);return!1===this.get("leftParts")[t]},tick:function(e){var t=e.cell,i=t.attribute,o=i.charCodeAt(0);this.get("leftParts")[i]=!0;var a=".charcode_"+o,n=this.$div.find(a);this.set("collectedAmount",this.get("collectedAmount")+1),this.collectPartAnimation(t,t.$div.find(".attribute"),GameScores.complexCellAtributesTask,n,a)}});CollectComplexCellAttributes.getCssClass=function(e){return"CollectComplexCellAttributes"},CollectComplexCellAttributes.getTaskAmount=function(e,t){return this.countCellsInMap(e.cellAttribute,"[]")};var CollectPearl=Task.extend({getCapitalisedBaseName:function(){return"Pearl"},getTaskElementInstanceName:function(){return PearlCell},initialize:function(){this.set("event","removed"+this.getCapitalisedBaseName());var e=Number(this.get("description").amount);e?this.set("amount",e):this.set("amount",this.countElementsInField()),this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.listenTo(Game,"addItem",function(e){this.get("description").amount||!(e instanceof this.getTaskElementInstanceName())||e instanceof FishBallCell||this.set("amount",this.get("amount")+1)})},countElementsInField:function(){for(var e=0,t=0;t<Config.cols;t++)for(var i=Config.rows-1;0<=i;i--)Game.field[i][t]&&Game.field[i][t]instanceof this.getTaskElementInstanceName()&&!(Game.field[i][t]instanceof FishBallCell)?e++:Game.field[i][t]instanceof CandyCell&&Game.field[i][t].createCell()instanceof this.getTaskElementInstanceName()&&e++;return e},tick:function(e){this.animateCollect(e,GameScores.pearl,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this)),e.remove()}}),CollectParrot=CollectPearl.extend({getCapitalisedBaseName:function(){return"Parrot"},getTaskElementInstanceName:function(){return ParrotCell},getAnimateCollectRotation:function(){return 0}}),CollectTurtle=CollectPearl.extend({getCapitalisedBaseName:function(){return"Turtle"},getTaskElementInstanceName:function(){return TurtleCell},getAnimateCollectRotation:function(){return 0}});CollectTurtle.getTaskAmount=function(e,t){return this.countCellsInMap(e.map,"[SJf]")};var CollectFishBall=CollectType.extend({initialize:function(){CollectType.prototype.initialize.call(this),this.set("autoNewElements",this.get("description").amount-this.countCellsInField())},animateCollect:function(e,t,i,o,a){i()},collectAnimation:function(a,e,t){var i=_.bind(function(){if(0<this.get("autoNewElements")&&0<Game.get("moves").get()){var t=[];if(Game.each(function(e){e.constructor!==Cell||e.decorator||e.attribute||t.push(e)}),t.length){application.playSound(a.baseName+"Add");var e=RANDOM(t),i=new FishBallCell(e.y,e.x,{maxLives:a.maxLives});Game.addItem(i),i.$div.hide();var o=FigureView.createByTemplate(".invisible ."+i.getTemplateClass(),["create"]);_Figure.blockedAnimations.append(o),o.alignTo(this.target),o.ourAnimate({target:e.$div,animation:Library.collectFly,options:{targetScale:1,vy:500}},1e3,"linel",Game.animate(function(){o.remove(),e.$div.remove(!0),i.$div.show()})),this.set("autoNewElements",this.get("autoNewElements")-1)}}},this);this.animateCollect(e,t,Game.endTurnAnimate(function(){Task.prototype.tick.call(this),application.playSound(a.baseName+"Collect"),0<Game.get("moves").get()?Game.once("afterTurn",i):Game.once("change:moves",function(){0<Game.get("moves").get()&&i()})},this))}});CollectFishBall.getCssClass=function(e){return"CollectFishBall_"+e.cell};var CollectVase=Task.extend({initialize:function(){this.set("event","destroyVase"),this.set("amount",this.countElementsInField()),this.set("type",this.get("description").type),Task.prototype.initialize.call(this)},countElementsInField:function(){for(var e=0,t=0;t<Config.cols;t++)for(var i=Config.rows-1;0<=i;i--)Game.field[i][t]&&Game.field[i][t]instanceof VaseBoxCell&&Game.field[i][t].isHead()&&(e+=Game.field[i][t].life);return e},onEvent:function(e){this.isActive()&&this.canCollect(e)&&!this.isCollected()&&((e.collectedTask=this).onBeforeTick(e.life),this.tick(1))}});CollectVase.getCssClass=function(e){return"CollectVase"};var CollectBug=CollectType.extend({getAnimateCollectRotation:function(){return 0},animateCollect:function(e,t,i,o,a){if(e.length){var n=e.clone(),r=Game.animate();_Figure.blockedAnimations.append(n),n.set({"margin-left":0,"margin-top":0}),n.alignTo(e),n.find(".arrow").remove(),n.find(".decorator").remove(),void 0!==o&&n.delay(o);var s=360;this instanceof Task?(a&&a!=this.target&&this.precalc(a),s=this.getAnimateCollectRotation()):Task.prototype.precalc.call(this,a),n.ourAnimate({scale:1.2},3*Game.get("speed")).queue(function(e){r(),e()}).ourAnimate({target:this.target,ajust:this.ajust,scale:.25,rotate:s},6*Game.get("speed"),void 0,_.bind(function(){Game.set("score",Math.max(0,Game.get("score")+t)),this.showPoints(n,t),i()},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){n.remove()})}else i()}});CollectBug.getCssClass=function(e){return"CollectType_Bug"};var CollectGemStealer=Task.extend({initialize:function(){this.set("event","removedItem"),this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),Task.prototype.initialize.call(this),this.set("cssClass",this.get("cssClass")+"_"+this.get("color"))},canCollect:function(e){return e instanceof GemStealerCell},tick:function(e){this.animateCollect(e.$div,GameScores.gemStealer,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}});CollectGemStealer.getCssClass=function(e){return"CollectGemStealer_undefined"};var CellsRegistryClass=function(){this.cellTypes={}};CellsRegistryClass.prototype.getCellType=function(e){return this.cellTypes[e]},CellsRegistryClass.prototype.registerCellType=function(t,i,e){var o=this;_.each(t,function(e){o.cellTypes[e]=i}),e&&_.each(e,function(e){Preloader.Config.registerCell(t,e)})},CellsRegistryClass.prototype.initCell=function(e,t,i,o){return new(0,this.cellTypes[e])(t,i,o,e)};var CellAttributes={$:"coin",_:"falling","":"hat_mark","":"shirt_mark","":"pants_mark","":"boots_mark","":"prizePointMark"},BaseCell=function(e,t,i){this.id=_.uniqueId("cell_"),this.y=e,this.x=t,this.life=1,this.movable=!0,this.removable=!0,this.removeOnRemoveNear=!1,this.showPointsOnRemove=0,this.color=i||"none",this.blockers=[],this.onField=!1,this.soundEnabled=!0},XSa;BaseCell.extend=Backbone.Model.extend,_.extend(BaseCell.prototype,Backbone.Events),BaseCell.prototype.getDecoratorName=function(){return this.decorator?this.decorator.get("name"):""},BaseCell.prototype.clickAnimate=function(){},BaseCell.prototype.isMovable=function(){return!this.isBlocked("movable")&&this.movable},BaseCell.prototype.isFallDown=function(){return this.isMovable()},BaseCell.prototype.isRemovable=function(){return!this.isBlocked("removable")&&this.removable},BaseCell.prototype.getCurrentColor=function(){return this.color},BaseCell.prototype.getTemplateClass=function(){return"defaultCell"},BaseCell.prototype.getCoords=function(){return{x:this.x*Config.cellWidth,y:this.y*Config.cellHeight}},BaseCell.prototype.calcColor=function(){return"color_"+(this instanceof Cell&&"none"===this.color?this.saveColor:this.color)},BaseCell.prototype.createDiv=function(e){void 0===e&&(e=[this.calcColor()]),e.push("life"+this.life);var t=FigureView.createByTemplate(".invisible ."+this.getTemplateClass(),e);return _Figure.field.append(t),t.set(this.getCoords()),this.$div=t,this.setX(this.x),this.setY(this.y),t},BaseCell.prototype.removeNear=function(){this.removeOnRemoveNear&&this.remove()},BaseCell.prototype.setY=function(e){this.y=e},BaseCell.prototype.setX=function(e){this.x=e},BaseCell.prototype.afterFallDown=function(){},BaseCell.prototype.removeById=function(e,t){this.remove(t)},BaseCell.prototype.fallDown=function(e,t){this.$div.delay((t+Math.random())*Game.get("speed")),this.y<0&&this.$div.queue(function(e){this.set({opacity:1}),e()});var i=Game.animate(function(){this.afterFallDown(),this.setY(e)},this);this.$div.ourAnimate({y:e*Config.cellHeight},.6*Math.abs(e-this.y)*Game.get("speed"),"easeInQuad",i)},BaseCell.prototype.beforeGameFinish=function(){},BaseCell.prototype.beforeRemove=function(){},BaseCell.prototype.afterRemove=function(){},BaseCell.prototype.executeRemove=function(t){this.beforeRemove(t),this.onField&&0<=this.y&&(Game.field[this.y][this.x]=void 0),Game.trigger("removedItem",this);var i=Game.animate(this.afterRemove,this),o=this;this.$div.queue(function(e){t?(o.$div.remove(),i()):(o.animateRemoval(i),e())})},BaseCell.prototype.highlight=function(e){void 0!==this.decorator&&this.decorator.highlightDecoratorBody?this.decorator.highlight(e):e?(this.$div.removeClass("powerUpHighlight"),this.$div.find(".powerUpHighlightBg").removeClass("powerUpHighlightBgAnimation")):(this.$div.addClass("powerUpHighlight"),this.$div.find(".powerUpHighlightBg").addClass("powerUpHighlightBgAnimation"))},BaseCell.prototype.remove=function(e){return!!this.isRemovable()&&(0!==this.life&&(this.life--,0<this.life?this.animateTakeLife(Game.animate()):this.executeRemove(e),!0))},BaseCell.prototype.addBlocker=function(e){this.blockers.push(e)},BaseCell.prototype.removeBlocker=function(e){var t=this.blockers.indexOf(e);-1!==t&&this.blockers.splice(t,1)},BaseCell.prototype.isBlocked=function(t){return t?Boolean(this.blockers.find(function(e){return e.isBlocked(t)})):0<this.blockers.length},BaseCell.prototype.animateTakeLife=function(t){var i=this;this.$div.queue(function(e){this.removeClass("life"+(i.life+1)),this.addClass("life"+i.life),e(),t()})},BaseCell.prototype.animateRemoval=(XSa=0,function(e){this.$div.remove(),XSa=(XSa+1)%2,application.playSound("explode"+(XSa+1)),FieldController.explodeSimpleCell(this.x,this.y,e,this.color?"cell_explode_color_"+this.color:"")}),BaseCell.prototype.playSound=function(e){if(this.soundEnabled)return application.playSound(e)},BaseCell.prototype.isMovable=function(){return!this.isBlocked("movable")&&this.movable&&!this.medusaBlocked},BaseCell.prototype.getCurrentColor=function(){return this.isBlocked("removable")?"none":this.medusaBlocked?"none":this.color},BaseCell.prototype.isRemovable=function(){return!this.isBlocked("removable")&&(!!this.removable&&!this.medusaBlocked)},BaseCell.prototype.fallDown=function(e,t,i){this.$div.delay((t+Math.random())*Game.get("speed")),(this.y<0||this.x<0||this.y>Config.rows||this.x>Config.cols)&&this.$div.queue(function(e){this.set({opacity:1}),e()});var o=Game.animate(function(){this.afterFallDown(i,e),this.setX(i),this.setY(e)},this),a=.6*Math.abs(e-this.y)*Game.get("speed");i!=this.x&&(a=.6*Math.abs(i-this.x)*Game.get("speed")),this.$div.ourAnimate({y:e*Config.cellHeight,x:i*Config.cellWidth},a,"easeInQuad",o)},BaseCell.prototype.isOnTheBottomEdge=function(){for(var e=this.y+1;e<=Config.rows-1;e++)if(Game.field[e]&&null!==Game.field[e][this.x])return!1;return!0},BaseCell.prototype.isOnTheTopEdge=function(){for(var e=this.y-1;0<=e;e--)if(Game.field[e]&&null!==Game.field[e][this.x])return!1;return!0},BaseCell.prototype.isOnTheRightEdge=function(){for(var e=this.x+1;e<=Config.cols-1;e++)if(Game.field[this.y]&&null!==Game.field[this.y][e])return!1;return!0},BaseCell.prototype.isOnTheLeftEdge=function(){for(var e=this.x-1;0<=e;e--)if(Game.field[this.y]&&null!==Game.field[this.y][e])return!1;return!0},BaseCell.prototype.isTaskTarget=function(){for(var e,t,i,o,a=0;a<Game.tasks.length;a++){if(t=(e=Game.tasks.models[a]).get("type"),i=e.get("description"),o=e.get("cellClass"),"ClearCellAttributes"===t&&this.attribute)return!0;if("CollectPopUpColor"===t&&this instanceof PopUpColorCell)return!0;if("CollectFrog"===t&&"flower"==this.scoresId)return!0;if(i&&this.decorator&&i.decorator===this.decorator.get("name"))return!0;if(o&&o===this.constructor)return!0}return!1};var MultiCell=BaseCell.extend({width:2,height:2,render:_.noop,isRemoveOnce:!1,constructor:function(e,t,i,o){BaseCell.call(this,e,t,o),this.movable=!1,this.head=this.getHead()},getCurrentColor:function(){return null},getHead:function(){for(var e=this.width-1;0<=e;e--)for(var t=this.height-1;0<=t;t--)if(Game.inField(this.x-e,this.y-t)){var i=Game.field[this.y-t][this.x-e];if(i.constructor===this.constructor&&i.isHead())return i}return this},getBody:function(){if(this.isHead()){for(var e=[],t=0;t<this.width;t++)for(var i=0;i<this.height;i++)Game.inField(this.x+t,this.y+i)&&e.push(Game.field[this.y+i][this.x+t]);return e}return this.head.getBody()},isHead:function(){return this.head==this},highlight:function(e){this.isHead()?BaseCell.prototype.highlight.call(this,e):this.head.highlight(e)},beforeRemove:function(){if(this.isHead())for(var e=0;e<this.width;e++)for(var t=0;t<this.height;t++)Game.inField(this.x+e,this.y+t)&&Game.field[this.y+t][this.x+e].constructor===this.constructor&&Game.field[this.y+t][this.x+e]!=this&&(Game.field[this.y+t][this.x+e].removable=!0,Game.field[this.y+t][this.x+e].remove())},remove:function(e){this.isHead()?BaseCell.prototype.remove.call(this,e):0===this.head.life?BaseCell.prototype.remove.call(this,!0):this.head.remove.call(this.head,e)},removeById:function(e,t){this.isRemoveOnce?(this.head.offenders||(this.head.offenders=[]),-1===this.head.offenders.indexOf(e)&&(this.head.offenders.push(e),this.remove(t))):this.remove(t)},getTemplateClass:function(){return this.isHead()?this.getHeadTemplateClass():"emptyTemplate"},createDiv:function(e){return BaseCell.prototype.createDiv.call(this,e),this.render(),this.$div},isRemovable:function(){return this.isHead()?!this.isMedusaBlocked()&&!this.isBlocked("removable")&&BaseCell.prototype.isRemovable.call(this):this.head.isRemovable()},isMedusaBlocked:function(){return _.any(this.getBody(),function(e){return e.medusaBlocked})}}),Cell=function(e,t,i,o){BaseCell.call(this,e,t,o),this.initialize(e,t,i,o)},kUa;Cell.prototype.scoreId="cell",Cell.prototype.isRegular=!0,Cell.extend=Backbone.Model.extend,Cell.chars="RGBYPWN",_.extend(Cell.prototype,BaseCell.prototype),Cell.prototype.initialize=function(e,t,i,o){this.color=o||".",i&&(this.color=application.level.map[e].charAt(t),application.level.cellAttribute&&"*"==application.level.cellAttribute[e].charAt(t)&&(this.attribute="key")),"."==this.color&&this.setRandomColor(),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},Cell.prototype.showFieldPoints=function(){this.showPointsOnRemove&&this instanceof Cell&&Game.trigger("showFieldPoints",this.$div,this.showPointsOnRemove,"explodeCell_"+this.color)},Cell.prototype.beforeRemove=function(e){Game.trigger("beforeRemovedItem",this),this.attribute&&(Game.trigger("removedAttribute_"+this.attribute,this),Game.trigger("removedAttribute",this),this.$div.find(".attribute").remove()),this.secondAttribute&&(Game.trigger("removedSecondAttribute_"+this.secondAttribute,this),Game.trigger("removedSecondAttribute",this),this.$div.find(".secondAttribute").remove()),Game.set("score",Game.get("score")+GameScores[this.scoreId]),e||this.showFieldPoints()},Cell.prototype.remove=function(e){return this.decorator?(this.decorator.remove(e),!0):BaseCell.prototype.remove.call(this,e)},Cell.prototype.setRandomColor=function(e){if(!e&&application.level.stack&&0<application.level.stack.length)this.color=application.level.stack.charAt(0),application.level.stack=application.level.stack.substr(1);else{for(var t="",i=0;i<Cell.chars.length;i++)0<=application.level.colors.indexOf(Cell.chars.charAt(i))&&(t+=Cell.chars.charAt(i));this.color=t.charAt(_.random(0,t.length-1))}},Cell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return this.attribute&&this.setAttribute(this.attribute),this.secondAttribute&&this.setSecondAttribute(this.secondAttribute),this.decorator&&this.decorator.render(),t},Cell.prototype.setAttribute=function(e){if(this.attribute=e,this.attribute){var t=FigureView.createByTemplate(".invisible .emptyTemplate",["attribute","attribute_"+this.attribute]);this.$div.append(t),this.$div.$attr=t}else this.$div&&this.$div.$attr&&this.$div.$attr.remove()},Cell.prototype.setSecondAttribute=function(e){if(this.secondAttribute=e,this.secondAttribute){var t=FigureView.createByTemplate(".invisible .emptyTemplate",["secondAttribute","secondAttribute_"+this.secondAttribute]);this.$div.append(t),this.$div.$secondAttr=t}else this.$div&&this.$div.$secondAttr&&this.$div.$secondAttr.remove()},Cell.chars="RGBYPWNU",Cell.prototype.initialize=(kUa=Cell.prototype.initialize,function(e,t,i,o){if(kUa.call(this,e,t,i,o),i){if(application.level.cellAttribute){var a=CellAttributes[application.level.cellAttribute[e].charAt(t)];a&&(this.attribute=a)}if(application.level.cellSecondAttribute){var n=CellAttributes[application.level.cellSecondAttribute[e].charAt(t)];n&&(this.secondAttribute=n)}}Game.get("crystalsOnField")&&100*Math.random()<Config.crystalProbability&&this instanceof Cell&&(this.attribute="crystal")}),Cell.prototype.highlight=function(e){if("defaultCell"==this.getTemplateClass())if(e)this.$div.find(".powerUpHighlightBg").remove();else{var t=FigureView.createByTemplate(".invisible .powerUpHighlightTemplate",[]);this.$div.append(t)}BaseCell.prototype.highlight.call(this,e)},Cell.prototype.remove=function(e){return!this.isBlocked("removable")&&(!this.medusaBlocked&&(this.decorator?(this.decorator.remove(e),!0):BaseCell.prototype.remove.call(this,e)))};var DroppableCell=BaseCell.extend({constructor:function(e,t,i){this.char=i?application.level.map[e].charAt(t):void 0,BaseCell.call(this,e,t),this.removable=!1,i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this),this.decorator&&this.listenTo(this.decorator,"remove",this.onRemoveDecorator))},onRemoveDecorator:function(){if(!this.decorator){var e=Game.animate(function(){this.setY(this.y)},this);canvas.timeManager.setTimeout(e,500)}},isRemovable:function(){return!!this.decorator||this.removable},remove:function(e){return!this.isBlocked()&&(this.decorator?(this.decorator.remove(e),!0):BaseCell.prototype.remove.call(this,e))},createDiv:function(){return Cell.prototype.createDiv.call(this)},setY:function(e){if(BaseCell.prototype.setY.call(this,e),!this.isBlocked("movable")&&!this.decorator){for(var t=e+1;t<Config.rows;t++)if(null!==Game.field[t][this.x])return;this.removable=!0,this.remove()}},animateRemoval:function(e){this.$div.remove(),e()},afterRemove:function(){Game.trigger("afterRemovedItem",this)}});DroppableCell.prototype.checkDroppedCells=function(){if(!this.isBlocked("movable")&&!this.decorator){var e=!1;switch(Game.gravityDirection||"bottom"){case"left":e=this.isOnTheLeftEdge();break;case"right":e=this.isOnTheRightEdge();break;case"top":e=this.isOnTheTopEdge();break;case"bottom":e=this.isOnTheBottomEdge()}e&&(this.removable=!0,this.remove())}},DroppableCell.prototype.onRemoveDecorator=function(){if(!this.decorator){var e=Game.animate(this.checkDroppedCells,this);canvas.timeManager.setTimeout(e,500)}},DroppableCell.prototype.setY=function(e){BaseCell.prototype.setY.call(this,e),this.checkDroppedCells()},DroppableCell.prototype.setX=function(e){BaseCell.prototype.setX.call(this,e),this.checkDroppedCells()};var FishCell=DroppableCell.extend({animations:["dancingFishAnim1","dancingFishAnim2","dancingFishAnim3"],constructor:function(e,t,i,o){this.type=i?FishCell.codeToType(application.level.map[e].charAt(t)):FishCell.codeToType(o)||o,this.dancingClassId=0,this.scoresId=1==this.type?"fish":"fish"+this.type,DroppableCell.call(this,e,t,i)},getTemplateClass:function(){return"fishCell"},createDiv:function(){var e=Cell.prototype.createDiv.call(this);return e.addClass(RANDOM(this.animations)).addClass(this.scoresId),e.find(".fishcellBg").addClass(this.scoresId),application.trigger("createFish"),Game.on("afterTurn",this.checkDroppedCells,this),e},animateRemoval:function(e){var t=Game.animate();application.playSound("fishCellRemove"),this.$div.remove(),setTimeout(function(){t(),e()})},afterRemove:function(){Game.off("afterTurn",this.checkDroppedCells,this),DroppableCell.prototype.afterRemove.call(this)}},{codeToType:function(e){return"FghjklbncuD".indexOf(e)+1}}),EggCell=function e(t,i,o,a){BaseCell.call(this,t,i),this.color=e.codeToType(o?application.level.map[t].charAt(i):a),this.notRemoveByTwoMulticolors=!0,this.notRemoveByMulticolor=!0,this.scoresId="egg",this.removable=0===this.color,o&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[t].charAt(i),this))};_.extend(EggCell.prototype,Cell.prototype),EggCell.chars="0123",EggCell.codeToType=function(e){return EggCell.chars.indexOf(e)},EggCell.prototype.createDiv=function(e){return application.trigger("createEgg"),Cell.prototype.createDiv.apply(this,arguments)},EggCell.prototype.animateRemoval=function(e){this.$div.remove(),e()},EggCell.prototype.calcColor=function(){return"color_"+("none"===this.color?this.saveColor:this.color)},EggCell.prototype.isGrowAbleOccupite=function(e){return e instanceof ChocolateFarmCell||e.decorator instanceof ChocolateDecorator};var WallCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1};_.extend(WallCell.prototype,BaseCell.prototype),WallCell.prototype.indestructible=!0,WallCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.addClass("wall"),t};var HunterTargetCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1};_.extend(HunterTargetCell.prototype,BaseCell.prototype),HunterTargetCell.prototype.indestructible=!0,HunterTargetCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.addClass("huntertarget"),t};var GravityCell=BaseCell.extend({constructor:function(){BaseCell.apply(this,arguments),this.removeOnRemoveNear=!1,this.movable=!1,this.removable=!1,this.indestructible=!0,this.name="gravity",this.directions=[{id:1,direction:"bottom",angle:0},{id:2,direction:"left",angle:90},{id:3,direction:"top",angle:180},{id:4,direction:"right",angle:270}],this.direction=application.level.gravityDirection||"bottom",this.rotation=application.level.gravityRotation||"match",this.matchColor=application.level.gravityMatchColor||"any",Game.gravityMatchSide=!1},setMatchSide:function(e){var t=e.x-this.x,i=e.y-this.y;!t&&i?0<i?Game.gravityMatchSide="bottom":i<0&&(Game.gravityMatchSide="top"):!i&&t&&(0<t?Game.gravityMatchSide="right":t<0&&(Game.gravityMatchSide="left"))},removeNear:function(e,t,i,o,a){this.isBlocked("removeOnRemoveNear")||this.medusaBlocked||Game.gravityMatchSide||!o||_.each(a,function(e){Math.abs(e.x-this.x)+Math.abs(e.y-this.y)==1&&("any"!=this.matchColor&&this.matchColor!=e.getCurrentColor()||(this.setMatchSide(e),GravityCell.process()))},this)},removeItemCallback:function(e){this.isBlocked("movable")||this.medusaBlocked||Game.gravityMatchSide||!e.removeWithPowerUp||Math.abs(e.x-this.x)+Math.abs(e.y-this.y)!=1||"any"!=this.matchColor&&this.matchColor!=e.getCurrentColor()||(this.setMatchSide(e),GravityCell.process())},processRotation:function(){var e,t,i,o=_.findWhere(this.directions,{direction:this.direction}),a=_.max(this.directions,function(e){return e.id});switch(this.rotation){case"forward":e=o.id==a.id?1:o.id+1;break;case"backward":e=1==o.id?a.id:o.id-1;break;default:e=!1}if(t=e?_.findWhere(this.directions,{id:e}):_.findWhere(this.directions,{direction:Game.gravityMatchSide})){switch(this.rotation){case"backward":i=t.angle?-1*(360-t.angle):-360;break;case"forward":i=t.angle?t.angle:360;break;default:i=!t.angle&&90<o.angle?360:!t.angle&&o.angle<-90?-360:Math.abs(o.angle-t.angle)<=180?t.angle:t.angle-360}if(this.direction!=t.direction){Game.gravityDirection=this.direction=t.direction;var n=this.$div;application.playSound("gravityRotation");var r=Game.animate();n.ourAnimate({rotate:i},200,null,function(e){n.set("rotate",360==i||-360==i?0:t.angle),e&&e(),r()})}}},createDiv:function(e){var t=BaseCell.prototype.createDiv.call(this,e);t.addClass("gravity");Game.gravityDirection=this.direction;var i=_.findWhere(this.directions,{direction:this.direction}),o="backward"==this.rotation?-1*(360-i.angle):i.angle;return t.set("rotate",o),Game.on("removedItem",this.removeItemCallback,this),t}},{chars:">",process:function(){Game.gravityMatchSide&&Game.each(function(e){e instanceof GravityCell&&e.processRotation()}),Game.gravityMatchSide=!1}}),GravityCoreCell=BaseCell.extend({constructor:function(e,t,i,o){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1,this.isGravityCoreMoving=!1,this.isLoaded=!1,this.orientation=o,i&&GravityCoreCell.listenToGame()},getTemplateClass:function(){return"gravitycoreCell"},createDiv:function(e){BaseCell.prototype.createDiv.call(this,e)},getPath:function(e,t){var i,o,a=[],n=this.x,r=this.y,s=0;do{if(n+=e,r+=t,!Game.inField(n,r)||!Game.field[r][n].isRemovable()&&!Game.field[r][n].isGravityCoreMoving||1!=Game.field[r][n].life||!(Game.field[r][n]instanceof Cell||Game.field[r][n]instanceof BulbCell||Game.field[r][n]instanceof BombCell||Game.field[r][n]instanceof ArrowCell||Game.field[r][n]instanceof TurtleCell||Game.field[r][n]instanceof MultiColorCell||Game.field[r][n]instanceof ParrotCell||Game.field[r][n]instanceof FishBallCell||Game.field[r][n].isGravityCoreMoving)||Game.field[r][n].gravityCoreTarget)break;if(0===s&&!(Game.field[r][n]instanceof Cell||Game.field[r][n]instanceof ArrowCell||Game.field[r][n].isGravityCoreMoving))break;if(Game.field[r][n].decorator&&(0===s||Game.field[r][n].decorator.constructor==GreedyPirateDecorator||Game.field[r][n].decorator.constructor==HunterDecorator||Game.field[r][n].decorator.constructor==EelDecorator||1<Game.field[r][n].decorator.get("level")||void 0!==Game.field[r][n].decorator.life&&1<Game.field[r][n].decorator.life))break;a.push(Game.field[r][n]),++s}while(Game.inField(n,r));for(Game.inField(n,r)&&Game.field[r][n].isRemovable()&&(o=Game.field[r][n]),Game.inField(n,r)&&Game.field[r][n].bump&&(o=Game.field[r][n]);a.length;){if((i=a.pop()).constructor===Cell||i.constructor===ArrowCell||i.constructor===BulbCell||i.constructor===BombCell||i.constructor===ParrotCell||i.constructor===TurtleCell||i.constructor===FishBallCell||i.constructor===MultiColorCell||i.isGravityCoreMoving){a.push(i);break}o=i}return[a,o]},getNewOrientation:function(e){switch(e){case"left":return"";case"right":return"";default:return this.orientation}},needRun:function(){var e=this.getRunDirection(),t=this.x+e.dx,i=this.y+e.dy;return 0<=t&&t<Config.cols&&0<=i&&i<Config.rows&&null!==Game.field[i][t]&&(this.direction=e,this.distanceToGravity=e.distance,!0)},getRunDirection:function(){var e;switch(Game.gravityDirection){case"left":e={dx:-1,dy:0,priority:0,distance:this.x};break;case"right":e={dx:1,dy:0,priority:0,distance:Config.cols-1-this.x};break;case"top":e={dx:0,dy:-1,priority:0,distance:this.y};break;default:e={dx:0,dy:1,priority:0,distance:Config.rows-1-this.y}}return e},run:function(){if(!this.medusaBlocked&&!this.isBlocked("movable")){var i,o,t,a=this,n=GravityCoreCell.directions[this.direction.dx][this.direction.dy],e=this.getNewOrientation(n),r=this.getPath(this.direction.dx,this.direction.dy),s=r[0],l=r[1];this.isGravityCoreMoving=!1,s.length?(this.isGravityCoreMoving=!0,(o=s[s.length-1]).gravityCoreTarget=!0,i=this.$div.clone().appendTo(_Figure.blockedAnimations).alignTo(this.$div).find(".gravitycoreBg").removeClass("stable"),t=Game.animate(_.bind(function(){Game.field[this.y][this.x]=void 0,this.isLoaded||(i.parent().remove(),Game.addItem(new GravityCoreCell(o.y,o.x,!1,e)))},this)),application.playSound("gravityCore"),"right"===n&&i.removeClass("leftMove"),i.addClass(n+"Move"),-1!==["left","right"].indexOf(n)&&i.animationByName("gravityCoreStart"),i.queue(function(e){a.$div.set("opacity",0),a.removable=!0,i.addClass("gravityCoreRun"),e()}),_.each(s,function(e){var t={x:0,y:0};e===o&&("right"===n?t.x=-600/Config.cellWidth:"left"===n&&(t.x=600/Config.cellWidth)),e instanceof BulbCell&&(t.x=840/Config.cellWidth),i.parent().ourAnimate({target:e.$div,ajust:t},200,"linear",function(){e.decorator&&1==e.decorator.get("level")&&e.decorator.remove(),e.remove()})}),i.parent().queue(function(e){a.$div&&a.$div.remove(),application.playSound("gravityCoreBump"),i.removeClass("gravityCoreRun").addClass("gravityCoreStop"),e()}).queue(function(e){l&&(l.bump?l.bump(a,i.parent()):l instanceof BulbCell||l.remove()),application.stopSound("gravityCore"),e(),t()})):l&&l instanceof CannonCell&&(a.removable=!0,Game.field[a.y][a.x]=void 0,l.bump(this,this.$div,Game.animate()))}}},{chars:"]",directions:{"-1":{0:"left"},0:{"-1":"up",1:"down"},1:{0:"right"}},process:function(e){var t=[];Game.each(function(e){e instanceof GravityCoreCell&&e.needRun()&&t.push(e)}),t=_.sortBy(t,"distanceToGravity"),_.each(t,function(e){e.run(),e.direction=void 0,e.distanceToGravity=!1},this)},listenToGame:function(){Game.isAnimationRunning()&&(Game.off("start",GravityCoreCell.process,GravityCoreCell),Game.on("start",GravityCoreCell.process,GravityCoreCell)),Game.off("validMove",GravityCoreCell.validMove,GravityCoreCell),Game.on("validMove",GravityCoreCell.validMove,GravityCoreCell)},validMove:function(e){e.first.x===e.second.x?GravityCoreCell.moveDirection="vertical":e.first.y===e.second.y&&(GravityCoreCell.moveDirection="horizontal")}}),CannonCell=BaseCell.extend({constructor:function(e,t){BaseCell.call(this,e,t),this.removeOnRemoveNear=!1,this.movable=!1,this.removable=!1,this.indestructible=!0,this.name="cannon",this.coresCount=0,this.isActivated=!1,this.directions=[{id:1,direction:"left",angle:0,reflect:1},{id:2,direction:"top",angle:90,reflect:!1},{id:3,direction:"right",angle:0,reflect:-1},{id:4,direction:"bottom",angle:-90,reflect:!1}]},getTemplateClass:function(){return"cannonCell"},createDiv:function(e){var t=BaseCell.prototype.createDiv.call(this,e);return this.direction="left",t.set("scale-x",1),t.set("rotate",0),Game.on("removedItem",this.removeItemCallback,this),t},getBumpSide:function(e){var t=e.x-this.x,i=e.y-this.y,o=!1;return!t&&i?0<i?o="bottom":i<0&&(o="top"):!i&&t&&(0<t?o="right":t<0&&(o="left")),o},reflect:function(e,t){var i=this;if(e&&e!=i.$div.get("scale-x")){var o=this.$div.find(".cannonBg .cannon");o.removeClass().addClass("cannon"),o.addClass("reflect1").delay(250).queue(function(e){o.addClass("reflect2").delay(250).queue(function(e){o.removeClass().addClass("cannon").addClass("stable"),i.$div.set("scale-x",-1*i.$div.get("scale-x")),e(),t()}),e()})}else t()},processRotation:function(e,t){_.findWhere(this.directions,{direction:this.direction}),_.max(this.directions,function(e){return e.id});var i=_.findWhere(this.directions,{direction:e}),o=this;if(i)if(o.direction!=i.direction){o.direction=i.direction;var a=o.$div;application.playSound("cannonRotation");var n=Game.animate(function(){t()});i.angle!=a.get("rotate")?a.ourAnimate({rotate:i.angle},200,null,function(){a.set("rotate",i.angle),o.reflect(i.reflect,n)}):o.reflect(i.reflect,n)}else t();else t()},bump:function(e,o,a){var t=this.getBumpSide(e),i=Game.animate(_.bind(function(){var e=FigureView.createByTemplate(".invisible .gravitycoreCell");_Figure.blockedAnimations.append(e),e.alignTo(o),o.remove(),application.playSound("cannonBump");var t=this.$div.clone();_Figure.blockedAnimations.append(t),t.alignTo(this.$div),t.set("scale-x",this.$div.get("scale-x"));var i=this;e.ourAnimate({target:this.$div,scale:.5},600,"linear",function(){e.remove(),t.remove(),i.$div.find(".cannonBg .light").addClass("charged"),a&&a()})},this));this.processRotation(t,i),e.isLoaded=!0,++this.coresCount},removeNear:function(e,t,i,o,a){this.isBlocked("removeOnRemoveNear")||this.medusaBlocked||!o||_.each(a,function(e){Math.abs(e.x-this.x)+Math.abs(e.y-this.y)==1&&this.coresCount&&(this.isActivated=!0)},this)},removeItemCallback:function(e){!this.isBlocked("removable")&&!this.medusaBlocked&&this.coresCount&&e.removeWithPowerUp&&Math.abs(e.x-this.x)+Math.abs(e.y-this.y)==1&&this.coresCount&&(this.isActivated=!0)},shot:function(r,s){var l=this.direction;this.processRotation("top",_.bind(function(){var a=this,t=this.$div,n=FigureView.createByTemplate(".invisible .gravitycoreCell");_Figure.blockedAnimations.append(n),application.playSound("cannonShot"),n.alignTo(t),n.set("scale",.5),t.find(".cannonBg .light").removeClass("charged");var i=this.$div.clone();_Figure.blockedAnimations.append(i),i.alignTo(t),i.set("scale-x",t.get("scale-x")),t.set("opacity",0),i.find(".cannonBg").removeClass("stable"),i.find(".cannonBg .cannon").addClass("shot").delay(500).queue(function(e){t.set("opacity",1),i.remove(),n.ourAnimate({scale:1,target:r.$div,animation:Library.collectFly,options:{vy:500}},600,"linear",function(){var t,i,o;_.each([{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}],function(e){i=r.x+e.x,o=r.y+e.y,Game.inField(i,o)&&(t=Game.field[o][i]).isRemovable()&&t.remove()},this),n.remove(),r.remove(),Game.field[r.y][r.x]=void 0;var e=new GravityCoreCell(r.y,r.x,!1,void 0);e.forceRun=!0,Game.addItem(e),l!=this.direction?a.processRotation(l,s):s()}),t.find(".cannonBg").addClass("stable"),e()})},this))}},{chars:"%",process:function(){var t=[];Game.each(function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute||t.push(e)}),t=_.shuffle(t),Game.each(function(e){if(e instanceof CannonCell&&e.coresCount&&e.isActivated){for(;0<e.coresCount&&t.length;)e.shot(t.pop(),Game.animate()),--e.coresCount;e.isActivated=!1}})}}),ArrowCell=Cell.extend({constructor:function(e,t,i,o,a){switch(Cell.call(this,e,t,!1,a),this.needExplode=!0,i?application.level.map[e].charAt(t):o){case"-":this.dir="horizontal";break;case"|":this.dir="vertical";break;default:this.dir="both"}i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},isValidMove:function(e){return e instanceof ArrowCell},makeMove:function(e){e instanceof ArrowCell&&("both"===this.dir&&"both"===e.dir&&user.trigger("swapTwoCrossLightnings"),"both"!==this.dir&&"both"!==e.dir&&this.dir!==e.dir&&user.trigger("swapHorAndVertLightnings"),this.x===e.x&&"vertical"===this.dir&&"vertical"===e.dir&&(this.dir="horizontal"),this.y===e.y&&"horizontal"===this.dir&&"horizontal"===e.dir&&(this.dir="vertical"),this.remove(),e.remove())},beforeGameFinish:function(){if(this.isRemovable()&&!this.decorator)return this.remove(),!0},beforeRemove:function(){var e,t=[],i=_.uniqueId("arrow");if(this.needExplode){if(this.showPointsOnRemove+=GameScores.arrow,"vertical"===this.dir||"both"===this.dir)for(e=0;e<Config.rows;e++)Game.field[e][this.x]&&Game.field[e][this.x]!=this&&(Game.field[e][this.x]instanceof Cell&&!Game.field[e][this.x].decorator&&(this.showPointsOnRemove+=GameScores.cell),t.push(Game.field[e][this.x]));if("horizontal"===this.dir||"both"===this.dir)for(e=0;e<Config.cols;e++)Game.field[this.y][e]&&Game.field[this.y][e]!=this&&(Game.field[this.y][e]instanceof Cell&&!Game.field[this.y][e].decorator&&(this.showPointsOnRemove+=GameScores.cell),t.push(Game.field[this.y][e]));for(e=0;e<t.length;e++){var o=t[e];o.removeByArrow&&o.removeByArrow(i),o.bRemoveByArrow=i,o.removeById(i)}Game.set("score",Game.get("score")+GameScores.arrow),Game.trigger("beforeRemovedItem",this),Game.trigger("showFieldPoints",this.$div,this.showPointsOnRemove,"explodeArrowCell explodeCell_"+this.color)}},createDiv:function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.append(FigureView.createByTemplate(".invisible .arrow",["dir_"+this.dir])),this.decorator&&this.decorator.render(),t},animateSingle:function(e,t){var i=FigureView.createByTemplate(".invisible .lightning",[]);this.$div.parent().append(i),i.alignTo(this.$div),i.find(".leftLight").addClass("leftLight_"+e),i.find(".rightLight").addClass("rightLight_"+e),i.find(".centerLight").addClass("centerLight_"+e),i.find(".cell").addClass(this.calcColor()),t&&(t=Game.animate(t)),i.find(".leftLight").ruleAnimation.once("round",function(){i.remove(),t&&t()})},isGrowAbleOccupite:function(e){return e.decorator instanceof GrowDecorator||e instanceof ChocolateFarmCell||e instanceof SpiderwebFarmCell},animateRemoval:function(e){this.needExplode?("both"==this.dir?(application.playSound("arrowCellDoubleLightning"),this.animateSingle("vertical"),this.animateSingle("horizontal",e)):(application.playSound("arrowCellLightning"),this.animateSingle(this.dir,e)),this.$div.remove()):(this.$div.remove(),e())}});if(!GameClass.prototype.isValidMove)throw"include arrowcell.js after threeinrow.js";if(_.override(GameClass,{isValidMove:function(e){if(e.first instanceof ArrowCell||e.second instanceof ArrowCell){var t=e.first,i=e.second;if(e.first instanceof ArrowCell||(t=e.second,i=e.first),e.first instanceof ArrowCell&&t.isValidMove(i))return!0}return this.override.call(this,e)},makeMove:function(e){if(this.override.call(this,e),e.first instanceof ArrowCell||e.second instanceof ArrowCell){var t=e.first,i=e.second;e.first instanceof ArrowCell||(t=e.second,i=e.first),t.makeMove(i)}}}),!GameClass.prototype.isValidMove)throw"include multicolorcell.js after threeinrow.js";_.override(GameClass,{isValidMove:function(e){if(e.first instanceof MultiColorCell||e.second instanceof MultiColorCell){var t=e.first,i=e.second;return e.first instanceof MultiColorCell||(t=e.second,i=e.first),t.isValidMove(i)}return this.override.call(this,e)},makeMove:function(e){if(this.override.call(this,e),e.first instanceof MultiColorCell||e.second instanceof MultiColorCell){var t=e.first,i=e.second;e.first instanceof MultiColorCell||(t=e.second,i=e.first),t.makeMove(i)}}});var MultiColorCell=function(e,t,i){BaseCell.call(this,e,t),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))};_.extend(MultiColorCell.prototype,BaseCell.prototype),MultiColorCell.prototype.scoresId="multicolor",MultiColorCell.taskId="eaterstars",MultiColorCell.prototype.isValidMove=function(e){return!(e instanceof FireFlowerCell)&&(!(e instanceof EggCell)&&(e instanceof MultiColorCell||!!(e.getCurrentColor()&&"none"!==e.getCurrentColor()&&e.isMovable()&&e.isRemovable())))},MultiColorCell.prototype.makeMove=function(e){application.playSound("multiColorCellRemove");var t=_.uniqueId("multi");this.multiColorRemoveId=t,e.multiColorRemoveId=t,e instanceof MultiColorCell?(this.explodeMultiColors(e),user.trigger("swapTwoStars")):void 0!==ArrowCell&&e instanceof ArrowCell?(this.arrowRemoveDirection=e.dir,"horizontal"==this.arrowRemoveDirection&&user.trigger("swapHorLightningAndStar"),"vertical"==this.arrowRemoveDirection&&user.trigger("swapVertLightningAndStar"),"both"==this.arrowRemoveDirection&&user.trigger("swapCrossLightningAndStar"),this.remove(e.color)):e.getCurrentColor()&&this.remove(e.getCurrentColor())},MultiColorCell.prototype.beforeGameFinish=function(){if(this.isRemovable()&&!this.decorator)return this.remove(),!!this.colorToRemove},MultiColorCell.prototype.explodeMultiColors=function(t){var e,i=[],o=[];for(Game.each(function(e){e!=this&&e!=t&&e.isRemovable()&&!e.notRemoveByTwoMulticolors&&(Math.random()<.5?i.push(e):o.push(e))},this),Game.set("score",Game.get("score")+2*GameScores.multicolor),e=0;e<o.length;e++)t.explodeOneCell(o[e]);for(t.showFieldPoints(GameScores.multicolor+t.getFieldPoints(o),"W"),BaseCell.prototype.remove.call(t,!0),e=0;e<i.length;e++)this.explodeOneCell(i[e]);this.showFieldPoints(GameScores.multicolor+this.getFieldPoints(i),"W"),BaseCell.prototype.remove.call(this,!0)},MultiColorCell.prototype.getFieldPoints=function(e){for(var t=0,i=0;i<e.length;i++)e[i]instanceof Cell&&(!e[i].decorator||"changecolor"==e[i].getDecoratorName())&&(t+=GameScores.cell);return t},MultiColorCell.prototype.getSmallFireAnimateSpeed=function(){return 2*Game.get("speed")+150*Math.random()},MultiColorCell.prototype.createSmallFire=function(){var e=FigureView.createByTemplate(".invisible .smallFire",[]);return _Figure.blockedAnimations.append(e),e.alignTo(this.$div),e},MultiColorCell.prototype.explodeOneCell=function(i,o){var a=this,n=Game.animate();this.createSmallFire().ourAnimate({target:i.$div},this.getSmallFireAnimateSpeed(),"easeInQuad").queue(function(e){if(this.remove(),i.life){var t=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(t),t.alignTo(i.$div),t.addStyleAnimate("multicolorExplode",function(){t.remove()}),canvas.timeManager.setTimeout(function(){if(a.arrowRemoveDirection&&0<i.life&&o<3&&(!i.decorator||i.decorator.isArrowAllowed())){var t=a.arrowRemoveDirection;"both"!=t&&(t=Math.random()<.5?"horizontal":"vertical"),i instanceof ArrowCell?(i.$div.find(".arrow").removeClass("dir_"+i.dir).addClass("dir_both"),i.dir="both"):i.$div.append(FigureView.createByTemplate(".invisible .arrow").addClass("dir_"+t)),canvas.timeManager.setTimeout(function(){if(i instanceof ArrowCell)i.remove();else{i.$div.find(".arrow").remove(),i.remove(!0);var e=new ArrowCell(i.y,i.x,!1,"-",i.color);e.dir=t,e.createDiv(),e.remove()}n()},150*o+300)}else 0<i.life&&(i.multiColorRemoveId=a.multiColorRemoveId,i.remove()),n()},125)}else n();e()})},MultiColorCell.prototype.showFieldPoints=function(e,t){Game.trigger("showFieldPoints",this.$div,e,"explodeMulticolorCell explodeCell_"+t)},MultiColorCell.prototype.onAfterRemove=function(e){},MultiColorCell.prototype.afterRemove=function(){var t=[];Game.each(function(e){e.getCurrentColor()===this.colorToRemove&&t.push(e)},this),t=_.shuffle(t),this.showFieldPoints(GameScores.multicolor+this.getFieldPoints(t),this.colorToRemove);for(var e=0;e<t.length;e++)t[e].decorator&&"changecolor"!=t[e].getDecoratorName()||Game.neighbors(t[e],_.bind(function(e){e.getCurrentColor()!==this.colorToRemove&&e.removeNear(void 0,this.colorToRemove,this.id)},this)),this.explodeOneCell(t[e],e);Game.set("score",Game.get("score")+GameScores.multicolor),this.onAfterRemove(t)},MultiColorCell.prototype.isGrowAbleOccupite=function(e){return e.decorator instanceof ChocolateDecorator||e instanceof ChocolateFarmCell},MultiColorCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return this.decorator&&this.decorator.render(),t},MultiColorCell.prototype.remove=function(e){if(this.isBlocked("removable"))return!1;if(this.decorator)return this.decorator.remove(),!0;if(void 0!==e)this.colorToRemove=e;else{var t=[];Game.each(function(e){e.getCurrentColor()&&"none"!==e.getCurrentColor()&&!e.notRemoveByMulticolor&&t.push(e.getCurrentColor())}),0<(t=_.uniq(t)).length&&(this.colorToRemove=RANDOM(t))}Game.neighbors(this,_.bind(function(e){e.removeNear(void 0,this.colorToRemove,this.id)},this)),BaseCell.prototype.remove.call(this)},MultiColorCell.prototype.animateRemoval=function(e){application.playSound("multiColorCellRemove"),this.$div.fadeOut(3*Game.get("speed"),function(){this.remove()}),e&&e()},MultiColorCell.prototype.getTemplateClass=function(){return"multicolorCell"};var BombCell=function(e,t,i){Cell.call(this,e,t,!1),this.movesToExplode=application.level.bombExplodeMoves,this.movesToExplodeDelay=0,i||(this.movesToExplodeDelay=1),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))};_.extend(BombCell.prototype,Cell.prototype),BombCell.isActiveBomb=function(e){return(e instanceof BombCell||e instanceof BombAutoNewCell)&&!(e.decorator&&(e.decorator instanceof HideDecorator||e.decorator instanceof GrowDecorator||e.decorator instanceof StickyChainDecorator||e.decorator instanceof EelDecorator))},BombCell.process=function(){Game.once("endTurn",function(){if(Game.get("running")){var t=!1;if(Game.each(function(e){BombCell.isActiveBomb(e)&&e.decMovesToExplode()&&(t=!0)}),t){Game.set("running",!1);var e,i=[];Game.each(function(e){BombCell.isActiveBomb(e)&&i.push(e.color)}),i=_.uniq(i),e=RANDOM(i),new BombExplodeWindow({color:e})}}})},BombCell.addBombMoves=function(t){Game.each(function(e){BombCell.isActiveBomb(e)&&(e.movesToExplode+=t,e.drawMovesToExplode())})},BombCell.explodeBomb=function(e){var t=[];Game.each(function(e){BombCell.isActiveBomb(e)&&0===e.movesToExplode&&t.push(e)}),0<t.length&&t[0].explodeAnimation(t,e)},BombCell.prototype.isGrowAbleOccupite=function(e){return!0},BombCell.prototype.beforeRemove=function(){Game.set("score",Game.get("score")+GameScores.bomb),Game.trigger("showFieldPoints",this.$div,GameScores.bomb,"explodeBombCell explodeCell_"+this.color)},BombCell.prototype.getDirectionCls=function(e){return 0===e.x&&0===e.y?"epicenter":Math.abs(e.x)===Math.abs(e.y)?(e.x<0?"left":"right")+(e.y<0?"up":"down"):Math.abs(e.x)>Math.abs(e.y)?e.x<0?"left":"right":e.y<0?"up":"down"},BombCell.prototype.explodeAnimation=function(s,e){var l=0,d={};Game.each(function(i){var a,e,n,t,o=1e3,r={};_.each(s,function(e){var t=Math.max(Math.abs(i.y-e.y),Math.abs(i.x-e.x));t<o&&(o=t,r.y=i.y-e.y,r.x=i.x-e.x)}),a=i,n=r,t=400,0<(e=o)&&(t+=300),1<e&&(t+=300),2<e&&(t+=250*(e-2)),d[t]||(d[t]=!0,canvas.timeManager.setTimeout(function(){application.playSound("bombCellExplode")},t)),l<t&&(l=t),a.$div.delay(t).queue(function(e){var t=BombCell.prototype.getDirectionCls(n),i=FigureView.findById("floor_"+a.y+"_"+a.x);i&&i.remove();var o=FigureView.createByTemplate(".invisible .bombExplode");_Figure.blockedAnimations.append(o),o.alignTo(this),o.addClass(t),this.remove(),a instanceof PizzaCell&&$("#pizzaEl"+a.id).remove(),o.sprite.once("round",function(){o.remove()}),e()})}),canvas.timeManager.setTimeout(e,l+800)},BombCell.prototype.drawMovesToExplode=function(){this.movesToExplode<=2?this.$div.addClass("bombSoonExplode"):this.$div.removeClass("bombSoonExplode"),10<=this.movesToExplode?this.$div.addClass("movesToExplodeTwoDigits"):this.$div.removeClass("movesToExplodeTwoDigits"),this.movesToExplodeDiv.html(this.movesToExplode)},BombCell.prototype.decMovesToExplode=function(){return 0<this.movesToExplodeDelay?this.movesToExplodeDelay--:this.movesToExplode--,this.drawMovesToExplode(),0===this.movesToExplode},BombCell.prototype.getTemplateClass=function(){return"bombCell"},BombCell.prototype.createDiv=function(e){return Cell.prototype.createDiv.call(this,e),this.movesToExplodeDiv=this.$div.find(".movesToExplode"),this.drawMovesToExplode(),this.$div},BombCell.prototype.drawMovesToExplode=function(){this.movesToExplode<=2?(this.$div.addClass("bombSoonExplode"),this.$div.find(".bombDangerHighlight").addClass("bombSoonExplode"),this.$div.find(".movesToExplode").addClass("bombSoonExplode")):(this.$div.removeClass("bombSoonExplode"),this.$div.find(".bombDangerHighlight").removeClass("bombSoonExplode"),this.$div.find(".movesToExplode").removeClass("bombSoonExplode")),10<=this.movesToExplode?this.$div.addClass("movesToExplodeTwoDigits").find(".movesToExplode").addClass("movesToExplodeTwoDigits"):this.$div.removeClass("movesToExplodeTwoDigits").find(".movesToExplode").removeClass("movesToExplodeTwoDigits"),this.$div.addClass("movesToExplode"+this.movesToExplode),this.movesToExplodeDiv.html(this.movesToExplode)},BombCell.prototype.createDiv=function(e){return Cell.prototype.createDiv.call(this,e),this.movesToExplodeDiv=this.$div.find(".movesToExplode"),this.drawMovesToExplode(),this.$div.addClass("TNT"),this.$div},BombCell.prototype.decMovesToExplode=function(){return!this.isBlocked("movable")&&(!this.medusaBlocked&&((!this.decorator||"crabBomb"!=this.decorator.get("name")&&"seaweed"!=this.decorator.get("name"))&&(0<this.movesToExplodeDelay?this.movesToExplodeDelay--:this.movesToExplode--,this.drawMovesToExplode(),0===this.movesToExplode)))},BombCell.prototype.calcColor=function(){return"color_"+(this.saveColor||this.color)};var BombAutoNewCell=function(e,t,i){BombCell.call(this,e,t,i)};BombAutoNewCell.prototype=Object.create(BombCell.prototype),BombAutoNewCell.prototype.constructor=BombAutoNewCell,BombAutoNewCell.prototype.remove=function(){this.decorator?Cell.prototype.remove.call(this):(this.refill(),BaseCell.prototype.remove.call(this))},BombAutoNewCell.prototype.refill=function(){Game.fallDownSpecialCells.push({offset:Math.floor(3*Math.random()+1),cellClass:BombAutoNewCell})};var ChocolateFarmCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removable=!1};_.extend(ChocolateFarmCell.prototype,BaseCell.prototype),ChocolateFarmCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.addClass("chocolateFarm").addClass("stable"),t},ChocolateFarmCell.prototype.animateOccupation=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:600;this.$div.removeClass("stable").addClass("occupation").delay(e).queue(function(e){t.$div.removeClass("occupation"),t.$div.addClass("stable"),e()})};var PizzaCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.life=3,this.removeLifeAnimation=0};_.extend(PizzaCell.prototype,BaseCell.prototype);var PizzaLUCell=function(e,t){PizzaCell.call(this,e,t),this.dx=0,this.dy=0};PizzaLUCell.prototype=PizzaCell.prototype;var PizzaRUCell=function(e,t){PizzaCell.call(this,e,t),this.dx=1,this.dy=0};PizzaRUCell.prototype=PizzaCell.prototype;var PizzaLDCell=function(e,t){PizzaCell.call(this,e,t),this.dx=0,this.dy=1};PizzaLDCell.prototype=PizzaCell.prototype;var PizzaRDCell=function(e,t){PizzaCell.call(this,e,t),this.dx=1,this.dy=1};PizzaRDCell.prototype=PizzaCell.prototype,PizzaCell.prototype.isDead=function(){for(var e=0;e<2;e++)for(var t=0;t<2;t++)if(0!==Game.field[t+this.y-this.dy][e+this.x-this.dx].life||0!==Game.field[t+this.y-this.dy][e+this.x-this.dx].removeLifeAnimation)return!1;return!0},PizzaCell.prototype.highlight=function(e){for(var t=0;t<2;t++)for(var i=0;i<2;i++)BaseCell.prototype.highlight.call(Game.field[i+this.y-this.dy][t+this.x-this.dx],e)},PizzaCell.prototype.animateTakeLife=function(e,t){e.$div.find(".pizzaHead").removeClass("stable").addClass("pizzaOuch");var i=this.$div.find(".pizzaLife"+this.life);i.addClass("pizzaTakeLife"),canvas.timeManager.setTimeout(function(){i.removeClass("pizzaTakeLife").addClass("pizzaLifeDone")},260),application.playSound("pizzaCellTakeLife"),canvas.timeManager.setTimeout(function(){e.$div.find(".pizzaHead").removeClass("pizzaOuch").addClass("stable")},500),t()},PizzaCell.prototype.animateRemoval=function(e,t,i){application.playSound("pizzaCellRemove");var o=GameBaseView.createFallDownExplodePiece("diePizza");o.append(FigureView.createByTemplate(".invisible .diePizza")),o.alignTo(Game.field[t][e].$div),gameView.fallDownExplodePiece(o),canvas.timeManager.setTimeout(i,3*Game.get("speed"))},PizzaCell.prototype.isMedusaBlocked=function(){for(var e=0;e<2;e++)for(var t=0;t<2;t++){var i=t+this.y-this.dy,o=e+this.x-this.dx;if(Game.field[i]&&Game.field[i][o]&&Game.field[i][o].medusaBlocked)return!0}return!1},PizzaCell.prototype.getLastCell=function(){return Game.getField(this.x-this.dx+1,this.y-this.dy+1)},PizzaCell.prototype.remove=function(){!this.isBlocked("removable")&&!this.isMedusaBlocked()&&0<this.life&&(this.removeLifeAnimation++,this.life--,this.animateTakeLife(this.getLastCell(),Game.animate(function(){if(this.removeLifeAnimation--,this.isDead()){this.animateRemoval(this.x-this.dx,this.y-this.dy,Game.animate()),Game.trigger("pizzaCellRemoved",this);for(var e=0;e<2;e++)for(var t=0;t<2;t++)BaseCell.prototype.executeRemove.call(Game.field[t+this.y-this.dy][e+this.x-this.dx],!0)}},this)))},PizzaCell.prototype.getTemplateClass=function(){return"pizzaCell"},PizzaCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this);return t.addClass("pizzaType_"+this.dx+"_"+this.dy).addClass("pizzaLife"+this.life),1==this.dx&&1==this.dy&&this.$div.append(FigureView.createByTemplate(".invisible .pizzaHead")),t};var FlowerCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.life=2,this.removeLifeAnimation=0,this.scoresId="flower"};_.extend(FlowerCell.prototype,PizzaCell.prototype);var FlowerLUCell=function(e,t){FlowerCell.call(this,e,t),this.dx=0,this.dy=0,this.mainPart=!0};FlowerLUCell.prototype=FlowerCell.prototype;var FlowerRUCell=function(e,t){FlowerCell.call(this,e,t),this.dx=1,this.dy=0};FlowerRUCell.prototype=FlowerCell.prototype;var FlowerLDCell=function(e,t){FlowerCell.call(this,e,t),this.dx=0,this.dy=1};FlowerLDCell.prototype=FlowerCell.prototype;var FlowerRDCell=function(e,t){FlowerCell.call(this,e,t),this.dx=1,this.dy=1};FlowerRDCell.prototype=FlowerCell.prototype,FlowerCell.prototype.animateTakeLife=function(e,t){var i=this.$div.find(".flowerLife"+this.life);i.addClass("flowerTakeLife"),canvas.timeManager.setTimeout(function(){i.removeClass("flowerTakeLife").addClass("flowerLifeDone")},350),application.playSound("flowerCellTakeLife"),t()},FlowerCell.prototype.getDieDiv=function(){var e=FigureView.createByTemplate(".invisible .flowerHead");return e.addClass("die"),e},FlowerCell.prototype.animateRemoval=function(e,t,i){application.playSound("flowerCellRemove");var o=GameBaseView.createFallDownExplodePiece("dieFlower");o.append(FigureView.createByTemplate(".invisible .dieFlower")),o.alignTo(Game.field[t][e].$div),gameView.fallDownExplodePiece(o),canvas.timeManager.setTimeout(i,3*Game.get("speed"))},FlowerCell.prototype.getTemplateClass=function(){return"flowerCell"},FlowerCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this);return t.addClass("flowerType_"+this.dx+"_"+this.dy).addClass("flowerLife"+this.life),0===this.dx&&0===this.dy||this.$div.find(".flowerHead").remove(),t};var ChestCell=function e(t,i){BaseCell.call(this,t,i),this.color="none",this.movable=!1,this.removable=!1,this.scoresId="chest";var o=application.level.map[t].charAt(i);this.chestColor=e.getColorByCode(o),this.life=application.level["chest".concat(this.chestColor,"Life")]||3,this.removeItemCallback=function(e){!this.isBlocked("removable")&&!this.medusaBlocked&&0<this.life&&e.getCurrentColor()===this.chestColor&&Math.abs(e.x-this.x)+Math.abs(e.y-this.y)===1&&(1<this.life?this.hit():this.needOpen=!0)},Game.on("removedItem",this.removeItemCallback,this)};ChestCell.getColorByCode=function(e){return{"":"R","":"G","":"B","":"Y","":"P","":"W"}[e]},_.extend(ChestCell.prototype,BaseCell.prototype),ChestCell.prototype.drawLife=function(){9<this.life?this.$div.find(".needToOpen").addClass("twoDigit"):this.$div.find(".needToOpen").removeClass("twoDigit"),this.$div.find(".needToOpen").html(this.life)},ChestCell.prototype.animateTakeLife=function(e){this.drawLife(),e()},ChestCell.prototype.getTemplateClass=function(){return"chestCell"},ChestCell.prototype.createDiv=function(e){var t=Cell.prototype.createDiv.call(this);return this.drawLife(),t.addClass("chestColor_"+this.chestColor),t},ChestCell.prototype.hit=function(){this.removable=!0,this.remove(),this.removable=!1},ChestCell.prototype.open=function(){this.hit(),Game.off("removedItem",this.removeItemCallback,this)},ChestCell.prototype.animateRemoval=function(o){var e,a,n=this;ChestCell.targets.length&&(e=ChestCell.targets.pop()),a=e?{x:e.x,y:e.y}:{x:this.x,y:this.y};var t=this.$div.clone();_Figure.blockedAnimations.append(t),t.set({"margin-left":0,"margin-top":0}),t.alignTo(this.$div),this.$div.queue(function(e){this.remove(),n.trigger("remove"),e()}),t.find(".needToOpen").remove(),t.addClass("beforeRemove"),t.find(".microStones").addClass("beforeRemove"),application.playSound("chestOpen"),t.sprite.once("round",function(){application.playSound("chestOpened"),application.playSound("multicolorcollect");var i=FigureView.createByTemplate(".invisible .defaultCell");i.addClass("multicolor"),_Figure.blockedAnimations.append(i),i.css({scale:.8}),i.alignTo(t,{ajust:{x:0,y:-38}}),t.removeClass("beforeRemove"),t.find(".microStones").removeClass("beforeRemove"),t.addClass("afterRemove"),t.find(".microStones").addClass("afterRemove");var e=function(){var e;application.playSound("chestStarCreated");var t=Game.field[a.y][a.x];t instanceof Cell&&!t.decorator?(t.bRemoveByChest=!0,t.remove(!0),e=new MultiColorCell(a.y,a.x)):e=new MultiColorCell(n.y,n.x),Game.addItem(e,!0),i.remove(),o()};(n.x!=a.x||n.y!=a.y)&&Game.field[a.y][a.x]&&Game.field[a.y][a.x].$div?i.ourAnimate({target:Game.field[a.y][a.x].$div,scale:1},2.3*i.distanceTo(Game.field[a.y][a.x].$div),"linear",_.bind(e,this)):i.ourAnimate({target:t,scale:1},2.3*i.distanceTo(t),"linear",e),t.fadeOut(300,function(){t.remove()})})},ChestCell.process=function(){ChestCell.targets=[],Game.each(function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute||e.medusaBlocked||e.isBlocked("movable")||ChestCell.targets.push(e)}),ChestCell.targets=_.shuffle(ChestCell.targets),ChestCell.targets.length&&Game.each(function(e){if(!(e instanceof ChestCell&&e.needOpen))return!1;e.open()})};var TornadoCell=function(e,t){BaseCell.call(this,e,t),this.removable=!1,this.movable=!1};_.extend(TornadoCell.prototype,BaseCell.prototype),TornadoCell.prototype.getTemplateClass=function(){return"tornadoCell"},TornadoCell.prototype.moveTornado=function(i,o,a){var n=FigureView.createByTemplate(".invisible .flyTornado");_Figure.blockedAnimations.append(n),n.alignTo(this.$div),this.$div.find(".tornado").remove(),n.ourAnimate({target:i.$div},2*this.$div.distanceTo(i.$div),"linear",function(){o(),application.playSound("tornadoCellMove"),i.$div.find(".cellStone").fadeOut(300);var e=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("afterTornado");e.hide(),i.$div.append(e),e.fadeIn(300);var t=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("tornadoExplode");i.$div.append(t),i.$div.delay(400).queue(function(e){this.remove(),e(),n.remove(),a()})})},TornadoCell.process=function(){for(var a=[],e=0;e<Config.rows;e++){a.push([]);for(var t=0;t<Config.cols;t++)a[e].push(!1)}var n=0;Game.each(function(e){if(e instanceof TornadoCell&&!a[e.y][e.x]&&!e.medusaBlocked&&!e.isBlocked("movable")){var t=[];if(Game.each(function(e){e.constructor!==Cell||e.decorator||e.medusaBlocked||e.isBlocked("movable")||a[e.y][e.x]||0!==Game.floor[e.y][e.x]||e.attribute||t.push(e)}),t.length){n++;i=e,o=RANDOM(t),a[o.y][o.x]=!0,i.moveTornado(o,function(){--n||application.stopSound("tornadoCellProcess")},Game.animate(function(){var e=new AfterTornadoCell(i.y,i.x);Game.addItem(e,!1),e.$div=i.$div,i.x=o.x,i.y=o.y,i.createDiv(),Game.field[o.y][o.x]=i},Game))}}var i,o}),n&&application.playSound("tornadoCellProcess")};var AfterTornadoCell=function(e,t){BaseCell.call(this,e,t),this.removable=!1,this.movable=!1};_.extend(AfterTornadoCell.prototype,BaseCell.prototype),AfterTornadoCell.prototype.animateRemoval=function(e){application.playSound("afterTornadoCellRemove"),this.$div.find(".afterTornado").addClass("afterTornadoHide").sprite.once("round",_.bind(function(){e(),this.$div.remove()},this))},AfterTornadoCell.process=function(){Game.each(function(e){e instanceof AfterTornadoCell&&(e.removable=!0,e.remove())})};var CrabFarmCell=function e(t,i){BaseCell.call(this,t,i),this.color="none",this.movable=!1,this.removable=!1,this.level=Math.floor(Math.random()*e.MAXLEVEL)};CrabFarmCell.MAXLEVEL=3,_.extend(CrabFarmCell.prototype,BaseCell.prototype),CrabFarmCell.prototype.getTemplateClass=function(){return"crabFarmCell"},CrabFarmCell.prototype.createDiv=function(e){var t=Cell.prototype.createDiv.call(this);return t.addClass("crabFarmLevel"+this.level).find(".crabFarmCellCrab").addClass("stable"),t},CrabFarmCell.prototype.createCrab=function(e,t){application.playSound("crabFarmCellCreateCrab"),this.$div.removeClass("crabFarmLevel"+CrabFarmCell.MAXLEVEL).addClass("crabFarmLevel0");var i=FigureView.createByTemplate(".invisible .crabFarmCreateCrab");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({target:e.$div},500,"linear",function(){i.remove(),t()})},CrabFarmCell.prototype.incCrabFarmLevel=function(){this.level++,this.$div.removeClass("crabFarmLevel"+(this.level-1)).addClass("crabFarmLevel"+this.level).find(".crabFarmCellCrab").removeClass("stable").addClass("crabFarmMove").sprite.once("round",_.bind(function(){this.$div.find(".crabFarmCellCrab").removeClass("crabFarmMove").addClass("stable")},this))},CrabFarmCell.process=function(){for(var o=[],e=0;e<Config.rows;e++){o.push([]);for(var t=0;t<Config.cols;t++)o[e].push(!1)}Game.each(function(e){if(e instanceof CrabFarmCell)if(e.level<CrabFarmCell.MAXLEVEL)e.incCrabFarmLevel();else{var t=[];if(Game.neighbors(e,function(e){!(e instanceof Cell||e instanceof TwinkleCell&&!e.active)||e.decorator||o[e.y][e.x]||t.push(e)}),t.length){var i=RANDOM(t);o[i.y][i.x]=!0,e.level=0,CrabDecorator.occupite(i),e.createCrab(i,Game.animate(function(){i.decorator.render(i.$div)},Game))}}})};var CrabMouseFarmCell=function e(t,i){BaseCell.call(this,t,i),this.color="none",this.movable=!1,this.removable=!1,Config.crabMouseFarmAppearEpisode===episode.get("num")&&application.level.num===Config.crabMouseFarmAppearLevel?this.level=3:this.level=Math.floor(Math.random()*e.MAXLEVEL)};CrabMouseFarmCell.MAXLEVEL=3,_.extend(CrabMouseFarmCell.prototype,BaseCell.prototype),CrabMouseFarmCell.prototype.getTemplateClass=function(){return"crabMouseFarmCell"},CrabMouseFarmCell.prototype.createDiv=function(e){var t=Cell.prototype.createDiv.call(this);return t.addClass("crabMouseFarmLevel"+this.level).find(".crabMouseFarmCellCrabMouse").addClass("stable"),t},CrabMouseFarmCell.prototype.createCrabMouse=function(e,t){application.playSound("crabMouseFarmCellCreateCrabMouse"),this.$div.removeClass("crabMouseFarmLevel"+CrabMouseFarmCell.MAXLEVEL).addClass("crabMouseFarmLevel0");var i=FigureView.createByTemplate(".invisible .crabMouseFarmCreateCrabMouse");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({target:e.$div},500,"linear",function(){i.remove(),t()})},CrabMouseFarmCell.prototype.incCrabMouseFarmLevel=function(){this.level++,this.$div.removeClass("crabMouseFarmLevel"+(this.level-1)).addClass("crabMouseFarmLevel"+this.level).find(".crabMouseFarmCellCrabMouse").removeClass("stable").addClass("crabMouseFarmMove").sprite.once("round",_.bind(function(){this.$div.find(".crabMouseFarmCellCrabMouse").removeClass("crabMouseFarmMove").addClass("stable")},this))},CrabMouseFarmCell.process=function(){for(var o=[],e=0;e<Config.rows;e++){o.push([]);for(var t=0;t<Config.cols;t++)o[e].push(!1)}Game.each(function(e){if(e instanceof CrabMouseFarmCell)if(e.level<CrabMouseFarmCell.MAXLEVEL)e.incCrabMouseFarmLevel();else{var t=[];if(Game.neighbors(e,function(e){e instanceof Cell&&!e.decorator&&!o[e.y][e.x]&&t.push(e)}),t.length){var i=RANDOM(t);o[i.y][i.x]=!0,e.level=0,CrabMouseDecorator.occupite(i,2,2),e.createCrabMouse(i,Game.animate(function(){i.decorator.render(i.$div)},Game))}}})};var FarmCell=BaseCell.extend({name:"none",color:"none",movable:!1,removable:!1,energyGenerate:1,energy:0,supply:1/0,generatedItems:0,createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.addClass("FarmLevel"+this.energy).find(".farmCell").addClass("stable"),e},upEnergy:function(){this.isGenerate()&&(++this.energy,this.$div.removeClass("FarmLevel"+(this.energy-1)).addClass("FarmLevel"+this.energy).find(".farmCell").removeClass("stable").addClass("FarmMove").sprite.once("round",_.bind(function(){this.$div.find(".farmCell").removeClass("FarmMove").addClass("stable")},this)))},getTargetCell:function(){return this},setStats:function(e){this.supply=application.level[this.name+"Supply"+e]||1/0,this.lives=application.level[this.name+"Lives"+e]||2},generate:function(e,t){application.playSound(this.name+"CellCreateItem"),this.$div.removeClass("FarmLevel"+this.energyGenerate).addClass("FarmLevel"+this.energy);var i=FigureView.createByTemplate(".invisible ."+this.name+"CellCreateItem");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({target:e.$div},500,"linear",function(){i.remove(),t()})},isGenerate:function(){return!0},processGenerate:function(){throw new Error("no implementation method processGenerate")}},{process:function(){for(var o=[],e=0;e<Config.rows;e++){o.push([]);for(var t=0;t<Config.cols;t++)o[e].push(!1)}Game.each(function(e){if(e instanceof FarmCell&&e.supply>e.generatedItems)if(e.energy<e.energyGenerate)e.upEnergy();else{var t=[];if(Game.neighbors(e,function(e){e instanceof Cell&&!e.decorator&&!o[e.y][e.x]&&t.push(e)}),t.length){var i=RANDOM(t);o[i.y][i.x]=!0,e.energy=0,e.generate(i,Game.animate(function(){e.processGenerate(i)}))}}})}}),MouseFarmCell=FarmCell.extend({name:"mouseFarm",energyGenerate:3,constructor:function(e,t){FarmCell.call(this,e,t),this.movable=!1,this.removable=!1,this.generatedItems=0,this.setStats(MouseFarmCell.chars.indexOf(application.level.map[this.y].charAt(this.x))+1),this.energy=Math.floor(Math.random()*this.energyGenerate)},getTemplateClass:function(){return"mouseFarmCell"},isGenerate:function(){return!this.decorator},processGenerate:function(e){++this.generatedItems,e.decorator=new CrabMouseDecorator({cell:e,level:this.lives}),e.decorator.render(e.$div)}},{chars:""}),SpiderwebFarmCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removable=!1};_.extend(SpiderwebFarmCell.prototype,BaseCell.prototype),SpiderwebFarmCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.addClass("spiderwebFarm"),t};var CrystalCell=DroppableCell.extend({getTemplateClass:function(){return"crystalCell"},createDiv:function(e){return Game.on("endTurn",this.checkDroppedCells,this),DroppableCell.prototype.createDiv.call(this,e)},afterRemove:function(){DroppableCell.prototype.afterRemove.call(this),Game.off("endTurn",this.checkDroppedCells,this)},animateRemoval:function(e){application.playSound("crystalCellRemove"),Game.trigger("removedAttribute_crystal",this),0<Game.get("fallDownCrystalCells")&&(Game.set("fallDownCrystalCells",Game.get("fallDownCrystalCells")-1),Game.fallDownSpecialCells.push({offset:Math.floor(2*Math.random()+1),cellClass:CrystalCell})),this.$div.remove(),e()}}),PumpkinCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.life=application.level.pumpkinLife1||5,this.maxLife=application.level.pumpkinLife1||5};_.extend(PumpkinCell.prototype,BaseCell.prototype),PumpkinCell.prototype.getTemplateClass=function(){return"pumpkinCell"},PumpkinCell.process=function(){var e=gameView.tasksView.tasks;if(e){var t=e.findWhere({type:"ClearCellAttributes"});t&&!t.get("completed")&&Game.each(function(e){e instanceof PumpkinCell&&!e.isBlocked()&&e.process()})}},PumpkinCell.prototype.animateTakeLife=function(e){var t=this;application.playSound("pumpkinCellTakeLife");var i=this.$div.find(".pumpkin");this.$div.clearQueue(),this.$div.queue(function(e){i.removeClass("stableAnimation"),i.addClass("pumpkinDamage"),e()}).delay(400).queue(function(e){i.removeClass("pumpkinDamage").addClass("stableAnimation"),t._isBonusWorld()?t.renderLife():t.$div.find(".pumpkinLife").html(t.life),e()}),e()},PumpkinCell.prototype.animateRemoval=function(t){application.playSound("pumpkinCellRemove");var i=this.$div.find(".pumpkin");i.find(".pumpkinLife").html(""),this.$div.queue(function(e){i.addClass("pumpkinDie"),e()}).delay(500).queue(function(e){t(),i.remove(),e()})},PumpkinCell.prototype.animateProcess=function(t,i){application.playSound("pumpkinCellProcess"),this.$div.find(".pumpkin").removeClass("stableAnimation").addClass("pumpkinShot").delay(500).queue(function(e){this.removeClass("pumpkinShot").addClass("stableAnimation"),e()}),canvas.timeManager.setTimeout(_.bind(function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("cannonball");_Figure.blockedAnimations.append(e),e.alignTo(this.$div),e.ourAnimate({target:t.$div},1.5*e.distanceTo(t.$div),"linear",function(){e.addClass("cannonballExplosion"),i(),e.delay(400).queue(function(e){this.remove(),e()})})},this),300)},PumpkinCell.prototype.process=function(){var t=[];if(Game.each(function(e){e.constructor!==Cell||e.decorator||e.attribute||e.isBlocked("overTile")||t.push(e)}),0<t.length){var i=RANDOM(t);i.attribute="key",this.animateProcess(i,Game.animate(function(){var e=FigureView.createByTemplate(".invisible .attribute_key",[]);i.$div.append(e);var t=gameView.tasksView.tasks.findWhere({type:"ClearCellAttributes"});t.set("amount",t.get("amount")+1)},this))}},PumpkinCell.prototype.createDiv=function(){var e=FigureView.createByTemplate(".invisible ."+this.getTemplateClass());return e.addClass("color_"+this.color),e.find(".pumpkinLife").html(this.life),_Figure.field.append(e),e.set(this.getCoords()),this.$div=e},PumpkinCell.prototype.renderLife=function(){this.$div.find(".lifeBar").set("width",Math.round(this.life/this.maxLife*(46/60*Config.cellWidth))),1<this.maxLife&&(this.$div.removeClass("lifeLevel"+this.life+1).addClass("lifeLevel"+this.life),this.$div.find(".pumpkinLife").html(this.life)),this.$div.find(".lifeBar").removeClass("less50PercentLife less25PercentLife").addClass(this.lifeClass())},PumpkinCell.prototype._isBonusWorld=function(){return-1!==_.findIndex(Config.bonusWorlds,function(e){return e.name===episode.get("num")})},PumpkinCell.prototype.lifeClass=function(){return 50<Math.round(100*this.life/this.maxLife)?"less100PercentLife":Math.round(100*this.life/this.maxLife)<=25?"less25PercentLife":Math.round(100*this.life/this.maxLife)<=50&&"less50PercentLife"};var GhostCell=function e(t,i){BaseCell.call(this,t,i),this.color="none",this.movable=!1,this.removable=!1,this.level=application.level.ghostLevel||Math.floor(Math.random()*e.MAXLEVEL),29===episode.get("num")&&1===application.level.num&&(this.level=e.MAXLEVEL-1)};GhostCell.MAXLEVEL=3,_.extend(GhostCell.prototype,BaseCell.prototype),GhostCell.prototype.ghostIncLevel=function(t){application.playSound("ghostCellIncLevel"),this.$div.addClass("ghostNextSize").removeClass("ghostLevel"+(this.level-1)).addClass("ghostLevel"+(this.level-1)+"NextSize").delay(100).queue(_.bind(function(e){this.$div.removeClass("ghostNextSize").removeClass("ghostLevel"+(this.level-1)+"NextSize").addClass("ghostLevel"+this.level),t(),e()},this))},GhostCell.prototype.ghostUpFishesAnimation=function(t){application.playSound("ghostCellUpFish"),this.$div.addClass("ghostUpFishesAnimation").delay(600).queue(function(e){e(),this.removeClass("ghostUpFishesAnimation").removeClass("ghostLevel"+(GhostCell.MAXLEVEL-1)).addClass("ghostGrowDown").delay(500).queue(function(e){this.removeClass("ghostGrowDown").addClass("ghostLevel0"),e()}),t()})},GhostCell.prototype.ghostUpFish=function(e,t,i){var o=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("ghostFishLight");0===t.$div.queue().length&&t.$div.delay(300),t.$div.ourAnimate({dy:Config.cellHeight},150,"linear"),e.$div.append(o),e.$div.delay(300).ourAnimate({dy:-Config.cellHeight},300,"linear",function(){o.remove(),i()}),Game.field[e.y][e.x]=t,Game.field[t.y][t.x]=e,t.y++,e.y--},GhostCell.prototype.getTemplateClass=function(){return"ghostCell"},GhostCell.prototype.createDiv=function(e){return BaseCell.prototype.createDiv.call(this,e),this.$div.addClass("ghostLevel"+this.level),this.$div},GhostCell.prototype.process=function(e){var i=!1;Game.each(function(e){if(Game.inField(e.x,e.y-1)&&!e.medusaBlocked){var t=Game.field[e.y-1][e.x];void 0===e.scoresId||e.decorator||e instanceof DroppableCell&&t.isMovable()&&void 0===t.scoresId&&(this.ghostUpFish(e,t,Game.animate()),i=!0)}},this),i?(this.level=0,this.ghostUpFishesAnimation(Game.animate(function(){e(!0)},this))):e(!1)},GhostCell.process=function(){var o=[];if(Game.each(function(e){e instanceof GhostCell&&(e.level==GhostCell.MAXLEVEL-1?o.push(e):(e.level++,e.ghostIncLevel(Game.animate())))}),0<o.length){!function t(i){i>=o.length||o[i].process(function(e){e&&t(i+1)})}(0)}};var IcebergCell=MultiCell.extend({width:2,height:2,maxTargetCount:3,remainingTreasures:null,treasuresPerStage:null,constructor:function(e,t,i,o){MultiCell.apply(this,arguments),this.baseName="iceberg",this.removeOnRemoveNear=!0,this.removable=!0,this.movable=!1,this.scoresid="iceberg",this.isHead()&&(this.life=4,this.shootShards=!1,this.listenToOnce(Game,"start",this.startWaterAnimation))},getHeadTemplateClass:function(){return"icebergHeadCell"},remove:function(e){this.isHead()?this.shootShards=!0:this.head.remove.call(this.head,e)},beforeRemove:function(){this.body=this.getHead().getBody(),MultiCell.prototype.beforeRemove.call(this)},afterAnimateRemoval:function(){MultiCell.prototype.remove.call(this)},afterRemove:function(){for(var e=0;e<this.body.length;e++)MultiCell.prototype.remove.call(this.body[e])},splitTreasures:function(e){console.assert(e<=16,"     !   !"),this.treasuresPerStage=Math.min(this.maxTargetCount,(e-e%this.life)/this.life),this.remainingTreasures=e-this.treasuresPerStage*this.life},instantTreasures:function(){var i=this,e=this.getBody(),o=_.after(e.length,Game.animate());application.playSound("icebergIce"),e.forEach(function(e,t){t<i.treasuresPerStage&&(Game.addObject(new FrozenEggObject({x:e.x,y:e.y})),Game.objects.findWhere({x:e.x,y:e.y}).remove());o()})},shoot:function(t){var o=this;t.length&&(t=_.shuffle(t),this.$div.queue(function(e){var i=_.after(t.length,Game.animate(e));application.playSound("icebergIce"),t.forEach(function(e,t){o.animateShootingShards(e,function(){Game.addFloor(e,2,{noTask:o.isIceInTask()}),t<o.treasuresPerStage&&Game.addObject(new FrozenEggObject({x:e.x,y:e.y})),i()})})}))},startWaterAnimation:function(){var e=this,t=2*Math.random()+4;setTimeout(function(){e.$div.find(".icebergCellBg").addClass("animate").delay(900).queue(function(e){this.removeClass("animate"),e()}),e.$div.find(".icebergCellWater").addClass("animate").delay(1800).queue(function(e){this.removeClass("animate"),e()}),e.startWaterAnimation()},1e3*t)},animateTakeLife:function(e){application.playSound("icebergHit"),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life),e()},animateRemoval:function(e){application.playSound("icebergDeath");for(var t=0;t<this.body.length;t++)Game.addFloor(this.body[t],2,{noTask:this.isIceInTask()});this.generateTreasure(_.shuffle(this.body).slice(0,this.remainingTreasures)),this.$div.addStyleAnimate("explode").queue(function(){e(),gameView.fallDownExplode(this,4,"icebergExplode")})},generateTreasure:function(e){for(var t=0;t<e.length;t++)Game.addObject(new FrozenEggObject({x:e[t].x,y:e[t].y}))},animateShootingShards:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("flyingIceShard");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({target:e.$div,animation:Library.jumpBy,options:{jumps:1,height:-100,rotate:180}},500,"linear",function(){i.addClass("splash"),i.delay(600).queue(function(e){i.remove(),t(),e()})})},isIceInTask:function(){return!_.findWhere(application.level.task,{type:"ClearFloorAttributes"})}},{chars:"",checkCanFire:function(e){return e.constructor===Cell&&(!e.decorator||e instanceof CrabDecorator)&&0===Game.floor[e.y][e.x]&&Game.containsRect({x:e.x,y:e.y,width:1,height:1})&&!e.isBlocked("overTile")},process:function(){var o=[];Game.each(function(e){!IcebergCell.checkCanFire(e)||e instanceof IcebergCell||o.push(e)}),o=_.shuffle(o),Game.each(function(e){if(e instanceof IcebergCell&&e.shootShards){if(o.length<e.maxTargetCount)return e.instantTreasures(),e.afterAnimateRemoval(),void(e.shootShards=!1);for(var t=[],i=0;i<e.maxTargetCount;++i)o.length&&t.push(o.pop());t.length&&(e.shoot(t),e.afterAnimateRemoval(),e.shootShards=!1)}})}}),MagnetoCell=BaseCell.extend({constructor:function(e,t,i){if(BaseCell.prototype.constructor.call(this,e,t),this.movable=!1,this.removable=!1,i){var o=MagnetoCell.chars.indexOf(application.level.map[e].charAt(t));-1!=o&&Cell.chars[o]&&(this.colorMagnet=Cell.chars[o])}},createDiv:function(){return BaseCell.prototype.createDiv.call(this,["color_"+this.colorMagnet])},getTemplateClass:function(){return"magnetoCell"},isMagnetic:function(e){return(e instanceof Cell||e instanceof PopUpColorCell||e instanceof ArrowCell)&&!(e instanceof CaviarCell)&&e.color==this.colorMagnet&&!e.decorator&&e.isRemovable()},magnetic:function(e){for(var o=this,t=Game.animate(),i=function(){0!==o.$div.get("rotate")?o.$div.ourAnimate({rotate:180<=o.$div.get("rotate")?360:0},200,null,function(e){o.$div.set("rotate",0),t()}):t()},a=0;a<e.length;++a)i=function(t,i){return function(){var e=Math.atan2(t.y-o.y,t.x-o.x)/Math.PI*180+90;180<e-o.$div.get("rotate")&&(e-=360),o.$div.ourAnimate({rotate:e},200,null,function(){application.playSound("magnetoBzzz"),o.$div.addClass("bzzz"),t.$div.ourAnimate({target:o.$div,scale:0},450,null,function(){if(o.$div.removeClass("bzzz"),t.attribute&&(Game.trigger("removedAttribute_"+t.attribute,t),Game.trigger("removedAttribute",t)),t.secondAttribute&&(Game.trigger("removedSecondAttribute_"+t.secondAttribute,t),Game.trigger("removedSecondAttribute",t)),t instanceof FrogFuelCell&&Game.trigger("removedFrogFood",!0),t.$div.remove(),Game.field[t.y][t.x]=void 0,t instanceof PopUpColorCell){var e=Game.tasks.findWhere({type:"CollectPopUpColor"});e&&(e.set("autoNewElements",e.get("autoNewElements")+1),Game.once("afterTurn",e.checkNewElements,e))}i()})})}}(e[a],i);i()}},{chars:"CT",process:function(){var r=[];Game.each(function(e){if(e instanceof MagnetoCell){for(var t=[],i=[[0,-1],[1,0],[0,1],[-1,0]],o=0;o<i.length;++o){var a=e.x+i[o][0],n=e.y+i[o][1];!(Game.inField(a,n)&&Game.field[n][a]&&e.isMagnetic(Game.field[n][a]))||r[a]&&r[a][n]||(r[a]||(r[a]=[]),r[a][n]=!0,t.push(Game.field[n][a]))}t.length&&e.magnetic(t)}})}}),PastureCell=Cell.extend({isRegular:!1,scoreId:"pasture",constructor:function(e,t,i,o){BaseCell.call(this,e,t),this.movable=!1,this.color="none",this.removable=!0,this.removeOnRemoveNear=!0,this.life=PastureCell.chars.indexOf(o)+1,-1!==PastureCell.animalChars.indexOf(application.level.cellAttribute[e].charAt(t))&&(this.attribute="animal")},showFieldPoints:function(){Game.trigger("showFieldPoints",this.$div,GameScores[this.scoreId],"explodePastureCell")},isGrowAbleOccupite:function(){return!1},getTemplateClass:function(){return"pastureCell"},executeRemove:function(o){if(Game.field[this.y-1]&&Game.field[this.y-1][this.x]instanceof PastureCell&&Game.field[this.y-1][this.x].$div.addClass("bottom"),this.attribute){var a=this;setTimeout(_.bind(function(){var t=this.attribute,i=Game.neighbors(this,function(e){return e instanceof PastureCell&&0<e.life&&!e.attribute});0<i.length?this.animateHideAnimals(function(){if(0<(i=i.filter(function(e){return 0<e.life&&!e.attribute})).length){var e=RANDOM(i);Cell.prototype.executeRemove.call(a,o),e.animateShowAnimals(t,function(){})}else a.setAttribute(t),Cell.prototype.executeRemove.call(a,o)}):Cell.prototype.executeRemove.call(a,o)},this),1)}else Cell.prototype.executeRemove.call(this,o)},animateRemoval:function(e){this.playRemovalSound(),this.$div.addClass("animateRemoval"),this.$div.delay(800).queue(function(){e(),this.remove()})},playRemovalSound:function(){this.attribute&&application.playSound("PastureRemoveSheep")},animateHideAnimals:function(t){if(this.$div.$attr){application.playSound("PastureHideSheep");var i=this;this.$div.$attr.addClass("animateHide"),this.$div.$attr.delay(400).queue(function(e){e(),i.setAttribute(null),t()})}else t()},animateTakeLife:function(e){Cell.prototype.animateTakeLife.call(this,e),this.attribute||application.playSound("PastureTakeLife");var t=this;this.$div.queue(function(e){this.addClass("animateTakeLife"+t.life),e()}).delay(700).queue(function(e){this.removeClass("animateTakeLife"+t.life),e()})},animateShowAnimals:function(e,t){this.$div.$attr?t():(this.setAttribute(e),this.$div.$attr.addClass("animateShow"),this.$div.$attr.delay(350).queue(function(e){e(),t()}))},createDiv:function(){return Cell.prototype.createDiv.call(this,["bottom",RANDOM(["variant1","variant2"])]),Game.field[this.y-1]&&Game.field[this.y-1][this.x]instanceof PastureCell&&Game.field[this.y-1][this.x].$div.removeClass("bottom"),this.$div},fallDown:function(e,t,i){this.$div.queue(function(e){this.removeClass("bottom"),e()}),Cell.prototype.fallDown.call(this,e,t,i);var o=this;this.$div.queue(function(e){o.checkBottom(),e()})},checkBottom:function(){Game.field[this.y+1]&&Game.field[this.y+1][this.x]instanceof PastureCell?this.$div.removeClass("bottom"):this.$div.addClass("bottom")}},{chars:"",animalChars:"",taskId:"animal"}),PearlCell=BaseCell.extend({constructor:function(e,t,i,o){switch(BaseCell.call(this,e,t),this.init(),this.baseName="pearl",-1!==["birthday2020world","birthday2019world","birthdayworld"].indexOf(episode.get("num"))&&(this.baseName="catbox"),i?application.level.map[e].charAt(t):o){case"z":this.life=1;break;case"x":this.life=2;break;case"v":this.life=3;break;default:this.life=4}},init:function(){this.color="none",this.movable=!1,this.removeOnRemoveNear=!0},getTakeLifeSound:function(){return this.baseName+"TakeLevel"},animateTakeLife:function(e){application.playSound(this.getTakeLifeSound()),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()},getRemoveSound:function(){return"remove"+this.getCapitalisedBaseName()},animateRemoval:function(e){application.playSound(this.getRemoveSound());var t=GameBaseView.createFallDownExplodePiece("die_"+this.baseName);t.alignTo(this.$div),gameView.fallDownExplodePiece(t);var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass(this.baseName);_Figure.blockedAnimations.append(i),i.alignTo(this.$div),Game.trigger("removed"+this.getCapitalisedBaseName(),i),i.remove(),this.$div.remove(),e()},getTemplateClass:function(){return this.baseName+"Cell"},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),e},getCapitalisedBaseName:function(){return this.baseName.charAt(0).toUpperCase()+this.baseName.slice(1)}}),ParrotCell=BaseCell.extend({constructor:function(e,t){switch(BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.baseName="parrot","springworld"===episode.get("num")&&(this.baseName="catbox"),application.level.map[e].charAt(t)){case"o":this.life=1;break;case"p":this.life=2;break;default:this.life=3}},getTakeLifeSound:function(){return this.baseName+"TakeLevel"+this.life},getRemoveSound:function(){return"remove"+this.getCapitalisedBaseName()},animateRemoval:function(e){application.playSound(this.getRemoveSound());var t=GameBaseView.createFallDownExplodePiece("die_"+this.baseName);t.alignTo(this.$div),gameView.fallDownExplodePiece(t);var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass(this.baseName);this.decorationVariant&&i.addClass("decoration_"+this.decorationVariant),_Figure.blockedAnimations.append(i),i.alignTo(this.$div),Game.trigger("removed"+this.getCapitalisedBaseName(),i),i.remove(),this.$div.remove(),e()},getTemplateClass:function(){return this.baseName+"Cell"},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),e},animateTakeLife:function(e){application.playSound(this.getTakeLifeSound()),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable");var t="die_"+this.baseName+"Lock";1==this.life&&(t="die_"+this.baseName+"Door");var i=GameBaseView.createFallDownExplodePiece(t);i.alignTo(this.$div),gameView.fallDownExplodePiece(i),e()},animateTakeLifeInBonusWorld:function(e){var t=this;if(this.$div.queue(function(e){this.find("."+t.baseName+"CellBg").addClass("die_"+t.baseName+t.life),e()}),this.$div.delay(500).queue(function(e){this.removeClass(t.baseName+"Level"+(t.life+1)).addClass(t.baseName+"Level"+t.life),e()}),1===this.life){var i="die_"+this.baseName+"Shard",o=GameBaseView.createFallDownExplodePiece(i);o.alignTo(this.$div),gameView.fallDownExplodePiece(o)}e()},animateRemovalInBonusWorld:function(i){var o=this;this.$div.queue(function(e){var t=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(t),t.addClass(o.baseName),t.alignTo(this),Game.trigger("removed"+o.getCapitalisedBaseName(),t),this.addStyleAnimate("",function(){gameView.fallDownExplode(this,4,o.baseName+"Explode")}),i(),e()})},getCapitalisedBaseName:function(){return this.baseName.charAt(0).toUpperCase()+this.baseName.slice(1)}}),TurtleCell=function(e,t){switch(BaseCell.call(this,e,t),this.init(),this.baseName="turtle",application.level.map[e].charAt(t)){case"f":this.life=1;break;case"J":this.life=2;break;case"S":this.life=3;break;default:this.life=3}this.processCounter=1};_.extend(TurtleCell.prototype,PearlCell.prototype),TurtleCell.prototype.constructor=TurtleCell,TurtleCell.prototype.getTakeLifeSound=function(){return this.baseName+"TakeLevel"+this.life},TurtleCell.prototype.animateTakeLife=function(t){application.playSound(this.getTakeLifeSound());var i=this,o=this.life;this.$div.addClass(i.baseName+"LifeTransition"),this.$div.animationByName(i.baseName+"Downgrade"+(o+1)).queue(function(e){this.removeClass(i.baseName+"LifeTransition"),this.removeClass(i.baseName+"Level"+(o+1)).addClass(i.baseName+"Level"+o),e(),0===o&&t()}),0<o&&t(),0<this.processCounter&&(this.processCounter=0)},TurtleCell.prototype.animateRestoreLife=function(e){var t=Game.animate(e);this.$div.removeClass(this.baseName+"Level"+(this.life-1)).addClass(this.baseName+"Level"+this.life),this.$div.animationByName(this.baseName+"Upgrade"+this.life).queue(function(e){e(),t()})},TurtleCell.prototype.process=function(){this.processCounter++,2<this.processCounter&&(this.processCounter=0,this.life<3&&(this.life++,this.animateRestoreLife(Game.animate())))},TurtleCell.process=function(){Game.each(function(e){e instanceof TurtleCell&&e.process()})};var SharkCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.processCounter=0,this.damaged=!1,this.moves=1};_.extend(SharkCell.prototype,BaseCell.prototype),SharkCell.prototype.remove=function(){this.damaged||(this.processCounter=0,this.damaged=!0,this.animateDamage())},SharkCell.prototype.getTemplateClass=function(){return"sharkCell"},SharkCell.prototype.process=function(){this.processCounter++,this.damaged?3<=this.processCounter&&(this.processCounter=0,this.damaged=!1,this.animateUnDamage()):(1==this.processCounter&&this.animateAngry(),2<=this.processCounter&&(this.processCounter=0)<Game.get("moves").get()&&this.animateEatMove(Game.animate()))},SharkCell.prototype.animateAngry=function(){this.$div.removeClass("stable").addClass("angryShark")},SharkCell.prototype.animateUnDamage=function(){this.$div.removeClass("damaged").addClass("stable")},SharkCell.prototype.animateDamage=function(){this.$div.removeClass("angryShark").removeClass("stable").addClass("damaged"),application.playSound("sharkCellDamage")},SharkCell.prototype.animateEatMove=function(o){application.playSound("sharkCellEatMove"),this.$div.removeClass("angryShark").addClass("eatShark").sprite.once("round",_.bind(function(){this.$div.removeClass("eatShark").addClass("stable"),0<Game.get("moves").get()&&Game.set("moves",new ObscureNumber(Game.get("moves").get()-1)),o();var e=$(".flySharkMove"),t=$('<div class="flySharkMove">&minus;1</div>');if(0===e.length)t=$('<div class="flySharkMove" id="'+this.moves+'">&minus;'+this.moves+"</div>");else{t=e;var i=parseInt(e.attr("id"))+this.moves;t.attr("id",i),t.html("&minus;"+i)}$(".blockedAnimations").append(t),t.alignTo($("#moves")),t.ourAnimate({top:"-=20px",opacity:0},1e3,"linear",function(){$(this).remove()})},this))},SharkCell.process=function(){for(var e=0;e<Config.rows;e++)for(var t=0;t<Config.cols;t++)Game.inField(t,e)&&Game.field[e][t]instanceof SharkCell&&Game.field[e][t].process()};var SkatCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.processCounter=0,this.life=3};_.extend(SkatCell.prototype,BaseCell.prototype),SkatCell.prototype.animateTakeLife=function(e){application.playSound("skatTakeLevel"),this.$div.removeClass("skatLevel"+(this.life+1)).addClass("skatLevel"+this.life).find(".life").removeClass("skatLevel"+(this.life+1)).addClass("skatLevel"+this.life),e()},SkatCell.prototype.animateRestoreLife=function(e){this.$div.removeClass("skatLevel"+(this.life-1)).addClass("skatLevel"+this.life).find(".life").removeClass("skatLevel"+(this.life-1)).addClass("skatLevel"+this.life),e()},SkatCell.prototype.getTemplateClass=function(){return"skatCell"},SkatCell.prototype.process=function(){if(this.processCounter++,1==this.processCounter&&this.animateAngry(),2<=this.processCounter){var t=[];if(Game.each(function(e){e instanceof ArrowCell&&e.isRemovable()&&!e.decorator&&t.push(e)}),t.length){var e=(t=_.shuffle(t))[0];this.processCounter=0,this.animateEatArrow(Game.animate(),e)}}},SkatCell.prototype.animateAngry=function(){this.$div.removeClass("stable").addClass("angrySkat").find(".skatCellBg").removeClass("stable").addClass("angrySkat")},SkatCell.prototype.animateEatArrow=function(e,t){var i=new Cell(t.y,t.x);i.color=t.color,t.needExplode=!1;var o=t.$div.find(".arrow").clone();_Figure.blockedAnimations.append(o),o.alignTo(t.$div.find(".arrow")),t.remove(!0),Game.addItem(i),this.$div.removeClass("angrySkat").addClass("eatSkat").find(".skatCellBg").removeClass("angrySkat").addClass("eatSkat"),o.ourAnimate({target:this.$div},1e3,"easeInQuad",_.bind(function(){o.fadeOut(400),application.playSound("skatEatArrow"),this.$div.removeClass("eatSkat").addClass("stable").find(".skatCellBg").removeClass("eatSkat").addClass("stable"),this.life<3&&(this.life++,this.animateRestoreLife(Game.animate())),e()},this))},SkatCell.process=function(){Game.each(function(e){e instanceof SkatCell&&e.process()})},SkatCell.prototype.animateRemoval=function(e){application.playSound("dieSkat");var t=GameBaseView.createFallDownExplodePiece("die_skat");t.alignTo(this.$div),gameView.fallDownExplodePiece(t),this.$div.remove(),e()};var BulbCell=function(e,t,i,o){switch(BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.notRemoveByTwoMulticolors=!0,this.scoresId="bulb",i&&(o=application.level.map[e].charAt(t)),o){case"r":this.life=1;break;case"y":this.life=2;break;default:this.life=3}};BulbCell.chars="ryi",_.extend(BulbCell.prototype,BaseCell.prototype),BulbCell.prototype.animateTakeLife=function(e){application.playSound("bulbTakeLife"),this.$div.removeClass("bulbLevel"+(this.life+1)).addClass("bulbLevel"+this.life),e()},BulbCell.prototype.getTemplateClass=function(){return"bulbCell"},BulbCell.prototype.createDiv=function(e){var t=Cell.prototype.createDiv.call(this);return t.addClass("bulbLevel"+this.life),t},BulbCell.prototype.beforeRemove=function(){this.$div.removeClass("bulbLevel1").addClass("bulbLevel0")},BulbCell.prototype.animateRemoval=function(e){application.playSound("bulbRemove"),e(),this.$div.remove()};var BossCell=BaseCell.extend({constructor:function(e,t){BaseCell.call(this,e,t),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.scoresId=this.name=application.level.bossName?application.level.bossName:"dragon",void 0!==application.level.bossLife&&(BossCell.LIFE=application.level.bossLife),this.setSize(),this.head=this.getHead(),this.life=this.isHead()?BossCell.LIFE:1,!this.isHead()||this instanceof CoinChestCell||canvas.timeManager.setTimeout(_.bind(function(){$("#tasks .taskBossLife").parent().addClass(this.name+"Task")},this),0)},setSize:function(){this.width=BossCell.WIDTH,this.height=BossCell.HEIGHT},isHead:function(){return this.head==this},highlight:function(e){this.isHead()?BaseCell.prototype.highlight.call(this,e):this.head.highlight(e)},getHead:function(){for(var e=this.width;0<=e;e--)for(var t=this.height;0<=t;t--)if(Game.inField(this.x-e,this.y-t)&&Game.field[this.y-t][this.x-e]instanceof BossCell)return Game.field[this.y-t][this.x-e];return this},animateTakeLife:function(e){Game.set("score",Game.get("score")+GameScores.bossLife),this.renderLife(),this.playTakeLifeSound();var t=this.getAngryAnimationTime();this.$div.removeClass("stable").addClass(this.name+"Angry").find("."+this.name+"Bg").removeClass("stable").addClass(this.name+"Angry").delay(t).queue(_.bind(function(e){this.$div.removeClass(this.name+"Angry").addClass("stable").find("."+this.name+"Bg").removeClass(this.name+"Angry").addClass("stable"),this.playingTakeLifeSound=!1,e()},this)),Game.trigger("showFieldPoints",this.$div,1,"damageBoss "+this.lifeClass()),Game.trigger("showFieldPoints",$("#tasksBlock .CollectType_q"),-1,"damageBossTask "+this.lifeClass()),e()},getAngryAnimationTime:function(){return 1e3},playTakeLifeSound:function(){var e=this.name+"damage";application.playSound(e),this.playingTakeLifeSound=e},lifeClass:function(){return 50<Math.round(100*this.life/BossCell.LIFE)?"less100PercentLife":Math.round(100*this.life/BossCell.LIFE)<=25?"less25PercentLife":Math.round(100*this.life/BossCell.LIFE)<=50&&"less50PercentLife"},beforeRemove:function(){if(this.isHead())for(var e=0;e<this.width;e++)for(var t=0;t<this.height;t++)Game.inField(this.x+e,this.y+t)&&Game.field[this.y+t][this.x+e]instanceof BossCell&&Game.field[this.y+t][this.x+e]!=this&&Game.field[this.y+t][this.x+e].remove()},animateRemoval:function(e){Game.set("score",Game.get("score")+GameScores.boss),Game.trigger("showFieldPoints",this.$div,GameScores.boss,"explodeBossCell"),Game.trigger("removeBoss_"+this.name),this.playRemoveSound(),this.renderLife(),this.playRemoveAnimation(e)},playRemoveSound:function(){var e=this.name+"death";application.playSound(e)},playRemoveAnimation:function(e){var t=FigureView.createByTemplate(".invisible ."+this.name+"Fly");_Figure.blockedAnimations.append(t),t.alignTo(this.$div),this.$div.remove(),soundManager.stopMusic(),t.ourAnimate({dy:-2*Config.cellHeight},2e3,"easeInQuad",function(){this.remove(),e()})},calcBossLifeWidth:function(){return Math.round(this.life/BossCell.LIFE*(46/60*Config.cellWidth))},renderLife:function(){this.$div.find(".life").set("width",this.calcBossLifeWidth()),this.$div.removeClass("less50PercentLife less25PercentLife"),this.$div.find(".life").removeClass("less50PercentLife less25PercentLife"),$(".taskBossLife").find(".currentLife").removeClass("less50PercentLife less25PercentLife"),this.lifeClass()&&(this.$div.addClass(this.lifeClass()),this.$div.find(".life").addClass(this.lifeClass()),$(".taskBossLife").find(".currentLife").addClass(this.lifeClass())),$(".taskBossLife").find(".currentLife").html(this.life),$(".taskBossLife").find(".maxLife").html(BossCell.LIFE)},remove:function(e){this.isHead()?BaseCell.prototype.remove.apply(this,arguments):0===this.head.life?BaseCell.prototype.remove.call(this,!0):this.head.remove.apply(this.head,arguments)},getTemplateClass:function(){return this.isHead()?this.name+"HeadCell":this.name+"BodyCell"},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return this.isHead()&&this.renderLife(),e}},{LIFE:80,WIDTH:2,HEIGHT:2,getCompletionStatic:function(e){if(1==e.get("collectedAmount"))return 1;var t=0;return Game.each(function(e){e instanceof BossCell&&e.isHead()&&(t=1-e.life/BossCell.LIFE)}),t}});_.override(BossCell,{playRemoveAnimationSnake:function(e){var t=FigureView.createByTemplate(".invisible ."+this.name+"Fly");_Figure.blockedAnimations.append(t),t.alignTo(this.$div),this.$div.remove(),soundManager.stopMusic(),t.ourAnimate({dy:-2*Config.cellHeight},500,"easeInQuad",function(){this.remove(),e()})},lifeClass:function(){return 0===this.life?"less0PercentLife":50<Math.round(100*this.life/BossCell.LIFE)?"less100PercentLife":Math.round(100*this.life/BossCell.LIFE)<=25?"less25PercentLife":Math.round(100*this.life/BossCell.LIFE)<=50&&"less50PercentLife"},playRemoveAnimationWalrus:function(t){var i=FigureView.createByTemplate(".invisible ."+this.name+"Fly");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),this.$div.remove(),-1!==_.findIndex(Config.bonusWorlds,function(e){return e.name===episode.get("num")})?(i.addClass("alligatorSpecial"),i.delay(700).queue(function(e){i.remove(),e(),t()})):i.delay(1500).queue(function(e){i.remove(),e(),t()})},playRemoveAnimation:function(e){"walrus"===this.name||"alligator"===this.name||"cloverfields"==episode.get("num")?this.playRemoveAnimationWalrus(e):"snake"==this.name?this.playRemoveAnimationSnake(e):"lighthouse"!=this.name?this.override.call(this,e):e()},getAngryAnimationTime:function(){var e=_.findIndex(Config.bonusWorlds,function(e){return e.name===episode.get("num")});return"snake"==this.name?400:"alligator"==this.name&&-1!==e?"thanksgivingday2022world1"==episode.get("num")||"thanksgivingday2022world2"==episode.get("num")||"thanksgivingday2022world3"==episode.get("num")||"thanksgivingday2022world4"==episode.get("num")?1e3:400:1e3},setSize:function(){"lighthouse"===this.name?(this.width=2,this.height=3):(this.width=BossCell.WIDTH,this.height=BossCell.HEIGHT)},calcBossLifeWidth:function(){return"lighthouse"===this.name?Math.round(this.life/BossCell.LIFE*(106/60*Config.cellWidth)):this.override.apply(this,arguments)},createDiv:function(){var e=this.override.apply(this,arguments);return e.removeClass("stable").addClass("stable").find("."+this.name+"Bg").removeClass("stable").addClass("stable"),e},getHead:function(){for(var e=this.width;0<=e;e--)for(var t=this.height;0<=t;t--)if(Game.inField(this.x-e,this.y-t)&&Game.field[this.y-t][this.x-e].constructor===BossCell)return Game.field[this.y-t][this.x-e];return this},executeRemove:function(e){"lighthouse"==this.name&&(this.onField=!1,this.removable=!1,this.renderLife()),this.isHead()||(e=!0),BaseCell.prototype.executeRemove.call(this,e)}});var BigChestCell=MultiCell.extend({constructor:function(){MultiCell.apply(this,arguments),this.removeOnRemoveNear=!1,this.name="bigChest",this.removable=!1,this.isHead()&&(this.bigchestCell1=application.level.bigchestCell1,this.bigchestCell2=application.level.bigchestCell2,this.bigchestCell1Life=application.level.bigchestCell1Life,this.bigchestCell2Life=application.level.bigchestCell2Life,this.life=1)},createDiv:function(){var e=MultiCell.prototype.createDiv.call(this);return this.$div.find(".bigChestCell1").addClass("color_"+this.bigchestCell1),this.$div.find(".bigChestCell2").addClass("color_"+this.bigchestCell2),this.$div.find(".bigChestBody").addClass("stable"),this.$div.find(".bigChestBody").removeClass("stable").addClass("stable"),this.isHead()&&this.renderLife(),Game.on("removedItem",this.removeItemCallback,this),e},remove:function(e){this.isHead()?BaseCell.prototype.remove.apply(this,arguments):0===this.head.life?(this.removable=!0,BaseCell.prototype.remove.call(this,!0)):this.head.remove.apply(this.head,arguments)},getTemplateClass:function(){return this.isHead()?this.name+"HeadCell":this.name+"BodyCell"},removeItemCallback:function(e){this.head.medusaBlocked||this.head.isBlocked("removeOnRemoveNear")||Math.abs(e.x-this.x)+Math.abs(e.y-this.y)!=1||!(this.head.bigchestCell1===e.getCurrentColor()&&0<this.head.bigchestCell1Life||this.head.bigchestCell2===e.getCurrentColor()&&0<this.head.bigchestCell2Life)||(this.head.bigchestCell1===e.getCurrentColor()&&this.head.bigchestCell1Life--,this.head.bigchestCell2===e.getCurrentColor()&&this.head.bigchestCell2Life--,this.head.canOpen()&&Game.off("removedItem",this.removeItemCallback,this),this.head.renderLife())},canOpen:function(){return!!this.isHead()&&this.bigchestCell1Life+this.bigchestCell2Life===0},open:function(){this.isHead()&&(this.removable=!0,this.remove(),this.removable=!0)},animateRemoval:function(i){Game.set("score",Game.get("score")+GameScores.bigChest),Game.trigger("showFieldPoints",this.$div,GameScores.bigChest,"damageBossTask "+this.name);var e=_.bind(function(){for(var o=_.after(3,_.bind(function(){this.$div.remove(),i()},this)),e=0;e<3;++e){var t=BigChestCell.targets.pop();t?function(t){var i=FigureView.createByTemplate(".invisible .arrow");i.addClass("dir_both"),_Figure.blockedAnimations.append(i),i.alignTo(this.$div,{ajust:{x:Config.cellWidth/2,y:0}}),i.ourAnimate({target:t.$div,animation:Library.collectFly,options:{vy:500}},600,"linear",function(){i.remove(),t.remove(!0);var e=new ArrowCell(t.y,t.x,!1,"both",t.color);e.dir="both",Game.addItem(e,!0),o()})}.call(this,t):o()}},this);setTimeout(_.bind(function(){this.$div.find(".bigChestBody").removeClass("stable").addClass("opened")},this),600),setTimeout(e,1700)},renderLife:function(){this.$div.find(".bigChestCell1").find(".bigChestCellLife").html(this.bigchestCell1Life),this.$div.find(".bigChestCell2").find(".bigChestCellLife").html(this.bigchestCell2Life),this.head.canOpen()||(this.$div.find(".bigChestBody").removeClass("stable").addClass("hit"),setTimeout(_.bind(function(){this.$div.find(".bigChestBody").removeClass("hit").addClass("stable")},this),600))},talkingAnimation:function(){}},{process:function(){BigChestCell.targets=[],Game.each(function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute||e.medusaBlocked||e.isBlocked("removable")||BigChestCell.targets.push(e)}),BigChestCell.targets=_.shuffle(BigChestCell.targets),BigChestCell.targets.length&&Game.each(function(e){if(!(e instanceof BigChestCell&&e.isHead()&&e.canOpen()))return!1;e.open()})}}),CoinChestCell=BossCell.extend({constructor:function(){if(BossCell.apply(this,arguments),this.removeOnRemoveNear=!1,this.name="coinChest",this.removable=!1,this.life=1,this.coinsPerHit=3,this.setVersion(),this.isHead()){this.coinchestColors=[];switch(_.each(["R","G","B","Y","P"],function(e){-1!=application.level.availableColors.indexOf(e)&&this.coinchestColors.push(e)},this),this.isActivated=!1,this.isChangingColors=!1,this.coinchestLife=application.level["coinchestLife"+this.version]?application.level["coinchestLife"+this.version]:1,this.coinchestColor=!1,application.level["coinchestColor"+this.version]){case"none":break;case"all":this.coinchestColors.length&&(this.coinchestColor=this.coinchestColors[0],this.isChangingColors=!0);break;default:application.level["coinchestColor"+this.version]&&(this.coinchestColor=application.level["coinchestColor"+this.version])}}},getHead:function(){for(var e,t=this.width-1;0<=t;t--)for(var i=this.height-1;0<=i;i--)if(Game.inField(this.x-t,this.y-i)&&(e=Game.field[this.y-i][this.x-t])instanceof CoinChestCell&&e.isHead())return e;return this},setVersion:function(){switch(application.level.map[this.y].charAt(this.x)){case"":this.version=1;break;case"":this.version=2;break;case"":this.version=3;break;case"":this.version=4;break;default:this.version=1}},getNextColor:function(){var e=_.indexOf(this.coinchestColors,this.coinchestColor);return e+1<this.coinchestColors.length?this.coinchestColors[e+1]:this.coinchestColors[0]},getPrevColor:function(){var e=_.indexOf(this.coinchestColors,this.coinchestColor);return 0<e?this.coinchestColors[e-1]:this.coinchestColors[this.coinchestColors.length-1]},changeColor:function(){this.coinchestColor=this.getNextColor(),this.renderStones()},renderStones:function(){var e=this.$div.find(".coinChestColor").removeClass().addClass("coinChestCell").addClass("coinChestColor"),t=this.$div.find(".coinChestColorNext").removeClass().addClass("coinChestCell").addClass("coinChestColorNext"),i=this.$div.find(".coinChestColorPrev").removeClass().addClass("coinChestCell").addClass("coinChestColorPrev"),o=this.coinchestColor?"color_"+this.coinchestColor:"color_any";e.addClass(o),this.isChangingColors?(t.addClass("color_"+this.getNextColor()),i.addClass("color_"+this.getPrevColor())):(t.addClass(o),i.addClass(o))},createDiv:function(){var e=BossCell.prototype.createDiv.call(this);return this.renderStones(),Game.on("removedItem",this.removeItemCallback,this),e},remove:function(e){this.isHead()?BaseCell.prototype.remove.apply(this,arguments):0===this.head.life?(this.removable=!0,BaseCell.prototype.remove.call(this,!0)):this.head.remove.apply(this.head,arguments)},animateRemoval:function(e){Game.set("score",Game.get("score")+GameScores.coinchest),Game.trigger("showFieldPoints",this.$div,GameScores.coinchest,"explodeBossCell"),Game.trigger("removeBoss_"+this.name),this.playRemoveSound(),this.renderLife(),this.playRemoveAnimation(e)},isMedusaBlocked:function(){var t=this.medusaBlocked||this.head.medusaBlocked;return t||Game.each(function(e){e.constructor===CoinChestCell&&this.head==e.head&&e.medusaBlocked&&(t=!0)},this),t},removeItemCallback:function(e){!this.isBlocked("removable")&&!this.isMedusaBlocked()&&!this.head.isActivated&&0<this.head.coinchestLife&&e instanceof Cell&&Math.abs(e.x-this.x)+Math.abs(e.y-this.y)==1&&(this.head.coinchestColor&&this.head.coinchestColor!=e.getCurrentColor()||(this.head.isActivated=!0,0===this.life&&Game.off("removedItem",this.removeItemCallback,this)))},getTargetsCount:function(){return this.coinchestLife>this.coinsPerHit?this.coinsPerHit:this.coinchestLife},animateCoinsRelease:function(e,t){this.isChangingColors&&this.changeColor();var i=this,o=_.after(e.length,function(){i.$div.removeClass("opened").addClass("closed").delay(250).queue(function(e){i.coinchestLife<=0&&(i.removable=!0,i.remove(null)),i.$div.removeClass("closed"),e(),t()})});_.each(e,function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute?o():(--this.coinchestLife,this.renderLife(),this.animateCoin(e,o))},this)},animateCoin:function(t,i){t.attribute="coin";var e=this.$div,o=FigureView.createByTemplate(".invisible .attribute_coin");_Figure.blockedAnimations.append(o),o.alignTo(e,{ajust:{x:Config.cellWidth-o.attrs.width/2,y:0}}),o.ourAnimate({target:t.$div,animation:Library.collectFly,options:{vy:500},ajust:{x:o.attrs.x,y:0}},600,"linear",function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate",["attribute","attribute_"+t.attribute]);t.$div.append(e),t.$div.$attr=e,o.remove(),i()})},releaseCoins:function(t,i){var o=this;this.$div.addClass("opened").delay(500).queue(function(e){o.animateCoinsRelease(t,i),e()})},playRemoveAnimation:function(e){var t=this.$div;t.addStyleAnimate("removed",function(){t.remove(),e()},!0)},renderLife:function(){this.$div.find(".life").set("width",this.calcBossLifeWidth()),this.$div.removeClass("less50PercentLife less25PercentLife"),this.$div.find(".life").removeClass("less50PercentLife less25PercentLife"),this.lifeClass()&&(this.$div.addClass(this.lifeClass()),this.$div.find(".life").addClass(this.lifeClass())),this.isHead()&&this.$div.find(".coinChestLife").html(this.coinchestLife)}},{chars:"",process:function(){var i=0,o=0,a=[],n=[];Game.get("fullRunning")||Game.once("change:fullRunning",CoinChestCell.process,CoinChestCell),Game.each(function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute||e.isBlocked("overTile")||a.push(e)}),a=_.shuffle(a),Game.each(function(e){if(!(e instanceof CoinChestCell&&e.isHead()&&e.isActivated))return!1;if(e.isActivated=!1,e.isBlocked("removable")||!a.length||e.isMedusaBlocked())return!1;if(n=[],i=e.getTargetsCount()){for(var t=0;t<i;t++)a.length&&n.push(a.pop());n&&(e.releaseCoins(n,Game.animate()),o++)}}),o&&application.playSound("coinChestdamage")}}),GenryMorganCell=BossCell.extend({constructor:function(){BossCell.apply(this,arguments),this.name="genrymorgan",this.isHead()&&(Game.on("endTurn",function(){this.isGodmode=!1},this),this.setHandsCoords(),this.isActivated=!1,this.blockedCell=!1,this.activeHand="right")},getHead:function(){for(var e=this.width;0<=e;e--)for(var t=this.height;0<=t;t--)if(Game.inField(this.x-e,this.y-t)&&Game.field[this.y-t][this.x-e].constructor===GenryMorganCell)return Game.field[this.y-t][this.x-e];return this},animateTakeLife:function(e){Game.set("score",Game.get("score")+GameScores.bossLife),this.renderLife(),application.playSound("genrymorganDamage");var t=this.getAngryAnimationTime();this.$div.removeClass("stable").addClass(this.name+"Angry").find("."+this.name+"Bg").removeClass("stable").addClass(this.name+"Angry").delay(t).queue(_.bind(function(e){this.$div.removeClass(this.name+"Angry").addClass("stable").find("."+this.name+"Bg").removeClass(this.name+"Angry").addClass("stable"),this.playingTakeLifeSound=!1,e()},this)),Game.trigger("showFieldPoints",this.$div,1,"damageBoss "+this.lifeClass()),Game.trigger("showFieldPoints",$("#tasksBlock .CollectType_genrymorgan"),-1,"damageBossTask "+this.lifeClass()),e()},remove:function(){this.head.isGodmode||(this.isActivated=!0,BossCell.prototype.remove.call(this))},switchHand:function(){this.activeHand="right"==this.activeHand?"left":"right"},blockCell:function(e){e.movable=!1,e.medusaBlocked=!0,e.isHoldByGenry=!0,this.head.blockedCell=e},unblockCell:function(){Game.field[this.head.blockedCell.y][this.head.blockedCell.x].movable=!0,Game.field[this.head.blockedCell.y][this.head.blockedCell.x].medusaBlocked=!1,Game.field[this.head.blockedCell.y][this.head.blockedCell.x].isHoldByGenry=!1,this.head.blockedCell=!1},createDiv:function(){var e=BossCell.prototype.createDiv.call(this);return Game.on("removedItem",this.removeItemCallback,this),this.isHead()?this.$div.addClass("active_right"):this.createHand(e),e},playRemoveAnimation:function(e){var t=FigureView.createByTemplate(".invisible ."+this.name+"Fly");_Figure.blockedAnimations.append(t),t.alignTo(this.$div),this.$div.remove(),application.playSound("genrymorganDeath"),t.ourAnimate({dy:-2*Config.cellHeight},1e3,"easeInQuad",function(){this.remove(),e()})},setHandsCoords:function(){this.hands={left:{x:this.head.x,y:this.head.y+1},right:{x:this.head.x+1,y:this.head.y+1}}},isRightHand:function(){return this.x==this.head.hands.right.x&&this.y==this.head.hands.right.y},isLeftHand:function(){return this.x==this.head.hands.left.x&&this.y==this.head.hands.left.y},getLeftHand:function(){return Game.field[this.head.hands.left.y][this.head.hands.left.x]},getRightHand:function(){return Game.field[this.head.hands.right.y][this.head.hands.right.x]},hasNeighbor:function(e){for(var t=[{x:this.head.x,y:this.head.y},{x:this.head.x+1,y:this.head.y},{x:this.head.x,y:this.head.y+1},{x:this.head.x+1,y:this.head.y+1}],i=0;i<t.length;i++)if(Game.isNeighbors(e,Game.field[coord.y][coord.x]))return!0;return!1},processLeftHand:function(n){var e=10;if(this.blockedCell){this.unblockCell();var t=this.getRightHand();t.hand.ourAnimate({target:t.$div},500,"linear",function(){t.hand.removeClass("process").addClass("stable")}),e=500}var r=this;r.head.$div.delay(e).queue(_.bind(function(i){var o=this.getLeftHand(),a=Game.findValidMove();a&&a.first&&a.second?o.hand.removeClass("stable").ourAnimate({target:a.first.$div},500,"linear",function(){r.head.isGodmode=!0,Game.field[a.first.y][a.first.x]=a.second,Game.field[a.second.y][a.second.x]=a.first;var e=a.first.x;a.first.x=a.second.x,a.second.x=e,e=a.first.y,a.first.y=a.second.y,a.second.y=e;Math.random(),Game.get("speed");application.playSound("genrymorganLeftHand"),o.hand.addClass("process").ourAnimate({target:a.second.$div},300,"linear",function(){o.hand.removeClass("process")}),a.first.$div.ourAnimate(a.first.getCoords(),300,"linear",function(){}),a.second.$div.ourAnimate(a.second.getCoords(),300,"linear",function(){if(a.first instanceof ArrowCell||a.second instanceof ArrowCell||a.first instanceof MultiColorCell||a.second instanceof MultiColorCell){var e=a.first,t=a.second;e.makeMove||(e=a.second,t=a.first),e.makeMove&&e.makeMove(t)}o.hand.ourAnimate({target:o.$div},500,"linear",function(){o.hand.addClass("stable"),i(),n()})})}):(i(),n())},this))},processRightHand:function(e){if(this.blockedCell)e();else{var t=[],i=[],o=!1;if(Game.each(function(e){e instanceof DroppableCell&&!e.decorator&&!e.isBlocked()?i.push(e):e.constructor!==Cell||!e.life||e.decorator||e.attribute||!e.movable||e.isBlocked("movable")||e.medusaBlocked||t.push(e)}),i.length&&(o=(i=_.shuffle(i)).pop()),!o&&t.length&&(o=(t=_.shuffle(t)).pop()),o){var a=this.getRightHand();this.blockCell(o),application.playSound("genrymorganRightHand"),a.hand.removeClass("stable").ourAnimate({target:o.$div},500,"linear",function(){a.hand.addClass("process"),e()})}}},beforeRemove:function(){this.isHead()&&(this.blockedCell&&this.unblockCell(),this.getLeftHand().hand.remove(),this.getRightHand().hand.remove()),BossCell.prototype.beforeRemove.call(this)},processActiveHand:function(){var e=Game.animate();"right"==this.activeHand?this.processRightHand(e):this.processLeftHand(e)},createHand:function(e){this.hand=!1,this.isLeftHand()?this.hand=FigureView.createByTemplate(".invisible .genrymorganLeftHand"):this.isRightHand()&&(this.hand=FigureView.createByTemplate(".invisible .genrymorganRightHand")),this.hand&&(_Figure.blockedAnimations.append(this.hand),this.hand.alignTo(e).addClass("stable"),this.$div&&this.$div.onRemove(_.bind(function(){this.hand&&this.hand.remove()},this)),Game.on("win",function(){this.hand&&this.hand.ourAnimate({opacity:0},1e3,"linear",function(){this.remove instanceof Function&&this.remove()})},this))}},{chars:"/",process:function(){Game.each(function(e){e instanceof GenryMorganCell&&e.isHead()&&!e.medusaBlocked&&!e.isBlocked("removable")&&(e.isActivated&&(e.switchHand(),e.isActivated=!1),0<Game.get("moves").get()&&e.processActiveHand())})}}),StrongboxCell=BaseCell.extend({constructor:function(e,t,i,o){BaseCell.prototype.constructor.call(this,e,t),this.name="strongbox",this.scoresId="strongbox",this.movable=!1,this.removable=!1,this.removeOnRemoveNear=!0,this.setOpen(0!==StrongboxCell.chars.indexOf(o))},animateOpen:function(){var t=this,i=Game.animate();application.playSound("strongboxOpening"),this.$div.queue(function(e){t.$div.removeClass("closed").addClass("animateOpening"),e()}).delay(700).queue(function(e){t.$div.removeClass("animateOpening").addClass("opened"),e(),i()})},animateClose:function(){var t=this,i=Game.animate();application.playSound("strongboxClosing"),this.$div.queue(function(e){t.$div.removeClass("opened").addClass("animateClosing"),e()}).delay(500).queue(function(e){t.$div.removeClass("animateClosing").addClass("closed"),e(),i()})},animateRemoval:function(t){var i=this;application.playSound("strongboxRemove"),this.$div.queue(function(e){i.$div.remove(),i.trigger("remove"),t(),e()})},toggleOpen:function(){this.medusaBlocked||this.isBlocked("removable")||(this.isOpen()?this.close():this.open())},close:function(){this.isOpen()&&(this.setOpen(!1),this.animateClose())},open:function(){this.isOpen()||(this.setOpen(!0),this.animateOpen())},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.removeClass("closed").removeClass("opened").addClass(this.isOpen()?"opened":"closed"),e},getTemplateClass:function(){return"strongboxCell"},isOpen:function(){return this.removable},setOpen:function(e){this.removable=e}},{chars:"",process:function(){Game.each(function(e){e instanceof StrongboxCell&&e.toggleOpen()})}}),GemStealerCell=BaseCell.extend({constructor:function(e,t,i,o){if(BaseCell.prototype.constructor.call(this,e,t),this.name="gemstealer",this.scoresId="gemStealer",this.movable=!1,this.removable=!0,this.removeOnRemoveNear=!1,i){var a=GemStealerCell.chars.indexOf(o);-1!==a&&Cell.chars[a]&&(this.targetColor=Cell.chars[a]),this.life=application.level.gemStealerLives&&application.level.gemStealerLives[10*this.x+this.y]||application.level["gemStealer"+this.color+"Life"]||1}},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this,["gemStealer_"+this.targetColor]);return e.find(".lifeBlock .life").html(this.life),e},getTemplateClass:function(){return"gemStealer_"+this.targetColor},canBeStolen:function(e){return(e instanceof Cell||e instanceof PopUpColorCell||e instanceof ArrowCell)&&!(e instanceof CaviarCell)&&e.color==this.targetColor&&!e.decorator&&e.isRemovable()},stealGem:function(i){var o=this,t=Game.animate();if(i){application.playSound("gemStealerEating");var a=i.$div.clone();_Figure.blockedAnimations.append(a),a.alignTo(i.$div),this.$div.addClass("startEating"),this.$div.queue(function(e){this.addClass("startEating"),e()}).delay(600).queue(function(e){i.$div.alignTo(o.$div),i.$div.hide(),a.ourAnimate({target:o.$div,scale:0},400,null,e)}).queue(function(e){if(o.$div.removeClass("startEating"),o.$div.addClass("finishEating"),i.attribute&&(Game.trigger("removedAttribute_"+i.attribute,i),Game.trigger("removedAttribute",i)),i.secondAttribute&&(Game.trigger("removedSecondAttribute_"+i.secondAttribute,i),Game.trigger("removedSecondAttribute",i)),i instanceof FrogFuelCell&&Game.trigger("removedFrogFood",!0),Game.field[i.y][i.x]=void 0,i instanceof PopUpColorCell){var t=Game.tasks.findWhere({type:"CollectPopUpColor"});t&&(t.set("autoNewElements",t.get("autoNewElements")+1),Game.once("afterTurn",t.checkNewElements,t))}e()}).delay(400).queue(function(e){o.$div.removeClass("finishEating"),o.$div.removeClass("stable").addClass("stable"),e(),t(),i.$div.remove(),o.remove(!1)})}else t()},animateTakeLife:function(e){this.$div.find(".lifeBlock .life").html(this.life.toString()),e()},animateRemoval:function(e){application.playSound("gemStealerDie"),BaseCell.prototype.animateRemoval.call(this,e)}},{chars:"",process:function(){var r=[];Game.each(function(e){if(e&&!e.isBlocked()&&e instanceof GemStealerCell){for(var t,i=[[0,-1],[1,0],[0,1],[-1,0]],o=0;o<i.length&&!t;++o){var a=e.x+i[o][0],n=e.y+i[o][1];!(Game.inField(a,n)&&Game.field[n][a]&&e.canBeStolen(Game.field[n][a]))||r[a]&&r[a][n]||(r[a]||(r[a]=[]),r[a][n]=!0,t=Game.field[n][a])}t&&e.stealGem(t)}})}}),CollectStrongbox=CollectType.extend({canCollect:function(e){return e instanceof StrongboxCell},tick:function(i){var o=this;i.$div.queue(function(e){this.addClass("removeStrongbox"),e()}).delay(500).queue(function(e){this.removeClass("removeStrongbox");var t=FigureView.createByTemplate(".invisible .emptyTemplate").addClass(i.name+"CellLoot");_Figure.blockedAnimations.append(t),t.alignTo(i.$div),t.queue(_.bind(function(e){o.animateCollect(t,GameScores.strongbox,Game.endTurnAnimate(function(){Task.prototype.tick.call(o)},o),0),t.remove()},o)),e()})},getAnimateCollectRotation:function(){return 0}});CollectStrongbox.getCssClass=function(e){return"StrongboxCellLoot_"};var CollectMuffin=Task.extend({initialize:function(){this.set("event","throwMuffin"),this.set("type",this.get("description").type);var e=this.get("description").amount;console.assert(e%this.countCellsInField()*6==0,"   .     6 !!"),this.set("amount",e),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof MuffinRackCell},throwMuffin:function(e){var t=this,i=e.$div.children.filter(function(e){return e&&e.hasClass("muffinWrap")}).shift();if(i){var o=i.clone();_Figure.blockedAnimations.append(o),o.addClass("flyingMuffin"),o.find(".muffin").addClass("flyingMuffin"),o.alignTo(i),i.remove(),application.playSound("throwmuffin"),this.animateCollect(o,GameScores.muffin,Game.endTurnAnimate(function(){Task.prototype.tick.call(t)}),0),o.remove()}else Task.prototype.tick.call(this)},tick:function(e){1===e.life?this.finalTick(e):this.throwMuffin(e)},finalTick:function(e){var t=GameBaseView.createFallDownExplodePiece(e.baseName+"Bg");t.alignTo(e.$div),this.throwMuffin(e),gameView.fallDownExplodePiece(t),Game.set("score",Game.get("score")+GameScores.muffinRack)},getAnimateCollectRotation:function(){return 0},countCellsInField:function(){var t=0;return Game.each(function(e){this.canCollect(e)&&e.isHead()&&t++},this),t}});CollectMuffin.getCssClass=function(e){return"MuffinRackCellLoot"};var SeaweedKeyCell=BaseCell.extend({scoresId:"seaweed",setRandomColor:Cell.prototype.setRandomColor,constructor:function(e,t,i,o){BaseCell.call(this,e,t),this.code=Cell.chars[SeaweedKeyCell.chars.indexOf(o)],this.movable=!1,this.removable=!1,this.life=application.level["seaweedKey"+this.code+"Life"]||3;Game.on("removedItem",function e(t){!this.isBlocked("removable")&&!this.medusaBlocked&&0<this.life&&t.getCurrentColor()===this.code&&Math.abs(t.x-this.x)+Math.abs(t.y-this.y)===1&&(this.removable=!0,this.remove(),this.removable=!1,0===this.life&&Game.off("removedItem",e,this))},this)},getTemplateClass:function(){return"SeaweedKeyCell"},calcColor:function(){return"SeaweedKeyColor"+this.code},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.find(".currentLife").html(this.life),e},afterRemove:function(){application.playSound("seaweedRemove"),Game.each(function(e){e.decorator&&e.decorator instanceof SeaweedDecorator&&e.decorator.color==this.code&&(e.decorator.removable=!0,e.decorator.remove())},this)},animateTakeLife:function(e){application.playSound("seaweedTakeLife"),this.$div.find(".currentLife").html(this.life),e()}},{chars:""}),WellCell=function(e,t){BaseCell.call(this,e,t),this.color="none",this.life=1/0,this.movable=!1,this.removeOnRemoveNear=!0,this.processCounter=0,"e"==application.level.map[e].charAt(t)&&(this.processCounter=3)};_.extend(WellCell.prototype,BaseCell.prototype),WellCell.prototype.getWaterColor=function(){return"N"},WellCell.prototype.remove=function(){this.medusaBlocked&&!this.isBlocked("removable")||this.processCounter<4&&(this.processCounter++,this.animateChangeWater())},WellCell.prototype.getTemplateClass=function(){return"wellCell"},WellCell.prototype.createDiv=function(){var e=BaseCell.prototype.createDiv.call(this);return e.addClass("wellLevel"+this.processCounter),e},WellCell.prototype.animateFireWater=function(t,i){application.playSound("wellCellFlyWater");var o=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("flyWater");_Figure.blockedAnimations.append(o),o.alignTo(this.$div),o.ourAnimate({target:t.$div},500,"linear",_.bind(function(){t.$div.remove();var e=new Cell(t.y,t.x);e.attribute=t.attribute,e.secondAttribute=t.secondAttribute,e.color=this.getWaterColor(),Game.addItem(e,!0),o.remove(),i()},this))},WellCell.prototype.animateChangeWater=function(){application.playSound("wellCellChangeWater"),this.$div.removeClass("wellLevel0").removeClass("wellLevel1").removeClass("wellLevel2").removeClass("wellLevel3").removeClass("wellLevel4").addClass("wellLevel"+this.processCounter),Game.animate()()},WellCell.prototype.checkCanFire=function(e){return e.constructor===Cell&&!e.decorator&&e.getCurrentColor()!==this.getWaterColor()&&!e.isBlocked("overTile")},WellCell.prototype.process=function(t){if(4==this.processCounter){var i=[];if(Game.each(_.bind(function(e){t[e.y][e.x]||this.checkCanFire(e)&&i.push(e)},this)),0<i.length){this.processCounter=0,this.animateChangeWater(),i=_.shuffle(i);for(var e=0;e<4&&e<i.length;e++)t[i[e].y][i[e].x]=!0,this.animateFireWater(i[e],Game.animate())}}},WellCell.process=function(){for(var t=[],e=0;e<Config.rows;e++){t.push([]);for(var i=0;i<Config.cols;i++)t[e].push(!1)}Game.each(function(e){e instanceof WellCell&&!e.medusaBlocked&&!e.isBlocked("removable")&&e.process(t)})};var PalmCell=MultiCell.extend({width:2,height:2,constructor:function(e,t,i,o){MultiCell.call(this,e,t,i,o),this.removeOnRemoveNear=!1,this.indestructible=!0,this.removable=!1,this.movable=!1,this.isHead()&&(this.mustFire=!1)},getHeadTemplateClass:function(){return"palmHeadCell"},getCoconutColor:function(){return PalmCell.coconutColor},removeByArrow:function(){if(this.isHead()){if(this.isBlocked("removable"))return!1;this.mustFire=!0}else this.head.removeByArrow()},fire:function(e){if(e.length){for(var t=0;t<e.length;t++)this.animateFire(e[t],Game.animate());this.$div.addClass("fireAnimation"),canvas.timeManager.setTimeout(_.bind(function(){this.$div.removeClass("fireAnimation")},this),800)}},animateFire:function(e,t){application.playSound("palmCellFireAnimation");var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("flyCoconut");_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({target:e.$div},500,"linear",_.bind(function(){e.$div.removeClass("color_"+e.color).addClass("color_"+this.getCoconutColor()),e.color=this.getCoconutColor(),i.remove(),t()},this))}});PalmCell.checkCanFire=function(e){return!(e.constructor!==Cell||e.decorator||e.attribute||e.getCurrentColor()===PalmCell.coconutColor||e.isBlocked("overTile"))},PalmCell.process=function(){var o=[];Game.each(_.bind(function(e){PalmCell.checkCanFire(e)&&o.push(e)},this)),o=_.shuffle(o),Game.each(function(e){if(e instanceof PalmCell&&e.mustFire){for(var t=[],i=0;i<PalmCell.fireTargetsCount;i++)o.length&&t.push(o.pop());t.length&&e.fire(t),e.mustFire=!1}})},PalmCell.coconutColor="U",PalmCell.fireTargetsCount=3;var MedusaCell=function e(t,i){BaseCell.call(this,t,i),this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.opened=!1,this.life=e.MaxLife};_.extend(MedusaCell.prototype,BaseCell.prototype),MedusaCell.MaxLife=3,MedusaCell.prototype.getCoords=function(){var e=_Figure.field.offset(),t=FigureView.findById("medusa").offset();return{x:e.left-t.left+this.x*Config.cellWidth,y:e.top-t.top+this.y*Config.cellHeight}},MedusaCell.prototype.onChangeOrientation=function(){this.$div.set(this.getCoords()),this.$div.show()},MedusaCell.prototype.createDiv=function(e){return this.$div=FigureView.createByTemplate(".invisible .medusaCell"),FigureView.findById("medusa").append(this.$div),this.$div.set(this.getCoords()),this.$div.find(".medusaLife").addClass("life"+this.life),this.$div},MedusaCell.prototype.animateTakeLife=function(t){for(var e=0;e<=MedusaCell.MaxLife;e++)this.$div.find(".medusaLife").removeClass("life"+e);application.playSound("medusaDamage"),this.$div.find(".medusaHead").addClass("medusaOuch").removeClass("stable").delay(300).queue(_.bind(function(e){t(),this.$div.find(".medusaHead").removeClass("medusaOuch"),this.opened||this.$div.find(".medusaHead").addClass("stable"),e()},this)),this.$div.find(".medusaLife").addClass("life"+this.life)},MedusaCell.prototype.animateRemoval=function(t){this.animateTakeLife(_.bind(function(){this.unblocked(_.bind(function(){application.playSound("medusaDie");var e=GameBaseView.createFallDownExplodePiece("medusaDie");e.alignTo(this.$div),gameView.fallDownExplodePiece(e),this.$div.remove(),canvas.timeManager.setTimeout(t,3*Game.get("speed"))},this))},this))},MedusaCell.prototype.unblocked=function(e){var t;if(this.opened){application.playSound("medusaMove"),this.$div.removeClass("tailCreated");var i=_.after(2,_.bind(function(){this.$div.find(".medusaHead").removeClass("medusaVertical").removeClass("medusaHorizontal").addClass("stable"),e()},this));if(this.opened=!1,this.openedDir){for(t=0;t<Config.rows;t++){(o=Game.field[t][this.x])&&o.head&&(o=o.head),!o||o instanceof MedusaCell||!o.medusaBlocked||o.medusaBlocked--}this.$div.find(".tail1").animate({y:0,height:0,"background-height":0},500,"linear",function(){this.removeClass("medusaTailDir_UP"),i()}),this.$div.find(".tail2").animate({height:0,"background-height":0},500,"linear",function(){this.removeClass("medusaTailDir_DOWN"),i()})}else{for(t=0;t<Config.cols;t++){var o;(o=Game.field[this.y][t])&&o.head&&(o=o.head),!o||o instanceof MedusaCell||!o.medusaBlocked||o.medusaBlocked--}this.$div.find(".tail1").animate({x:0,width:0,"background-width":0},500,"linear",function(){this.removeClass("medusaTailDir_LEFT"),i()}),this.$div.find(".tail2").animate({width:0,"background-width":0},500,"linear",function(){this.removeClass("medusaTailDir_RIGHT"),i()})}}else e()},MedusaCell.prototype.process=function(){var e,t,i=Game.animate();if(this.opened)this.unblocked(i);else{var o=_.after(2,_.bind(function(){this.$div.addClass("tailCreated"),i()},this));this.opened=!0,this.openedDir=Math.floor(2*Math.random());var a,n=80/Config.cellWidth;if(window.mobile||(n=1),application.playSound("medusaMove"),this.openedDir){for(t=40/60*Config.cellHeight,this.$div.find(".medusaHead").addClass("medusaVertical").removeClass("stable"),e=0;e<Config.rows;e++){if(Game.field[e][this.x]&&!(Game.field[e][this.x]instanceof MedusaCell))(r=Game.field[e][this.x]).head&&(r=r.head),void 0===r.medusaBlocked&&(r.medusaBlocked=0),r.medusaBlocked++}a=(this.y+5/6)*Config.cellHeight,this.$div.find(".tail1").addClass("medusaTailDir_UP").set({width:Config.cellWidth,height:t,x:0,y:-t,"background-width":Config.cellWidth*n,"background-height":t*n}).delay(300).animate({y:-a,height:a,"background-height":a*n,"background-width":Config.cellWidth*n},500,"linear",o),a=(Config.rows-1-this.y+5/6)*Config.cellHeight,this.$div.find(".tail2").addClass("medusaTailDir_DOWN").set({width:Config.cellWidth,height:t,x:0,y:Config.cellHeight,"background-width":Config.cellWidth*n,"background-height":t*n}).delay(300).animate({height:a,"background-height":a*n,"background-width":Config.cellWidth*n},500,"linear",o)}else{for(t=40/60*Config.cellWidth,this.$div.find(".medusaHead").addClass("medusaHorizontal").removeClass("stable"),e=0;e<Config.cols;e++){var r;if(Game.field[this.y][e]&&!(Game.field[this.y][e]instanceof MedusaCell))(r=Game.field[this.y][e]).head&&(r=r.head),void 0===r.medusaBlocked&&(r.medusaBlocked=0),r.medusaBlocked++}a=(this.x+5/6)*Config.cellWidth,this.$div.find(".tail1").addClass("medusaTailDir_LEFT").set({width:t,height:Config.cellHeight,x:-t,y:0,"background-width":t*n,"background-height":Config.cellHeight*n}).delay(300).animate({x:-a,width:a,"background-width":a*n,"background-height":Config.cellWidth*n},500,"linear",o),a=(Config.cols-1-this.x+5/6)*Config.cellHeight,this.$div.find(".tail2").addClass("medusaTailDir_RIGHT").set({width:t,height:Config.cellHeight,x:Config.cellWidth,y:0,"background-width":t*n,"background-height":Config.cellHeight*n}).delay(300).animate({width:a,"background-width":a*n,"background-height":Config.cellWidth*n},500,"linear",o)}}},MedusaCell.process=function(){Game.each(function(e){e instanceof MedusaCell&&e.process()})};var FishBallCell=BaseCell.extend({constructor:function(e,t,i){BaseCell.call(this,e,t,i),this.maxLives=i.maxLives?i.maxLives:this.initMaxLives(),this.life=this.maxLives,this.baseName="fishBall",this.scoresId="fishBall",this.color="none",this.movable=!1,this.removeOnRemoveNear=!0,this.lifeBlocks=[{cssSelector:".shallow",width:2},{cssSelector:".middle",width:2},{cssSelector:".deep",width:Math.max(2,this.maxLives-4)}]},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return e.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),e.addClass("fishBallStartLevel"+this.life),1==this.maxLives&&e.removeClass("fishBallLevel1"),this.lifeBlocks.forEach(function(e){e.el=this.$div.find(e.cssSelector)},this),this.calcLifeBlockValue(),e},initMaxLives:function(){var e=application.level.map[this.y].charAt(this.x);return application.level["fishBallLife"+(FishBallCell.SYMBOL.indexOf(e)+1)]||application.level.fishBallLife},getTemplateClass:function(){return this.baseName+"Cell"},calcLifeBlockValue:function(){for(var e=Math.min(Math.ceil(this.life/2),3)-1,t=0;t<this.lifeBlocks.length;++t)t<e?this.$div.find(this.lifeBlocks[t].cssSelector).set("width",50/62*Config.cellWidth):e<t?this.$div.find(this.lifeBlocks[t].cssSelector).set("width",0):this.$div.find(this.lifeBlocks[t].cssSelector).set("width",(this.life-2*t)/this.lifeBlocks[t].width*(50/62*Config.cellWidth))},animateRemoval:function(t){var i=this;application.playSound(this.baseName+"Remove");var o=FigureView.createByTemplate(".invisible .emptyTemplate"),e=i.$div.clone();o.append(e),e.set({x:0,y:0}),_Figure.blockedAnimations.append(o),o.alignTo(i.$div),e.addStyleAnimate(i.baseName+"Die").queue(function(e){this.addClass(i.baseName+"Fly"),e(),t(),o.addAnimation(Library.ballFly({speed:800,radialSpeed:300,maxTime:1e3},function(){o.remove()}))}),i.$div.remove()},animateTakeLife:function(e){application.playSound(this.baseName+"TakeLevel"),this.calcLifeBlockValue(),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life),this.$div.addStyleAnimate(this.baseName+"Angry"),e()}},{SYMBOL:""}),CaviarCell=Cell.extend({scoresId:"caviar",initialize:function(e,t,i,o){this.life=3,this.color=o,i&&(this.color=application.level.map[e].charAt(t),application.level.cellAttribute&&"*"==application.level.cellAttribute[e].charAt(t)&&(this.attribute="key")),"."==this.color&&this.setRandomColor();var a=CaviarCell.chars.indexOf(this.color);-1!=a&&Cell.chars[a]&&(this.color=Cell.chars[a]),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},animateTakeLife:function(i){var o=this.life,a=this.$div;this.$div.queue(function(t){this.find(".cellStone").queue(function(e){application.playSound("caviarTakeLife"),this.removeClass("stable"),e()}).addClass("caviarTakeLife"+o).animationByName("caviarTakeLife"+o).queue(function(e){this.removeClass("caviarTakeLife"+o),a.removeClass("caviarCell"+(o+1)).addClass("caviarCell"+o),this.addClass("stable"),i(),e(),t()})})},beforeRemove:function(){this.$div.queue(function(e){this.removeClass("caviarCell1").addClass("caviarCell0"),e()})},calcColor:function(){return"caviarCell_"+(this.saveColor||this.color)},createDiv:function(){return Cell.prototype.createDiv.call(this,["caviarCell"+this.life,this.calcColor()])},getTemplateClass:function(){return"caviarCell"}},{chars:""}),CollectCaviar=CollectType.extend({initialize:function(){var t=this;CollectType.prototype.initialize.call(this),Game.collectCaviarTotal||(Game.collectCaviarTotal=0),Game.collectCaviarTotal+=this.get("description").amount,this.set("cellClass",CaviarCell);var e=Game.fallDownSpecialCells.filter(function(e){return e.cellClass===t.get("cellClass")}),i=Game.collectCaviarTotal-this.getCaviarCellOnField().length-e.length;if(0<i)for(var o=this.get("cellClass").chars.split("").filter(function(e,t){return-1!==application.level.colors.indexOf(Cell.chars[t])}),a=0;a<i;++a){var n={offset:Math.floor(2*Math.random()+1),cellClass:this.get("cellClass"),type:RANDOM(o)};Game.fallDownSpecialCells.push(n)}},getCaviarCellOnField:function(){return Game.filter(function(e){return e instanceof CaviarCell})}});CollectCaviar.getCssClass=function(){return"CollectCaviar_"};var PopUpColorCell=Cell.extend({scoresId:"caviar",constructor:function(e,t,i,o){i&&(o=application.level.map[e].charAt(t));var a=PopUpColorCell.chars.indexOf(o);-1!=a&&Cell.chars[a]&&(o=Cell.chars[a]),BaseCell.prototype.constructor.call(this,e,t,o),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},calcColor:function(){return"popUpColor_"+("none"==this.color?this.saveColor:this.color)},popup:function(){for(var e=this.y-1;0<=e&&(!Game.inField(this.x,e)||!Game.field[e][this.x].isMovable()||Game.field[e][this.x].constructor===PopUpColorCell);)--e;0<=e&&this.swap(Game.field[e][this.x])},swap:function(e){var t=this,i=Game.animate();Game.field[this.y][this.x]=e;var o=(Game.field[e.y][e.x]=this).x;this.x=e.x,e.x=o,o=this.y,this.y=e.y,e.y=o;var a=20*Math.random()*Game.get("speed");e.$div.queue(function(e){t.$div.delay(a).queue(function(e){application.playSound("PopUpColor"),this.addClass("upAnimate"),e()}).ourAnimate(t.getCoords(),300,"linear",function(){this.removeClass("upAnimate"),i()}),e()}).delay(a).ourAnimate(e.getCoords(),300,"linear",function(){e.setX(e.x),e.setY(e.y),0===t.y&&t.$div.addClass("onTheEdge").find(".popDanger").addClass("onTheEdge")})},afterFallDown:function(e,t){0!==t&&this.$div.removeClass("onTheEdge").find(".popDanger").removeClass("onTheEdge")},setRandomColor:function(){return Cell.prototype.setRandomColor.call(this)},getTemplateClass:function(){return"popUpColorCell"},beforeRemove:function(){this.$div.addClass("removal"),application.playSound("PopUpColorHit"),Cell.prototype.beforeRemove.call(this)},explode:function(){var i=Game.animate(),o=this;this.$div.queue(function(e){application.playSound("PopUpColorLose"),this.addClass("explode"),e()}).animationByName("popUpColorCellExplode").queue(function(e){var t=FigureView.createByTemplate(".invisible .popUpColorExplode");_Figure.blockedAnimations.append(t),t.alignTo(this),e(),t.delay(800).queue(function(e){e(),t.remove(),o.$div.remove(),new PopUpColorFinishWindow({cell:o,onClear:function(){o.remove(),i()}})})})}},{chars:"",process:function(){var t=!1;Game.each(function(e){if(e instanceof PopUpColorCell){if(e.decorator&&!e.decorator.get("movableDecorator"))return;if(e.isOnTheTopEdge())t||e.decorator||(e.explode(),t=!0);else{if(e.skipPopUp)return void(e.skipPopUp=!1);if(e.medusaBlocked||e.isBlocked("movable"))return;e.popup()}}})}});PopUpColorCell.prototype.notShuffled=!0;var ArtifactDropPartCell=DroppableCell.extend({scoresId:"artifactpart",constructor:function(e,t,i,o){DroppableCell.call(this,e,t,i),this.partId=parseInt(o)||1},getTemplateClass:function(){return"artifactPartCell"},createDiv:function(){var e=Cell.prototype.createDiv.call(this,["part"+(this.partId||1)]);return Game.on("afterTurn",this.checkDroppedCells,this),e},animateRemoval:function(e){application.playSound("fishCellRemove"),this.$div.remove(),e()},afterRemove:function(){Game.off("afterTurn",this.checkDroppedCells,this),DroppableCell.prototype.afterRemove.call(this)}},{chars:""});_.override(GameClass,{isValidMove:function(e){return e.first instanceof ArtifactPartCell||e.second instanceof ArtifactPartCell||this.override.call(this,e)},makeMove:function(e){if(this.override.call(this,e),e.first instanceof ArtifactPartCell||e.second instanceof ArtifactPartCell){var t=e.first;e.first instanceof ArtifactPartCell||(t=e.second),t.removable=!0,t.remove()}}});var ArtifactPartCell=BaseCell.extend({scoresId:"artifactpart",constructor:function(e,t,i,o){BaseCell.call(this,e,t,i),this.removable=!1,this.partId=parseInt(o)||1},getTemplateClass:function(){return"artifactPartCell"},getCurrentColor:function(){return!1},createDiv:function(){return Cell.prototype.createDiv.call(this,["part"+(this.partId||1)])},animateRemoval:function(e){application.playSound("fishCellRemove"),this.$div.remove(),e()}},{chars:""}),CollectPopUpColor=CollectType.extend({initialize:function(){CollectType.prototype.initialize.call(this),this.set("autoNewElements",this.get("description").amount-this.countCellsInField())},canCollect:function(e){return e instanceof PopUpColorCell},findPosition:function(){for(var e,t,i=0;i<Config.rows;++i){var o=_.range(Config.cols-1);do{var a=Math.floor(Math.random()*o.length);for(e=o[a],t=Config.rows-1;0<t&&!Game.field[t][e];)--t;if(t-=i,Game.inField(e,t)&&Game.field[t][e].constructor===Cell&&Game.field[t][e].isMovable())return[e,t];o.splice(a,1)}while(0<o.length)}},checkNewElements:function(){if(0<this.get("autoNewElements")){var e=this.findPosition();if(e){var t=e[0],i=e[1],o=Game.field[i][t],a=new PopUpColorCell(i,t,!1,"");for(a.attribute=o.attribute,a.skipPopUp=!0,Game.addItem(a,!1);a.setRandomColor(),Game.isThreeInRow(t,i););var n=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(n),n.alignTo(o.$div),application.playSound("PopUpColorShow"),n.addStyleAnimate("PopUpColorCellBubble",Game.animate(function(){n.remove(),o.$div.remove(),a.createDiv(),a.$div.addClass("popUp"),a.$div.delay(300).queue(function(e){a.$div.removeClass("popUp"),_.each(a.$div.children,function(e){e.ruleAnimation&&(e.ruleAnimation.destructor(),e.ruleAnimation=void 0)},this),e()})})),this.set("autoNewElements",this.get("autoNewElements")-1)}}},collectAnimation:function(e,t,i){this.animateCollect(t,i,Game.endTurnAnimate(function(){Task.prototype.tick.call(this),this.playCollectSound(e),Game.once("afterTurn",this.checkNewElements,this)},this))}});CollectPopUpColor.getCssClass=function(e){return"CollectPopUpColor_"};var PopUpColorFinishWindow=TWindow.extend({templateClass:".popUpColorFinishWindow_template",events:{"click .close":"close","click .buy":"buy","click .forFriend":"forFriend"},onOpenSound:"losegame",close:function(){TWindow.prototype.close.call(this),Game.exit()},onOpen:function(){!0===gameView.selectedFriendForAddBombMoves&&(gameView.selectedFriendForAddBombMoves=user.getRandomFriendForGift()),!1!==gameView.selectedFriendForAddBombMoves?(this.$el.addClass("haveFriendForMedusa"),this.renderFriend()):this.$el.removeClass("haveFriendForMedusa"),Game.has("buyedPopUpColor")||Game.set("buyedPopUpColor",0),this.$(".price").html(Config.popUpColor.price+Config.popUpColor.upPrice*Game.get("buyedPopUpColor")),this.options.color&&this.$el.addClass("color_"+this.options.color),this.$(".coins").html(user.get("coins").get()),TWindow.prototype.onOpen.call(this)},renderFriend:function(){this.$(".photo").html(socialNetwork.makePhotoById(gameView.selectedFriendForAddBombMoves,Config.basePhotoSize)).attr("title",users[gameView.selectedFriendForAddBombMoves].first_name)},buy:function(){TWindow.prototype.close.call(this);var e=Config.popUpColor.price+Config.popUpColor.upPrice*Game.get("buyedPopUpColor");user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(e)),actionName:"popUpColor "+(Game.get("buyedPopUpColor")?Game.get("buyedPopUpColor"):""),actionEpisode:episode.get("num"),actionLevel:application.level.num,actionPrice:e},{validate:!0})?(Game.set({buyedPopUpColor:Game.get("buyedPopUpColor")+1}),application.playSound("PopUpColorBuy"),this.options.onClear&&this.options.onClear()):new PopUpColorFinishWindow({cell:this.options.cell,onClear:this.options.onClear})},forFriend:function(){gameView.addBombMoves(_.bind(function(){TWindow.prototype.close.call(this),this.options.onClear()},this),_.bind(function(){this.renderFriend()},this))}}),HunterFinishWindow=TWindow.extend({templateClass:".hunterFinishWindow_template",events:{"click .close":"close","click .buy":"buy","click .forFriend":"forFriend"},onOpenSound:"losegame",close:function(){TWindow.prototype.close.call(this),Game.exit()},onOpen:function(){!0===gameView.selectedFriendForAddBombMoves&&(gameView.selectedFriendForAddBombMoves=user.getRandomFriendForGift()),!1!==gameView.selectedFriendForAddBombMoves?(this.$el.addClass("haveFriendForMedusa"),this.renderFriend()):this.$el.removeClass("haveFriendForMedusa"),Game.has("buyedHunter")||Game.set("buyedHunter",0),this.$(".price").html(Config.hunter.price+Config.hunter.upPrice*Game.get("buyedHunter")),this.$(".coins").html(user.get("coins").get()),TWindow.prototype.onOpen.call(this)},renderFriend:function(){this.$(".photo").html(socialNetwork.makePhotoById(gameView.selectedFriendForAddBombMoves,Config.basePhotoSize)).attr("title",users[gameView.selectedFriendForAddBombMoves].first_name)},buy:function(){TWindow.prototype.close.call(this);var e=Config.hunter.price+Config.hunter.upPrice*Game.get("buyedHunter");user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(e)),actionName:"hunter "+(Game.get("buyedHunter")?Game.get("buyedHunter"):""),actionEpisode:episode.get("num"),actionLevel:application.level.num,actionPrice:e},{validate:!0})?(Game.set({buyedHunter:Game.get("buyedHunter")+1}),application.playSound("hunterBuy"),this.options.onClear&&this.options.onClear()):new HunterFinishWindow({onClear:this.options.onClear})},forFriend:function(){gameView.addBombMoves(_.bind(function(){TWindow.prototype.close.call(this),this.options.onClear()},this),_.bind(function(){this.renderFriend()},this))}}),CandyCell=BaseCell.extend({constructor:function(e,t){BaseCell.call(this,e,t),this.removeOnRemoveNear=!0,this.life=2},getTemplateClass:function(){return"candyCell"},animateTakeLife:function(t){var i=this,e="candyCellAnimate"+(this.life+1),o="candyCell"+(this.life+1),a="candyCell"+this.life;application.playSound("candyTakeLife"),i.$div.find(".cellStone").animationByName(e).queue(function(e){i.$div.removeClass(o).addClass(a),e(),t()})},createDiv:function(){return BaseCell.prototype.createDiv.call(this,["candyCell"+this.life])},animateRemoval:function(i){var o=this;application.playSound("candyRemove"),o.$div.find(".cellStone").queue(function(e){o.$div.addClass("candyCellRemove"),e()}).animationByName("candyCellRemove").queue(function(e){o.$div.remove();var t=o.createCell();Game.addItem(t,!0,void 0,!1),e(),i()})},createCell:function(){var e=application.level.candyContent;return CellsRegistry.initCell(e,this.y,this.x,!1)}},{chars:";"}),Decorator=Backbone.Model.extend({defaults:{name:"",level:1,cell:null,movableDecorator:!0,hideFloor:!1},initialize:function(){this.cellMovable=this.get("cell").movable,this.get("cell").movable=!1},takeColor:function(){this.get("cell").saveMoveble=this.get("cell").movable||this.cellMovable,this.get("cell").movable=!1,this.get("cell").saveRemoveOnRemoveNear=this.get("cell").removeOnRemoveNear,this.get("cell").removeOnRemoveNear=!0,"none"!==this.get("cell").color&&(this.get("cell").saveColor=this.get("cell").color,this.get("cell").color="none")},backColor:function(){this.get("cell").color=this.get("cell").saveColor,this.get("cell").saveColor=void 0,this.get("cell").removeOnRemoveNear=this.get("cell").saveRemoveOnRemoveNear||!1,this.get("cell").constructor!==PopUpColorCell&&this.get("cell").constructor!==ArrowCell||(this.get("cell").$div.remove(),this.get("cell").createDiv())},getDecoratorClass:function(){return"decorator_"+this.get("name")},getAnimatedPiecesClass:function(){return this.getDecoratorClass()+"_remove_animatePiece"},getDiv:function(){return this.$div},remove:function(){this.animateRemoval(),this.set("level",this.get("level")-1),0===this.get("level")&&(this.get("cell").decorator=void 0,this.get("cell").movable=this.cellMovable||this.get("cell").saveMoveble),this.trigger("remove"),this.get("hideFloor")&&this.showFloor()},animateRemoval:function(){1==this.get("level")&&(this.cellDecoratorPlace().removeClass("hasDecorator"),this.getDiv().remove(),Game.trigger("removedDecorator_"+this.get("name"),this))},cellDecoratorPlace:function(){return this.get("cell").$div},createDiv:function(){var e=FigureView.createByTemplate(".invisible ."+this.getDecoratorClass(),["stable"]);return e.find(".life").html(this.get("level")),this.get("hideFloor")&&this.hideFloor(),e},render:function(){this.$div=this.createDiv(),this.cellDecoratorPlace().addClass("hasDecorator").append(this.$div)},highlight:function(e){},hideFloor:function(){var e=this.get("cell"),t=FigureView.findById("floor_"+e.y+"_"+e.x);t&&t.addClass("hidden")},showFloor:function(){var e=this.get("cell"),t=FigureView.findById("floor_"+e.y+"_"+e.x);t&&t.removeClass("hidden")}},{create:function(t,e){var i=_.find(Decorator.listDecorators(),function(e){return-1!=e.SYMBOL.indexOf(t)});if(void 0!==i)return new i({cell:e,char:t})},isRegularCell:function(e){return e.isRegular}});Decorator.listDecorators=function(){return[AltBlockedDecorator,BlockedDecorator,HideDecorator,ChocolateDecorator,CrabDecorator,Crab2Decorator,CrabIceDecorator,CrabIce2Decorator,CrabBombDecorator,HunterDecorator,GreedyPirateDecorator,CrabMouseDecorator,ChangeColorDecorator,SpiderWebDecorator,CrabMedusaDecorator,MonkeyDecorator,StickyChainDecorator,SeaweedDecorator,EelDecorator]};var LayerDecorator=Decorator.extend({setLevel:function(e){this.set("level",e.indexOf(this.get("char"))+1)},getDecoratorClass:function(e){return void 0===e&&(e=this.get("level")),1==e?Decorator.prototype.getDecoratorClass.call(this):Decorator.prototype.getDecoratorClass.call(this)+e},getDiv:function(){return this.$divs[this.get("level")]},render:function(){this.$divs={};for(var e=1;e<=this.get("level");e++){var t=FigureView.createByTemplate(".invisible ."+this.getDecoratorClass(e),[]);this.cellDecoratorPlace().append(t),this.$divs[e]=t}}}),BlockedDecorator=LayerDecorator.extend({defaults:_.defaults({movableDecorator:!1},LayerDecorator.prototype.defaults),initialize:function(){this.set("name","blocked"),this.setLevel(BlockedDecorator.SYMBOL),1==this.get("level")&&this.set("oneTimeRemove",!0),Decorator.prototype.initialize.call(this)},remove:function(){LayerDecorator.prototype.remove.call(this),1==this.get("level")&&this.set("oneTimeRemove",!0)},getAnimatedPiecesAmount:function(){return 4},animateRemoval:function(){application.playSound("blockedDecoratorRemove"),gameView.fallDownExplode(this.getDiv(),this.getAnimatedPiecesAmount(),this.getAnimatedPiecesClass()),Decorator.prototype.animateRemoval.call(this,this.getDiv())}},{SYMBOL:"*@z"}),HideDecorator=LayerDecorator.extend({defaults:_.defaults({movableDecorator:!1},LayerDecorator.prototype.defaults),initialize:function(){this.set("name","hide"),this.setLevel(HideDecorator.SYMBOL),Decorator.prototype.initialize.call(this),this.takeColor()},getSound:function(){switch(this.get("level")){case 2:case 4:return"chain";default:return"box"}},getAnimatedPiecesAmount:function(){switch(this.get("level")){case 1:return 6;case 2:case 5:return 9;default:return 4}},animateRemoval:function(){application.playSound(this.getSound()),gameView.fallDownExplode(this.getDiv(),this.getAnimatedPiecesAmount(),this.getAnimatedPiecesClass()),Decorator.prototype.animateRemoval.call(this,this.getDiv())},remove:function(){Decorator.prototype.remove.call(this),0===this.get("level")&&this.backColor()}},{SYMBOL:"%^asd"}),GrowDecorator=Decorator.extend({},{process:function(e,i){if(!Game[e]){var o=[];if(Game.each(function(t){i(t)&&Game.neighbors(t,function(e){!(Decorator.isRegularCell(e)||e.isGrowAbleOccupite&&e.isGrowAbleOccupite(t))||e.decorator||e.isHoldByGenry||e.isBlocked("overTile")||o.push({farmCell:t,targetCell:e})})}),0<o.length){var t=RANDOM(o);return t.farmCell.animateOccupation&&t.farmCell.animateOccupation(),t.targetCell}}return!1}}),ChocolateDecorator=GrowDecorator.extend({defaults:_.defaults({movableDecorator:!1,hideFloor:!0},GrowDecorator.prototype.defaults),initialize:function(){this.set("name","chocolate"),Decorator.prototype.initialize.apply(this,arguments),this.takeColor()},remove:function(){this.backColor(),Game.explodeChocolate=!0,Decorator.prototype.remove.call(this)},animateRemoval:function(){var e=FigureView.createByTemplate(".invisible .chocolateAnnihilation"),t=Game.animate();_Figure.blockedAnimations.append(e),e.alignTo(this.getDiv()),application.playSound("chocolateDecoratorRemove"),e.sprite.once("round",function(){e.remove(),t()}),Decorator.prototype.animateRemoval.call(this,this.getDiv())}},{SYMBOL:"#",occupite:function(e){e.decorator=new ChocolateDecorator({cell:e}),e.decorator.render();var t=Game.animate();application.playSound("chocolateDecoratorCreate"),e.decorator.getDiv().removeClass("stable").addClass("chocolate_appearance").sprite.once("round",function(){e.decorator.getDiv().removeClass("chocolate_appearance").addClass("stable"),t()})},process:function(){var e=GrowDecorator.process("explodeChocolate",function(e){var t=void 0!==ChocolateFarmCell&&e instanceof ChocolateFarmCell;return"chocolate"===e.getDecoratorName()||t});e&&ChocolateDecorator.occupite(e)}}),CrabDecorator=Decorator.extend({onMoveSound:"crabmove",onRemovalSound:"crabDecoratorRemove",defaults:{name:"crab",level:1,cell:null,oneTimeRemove:!0},remove:function(){Decorator.prototype.remove.call(this),Game.set("score",Game.get("score")+GameScores.crab),Game.trigger("showFieldPoints",this.get("cell").$div,GameScores.crab,"explodeCrabCell")},onMoveAnimation:function(){var e=FigureView.createByTemplate(".invisible .moveCrab").addClass("move_"+this.get("name"));return this.direction&&e.addClass(this.direction),e},moveCrab:function(e,t){application.playSound(this.onMoveSound);var i=this.onMoveAnimation();_Figure.blockedAnimations.append(i);var o={x:-this.getDiv().attrs["margin-left"]||0,y:-this.getDiv().attrs["margin-top"]||0};return i.alignTo(this.getDiv(),{ajust:o}),this.getDiv().remove(),i.ourAnimate({target:e.$div},500,"linear",function(){this.direction="",i.remove(),t()}),i},animateRemoval:function(){application.playSound(this.onRemovalSound);var e=GameBaseView.createFallDownExplodePiece("die_crab");e.alignTo(this.getDiv()),gameView.fallDownExplodePiece(e),canvas.timeManager.setTimeout(Game.animate(),3*Game.get("speed")),Decorator.prototype.animateRemoval.call(this,this.getDiv())},crabOneStep:function(e,t,i,o,a,n){var r=this.get("name"),s=this.get("cell");if(!s.medusaBlocked&&!s.isBlocked("removeOnRemoveNear")&&0!==e){var l=[];if(Game.neighbors(s,function(e){if(e.x!==o||e.y!==a){(e instanceof Cell&&e.isRegular||e instanceof TwinkleCell&&!e.active&&s.decorator instanceof CrabDecorator&&-1!==["crab","crab2","crabMedusa"].indexOf(s.decorator.get("name")))&&(e.decorator||e.isBlocked("removeOnRemoveNear")||e.medusaBlocked||n[e.y][e.x]||l.push(e))}}),0<l.length){var d=RANDOM(l);return d.x<s.x?this.direction="left":d.x>s.x?this.direction="right":d.y<s.y?this.direction="up":d.y>s.y&&(this.direction="down"),"crab"==r&&CrabDecorator.occupite(d),"crab2"==r&&Crab2Decorator.occupite(d),"crabIce"==r&&CrabIceDecorator.occupite(d,this.get("level")),"crabBomb"==r&&CrabBombDecorator.occupite(d,this.get("level"),this.get("moves")+1),"crabIce2"==r&&CrabIce2Decorator.occupite(d,this.get("level")),"crabMouse"==r&&CrabMouseDecorator.occupite(d,this.get("level"),this.get("maxLevel")),"crabMedusa"==r&&CrabMedusaDecorator.occupite(d,this.get("level"),this.get("moves"),this.get("version")),"crabee"==r&&BeeDecorator.occupite(d,this.get("level")),n[d.y][d.x]=!0,this.moveCrab(d,Game.animate(function(){d.decorator.render(),this.occupited(d),d.decorator&&d.decorator.crabOneStep(e-1,d.x,d.y,t,i,n)},d.decorator)),s.decorator=void 0,s.movable=this.cellMovable,!0}return!1}},occupited:function(e){}},{SYMBOL:"C",occupite:function(e){e.decorator=new CrabDecorator({cell:e})},process:function(){for(var o=_.times(Config.rows,function(){return _.times(Config.cols,_.constant(!1))}),a=!0,e=function(e){if(0===e.getDecoratorName().indexOf("crab")&&!o[e.y][e.x]){var t,i=e.getDecoratorName();t="crabMedusa"===i?Math.floor(2*Math.random())+2:-1<["crab","crabBomb","crabIce","crabIce2","crabMouse","crabee"].indexOf(i)?1:parseInt(e.getDecoratorName().substr(4)),e.decorator.crabOneStep(t,e.x,e.y,!1,!1,o)&&(a=!0)}};a;)a=!1,Game.each(e)}}),Crab2Decorator=CrabDecorator.extend({defaults:{name:"crab2",level:1,cell:null},animateRemoval:function(){application.playSound("crab2DecoratorRemove"),gameView.fallDownExplode(this.getDiv(),4,this.getAnimatedPiecesClass()),Decorator.prototype.animateRemoval.call(this,this.getDiv())},remove:function(){Decorator.prototype.remove.call(this),this.get("cell").decorator=new CrabDecorator({cell:this.get("cell")}),this.get("cell").decorator.render(this.get("cell").$div)}},{SYMBOL:"M",occupite:function(e){e.decorator=new Crab2Decorator({cell:e})}}),Zib;Crab2Decorator.prototype.defaults.level=2,Crab2Decorator.prototype.remove=(Zib=Crab2Decorator.prototype.remove,function(){this.set("level",1),Zib.call(this)});var CrabIceDecorator=CrabDecorator.extend({defaults:function(){return{name:"crabIce",cell:null,level:application.level.crabIceLevel||6,maxLevel:application.level.crabIceLevel||6}},onMoveSound:"snowmanmove",onMoveAnimation:function(){var e=CrabDecorator.prototype.onMoveAnimation.call(this);return e.append(this.getDiv().find(".decoratorLifeBlock").clone()),e},animateDie:function(){application.playSound("crabIceDecoratorDie");var e=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("die_"+this.get("name"));_Figure.blockedAnimations.append(e),e.alignTo(this.getDiv()),e.delay(400).queue(function(e){this.remove(),e()}),gameView.fallDownExplode(this.getDiv(),3,this.getAnimatedPiecesClass())},renderLife:function(e){var t=this.get("level")-e,i=this.get("maxLevel");this.$div.find(".lifeBar").set("width",Math.round(t/i*(46/60*Config.cellWidth))),1<i&&this.$div.removeClass("lifeLevel"+this.get("level")).addClass("lifeLevel"+t)},_isBonusWorld:function(){return-1!==_.findIndex(Config.bonusWorlds,function(e){return e.name===episode.get("num")})},animateRemoval:function(){1==this.get("level")?(Game.set("score",Game.get("score")+GameScores.crab),Game.trigger("showFieldPoints",this.get("cell").$div,GameScores.crab,"explodeCrabCell"),this.animateDie()):(application.playSound("crabIceDecoratorRemove"),this.getDiv().find(".life").html(this.get("level")-1),this.getDiv().removeClass("stable").addClass("takeLife").delay(400).queue(function(e){this.removeClass("takeLife").addClass("stable"),e()})),this._isBonusWorld()&&this.renderLife(1),Decorator.prototype.animateRemoval.call(this,this.getDiv())},occupited:function(e){this._isBonusWorld()&&this.renderLife(0),0===Game.floor[e.y][e.x]&&(Game.addFloor(e,1,{noTask:!1}),application.playSound("crabIceDecoratorOccupied"),this.getDiv().removeClass("stable").addClass("magicCrabIce").sprite.once("round",_.bind(function(){this.getDiv().removeClass("magicCrabIce").addClass("stable")},this)))}},{SYMBOL:"E",occupite:function(e,t){e.decorator=new CrabIceDecorator({cell:e,level:t})}}),CrabIce2Decorator=CrabIceDecorator.extend({defaults:function(){return{name:"crabIce2",cell:null,level:application.level.crabIce2Level||6,maxLevel:application.level.crabIce2Level||6}},occupited:function(e){this._isBonusWorld()&&this.renderLife(0),Game.floor[e.y][e.x]<2&&(Game.addFloor(e,2,{noTask:!1}),application.playSound("crabIce2DecoratorRemove"),this.getDiv().removeClass("stable").addClass("magicCrabIce2").sprite.once("round",_.bind(function(){this.getDiv().removeClass("magicCrabIce2").addClass("stable")},this)))}},{SYMBOL:"T",occupite:function(e,t){e.decorator=new CrabIce2Decorator({cell:e,level:t})}}),CrabBombDecorator=CrabDecorator.extend({onMoveSound:"crabBombDecoratorMove",defaults:function(){return{moves:0,name:"crabBomb",cell:null,level:application.level.crabBombLevel||2}},remove:function(){Game.set("score",Game.get("score")+GameScores.crabBomb),Game.trigger("showFieldPoints",this.get("cell").$div,GameScores.crabBomb,"explodeCrabCell"),Decorator.prototype.remove.call(this)},animateCollect:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("crabBombCollect");_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),i.ourAnimate({target:e,scale:.75},10*Game.get("speed"),void 0,function(){Game.set("score",Game.get("score")+GameScores.crabBomb),Game.trigger("showFieldPoints",i,3e3,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){t(),i.remove()})},animateDie:function(){application.playSound("crabBombDecoratorDie"),Game.set("score",Game.get("score")+GameScores.crabBomb),Game.trigger("showFieldPoints",this.get("cell").$div,GameScores.crabBomb,"explodeCrabCell"),gameView.fallDownExplode(this.getDiv(),3,this.getAnimatedPiecesClass())},isTask:function(){for(var e=0;e<Game.tasks.models.length;e++){if(Game.tasks.models[e].get("decoratorName")==this.get("name"))return!0}return!1},onMoveAnimation:function(){var e=CrabDecorator.prototype.onMoveAnimation.call(this);return e.append(this.getDiv().find(".decoratorLifeBlock").clone()),e},moveCrab:function(e,t){application.playSound(this.onMoveSound);var i=this.onMoveAnimation();return _Figure.blockedAnimations.append(i),i.alignTo(this.getDiv(),{ajust:{x:0,y:5}}),this.getDiv().remove(),i.ourAnimate({target:e.$div,ajust:{x:0,y:-5}},500,"linear",function(){this.direction="",i.remove(),t()}),i},animateRemoval:function(){1==this.get("level")?this.isTask()?Game.trigger("removedDecorator",this):this.animateDie():(application.playSound("crabBombDecoratorRemove"),this.getDiv().find(".life").html(this.get("level")-1),this.getDiv().removeClass("stable").addClass("takeLife").delay(400).queue(function(e){this.removeClass("takeLife").addClass("stable"),e()})),Decorator.prototype.animateRemoval.call(this,this.getDiv())},animateBomb:function(){this.getDiv().removeClass("stable").addClass("setBomb_"+this.get("name")).delay(400).queue(function(e){this.removeClass("setBomb_"+this.get("name")).addClass("stable"),e()})},setBomb:function(e){if(this.get("moves")>=CrabBombDecorator.MOVES_BOMB&&!(!(e instanceof Cell||e.constructor===BombCell||e.constructor===MultiColorCell)||e instanceof ArrowCell||e instanceof PopUpColorCell||e instanceof CaviarCell||e instanceof MermaidPearlCell||e.color&&"U"===e.color||e.color&&"N"===e.color||e.attribute)){application.playSound("crabBombDecoratorBomb"),e.decorator=void 0,e.$div.remove();var t=new BombCell(e.y,e.x);t.color=e.color,t.movable=!1,this.set("cell",t),t.decorator=this,Game.addItem(t,!0),this.animateBomb(),this.set("moves",0)}},occupited:function(e){this.setBomb(e)}},{SYMBOL:"W",MOVES_BOMB:3,occupite:function(e,t,i){e.decorator=new CrabBombDecorator({cell:e,level:t,moves:i})}}),AltBlockedDecorator=BlockedDecorator.extend({initialize:function(){this.set("name","blocked"),this.set("level",1),this.set("oneTimeRemove",!0),Decorator.prototype.initialize.call(this)},getDecoratorClass:function(e){return"decorator_blocked_alt"}},{SYMBOL:"R"}),CrabMouseDecorator=CrabDecorator.extend({defaults:function(){return{name:"crabMouse",cell:null,level:void 0,maxLevel:0}},onMoveSound:"mousemove",createDiv:function(){return this.get("level")||this.setLevel(),CrabDecorator.prototype.createDiv.call(this)},setLevel:function(){var e=application.level.decorators[this.get("cell").y].charAt(this.get("cell").x);this.set("level",application.level["mouseLevel"+(CrabMouseDecorator.SYMBOL.indexOf(e)+1)]||application.level.mouseLevel||6),this.set("maxLevel",application.level["mouseLevel"+(CrabMouseDecorator.SYMBOL.indexOf(e)+1)]||application.level.mouseLevel||6)},moveCrab:function(e,t){var i=CrabDecorator.prototype.moveCrab.call(this,e,t);return e.x>this.get("cell").x&&i.addClass("moveRight"),i},renderLife:function(e){var t=this.get("level")-e,i=this.get("maxLevel");this.$div.find(".lifeBar").set("width",Math.round(t/i*(46/60*Config.cellWidth))),1<i&&this.$div.removeClass("lifeLevel"+this.get("level")).addClass("lifeLevel"+t)},_isBonusWorld:function(){return-1!==_.findIndex(Config.bonusWorlds,function(e){return e.name===episode.get("num")})},animateRemoval:function(){if(this._isBonusWorld()&&this.renderLife(1),1==this.get("level")){if(Game.trigger("removedDecorator",this),application.playSound("mouseRemove"),!this.isCollected){var e=GameBaseView.createFallDownExplodePiece("crabMouseCollect");e.alignTo(this.getDiv()),gameView.fallDownExplodePiece(e)}}else application.playSound("mouseSqueak"),this.getDiv().find(".life").html(this.get("level")-1),this.getDiv().removeClass("stable").addClass("takeLife").delay(400).queue(function(e){this.removeClass("takeLife").addClass("stable"),e()});Decorator.prototype.animateRemoval.call(this)},animateCollect:function(e,t){this.isCollected=!0;var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("crabMouseCollect");_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),i.ourAnimate({target:e,scale:.75},10*Game.get("speed"),void 0,function(){Game.set("score",Game.get("score")+GameScores.mouse),Game.trigger("showFieldPoints",i,GameScores.mouse,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){t(),i.remove()})},occupited:function(e,t){this._isBonusWorld()&&this.renderLife(0)}},{SYMBOL:"Y`",occupite:function(e,t,i){e.decorator=new CrabMouseDecorator({cell:e,level:t,maxLevel:i})}}),GreedyPirateDecorator=CrabDecorator.extend({defaults:function(){return{name:"greedypirate",cell:null,level:1}},constructor:function(e){CrabDecorator.prototype.constructor.call(this,e),this.coins=e.coins?e.coins:0,this.isActivated=!1,this.sleepCount=0,this.lastPosition=!!e.lastPosition&&e.lastPosition},remove:function(){var t=this;this.sleepCount||(this.sleepCount=2,this.get("cell").removeWithPowerUp&&(this.sleepCount=1),t.$div.removeClass("hasCoins").addClass("hit_greedypirate").delay(250).queue(function(e){t.$div.removeClass("hit_greedypirate").addClass("sleep_greedypirate"),e()}),this.isActivated=!0,application.playSound("pirateHit"))},createDiv:function(){return FigureView.createByTemplate(".invisible ."+this.getDecoratorClass(),[])},renderCoins:function(){this.coins?this.$div.addClass("hasCoins"):this.$div.removeClass("hasCoins")},occupited:function(e){if(this.render(),"coin"==e.attribute){var t=this;this.$div.addClass("grab_greedypirate").delay(500).queue(function(e){t.$div.removeClass("grab_greedypirate"),t.renderCoins(),e()}),++this.coins,e.attribute=!1,e.$div.$attr.remove()}else this.renderCoins()},getPossibleNeighbors:function(a){var n=this.get("cell"),r=[];return _.each([{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1},{x:1,y:1}],function(e){var t=n.x+e.x,i=n.y+e.y;if(Game.inField(t,i)){var o=Game.field[i][t];o instanceof Cell&&o.isRegular&&!o.decorator&&!o.medusaBlocked&&!o.isBlocked("movable")&&this.lastPosition!=o&&-1===_.indexOf(a,o)&&r.push(o)}},this),r},getCoinCells:function(t){var i=[];return Game.each(function(e){e.constructor!==Cell||"coin"!=e.attribute||e.isBlocked("movable")||e.medusaBlocked||-1!==_.indexOf(t,e)||i.push(e)}),i},calcDistances:function(e){var t=this.get("cell");return _.each(e,function(e){e.distanceToPirate=_.max([Math.abs(e.x-t.x),Math.abs(e.y-t.y)])},this),_.sortBy(e,"distanceToPirate")},getMoveDirection:function(e,t){var i={x:0,y:0};return t.x!=e.x&&t.y!=e.y?(i.x=t.x>e.x?1:-1,i.y=t.y>e.y?1:-1):t.x==e.x&&t.y!=e.y?i.y=t.y>e.y?1:-1:t.x!=e.x&&t.y==e.y&&(i.x=t.x>e.x?1:-1),i},getPossibleMoves:function(e,t){var i=this.getMoveDirection(e,t),o=[{x:e.x+i.x,y:e.y+i.y}];return 0!==i.x&&o.push({x:e.x+i.x,y:e.y}),0!==i.y&&o.push({x:e.x,y:e.y+i.y}),0!==i.x&&(o.push({x:e.x+i.x,y:e.y+1}),o.push({x:e.x+i.x,y:e.y-1})),0!==i.y&&(o.push({x:e.x-1,y:e.y+i.y}),o.push({x:e.x+1,y:e.y+i.y})),t.x==e.x&&t.y!=e.y?(o.push({x:e.x+1,y:e.y}),o.push({x:e.x-1,y:e.y})):t.y==e.y&&t.x!=e.x&&(o.push({x:e.x,y:e.y+1}),o.push({x:e.x,y:e.y-1})),o},findMoveCellByTarget:function(e,t,i,o){(o=o||[]).push(e);for(var a=this.getPossibleMoves(e,t),n=0;n<a.length;n++){var r=a[n];if(Game.inField(r.x,r.y)){var s=Game.field[r.y][r.x];if(s instanceof Cell&&s.isRegular&&!s.decorator&&!s.medusaBlocked&&!s.isBlocked("movable")&&-1===_.indexOf(i,s)&&-1===_.indexOf(o,s)&&this.lastPosition!=s&&(t.x==s.x&&t.y==s.y||this.findMoveCellByTarget(s,t,i,o)))return s}}return!1},getMoveCell:function(e){var t=this.get("cell"),i=!1,o=!1,a=this.getCoinCells(e);if(a.length)for(a=this.calcDistances(a);a.length&&!o;)i=a.shift(),o=this.findMoveCellByTarget(t,i,e);return o||(a=this.getPossibleNeighbors(e)).length&&(o=RANDOM(a)),this.lastPosition=t,o},animateCoinsRelease:function(e,t){var i=_.after(e.length,t);_.each(e,function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute?i():(--this.coins,this.animateCoin(e,i))},this)},animateCoin:function(t,i){t.attribute="coin";var e=this.$div,o=FigureView.createByTemplate(".invisible .attribute_coin");_Figure.blockedAnimations.append(o),o.alignTo(e,{ajust:{x:0,y:0}}),o.ourAnimate({target:t.$div,animation:Library.collectFly,options:{vy:500}},600,"linear",function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate",["attribute","attribute_"+t.attribute]);t.$div.append(e),t.$div.$attr=e,o.remove(),i()})},moveCrab:function(e,t){var i=this.onMoveAnimation();return _Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),this.getDiv().remove(),i.ourAnimate({target:e.$div},250,"linear",function(){this.direction="",i.remove(),t()}),i},releaseCoins:function(t,i){var o=this;this.$div.delay(250).queue(function(e){o.animateCoinsRelease(t,i),e()})}},{SYMBOL:"P",processMoveCrab:function(e,t){var i=e.decorator.getMoveCell(t);return!!i&&(i.decorator=new GreedyPirateDecorator({lastPosition:e.decorator.lastPosition,cell:i,coins:e.decorator.coins}),e.decorator.moveCrab(i,Game.animate(function(){i.decorator.occupited(i),e.decorator=void 0,e.movable=!0})),i)},getPossibleCoinsTargets:function(){var t=[];return Game.each(function(e){e.constructor!==Cell||!e.life||e.decorator||e.attribute||t.push(e)}),_.shuffle(t)},process:function(a){var n,r=[],s=[],l=GreedyPirateDecorator.getPossibleCoinsTargets(),d=!1,c=!1;Game.each(function(e){var t;if(-1===_.indexOf(r,e)&&"greedypirate"==e.getDecoratorName()&&!e.isBlocked("movable")&&!e.medusaBlocked)if(n=e.decorator,a){if(n.isActivated&&(n.isActivated=!1,n.coins&&l.length&&(s=[],t=3<=n.coins?3:n.coins))){for(var i=0;i<t;i++)l.length&&s.push(l.pop());n.releaseCoins(s,Game.animate()),c=!0}}else{if(n.sleepCount<=0){var o=GreedyPirateDecorator.processMoveCrab(e,r);d=!0,o&&r.push(o)}n.sleepCount&&(--n.sleepCount,n.sleepCount<=0&&(n.$div.removeClass("sleep_greedypirate"),n.renderCoins()))}}),d&&application.playSound("pirateMove"),c&&application.playSound("pirateCoinsRelease")}});!function(e){if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports))module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t=e();window.astar=t.astar,window.Graph=t.Graph}}(function(){function m(e){for(var t=e,i=[];t.parent;)i.unshift(t),t=t.parent;return i}var f={search:function(e,t,i,o){e.cleanDirty();var a=(o=o||{}).heuristic||f.heuristics.manhattan,n=o.closest||!1,r=new C(function(e){return e.f}),s=t;for(t.h=a(t,i),e.markDirty(t),r.push(t);0<r.size();){var l=r.pop();if(l===i)return m(l);l.closed=!0;for(var d=e.neighbors(l),c=0,g=d.length;c<g;++c){var u=d[c];if(!u.closed&&!u.isWall()){var h=l.g+u.getCost(l),p=u.visited;(!p||h<u.g)&&(u.visited=!0,u.parent=l,u.h=u.h||a(u,i),u.g=h,u.f=u.g+u.h,e.markDirty(u),n&&(u.h<s.h||u.h===s.h&&u.g<s.g)&&(s=u),p?r.rescoreElement(u):r.push(u))}}}return n?m(s):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var i=Math.sqrt(2),o=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return 1*(o+a)+(i-2)*Math.min(o,a)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function e(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var i=0;i<e.length;i++){this.grid[i]=[];for(var o=0,a=e[i];o<a.length;o++){var n=new r(i,o,a[o]);this.grid[i][o]=n,this.nodes.push(n)}}this.init()}function r(e,t,i){this.x=e,this.y=t,this.weight=i}function C(e){this.content=[],this.scoreFunction=e}return e.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)f.cleanNode(this.nodes[e])},e.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)f.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},e.prototype.markDirty=function(e){this.dirtyNodes.push(e)},e.prototype.neighbors=function(e){var t=[],i=e.x,o=e.y,a=this.grid;return a[i-1]&&a[i-1][o]&&t.push(a[i-1][o]),a[i+1]&&a[i+1][o]&&t.push(a[i+1][o]),a[i]&&a[i][o-1]&&t.push(a[i][o-1]),a[i]&&a[i][o+1]&&t.push(a[i][o+1]),this.diagonal&&(a[i-1]&&a[i-1][o-1]&&t.push(a[i-1][o-1]),a[i+1]&&a[i+1][o-1]&&t.push(a[i+1][o-1]),a[i-1]&&a[i-1][o+1]&&t.push(a[i-1][o+1]),a[i+1]&&a[i+1][o+1]&&t.push(a[i+1][o+1])),t},e.prototype.toString=function(){for(var e=[],t=this.grid,i=0;i<t.length;i++){for(var o=[],a=t[i],n=0;n<a.length;n++)o.push(a[n].weight);e.push(o.join(" "))}return e.join("\n")},r.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},r.prototype.getCost=function(e){return e&&e.x!=this.x&&e.y!=this.y?1.41421*this.weight:this.weight},r.prototype.isWall=function(){return 0===this.weight},C.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return 0<this.content.length&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];0<e;){var i=(e+1>>1)-1,o=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(o)))break;this.content[i]=t,this.content[e]=o,e=i}},bubbleUp:function(e){for(var t=this.content.length,i=this.content[e],o=this.scoreFunction(i);;){var a,n=e+1<<1,r=n-1,s=null;if(r<t){var l=this.content[r];(a=this.scoreFunction(l))<o&&(s=r)}if(n<t){var d=this.content[n];this.scoreFunction(d)<(null===s?o:a)&&(s=n)}if(null===s)break;this.content[e]=this.content[s],this.content[s]=i,e=s}}},{astar:f,Graph:e}});var HunterDecorator=CrabDecorator.extend({defaults:function(){return{name:"hunter",cell:null,level:1}},constructor:function(e){CrabDecorator.prototype.constructor.call(this,e);var t=e.char?e.char:this.get("char");this.version=HunterDecorator.SYMBOL.indexOf(t),this.life=this.version?application.level["hunterLife"+this.version]:application.level.hunterLife,this.lifes=e.lifes?e.lifes:this.life;var i=this.version?application.level["isHunterStunned"+this.version]:application.level.isHunterStunned,o=this.version?application.level["isHunterMoveBack"+this.version]:application.level.isHunterMoveBack;this.isStunned="1"===i,this.isMoveBack="1"===o,this.isActivated=!1,this.direction=e.direction?e.direction:"right",this.sleepCount=e.sleepCount?e.sleepCount:0,this.lastPosition=!!e.lastPosition&&e.lastPosition},animateRemoval:function(){var e=GameBaseView.createFallDownExplodePiece("die_hunter"),t={x:28/60*Config.cellWidth,y:0};e.alignTo(this.getDiv(),{ajust:t}),gameView.fallDownExplodePiece(e),canvas.timeManager.setTimeout(Game.animate(),3*Game.get("speed")),this.getDiv().remove()},remove:function(){if(!this.isActivated){var t=this;application.playSound("hunterHit"),this.life&&(--this.lifes,this.$div.find(".hunterLife").html(this.lifes),this.lifes<=0)?Decorator.prototype.remove.call(t):this.sleepCount||(this.isActivated=!0,this.life&&!this.lifes||this.sleepCount||(this.isStunned&&(this.sleepCount=2,this.get("cell").removeWithPowerUp&&(this.sleepCount=1)),t.$div.addClass(this.direction).addClass("hit_hunter").delay(250).queue(function(e){t.$div.removeClass("hit_hunter").addClass("sleep_hunter"),e()})))}},createDiv:function(){var e=FigureView.createByTemplate(".invisible ."+this.getDecoratorClass(),[]);return this.life?e.find(".hunterLife").html(this.lifes):e.find(".hunterLifeBlock").hide(),this.direction&&e.addClass(this.direction),e},occupited:function(t){if(this.render(),t.constructor==HunterTargetCell){application.playSound("hunterGrab");var i=Game.animate(),o=this,a=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(a);var e="right"==this.direction?{x:28/60*Config.cellWidth,y:0}:{x:8/60*Config.cellWidth,y:0};a.alignTo(this.$div,{ajust:e}),this.$div.hide(),a.addClass("grab_hunter").delay(1100).queue(function(e){t.$div.addClass("opendoor").delay(250).queue(function(e){a.remove(),o.$div.show(),e(),Game.tasks.where({completed:!0}).length!=Game.tasks.length?new HunterFinishWindow({onClear:function(){t.$div.removeClass("opendoor").addClass("closedoor").delay(250).queue(function(e){e(),i()}),o.remove()}}):i()}),e()})}},getPossibleNeighbors:function(a){var n=this.get("cell"),r=[];return _.each([{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1},{x:1,y:1}],function(e){var t=n.x+e.x,i=n.y+e.y;if(Game.inField(t,i)){var o=Game.field[i][t];o instanceof Cell&&o.isRegular&&!o.decorator&&!o.medusaBlocked&&!o.isBlocked("removeOnRemoveNear")&&this.lastPosition!=o&&-1===_.indexOf(a,o)&&r.push(o)}},this),r},getTargetCell:function(t){var i=!1;return Game.each(function(e){e.constructor!==HunterTargetCell||e.medusaBlocked||e.isBlocked("movable")||-1!==_.indexOf(t,e)||(i=e)}),i},getBackCell:function(e){var t=this.get("cell"),i=this.getTargetCell();if(t.x==i.x&&t.y==i.y){this.lastPosition=!1;var o=this.getPossibleNeighbors(e);if(o.length)return RANDOM(o)}var a=this.getMoveCell(e);if(a){var n=t.x-(a.x-t.x),r=t.y-(a.y-t.y),s=[];s.push({x:n,y:r}),s.push({x:n-1,y:r}),s.push({x:n+1,y:r}),s.push({x:n,y:r-1}),s.push({x:n,y:r+1});for(var l=0;l<s.length;l++){var d=s[l];if(Game.inField(d.x,d.y)){var c=Game.field[d.y][d.x];if(c instanceof Cell&&c.isRegular&&this.lastPosition!=c&&!c.decorator&&!c.medusaBlocked&&!c.isBlocked("movable")&&Math.abs(c.x-t.x)<=1&&Math.abs(c.y-t.y)<=1&&-1===_.indexOf(e,c))return this.lastPosition=c}}}return!1},getMatrix:function(e){for(var t=[],i=0;i<Config.rows;i++){for(var o=[],a=0;a<Config.cols;a++)if(Game.inField(a,i)){var n=Game.field[i][a];!(n instanceof Cell&&n.isRegular||n instanceof HunterTargetCell)||n.decorator||n.isBlocked("movable")||n.medusaBlocked||-1!==_.indexOf(e,n)?o.push(0):o.push(1)}else o.push(0);t.push(o)}return t},getMoveCell:function(e){var t=this.get("cell"),i=!1,o=this.getTargetCell(e);if(o){var a=new Graph(this.getMatrix(e),{diagonal:!0});if(a.grid){var n=a.grid[t.y][t.x],r=a.grid[o.y][o.x],s=astar.search(a,n,r),l=!!s.length&&s.shift();l&&(i=!!Game.inField(l.y,l.x)&&Game.field[l.x][l.y])}}if(i)i.x<t.x?this.direction="left":i.x>t.x&&(this.direction="right");else{var d=this.getPossibleNeighbors(e);d.length&&(i=RANDOM(d))}return this.lastPosition=t,i},moveCrab:function(e,t){var i=this.onMoveAnimation();_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),this.getDiv().remove();var o="right"==this.direction?{x:-28/60*Config.cellWidth,y:0}:{x:8/60*Config.cellWidth,y:0};return i.ourAnimate({target:e.$div,ajust:o},500,"linear",function(){i.remove(),t()}),i}},{SYMBOL:"HQUI",processMoveCrab:function(e,t,i,o){var a;if(a=i?e.decorator.getBackCell(t):e.decorator.getMoveCell(t)){var n=e.decorator.sleepCount?e.decorator.sleepCount:i;return a.decorator=new HunterDecorator({lastPosition:e.decorator.lastPosition,char:e.decorator.get("char"),cell:a,direction:e.decorator.direction,lifes:e.decorator.lifes,sleepCount:n}),e.decorator.moveCrab(a,Game.animate(function(){a.decorator.occupited(a),e.decorator=void 0,e.constructor!==HunterTargetCell&&(e.movable=!0),i&&o?HunterDecorator.processMoveCrab(a,t,i,0):i&&!o&&a.decorator.sleepCount&&a.decorator.$div.addClass("sleep_hunter")})),a}return i&&!o&&e.decorator.sleepCount&&e.decorator.$div.addClass("sleep_hunter"),!1},process:function(t){var i,o,a=[],n=!1;Game.each(function(e){-1!==_.indexOf(a,e)||"hunter"!=e.getDecoratorName()||e.isBlocked("removable")||e.medusaBlocked||(i=e.decorator,t?i.isActivated&&(i.isActivated=!1,i.isMoveBack&&(o=HunterDecorator.processMoveCrab(e,a,1,1))&&a.push(o)):i.sleepCount?(--i.sleepCount,i.sleepCount<=0?i.$div.removeClass("sleep_hunter"):i.$div.hasClass("sleep_hunter")||i.$div.addClass("sleep_hunter")):(o=HunterDecorator.processMoveCrab(e,a,0),n=!0,o&&a.push(o)))}),n&&application.playSound("hunterMove")}}),CrabMedusaDecorator=CrabDecorator.extend({defaults:{name:"crabMedusa",cell:null,level:1,moves:void 0,version:"default"},onMoveSound:"crabMedusaMove",createDiv:function(){var e=FigureView.createByTemplate(".invisible ."+this.getDecoratorClass(),[]);if(e.find(".life").html(this.get("level")),this.get("moves")||this.setMoves(),"special"==this.get("version")){e.addClass(this.get("version"));var t=e.find(".crabMedusaMoves");t&&t.html(this.get("moves"))}return e},setMoves:function(){switch(application.level.decorators[this.get("cell").y].charAt(this.get("cell").x)){case"{":this.set("moves",application.level.crabMedusaMoves1),this.set("version","special");break;case"}":this.set("version","special"),this.set("moves",application.level.crabMedusaMoves2);break;case"[":this.set("version","special"),this.set("moves",application.level.crabMedusaMoves3);break;case"]":this.set("version","special"),this.set("moves",application.level.crabMedusaMoves4);break;default:this.set("version","special"),this.set("moves",2)}(!this.get("moves")||!_.isNumber(this.get("moves"))||this.get("moves")<2)&&this.set("moves",2)},onMoveAnimation:function(){var t=CrabDecorator.prototype.onMoveAnimation.call(this);return"special"==this.get("version")&&(t.addClass(this.get("version")),this.isMoveStarted||t.addClass("delay").delay(250).queue(function(e){t.removeClass("delay"),e()})),t},moveCrab:function(e,t){application.playSound(this.onMoveSound);var i=this.onMoveAnimation();_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),this.getDiv().remove();var o="default"==this.get("version")?500:300;return i.ourAnimate({target:e.$div},o,"linear",function(){this.direction="",i.remove(),t()}),e.x>this.get("cell").x?i.addClass("moveRight"):i.addClass("moveLeft"),i},crabOneStep:function(e,t,i,o,a,n){return this.isMoveStarted=!1,(o||a)&&(this.isMoveStarted=!0),CrabDecorator.prototype.crabOneStep.call(this,e,t,i,o,a,n)},animateRemoval:function(){"bonus"==application.level.num?Game.set("timeout",Game.get("timeout")+1e3*this.get("moves")):Game.set("moves",new ObscureNumber(Game.get("moves").get()+this.get("moves")));var e=GameBaseView.createFallDownExplodePiece("die_crabMedusa");e.addClass(this.get("version")),e.alignTo(this.getDiv()),gameView.fallDownExplodePiece(e),canvas.timeManager.setTimeout(Game.animate(),3*Game.get("speed")),Decorator.prototype.animateRemoval.call(this,this.getDiv()),application.playSound("crabMedusaRemove");var t,i=$(".snailMoveAdd");if(0===i.length)t=$('<div class="snailMoveAdd" id="'+this.get("moves")+'">&plus;'+this.get("moves")+"</div>");else{t=i;var o=parseInt(i.attr("id"))+this.get("moves");t.attr("id",o),t.html("&plus;"+o)}$(".blockedAnimations").append(t),"bonus"==application.level.num?t.alignTo($("#gameTimeBlock")):t.alignTo($("#moves")),t.ourAnimate({top:"-=20px",opacity:0},1e3,"linear",function(){$(this).remove()})},animateCollect:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("crabMedusaCollect");i.addClass(this.get("version")),_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),i.ourAnimate({target:e,scale:.75},10*Game.get("speed"),void 0,function(){Game.set("score",Game.get("score")+GameScores.medusa),Game.trigger("showFieldPoints",i,GameScores.medusa,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){t(),i.remove()})}},{SYMBOL:":{}[]",occupite:function(e,t,i,o){e.decorator=new CrabMedusaDecorator({cell:e,level:t,moves:i,version:o})}}),ChangeColorDecorator=Decorator.extend({initialize:function(){this.set({name:"changecolor",oneTimeRemove:!0})},remove:function(e){Decorator.prototype.remove.call(this),this.get("cell").remove(e)},process:function(){for(var e=this.get("cell").color,t=0;t<100&&(this.get("cell").setRandomColor(),this.get("cell").color==e);t++);this.changeColorDecoratorProcess(e,Game.animate())},changeColorDecoratorProcess:function(e,t){var i=this.get("cell");i.$div.find(".decorator_changecolor").removeClass("stable").addClass("changeMove").ruleAnimation.once("round",function(){i.$div.find(".decorator_changecolor").removeClass("changeMove").addClass("stable"),t()}),canvas.timeManager.setTimeout(function(){i.$div.removeClass("color_"+e).addClass("color_"+i.color)},300)}},{SYMBOL:"l",process:function(){Game.each(function(e){"changecolor"==e.getDecoratorName()&&e.decorator.process()})}}),StickyChainDecorator=Decorator.extend({defaults:{name:"stickyChain",cell:null,level:1},initialize:function(){Decorator.prototype.initialize.apply(this,arguments);var t=this.get("cell");this.cellRemovableValue=t.removable,t.removable=!1,this.removable=!1,"none"!==t.color&&(t.saveColor=t.color,t.color="none");var i=this;Game.once("start",function(){for(var e=-1;e<=1;e+=2)"horizontal"===i.getDirection()?(t.x+e,t.y):(t.x,t.y+e)})},createDiv:function(){var e=Decorator.prototype.createDiv.apply(this,arguments);return e.addClass(this.getDirection()),e},destroy:function(){if(!this.destroyed){this.destroyed=!0,Decorator.prototype.remove.apply(this,arguments);var e=this.get("cell");0===this.get("level")&&(e.saveColor&&(e.color=e.saveColor,delete e.saveColor),e.removable=this.cellRemovableValue);for(var t=-1;t<=1;t+=2){var i,o;if("horizontal"===this.getDirection()?(i=e.x+t,o=e.y):(i=e.x,o=e.y+t),Game.inField(i,o)){var a=Game.field[o][i];a.decorator&&a.decorator instanceof StickyChainDecorator&&a.decorator.destroy()}}}},remove:function(){this.trigger("remove")},getDirection:function(){return"~"===this.get("char")?"horizontal":"vertical"},animateRemoval:function(){application.playSound("stickyChainDestroy"),gameView.fallDownExplode(this.getDiv(),2,this.getAnimatedPiecesClass()),Decorator.prototype.animateRemoval.apply(this,arguments)}},{SYMBOL:"~|",process:function(){Game.each(function(e){var t=e.decorator;if(t&&t instanceof StickyChainDecorator){for(var i={"-1":!1,1:!1},o=-1;o<=1;o+=2){var a=void 0,n=void 0;if("horizontal"===t.getDirection()?(a=e.x+o,n=e.y):(a=e.x,n=e.y+o),Game.inField(a,n))Game.field[n][a].movable||(i[o.toString()]=!0);else i[o.toString()]=!0}i[-1]&&i[1]||t.destroy()}}),Game.explode()}}),SeaweedDecorator=Decorator.extend({defaults:{name:"seaweed",cell:null,level:1},constructor:function(e){Decorator.prototype.constructor.call(this,e),this.color=Cell.chars[SeaweedDecorator.SYMBOL.indexOf(this.get("char"))]},initialize:function(){Decorator.prototype.initialize.apply(this,arguments);var e=this.get("cell");this.cellRemovableValue=e.removable,e.removable=!1,this.removable=!1,this.takeColor()},createDiv:function(){var e=Decorator.prototype.createDiv.call(this);return e.addClass("SeaweedDecoratorColor"+this.color),e},remove:function(){this.removable&&(Decorator.prototype.remove.call(this),0===this.get("level")&&(this.backColor(),this.get("cell").removable=this.cellRemovableValue))},animateRemoval:function(){var e=this.getDiv().clone();_Figure.blockedAnimations.append(e),e.alignTo(this.getDiv()),e.addClass("die").delay(200).queue(function(e){this.remove(),e()}),Decorator.prototype.animateRemoval.call(this)}},{SYMBOL:SeaweedKeyCell.chars}),SpiderWebDecorator=GrowDecorator.extend({defaults:_.defaults({movableDecorator:!1},GrowDecorator.prototype.defaults),initialize:function(){this.set({name:"spiderweb",oneTimeRemove:!0}),Decorator.prototype.initialize.apply(this,arguments)},remove:function(){Game.explodeSpiderWeb=!0,Decorator.prototype.remove.call(this)},animateRemoval:function(){application.playSound("spiderWebDecoratorRemove");var e=FigureView.createByTemplate(".invisible .spiderwebAnnihilation");_Figure.blockedAnimations.append(e),e.alignTo(this.getDiv()),e.sprite.once("round",function(){e.remove()}),Decorator.prototype.animateRemoval.call(this,this.getDiv())}},{SYMBOL:"q",occupite:function(e){e.decorator=new SpiderWebDecorator({cell:e}),e.decorator.render();var t=Game.animate();application.playSound("spiderWebDecoratorOccupied"),e.decorator.getDiv().removeClass("stable").addClass("spiderweb_appearance").sprite.once("round",function(){e.decorator.getDiv().removeClass("spiderweb_appearance").addClass("stable"),t()})},process:function(){var e=GrowDecorator.process("explodeSpiderWeb",function(e){var t=void 0!==SpiderwebFarmCell&&e instanceof SpiderwebFarmCell;return"spiderweb"===e.getDecoratorName()||t});e&&SpiderWebDecorator.occupite(e)}}),MonkeyDecorator=Decorator.extend({defaults:{name:"monkey",cell:null,level:1,oneTimeRemove:!0},animateRemoval:function(){Game.trigger("removedDecorator",this),application.playSound("monkeyRemove"),Decorator.prototype.animateRemoval.call(this,this.getDiv())},calcAjust:function(e,t){var i=parseInt(t.css("width"))/e.width();return{x:-(1-i)*e.width()/2,y:-(1-i)*e.height()/2}},animateCollect:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("decorator_monkey").addClass("die");_Figure.blockedAnimations.append(i),i.alignTo(this.getDiv()),i.ourAnimate({},400,void 0,function(){i.removeClass("die"),i.addClass("monkeyCollect")}).ourAnimate({ajust:this.calcAjust(i,e),target:e,scale:.75},10*Game.get("speed"),void 0,function(){Game.set("score",Game.get("score")+GameScores.monkey),Game.trigger("showFieldPoints",i,GameScores.monkey,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){t(),i.remove()})}},{SYMBOL:"",taskId:"monkey"}),EelDecorator=Decorator.extend({highlightDecoratorBody:!0,removedById:0,defaults:{cell:null,group:0,headLength:2,level:1,movableDecorator:!1,name:"eel",order:0},constructor:function(e){var t=this;Decorator.prototype.constructor.call(this,e);var i=application.level.eelDecoratorData&&application.level.eelDecoratorData.find(function(e){return e.x===t.get("cell").x&&e.y===t.get("cell").y});i&&this.set({group:i.group,order:i.order})},render:function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate");e.addClass("eelDecoratorShadow"),this.cellDecoratorPlace().append(e),Decorator.prototype.render.call(this),this.updateBody(),this.get("cell").$div.addClass("eelDecoratorOnCell"),this.defineFieldPartClass(this.get("cell"))},updateBody:function(){this.$div.removeClass().addClass("decorator").addClass("stable").addClass("decorator_eel"),this.isHead()?(this.$div.addClass("head"),this.getBody().length<=this.get("headLength")&&this.$div.addClass("babyEel"),this.$div.find(".eel_stars").removeClass("eel_stars").addClass("eel_stars"),this.$div.find(".eel_fin").removeClass("stable").addClass("stable")):this.isTail()?this.$div.addClass("tail"):this.isDirection(Direction.vertical)||this.isDirection(Direction.horizontal)?this.$div.addClass("body"):this.$div.addClass("corner");var e=this.getNext(),t=this.getPrev();if(e&&!this.isTail()&&this.$div.addClass("next_"+DirectionName[this.getDirection(e)]),t){this.$div.addClass("prev_"+DirectionName[this.getDirection(t)]);var i=t&&Game.getField(t.x,t.y);if(i&&i.decorator&&i.decorator.isHead()&&(this.$div.addClass("afterHead"),this.$div.find(".fin2").removeClass("stable").addClass("stable"),this.isTail())){var o=i.decorator.$div;o?o.addClass("babyEel"):this.listenToOnce(Game,"prepared",this.updateBody),this.$div.addClass("babyEel")}}this.isDirection(Direction.vertical)?this.$div.addClass("vertical"):this.isDirection(Direction.horizontal)?this.$div.addClass("horizontal"):this.$div.addClass("corner")},defineFieldPartClass:function(e){var t=Math.floor(Config.cols/2),i=Math.floor(Config.rows/2),o=e.y>=i,a=e.x>=t,n="";n=o?a?"bottomRightFieldSide":"bottomLeftFieldSide":a?"topRightFieldSide":"topLeftFieldSide",e.$div.addClass(n)},isTail:function(){var e=this.getBody();return e[e.length-1].decorator===this},getDecoratorByOrder:function(t){var i=this;return application.level.eelDecoratorData.find(function(e){return e.group===i.get("group")&&e.order===t})},getDirection:function(e){if(e){var t=this.get("cell");if(e.x===t.x)return e.y>t.y?Direction.down:Direction.up;if(e.y===t.y)return e.x>t.x?Direction.right:Direction.left}return null},isDirection:function(e){var t=this.getNext(),i=this.getPrev(),o=this.getDirection(t),a=this.getDirection(i);return(o&e||!t)&&(a&e||!i)},getNext:function(){return this.getDecoratorByOrder(this.get("order")+1)},getPrev:function(){return this.getDecoratorByOrder(this.get("order")-1)},initialize:function(){Decorator.prototype.initialize.call(this),this.takeColor()},getHead:function(){return this.getBody()[0]},isHead:function(){return this.getHead().decorator===this},getBody:function(){var i=this,e=Game.filter(function(e){var t=e.decorator;return t&&t instanceof EelDecorator&&t.get("group")===i.get("group")});return _.sortBy(e,function(e){return e.decorator.get("order")})},animateRemoval:function(){var i=this;this.getBody().forEach(function(e){e.decorator.getDiv().addClass("damaged").find(".eel_stars").removeClass("eel_stars").addClass("eel_stars")});var e=this._getTask(),t=!e||e&&e.isCollected();if(this.isTail()&&this.getBody().length>this.get("headLength")){var o=Game.animate(function(){i.getBody().forEach(function(e){var t=e.decorator;t.getDiv().queue(function(e){i.getBody().length<=i.get("headLength")&&(application.playSound("eelBabality"),t.get("cell").$div.addClass("babyEelTransform"),setTimeout(function(){t.get("cell").$div.addClass("babyEelEyeAnimation")},500)),t.updateBody(),e()})})});this.animatePart(o)}else if(this.isHead()&&t){var a=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("decorator_eel").addClass("babyEelTask");_Figure.blockedAnimations.append(a),a.alignTo(this.get("cell").$div),gameView.fallDownExplodePiece(a)}Decorator.prototype.animateRemoval.call(this)},animatePart:function(e){var t=this.getDiv(),i=this.getDecoratorByOrder(this.get("order")-1);if(i){var o=Game.getField(i.x,i.y),a=!o.decorator.isDirection(Direction.vertical)&&!o.decorator.isDirection(Direction.horizontal),n=t.clone();if(a){var r=FigureView.createByTemplate(".invisible .emptyTemplate");r.addClass("decorator_eelRotating"),_Figure.blockedAnimations.append(r);var s=o.decorator.getPrev(),l=o.decorator.getNext(),d=0,c=0,g=0,u=[];o.decorator.getDirection(s)===Direction.top&&o.decorator.getDirection(l)===Direction.left||o.decorator.getDirection(s)===Direction.left&&o.decorator.getDirection(l)===Direction.bottom||o.decorator.getDirection(s)===Direction.bottom&&o.decorator.getDirection(l)===Direction.right||o.decorator.getDirection(s)===Direction.right&&o.decorator.getDirection(l)===Direction.top?(g=-90,u=["hidePart1","hidePart2","hidePart3"],o.decorator.getDirection(s)===Direction.left&&o.decorator.getDirection(l)===Direction.bottom?c=Config.cellHeight:o.decorator.getDirection(s)===Direction.bottom&&o.decorator.getDirection(l)===Direction.right?(d=Config.cellWidth,c=Config.cellHeight):o.decorator.getDirection(s)===Direction.right&&o.decorator.getDirection(l)===Direction.top&&(d=Config.cellWidth)):(g=90,u=["hidePart3","hidePart2","hidePart1"],o.decorator.getDirection(s)===Direction.top&&o.decorator.getDirection(l)===Direction.right&&(d=Config.cellWidth),o.decorator.getDirection(s)===Direction.right&&o.decorator.getDirection(l)===Direction.bottom&&(d=Config.cellWidth,c=Config.cellHeight),o.decorator.getDirection(s)===Direction.bottom&&o.decorator.getDirection(l)===Direction.left&&(c=Config.cellHeight)),r.alignTo(o.$div,{ajust:{x:d,y:c}});var h=10*Game.get("speed"),p=o.decorator.getDiv();r.append(n),n.alignTo(t),r.queue(function(e){0<u.length&&u.forEach(function(e,t){setTimeout(function(){p.addClass(e)},410+200*t)}),e()}).ourAnimate({rotate:g},h,void 0,function(){r.remove(),e()})}else{_Figure.blockedAnimations.append(n),n.alignTo(t);var m=1,f=1,C=0,y=0;this.getDirection(i)===Direction.down&&(f=0,y=Config.cellHeight/2),this.getDirection(i)===Direction.up&&(f=0,y=-Config.cellHeight/2),this.getDirection(i)===Direction.left&&(m=0,C=-Config.cellWidth/2),this.getDirection(i)===Direction.right&&(m=0,C=Config.cellWidth/2),n.queue(function(e){e(),o.decorator.$div.ourAnimate({"scale-x":m,"scale-y":f,x:C,y:y},10*Game.get("speed"),void 0)}).ourAnimate({target:o.$div},10*Game.get("speed"),void 0,function(){n.remove(),e(),o.decorator.$div.set({"scale-x":void 0,"scale-y":void 0,x:0,y:0})})}}else e()},remove:function(){var i=this;if(this.isHead()){application.playSound("eelHit");var e=this.getHead();if(e.removedById!==Game.actionId&&!this.isMedusaBlocked()&&!this.isBlocked("removable")){e.removedById=Game.actionId;var t=this.getBody();t.length>this.get("headLength")?this.removeDecorator(t[t.length-1].decorator):t.reverse().forEach(function(e){var t=e.decorator;i.removeDecorator(t)})}}else this.getHead().remove()},removeDecorator:function(e){1===e.get("level")&&e.backColor(),e.get("cell").$div.removeClass("eelDecoratorOnCell");var t=e.get("cell").$div.find(".stable");t.length&&t.removeClass("stable").addClass("stable"),Decorator.prototype.remove.call(e)},isMedusaBlocked:function(){var e=this.getBody();return Boolean(e[e.length-1].medusaBlocked)||this.get("cell").medusaBlocked},isRemovable:function(){return!this.isBlocked("removable")&&(!this.isMedusaBlocked()&&Decorator.prototype.isRemovable.call(this))},animateCollect:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("decorator_eel").addClass("babyEelTask");_Figure.blockedAnimations.append(i),i.alignTo(this.get("cell").$div),i.ourAnimate({},400,void 0,function(){i.removeClass("die"),i.addClass("eelCollect")}).ourAnimate({ajust:this.calcAjust(i,e),target:e,scale:.75},10*Game.get("speed"),void 0,function(){Game.set("score",Game.get("score")+GameScores.eel),Game.trigger("showFieldPoints",i,GameScores.eel,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){t(),i.remove()})},calcAjust:function(e,t){var i=parseInt(t.css("width"))/e.width();return{x:-(1-i)*e.width()/2,y:-(1-i)*e.height()/2}},highlight:function(i){this.isBlocked("removable")||this.isMedusaBlocked()||(this.isHead()?this.getBody().forEach(function(e){var t=e.decorator;i?t.$div.removeClass("powerUpHighlight"):t.$div.addClass("powerUpHighlight")}):this.getHead().highlight(i))},_getTask:function(){return Game.tasks.find(function(e){return e instanceof CollectEelDecorator})},isBlocked:function(t){var e=this.getBody();return _.some(e,function(e){return e.isBlocked(t)})}},{SYMBOL:""}),CollectEelDecorator=CollectDecorator.extend({defaults:_.defaults({event:"removedDecorator_eel"},CollectDecorator.prototype.defaults),canCollect:function(e){return 1===e.getBody().length},tick:function(e){application.playSound("eelTask"),e.animateCollect(this.$div,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}}),FishnetDecorator=Decorator.extend({defaults:{name:"fishnet",level:1,oneTimeRemove:!0,cell:null},animateRemoval:function(){1==this.get("level")&&(application.playSound("FishnetRemoveRope"),this.getDiv().animationByName("FishnetRemoveRope").queue(function(){this.remove()}))},render:function(){this.$div=this.createDiv().appendTo(FigureView.findById("medusa")).alignTo(this.get("cell").$div)}}),FishnetCell=MultiCell.extend({width:1,height:2,scoresId:"fishnet",constructor:function(e,t,i,o){0===FishnetCell.chars.indexOf(o)?(this.align="vertical",this.width=1,this.height=2):(this.align="horizontal",this.width=2,this.height=1),MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1},beforeRemove:function(e){MultiCell.prototype.beforeRemove.call(this,e);var t=this;this.$div.queue(function(e){t.$rope.animationByName("FishnetRemoveRope").queue(function(){t.$rope.remove(),t.isHead()&&application.playSound("FishnetRelease"),e()})})},createDiv:function(){var e=BaseCell.prototype.createDiv.call(this);return this.$rope=FigureView.createByTemplate(".invisible .decorator_fishnet",[]).appendTo(FigureView.findById("medusa")).alignTo(e),this.isHead()&&(e.addClass(this.align),_.defer(_.bind(this.initRopes,this))),e},initRopes:function(){for(var e=0,t=function(){0==--e&&(this.removable=!0,this.remove())},i=-1;i<=this.width;++i)for(var o=-1;o<=this.height;++o)if(Game.inField(this.x+i,this.y+o)){var a=Game.field[this.y+o][this.x+i];a.constructor!==this.constructor&&(a.decorator=new FishnetDecorator({cell:a}),a.decorator.render(),a.movable=!1,i<0?a.decorator.$div.addClass("ropeLeft"):i>=this.width&&a.decorator.$div.addClass("ropeRight"),o<0?a.decorator.$div.addClass("ropeTop"):o>=this.height&&a.decorator.$div.addClass("ropeBottom"),++e,this.listenToOnce(a.decorator,"remove",t))}},getTemplateClass:function(){return this.isHead()?"fishnetCell":MultiCell.prototype.getTemplateClass.call(this)}},{chars:""}),EaterStarsCell=MultiCell.extend({width:2,height:2,scoresId:"eaterstars",constructor:function(e,t,i,o){MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1,this.isHead()&&Game.once("prepared",this.initTaskListeners,this)},initTaskListeners:function(){if(this.task=Game.tasks.find(function(e){return e instanceof CollectType&&e.get("cellClass")===MultiColorCell}),this.task){this.$div.find(".maxLife").html(this.task.get("beginAmount")),this.$div.find(".currentLife").html(this.task.get("collectedAmount")),this.task.set("cssClass","CollectType_eaterstars"),this.listenTo(this.task,"change:collectedAmount",this.onCollect),this.listenToOnce(this.task,"change:completed",this.onComplate);var n=0,i=this;this.task.canCollect=function(e){if(e instanceof this.get("cellClass")){var t=i.getBody();if(_.any(t,function(e){return e.medusaBlocked||e.isBlocked("removable")}))return;return!0}return!1},this.task.animateCollect=(r=this.task.animateCollect,s=this,function(e,t,i,o){0===n&&s.$div.removeClass("stable").addClass("beforeCollect").animationByName("eaterstarsBeforeCollect"),++n;var a=s.$div.find(".target");s.task.icoSize=a.width(),s.task.precalc(a),r.call(this,e,t,function(){0!=--n||s.removable?i():s.$div.removeClass("beforeCollect").addClass("afterCollect").animationByName("eaterstarsAfterCollect").queue(function(e){s.$div.removeClass("afterCollect").addClass("stable"),e(),i()})},o,a)})}var r,s},getHeadTemplateClass:function(){return"eaterStarsCell"},onComplate:function(){this.removable=!0,this.remove()},onCollect:function(e,t){this.$div.find(".currentLife").html(this.task.get("collectedAmount")),application.playSound("eaterstarsCollect")},animateRemoval:function(t){application.playSound("eaterstarsRemoval"),this.$div.animationByName("eaterstarsDie").queue(function(e){e(),this.remove(),t()})}},{chars:""}),MagicWandCell=MultiCell.extend({width:2,height:2,scoresId:"magicwand",constructor:function(e,t,i,o){MultiCell.prototype.constructor.call(this,e,t,i,o),this.isHead()&&(this.maxLife=application.level.magicWandCharge||3,this.life=this.maxLife,this.arrows=[],this.charged=!1),this.removable=!1},getHeadTemplateClass:function(){return"magicWandCell"},render:function(){this.$div.find(".chargeAmount").html(this.life)},removeByArrow:function(e){this.isHead()?this.charged||-1===this.arrows.indexOf(e)&&(this.arrows.push(e),this.life--,0<this.life?this.animateTakeLife(Game.animate()):(this.life=this.maxLife,this.charged=!0,this.charges=3,this.animateCharged())):this.head.removeByArrow(e)},animateTakeLife:function(t){var i=this.$div.find(".taskIcoFull"),o=this.$div.find(".charge"),a=1-this.life/this.maxLife,n=FigureView.createByTemplate(".invisible .emptyTemplate",["magicWandLighting"]);this.$div.find(".chargeAmount").html(this.life),o.addClass("stable"),this.$div.append(n),n.alignTo(this.$div.find(".magicStartPoint")),this.$div.queue(function(e){i.animate({opacity:a},600,null,function(){o.removeClass("stable"),n.remove(),t(),e()})}),application.playSound("magicWandTakeCharge")},animateCharged:function(){var t=this.$div.find(".taskIcoFull");this.$div.find(".chargeAmount").html(this.life),this.$div.find(".chargeText").addClass("lighting").removeClass("stable"),this.$div.find(".charge").addClass("stable"),this.$div.queue(function(e){t.animate({opacity:1},600,null,function(){e()})}),application.playSound("magicWandCharged")},animateUncharged:function(){var t=this.$div.find(".taskIcoFull"),i=this.$div.find(".chargeText"),o=this.$div.find(".charge");this.$div.queue(function(e){t.animate({opacity:0},600,null,function(){i.removeClass("lighting").addClass("stable"),o.removeClass("stable"),e()})}),application.playSound("magicWandUncharged")},usePower:function(){var t=[];if(Game.each(function(e){e.constructor!==Cell||e.decorator||!e.isRemovable()||_.any(MagicWandCell.touched,{x:e.x,y:e.y})||t.push({x:e.x,y:e.y})}),0===t.length)return!1;var i=RANDOM(t);MagicWandCell.touched.push(i);var o=Game.field[i.y][i.x],a=Game.animate(),n=(this.$div.find(".chargeAmount"),this.$div.find(".charge"),this.charges-1),r=(this.life,FigureView.createByTemplate(".invisible .emptyTemplate",["magicWandLighting"]));return _Figure.blockedAnimations.append(r),r.alignTo(this.$div.find(".magicStartPoint")),r.ourAnimate({target:o.$div},600,"easeInQuad").queue(_.bind(function(e){r.remove(),0===n&&this.animateUncharged(),o.$div.ourAnimate({dy:-5},120,"linear").ourAnimate({dy:5},90,"linear").ourAnimate({dy:-5},60,"linear").ourAnimate({dy:5},40,"linear"),o.$div.ourAnimate({dy:-5},30,"linear").ourAnimate({dy:5},30,"linear",function(){o.bRemoveByMagicWand=!0,o.remove(!0);var e=new MultiColorCell(i.y,i.x);Game.addItem(e,!0),a()})},this)),application.playSound("magicWandLighting"),!0},process:function(){this.charged&&this.usePower()&&(this.charges--,this.charged=0<this.charges)}},{touched:[],process:function(){this.touched=[],Game.each(function(e){e instanceof MagicWandCell&&e.process()})},chars:"d"}),BarCell=MultiCell.extend({isRemoveOnce:!0,constructor:function(e,t,i,o){var a=o;if(BarCell.chars.indexOf(o)<6&&(o=Cell.chars.charAt(BarCell.chars.indexOf(o))),MultiCell.prototype.constructor.call(this,e,t,i,o),this.removeOnRemoveNear=!0,this.isHead()&&i){for(this.life=application.level.barCellLifes&&application.level.barCellLifes[10*this.x+this.y]||application.level["barCell"+this.color+"Life"]||5,this.offenders=[],this.width=0,this.height=0;this.x+this.width<Config.cols&&application.level.map[this.y].charAt(this.x+this.width)===a;)this.width++;for(;this.y+this.height<Config.rows&&application.level.map[this.y+this.height].charAt(this.x)===a;)this.height++}},removeNear:function(e,t,i){this.isHead()?this.isRemovable()&&(t&&"s"!==this.color&&this.color!==t||i&&-1!==this.offenders.indexOf(i)||(this.offenders.push(i),this.bite())):this.head.removeNear(e,t,i)},remove:function(e){if(this.removeWithPowerUp)return this.removeWithPowerUp=!1,void this.head.biteByHammer();if(this.multiColorRemoveId){var t=this.multiColorRemoveId;if(this.multiColorRemoveId=!1,-1===this.head.offenders.indexOf(t))return void this.head.biteByMulticolor(t)}this.isHead()?BaseCell.prototype.remove.call(this,e):0===this.head.life?BaseCell.prototype.remove.call(this,e):this.head.remove(e)},bump:function(e){this.isHead()?-1===this.offenders.indexOf(e.id)&&(this.offenders.push(e.id),this.bite()):this.head.bump(e)},biteByMulticolor:function(e){-1===this.offenders.indexOf(e)&&(this.offenders.push(e),this.bite())},biteByHammer:function(){this.offenders.push("hammer"),this.bite()},bite:function(){BaseCell.prototype.remove.call(this)},highlight:function(t){this.isHead()?(_.each(this.getBody(),function(e){BaseCell.prototype.highlight.call(e,t)}),t?this.$lifeBlock.removeClass("powerUpHighlight"):this.$lifeBlock.addClass("powerUpHighlight")):this.head.highlight(t)},getHead:function(){return void 0!==this.head?this.head:Game.inField(this.x-1,this.y)&&Game.field[this.y][this.x-1].constructor===BarCell&&Game.field[this.y][this.x-1].color===this.color?Game.field[this.y][this.x-1].getHead():Game.inField(this.x,this.y-1)&&Game.field[this.y-1][this.x].constructor===BarCell&&Game.field[this.y-1][this.x].color===this.color?Game.field[this.y-1][this.x].getHead():this},getPosition:function(){return this.isHead()?1===this.width&&1===this.height?"OnePiece":1===this.width?"VerticalTop":1===this.height?"HorizontalLeft":"TopLeftCorner":this.x===this.head.x?this.y===this.head.y+this.head.height-1?1===this.head.width?"VerticalBottom":"BottomLeftCorner":1===this.head.width?"VerticalMiddle":"LeftSide":this.y===this.head.y?this.x===this.head.x+this.head.width-1?1===this.head.height?"HorizontalRight":"TopRightCorner":1===this.head.height?"HorizontalMiddle":"TopSide":this.x===this.head.x+this.head.width-1?this.y===this.head.y+this.head.height-1?"BottomRightCorner":"RightSide":this.y===this.head.y+this.head.height-1?"BottomSide":"Middle"},getTemplateClass:function(){return"emptyTemplate"},render:function(){this.$div.addClass("barCell").addClass(this.getPosition()),this.x===this.head.x+this.head.width-1&&this.y===this.head.y+this.head.height-1&&this.head.createLifeBlock();var e=this;this.$div.onRemove(function(){e.removeLifeBlock()})},createLifeBlock:function(){this.$lifeBlock=FigureView.createByTemplate(".invisible .barCellLifeBlock",["color_"+this.color,"life"+this.life]),this.$lifeBlock.appendTo(this.$div.parent()),this.$lifeBlock.alignTo(this.$div),this.$lifeBlock.set({x:this.$lifeBlock.get("x")+Config.cellWidth*this.width/2,y:this.$lifeBlock.get("y")+Config.cellHeight*this.height/2}),this.renderLife()},renderLife:function(){var e=this.life+1;this.$lifeBlock.removeClass("life"+e).addClass("life"+this.life)},getCurrentColor:function(){return"none"},animateTakeLife:function(t){var i=this.life+1;this.$div.queue(_.bind(function(e){application.playSound("barLifeRemove"),this.$lifeBlock.find(".lifeGem"+i).ourAnimate({scale:0},500,"easeInBack",_.bind(function(){this.renderLife(),t(),e()},this))},this))},beforeRemove:function(){if(this.isHead()){var t=this.$lifeBlock;_.each(_.pluck(this.getBody(),"$div"),function(e){e.clone().appendTo(t).alignTo(e)}),t.find(".lifeGem1").clone().appendTo(t),Game.set("score",Game.get("score")+GameScores.bar),Game.trigger("showFieldPoints",t,GameScores.bar,"barCellRemove")}MultiCell.prototype.beforeRemove.call(this)},removeLifeBlock:function(){if(this.isHead()){var e=this.$lifeBlock;e&&e.ourAnimate({scale:0},500,"easeInBack",function(){e.remove()})}},animateRemoval:function(e){this.$div.queue(function(){this.remove(),application.playSound("barRemove"),e()})}},{chars:"s"}),GlowwormCell=BaseCell.extend({scoresId:"glowworm",removable:!0,render:_.noop,color:null,bottleColor:".",colorQueueIndex:-1,colorQueue:"",isRemoveOnce:!1,constructor:function(e,t,i,o){BaseCell.call(this,e,t,i,o),this.color=null,this.movable=!1,i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this));var a=application.level.glowwormColorData,n=a&&a[t]&&a[t][e];n&&(this.colorQueue=n),this.bottleColor=this.getNextCollectColor(),Game.once("prepared",this.onPrepareGame,this)},onPrepareGame:function(){this.initTaskListeners(),this.updateBody()},initTaskListeners:function(){this.task=Game.tasks.findWhere({type:"CollectGlowworm"})||null,this.task&&this.listenToOnce(this.task,"change:completed",this.onComplete)},updateBody:function(){this.$div.removeClass("stable").addClass("stable")},onComplete:function(){var e=this;if(this.isBlocked("removable")||this.medusaBlocked)this.listenToOnce(Game,"endTurn",function(){e.onComplete()});else for(var t=this.decorator?this.decorator.level+1:1,i=0;i<t;i++)BaseCell.prototype.remove.call(this)},calcColor:function(){return"glowwormCell_"+this.bottleColor},createDiv:function(){return Cell.prototype.createDiv.call(this,["glowwormCell",this.calcColor()])},getTemplateClass:function(){return"glowwormCell"},removeNear:function(e,t){if(!this.isBlocked("removeOnRemoveNear")&&!this.medusaBlocked&&this.bottleColor===t){if(this.decorator)return void this.decorator.remove();this.processDamage()}},remove:function(e){return!this.isBlocked("removable")&&!this.medusaBlocked&&(this.decorator?this.decorator.remove(e):this.processDamage(),!0)},processDamage:function(){var e=this,t=Game.animate(function(){e.processCollectTask(),e.setCollectColor(e.getNextCollectColor())}),i=this;this.$div.removeClass("stable").addClass("damage").delay(500).queue(function(e){t(),i.$div.removeClass("damage").addClass("afterDamage"),e()}).delay(500).queue(function(e){i.$div.removeClass("afterDamage").addClass("stable"),e()})},setCollectColor:function(e){this.$div.removeClass(this.calcColor()),this.bottleColor=e,this.$div.addClass(this.calcColor())},getNextCollectColor:function(){var e=application.level.colors,t=RANDOM(e);if(this.colorQueue){this.colorQueueIndex=(this.colorQueueIndex+1)%this.colorQueue.length;var i=this.colorQueue[this.colorQueueIndex];-1!==e.indexOf(i)&&(t=i)}return t},processCollectTask:function(){Game.trigger("glowwormCellRemoved",this)}},{chars:""}),CollectGlowworm=Task.extend({initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","glowwormCellRemoved"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof GlowwormCell},animateCollect:function(e,t,i,o){var a=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("glowwormCollect"),n=Game.animate();a.addClass("glowwormCell_"+e.bottleColor),_Figure.blockedAnimations.append(a),a.alignTo(e.$div,{useMargin:!0}),a.ourAnimate({target:this.target,scale:.75},5*Game.get("speed"),"easeInQuad",function(){Game.set("score",Game.get("score")+t),Game.trigger("showFieldPoints",a,t,"collectTaskElem")}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){i(),n(),a.remove()})},tick:function(e){this.animateCollect(e,GameScores.glowworm,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}}),SeaHorseCell=BaseCell.extend({constructor:function(e,t,i,o){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1,this.needRun=!1,this.orientation=o,i&&SeaHorseCell.listenToGame()},getTemplateClass:function(){return"seahorseCell"},createDiv:function(e){BaseCell.prototype.createDiv.call(this,e),""===this.orientation&&this.$div.find(".seahorseBg").addClass("leftMove"),Game.on("removedItem",this.removeItemCallback,this)},countItems:function(e,t,i){for(var o=this.x,a=this.y,n=0;o+=t,a+=i,n++,_.find(e,{x:o,y:a}););return n-1},removeItemCallback:function(e){this.medusaBlocked||this.isBlocked("removeOnRemoveNear")||!e.removeWithPowerUp||Math.abs(e.x-this.x)+Math.abs(e.y-this.y)!=1||this.removeNear(1,void 0,void 0,!0,[e])},removeNear:function(e,t,i,o,a){if(!this.medusaBlocked&&!this.isBlocked("removeOnRemoveNear")){var n,r,s,l,d,c=[];o&&(n=this.countItems(a,0,-1),l=this.countItems(a,0,1),s=this.countItems(a,-1,0),r=this.countItems(a,1,0),s&&(d={dx:-1,dy:0,priority:0},2<s?d.priority=2:"horizontal"===SeaHorseCell.moveDirection&&(d.priority=1),c.push(d)),r&&(d={dx:1,dy:0,priority:0},2<r?d.priority=2:"horizontal"===SeaHorseCell.moveDirection&&(d.priority=1),c.push(d)),n&&(d={dx:0,dy:-1,priority:0},2<n?d.priority=2:"vertical"===SeaHorseCell.moveDirection&&(d.priority=1),c.push(d)),l&&(d={dx:0,dy:1,priority:0},2<l?d.priority=2:"vertical"===SeaHorseCell.moveDirection&&(d.priority=1),c.push(d)),this.direction&&c.push(this.direction),this.direction=_.sortBy(c,"priority").pop(),this.direction&&(this.needRun=!0))}},getPath:function(e,t){var i,o,a=[],n=this.x,r=this.y;do{if(n+=e,r+=t,!(Game.inField(n,r)&&Game.field[r][n].isRemovable()&&(Game.field[r][n]instanceof Cell&&Game.field[r][n].isRegular||Game.field[r][n]instanceof ArrowCell||Game.field[r][n]instanceof MultiColorCell))||Game.field[r][n].decorator||Game.field[r][n].seaHorseTarget)break;a.push(Game.field[r][n])}while(Game.inField(n,r));for(Game.inField(n,r)&&Game.field[r][n].isRemovable()&&(o=Game.field[r][n]),Game.inField(n,r)&&Game.field[r][n].bump&&(o=Game.field[r][n]);a.length;){if((i=a.pop()).constructor===Cell||i.constructor===ArrowCell||i.constructor===MultiColorCell){a.push(i);break}o=i}return[a,o]},getNewOrientation:function(e){switch(e){case"left":return"";case"right":return"";default:return this.orientation}},run:function(){if(!this.medusaBlocked&&!this.isBlocked("removable")){var o,a,n,r=this,s=SeaHorseCell.directions[this.direction.dx][this.direction.dy],e=this.getNewOrientation(s),t=this.getPath(this.direction.dx,this.direction.dy),i=t[0],l=t[1];i.length&&((a=i[i.length-1]).seaHorseTarget=!0,o=this.$div.clone().appendTo(_Figure.blockedAnimations).alignTo(this.$div).find(".seahorseBg").removeClass("stable"),n=Game.animate(_.bind(function(){o.parent().remove(),Game.field[this.y][this.x]=void 0,Game.addItem(new SeaHorseCell(a.y,a.x,!1,e))},this)),this.$div.remove(),application.playSound("seahorse"),"right"===s&&o.removeClass("leftMove"),o.addClass(s+"Move"),-1!==["left","right"].indexOf(s)&&o.animationByName("seaHorseStart"),o.queue(function(e){o.addClass("seaHorseRun"),e()}),_.each(i,function(e){var t=e===a,i={x:0,y:0};t&&("right"===s?i.x=-600/Config.cellWidth:"left"===s&&(i.x=600/Config.cellWidth)),o.parent().ourAnimate({target:e.$div,ajust:i},200,"linear",function(){e.remove(),t&&(application.playSound("seahorseBump"),o.removeClass("seaHorseRun").addClass("seaHorseStop").parent().delay(500).queue(function(e){l&&(l.bump?l.bump(r):l.remove()),application.stopSound("seahorse"),n()}))})}))}}},{chars:"",directions:{"-1":{0:"left"},0:{"-1":"up",1:"down"},1:{0:"right"}},process:function(){Game.each(function(e){e instanceof SeaHorseCell&&e.needRun&&(e.run(),e.needRun=!1,e.direction=void 0)})},listenToGame:function(){Game.on("validMove",SeaHorseCell.validMove,SeaHorseCell)},validMove:function(e){e.first.x===e.second.x?SeaHorseCell.moveDirection="vertical":e.first.y===e.second.y&&(SeaHorseCell.moveDirection="horizontal")}}),InMoveController={init:function(){user.on("createNewGame",this.listenToGame,this)},listenToGame:function(){Game.on("validMove",this.validMove,this),Game.on("fallDownStart",this.resetMove,this)},validMove:function(e){e.first.inMove=!0,e.second.inMove=!0},resetMove:function(){Game.each(function(e){e.inMove&&(e.inMove=!1)})}};Application.on("ready",function(){InMoveController.init()});var BaseObject=Backbone.Model.extend({defaults:{layer:"map",width:1,height:1,feature:"object"},getClass:function(){return""},toJSON:function(){var e={};for(var t in this.attributes)this.attributes[t]!==this.defaults[t]&&(e[t]=this.attributes[t]);return e},initGame:function(){},createFigure:function(){},getUsedFeatures:function(){return this.get("feature").split(" ")},destroy:function(){gameView.objects&&gameView.objects.remove(this)}});BaseObject.classes={},BaseObject.create=function(e,t){var i=this.classes[e];return episode.isBonusWorld()&&Config.bonusWorld.objectClasses[e]&&(i=Config.bonusWorld.objectClasses[e]),new i(t)},_.override(ThreeInRowBaseView,{createControllers:function(){Game.objects=this.objects=new Backbone.Collection,Game.addObject=function(e){this.objects.push(e);var t=e.createFigure();e.initGame(),t&&FigureView.findById(e.get("layer")).append(t)},application.level.objects&&(_.each(application.level.objects,function(e){var t=BaseObject.create(e.code,e);this.objects.push(t)},this),this.objects.forEach(function(e){var t=e.createFigure();e.initGame(),t&&FigureView.findById(e.get("layer")).append(t)})),this.override()},clear:function(){gameView.objects&&_.each(gameView.objects.toArray(),function(e){e&&e.destroy()}),this.objects=null,this.override()}});var CollectObject=Task.extend({defaults:_.defaults({event:"removeObject"},Task.prototype.defaults),initialize:function(){var e=this.getObject();this.set("cssClass",e.getClass()),this.set("amount",gameView.objects.where({code:this.get("description").object,name:this.get("description").name}).length),this.set("beginAmount",this.get("amount")),Game.on(this.get("event"),this.onEvent,this)},getClass:function(){return BaseObject.classes[this.get("description").object]},getObject:function(){return new(this.getClass())(this.get("description"))},canCollect:function(e){return e instanceof this.getClass()&&e.get("name")===this.get("description").name},tick:function(e){this.animateCollect(e.$div,e.getPoints(),Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}});CollectObject.getCssClass=function(e){return"CollectObject_"+e.name},CollectObject.getTaskAmount=function(e,t){return e.objects.filter(function(e){return e.name===t.name||e.code===t.object}).length};var MaelstormObject=BaseObject.extend({defaults:_.defaults({layer:"cellar",direction:"",width:2,height:2,moveStep:3,feature:"maelstorm"},BaseObject.prototype.defaults),getClass:function(){return"maelstorm "+this.get("direction")+"Direction"},initGame:function(){this.step=this.get("moveStep"),Game.afterTurnProcessor.addToGroup(this,"maelstorm")},process:function(){--this.step,0===this.step&&(this.rotate(Game.animate()),this.step=this.get("moveStep"))},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible .defaultCell",this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div},rotate:function(e){application.playSound("maelstorm");for(var t=0;t<this.attributes.width;++t)for(var i=0;i<this.attributes.height;++i){if(Game.inField(this.attributes.x+t,this.attributes.y+i))if(!Game.field[this.attributes.y+i][this.attributes.x+t].isMovable())return void e()}this.$div.get("rotate")||this.$div.set("rotate",0),this.$div.animate({},400,"linear",_.partial(_.bind(this.rotateFigure,this),e),function(e,t){this.set("rotate",this.get("rotate")+300*e*canvas.dt)}).animate({},200,"linear",null,function(e,t){this.set("rotate",this.get("rotate")+300*canvas.dt)}).animate({},400,"linear",null,function(e,t){this.set("rotate",this.get("rotate")+300*(1-e)*canvas.dt)})},rotateFigure:function(o){var e,t=this.get("x"),i=this.get("y");e="right"==this.get("direction")?[[0,0],[1,0],[1,1],[0,1],[0,0]]:[[0,0],[0,1],[1,1],[1,0],[0,0]],o=_.after(4,o);for(var a=function(e,t,i){return function(){(Game.field[i][t]=e).setX(t),e.setY(i),o()}},n=0;n<4;++n){var r=Game.field[i+e[n][1]][t+e[n][0]],s=Game.field[i+e[n+1][1]][t+e[n+1][0]];r.$div.ourAnimate({target:s.$div},200,"",a(r,t+e[n+1][0],i+e[n+1][1]))}}});BaseObject.classes.MaelstormObject=MaelstormObject;var FrozenObject=BaseObject.extend({defaults:_.defaults({layer:"cellar",name:"",width:2,height:2,feature:"frozen"},BaseObject.prototype.defaults),getClass:function(){return"frozen frozen_"+this.get("name")},getTemplate:function(){return".defaultCell"},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible "+this.getTemplate(),this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div},remove:function(){this.stopListening(),Game.trigger("removeObject",this),this.$div.remove(),this.destroy()},onRemoveFloor:function(e){e.x>=this.get("x")&&e.x<this.get("x")+this.get("width")&&e.y>=this.get("y")&&e.y<this.get("y")+this.get("height")&&this.testFloor()&&this.remove()},testFloor:function(){for(var e=this.get("x");e<this.get("x")+this.get("width");++e)for(var t=this.get("y");t<this.get("y")+this.get("height");++t)if(0<Game.floor[t][e])return!1;return!0},getPoints:function(){return 1e3},initGame:function(){this.listenTo(Game,"removeFloor",this.onRemoveFloor)}});BaseObject.classes.FrozenObject=FrozenObject;var CellBlocker=Backbone.Model.extend({defaults:{owner:null,actions:[],active:!0},isBlocked:function(e){return this.get("active")&&-1!==this.get("actions").indexOf(e)}}),SailObject=BaseObject.extend({defaults:_.defaults({queue:1,layer:"top",name:"sail",width:2,height:2,tasks:[],feature:"sail",preparedTasks:[]},BaseObject.prototype.defaults),blocker:null,targetCells:[],parts:null,getClass:function(){return"sail"},getTemplate:function(){return".sailObject"},createFigure:function(){var t=this;this.$div=FigureView.createByTemplate(".invisible "+this.getTemplate(),this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight,width:this.get("width")*Config.cellWidth,height:this.get("height")*Config.cellHeight});var e=this.$div.find(".taskWrapper");e.set({x:.5*(this.get("width")*Config.cellWidth-e.width()),y:.5*e.height()-9}),e.delay(1e4*Math.random()).queue(function(e){e(),t.animateTaskIdle()});var i=this.$div.find(".rope"),o=.5*(this.get("height")*Config.cellHeight-i.height());i.set({height:o,x:.5*-i.width()+5,y:11}),this.$div.find(".ropeTop").set({height:.5*o,x:1,y:11}),this.$div.find(".ropeBottom").set({height:.5*o,x:1,y:.5*o+5});var a=this.$div.find(".ropeCutFlare");a.set({x:.5*-a.width()+5,y:.5*o+3}),this.parts=this.createSailParts();var n=this.$div.find(".taskBlock");return n.set({x:-n.width()/2+5,y:(this.get("height")*Config.cellHeight-n.height())/2+9}),this.$div},createSailParts:function(){for(var e=[],t=this.$div.find(".sail .parts"),i=0;i<this.get("height");i++){e.push([]);for(var o=0;o<this.get("width");o++){var a=FigureView.createByTemplate(".sailPart",this.getClass().split(" ").concat(["sailPart"]));t.append(a),e[i].push(a),a.addClass(this.getClassNameByPosition(i,o)),a.set({x:o*Config.cellWidth,y:i*Config.cellHeight})}}return e},createBar:function(){for(var e=this.$div.find(".sail .bar"),t=0;t<this.get("width");t++){var i=FigureView.createByTemplate(".barPart");e.append(i),i.addClass(this.getClassNameByPosition(null,t)),i.set({x:t*Config.cellWidth})}return e},remove:function(){this.animateRemove(),this.stopListening(),this.unlockTargetCells(),this.addScore(GameScores.sail),this.destroy(),Game.trigger("removeObject",this)},prepareTask:function(t){var e=this,i=this.$div.find(".taskBlock"),o=t.get("color")||t.get("type");t.precalc(i),(t.$div=i).find(".taskIco").addClass("color_".concat(o)),i.find(".text").html(t.get("collectedAmount")+"/"+t.get("beginAmount")),this.listenTo(t,"change:collectedAmount",function(){e.$div.queue(function(e){i.find(".text").html(t.get("collectedAmount")+"/"+t.get("beginAmount")),e()}),e.animateTaskIdle()}),this.listenTo(t,"beforeCompleted",this.onBeforeCompleteTask),this.get("preparedTasks").push(t)},initTasks:function initTasks(){this.set("preparedTasks",[]);var _iterator5=_createForOfIteratorHelper(this.get("tasks")),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var taskData=_step5.value,taskClass=eval(taskData.type),task=new taskClass({active:!1,color:"",cssClass:Config.tasks[taskData.type].cssClass,description:taskData,name:Config.tasks[taskData.type].name,order:taskData.order||0},{type:taskData.cell||""});task.animateCollect=_.bind(this.animateCollect,this,task),this.prepareTask(task)}}catch(e){_iterator5.e(e)}finally{_iterator5.f()}},animateTaskIdle:function(){var t=this,e=this.$div.find(".taskWrapper"),i=5*Math.random();e.clearQueue();for(var o=10;0<=o;o--){var a=o%2==0?1:-1;e.animate({rotate:i*a*(o/10)},300,"easeInOutSine")}e.animate({rotate:0},300,"easeInOutSine").delay(1e4*Math.random()).queue(function(e){e(),t.animateTaskIdle()})},animateCollect:function(e,t,i,o){var a=t.clone(),n=Game.animate();_Figure.blockedAnimations.append(a),a.set({"margin-left":0,"margin-top":0}),a.alignTo(t),a.ourAnimate({scale:1.2},3*Game.get("speed")).ourAnimate({target:e.$div.find(".taskIconContainer"),rotate:e.getAnimateCollectRotation(),scale:.75},3*Game.get("speed"),void 0,function(){o()}).queue(function(e){n(),e()}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){a.remove()})},animateHideTasks:function(){var o=this,a=this.$div.find(".taskWrapper");a.clearQueue(),a.animate({rotate:0},200,"easeInOutSine",function(){var e=o.$div.find(".taskBlock"),t=o.$div.find(".ropeTop"),i=o.$div.find(".ropeBottom");o.$div.find(".rope").removeClass("active"),t.addClass("active"),i.addClass("active"),o.$div.find(".ropeCutFlare").addClass("processing").delay(300).animate({opacity:0},100),t.ourAnimate({opacity:0},800),i.ourAnimate({y:i.offset().top+100,opacity:0},800,"easeInQuad"),e.ourAnimate({y:e.offset().top+100,opacity:0},800,"easeInQuad",function(){a.remove()})})},animateRemove:function(){var a=this;this.animateHideTasks();for(var e=Game.animate(),t=this.$div.get("height")*(1.05-1)/2,i=250*(.5+.9*(this.get("height")-1)),o=0;o<this.get("height");o++)for(var n=0;n<this.get("width");n++)this.parts[o][n].sprite.params.playRound=!1;this.$div.ourAnimate({"scale-y":1.05,"margin-top":t},70).ourAnimate({"scale-y":1,"margin-top":0},140).queue(function(e){var t=a.createBar().set({y:a.get("height")*Config.cellHeight-Config.cellHeight/3,opacity:0});t.delay(36.75).queue(function(e){t.set({opacity:1}),e()}).ourAnimate({y:0},.7*i).queue(function(e){t.children.forEach(function(e){e.addClass("closing")}),e()}).delay(350).queue(function(){t.remove()}),e()}).queue(function(i){var o=a.get("height")-1;!function e(){for(var t=a.get("width")-1;0<=t;t--)a.parts[o][t].addClass("closing");0<=--o?a.parts[o][0].queue(function(e){return e()}).delay(1250/6*.7).queue(function(){return e()}):i()}()}).delay(350).queue(function(){a.$div.remove(),e()})},hasAlikeTasks:function(t){return!!this.get("preparedTasks").find(function(e){return!e.isCollected()&&e.get("type")===t.get("type")&&e.get("color")===t.get("color")})},updateTasks:function(){var t=this,e=gameView.objects.filter(function(e){return e.get("name")===t.get("name")&&e.get("queue")<t.get("queue")});if(0<e.length){var i,o=_createForOfIteratorHelper(this.get("preparedTasks"));try{for(o.s();!(i=o.n()).done;){var a,n=i.value,r=_createForOfIteratorHelper(e);try{for(r.s();!(a=r.n()).done;){if(a.value.hasAlikeTasks(n)){n.set("active",!1);break}n.set("active",!0)}}catch(e){r.e(e)}finally{r.f()}}}catch(e){o.e(e)}finally{o.f()}}else{var s,l=_createForOfIteratorHelper(this.get("preparedTasks"));try{for(l.s();!(s=l.n()).done;){s.value.set("active",!0)}}catch(e){l.e(e)}finally{l.f()}}},isAllTasksCompleted:function(){return!!this.get("preparedTasks").find(function(e){return e.isCollected()})},onBeforeCompleteTask:function(){var t=this;if(this.updateTasks(),this.isAllTasksCompleted()){var e,i=_createForOfIteratorHelper(gameView.objects.filter(function(e){return e.get("name")===t.get("name")&&!e.isAllTasksCompleted()}));try{for(i.s();!(e=i.n()).done;){e.value.updateTasks()}}catch(e){i.e(e)}finally{i.f()}}},fetchTargetCells:function(){this.targetCells=[];for(var e=this.get("x");e<this.get("x")+this.get("width");e++)for(var t=this.get("y");t<this.get("y")+this.get("height");t++){var i=Game.field[t][e];i&&this.targetCells.push(i)}},blockTargetCells:function(){var e,t=_createForOfIteratorHelper(this.targetCells);try{for(t.s();!(e=t.n()).done;){e.value.addBlocker(this.blocker)}}catch(e){t.e(e)}finally{t.f()}},unlockTargetCells:function(){var e,t=_createForOfIteratorHelper(this.targetCells);try{for(t.s();!(e=t.n()).done;){e.value.removeBlocker(this.blocker)}}catch(e){t.e(e)}finally{t.f()}},initGame:function(){var e=this;this.listenToOnce(Game,"prepared",function(){e.initTasks(),e.fetchTargetCells(),e.blockTargetCells()}),this.listenToOnce(Game,"start",this.updateTasks),this.blocker=new CellBlocker({owner:this,actions:["movable","removable","removeOnRemoveNear","overTile"]})},getClassNameByPosition:function(e,t){var i="",o=!1;if(null!==e){var a;switch(e){case 0:a="top";break;case this.get("height")-1:a="bottom";break;default:a="center"}o=!0,i+=a}if(null!==t){var n;switch(t){case 0:n="left";break;case this.get("width")-1:n="right";break;default:n="center"}i+=n=o?n[0].toUpperCase()+n.slice(1):n}return i},addScore:function(e){Game.set("score",Math.max(0,Game.get("score")+e)),Game.trigger("showFieldPoints",this.$div.find(".taskBlock"),e,"collectTaskElem")}}),SailProcessor={process:function(){var e=gameView.objects.filter(function(e){return"sail"===e.get("name")&&e.isAllTasksCompleted()});if(0<e.length){var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){t.value.remove()}}catch(e){i.e(e)}finally{i.f()}}}};BaseObject.classes.SailObject=SailObject;var CollectFrozenEggAndIceberg=CollectObject.extend({initialize:function(){CollectObject.prototype.initialize.call(this),this.set("amount",this.get("description").amount||4),this.distributeTreasures()},distributeTreasures:function(){var e=this.get("amount")-Game.objects.filter(function(e){return e instanceof FrozenEggObject}).length,t=[];Game.each(function(e){e instanceof IcebergCell&&e.isHead()&&t.push(e)});var i,o=Math.floor(e/t.length);0<e%t.length&&(i=e%t.length,t.pop().splitTreasures(o+i)),t.forEach(function(e){e.splitTreasures(o)})}}),CarnivoresObject=BaseObject.extend({defaults:_.defaults({layer:"carnivores",feature:"carnivores",direction:"top"},BaseObject.prototype.defaults),getClass:function(){return"carnivores "+this.get("direction")+"Direction"},initGame:function(){Game.initCarnivoresObject||(Game.initCarnivoresObject=!0,this.listenToOnce(Game,"prepared",this.onCreateLians))},onCreateLians:function(){var n={};gameView.objects.each(function(e){e instanceof CarnivoresObject&&(n[e.get("x")+"_"+e.get("y")]=e)});var r=FigureView.findById(this.get("layer"));Game.each(function(e){var t=[];Game.inField(e.x,e.y-1)||t.push("top"),Game.inField(e.x,e.y+1)||t.push("bottom"),Game.inField(e.x-1,e.y)||t.push("left"),Game.inField(e.x+1,e.y)||t.push("right");var i=n[e.x+"_"+e.y];i&&t.splice(t.indexOf(i.get("direction")),1);for(var o=0;o<t.length;++o){var a=FigureView.createByTemplate(".invisible .defaultCell",["carnivoresLiana",t[o]+"Direction"]);a.set({x:e.x*Config.cellWidth,y:e.y*Config.cellHeight}),r.append(a)}i&&(r.removeChildren(i.$div),r.append(i.$div))})},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible .defaultCell",this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div}}),SCb;CarnivoresObject.checkDroppedCells=function(t){if(t.decorator)return!1;if(Game.initCarnivoresObject){var e=Game.gravityDirection||"bottom",i=gameView.objects.findWhere(function(e){return e instanceof CarnivoresObject&&e.get("x")===t.x&&e.get("y")===t.y});if(i&&i.get("direction")===e){var o=Game.animate();application.playSound("carnivores"),i.$div.addClass("eat").delay(400).queue(function(e){t.removable=!0,t.remove(),e()}).delay(300).queue(function(e){i.$div.removeClass("eat"),e(),o()})}}},BaseObject.classes.CarnivoresObject=CarnivoresObject,DroppableCell.prototype.checkDroppedCells=(SCb=DroppableCell.prototype.checkDroppedCells,function(){Game.initCarnivoresObject?CarnivoresObject.checkDroppedCells(this):SCb.call(this)});var StreamObject=BaseObject.extend({defaults:_.defaults({layer:"cellar",feature:"stream maelstorm"},BaseObject.prototype.defaults),getClass:function(){var e="";if("game"==application.get("page")){var t=this.getSource();t&&t.name!=this.get("name")&&(e=" turn_"+t.name+"_"+this.get("name"))}return"stream stream_"+this.get("name")+e},initGame:function(){var e=this.getHead();e?e.elements.push(this):(Game.afterTurnProcessor.addToGroup(this,"stream"),this.head=!0,this.elements=[])},getPart:function(e,t){var i=void 0!==e?e:this.get("x"),o=void 0!==t?t:this.get("y");return _.findWhere(this.getParts(),{x:i,y:o})},getHead:function(){var e=_.findWhere(Game.afterTurnProcessor.line,{name:"stream"});if(e&&e.items&&e.items.length)for(var t=0;t<e.items.length;t++)if(e.items[t].getPart(this.get("x"),this.get("y")))return e.items[t];return!1},getParts:function(){for(var e=[],t=_.findWhere(StreamObject.getLevelObjects(),{x:this.get("x"),y:this.get("y")});t&&(e.push(t),t=StreamObject.getTarget(t)),t&&!this.isSelf(t););return e},isBlocked:function(){var t,i=!1,e=this.getParts();return _.each(e,function(e){(t=Game.field[e.y][e.x]).movable&&!t.medusaBlocked&&!t.isBlocked("movable")&&t.life&&(!t.decorator||t.decorator instanceof ChangeColorDecorator)||(i=!0)},this),i},process:function(){this.move(Game.animate())},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible .defaultCell",this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div},isSelf:function(e){return e&&e.x===this.get("x")&&e.y===this.get("y")},getSource:function(){var e=this.getPart();return!!e&&StreamObject.getSource(e.x,e.y)},startMovingAnimation:function(){this.head&&(this.$div.addClass("moving"),_.each(this.elements,function(e){e.$div.addClass("moving")},this))},stopMovingAnimation:function(){this.head&&(this.$div.removeClass("moving"),_.each(this.elements,function(e){e.$div.removeClass("moving")},this))},move:function(e){if(this.steps=0,this.isBlocked())e();else{application.playSound("stream");this.getParts();for(var t=this.getPart(),i=StreamObject.getTarget(t),o=!1;!o||!this.isSelf(t);){++this.steps,o=!0;var a=Game.field[t.y][t.x].$div.clone().appendTo(_Figure.blockedAnimations).alignTo(Game.field[t.y][t.x].$div);Game.field[t.y][t.x].$div.hide();this.startMovingAnimation(),a.ourAnimate({target:Game.field[i.y][i.x].$div},600,"linear",function(e,t,i,o,a,n){return function(){(Game.field[a.y][a.x]=t).$div.set("y",a.y*Config.cellHeight),t.$div.set("x",a.x*Config.cellHeight),i.remove(),t.$div.show(),t.setY(a.y),t.setX(a.x),--e.steps,e.steps||(e.stopMovingAnimation(),n())}}(this,Game.field[t.y][t.x],a,0,i,e)),t=i,i=StreamObject.getTarget(t)}}}});StreamObject.getLevelObjects=function(){var t=[];return _.each(application.level.objects,function(e){"StreamObject"==e.code&&t.push(e)}),t},StreamObject.getLevelObject=function(e,t){return _.findWhere(StreamObject.getLevelObjects(),{x:e,y:t})},StreamObject.getSource=function(e,t){for(var i=StreamObject.getLevelObjects(),o=StreamObject.getLevelObject(e,t),a=!1,n=0;n<=i.length-1;n++)StreamObject.getTarget(i[n])==o&&(a=i[n]);return a},StreamObject.getTarget=function(e){var t,i,o;switch(e.name){case"up":o=e.y-1,i=e.x;break;case"down":o=e.y+1,i=e.x;break;case"left":o=e.y,i=e.x-1;break;case"right":o=e.y,i=e.x+1}return void 0!==i&&void 0!==o&&(t=StreamObject.getLevelObject(i,o)),t},BaseObject.classes.StreamObject=StreamObject;var PortalObject=BaseObject.extend({defaults:_.defaults({layer:"cellar",feature:"portal"},BaseObject.prototype.defaults),getClass:function(){return"portal portal_"+this.get("name")},initGame:function(){Game.set("portal_"+this.get("name"),this)},isBlocked:function(){return!1},process:function(){this.move(Game.animate())},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible .defaultCell",this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div},move:function(e){console.log("move",this),e()}},{process:function(){for(var e=Game.get("portal_in"),t=Game.get("portal_out"),i=e.get("x"),o=e.get("y"),a=t.get("x"),n=t.get("y"),r=Config.rows-1;0<=r;r--){for(var s=!1,l=Config.rows-1;0<=l;l--)if(Game.field[l][i]){s=Game.field[l][i];break}if(s&&null==Game.field[r][a]){var d=Game.animate();s.setY(r),s.setX(a),Game.field[r][a]=s,Game.field[l][i]=void 0,s.$div.ourAnimate({y:o*Config.cellHeight},200*(o-s.y),"easeInQuad",function(o,a,n,r,e,t,s){return function(){var e,t,i;o.$div.set("y",n*Config.cellHeight),o.$div.set("x",r*Config.cellHeight),o.$div.delay(200).ourAnimate({y:a*Config.cellHeight},a*Game.get("speed"),"easeInQuad",(e=o,t=a,i=s,function(){e.$div.set("y",t*Config.cellHeight),i()}))}}(s,r,n,a,0,0,d))}}}});BaseObject.classes.PortalObject=PortalObject;var GroundCell=Cell.extend({initialize:function(e,t,i){Cell.prototype.initialize.call(this,e,t,i),this.color!==GroundCell.chars[0]&&(this.life=GroundCell.chars.indexOf(this.color)+1),this.color=null,this.movable=!1,this.removeOnRemoveNear=!0,this.attribute&&(this.attribute="ground")},getTemplateClass:function(){return"groundCell"},createDiv:function(){var e=Cell.prototype.createDiv.call(this);if(1<this.life&&e.addClass("groundLife"+this.life),e.$attr){var t=getRandomInt(1,4),i=FigureView.createByTemplate(".invisible .emptyTemplate",["attributeIcon"+t]);e.$attr.addClass("attributeColor"+t),e.append(i)}return e},animateTakeLife:function(t){var i=this;application.playSound("groundexplode"),this.$div.queue(function(e){this.removeClass("groundLife"+(i.life+1)),this.addClass("groundExplode"),e()}).delay(100).queue(function(e){this.addClass("groundLife"+i.life),t(),e(),this.removeClass("groundExplode")})},animateRemoval:function(e){application.playSound("groundexplode"),this.$div.addStyleAnimate("explode").queue(function(){e(),gameView.fallDownExplode(this,4,"groundExplode")})}},{chars:""}),GravityGroundCell=GroundCell.extend({initialize:function(e,t,i){var o=this.color;GroundCell.prototype.initialize.call(this,e,t,i),this.life=GravityGroundCell.chars.indexOf(o)+1,this.movable=!0,this.removeOnRemoveNear=!0,this.decorator&&this.decorator.takeColor()},getTemplateClass:function(){return"gravityGroundCell"},setRandomColor:function(){},animateTakeLife:function(i){var o=this;application.playSound("groundexplode"),this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(o.life+1)),this.addClass("gravityGroundExplode"),this.addClass("gravityGroundExplodeCell"+(o.life+1)),this.addClass("gravityGroundLife"+o.life),e()}).delay(100).queue(function(e){this.removeClass("gravityGroundExplode"),this.removeClass("gravityGroundExplode"+(o.life+1));var t=this.clone();_Figure.blockedAnimations.append(t),t.alignTo(this),gameView.fallDownExplode(t,4,"gravityGroundExplode"),i(),e()})},animateRemoval:function(e){application.playSound("groundexplode"),this.$div.addStyleAnimate("explode").queue(function(){e(),gameView.fallDownExplode(this,4,"gravityGroundExplode")})}},{chars:""}),MermaidPearlCell=Cell.extend({scoresId:"mermaidPearl",setRandomColor:function(){this.color=RANDOM(MermaidPearlCell.chars)},getTemplateClass:function(){return"mermaidPearlCell"}},{chars:""}),MermaidCell=MultiCell.extend({width:2,height:2,scoresId:"mermaid",constructor:function(e,t,i,o){MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1,this.isHead()&&this.listenToOnce(Game,"start",this.initTaskListeners)},initTaskListeners:function(){this.task=gameView.tasksView.tasks.find(function(e){return e instanceof MermaidCollect}),this.task&&(this.task.precalc(this.$div.find(".lifeBlock")),this.$div.find(".maxLife").html(this.task.get("beginAmount")),this.$div.find(".currentLife").html(this.task.get("collectedAmount")),this.listenTo(this.task,"change:collectedAmount",this.onCollect),this.listenToOnce(this.task,"change:completed",this.onComplate))},onComplate:function(){this.isMedusaBlocked()||this.isBlocked("removable")?Game.once("afterEndTurn",this.onComplate,this):(this.removable=!0,this.remove())},onCollect:function(e,t){this.$div.find(".currentLife").html(this.task.get("collectedAmount")),application.playSound("MermaidCollect"),this.$div.find(".mermaidCellBg").removeClass("stable").addClass("onCollect"),setTimeout(_.bind(function(){this.$div.find(".mermaidCellBg").removeClass("onCollect").addClass("stable")},this),2e3)},getHeadTemplateClass:function(){return"mermaidCell"},beforeRemove:function(e){MultiCell.prototype.beforeRemove.call(this,e),this.stopListening()},animateRemoval:function(t){application.playSound("MermaidRemoval"),this.$div.animationByName("MermaidDie").queue(function(e){e(),this.remove(),t()})}},{chars:""}),MermaidPearlCollect=CollectColor.extend({canCollect:function(e){return e instanceof MermaidPearlCell}}),MermaidCollect=Task.extend({initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","removedItem"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof MermaidPearlCell||e instanceof PearlCell||e.color&&""===e.color},tick:function(e){if(e instanceof MermaidPearlCell)this.ajust={x:0,y:-e.$div.height()/2},Game.each(function(e){e instanceof MermaidCell&&(i=e.$div)}),this.animateCollect(e.$div,GameScores[e.scoresId],Game.endTurnAnimate(function(){this.get("beginAmount")>this.get("collectedAmount")&&Task.prototype.tick.call(this)},this),0,i);else if(e.constructor===PearlCell){var t=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("pearl");_Figure.blockedAnimations.append(t),t.alignTo(e.$div),this.ajust={x:0,y:-8/60*Config.cellHeight},this.animateCollect(t,GameScores.pearl,Game.endTurnAnimate(function(){this.get("beginAmount")>this.get("collectedAmount")&&Task.prototype.tick.call(this)},this),0),t.remove()}else if(e.constructor===ArrowCell){var i;this.ajust={x:0,y:-e.$div.height()/2},Game.each(function(e){e instanceof MermaidCell&&(i=e.$div)}),this.animateCollect(e.$div,GameScores.arrow,Game.endTurnAnimate(function(){this.get("beginAmount")>this.get("collectedAmount")&&Task.prototype.tick.call(this)},this),0,i)}}});MermaidCollect.getCssClass=function(e){return"MermaidCollect"};var FlamyCell=MultiCell.extend({width:2,height:2,scoresId:"flamy",constructor:function(e,t,i,o){MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1,this.isHead()&&this.listenToOnce(Game,"start",this.initTaskListeners)},initTaskListeners:function(){this.task=gameView.tasksView.tasks.find(function(e){return e instanceof FlamyCollect}),this.task&&(this.task.precalc(this.$div.find(".lifeBlock")),this.$div.find(".maxLife").html(this.task.get("beginAmount")),this.$div.find(".currentLife").html(this.task.get("collectedAmount")),this.listenTo(this.task,"change:collectedAmount",this.onCollect),this.listenToOnce(this.task,"change:completed",this.onComplate))},onComplate:function(){this.isMedusaBlocked()||this.isBlocked("removable")?Game.once("afterEndTurn",this.onComplate,this):(this.removable=!0,this.remove())},onCollect:function(e,t){this.$div.find(".currentLife").html(this.task.get("collectedAmount")),application.playSound("FlamyCollect");var i=this.$div.find(".flamyCellBg");i.hasClass("damaged")||i.addStyleAnimate("damaged",function(){i.removeClass("damaged")})},getHeadTemplateClass:function(){return"flamyCell"},beforeRemove:function(e){MultiCell.prototype.beforeRemove.call(this,e),this.stopListening()},animateRemoval:function(t){application.playSound("FlamyRemoval"),this.$div.animationByName("FlamyDie").queue(function(e){e(),this.remove(),t()})}},{chars:""}),FlamyCollect=Task.extend({initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","removedItem"),Task.prototype.initialize.call(this)},getWaterColor:function(){return"N"},canCollect:function(e){return e.color===this.getWaterColor()},tick:function(e){var t=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("color_"+e.color);_Figure.blockedAnimations.append(t),t.alignTo(e.$div),this.ajust={x:0,y:-8/60*Config.cellHeight},this.animateCollect(t,GameScores.flamy,Game.endTurnAnimate(function(){this.get("beginAmount")>this.get("collectedAmount")&&Task.prototype.tick.call(this)},this),0),t.remove()}}),BugCell=MultiCell.extend({width:2,height:2,scoresId:"bug",targetFilters:[{type:"ClearFallingCellAttributes",cell:"_"},{type:"CollectObject",object:"FrozenEggObject",name:"frozenegg"}],needPlaySound:!0,_removeBugTasksFromLevelTasks:function(e){var t,i=_createForOfIteratorHelper(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]);try{for(i.s();!(t=i.n()).done;){var o=t.value,a=_.findWhere(e,o);a&&e.splice(e.indexOf(a),1)}}catch(e){i.e(e)}finally{i.f()}},constructor:function(e,t,i,o){var a;(MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1,this.isHead())&&(this.listenToOnce(Game,"start",this.initTargets),this.tasks=null!==(a=application.level.task.find(function(e){return"CollectBug"===e.type}).tasks)&&void 0!==a?a:episode.get("about").bugTasks,this._removeBugTasksFromLevelTasks(application.level.task,this.tasks))},animateCollectTarget:function(e,t,i,o){var a=t.clone(),n=Game.animate();_Figure.blockedAnimations.append(a),a.set({"margin-left":0,"margin-top":0}),a.alignTo(t),a.ourAnimate({scale:1.2},3*Game.get("speed")).queue(function(e){n(),e()}).ourAnimate({target:e.$div,rotate:e.getAnimateCollectRotation(),ajust:{x:-20,y:-10},scale:.75},6*Game.get("speed"),void 0,_.bind(function(){Game.set("score",Math.max(0,Game.get("score")+i)),o()},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){a.remove()})},getHeadTemplateClass:function(){return"bugCell"},initTargets:function initTargets(){var self=this;this.targets=new Backbone.Collection(this.tasks.map(function(description){var taskClass=eval(description.type),task=new taskClass({description:description});return task.animateCollect=_.bind(this.animateCollectTarget,this,task),task},this));var bg=this.$div.find(".bugCellBg");this.targets.forEach(function(e,t){var i=this.$div.find(".mTask"+(t+1));e.precalc(i),(e.$div=i).find(".mMaxCount").html(e.get("beginAmount")),i.find(".mCurrentCount").html(e.get("collectedAmount")),this.listenTo(e,"change:collectedAmount",function(){i.find(".mCurrentCount").html(e.get("collectedAmount")),self.needPlaySound&&application.playSound("BugCollect"),bg.hasClass("damaged")||bg.addClass("damaged").delay(800).queue(function(e){bg.removeClass("damaged").removeClass("stable").addClass("stable"),e()})}),this.listenTo(e,"change:completed",this.onComplate)},this)},isCompleted:function(){return!this.targets.findWhere({completed:!1})},onComplate:function(){this.isCompleted()&&(this.removable=!0,this.remove())},beforeRemove:function(e){MultiCell.prototype.beforeRemove.call(this,e),clearInterval(this.intervalId),this.stopListening()},animateRemoval:function(e){this.$div.remove(),e(),this.needPlaySound&&application.playSound("BugRemoval")},animateCollect:function(e){e()}},{css:"Bug",chars:""}),MuffinRackCell=MultiCell.extend({isRemoveOnce:!0,constructor:function(e,t,i,o){MultiCell.apply(this,arguments),this.baseName="muffinRack",this.scoresId="muffinRack",this.removable=!0,this.removeOnRemoveNear=!1,this.offenders=[],this.isHead()&&(this.life=6)},getHeadTemplateClass:function(){return"muffinRackHeadCell"},isOpen:function(){return this.removeOnRemoveNear},open:function(){this.isOpen()||(this.head.getBody().forEach(function(e){e.removeOnRemoveNear=!0},this),this.head.animateOpen())},animateTakeLife:function(e){e()},checkOffenders:function(e){return e&&-1!==this.head.offenders.indexOf(e)},removeByArrow:function(e){if(!this.isBlocked("removable")&&!this.isMedusaBlocked())return this.isOpen()||this.checkOffenders(e)?void(this.checkOffenders(e)||this.head.life<=0||(this.isHead()?this.isOpen()&&(Game.trigger("throwMuffin",this),this.offenders.push(e),MultiCell.prototype.remove.call(this,!1)):0===this.head.life?MultiCell.prototype.remove.call(this,!1):this.head.removeByArrow(e))):(this.head.offenders.push(e),void Game.once("afterTurn",this.open,this))},remove:function(e){this.isBlocked("removable")||this.isMedusaBlocked()||(this.isOpen()||!this.removeWithPowerUp?this.isHead()?this.isOpen()&&(0<this.head.life&&Game.trigger("throwMuffin",this),MultiCell.prototype.remove.call(this,e)):0===this.head.life?MultiCell.prototype.remove.call(this,e):this.head.remove(e):Game.once("afterTurn",this.open,this))},removeNear:function(e,t,i){this.isHead()?this.checkOffenders(i)||(this.offenders.push(i),this.remove(!1)):this.head.removeNear(e,t,i)},animateOpen:function(){var t=Game.animate(),i=this.$div.find(".muffinRackBg"),o=this.$div.find(".muffinRackDoor"),a=this.$div.find(".muffinLightning");application.playSound("muffinrackOpening"),this.$div.queue(function(e){this.removeClass("closed"),o.addClass("animateOpening"),i.addClass("animateOpening"),a.addClass("animateOpening"),this.children.forEach(function(e){e&&e.hasClass("muffinWrap")&&e.find(".muffin").addClass("muffinShake")},this),e()}).delay(300).queue(function(e){a.removeClass("animateOpening"),a.remove(),e()}).delay(300).queue(function(e){this.children.forEach(function(e){e&&e.hasClass("muffinWrap")&&e.find(".muffin").removeClass("muffinShake")},this),e()}).delay(600).queue(function(e){this.addClass("opened"),o.removeClass("animateOpening"),o.addClass("opened"),i.removeClass("animateOpening"),e(),t()})},animateRemoval:function(e){application.playSound("muffinrackRemove"),this.$div.remove(),e()}},{chars:""}),ChestWithKeysCell=MultiCell.extend({constructor:function(e,t,i,o){MultiCell.apply(this,arguments),this.baseName="chestWithKeys",this.scoresId="chestWithKeys",this.removable=!1,this.removeOnRemoveNear=!1,this.collectedKeys=0,this.isHead()&&i&&(this.maxLife=application.level.chestWithKeysLives&&application.level.chestWithKeysLives[10*this.x+this.y]||5,this.life=this.maxLife,this.keyAssebleOrder=application.level.chestWithKeysOrder&&application.level.chestWithKeysOrder[10*this.x+this.y]||null)},render:function(){MultiCell.prototype.render.call(this);for(var e=this.life+1;e<=5;++e)this.$div.find(".chestLockWrap"+e).remove()},getHeadTemplateClass:function(){return"chestWithKeysHead"},afterRemove:function(){MultiCell.prototype.afterRemove.call(this)},unlock:function(){var e=this;this.isBlocked("removable")||this.medusaBlocked?Game.once("endTurn",function(){return e.unlock()}):(this.removable=!0,this.remove(),this.removable=!1)},isRemovable:function(){return this.isHead()?this.removable:this.head.isRemovable()},animateOpen:function(e){this.$div.find(".chestWithKeyskBg").addClass("chestWithKeysDie"),e()},animateTakeLife:function(e){var t=this.$div.find(".chestLockWrap"+(this.life+1));t instanceof EmptyFigure||(gameView.fallDownExplode(t,1,"lockFlying"+this.life),e())},animateRemoval:function(e){this.$div.remove(),e()}},{chars:""}),ChestWithKeysCellProcessor={process:function(){var e=Game.filter(function(e){return e instanceof ChestWithKeysCell&&e.isHead()}).reduce(function(e,t){return e+t.life},0),t=Game.filter(function(e){return e instanceof ChestKeyCell}),i=Game.fallDownSpecialCells.filter(function(e){return e.cellClass===ChestKeyCell});if(0<e-t.length-i.length){var o=ChestKeyCell.chars.split("").filter(function(e,t){return-1!==application.level.colors.indexOf(Cell.chars[t])}),a=Math.floor(Math.pow(Math.random(),2)*Game.fallDownSpecialCells.length);Game.fallDownSpecialCells.splice(a,0,{offset:Math.floor(2*Math.random()+1),cellClass:ChestKeyCell,type:RANDOM(o)})}}},ChestKeyCell=Cell.extend({initialize:function(e,t,i,o){this.scoresId="chestkey",this.color=o,i&&(this.color=application.level.map[e].charAt(t),application.level.cellAttribute&&"*"==application.level.cellAttribute[e].charAt(t)&&(this.attribute="key")),"."==this.color&&this.setRandomColor();var a=ChestKeyCell.chars.indexOf(this.color);-1!=a&&Cell.chars[a]&&(this.color=Cell.chars[a]),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},getTarget:function(){var e=Game.targetChest;if(e&&Game.isOnField(e)&&e.collectedKeys<e.maxLife)return e;var t=[];return Game.each(function(e){e instanceof ChestWithKeysCell&&e.isHead()&&e.collectedKeys<e.maxLife&&t.push(e)}),Game.targetChest=this.hasCollectOrder(t)?t.sort(function(e,t){return e.keyAssebleOrder-t.keyAssebleOrder})[0]:RANDOM(t),Game.targetChest},hasCollectOrder:function(e){return e.every(function(e){return!!e.keyAssebleOrder})},executeRemove:function(e){this.animateUnlock(Game.animate()),Cell.prototype.executeRemove.call(this,e)},animateUnlock:function(e){var t=this.getTarget();if(t){++t.collectedKeys;var i=this.$div.clone();_Figure.blockedAnimations.append(i),i.alignTo(this.$div),i.ourAnimate({ajust:{x:15,y:10},target:t.$div},300,"linear",_.bind(function(){i.remove(),t.unlock(),e()},this))}else e()},getTemplateClass:function(){return"chestKeyCell"},calcColor:function(){return"chestKeyCell_"+(this.saveColor||this.color)},createDiv:function(){return Cell.prototype.createDiv.call(this,[this.calcColor()])},showFieldPoints:function(){Game.trigger("showFieldPoints",this.$div,GameScores[this.scoresId],"explodeCell_"+this.color)}},{chars:""}),CollectChestWithKeys=Task.extend({targetChest:null,initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","removedItem"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof ChestWithKeysCell&&e.isHead()},tick:function(t){var i=this,o=Game.animate();t.$div.queue(function(e){t.animateTakeLife(e)}).delay(100).queue(function(e){t.animateOpen(e)}).delay(900).queue(function(e){e(),o(),t.$div.find(".chestWithKeyskBg").removeClass("chestWithKeysDie").addClass("chestWithKeysFlying"),i.animateCollect(t.$div,GameScores.chestWithKeys,Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},i))})},getAnimateCollectRotation:function(){return 0}});CollectChestWithKeys.getCssClass=function(e){return"ChestWithKeysCell"};var CollectPizzaCell=Task.extend({initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","pizzaCellRemoved"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof PizzaCell},tick:function(){Task.prototype.tick.call(this,1)}}),BlackHoleCell=BaseCell.extend({scoresId:"blackhole",constructor:function(e,t,i){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1,i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},getTemplateClass:function(){return"blackholeCell"},remove:function(e){return this.decorator?(this.decorator.remove(e),this.movable=!1,!0):BaseCell.prototype.remove.call(this,e)},animateRemoval:function(e){var t=Game.tasks.any(function(e){return"CollectType"===e.get("type")&&e.get("description").cell===BlackHoleCell.chars});if(Game.set("score",Game.get("score")+GameScores.blackhole),Game.trigger("showFieldPoints",this.$div,GameScores.blackhole,"blackholeRemove"),application.playSound("blackholeRemove"),t)e();else{var i=GameBaseView.createFallDownExplodePiece("blackholeBg");i.alignTo(this.$div),gameView.fallDownExplodePiece(i),canvas.timeManager.setTimeout(_.bind(function(){e()},this),3*Game.get("speed"))}this.$div.remove()},bump:function(){this.removable=!0,this.remove(),this.removable=!1},createDiv:function(){return Cell.prototype.createDiv.call(this)},moveblackhole:function(e,t){if(e instanceof PopUpColorCell){var i=Game.tasks.findWhere({type:"CollectPopUpColor"});i&&(i.set("autoNewElements",i.get("autoNewElements")+1),Game.once("afterTurn",i.checkNewElements,i))}var o=this.$div.clone(),a=e.$div.clone();_Figure.blockedAnimations.append(o),o.alignTo(this.$div),o.find(".blackholeBg").removeClass("stable").addClass("fly"),_Figure.blockedAnimations.append(a),a.alignTo(e.$div),this.$div.remove(),e.$div.remove(),o.ourAnimate({target:a},7*o.distanceTo(a),"linear",function(){application.playSound("blackholeEat"),a.ourAnimate({scale:0},400,"easeIn",function(){a.remove()}),o.find(".blackholeBg").removeClass("fly").animationByName("blackholeEat").queue(function(){o.remove(),t()})})}},{chars:"*",taskId:"blackhole",process:function(){for(var o=[],e=0;e<Config.rows;e++){o.push([]);for(var t=0;t<Config.cols;t++)o[e].push(!1)}var a=0;Game.each(function(e){if(!(e instanceof BlackHoleCell))return!1;if(o[e.y][e.x])return!1;if(e.isBlocked("movable"))return!1;if(e.medusaBlocked)return!1;if(e.decorator)return!1;var t=[];if(Game.neighbors(e,function(e){!(e instanceof Cell&&e.isRegular||e.constructor===ArrowCell||e.constructor===BombCell||e.constructor===MultiColorCell)||e instanceof CaviarCell||e.decorator||e.isBlocked("movable")||e.medusaBlocked||o[e.y][e.x]||e.attribute||t.push(e)}),0!==t.length){a++;var i=RANDOM(t);o[i.y][i.x]=!0,e.moveblackhole(i,Game.animate(function(){e.x=i.x,e.y=i.y,(Game.field[e.y][e.x]=e).createDiv()})),Game.field[e.y][e.x]=void 0}}),a&&application.playSound("blackholeMove")}}),CoralCell=BaseCell.extend({scoresId:"coral",constructor:function(e,t,i){BaseCell.call(this,e,t),this.movable=!1,this.removable=!1,i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},getTemplateClass:function(){return"coralCell"},remove:function(e){return this.decorator?(this.decorator.remove(e),this.movable=!1,!0):BaseCell.prototype.remove.call(this,e)},animateRemoval:function(e){var t=Game.tasks.any(function(e){return"CollectType"===e.get("type")&&e.get("description").cell===CoralCell.chars});if(Game.set("score",Game.get("score")+GameScores.coral),Game.trigger("showFieldPoints",this.$div,GameScores.coral,"coralRemove"),application.playSound("coralRemove"),t)e();else{var i=GameBaseView.createFallDownExplodePiece("coralBg");i.alignTo(this.$div),gameView.fallDownExplodePiece(i),canvas.timeManager.setTimeout(_.bind(function(){e()},this),3*Game.get("speed"))}this.$div.remove()},bump:function(){this.removable=!0,this.remove(),this.removable=!1},createDiv:function(){return Cell.prototype.createDiv.call(this)}},{chars:"&",taskId:"coral"}),FrozenEggObject=FrozenObject.extend({defaults:_.defaults({layer:"cellar",name:"frozenegg",width:1,height:1,size:1,feature:"frozenegg"},BaseObject.prototype.defaults),initialize:function(){this.on("change:size change:height",function(){this.set({width:this.get("size"),height:this.get("height")})},this)},getClass:function(){return"frozenegg frozen_"+this.get("name")},getVariant:function(){return 1==this.get("size")?getRandomInt(1,5):2==this.get("size")&&this.get("size")===this.get("height")?"big"+getRandomInt(1,3):3==this.get("size")?"bigHorizontal"+getRandomInt(1,3):3==this.get("height")?"bigVertical"+getRandomInt(1,3):"big"},createFigure:function(){var e=FrozenObject.prototype.createFigure.call(this);return e.addClass("variant"+this.getVariant()),e},remove:function(){application.playSound("removeFrozenEgg"),FrozenObject.prototype.remove.call(this)}});BaseObject.classes.FrozenEggObject=FrozenEggObject;var FrogPathObject=BaseObject.extend({defaults:_.defaults({layer:"cellar",feature:"frog"},BaseObject.prototype.defaults),initGame:function(){var i=this;Game.once("prepared",function(){var e=i.getNext();if(!e){var t=Game.find(function(e){return e instanceof FrogTargetCell&&Game.isNeighbors(e,{x:i.get("x"),y:i.get("y")})});t&&(e=new Backbone.Model({x:t.x,y:t.y}))}i.next=i.getDirection(e),i.prev=i.getDirection(i.getPrev()),i.next&&(i.$div.addClass("next_"+DirectionName[i.next]),i.$div.addClass("neighbour_"+DirectionName[i.next])),i.prev&&(i.$div.addClass("prev_"+DirectionName[i.prev]),i.$div.addClass("neighbour_"+DirectionName[i.prev])),i.isVertical()?i.$div.addClass("vertical"):i.isHorizontal()?i.$div.addClass("horizontal"):i.$div.addClass("corner")})},getClass:function(){return"frogpath"},remove:function(){var e=this;this.$div.ourAnimate({opacity:0},500,"linear",Game.animate(function(){e.$div.remove(),e.destroy()}))},getNext:function(){var t=this;return Game.objects.find(function(e){return"FrogPathObject"===e.get("code")&&e.get("id2")===t.get("id2")&&e.get("id1")===t.get("id1")+1})},getPrev:function(){var t=this;return Game.objects.find(function(e){return"FrogPathObject"===e.get("code")&&e.get("id2")===t.get("id2")&&e.get("id1")===t.get("id1")-1})},getDirection:function(e){if(e){if(e.get("x")===this.get("x"))return e.get("y")>this.get("y")?Direction.down:Direction.up;if(e.get("y")===this.get("y"))return e.get("x")>this.get("x")?Direction.right:Direction.left}return null},isHorizontal:function(){return(this.next&Direction.horizontal||!this.next)&&(this.prev&Direction.horizontal||!this.prev)},isVertical:function(){return(this.next&Direction.vertical||!this.next)&&(this.prev&Direction.vertical||!this.prev)},createFigure:function(){return this.$div=FigureView.createByTemplate(".invisible .defaultCell",this.getClass().split(" ")),this.$div.set({x:this.get("x")*Config.cellWidth,y:this.get("y")*Config.cellHeight}),this.$div}});BaseObject.classes.FrogPathObject=FrogPathObject;var FrogCell=BaseCell.extend({constructor:function(){BaseCell.prototype.constructor.apply(this,arguments),this.color="none",this.removeOnRemoveNear=!1,this.removable=!1,this.active=!1,this.isMoving=!1,this.movable=!1,this.pathId=1,this.stepsCount=0,this.food=0,this.eaten=0;var t=this;t.intervalId=canvas.timeManager.setTimeout(function e(){t.isMoving||t.$div.addClass("blink").delay(300).queue(function(e){t.$div.removeClass("blink").removeClass("stable").addClass("stable"),e()}),t.intervalId=canvas.timeManager.setTimeout(e,4e3)},4e3),this.colors=FrogFuelCell.chars.split("").filter(function(e,t){return-1!==application.level.colors.indexOf(Cell.chars[t])}),Game.on("endTurn",function(){this.generateFood()},this),Game.on("removedFrogFood",function(e){this.eat(e),this.checkFood()},this)},generateFood:function(){var e=Game.tasks.findWhere({type:"CollectFrogTarget"});if(application.level.frogAutoNewElements&&e&&!e.get("completed")&&this.eated){this.eated=!1;var t={offset:Math.floor(2*Math.random()+1),cellClass:FrogFuelCell,type:RANDOM(this.colors)};Game.fallDownSpecialCells.push(t)}},checkFood:function(){var e=Game.tasks.findWhere({type:"CollectFrogTarget"}),t=[];Game.each(function(e){e instanceof FrogFuelCell&&t.push(e)}),application.level.frogAutoNewElements&&e&&!e.get("completed")&&t.length<=this.eaten&&Game.fallDownSpecialCells.unshift({offset:0,cellClass:FrogFuelCell,type:RANDOM(this.colors)}),this.eaten=0},createDiv:function(e){void 0===e&&(e=[this.calcColor()]);var t=FigureView.createByTemplate(".invisible ."+this.getTemplateClass(),e);FigureView.findById("shootercell").append(t),t.set(this.getCoords()),this.$div=t,this.setX(this.x),this.setY(this.y);var i=this.getMoveCell();return i.y!==this.y&&this.$div.addClass("movingVertical"),i.y===this.y&&(i.x<this.x?this.$div.addClass("movingLeft"):this.$div.addClass("movingRight")),i.x===this.x&&(i.y<this.y?this.$div.addClass("movingUp"):this.$div.addClass("movingDown")),this.$div},getTemplateClass:function(){return"frogCell"},remove:function(e){if(e){var t=this;canvas.timeManager.clearTimeout(this.intervalId),t.$div.ourAnimate({opacity:0},500,"linear",function(){BaseCell.prototype.remove.call(t)})}},getTargetCell:function(){var t;return Game.each(function(e){e instanceof FrogTargetCell&&(t=e)}),t},removePath:function(){_.each(gameView.objects.models,function(e){e instanceof FrogPathObject&&this.pathId>e.get("id1")&&this.pathId>e.get("id2")&&e.remove()},this)},getMoveCell:function(e){var t=this.pathId+1,i=_.find(application.level.objects,function(e){return e.id1==t||e.id2==t});return i?Game.field[i.y][i.x]:this.getTargetCell()},move:function(t){var i=this.$div,o=this;this.moved=!1,this.lastPosition=!1,this.isMoving=!0,this.active&&this.getMoveCell()?i.queue(function(e){i.removeClass("show").addClass("hide"),e()}).delay(400).queue(function(e){e(),o.step(t)}):this.step(t)},step:function(t){var i=this.getMoveCell();if(!i||i.decorator||i.medusaBlocked||i.isBlocked("movable")||!(i.movable||i instanceof FrogTargetCell))this.stop(t);else{this.playSound("frogJump"),--this.stepsCount,++this.pathId;var o=this.$div,a=this;this.lastPosition=i,this.moved=!0,o.queue(function(e){o.removeClass("hide").removeClass("show").removeClass("moving").removeClass("movingStart").removeClass("movingLeft").removeClass("movingRight").removeClass("movingDown").removeClass("movingUp").removeClass("movingVertical"),i.y===a.y&&(i.x<a.x?o.addClass("movingLeft"):o.addClass("movingRight")),i.x===a.x&&(i.y<a.y?o.addClass("movingUp"):o.addClass("movingDown")),i.y!==a.y&&o.addClass("movingVertical"),o.addClass("movingStart"),e()}).delay(150).queue(function(e){o.removeClass("movingStart").addClass("moving"),e(),i===a.getTargetCell()?(a.playSound("frogFinish"),a.$div.ourAnimate(i.getCoords(),300,"linear",function(){a.$div.hide(),i.$div.addClass("done").delay(1e3).queue(function(e){a.stop(function(){i.removable=!0,a.removable=!0,i.remove(),a.remove(!0),e(),t()})})})):a.swap(i,function(){0<a.stepsCount?a.step(t):a.stop(t)})})}},stop:function(t){this.isMoving=!1,this.eatingDone=!1;var i=this.$div;i.removeClass("moving").removeClass("movingStart").removeClass("hide"),this.getMoveCell().y!==this.y&&i.addClass("movingVertical"),this.removePath(),this.active&&this.moved?i.queue(function(e){i.addClass("show"),e()}).delay(400).queue(function(e){e(),t()}):t()},eat:function(e){++this.eaten,++this.stepsCount,this.eated=!0;var t=this.$div;this.$div.hasClass("eat")||e||(this.playSound("frogEat"),this.eatingDone=!0,t.queue(function(e){t.addClass("eat"),e()}).delay(300).queue(function(e){t.removeClass("eat"),e()}))},swap:function(e,t){Game.field[this.y][this.x]=e;var i=(Game.field[e.y][e.x]=this).x;this.x=e.x,e.x=i,i=this.y,this.y=e.y,e.y=i,this.animateSwap(e,t)},animateSwap:function(e,t){var i=this,o=this.getCoords(),a=e.getCoords(),n={dy:-Config.cellHeight/2},r=(o.x-a.x)/2;r&&(n.dx=r),e.$div.ourAnimate(a,300,"linear",_.noop),e.y-this.y==0?this.$div.ourAnimate(n,150,"linear",function(){i.$div.ourAnimate(o,150,"linear",t)}):this.$div.ourAnimate(o,300,"linear",t)},playSound:function(e){"default"===featuresAdder.getActiveFeatureStyle("frog")&&BaseCell.prototype.playSound.call(this,e)}},{chars:"",blockedCells:[],process:function(){FrogCell.blockedCells=[],Game.each(function(e){return e instanceof FrogCell&&(!e.medusaBlocked&&!e.isBlocked("movable")&&(!(e.isMoving||!e.stepsCount)&&void e.move(Game.animate())))})}}),FrogFuelCell=Cell.extend({scoresId:"frogfuel",initialize:function(e,t,i,o){this.life=1,this.color=o,i&&(this.color=application.level.map[e].charAt(t),application.level.cellAttribute&&"*"==application.level.cellAttribute[e].charAt(t)&&(this.attribute="key")),"."==this.color&&this.setRandomColor();var a=FrogFuelCell.chars.indexOf(this.color);-1!=a&&Cell.chars[a]&&(this.color=Cell.chars[a]),i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this))},animateRemoval:function(e){var t;if(Game.each(function(e){e instanceof FrogCell&&(t=e)}),t){var i=this.$div.clone();_Figure.blockedAnimations.append(i),i.alignTo(this.$div),this.$div.remove(),i.ourAnimate({ajust:{x:15,y:10},target:t.$div},300,"linear",_.bind(function(){i.remove(),e()},this))}else Cell.prototype.animateRemoval.call(this,e)},animateTakeLife:function(i){var o=this.life,a=this.$div;this.$div.queue(function(t){this.find(".cellStone").queue(function(e){application.playSound("frogfuelTakeLife"),this.removeClass("stable"),e()}).animationByName("frogfuelTakeLife"+o).queue(function(e){a.removeClass("frogfuelCell"+(o+1)).addClass("frogfuelCell"+o),this.addClass("stable"),i(),e(),t()})})},beforeRemove:function(e){Game.trigger("removedFrogFood",e),this.$div.queue(function(e){this.removeClass("frogfuelCell"+(this.life+1)).addClass("frogfuelCell"+this.life),e()}),Cell.prototype.beforeRemove.apply(this,arguments)},calcColor:function(){return"frogfuelCell_"+(this.saveColor||this.color)},createDiv:function(){return Cell.prototype.createDiv.call(this,["frogfuelCell"+this.life,this.calcColor()])},getTemplateClass:function(){return"frogfuelCell"}},{chars:""}),FrogTargetCell=function(e,t){BaseCell.call(this,e,t),this.scoresId="frogTarget",this.movable=!1,this.removable=!1};_.extend(FrogTargetCell.prototype,BaseCell.prototype),FrogTargetCell.prototype.indestructible=!0,FrogTargetCell.prototype.createDiv=function(e){var t=BaseCell.prototype.createDiv.call(this,e);return t.addClass("frogtarget"),t};var CollectFrogTarget=Task.extend({initialize:function(){this.set("amount",1),this.set("type",this.get("description").type),this.set("event","removedItem"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof FrogTargetCell},tick:function(e){this.animateCollect(e.$div,GameScores[e.scoresId],Game.endTurnAnimate(function(){Task.prototype.tick.call(this)},this))}}),FireFlowerCell=BaseCell.extend({scoresId:"fireFlower",qFireballRemoved:0,constructor:function(e,t,i,o){switch(BaseCell.call(this,e,t),this.color="none",this.baseName="fireFlower",this.movable=!0,this.removeOnRemoveNear=!0,i?application.level.map[e].charAt(t):o){case"":this.life=1;break;case"":this.life=2;break;default:this.life=FireFlowerCell.MaxLife}i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this),this.decorator&&this.listenTo(this.decorator,"remove",this.onRemoveDecorator)),Game.once("prepared",function(){application.level.fireFlowerAutoNewElements&&!Game.tasks.find(function(e){return e instanceof CollectFireFlower})?FireFlowerCell.autoNewElements=FireFlowerCell.countElementsInField():FireFlowerCell.autoNewElements=0,Game.collectFireFlowerTotal&&!Game.collectFireFlowerTotalUpdated&&(Game.collectFireFlowerTotal-=FireFlowerCell.countElementsInField(),Game.collectFireFlowerTotalUpdated=!0)})},createDiv:function(){var e=BaseCell.prototype.createDiv.apply(this,arguments);return this.decorator&&this.decorator.render(),e.find(".fireFlowerBg").addClass("stable"+this.life),this.life<3&&this.startFireAnimation(),e},runScaleChanger:function(){this.onField},startFireAnimation:function(){canvas.timeManager.setTimeout(function(){this.onField&&(this.$div.find(".fireFlowerFireBg").addClass("run"),this.runScaleChanger())}.bind(this),this.getNextiAnimationFire())},animateTakeLife:function(t){application.playSound(this.getTakeLifeSound());var i="run"+(this.life+1)+"to"+this.life,o=this.$div.find(".fireFlowerBg");o.removeClass("stable"+(this.life+1)).addClass(i),this.$div.delay(400).queue(function(e){o.removeClass(i).addClass("stable"+this.life),this.life<=2&&!this.$div.find(".fireFlowerFireBg").hasClass("run")&&this.startFireAnimation(),e(),t()}.bind(this)),Game.set("score",Game.get("score")+GameScores.fireFlowerTakeLife),Game.trigger("showFieldPoints",this.$div,GameScores.fireFlowerTakeLife,"fireFlowerCellRemove")},onRemoveDecorator:function(){if(!this.decorator){var e=Game.animate(function(){this.setY(this.y),this.removeOnRemoveNear=!0},this);canvas.timeManager.setTimeout(e,500)}},isRemovable:function(){return!this.medusaBlocked&&!this.isBlocked("removable")&&(this.decorator?!(this.decorator instanceof StickyChainDecorator)||this.decorator.removable:this.removable)},remove:function(e){return this.decorator?(this.decorator.remove(e),this.removeOnRemoveNear=!0):BaseCell.prototype.remove.call(this,e)},executeRemove:function(){var e="run"+(this.life+1)+"to"+this.life;this.$div.find(".fireFlowerBg").removeClass("stable"+(this.life+1)).addClass(e),Game.set("score",Game.get("score")+GameScores.fireFlowerTakeLife),Game.trigger("showFieldPoints",this.$div,GameScores.fireFlowerTakeLife,"fireFlowerCellRemove")},executeRemoveByProcess:function(){if(this.$div.find(".fireFlowerFireBg").removeClass("run"),this.aAttackCells=[],Game.each(function(e){!(e!==this&&!e.bAttackedByFireFlower&&e.isRemovable()&&0<e.life)||e instanceof MuffinRackCell&&!e.isOpen()||this.aAttackCells.push(e)},this),this.aAttackCells=_.shuffle(this.aAttackCells),this.aAttackCells.length=Math.min(this.aAttackCells.length,FireFlowerCell.MaxFireball),this.aAttackCells.length){this.damageId=_.uniqueId("fireflower_"),application.playSound(this.getRemoveSound());for(var e=0;e<this.aAttackCells.length;e++)this.aAttackCells[e].bAttackedByFireFlower=!0,this.explodeOneCell(this.aAttackCells[e])}else this.isTaskTarget()||this.animateRemovalNoTask();return Game.set("score",Game.get("score")+GameScores.fireFlower),Game.trigger("showFieldPoints",this.$div,GameScores.fireFlower,"fireFlower"),BaseCell.prototype.executeRemove.apply(this,arguments)},explodeOneCell:function(e,t){var i=this,o=FigureView.createByTemplate(".invisible .fireFlowerFireballExplosion");o.find(".fireFlowerFireball").addClass("run"),_Figure.blockedAnimations.append(o),o.alignTo(this.$div);var a=Game.animate(function(){o.remove(),e.bAttackedByFireFlower=!1,e instanceof BarCell&&(e.removeWithPowerUp=!0);e.remove(!1,i,i.damageId),i.qFireballRemoved++,i.qFireballRemoved!==i.aAttackCells.length||i.isTaskTarget()||i.animateRemovalNoTask()});o.ourAnimate({target:e.$div,animation:Library.collectFly,options:{vy:300}},this.getFireballAnimateSpeed(),"linear").queue(function(e){o.find(".fireFlowerFireball").removeClass("run"),o.find(".fireFlowerExplosion").addClass("run"),o.delay(700).queue(function(e){a(),e()}.bind(this)),e()})},animateRemoval:function(e){this.isTaskTarget()&&(Game.trigger("removed"+this.getCapitalisedBaseName()),this.$div.remove()),e()},animateRemovalNoTask:function(){var e=GameBaseView.createFallDownExplodePiece("fireFlowerDie");e.alignTo(this.$div),gameView.fallDownExplodePiece(e),Game.trigger("removed"+this.getCapitalisedBaseName()),this.$div.remove()},getTemplateClass:function(){return"fireFlowerCell"},getTakeLifeSound:function(){return this.baseName+"TakeLife"},getRemoveSound:function(){return this.baseName+"Attack"},getCapitalisedBaseName:function(){return this.baseName.charAt(0).toUpperCase()+this.baseName.slice(1)},getFireballAnimateSpeed:function(){return 8*Game.get("speed")+150*Math.random()},getNextiAnimationFire:function(){return 1e3<(FireFlowerCell.iAnimationFire+=50)?FireFlowerCell.iAnimationFire=0:FireFlowerCell.iAnimationFire},isGrowAbleOccupite:function(){return this.life===FireFlowerCell.MaxLife}});FireFlowerCell.countElementsInField=function(){for(var e=0,t=0;t<Config.cols;t++)for(var i=Config.rows-1;0<=i;i--)Game.field[i][t]&&Game.field[i][t]instanceof FireFlowerCell&&e++;return e},FireFlowerCell.process=function(){if(Game.each(function(e){e instanceof FireFlowerCell&&0===e.life&&(e.type=FireFlowerCell.chars.charAt(0),FireFlowerCell.prototype.executeRemoveByProcess.call(e))}),FireFlowerCell.autoNewElements){for(var e=0,t=0;t<Game.fallDownSpecialCells.length;t++)e-=Game.fallDownSpecialCells[t].type===FireFlowerCell.chars[0]?1:0;for(e+=FireFlowerCell.autoNewElements-FireFlowerCell.countElementsInField();0<e;)Game.fallDownSpecialCells.push({offset:Math.floor(2*Math.random()+1),cellClass:FireFlowerCell,type:FireFlowerCell.chars.charAt(0)}),e--}},FireFlowerCell.MaxLife=3,FireFlowerCell.MaxFireball=3,FireFlowerCell.chars="",FireFlowerCell.iAnimationFire=0;var CollectFireFlower=CollectType.extend({getCapitalisedBaseName:function(){return"FireFlower"},initialize:function(){CollectType.prototype.initialize.call(this),Game.collectFireFlowerTotal||(Game.collectFireFlowerTotal=0),Game.collectFireFlowerTotal+=Number(this.get("description").amount)},collectAnimation:function(t,e,i){this.animateCollect(e,i,Game.endTurnAnimate(function(){Task.prototype.tick.call(this),this.playCollectSound(t);Game.fallDownSpecialCells.filter(function(e){return e.type===t.type});0<Game.collectFireFlowerTotal&&(Game.collectFireFlowerTotal-=1,Game.fallDownSpecialCells.push({cellClass:this.get("cellClass"),offset:Math.floor(2*Math.random()+1),type:t.type}))},this))}});CollectFireFlower.getCssClass=function(e){return"CollectFireFlower_"};var TwinkleCell=BaseCell.extend({scoresId:"twinkle",constructor:function(e,t,i,o){switch(BaseCell.call(this,e,t),this.color="none",this.baseName="twinkle",this.movable=!1,this.removable=!0,this.removeOnRemoveNear=!0,this.type="",this.life=1,this.active=!1,this.notRemoveByTwoMulticolors=!0,i?application.level.map[e].charAt(t):o){case TwinkleCell.chars[0]:this.type="R";break;case TwinkleCell.chars[1]:this.type="G";break;case TwinkleCell.chars[2]:this.type="B";break;case TwinkleCell.chars[3]:this.type="Y";break;case TwinkleCell.chars[4]:this.type="W";break;case TwinkleCell.chars[5]:this.type="P";break;default:this.type=RANDOM(application.level.availableColors||"RGBYP")}i&&application.level.decorators&&(this.decorator=Decorator.create(application.level.decorators[e].charAt(t),this),this.decorator&&this.listenTo(this.decorator,"remove",this.onRemoveDecorator)),Game.on("removedItem",this.removeItemCallback,this)},removeItemCallback:function(e){e===this||this.decorator||e.decorator||!this.life||Math.abs(e.x-this.x)+Math.abs(e.y-this.y)==1&&this.type===e.getCurrentColor()&&this.reaction()},createDiv:function(){var e=FigureView.createByTemplate(".invisible ."+this.getTemplateClass());return _Figure.field.append(e),e.set(this.getCoords()),this.$div=e,this.setX(this.x),this.setY(this.y),this.decorator&&this.decorator.render(),e.find(".twinkleBg").addClass("type"+this.type),e},onRemoveDecorator:function(){if(!this.decorator){var e=Game.animate(function(){this.setY(this.y)},this);canvas.timeManager.setTimeout(e,500)}},isRemovable:function(){return!this.medusaBlocked&&!this.isBlocked("removable")&&(!!this.decorator||this.removable)},removeNear:function(e,t){this.decorator?BaseCell.prototype.removeNear.apply(this,arguments):t&&this.type!==t||this.remove()},remove:function(e,t){return!this.isBlocked("removable")&&(this.decorator?(this.decorator.remove(e,t),!0):!!this.isRemovable(t)&&(this.reaction(),0===this.life&&this.executeRemove(e,t),!0))},reaction:function(){if(!this.medusaBlocked&&!this.isBlocked("removable")){var t=this.$div.find(".twinkleBg"),e=Game.tasks.find(function(e){return e instanceof CollectTwinkle});e&&(this.bCounted||(this.bCounted=!0,this.active||(this.active=!0,t.addStyleAnimate("growUp").queue(function(e){t.addClass("active"),e()}),e.tick(this),Game.set("score",Game.get("score")+GameScores.twinkle),application.playSound("twinkleActivate"),TwinkleCell.lastCell=this)))}},animateRemoval:function(t){this.$div.find(".twinkleBg").removeClass("active").addClass("die"),this.$div.animationByName("twinkleDie").queue(function(e){t(),this.$div.remove(),e()}.bind(this))},isGrowAbleOccupite:function(e){return!this.active&&(e instanceof ChocolateFarmCell||e.decorator instanceof ChocolateDecorator)},getTemplateClass:function(){return"twinkleCell"},getCapitalisedBaseName:function(){return this.baseName.charAt(0).toUpperCase()+this.baseName.slice(1)}});TwinkleCell.countElementsInField=function(){for(var e=0,t=0;t<Config.cols;t++)for(var i=Config.rows-1;0<=i;i--)Game.field[i][t]&&Game.field[i][t]instanceof TwinkleCell&&e++;return e},TwinkleCell.process=function(){var t=!0,i=[];if(Game.each(function(e){if(e instanceof TwinkleCell)return e.active?(i.push(e),!0):t=!1}),t&&i.length){Game.set("score",Game.get("score")+GameScores.twinklesAllActivated),Game.trigger("showFieldPoints",TwinkleCell.lastCell&&TwinkleCell.lastCell.$div||i[0].$div,GameScores.twinklesAllActivated,"twinklesAllActivated");for(var e=0;e<i.length;e++){var o=i[e];Game.off("removedItem",o.removeItemCallback),o.removable=!0,BaseCell.prototype.remove.call(o)}}TwinkleCell.clearCounted()},TwinkleCell.clearCounted=function(){Game.each(function(e){e instanceof TwinkleCell&&(e.bCounted=!1)})},TwinkleCell.chars="",TwinkleCell.lastCell=null;var CollectTwinkle=CollectType.extend({getCapitalisedBaseName:function(){return"Twinkle"},initialize:function(){CollectType.prototype.initialize.call(this)},collectAnimation:function(e,t,i){Task.prototype.tick.call(this),this.playCollectSound(e)},rollback:function(){this.set("amount",this.get("amount")+1),this.$div.hasClass("complete")&&(this.set("completed",!1),Game.on(this.get("event"),this.onEvent,this),this.$div.removeClass("complete"))}});CollectTwinkle.getCssClass=function(e){return"CollectTwinkle_"};var SeagullRockCell=BaseCell.extend({isRegular:!1,constructor:function(e,t){BaseCell.call(this,e,t),this._entityOnRock=null,this.color="none",this.movable=!1,this.removable=!1,this.removeOnRemoveNear=!1;var i=SeagullRockCell.entityChars,o=application.level.cellAttribute;-1<i.indexOf(o[this.y].charAt(this.x))&&(this.addEntityOnRock(new SeagullOnRock),this.makeRemovable())},seagullArrival:function(e){var t=this;this.addEntityOnRock(e),this.renderEntityView(e),this.animateSeagullAppearance(function(){e.initializeHandlers(),t.makeRemovable()})},renderEntityView:function(e){this.$div.append(e.createDiv()),e.renderLives(),e.setParent(this)},animateSeagullAppearance:function(t){var i=this,o=this.getEntityFromRock().getElement(),a=this.$div,n=o.clone().addClass("isFlyingToCell");o.css({opacity:0}),n.queue(function(e){_Figure.blockedAnimations.append(n),n.alignTo(a),n.addClass(i.x<=Math.floor(Config.cols/2)?"flyingRight":"flyingLeft"),e()}).ourAnimate({target:a,opacity:0,scale:1.3,ajust:{x:this.x>Math.floor(Config.cols/2)?4*Config.cellWidth:-4*Config.cellWidth,y:this.y>Math.floor(Config.rows/2)?4*Config.cellHeight:-4*Config.cellHeight}},0).ourAnimate({target:a,opacity:1,scale:1},10*Game.get("speed"),void 0,Game.animate(function(){n.remove(),o.ourAnimate({opacity:1},0).queue(function(e){o.addClass("sitting"),e()}).delay(500).queue(function(e){o.removeClass("sitting"),t(),e()})}))},createDiv:function(){if(Cell.prototype.createDiv.call(this,[]),this.isEntityOnRock()){var e=this.getEntityFromRock();e.set("isAbleToMove",!0),this.$div.append(e.createDiv()),e.setParent(this),e.renderLives()}return this.$div},remove:function(){var e=this.getEntityFromRock();if(!this.isBlocked("removable")&&e&&!this.medusaBlocked){var t=e.getLives();0<t&&(1<t?e.processDamage():(Game.trigger("seagullEntityRemoved",e),this.removeEntityFromRock()))}},getTemplateClass:function(){return"seagullRockCell"},addEntityOnRock:function(e){this.setEntityOnRock(e)},makeRemovable:function(){this.removable=!0,this.removeOnRemoveNear=!0},removeEntityFromRock:function(){this.isEntityOnRock()&&(this.removable=!1,this.removeOnRemoveNear=!1,this.getEntityFromRock().remove(),this.setEntityOnRock(null))},isEntityOnRock:function(){return this.getEntityFromRock()&&null!==this.getEntityFromRock()},getEntityFromRock:function(){return this._entityOnRock},setEntityOnRock:function(e){this._entityOnRock=e}},{chars:"",entityChars:""}),SeagullOnRock=Backbone.Model.extend({defaults:{isAbleToMove:!1,isJustStunned:!1,isStunned:!1,lives:2,maxLives:2,scoreId:"seagull"},initialize:function(){this.initializeHandlers()},initializeHandlers:function(){this.on("change:lives",this.renderLives)},stopHandlers:function(){this.off("change:lives")},getTemplateClass:function(){return"seagullOnRock"},createDiv:function(){if(!this.$element){var e=this.getTemplateClass();this.$element=FigureView.createByTemplate(".invisible ."+e,[])}return this.$element},renderLives:function(){var e=this.getElement();if(e){var t=this.getLives(),i=this.getMaxLives();i<t&&this.setLives(i);var o=e.find(".livesBar");void 0!==o&&o.html(t)}},onStunnedChange:function(){var t=this.getElement();t&&(this.get("isStunned")?t.queue(function(e){t.addClass("hitAnimation"),application.playSound("seagullHit"),setTimeout(function(){t.removeClass("hitAnimation"),t.addClass("stunned"),e()},150)}):t.queue(function(e){t.removeClass("stunned"),e()}))},processDamage:function(){this.setLives(this.getLives()-1),this.set({isJustStunned:!0,isStunned:!0}),this.onStunnedChange()},remove:function(){var t=this;this.stopHandlers(),this.$element.queue(function(e){t.$element.remove(),t.$element=null,e()})},calculatePoints:function(){return GameScores[this.get("scoreId")]},moveTo:function(t,i){var o=this;application.playSound("seagullFly");var a=this.createDiv().clone(),n=this.$parent,r=n.x<=t.x?"flyingRight":"flyingLeft";n.removeEntityFromRock(),t.addEntityOnRock(this),a.queue(function(e){_Figure.blockedAnimations.append(a),a.addClass("isFlyingToCell").addClass(r),a.alignTo(n.$div),e()}).ourAnimate({target:t.$div,scale:1.2},10*Game.get("speed")).ourAnimate({scale:1},2*Game.get("speed"),void 0,function(){a.removeClass("isFlyingToCell"),a.addClass("sitting")}).delay(500).queue(function(e){a.remove(),t.renderEntityView(o),i(),e()})},getElement:function(){return this.$element},setLives:function(e){this.set("lives",e)},getLives:function(){return this.get("lives")},getMaxLives:function(){return this.get("maxLives")},isStunned:function(){return this.get("isStunned")},setParent:function(e){this.$parent=e},isAbleToMove:function(){return this.get("isAbleToMove")}}),SeagullProcessor={process:function(){var i=[],o=[];if(Game.each(function(e){if(e instanceof SeagullRockCell)if(e.isEntityOnRock()){var t=e.getEntityFromRock();t.isStunned()?t.get("isJustStunned")||(t.set("isStunned",!1),t.onStunnedChange(),t.setLives(t.getMaxLives())):e.isBlocked("movable")||e.medusaBlocked||!t.isAbleToMove()||o.push(e),t.set("isJustStunned",!1),t.set("isAbleToMove",!0)}else e.isBlocked("movable")||e.medusaBlocked||i.push(e)}),0!==o.length){var a=_.shuffle(i);o.forEach(function(e){var t=a.pop();if(t){var i=e.getEntityFromRock();i.moveTo(t,Game.animate(function(){i.initializeHandlers(),t.makeRemovable()}))}})}}},CollectSeagullOnRock=Task.extend({initialize:function(){var e=this;this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","seagullEntityRemoved"),Task.prototype.initialize.call(this),Game.on("start",function(){e.processEntityCreating(!0)},this)},getEntitiesOnFieldLimit:function(){return application.level&&application.level.seagullRockEntityValue?application.level.seagullRockEntityValue:1},calculateActiveEntities:function(){var t=0;return Game.each(function(e){e instanceof SeagullRockCell&&e.isEntityOnRock()&&t++}),t},processEntityCreating:function(e){var t=this.calculateActiveEntities(),i=this.getEntitiesOnFieldLimit(),o=Number(this.get("beginAmount")),a=Number(this.get("collectedAmount"));if(!this.get("completed")&&t+a<o&&t<i){var n=[];if(Game.each(function(e){e instanceof SeagullRockCell&&!e.isEntityOnRock()&&!e.medusaBlocked&&!e.isBlocked("movable")&&n.push(e)}),0!==n.length){var r=_.sample(n),s=new SeagullOnRock;s.set("isAbleToMove",e),r.seagullArrival(s),this.processEntityCreating(e)}}},tick:function(e){var t=this;Task.prototype.tick.call(this);var i=e.getElement(),o=e.calculatePoints();application.playSound("seagullTask"),this.animateCollect(i,o,function(){t.processEntityCreating(!1)})},getAnimateCollectRotation:function(){return 0}}),FortCell=MultiCell.extend({scoresId:"fort",constructor:function(e,t,i,o){MultiCell.prototype.constructor.call(this,e,t,i,o),this.removable=!1,this.removeOnRemoveNear=!1,this.isHead()&&(this.removeId=_.uniqueId("fort_"),this.initializeCellTasks())},initializeCellTasks:function(){var e=application.level.fortCellCollectType;if(e){var t=e[this.x]&&e[this.x][this.y];t&&(this.targetFilters=t,this.listenToOnce(Game,"prepared",this.initializeCellTargets)),Game.fortCellTasksUpdated||(Game.fortCellTasksUpdated=!0,this.listenToOnce(Game,"start",this.updateActiveTasks))}},initializeCellTargets:function initializeCellTargets(){var _this109=this;this.targets=new Backbone.Collection(this.targetFilters.map(function(target){var targetClass=eval(target.type),task=new targetClass({active:!1,color:"",cssClass:Config.tasks[target.type].cssClass,description:target,name:Config.tasks[target.type].name,order:target.order||0},{type:target.cell||""});return task.animateCollect=_.bind(_this109.animateCollectTarget,_this109,task),task},this)),this.targets.forEach(function(t){var i=_this109.$div.find(".taskBlock"),e=t.get("color")||t.get("type");t.precalc(i),(t.$div=i).find(".taskIco").addClass("color_".concat(e)),i.find(".maximumCount").html(t.get("beginAmount")),i.find(".currentCount").html(t.get("collectedAmount")),_this109.listenTo(t,"change:collectedAmount",function(){_this109.$div.queue(function(e){i.find(".currentCount").html(t.get("collectedAmount")),e()})}),_this109.listenTo(t,"beforeCompleted",_this109.updateActiveTasks)})},animateCollectTarget:function(e,t,i,o){var a=t.clone(),n=Game.animate();_Figure.blockedAnimations.append(a),a.set({"margin-left":0,"margin-top":0}),a.alignTo(t),a.ourAnimate({scale:1.2},3*Game.get("speed")).ourAnimate({target:e.$div.find(".taskIconContainer"),rotate:e.getAnimateCollectRotation(),scale:.75},6*Game.get("speed"),void 0,function(){Game.set("score",Math.max(0,Game.get("score")+i)),o()}).queue(function(e){application.playSound("fortTask"),n(),e()}).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){a.remove()})},isFort:function(e){return e instanceof FortCell&&e.isHead()},getFortTasks:function(){return Game.filter(this.isFort,this).reduce(function(e,t){return e.concat(t.targets.toArray())},[])},updateActiveTasks:function(){var e=_.groupBy(this.getFortTasks(),function(e){return e.getGroupId()});for(var t in e)for(var i=_.sortBy(e[t],function(e){return e.get("order")}),o=0;o<i.length;++o){var a=i[o];if(!a.isCollected()){a.set("active",!0);break}a.set("active",!1)}},isTaskCompleted:function(){return!this.targets.findWhere({completed:!1})},getHeadTemplateClass:function(){return"fortHeadCell"},beforeRemove:function(){var a=this;if(this.isHead()){var e=this.getCellsToDestroy();if(0<e.length){var n=_.uniqueId("fortcell_");e.forEach(function(e){var t=e.direction,i=e.items,o=e.key;a.animateShot(Game.animate(function(){i.forEach(function(e){e.isRemoveOnce?e.removeById(a.removeId):e.remove(!1,a,n)})}),t,o)})}}MultiCell.prototype.beforeRemove.call(this)},animateShot:function(e,t,i){var o=this,a=FigureView.createByTemplate(".invisible .fortExplode"),n=25*Game.get("speed");a.addClass(DirectionName[i]),application.playSound("fortActivation"),a.queue(function(e){_Figure.blockedAnimations.append(a),a.addClass("isFlyingToCell"),a.alignTo(o.$div),e()}).ourAnimate({x:a.get("x")+(0!==t.x?t.x*Config.rows*Config.cellWidth:1),y:a.get("y")+(0!==t.y?t.y*Config.cols*Config.cellHeight:1)},n).queue(function(e){a.remove(),e()}),setTimeout(e,200)},getCellsToDestroy:function(){var c=this;return DirectionDiv.map(function(e,t){for(var i=Boolean(Direction.horizontal&t)?c.height:c.width,o=Boolean(Direction.horizontal&t)?Config.rows:Config.cols,a=[],n=1;n<o;++n)for(var r=0;r<i;++r){var s=c.y+e.y*n+r*Math.abs(e.x),l=c.x+e.x*n+r*Math.abs(e.y),d=Game.field[s]&&Game.field[s][l];d&&c.getBody().indexOf(d)<0&&a.push(d)}return{direction:e,items:a,key:t}})},animateRemoval:function(e){var t=this;this.$div.find(".taskBlock").remove(),this.$div.addStyleAnimate("removing").queue(function(){MultiCell.prototype.animateRemoval.call(t,e)})}},{chars:"",css:"fort"}),FortProcessor={process:function(){var t=[];Game.each(function(e){e&&e instanceof FortCell&&e.isHead()&&e.head.isTaskCompleted()&&t.push(e)}),0<t.length&&t.forEach(function(e){Game.trigger("fortCellRemoved",e),e.removable=!0,e.remove()})}},CollectFort=Task.extend({initialize:function(){this.set("amount",this.get("description").amount),this.set("type",this.get("description").type),this.set("event","fortCellRemoved"),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof FortCell&&!e.isMedusaBlocked()&&!e.isBlocked("removable")},tick:function(e){var t=this;e.$div.find(".taskBlock").remove(),this.animateCollect(e.$div,GameScores.fort,function(){Task.prototype.tick.call(t)})}});CollectFort.getCssClass=function(e){return"FortCell"};var BoxCell=BaseCell.extend({constructor:function(e,t,i,o){BaseCell.call(this,e,t,i),this.movable=!0,this.removable=!1,this.removeOnRemoveNear=!0,this.baseName="box",this.partId=o,Game.once("endTurn",function(){this.removable=!0},this)},getTemplateClass:function(){return this.baseName+"Cell"},animateRemoval:function(e){this.$div.addStyleAnimate("explode").queue(function(){e(),gameView.fallDownExplode(this,9,"boxCellExplode")})}},{chars:""}),VaseBoxCell=MultiCell.extend({animatedPiecesAmount:[7,13,4,6,9],sounds:{metallDestruction:"metallDestruction",vaseDestruction:"vaseDestruction",woodDestruction:"woodDestruction"},constructor:function(e,t,i,o){var a=this;if(MultiCell.apply(this,arguments),this.baseName="vaseBox",this.scoresId="vaseBox",this.removable=!0,this.removeOnRemoveNear=!0,this.openedBy=null,this.currentOffender=null,this.isHead()){var n=application.level.vaseBoxData&&application.level.vaseBoxData.find(function(e){return e.x===a.x&&e.y===a.y});this.life=n.life,this.coverLife=n.coverLife}},render:function(){if(this.isHead()){this.coverLife?this.head.$div.addClass("cover"+this.coverLife):this.head.animateOpen(),this.$vases=this.head.$div.find(".vases");for(var e=1;e<=this.life;e++){var t=FigureView.createByTemplate(".invisible .vase");t.addClass("vase"+e),this.$vases.append(t)}}},getHeadTemplateClass:function(){return"vaseBoxHeadCell"},open:function(e){this.head.openedBy=e,this.head.animateOpen()},remove:function(e,t,i){if(!this.isRemovable())return!1;var o=this.head.currentOffender||i;this.head.currentOffender=null,this.head.isOpen()?this.head.openedBy&&this.head.openedBy===o||(this.isHead()?(this.life--,this.animateTakeLife(Game.animate()),0===this.life&&this.executeRemove(e),Game.trigger("destroyVase",this),Game.set("score",Math.max(0,Game.get("score")+GameScores.vaseBoxTakeLife)),Game.trigger("showFieldPoints",this.$div,GameScores.vaseBoxTakeLife,"vaseBoxTakeLife")):0===this.head.life?BaseCell.prototype.remove.call(this,!0):this.head.remove.call(this.head,e)):this.removeCover(o)},removeCover:function(e){this.head.lastOffender&&e&&e===this.head.lastOffender||(this.head.lastOffender=e,this.head.coverLife--,this.animateTakeCoverLife(),Game.set("score",Math.max(0,Game.get("score")+GameScores.vaseBoxOpen)),Game.trigger("showFieldPoints",this.$div,GameScores.vaseBoxOpen,"vaseBoxOpen"),this.isOpen()&&this.open(e))},removeNear:function(e,t,i){this.head.currentOffender=i,MultiCell.prototype.removeNear.call(this)},removeByArrow:function(e){this.head.currentOffender=e},animateTakeCoverLife:function(e){this.head.$div.removeClass("cover"+(this.head.coverLife+1)).addClass("cover"+this.head.coverLife),application.playSound(this.head.coverLife?this.sounds.metallDestruction:this.sounds.woodDestruction),gameView.fallDownExplodeWithoutRemove(this.head.$div,this.animatedPiecesAmount[this.head.coverLife],"vaseBoxCover".concat(this.head.coverLife+1,"_piece"))},animateTakeLife:function(t){var i=this,o=this.life;this.head.$div.queue(function(e){application.playSound(i.sounds.vaseDestruction);var t=i.$div.find(".vase"+(o+1));gameView.fallDownExplode(t,8,"vase_piece"),e()}).delay(100).queue(function(e){t(),e()})},animateOpen:function(){this.head.$div.find(".vaseBoxHeadCell .vaseBoxCover").remove()},animateRemoval:function(t){var i=this;this.head.$div.queue(function(e){application.playSound(i.sounds.woodDestruction),gameView.fallDownExplode(i.head.$div,9,"vaseBox_piece"),t(),e()})},isOpen:function(){return 0===this.head.coverLife}},{chars:""}),ManyCells=BaseCell.extend({optionKey:"",dx:0,dy:0,constructor:function(e,t,i){var o=this;BaseCell.call(this,e,t),this.movable=!1,this.removeOnRemoveNear=!0,this.removable=!1;var a=application.level[this.optionKey];if(a){var n=a.find(function(e){return e.x===o.x&&e.y===o.y});n&&(this.group=n.group,this.order=n.order);var r=a.find(function(e){return e.group===o.group&&e.order===o.order+1});r&&(this.dx=r.x-this.x,this.dy=this.y-r.y)}else console.error("  ".concat(this.optionKey,"  "))},calculateColor:function(){for(var e,t=this,i=null!==(e=application.level[this.optionKey].find(function(e){return e.group===t.group&&1===e.order}).color)&&void 0!==e?e:"",o=0;o<this.life;o++){var a;this.setColor(null!==(a=i[o])&&void 0!==a?a:"N")}},setColor:function(e){if(e&&"N"!==e)this.colors=this.colors.concat(e);else{var t=application.level.colors.replace(/[^BGPRWY]/g,"").split("");this.colors=this.colors.concat(RANDOM(t))}},createDiv:function(e){return BaseCell.prototype.createDiv.call(this,e),this.render(),this.$div},getHead:function(){return this.getByOrder(1)},isHead:function(){return this.head===this},getByOrder:function(t){return this.getBody().find(function(e){return e.order===t})},getBody:function(){var t=this;return Game.filter(function(e){return e&&e instanceof t.constructor&&e.group===t.group}).sort(function(e,t){return e.order-t.order})},isRemovable:function(){return this.isHead()?!this.isBlocked("removable")&&BaseCell.prototype.isRemovable.call(this):this.head.isRemovable()},removeById:function(e,t){this.isHead()?this.head.remove(t):this.head.removeById(e,t)},removeByArrow:function(e){this.isHead()||this.head.removeByArrow(e)},highlight:function(e){this.isHead()?BaseCell.prototype.highlight.call(this,e):this.head.highlight(e)}}),AnemoneCell=ManyCells.extend({baseName:"anemoneCell",optionKey:"clownFishCells",taskId:"CollectClownFish",sounds:{anemoneAppear:"anemoneAppear",anemoneHit:"anemoneHit",anemoneRemoveGroup:"anemoneRemoveGroup"},render:function(){var e,t,i=this;if(1===this.order){this.isTask=this.isHaveTask(),(this.head=this).setHead(this),this.removable=!0;var o=application.level[this.optionKey].filter(function(e){return e.group===i.group});this.life=2*o.length-1,this.colors="",this.calculateColor(),this.yMax=o.reduce(function(e,t){return t.y>e?t.y:e},0),this.xMax=o.filter(function(e){return e.y===i.yMax}).reduce(function(e,t){return t.x>e?t.x:e},0)}this.x===(null===(e=this.head)||void 0===e?void 0:e.xMax)&&this.y===(null===(t=this.head)||void 0===t?void 0:t.yMax)&&(this.setHead(),this.head.$groupClownFish=FigureView.createByTemplate(".invisible .emptyTemplate"),this.head.$groupClownFish.appendTo(this.$div.parent()),this.head.$sandBlock=this.renderBlockSand(),this.head.$borderBlockNew=this.renderBorder(this.head.colors[0]),this.head.$borderBlockNew.addClass("showBorder"),this.head.$borderBlockOld=this.renderBorder(this.head.colors[0]),this.head.$borderBlockOld.addClass("hideBorder"),this.head.$holeBlock=this.renderBlockHole(this.$div),this.head.$lifeBlock=this.renderBlockLife(this.$div),this.head.unlock(),this.head.actionId=-1)},renderBorder:function(e){var t=FigureView.createByTemplate(".invisible .emptyTemplate");t.addClass("colorBorder".concat(e)),t.appendTo(this.head.$groupClownFish);for(var i=this.getBody(),o=0;o<i.length;o++){var a=i[o],n=this.getByOrder(a.order+1),r=this.getByOrder(a.order-1);if(1===a.order||a.isTail()){var s=FigureView.createByTemplate(".invisible .endAnemoneCell");s.appendTo(t),s.alignTo(a.$div);var l=n?{dx:a.dx,dy:-a.dy}:{dx:-r.dx,dy:r.dy},d=l.dx,c=l.dy;0===d?s.addClass(1===c?"rotation":"rotationRevers"):s.set({"scale-x":d})}else if(r.x!==n.x&&r.y!==n.y){var g=FigureView.createByTemplate(".invisible .cornerAnemoneCell");g.appendTo(t),g.alignTo(a.$div),g.set({"scale-x":r.dx-a.dx,"scale-y":r.dy-a.dy})}else{var u=FigureView.createByTemplate(".invisible .middleAnemoneCell");u.appendTo(t),u.alignTo(a.$div),0===a.dx&&u.addClass("rotation")}}return t},renderBlockHole:function(e){var t=FigureView.createByTemplate(".invisible .emptyTemplate");t.appendTo(this.head.$groupClownFish),t.alignTo(e),t.set({x:e.x,y:e.y});for(var i=this.getBody(),o=i.length-2,a=0;a<=o;a++){var n=i[a];this.renderHole(t,n.$div),this.renderHole(t,n.$div).addClass(n.getPosition())}var r=i[o+1];return this.renderHole(t,r.$div),t},renderHole:function(e,t){var i=FigureView.createByTemplate(".invisible .emptyTemplate");return i.addClass("cancerHole"),i.appendTo(e),i.alignTo(t),i},renderBlockLife:function(e){var t=FigureView.createByTemplate(".invisible .emptyTemplate");t.appendTo(this.head.$groupClownFish),t.alignTo(e),t.set({x:e.x,y:e.y});for(var i=this.getBody(),o=i.length-2,a=0;a<=o;a++){var n=i[a],r=2*(n.order-1),s=this.head.life-r;this.renderLife(n.head.colors[r],"life".concat(s),t,n.$div),this.renderLife(n.head.colors[r+1],"life".concat(s-1),t,n.$div).addClass(n.getPosition())}var l=i[o+1],d=2*(l.order-1),c=this.head.life-d;return this.renderLife(l.head.colors[d],"life".concat(c),t,l.$div),t},renderLife:function(e,t,i,o){var a=FigureView.createByTemplate(".invisible .anemoneCell");return a.addClass(t).find(".cancer").addClass("cancer".concat(e)),a.appendTo(i),a.alignTo(o),a},renderBlockSand:function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate");e.appendTo(this.head.$groupClownFish);for(var t=this.getBody(),i=0;i<t.length;i++){var o=0<=i-1?t[i-1]:null,a=i+1<t.length?t[i+1]:null,n=this.renderSand(t[i],o,a);n.appendTo(e),n.alignTo(t[i].$div)}return e},renderSand:function(e,t,i){var o=FigureView.createByTemplate(".invisible .emptyTemplate");if(t&&i)t.x!==i.x&&t.y!==i.y?(o.addClass("cancerBgCornerCell"),o.set({"scale-x":t.dx-e.dx,"scale-y":t.dy-e.dy})):(o.addClass("cancerBgCell"),0===e.dx&&o.addClass("rotation"));else{o.addClass("cancerBgEndCell");var a=i?{dx:e.dx,dy:-e.dy}:{dx:-t.dx,dy:t.dy},n=a.dx,r=a.dy;0===n?o.addClass(1===r?"rotation":"rotationRevers"):o.set({"scale-x":n})}return o},isTail:function(){var t=this;return this.order===application.level[this.optionKey].filter(function(e){return e.group===t.group}).length},unlock:function(){var e=this.head.$lifeBlock.find(".life".concat(this.head.life," .cancer")),t=this.head.$lifeBlock.find(".life".concat(this.head.life," .blink"));e.addClass("animateAppear").delay(600).queue(function(e){t.addClass("animateBlink"),e()})},animateTakeLife:function(e){this.removeLife(),application.playSound(this.sounds.anemoneAppear),this.head.unlock(),this.head.animateBorder(),e()},animateBorder:function(){var e=this.head.colors.length-this.head.life,t=2<=e?this.head.colors[e-2]:this.head.colors[0];this.head.$borderBlockOld.removeClass("colorBorder".concat(t)).addClass("colorBorder".concat(this.head.colors[e])),this.head.$borderBlockNew.removeClass("showBorder").addClass("hideBorder"),this.head.$borderBlockOld.removeClass("hideBorder").addClass("showBorder");var i=[this.head.$borderBlockOld,this.head.$borderBlockNew];this.head.$borderBlockNew=i[0],this.head.$borderBlockOld=i[1]},removeLife:function(){var e=this.$lifeBlock.find(".life".concat(this.head.life+1));Game.set("score",Game.get("score")+GameScores.clownFish),Game.trigger("showFieldPoints",e,GameScores.clownFish,"clownFish");var t=this.head.$lifeBlock.find(".life".concat(this.head.life+1));if(t){t.find(".blink").remove();var i=t.find(".cancer"),o=this.head.colors[this.head.colors.length-this.head.life-1];i.removeClass("animateAppear").removeClass("cancer".concat(o)).addClass("animateFly".concat(o)),application.playSound(this.sounds.anemoneHit),i.delay(700).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){i&&i.remove()}),this.head.isTask&&Game.trigger("takeLifeCancer",this.head)}},getAnimateCollectRotation:function(){return 0},remove:function(e,t){if(this.isHead()){if(this.actionId===Game.actionId)return;this.actionId=Game.actionId,BaseCell.prototype.remove.call(this,e,t)}else this.head.remove(e,t)},executeRemove:function(e){this.isHead()||this.head.executeRemove(),this.removeLife(),Game.set("score",Game.get("score")+GameScores.anemone),Game.trigger("showFieldPoints",this.$div,GameScores.anemone,"anemone"),ManyCells.prototype.executeRemove.call(this,e)},removeNear:function(e,t,i){var o;if(this.isHead()){if(this.head.isRemovable()){var a=this.colors.length-this.life;t&&this.colors[a]!==t||this.actionId!==Game.actionId&&(this.actionId=Game.actionId,ManyCells.prototype.remove.call(this))}}else null===(o=this.head)||void 0===o||o.removeNear(e,t,i)},getCurrentColor:function(){return"none"},getPosition:function(){return 1===this.dx?"top":-1===this.dx?"bottom":-1===this.dy?"left":1===this.dy?"right":void 0},setHead:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(t=t||this.getHead())&&(this.getBody().forEach(function(e){e.head=t}),this.head=t)},highlight:function(e){this.isHead()?e?this.$groupClownFish.removeClass("powerUpHighlight"):this.$groupClownFish.addClass("powerUpHighlight"):this.head.highlight(e)},beforeRemove:function(t){var i=this;if(this.isHead()){this.$div.queue(function(e){i.$groupClownFish.ourAnimate({"margin-top":-5},300,"linear"),e()}).delay(300).queue(function(e){application.playSound(i.sounds.anemoneRemoveGroup),i.$groupClownFish.addClass("anemoneGroupRemove"),e()}).delay(200).queue(function(e){i.$groupClownFish.remove(t),i.getBody().forEach(function(e){Game.inField(e.x,e.y)&&(e.removable=!0,BaseCell.prototype.executeRemove.call(e,t))}),e()})}ManyCells.prototype.beforeRemove.call(this,t)},animateRemoval:function(t){this.$div.queue(function(e){this.remove(),e(),t()})},isHaveTask:function(){var t=this;return Boolean(application.level.task.filter(function(e){return e.type===t.taskId}).length)}},{chars:""}),CollectClownFish=Task.extend({initialize:function(){this.set("event","takeLifeCancer"),this.set("type",this.get("description").type);this.get("description").amount;this.set("amount",this.countCellsInField()),Task.prototype.initialize.call(this)},canCollect:function(e){return e instanceof AnemoneCell},countCellsInField:function(){var t=0,i=0;return Game.each(function(e){this.canCollect(e)&&(t+=2),1===e.order&&i++},this),t-i},tick:function(e){var t=e.$lifeBlock.find(".life".concat(e.life+1));if(t){t.find(".blink").remove();var i=t.find(".cancer"),o=i.clone();_Figure.blockedAnimations.append(o),o.alignTo(t),i.remove(),o.delay(700).ourAnimate({target:this.target,ajust:this.ajust,scale:1.1,rotate:0},6*Game.get("speed"),void 0,_.bind(function(){Task.prototype.tick.call(this)},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){return o.remove()})}else Task.prototype.tick.call(this)},getCapitalisedBaseName:function(){return"ClownFish"}});CollectClownFish.getCssClass=function(e){return"CollectClownFish"};var RemoveFigureController={removeItemsSilent:function(e,t){var i,o=_.unique(_.compact(_.pluck(e,"color"))).shift(),a=_.uniqueId("figure"),n=_.any(e,function(e){return e.inMove});for(i=0;i<e.length;i++){var r=e[i];r.decorator&&"changecolor"!=r.getDecoratorName()&&r.remove(),r instanceof Cell&&!(r instanceof ArrowCell)?r.remove(!0):r.remove()}for(i=0;i<t.length;i++)t[i].removeNear(void 0,o,a,n,e)},cloneItems:function(e){for(var t=[],i=0;i<e.length;i++)if(e[i]instanceof Cell||e[i]instanceof EggCell){var o=e[i].$div.clone();o.find(".attribute").remove(),o.find(".decorator").remove(),_Figure.field.append(o),o.alignTo(e[i].$div),t.push(o)}return t},createFigureAnimation:function(e,t,i){i=_.once(i);for(var o=function(){this.remove(),i()},a=0;a<e.length;a++)e[a].ourAnimate(t.getCoords(),4*Game.get("speed"),"linear",o);0===e.length&&i()},isItemsOneLine:function(e,t,i){for(var o=1;o<e.length;o++){if(0===t&&e[o].x!=e[0].x)return!1;if(0===i&&e[o].y!=e[0].y)return!1}return!0},threeFigureRemove:function(e,t,i){var o,a=_.unique(_.compact(_.pluck(e,"color"))).shift(),n=_.uniqueId("figure"),r=_.any(e,function(e){return e.inMove});for(o=0;o<e.length;o++)e[o].remove();for(o=0;o<i.length;o++)i[o].removeNear(void 0,a,n,r,e)},createEggFigureAnimation:function(e,t,i){RemoveFigureController.createFigureAnimation(e,t,i)},eggFigureRemove:function(e,t,i){application.playSound("eggCollected");var o=RemoveFigureController.cloneItems(e);_.each(e,function(e){e.removable=!0}),RemoveFigureController.removeItemsSilent(e,i);var a=Game.animate();RemoveFigureController.createEggFigureAnimation(o,t,_.bind(function(){var e=new EggCell(t.y,t.x,!1,t.color-1);this.addItem(e,!0),RemoveFigureController.animateEggAfterTransform(e,function(){0===e.color&&e.remove(),a()})},Game))},animateEggAfterTransform:function(e,t){t()},fourFigureRemove:function(e,t,i){var o=RemoveFigureController.isItemsOneLine(e,1,0)?"-":"|";application.playSound("fourFigureRemove");var a=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(a,t,Game.animate(function(){var e=new ArrowCell(t.y,t.x,!1,o,t.color);this.addItem(e,!0)},Game))},fiveFigureRemove:function(e,t,i){application.playSound("fiveFigureRemove");var o=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(o,t,Game.animate(function(){var e=new MultiColorCell(t.y,t.x);this.addItem(e,!0)},Game))},otherFigureRemove:function(e,t,i){application.playSound("otherFigureRemove");var o=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(o,t,Game.animate(function(){var e=new ArrowCell(t.y,t.x,!1,"+",t.color);this.addItem(e,!0)},Game))},points:function(e,t){var i,o=0,a=0;for(i=0;i<e.length;i++){var n=e[i];n instanceof Cell&&(o++,n.decorator||a++)}if(o!=e.length&&t instanceof Cell){for(i=0;i<e.length;i++)if(!(e[i]instanceof Cell)){e[i].showPointsOnRemove+=a*GameScores.cell;break}}else t.showPointsOnRemove+=GameScores.cell*a}};_.extend(RemoveFigureController,{filterFrogFuel:function(e){return _.each(e,function(e,t){e instanceof FrogFuelCell&&e.remove()}),e},fourFigureRemove:function(e,t,i){e=this.filterFrogFuel(e);var o=RemoveFigureController.isItemsOneLine(e,1,0)?"-":"|";application.playSound("fourFigureRemove");var a=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(a,t,Game.animate(function(){var e=new ArrowCell(t.y,t.x,!1,o,t.color);this.addItem(e,!0),user.trigger("bonusItemCreated",e)},Game))},fiveFigureRemove:function(e,t,i){e=this.filterFrogFuel(e),application.playSound("fiveFigureRemove");var o=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(o,t,Game.animate(function(){var e=new MultiColorCell(t.y,t.x);this.addItem(e,!0),user.trigger("bonusItemCreated",e)},Game))},otherFigureRemove:function(e,t,i){e=this.filterFrogFuel(e),application.playSound("otherFigureRemove");var o=RemoveFigureController.cloneItems(e);RemoveFigureController.removeItemsSilent(e,i),RemoveFigureController.createFigureAnimation(o,t,Game.animate(function(){var e=new ArrowCell(t.y,t.x,!1,"+",t.color);this.addItem(e,!0),user.trigger("bonusItemCreated",e)},Game))},createEggFigureAnimation:function(e,t,i){var o="spratHalf";1==t.color&&(o="spratFull"),application.playSound(o),i=_.once(i);for(var a=0;a<e.length;a++)e[a].ourAnimate({dy:-5},2.5*Game.get("speed"),"linear",Game.animate(_.bind(function(){this.ourAnimate({dy:5},2.5*Game.get("speed"),"linear",Game.animate(_.bind(function(){this.ourAnimate(t.getCoords(),4*Game.get("speed"),"linear",function(){this.remove(),i()})},this)))},e[a])));0===e.length&&i()},animateEggAfterTransform:function(t,i){t.$div.removeClass("color_"+t.color).addClass("collectedcolor_"+(t.color+1)).addClass("color_"+(t.color+1)).delay(910).queue(function(e){t.$div.removeClass("collectedcolor_"+(t.color+1)).removeClass("color_"+(t.color+1)).addClass("color_"+t.color),e(),i()})}});var SwapMoveController=function i(){Game.on("change:running",function(e,t){t?i.fieldOn():i.fieldOff()}),Game.on("invalidMove",i.invalidMove),Game.on("validMove",i.validMove),Game.on("change:selected",i.changeSelected),Game.on("cellChangeColor",i.cellChangeColor),Game.on("moveCell",i.moveCell),Game.on("change:suggest",i.changeSuggest),Application.on("changeOrientation",function(){i.changeSuggest(Game,Game.get("suggest"))})},canvas;function FloorController(){var a=function(e,t,i){var o=FigureView.createByTemplate(".invisible .floorLevel",["floorLevel"+i]);return o.set({x:t*Config.cellWidth,y:e*Config.cellHeight}),FigureView.cacheById(o,"floor_"+e+"_"+t),o};Game.on("prepared",function(){FigureView.findById("floor").empty();for(var e=0;e<Game.floor.length;e++)for(var t=0;t<Game.floor[e].length;t++)if(0<Game.floor[e][t]){var i=a(e,t,Game.floor[e][t]);FigureView.findById("floor").append(i)}}),Game.on("createFloor",function(e,t){var i=FigureView.findById("floor_"+e.y+"_"+e.x);i&&i.remove();var o=a(e.y,e.x,Game.floor[e.y][e.x]);o.hide(),FigureView.findById("floor").append(o),o.fadeIn(300,function(){t()})})}function FieldController(){Game.on("prepared",function(){FieldController.setupFieldPosition();for(var e=0;e<Game.field.length;e++)for(var t=0;t<Game.field[e].length;t++)null!==Game.field[e][t]&&Game.field[e][t].createDiv()})}function MovesController(){Game.on("change:moves",function(e,t){var i=FigureView.findById("moves");(t=t.get())>Config.lessMovesAmount||!Game.get("fullRunning")?(i.removeClass("lessAmount"),$("#game").removeClass("lessAmount")):(i.addClass("lessAmount"),$("#game").addClass("lessAmount")),i.html(t)})}SwapMoveController.getSwapCellsSpeed=function(){return 2.5},SwapMoveController.invalidMove=function(e,t){application.playSound("swapMove");var i=Game.get("speed")*SwapMoveController.getSwapCellsSpeed();e.first.$div.ourAnimate(e.second.getCoords(),i,"linear",function(){application.playSound("swapMoveRollback")}),e.first.$div.ourAnimate(e.first.getCoords(),i,"linear"),e.second.$div.ourAnimate(e.first.getCoords(),i,"linear"),e.second.$div.ourAnimate(e.second.getCoords(),i,"linear",t)},SwapMoveController.validMove=function(e,t){application.playSound("swapMove");var i=Game.get("speed")*SwapMoveController.getSwapCellsSpeed();e.first.$div.ourAnimate(e.second.getCoords(),i,"linear"),e.second.$div.ourAnimate(e.first.getCoords(),i,"linear",t)},SwapMoveController.changeSelected=function(e,t){var i=Game.previous("selected");if(void 0!==i&&i.$div.find(".selectedCellBg").remove(),void 0!==t){var o=FigureView.createByTemplate(".invisible .selectedTemplate",[]);application.playSound("changeSelected"),t.$div.append(o)}},SwapMoveController.cellChangeColor=function(e,t,i){e.$div.fadeOut(200,function(){e.$div.removeClass("color_"+t).addClass("color_"+e.color).fadeIn(200,i)})},SwapMoveController.moveCell=function(e,t,i){e.$div.ourAnimate(t,200,"linear",i)},SwapMoveController.changeSuggest=function(e,t){if(SwapMoveController.help&&(SwapMoveController.help.first.$div.removeClass("suggest"),SwapMoveController.help.second.$div.removeClass("suggest"),SwapMoveController.help.arrows.length&&SwapMoveController.help.arrows.fadeOut(300,function(){this.remove()}),SwapMoveController.help=null),t){var i,o=t.first,a=t.second;if(o.$div.addClass("suggest"),a.$div.addClass("suggest"),o.y>a.y){var n=o;o=a,a=n}i=o.x===a.x?canvas.createFigure().addClass("moveHelpVer"):canvas.createFigure().addClass("moveHelpHor"),_Figure.blockedAnimations.append(i),i.alignTo(o.$div),i.hide().fadeIn(300),SwapMoveController.help={arrows:i,first:o,second:a}}},SwapMoveController.fieldOn=function(){var e;SwapMoveController.fieldOff(),SwapMoveController.mouseDown=!1,SwapMoveController.multicolorHighLight=!1,gameView.fieldOffset=_Figure.field.offset(),e=$("#canvas");var t="touchstart.swapmove";is_android_browser||(t+=" mousedown.swapmove"),e.on(t,function(e){var t=gameView.getCell(e);if(!1!==t)return Game.isEndTurn()&&t.clickAnimate(),t.isMovable()&&(SwapMoveController.multicolorHighLight&&(SwapMoveController.multicolorHighLight=!1,Game.each(function(e){e.highlight(!0)})),SwapMoveController.mouseDown=!0,Game.tryMove(t)),!1});var i="touchend.swapmove";is_android_browser||(i+=" mouseup.swapmove"),e.on(i,function(){SwapMoveController.mouseDown=!1});var o="touchmove.swapmove";is_android_browser||(o+=" mousemove.swapmove"),e.on(o,SwapMoveController.moveEventListener)},SwapMoveController.moveEventListener=function(e){var t=gameView.getCell(e);if(window.mobile||(canvas.canvas_c.style.cursor="default"),!SwapMoveController.multicolorHighLight||!1!==t&&t.getCurrentColor()==SwapMoveController.multicolorHighLight||(SwapMoveController.multicolorHighLight=!1,Game.each(function(e){e.highlight(!0)})),!1!==t&&t.isMovable()){if(window.mobile||(canvas.canvas_c.style.cursor="pointer"),SwapMoveController.mouseDown)return Game.tryMove(t,!0),!1;Game.has("selected")&&Game.get("selected")instanceof MultiColorCell&&"none"!==t.getCurrentColor()&&!(t instanceof EggCell)&&Game.isNeighbors(Game.get("selected"),t)&&(SwapMoveController.multicolorHighLight=t.color,Game.each(function(e){e.getCurrentColor()===SwapMoveController.multicolorHighLight&&e.highlight()}))}},SwapMoveController.fieldOff=function(){$("#canvas").off(".swapmove")},FieldController.setupFieldPosition=function(){FigureView.findById("fieldContainer").removeClass("fieldContainer").addClass("fieldContainer");var e,t=function(e){for(var t=0;t<Config.cols;t++)if(null!==Game.field[e][t])return!1;return!0},i=function(e){for(var t=0;t<Config.rows;t++)if(null!==Game.field[t][e])return!1;return!0},o=0,a=0;for(e=0;e<Config.rows&&t(e);e++)o--;for(e=Config.rows-1;0<=e&&t(e);e--)o++;for(e=0;e<Config.cols&&i(e);e++)a--;for(e=Config.cols-1;0<=e&&i(e);e--)a++;FigureView.findById("fieldContainer").css({left:Math.floor(a*Config.cellWidth/2),top:Math.floor(o*Config.cellHeight/2)})},FieldController.createExplosionProxy=createProxy(function(e){return FigureView.createByTemplate(".invisible .explosion",e?[e]:[])},100),FieldController.explodeSimpleCell=function(e,t,i,o){var a=FieldController.createExplosionProxy(o,o);if(_Figure.field.append(a),a instanceof ProxyFigure)return a.offset.x=e*Config.cellWidth-a.realFigure.model.x,a.offset.y=t*Config.cellHeight-a.realFigure.model.y,void a.realFigure.onRemove(i);a.set({x:e*Config.cellWidth,y:t*Config.cellHeight}),a.sprite.once("round",function(){a.remove(),i()})};var FigureView=(pZb=Backbone.View.extend({el:"#canvas",attributes:{width:760,height:660},canvasTemplate:".canvasTemplate",initialize:function(){_.bindAll(this,"updateInternal"),this.canvas_c=this.$el[0],this.running=!1,this.pausing=!1,this.timeManager=new TimeManager,this.fpsCounter=new FpsCounter,_.bindAll(this,"onChangeLayout"),this.initContext(),this.onChangeLayout()},onChangeLayout:function(){this.position=this.$el.offset(),window.devicePixelRatio?this.devicePixelRatio=window.devicePixelRatio:this.devicePixelRatio=1,this.width=this.canvasWidth=this.$el.width(),this.height=this.canvasHeight=this.$el.height(),this.$el[0].width=this.canvasWidth*this.devicePixelRatio,this.$el[0].height=this.canvasHeight*this.devicePixelRatio,1!=this.devicePixelRatio&&this.context.scale(this.devicePixelRatio,this.devicePixelRatio),this.layer&&(this.clearCache(),figureRulesProcess.process(),this.layer.reCalculateStylesRec(),pZb.reCacheTemplates())},initLayout:function(){this.finishedCssAnimations=[],this.finishedAnimations=[],this.timeManager.clear(),this.layer&&this.layer.remove(),this.layer=pZb.fromTemplate($(this.canvasTemplate).html()),_Figure.field=pZb.findById("field"),_Figure.blockedAnimations=pZb.findById("blockedAnimations"),_Figure.blockedAnimations2=pZb.findById("blockedAnimations2"),this.setLayoutOrientation(),this.listenTo(application,"change:horizontalOrientation",this.setLayoutOrientation,this)},initContext:function(){this.context=this.$el[0].getContext("2d")},sortFields:function(){_Figure.field.sort(function(e,t){return(e&&e.get("y"))-(t&&t.get("y"))})},updateInternal:function(){this.running&&!this.pausing&&this.timeManager.update(),this.sortFields(),this.render(),this.finishCssAnimations(),this.finishAnimations(),this.running&&!this.pausing?requestAnimFrame(this.updateInternal):this.inUpdate=!1},update:function(){this.inUpdate||(this.inUpdate=!0,this.updateInternal())},finishAnimations:function(){for(var e=0;e<this.finishedAnimations.length;e++)this.finishedAnimations[e]();this.finishedAnimations=[]},finishCssAnimations:function(){for(var e=0;e<this.finishedCssAnimations.length;e++)this.finishedCssAnimations[e].trigger("round");this.finishedCssAnimations=[]},setLayoutOrientation:function(){Application.horizontalOrientation?this.layer.removeClass("verticalOrientation").addClass("horizontalOrientation"):this.layer.removeClass("horizontalOrientation").addClass("verticalOrientation")},render:function(){this.fpsCounter.onPaint(),this.layer.calcAnimatedAttrs(),this.X=0,this.Y=0,pZb.skipDraw||(this.clearContext(),this.drawFigure(this.layer,this.context))},setTransform:function(e,t,i){i?(t.translate(this.X+e.attrs.x+e.attrs.width/2+e.attrs["margin-left"],this.Y+e.attrs.y+e.attrs.height/2+e.attrs["margin-top"]),t.scale(1!=e.attrs["scale-x"]?e.attrs["scale-x"]:e.attrs.scale,1!=e.attrs["scale-y"]?e.attrs["scale-y"]:e.attrs.scale),t.rotate(e.attrs.rotate*_Figure.DegToRadMultiple),this.X=-e.attrs.width/2,this.Y=-e.attrs.height/2):(this.X+=e.attrs.x+e.attrs["margin-left"],this.Y+=e.attrs.y+e.attrs["margin-top"])},drawFigure:function(e,t){if(0!==e.attrs.opacity){var i=t.globalAlpha;e.attrs.opacity<1&&(t.globalAlpha*=e.attrs.opacity);var o=0!==e.attrs.rotate||1!==e.attrs["scale-x"]||1!==e.attrs["scale-y"]||1!==e.attrs.scale||void 0!==e.text;o&&t.save(),this.setTransform(e,t,o),e.draw(t,this),this.drawChildren(e,t),o&&t.restore(),e.attrs.opacity<1&&(t.globalAlpha=i)}},drawChildren:function(e,t){if(e.children)for(var i=0;i<e.children.length;i++){var o=e.children[i];if(o){var a=this.X,n=this.Y;o.realFigure?(this.X+=o.offset.x,this.Y+=o.offset.y,this.drawFigure(o.realFigure,t)):o.attrs.cache?this.drawFigureFromCache(o,t):this.drawFigure(o,t),this.X=a,this.Y=n}}},drawFigureFromCache:function(e,t){if(0!==e.attrs.opacity&&0!==e.attrs.scale){if(!e._cache){var i=this.box(e);if(0===i.width||0===i.height)return;var o=document.createElement("canvas");e._cache={img:o,x:i.left,y:i.top,w:i.width,h:i.height,w2:Math.floor(i.width*this.devicePixelRatio),h2:Math.floor(i.height*this.devicePixelRatio)},o.width=e._cache.w2,o.height=e._cache.h2;var a=o.getContext("2d"),n=this.X,r=this.Y;this.X=-i.left,this.Y=-i.top,a.scale(this.devicePixelRatio,this.devicePixelRatio),this.drawFigure(e,a),this.X=n,this.Y=r}t.drawImage(e._cache.img,0,0,e._cache.w2,e._cache.h2,this.X+e._cache.x,this.Y+e._cache.y,e._cache.w,e._cache.h)}else e._cache=null},clearContext:function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight)},start:function(){({}),this.running=!0,this.timeManager.start(),this.onChangeLayout(),Application.trigger("startCanvas"),this.fpsCounter.start(),this.update()},stop:function(){this.running=!1,this.layer&&this.render(),Application.trigger("finishCanvas")},pause:function(){this.pausing=!0},resume:function(){!0===this.pausing&&(this.pausing=!1,this.timeManager.resume(),this.update())},createFigure:function(){return new _Figure},box:function(e){var t={left:e.attrs.x,top:e.attrs.y,width:0,height:0};if(e.attrs.width&&e.attrs.height)t.width=e.attrs.width,t.height=e.attrs.height;else if(void 0!==e.text){var i=this.context;e.attrs.font&&(i.font=e.attrs.font,t.height=parseInt(e.attrs.font.split(" ")[1]),t.top+=.1*t.height,t.top-=t.height,t.width=i.measureText(e.text).width,"center"==e.attrs.textAlign&&(t.left-=t.width/2))}return e.attrs["margin-left"]&&(t.left+=e.attrs["margin-left"]),e.attrs["margin-top"]&&(t.top+=e.attrs["margin-top"]),t},clearCache:function(){!function e(t){t._cache=null,t.forEachChildren(e)}(this.layer)}},{find:function(e){return canvas.layer.find(e)},_byId:{},speed:1,cachedTemplates:{},findById:function(e){return pZb._byId[e]},cacheById:function(e,t){e.id=t,pZb._byId[t]=e},reCacheTemplates:function(){for(var e in pZb.cachedTemplates)pZb.cachedTemplates[e].reCalculateStylesRec(),pZb.cachedTemplates[e]._unOptimizedPartRec()},createByTemplate:function(e,t){t&&!t.length&&(t=void 0);var i=e+(void 0!==t?t.join(" "):""),o=pZb.cachedTemplates[i];if(void 0===o){var a=$(e).html();if(!a)throw new Error('Template "'+e+'" not found.');if(o=pZb.fromTemplate(a),pZb.cachedTemplates[i]=o,void 0!==t)for(var n=0;n<t.length;n++)o.addClass(t[n]);o._unOptimizedPartRec()}return o.clone()},fromTemplate:function(e,t){var i,o=(e=e.trim()).indexOf(">"),a=e.lastIndexOf("<"),n=e.substr(0,o+1),r=e.substr(o+1,a-o-1);0===e.indexOf("<div")?i=new _Figure:0===e.indexOf("<span")&&(i=new TextFigure),t&&t.append(i);var s=n.match(/class=(?:"|')(.*?)(?:"|')/);if(null!==s&&_.each(s[1].split(/\s/),function(e){i.addClass(e)}),null!==(s=n.match(/id=(?:"|')(.*?)(?:"|')/))){var l=s[1];pZb._byId[l]=i}var d=0;for(o=a=0;-1!==(o=r.indexOf("<",o));)o++,"/"==r.charAt(o)?d--:d++,0===d&&(o=r.indexOf(">",o)+1,pZb.fromTemplate(r.substr(a,o-a),i),a=o);return 0===a&&-1==o&&r&&i.html(r),i}}),pZb),pZb,canvasTime;Application.on("ready",function(){canvas=new FigureView});var TimeManager=function(){canvasTime=0};TimeManager.speed=1,TimeManager.prototype.clear=function(){canvasTime=0,this.timeoutsHead={next:!1}},TimeManager.prototype.start=function(){canvasTime=0,this.cadrs=[],this.cadrId=0,this.cadrTimeout=0,this.prevTime=_.now()},TimeManager.prototype.resume=function(){this.cadrs=[],this.cadrId=0,this.cadrTimeout=0,this.prevTime=_.now()},TimeManager.prototype.update=function(){this.nt=_.now(),this.lastCadr=this.nt-this.prevTime,this.cadrs.length>this.cadrId?(this.cadrTimeout-=this.cadrs[this.cadrId],this.cadrs[this.cadrId]=this.lastCadr):this.cadrs.push(this.lastCadr),this.cadrTimeout+=this.lastCadr,this.cadrId++,100===this.cadrId&&(this.cadrId=0),this.lastCadr*this.cadrs.length>this.cadrTimeout&&(this.lastCadr=this.cadrTimeout/this.cadrs.length),canvasTime+=this.lastCadr*TimeManager.speed,this.prevTime=this.nt,this.callTimeouts()},TimeManager.prototype.callTimeouts=function(){for(var e=this.timeoutsHead.next,t=!1;!1!==e&&!(e.callTime>canvasTime);)t||(t=[]),t.push(e),e=e.next;if(this.timeoutsHead.next=e,t)for(var i=0;i<t.length;i++)t[i].callback&&t[i].callback()},TimeManager.prototype.setTimeout=function(e,t){if(e){for(var i=this.timeoutsHead,o={next:!1,callTime:canvasTime+t,callback:e};!1!==i.next&&i.next.callTime<o.callTime;)i=i.next;return o.next=i.next,i.next=o}},TimeManager.prototype.clearTimeout=function(e){if(e&&null!==e.callback){for(var t=this.timeoutsHead;!1!==t.next;){if(t.next===e){t.next=t.next.next;break}t=t.next}e.next=null,e.callback=null}},TimeManager.prototype.throttle=function(i,o,a){var n,r,s,l=this,d=null,c=0;a||(a={});var g=function(){c=!1===a.leading?0:canvasTime,d=null,s=i.apply(n,r),d||(n=r=null)};return function(){var e=canvasTime;c||!1!==a.leading||(c=e);var t=o-(e-c);return n=this,r=arguments,t<=0||o<t?(d&&(l.clearTimeout(d),d=null),c=e,s=i.apply(n,r),d||(n=r=null)):d||!1===a.trailing||(d=l.setTimeout(g,t)),s}};var CanvasView=Backbone.View.extend({tagName:"emptyTemplate",_createElement:function(e){return FigureView.createByTemplate(".invisible ."+e)},_setAttributes:function(e){e.class&&this.$el.addClass(e.class)},_setElement:function(e){"string"==typeof e&&0===e.indexOf("#")?this.$el=FigureView.findById(e.slice(1)):this.$el=e instanceof _Figure?e:_Figure.find(e)},_enableHover:function(e,t,i){"undefined"!=typeof mobile&&mobile||(this._enabledHover||(canvas.$el.on("mousemove.delegateEventsHover"+this.cid,_.bind(this._handlerHover,this)),this._enabledHover={}),this._enabledHover[t]||(this._enabledHover[t]={}),this._enabledHover[t][e]=i)},_desibleHover:function(){this._enabledHover&&(canvas.$el&&canvas.$el.off("mousemove.delegateEventsHover"+this.cid),this._enabledHover=null)},_handlerHover:function(i){this._enabledHover&&_.each(this._enabledHover,function(t,e){_.each(this.findChildren(e),function(e){e.contains(i.pageX,i.pageY)?e.__hover||(e.__hover=!0,t.mouseover&&(i.currentTarget=e,t.mouseover(i))):e.__hover&&(e.__hover=!1,t.mouseout&&(i.currentTarget=e,t.mouseout(i)))})},this)},findChildren:function(e){return e?(this._cach||(this._cach={}),this._cach[e]||(this._cach[e]=this.$el.findAll(e)),this._cach[e]):[this.$el]},delegate:function(e,t,o){var a=this;if(this._eventHandlers||(this._eventHandlers=[]),-1!==["mouseover","mouseout"].indexOf(e))this._enableHover(e,t,o);else{var i={eventName:e,selector:t,listener:o,fn:function(i){_.each(a.findChildren(t),function(e){if(i.originalEvent.changedTouches)for(var t=0;t<i.originalEvent.changedTouches.length;++t)e.contains(i.originalEvent.changedTouches[t].pageX,i.originalEvent.changedTouches[t].pageY)&&(i.currentTarget=e,o(i));else e.contains(i.pageX,i.pageY)&&(i.currentTarget=e,o(i))})}};this._eventHandlers.push(i),canvas.$el.on(e+".delegateEvents"+this.cid,i.fn)}return this},undelegateEvents:function(){return this.$el&&(this._desibleHover(),canvas.$el&&canvas.$el.off(".delegateEvents"+this.cid),this._eventHandlers=null),this},undelegate:function(t,i,o){if(this._eventHandlers){var e;e=o?this._eventHandlers.filter(function(e){return e.eventName==t&&e.selector==i&&e.listener==o}):i?this._eventHandlers.filter(function(e){return e.eventName==t&&e.selector==i}):this._eventHandlers;for(var a=0;a<e.length;++a)canvas.$el.off(t+".delegateEvents"+this.cid,i,e[a].listener);return this}}}),PowerUpBaseView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:selected",this.unUse)},unUse:function(){this.model.get("selected")||this.close()},run:function(){this.model.get("runned")||(this.model.run(),this.close())},close:function(){Game.set("selectedPowerUp",!1),this.stopListening(),this.undelegateEvents(),this.model.unSelect()}}),PowerUpView=PowerUpBaseView.extend({initialize:function(){PowerUpBaseView.prototype.initialize.apply(this,arguments),SwapMoveController.fieldOff()},close:function(){PowerUpBaseView.prototype.close.call(this),SwapMoveController.fieldOn()}}),PowerUpButtonView=Backbone.View.extend({events:{mousedown:"use"},initialize:function(){var e=messages[this.model.get("id")],t=messages.powerUpDisabledText.replace("{powerUpLevel}",this.model.get("available"));this.$el.attr("id",this.model.get("id")),this.$el.addClass(this.model.get("id")),this.$(".powerUpName").html(e.title),this.$(".powerUpTitle").html(e.description),this.$(".powerUpImageTextDisabled").html(t),this.$(".powerUpPrice").html(this.model.get("price")),this.listenTo(this.model,"change:selected",this.renderSelection),this.listenTo(this.model,"change:amount",this.renderAmount),this.listenTo(Game,"change:fullRunning",this.renderActive),this.render()},overPowerUp:function(e){$("#game").hasClass("forceNow")&&(!application.forcePowerUp||application.forcePowerUp!=this.model.get("id"))||Game.get("selectedPowerUp")&&Game.get("selectedPowerUp").get("id")!=this.model.get("id")||this.$el.addClass("hover")},outPowerUp:function(e){this.$el.removeClass("hover")},renderAvailable:function(){this.model.isAvailable()?this.$el.removeClass("disabled"):this.$el.addClass("disabled").removeClass("active"),this.$(".powerUpLevel").html(this.model.get("available"))},renderAmount:function(){if(this.model.isInfinityOnLevel())return this.$(".powerUpAmount").html(""),void this.$el.removeClass("powerUpAmountZero").removeClass("moreThanNine");var e=this.model.get("amount");this.$(".powerUpAmount").html(e),0<e?(this.$el.removeClass("powerUpAmountZero"),9<e?this.$el.addClass("moreThanNine"):this.$el.removeClass("moreThanNine")):this.$el.removeClass("moreThanNine").addClass("powerUpAmountZero")},renderActive:function(){Game.get("fullRunning")&&this.model.isAvailable()?this.$el.delay(500).queue(function(e){$(this).addClass("active"),e()}):this.$el.removeClass("active")},renderSelection:function(){this.model.get("selected")?this.$el.addClass("accentuation"):this.$el.removeClass("accentuation")},render:function(){return this.renderAvailable(),this.renderAmount(),this.renderActive(),this.renderSelection(),this},remove:function(){this.stopListening(),this.undelegateEvents(),Backbone.View.prototype.remove.call(this)},use:function(e){if(Game.isAnimationRunning())return!1;if(Game.get("fullRunning")||application.forcePowerUp===this.model.id){if(this.model.isAvailable())if(this.model.get("selected")){if(this.model.get("used"))return!1;this.model.unSelect()}else Game.unset("selected"),this.model.select(e);return!1}},unUse:function(e){if(this.model.get("selected")){if(this.$el.hasClass("inForce")||this.model.get("used"))return!1;if(e.originalEvent.changedTouches){for(var t=!0,i=this.$el.offset(),o=this.$el.width(),a=this.$el.height(),n=0;n<e.originalEvent.changedTouches.length;++n){var r=e.originalEvent.changedTouches[n];if(r.pageX>i.left&&r.pageX<i.left+o&&r.pageY>i.top&&r.pageY<i.top+a){t=!1;break}}if(t)return}this.model.unSelect()}}}),PowerUpsView=Backbone.View.extend({el:"#powerUps",initialize:function(){this.buttons=[],this.render()},render:function(){return this.collection.each(this.createButton,this),this},createButton:function(e){var t=new PowerUpButtonView({el:$(".invisible .powerUpButtonTpl").clone().removeClass("powerUpButtonTpl").appendTo(this.$el),model:e});this.buttons.push(t)},off:function(){this.stopListening(),this.undelegateEvents(),_.each(this.buttons,function(e){e.remove()})}}),TaskView=Backbone.View.extend({addListeners:function(){var i=this.$el.find(".taskCollectAmount");i.length&&(i.text(0),this.model.on("change:collectedAmount",canvas.timeManager.throttle(function(e,t){i.text(t)},200,{trailing:!0,leading:!1})));var o=this.$el.find(".taskAmount");o.length&&(o.text(this.model.get("amount")),this.model.on("change:amount",canvas.timeManager.throttle(function(e,t){o.html(t)},200,{trailing:!0,leading:!1})))},initialize:function(){var e=$(".invisible .task."+this.model.get("cssClass"));0===e.length&&(e=$(".invisible .task.noClass")),this.setElement(e.clone().addClass(this.model.get("cssClass")).removeClass("noClass")),this.model.set("beginAmount",this.model.get("amount")),this.$el.find(".taskNeedAmount").text(this.model.get("amount")),this.$el.find(".taskName").text(this.model.get("name")),this.addListeners(),this.model.on("change:completed",function(e,t){t&&(application.playSound("taskCompleted"),this.$el.addClass("complete"))},this),this.model.on("collectPart",function(e,t){this.$el.find(t).addClass("collected")},this);var t=this.model.get("taskName");t&&this.$el.find(".taskIco").addClass(t)}}),TasksView=Backbone.View.extend({el:"#tasks",initialize:function(e){this.tasks=e.tasks,this.$el.empty(),this.tasks.each(function(e){var t=new TaskView({model:e});this.$el.append(t.$el),e.$div=t.$el,e.precalc()},this),this.listenTo(Game,"beforeWin",this.onBeforeWin)},onBeforeWin:function(){var e=Game.animate();this.tasks.each(_.bind(function(e,t){e.$div.delay(500*t).queue(function(e){application.playSound("showTask"),e()}).ourAnimate({scale:1.5},250).ourAnimate({scale:1},250)},this)),setTimeout(e,500*this.tasks.length)},off:function(){this.stopListening(),this.tasks.each(function(e){e.off()})},stringValue:function(e){return e<1e3?e:Math.floor(e/1e3)+"k"}}),TimerView=Backbone.View.extend({initialize:function(){var e=this;this.timeout=setInterval(function(){return e.updateTimer(e.model.getTimer())},1e3),this.updateTimer(this.model.getTimer())},remove:function(){Backbone.View.prototype.remove.call(this),clearInterval(this.timeout)},updateTimer:function(e){var t;this._lastTime!=e&&(t=formatTime(86400<=(this._lastTime=e)?"%j"+messages.bonusWorldLeftTime[2]+"%G"+messages.bonusWorldLeftTime[0]:3600<=e?"%H:%i:%s":"%i:%s",e),this.$el.toggleClass("active",0<e),this.$(".timer").html(t))}}),BigMapControllerFactory={create:function(e){return window.mobile?new BigMapMobileController(e):new BigMapSocialController(e)}},BigMapController=Backbone.View.extend({initialize:function(e){this.bgImage=$(e.bgEl),this.isInertiaActive=!!_.isUndefined(e.isInertiaActive)||e.isInertiaActive,this.mainElement=$(e.mainEl),this.scale=e.startScale||1,this.MAX_SCALE=e.maxScale||1,this.INERTIA_TRANSFORM_TIME=e.inertiaTime||.4,this.TRANSFORM_TIME=e.transformTime||.6,this.bgImage.css({transformOrigin:"0px 0px"}),this.currentZoom={},this.translateX=0,this.translateY=0,this.dx=0,this.dy=0,_.extend(this,Backbone.Events)},restrictTransition:function(){0<this.translateX&&(this.translateX=0),0<this.translateY&&(this.translateY=0);var e=this.$el.width()-this.bgImage.width()+this.bgImage.width()*(1-this.scale);Math.abs(this.translateX)>Math.abs(e)&&(this.translateX=e);var t=this.$el.height()-this.bgImage.height()+this.bgImage.height()*(1-this.scale);Math.abs(this.translateY)>Math.abs(t)&&(this.translateY=t),this.trigger("transition",this)},turnOffTransition:function(){return this.bgImage.css({transition:"none"}),Promise.resolve()},updateDeltaPos:function(){this.dx=this.translateX,this.dy=this.translateY},restrictScale:function(){var e=Math.max(this.$el.width()/this.bgImage.width(),this.$el.height()/this.bgImage.height());this.scale<e&&(this.scale=e),this.scale>this.MAX_SCALE&&(this.scale=this.MAX_SCALE)},addInertia:function(){},moveBG:function(){},focusMainElement:function(e,t){var i=this.findMainElementCoord();return this.focusElement(i,e,t)},focusElement:function(e,t,i){i=i||1;e||(e=this.findMainElementCoord());var o=this.findCenterOfPage(),a=t?this.turnOffTransition():this.turnOnTransition();return this.centering(e,o,i),a},scrollTo:function(e,t){var i=$(e).offset(),o=this.bgImage.offset(),a={x:i.left-o.left,y:i.top-o.top};return this.focusElement(a,t)},turnOnTransition:function(){this.bgImage.css({transition:"transform "+this.TRANSFORM_TIME+"s ease-in-out"});var t=this;return new Promise(function(e){setTimeout(e,1e3*t.TRANSFORM_TIME)})},findMainElementCoord:function(){var e=this.mainElement.offset(),t=this.bgImage.offset();return{x:e.left-t.left,y:e.top-t.top}},findCenterOfPage:function(){return{x:this.$el.width()/2,y:this.$el.height()/2}},findBGCoord:function(e,t){return{x:(e-this.translateX)/this.scale,y:(t-this.translateY)/this.scale}},centering:function(e,t,i){this.scale=i||this.scale;var o=-e.x*this.scale+t.x,a=-e.y*this.scale+t.y;this.translateX=o,this.translateY=a,this.restrictTransition(),this.updateDeltaPos(),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)),this.trigger("transition",this)}});function Scroller(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{x:.5,y:.5};this._scroll=e,this._duration=t,this._anchor=i}Scroller.prototype.scrollTo=function(a,e){var n=this;return new Promise(function(e){var t=$(a).offset(),i=$(n._scroll),o=i.offset();i.animate({scrollTop:t.top-o.top-i.height()*n._anchor.y+i.scrollTop()},n._duration,e)})};var BigMapSocialController=BigMapController.extend({initialize:function(e){BigMapController.prototype.initialize.call(this,e),this.KEY_SPEED_UP=e.keySpeedUp||7,this.KEY_INTERVAL_TIME=e.keyIntervalTime||20,this.SCALE_DIFF_VALUE=e.scaleDiff||.05,this.INERTIA_DISTANCE_COEFF=.3,this.MIN_SPEED_FOR_INERTIA=2,this.canMove=!1,this.wasMoveAction=!1,this.startPointX=0,this.timeEnd=0,this.timeStart=0,this.scaleDelta=0,this.subscribeEvents()},subscribeEvents:function(){this.scrollEnabled=!0,this.$el.on("mousedown",this,this.onMouseDown),$("body").on("keydown",this,this.onKeyDown),this.$el.on("mousemove ",this,this.onMouseMove),this.$el.on("mouseup mouseleave",this,this.onMouseUpMouseLeave),this.crossBrowserWheel()},removeEventsSubscription:function(){this.scrollEnabled=!1,this.$el.off("mousedown",this.onMouseDown),$("body").off("keydown",this.onKeyDown),this.$el.off("mousemove ",this.onMouseMove),this.$el.off("mouseup mouseleave",this.onMouseUpMouseLeave),this.disableCrossBrowserWheel()},onMouseDown:function(e){var t=e.data;e.preventDefault(),t.mouseDownHandler(e)},onKeyDown:function(e){e.data.keydownHandler(e)},onMouseMove:function(e){var t=e.data;e.preventDefault(),t.mouseMoveHandler(e)},onMouseUpMouseLeave:function(e){e.data.mouseUpHandler()},focusMainElement:function(e){this.wasMoveAction=!0;return BigMapController.prototype.focusMainElement.call(this,e,1)},focusElement:function(e,t){this.wasMoveAction=!0;return BigMapController.prototype.focusElement.call(this,e,t,1)},crossBrowserWheel:function(){"onwheel"in window?this.onWheel("wheel"):"onmousewheel"in window?this.onWheel("mousewheel"):this.onWheel("MozMousePixelScroll")},disableCrossBrowserWheel:function(){"onwheel"in window?this.offWheel("wheel"):"onmousewheel"in window?this.offWheel("mousewheel"):this.offWheel("MozMousePixelScroll")},onWheel:function(e){var t=this;this.wheelAction=function(e){e.preventDefault(),t.mouseWheelHandler(e)},this.$el[0].addEventListener(e,this.wheelAction)},offWheel:function(e){this.wheelAction&&this.$el[0].removeEventListener(e,this.wheelAction)},mouseWheelHandler:function(e){var t=this.getMouseWheelDelta(e);this.changeScale(t)},getMouseWheelDelta:function(e){var t=e.deltaY||e.detail||e.wheelDelta;return(t=-Math.max(-1,Math.min(1,t)))*this.SCALE_DIFF_VALUE},getCurrentZoommCoord:function(e){if(this.scaleDelta!==e||this.wasMoveAction){var t=this.findCenterOfPage();this.currentZoom=this.findBGCoord(t.x,t.y)}},addInertia:function(){if(!this.isInertiaActive)return!1;var e=this.INERTIA_DISTANCE_COEFF*Math.min(this.$el.width(),this.$el.height()),t=this.MIN_SPEED_FOR_INERTIA/this.scale;(Math.abs(this.velocityX)>t||Math.abs(this.velocityY)>t)&&(this.translateX+=this.velocityX*e,this.translateY+=this.velocityY*e,this.restrictTransition(),this.bgImage.css({transition:"transform "+this.INERTIA_TRANSFORM_TIME+"s ease"}),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)))},changeScale:function(e){this.turnOffTransition(),this.getCurrentZoommCoord(e),this.scale+=e,this.restrictScale();var t=this.findCenterOfPage();this.centering(this.currentZoom,t),this.scaleDelta=e,this.wasMoveAction=!1},mouseUpHandler:function(){this.timeEnd=Date.now();var e=this.timeEnd-this.timeStart;this.canMove=!1,!e||0===this.distX&&0===this.distY||(this.findOutVelocity(e),this.addInertia(),this.skipDist(),this.updateDeltaPos())},mouseDownHandler:function(e){var t=this.getCoord(e);this.timeStart=Date.now(),this.canMove=!0,this.startPointX=t.x,this.startPointY=t.y,this.turnOffTransition()},mouseMoveHandler:function(e){if(this.canMove){this.wasMoveAction=!0;var t=this.getCoord(e),i=this.startPointX-t.x,o=this.startPointY-t.y;this.moveBG(i,o)}},getCoord:function(e){return{x:e.pageX-this.$el.offset().left,y:e.pageY-this.$el.offset().top}},findOutVelocity:function(e){this.velocityX=-this.distX/e,this.velocityY=-this.distY/e},moveBG:function(e,t){this.translateX=this.dx-e,this.translateY=this.dy-t,this.distX=this.dx-this.translateX,this.distY=this.dy-this.translateY,this.restrictTransition(),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)),this.trigger("transition",this)},skipDist:function(){this.distX=0,this.distY=0},keydownHandler:function(e){var t=e.which,i=-1<_.indexOf([38,40,37,39],t);if(!!i&&"INPUT"!==e.target.tagName&&e.preventDefault(),!this.isBtnPressed&&i){this.isBtnPressed=!0;var o=setInterval(_.bind(function(){this.keydown(t)},this),this.KEY_INTERVAL_TIME);$("body").one("keyup",_.bind(function(){this.isBtnPressed=!1,clearTimeout(o)},this))}},keydown:function(e){switch(e){case 38:this.top();break;case 40:this.bottom();break;case 37:this.left();break;case 39:this.right()}this.moveBgByControls()},top:function(){this.translateY+=this.KEY_SPEED_UP},bottom:function(){this.translateY-=this.KEY_SPEED_UP},left:function(){this.translateX+=this.KEY_SPEED_UP},right:function(){this.translateX-=this.KEY_SPEED_UP},isTop:function(){return this.translateY<0},isBottom:function(){var e=this.$el.height()-this.bgImage.height()+this.bgImage.height()*(1-this.scale);return!(Math.abs(this.translateY)>=Math.abs(e))},isLeft:function(){return this.translateX<0},isRight:function(){var e=this.$el.width()-this.bgImage.width()+this.bgImage.width()*(1-this.scale);return!(Math.abs(this.translateX)>=Math.abs(e))},restrictTransition:function(){0<this.translateX&&(this.translateX=0),0<this.translateY&&(this.translateY=0);var e=this.$el.width()-this.bgImage.width()+this.bgImage.width()*(1-this.scale);Math.abs(this.translateX)>Math.abs(e)&&(this.translateX=e);var t=this.$el.height()-this.bgImage.height()+this.bgImage.height()*(1-this.scale);Math.abs(this.translateY)>Math.abs(t)&&(this.translateY=t)},moveBgByControls:function(){this.turnOffTransition(),this.restrictTransition(),this.updateDeltaPos(),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale))}}),LoopedBigMapController=BigMapSocialController.extend({initialize:function(e){BigMapSocialController.prototype.initialize.call(this,e),this.viewWidth=this.$el.width(),this.world=e.world},onEnter:function(){var e=this;this.container1Elements=[],this.container2Elements=[],this.world.on("completeLevel",this.updateClonedContainer,this),episode.once("episodeLoaded",function(){setTimeout(function(){e.container1Elements.push(e.bgImage.children(".background")),e.container1Elements.push(e.bgImage.children(".levels")),e.container1Elements.push(e.bgImage.children(".bonusWorldPrizes")),e.containerWidth=e.container1Elements[0].width(),e.updateClonedContainer()},100)})},onExit:function(){this.container1Elements.forEach(function(e){e.css("left",0)}),this.container2Elements.forEach(function(e){e.remove()}),this.container1Elements=null,this.container2Elements=null,this.world.off("completeLevel",this.updateClonedContainer)},moveChilds:function(t){var i=this;if(this.container1Elements&&this.container1Elements[0]&&this.container2Elements&&this.container2Elements[0]&&0!=t){var e=_slicedToArray(this.getOrderedContainers(),2),o=e[0],a=e[1],n=parseInt(o[0].css("left")),r=parseInt(a[0].css("left"));if(0<n+t){a.forEach(function(e){e.css("left",parseInt(e.css("left"))-2*i.containerWidth+"px")});var s=[a,o];o=s[0],a=s[1]}else if(r+t+this.containerWidth+this.translateX<this.viewWidth){o.forEach(function(e){e.css("left",parseInt(e.css("left"))+2*i.containerWidth+"px")});var l=[a,o];o=l[0],a=l[1]}o.forEach(function(e){e.css("left",parseInt(e.css("left"))+t+"px")}),a.forEach(function(e){e.css("left",parseInt(e.css("left"))+t+"px")})}},mouseDownHandler:function(e){this.prevX=0,BigMapSocialController.prototype.mouseDownHandler.call(this,e)},moveBG:function(e,t){var i=e-this.prevX;this.startTranslateX=this.translateX,BigMapSocialController.prototype.moveBG.call(this,e,t);var o=i-(this.startTranslateX-this.translateX);this.moveChilds(-o),this.prevX=e},getOrderedContainers:function(){return parseInt(this.container1Elements[0].css("left"))>parseInt(this.container2Elements[0].css("left"))?[this.container2Elements,this.container1Elements]:[this.container1Elements,this.container2Elements]},updateClonedContainer:function(){var o=this;this.container2Elements.forEach(function(e){e.remove()}),this.container2Elements=[],this.container1Elements.forEach(function(e){var t=e.clone();o.container2Elements.push(t),o.bgImage.append(t);var i=0<parseInt(e.css("left"))?-o.containerWidth:o.containerWidth;t.css("left",parseInt(e.css("left"))+i+"px")})},moveBgByControls:function(){var e=this.translateX;this.turnOffTransition(),this.restrictTransition(),this.updateDeltaPos();var t=e-this.translateX;this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)),this.moveChilds(t)}}),CloudAnimationView=Backbone.View.extend({el:".scrolledBlock",initialize:function(e){this.world=e.world,this.$clouds=this.$(".cloud"),episode.on("change:num",this.hideClouds,this),this.world.on("onCompleteLevel",this.animateClouds,this)},hideClouds:function(){var i=this;episode.get("num")===this.world.name&&setTimeout(function(){i.$clouds.each(function(e,t){$(this).data("level")<i.world.getCurrentLevel()&&$(this).addClass("hide")})},1)},animateClouds:function(e,o){var t=this;return application.waitPage("main").then(function(){return new Promise(function(i){t.$clouds.each(function(e,t){$(this).data("level")===o&&$(this).queue(function(e){$(this).addClass("animate").addClass("hide"),e()}).delay(1e3).queue(function(e){$(this).removeClass("animate"),i(),e()})})})})}}),BaseCogentWindow=TWindow.extend({templateClass:".triesReminderWindow_template",onOpenSound:"losegame",exitGameOnCancel:!0,events:{"click .reminderBuy":"buy","click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$(".outOfMovesMoves").html(Config.outOfMoves.moves),this.$(".outOfMovesPrice").html(Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves")),Game.set("fullRunning",!1),Config.outOfMoves.product&&(this.$(".outOfMovesPrice").html(Number(prices[Config.outOfMoves.product].desc.price)),this.$(".inlineCoinBuy").remove())},onBuyMoves:function(e,t){Game.set({moves:new ObscureNumber(e),fullRunning:!0,buyedMoves:Game.get("buyedMoves")+t}),Game.trigger("addMoves"),application.playSound("buyMoves"),!episode.isBonusWorld()&&Config.outOfMovesPrize&&2==Game.get("buyedMoves")&&("starInField"==Config.outOfMovesPrize?gameView.processStarInField(!0):(user.setPowerUpAmount(Config.outOfMovesPrize,user.getPowerUpAmount(Config.outOfMovesPrize)+1,!0),user.set({powerUps:user.calcPowerUps()})))},buy:function(){Config.outOfMoves.product?showBuy(prices[Config.outOfMoves.product]):(TWindow.prototype.close.call(this),user.set({coins:new ObscureNumber(user.get("coins")-Math.abs(Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves"))),actionName:"add moves"+(Game.get("buyedMoves")?Game.get("buyedMoves"):""),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves")},{validate:!0})?this.onBuyMoves(Config.outOfMoves.moves,1):new this.constructor(this.options))},close:function(){this.exitGameOnCancel&&Game.exit(),this.trigger("cancel"),TWindow.prototype.close.call(this)}}),ContinuityCogentWindow=BaseCogentWindow.extend({onOpen:function(){BaseCogentWindow.prototype.onOpen.call(this);var e=this.$el.find(".invisible .continuityStage"),t=this.$el.find(".itemsWrapper"),i=e.clone();i.addClass("stage"+this.options.stage),i.appendTo(t)}}),CollectorsCogentWindow=BaseCogentWindow.extend({onOpen:function(){var i=this;BaseCogentWindow.prototype.onOpen.call(this),this.options.component.getActiveCollected().forEach(function(e){var t=e.getCollectedAmount();if(t&&!(t<=0)){if("artifactPart"===e.get("collectableType"))e.createCollectableView(i.options.component.getCollectableByType(e.get("collectableType"))).appendTo(i.$("artifact"));"prizePoints"===e.get("collectableType")&&i.$(".numberOfPoints").html(t)}})}}),LivesCogentWindow=BaseCogentWindow.extend({templateClass:".livesCogentWindow_template",onOpen:function(){BaseCogentWindow.prototype.onOpen.call(this),this.$(".windowSmallTitle").html(messages[Config.bonusWorld.get("name")+"PersuadeBuyMovesWindow"].title)}}),BonusLevelTaskView=Backbone.View.extend({el:"#bonusLevelTask",initialize:function(){this.taskNeed=this.model.get("amount"),this.$(".taskNeed").html(this.taskNeed),this.$(".taskAmount").html(0),this.$(".taskProgress").css("width","0%"),this.model.$div=this.$(".taskAmount"),this.model.on("change:amount",function(e,t){this.$(".taskAmount").html(this.taskNeed-t),this.$(".taskProgress").css("width",Math.floor(100*(this.taskNeed-t)/this.taskNeed)+"%"),this.$(".taskProgress").css("width")&&this.$(".taskProgress").css("min-width","25px")},this),this.model.on("collect",this.animateCollect,this),this.$monster=FigureView.createByTemplate(".invisible .bonusLevelMonster").appendTo(canvas.layer)},off:function(){this.model.off()},animateCollect:function(e){var t;if((t=Game.get("crystalsOnField")?e.$div.find(".attribute_crystal"):e.$div.find(".bigCrystal")).length){var i=_Figure.field.offset(),o=t.offset(),a=this.$monster.find(".monsterCollectPoint").offset(),n=this.$monster.find(".monsterCollectPoint2").offset(),r=t.clone(),s=Game.animate();r.set({y:o.top-i.top,x:o.left-i.left}),_Figure.field.append(r);var l=o.top-a.top,d=o.left-a.left,c=2*Math.sqrt(l*l+d*d);c<300&&(c=300);var g=this.$monster,u=c+100;canvas.timeManager.setTimeout(function(){g.addClass("openMouth"),Game.get("monsterCloseMouthTimeout")||Game.set("monsterCloseMouthTimeout",canvas.timeManager.setTimeout(function(){Game.set("monsterCloseMouthTimeout",!1),g.removeClass("openMouth")},1200))},u);var h=_.bind(r.remove,r);r.ourAnimate({scale:1.2},300).queue(function(e){s(),e()}).ourAnimate({x:a.left-i.left,y:a.top-i.top,scale:1},c,"linear",function(){application.playSound("collectCrystalsTick")}).ourAnimate({x:n.left-i.left,y:n.top-i.top},250,"linear",h)}},animateWin:function(e){window.mobile&&(e(),e=_.noop),this.$monster.ourAnimate({x:canvas.width+this.$monster.width()},800,"linear",e)}});Config.bonusLevelTaskOnCanvasEnabled&&(BonusLevelTaskView=Backbone.View.extend({initialize:function(){var a=this.taskNeed=this.model.get("amount");this.figure=FigureView.createByTemplate(".invisible .bonusLevelTaskView");this.figure.find(".taskNeed").html(a);var n=this.figure.find(".taskAmount").html(0),r=this.figure.find(".taskProgress");FigureView.findById("layer").append(this.figure),this.model.on("change:amount",function(e,t){var i=a-t,o=i/a;1<o&&(o=1),n.html(i),r.attrs.width=Math.floor(o*r.parent().width())}),this.closeMonsterMouthTimeout=!1,this.model.on("collect",this.animateCollect,this),$("#bonusLevelTask").hide(),$("#bonusLevelMonster").hide(),$("#bonusLevelPrizes").hide()},off:function(){this.model.off()},animateCollect:function(e){var t;if((t=Game.get("crystalsOnField")?e.$div.find(".attribute_crystal"):e.$div.find(".bigCrystal")).length){var i=this.figure.find(".monsterCollectPoint"),o=this.figure.find(".monsterCollectPoint2"),a=t.clone();_Figure.blockedAnimations.append(a),a.alignTo(t);var n=t.offset(),r=i.offset(),s=n.top-r.top,l=n.left-r.left,d=2*Math.sqrt(s*s+l*l);d<300&&(d=300);var c=d+300;canvas.timeManager.setTimeout(_.bind(this.closeMonsterMouth,this),c-600);var g=_.bind(a.remove,a);a.ourAnimate({scale:1.2},300).ourAnimate({target:i},d,"linear",function(){application.playSound("collectCrystalsTick")}).ourAnimate({target:o},250,"linear",g)}},animateWin:function(e){if(window.mobile)e();else{var t=this.figure.find(".bonusLevelMonster"),i=_.bind(this.animatePrize,this,e);t.animationByName("bonusLevelMonsterOut").queue(function(e){t.remove(),e(),i()})}},animatePrize:function(t){var i=this.figure.find(".bonusLevelPrizes");i.animationByName("bonusLevelPrizeFly").queue(function(e){i.addClass("bonusLevelPrizeBig"),application.playSound("bonusLevelPrizeOpen"),e()}).animationByName("bonusLevelPrizeOpen").queue(function(e){i.addClass("bonusLevelPrizeOpen"),e()}).delay(700).queue(function(e){e(),t()})},closeMonsterMouth:function(){var e=this.figure.find(".bonusLevelMonster").addClass("openMouth");!1!==this.closeMonsterMouthTimeout&&canvas.timeManager.clearTimeout(this.closeMonsterMouthTimeout),this.closeMonsterMouthTimeout=canvas.timeManager.setTimeout(_.bind(function(){this.closeMonsterMouthTimeout=!1,e.removeClass("openMouth")},this),950)}}));var SlidePowerUpsView=PowerUpView.extend({getCell:function(e){e.originalEvent&&e.originalEvent.touches&&(e=e.originalEvent.touches[0]);var t=this.$el.offset(),i=e.pageX>=t.left&&e.pageX<=t.left+this.elWidth&&e.pageY>=t.top&&e.pageY<=t.top+this.elHeight;return!this.inForce&&i?(this.$el.addClass("cancel"),this.cursorOnPowerUp=!0):(this.$el.removeClass("cancel"),this.cursorOnPowerUp=!1),gameView.getCell(e)},getClassesCursor:function(){return[]},getModelPowerUpCursor:function(){var e=FigureView.createByTemplate(".invisible .cursorTemplate",["powerUpCursor"].concat(this.getClassesCursor()));return canvas.layer.append(e),e},initialize:function(e){PowerUpView.prototype.initialize.call(this),this.model.powerUpCursor=this.getModelPowerUpCursor().hide(),_.bindAll(this,"onMoveCursor"),this.elWidth=parseInt(this.$el.css("width")),this.elHeight=parseInt(this.$el.css("height")),this.inForce=this.$el.hasClass("inForce"),this.cursorOnPowerUp=!this.inForce,this.wasMouseMove=!1,window.mobile||(canvas.canvas_c.style.cursor="none",$(".powerUp .hover").css("cursor","none")),$(".wrapper").on("mousemove.powerupcontrol touchmove.powerupcontrol touchstart.powerupcontrol",this.onMoveCursor),e.startEvent&&this.onMoveCursor(e.startEvent)},onMoveCursor:function(e){this.wasMouseMove=!0,this.updateCell(e),e.originalEvent&&e.originalEvent.touches&&(e=e.originalEvent.touches[0]),this.model.powerUpCursor.alignTo({left:e.pageX,top:e.pageY}).show()},close:function(){window.mobile||($(".powerUp .hover").css("cursor","pointer"),canvas.canvas_c.style.cursor="default"),this.$el.removeClass("cancel"),$(".wrapper").off(".powerupcontrol"),this.model.powerUpCursor&&this.model.powerUpCursor.remove(),PowerUpView.prototype.close.call(this)}}),DeleteColumn=PowerUp.extend({defaults:{view:"DeleteColumnView",column:!1,cell:!1},execute:function(){var e=[],t=_.uniqueId("arrow");application.playSound("deleteColumnExecution");for(var i=0;i<Config.rows;i++){var o=Game.field[i][this.get("column")];o&&(o instanceof Cell&&(this.get("cell").showPointsOnRemove+=GameScores.cell),e.push(o))}ArrowCell.prototype.animateSingle.call(this.get("cell"),"vertical",_.bind(function(){this.set("column",!1)},this)),_.each(e,function(e){e.removeByArrow&&e.removeByArrow(t),e.removeWithPowerUpDeleteColumn=t,e.removeById(t)})}}),DeleteColumnView=SlidePowerUpsView.extend({updateCell:function(e){var t=this.getCell(e);t&&(t.isRemovable()||t.decorator||t.removeByArrow||(t=!1)),!1!==t?this.model.set({cell:t,column:t.x}):this.model.set({cell:!1,column:!1})},getClassesCursor:function(){return["cursorLighting"]},initialize:function(e){SlidePowerUpsView.prototype.initialize.call(this,e),$(".wrapper").on("mousedown.powerupcontrol touchend.powerupcontrol mouseup.powerupcontrol",_.bind(function(){return this.cursorOnPowerUp?this.wasMouseMove&&this.unUse():(this.wasMouseMove=!0,!1!==this.model.get("column")&&(this.model.set("used",!0),this.animate())),!1},this)),this.listenTo(this.model,"change:column",this.onChangeColumn)},onChangeColumn:function(e,t){if(!1!==this.model.previous("column")&&Game.each(function(e){e.highlight(!0)}),!1!==t)for(var i=0;i<Config.rows;i++)Game.field[i][t]&&(Game.field[i][t].isRemovable()||Game.field[i][t].removeByArrow)&&Game.field[i][t].highlight()},animate:function(){Game.each(function(e){e.highlight(!0)}),this.run()}}),DeleteRow=PowerUp.extend({defaults:{view:"DeleteRowView",row:!1,cell:!1},execute:function(){application.playSound("deleteRowExecution"),ArrowCell.prototype.animateSingle.call(this.get("cell"),"horizontal",_.bind(function(){var e,t=_.uniqueId("arrow");for(e=0;e<Config.rows;e++)Game.field[this.get("row")][e]&&Game.field[this.get("row")][e]instanceof Cell&&(this.get("cell").showPointsOnRemove+=GameScores.cell);for(e=0;e<Config.rows;e++){var i=Game.field[this.get("row")][e];i&&(i.removeByArrow&&i.removeByArrow(t),i.removeWithPowerUpDeleteColumn=t,i.removeById(t))}this.set("row",!1)},this))}}),DeleteRowView=SlidePowerUpsView.extend({updateCell:function(e){var t=this.getCell(e);t&&(t.isRemovable()||t.decorator||t.removeByArrow||(t=!1)),!1!==t?this.model.set({cell:t,row:t.y}):this.model.set({cell:!1,row:!1})},getClassesCursor:function(){return["cursorDeleteRowPowerUp"]},initialize:function(e){SlidePowerUpsView.prototype.initialize.call(this,e),$(".wrapper").on("mousedown.powerupcontrol touchend.powerupcontrol mouseup.powerupcontrol",_.bind(function(){return this.cursorOnPowerUp?this.wasMouseMove&&this.unUse():(this.wasMouseMove=!0,!1!==this.model.get("row")&&(this.model.set("used",!0),this.animate())),!1},this)),this.listenTo(this.model,"change:row",this.onChangeRow)},onChangeRow:function(e,t){if(!1!==this.model.previous("row")&&this.resetHighlighting(),!1!==t)for(var i=0;i<Config.rows;i++)Game.field[t][i]&&(Game.field[t][i].isRemovable()||Game.field[t][i].removeByArrow)&&Game.field[t][i].highlight()},resetHighlighting:function(){Game.each(function(e){e.highlight(!0)})},animate:function(){this.resetHighlighting(),this.run()}}),DeleteCell=PowerUp.extend({defaults:{view:"DeleteCellView",cell:!1},getHummerParent:function(){return _Figure.blockedAnimations},createHummer:function(){var e=FigureView.createByTemplate(".invisible .hammerTemplate");return this.getHummerParent().append(e),e.alignTo(this.get("cell").$div),e},animateExecution:function(e,t){canvas.timeManager.setTimeout(function(){application.playSound("deleteCellExecution")},400),canvas.timeManager.setTimeout(_.bind(function(){e.remove(),t()},this),500)},execute:function(){this.get("cell").removeWithPowerUp=!0,this.get("cell")instanceof Cell&&(this.get("cell").showPointsOnRemove+=GameScores.cell);var e=this.createHummer();this.animateExecution(e,Game.animate(function(){Game.trigger("beforeRemovedItem",this.get("cell")),this.get("cell").remove()},this))}}),DeleteCellBaseView=SlidePowerUpsView.extend({updateCell:function(e){var t=this.getCell(e);t&&(t.isRemovable()||t.decorator||(t=!1)),this.model.set("cell",t)},getAjust:function(){},getClassesCursor:function(){return["cursorHammer"]},initialize:function(e){SlidePowerUpsView.prototype.initialize.call(this,e),$(".wrapper").on("mousedown.powerupcontrol touchend.powerupcontrol mouseup.powerupcontrol",_.bind(function(){if(this.cursorOnPowerUp)return this.wasMouseMove&&this.unUse(),!1;if(this.wasMouseMove=!0,!1!==this.model.get("cell")){this.model.set("used",!0),$(".wrapper").off(".powerupcontrol");var e=_.bind(function(){Game.each(function(e){e.highlight(!0)}),this.run()},this);window.mobile?e():this.model.powerUpCursor.ourAnimate({target:this.model.get("cell").$div,ajust:this.getAjust()},100,"linear",e)}return!1},this)),this.model.on("change:cell",function(e,t){!1!==this.model.previous("cell")&&Game.each(function(e){e.highlight(!0)}),!1!==t&&t.highlight()},this)}}),DeleteCellView=DeleteCellBaseView.extend({updateCell:function(e){var t=this.getCell(e);t&&(!t.isRemovable()&&!t.decorator||t instanceof BulbCell||t.decorator&&!t.decorator.isRemovable())&&(t=!1),this.model.set("cell",t)},getAjust:function(){return{x:31,y:14}}}),Shuffle=PowerUp.extend({defaults:{view:"ShuffleView"},silent:!0,execute:function(){Game.shuffleField(!0)}}),ShuffleView=PowerUpView.extend({initialize:function(){PowerUpView.prototype.initialize.call(this),this.model.set("used",!0),Game.trigger("showMessage",messages.shuffle,"shuffleMessage");var e=Game.animate();canvas.timeManager.setTimeout(_.bind(function(){this.run(),e()},this),1400)}}),FpsCounter=function(){var a,n,r,s,l,d,c,g,u,h,p=[];function m(){return window.performance&&window.performance.now&&window.performance.now()||_.now()}return{start:function(){u=m(),h=!1},getStats:function(){return{fpsMiddle:Math.round(d/(l/1e3)),fpsMinMiddle:Math.round(c/(l/1e3)),fpsMinAbsolute:Math.round(r),counters:p.slice(),getPercentile:function(e){var t,i=0;for(t=0;t<this.counters.length;t++)i+=this.counters[t]||0;var o=Math.round(i*e/100),a=0;for(t=0;t<this.counters.length;t++)if(a<o&&(a+=this.counters[t]||0),o<=a)return t/10;return(this.counters.length-1)/10}}},createDiv:function(){},onPaint:function(){var e=m();if(!(e-u<100)){if(!h)return s=r=60,c=n=l=d=0,a=m(),g=m(),p=[],void(h=!0);var t=e-a,i=60*t/1e3;n=1e3/t;var o=Math.min(600,Math.max(0,Math.round(10*n)));p[o]=(p[o]||0)+i,l+=e-a,n<r&&(r=n),n<s&&(s=n),d++,g+1e3<(a=e)&&(c+=s,s=60,g+=1e3)}}}};function myExtend(e,t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])}var _Figure=function(){this.length=1,this.id=void 0,this._cache=null,this.animationQueue=[],this.classes={},this.children=void 0,this._indexInParent=void 0,this._parent=void 0,this.events=void 0,this.model={x:void 0,y:void 0,opacity:void 0,rotate:void 0,scale:void 0,duration:void 0},this.classChanged=!0,this.modelChanged=!0,this.attrs={};for(var e=_Figure.ATTRS_FIELDS.length-1;0<=e;e--){var t=_Figure.ATTRS_FIELDS[e];this.attrs[t]=_Figure.defaults[t]}this.sprite=void 0,this.baseValues=void 0,this.deltaValues=void 0,this.ruleAnimation=void 0};_Figure.extend=Backbone.Model.extend,_.extend(_Figure.prototype,{_getClassName:function(){return"Figure"},_cleanUpChildren:function(){if(this.children){for(var e=[],t=0;t<this.children.length;t++){var i=this.children[t];i&&(i._indexInParent=e.push(i)-1)}this.children=e}},removeChildren:function(e){this.children&&void 0!==e._indexInParent&&(this.children[e._indexInParent]=null,e._indexInParent=void 0,e._parent=null,80<this.children.length&&this._cleanUpChildren())},forEachChildren:function(e){if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i&&e(i))return}},set:function(e,t){if(void 0!==t)this.model[e]=t;else for(var i in e)this.model[i]=e[i];return this.modelChanged=!0,this},get:function(e){return this.model[e]},hide:function(){return this.set("opacity",0),this},show:function(){return this.set("opacity",1),this},sort:function(e){if(this.children){this.children=this.children.filter(function(e){return e}),this.children.sort(e);for(var t=0;t<this.children.length;++t)this.children[t]._indexInParent=t}},append:function(e){if(0!==e.length)return void 0===this.children&&(this.children=[]),e._indexInParent=this.children.push(e)-1,e._parent=this},appendTo:function(e){return e.append(this),this},alignTo:function(e,t){var i=_.isNumber(e.left)?e:e.offset(),o=this._parent.offset(),a={x:0,y:0};return t&&t.ajust&&(a=t.ajust),this.set({x:i.left-o.left+a.x,y:i.top-o.top+a.y}),this},distanceTo:function(e){var t=this.offset(),i=e.offset();return Math.sqrt((t.left-i.left)*(t.left-i.left)+(t.top-i.top)*(t.top-i.top))},clone:function(){var e,t=this.createClone();if(t.id=this.id,this.children)for(e=0;e<this.children.length;e++)this.children[e]&&t.append(this.children[e].clone());for(var i in t.classes={},this.classes)t.classes[i]=!0;if(this.sprite&&(t.sprite=this.sprite.clone()),this.ruleAnimation&&(t.ruleAnimation=this.ruleAnimation.clone()),t.model.x=this.model.x,t.model.y=this.model.y,t.model.opacity=this.model.opacity,t.model.rotate=this.model.rotate,t.model.scale=this.model.scale,t.model.duration=this.model.duration,!1===this.classChanged){for(e=_Figure.ATTRS_FIELDS.length-1;0<=e;e--){var o=_Figure.ATTRS_FIELDS[e];t.attrs[o]=this.attrs[o]}t.classChanged=!1}else t.classChanged=!0;return t},createClone:function(){return new _Figure},parent:function(){return this._parent},html:function(e){throw new Error("use span instead div with "+(this.id?"id "+this.id+" and ":"")+(_.keys(this.classes).length?"classes "+_.keys(this.classes).join(", "):""))},empty:function(){if(!this.children)return this;for(var e=0;e<this.children.length;e++)this.children[e]&&this.children[e].remove();return this.children=void 0,this},_find:function(e){if(this.classes[e])return this;if(!this.children)return!1;for(var t=0;t<this.children.length;t++)if(this.children[t]){var i=this.children[t]._find(e);if(i)return i}return!1},find:function(e){for(var t=this,i=e.split(" "),o=0;t&&o<i.length;++o)t=t._find(i[o].substr(1));return t&&t!=this?t:new EmptyFigure},findAll:function(e){var o=[],a=e.substr(1);return function e(t){if(t.classes[a])o.push(t);else if(t.children)for(var i=0;i<t.children.length;i++)t.children[i]&&e(t.children[i])}(this),o},onRemove:function(e){this.events?this.events.push(e):this.events=[e]},remove:function(){if(0!==this.length){if(this.length=0,this.events)for(var e=0;e<this.events.length;e++)this.events[e].call();this.empty(),this.clearQueue(),this.removeSprite(),this.ruleAnimation&&this.ruleAnimation.destructor(),this.removeAllClasses(),this._parent&&this._parent.removeChildren(this)}},removeSprite:function(){this.sprite&&(this.sprite.destructor(),this.sprite=void 0,this.attrs.backgroundXOffset=0,this.attrs.backgroundYOffset=0)},animationByName:function(e){if(!FigureAnimations[e])return this;var t=FigureAnimations[e];_.isArray(t)||(t=[t]);for(var i=0;i<t.length;++i){var o=t[i];o.delay&&this.delay(o.delay),this.addAnimation({isFigureAnimation:!0,name:e,params:o.params,options:{duration:o.duration,easing:o.easing,step:_.noop},step:_.noop})}return this},addAnimation:function(e){return e.options=_.extend({queue:void 0,duration:void 0,easing:void 0,callback:void 0,step:void 0},e.options),this.animationQueue.push(e),1==this.animationQueue.length&&this.runNextAnimation(),this},addStyleAnimate:function(o,a,n){return this.queue(function(i){var e=_.bind(function(){if(!n){this.removeClass(o);var e=this.classes;for(var t in this.classes={},e)this.addClass(t)}i(),a&&a.call(this)},this);this.addClass(o),this.sprite?this.sprite.once("round",e):this.ruleAnimation?this.ruleAnimation.once("round",e):e()})},removeAnimation:function(){this.animationQueue.shift(),0<this.animationQueue.length&&this.runNextAnimation(!0)},clearQueue:function(){this.animationQueue=[]},runNextAnimation:function(e){this._unOptimizedPart();var t=this.animationQueue[0].options;if(t.queue)e?canvas.finishedAnimations.push(_.bind(function(){t.queue.call(this,_.bind(this.removeAnimation,this))},this)):t.queue.call(this,_.bind(this.removeAnimation,this));else{var i=this.animationQueue[0].params;for(var o in i.dy&&(i.y=this.attrs.y+i.dy,delete i.dy),i.dx&&(i.x=this.attrs.x+i.dx,delete i.dx),this.baseValues={},this.deltaValues={},i)this.baseValues[o]=this.attrs[o],this.deltaValues[o]=i[o]-this.baseValues[o];this.animationQueue[0].startTime=canvasTime}},animationFuncInternal:function(e){var t=this.animationQueue[0];t.options.step?t.options.step.call(this,e,t):this.animationStepFunction(e)},onFinishAnimation:function(e){e.isFigureAnimation?FigureAnimations.fillCurrentAttrs.call(this,this.attrs,1,e.params):this.set(e.params),e.options.callback&&canvas.finishedAnimations.push(_.bind(e.options.callback,this)),this.removeAnimation()},delay:function(e){return e instanceof Array&&(e=Math.random()*(e[1]-e[0])+e[0]),this.addAnimation({params:{},options:{duration:e}})},queue:function(e){return void 0===e?this.animationQueue:this.addAnimation({params:{},options:{queue:e}})},getCoords:function(){return{x:this.model.x,y:this.model.y}},convert:function(e){var t={};return void 0!==e.width&&(t.width=parseFloat(e.width)),void 0!==e.height&&(t.height=parseFloat(e.height)),void 0!==e["background-width"]&&(t["background-width"]=parseFloat(e["background-width"])),void 0!==e["background-height"]&&(t["background-height"]=parseFloat(e["background-height"])),void 0!==e.height&&(t.height=parseFloat(e.height)),void 0!==e.top&&(e.top.indexOf&&0===e.top.indexOf("+=")?t.y=this.model.y+parseFloat(e.top.substr(2)):e.top.indexOf&&0===e.top.indexOf("-=")?t.y=this.model.y-parseFloat(e.top.substr(2)):t.y=parseFloat(e.top)),void 0!==e.left&&(e.left.indexOf&&0===e.left.indexOf("+=")?t.x=this.model.x+parseFloat(e.left.substr(2)):e.left.indexOf&&0===e.left.indexOf("-=")?t.x=this.model.x-parseFloat(e.left.substr(2)):t.x=parseFloat(e.left)),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.scale&&(t.scale=e.scale),void 0!==e.rotate&&(t.rotate=parseFloat(e.rotate)),t},animate:function(e,t,i,o,a){return this.addAnimation({params:e,options:{duration:t,easing:Library.easingFunctions[i],callback:o,step:a}})},ourAnimate:function(e,t,i,o,a){if(e.target){var n=e.target.offset(),r=this.parent().offset();e.x=n.left-r.left,e.y=n.top-r.top,delete e.target,void 0!==e.ajust&&(e.x+=e.ajust.x,e.y+=e.ajust.y,delete e.ajust)}var s=e.options;if(e.options&&delete e.options,e.animation){var l=e.animation,d=this;a=function(e){d.set(l.call(d,e,s))},delete e.animation}return this.addAnimation({params:e,options:{duration:t,easing:Library.easingFunctions[i],callback:o,step:a}})},css:function(e){return this.set(this.convert(e)),this},fadeOut:function(e,t){return this.animate({opacity:0},e,"linear",t)},fadeIn:function(e,t){return this.animate({opacity:1},e,"linear",t)},offset:function(){var e;return e=this.parent()?this.parent().offset():{left:canvas.position.left,top:canvas.position.top},this._unOptimizedPart(),this.model.x?e.left+=this.model.x+this.attrs["margin-left"]:e.left+=this.attrs.x+this.attrs["margin-left"],this.model.y?e.top+=this.model.y+this.attrs["margin-top"]:e.top+=this.attrs.y+this.attrs["margin-top"],e},reCalculateStylesRec:function(){if(this.classChanged=!0,this.children)for(var e=0;e<this.children.length;e++)this.children[e]&&this.children[e].reCalculateStylesRec()},addClass:function(e){var t,i;if(!this.classes[e]){this.classes[e]=!0,this.reCalculateStylesRec();var o=FigureRules[e];if(o)for(t=0,i=o.length;t<i;t++){var a=o[t];(a.sprite||a.animation)&&this.isAcceptedRootSelector(a.rootSelector)&&(a.sprite&&(this.sprite&&this.sprite.destructor(),this.sprite=new Sprite(a.sprite),this.sprite.initialize()),a.animation&&(this.ruleAnimation&&this.ruleAnimation.destructor(),this.ruleAnimation=new RuleAnimation(a.animation)))}}if(this.children)for(t=0;t<this.children.length;t++){var n=this.children[t];n&&n.hasClass("stable")&&n.removeClass("stable").addClass("stable")}return this},removeClass:function(e){if(void 0===e)return this.removeAllClasses(),this.reCalculateStylesRec(),this;if(this.classes[e]){if(this.reCalculateStylesRec(),FigureRules[e])for(var t=0;t<FigureRules[e].length;t++){var i=FigureRules[e][t];(i.sprite||i.animation)&&this.isAcceptedRootSelector(i.rootSelector)&&(i.sprite&&this.sprite&&this.removeSprite(),i.animation&&this.ruleAnimation&&(this.ruleAnimation.destructor(),this.ruleAnimation=void 0))}delete this.classes[e]}return this},removeAllClasses:function(){this.classes={},this.removeSprite(),this.ruleAnimation&&(this.ruleAnimation.destructor(),this.ruleAnimation=void 0)},isAcceptedRootSelector:function(e){if(!e)return!0;for(var t=e.lastIndexOf(" "),i=e.substr(t+1).split("."),o=0;o<i.length;o++)if(i[o]&&!this.hasClass(i[o]))return!1;if(-1==t)return!0;e=e.substr(0,t);var a=this.parent();if(!a){if(this===canvas.layer)return!1;a=canvas.layer}return a.isAcceptedRule(e)},isAcceptedRule:function(e){if(!e)return!0;" "==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1));var t=e.lastIndexOf(".");-1==t&&console.log("GLOBAL ERROR, "+e);var i=e.substr(t+1);return this.hasClass(i)?this.isAcceptedRule(e.substr(0,t)):this.parent()?this.parent().isAcceptedRule(e):this!==canvas.layer&&canvas.layer.isAcceptedRule(e)},hasClass:function(e){return!0===this.classes[e]},processRule:function(e){if(FigureRules[e])for(var t=0;t<FigureRules[e].length;t++){var i=FigureRules[e][t].rootSelector;if(this.isAcceptedRootSelector(i)){var o=FigureRules[e][t].getParams();for(var a in o)this.attrs[a]=o[a]}}},calculateAttrs:function(){for(var e in this.classChanged=!1,_.extend(this.attrs,_Figure.defaults),this.classes)this.processRule(e)},calcAnimatedAttrs:function(){if(this._unOptimizedPart(),this.ruleAnimation&&this.ruleAnimation.fillCurrentAttrs(this.attrs),this.attrs.frameAnimation=void 0,this.animationQueue.length){var e=this.animationQueue[0];if(!e.options.queue){var t=canvasTime-e.startTime;t>=e.options.duration?this.onFinishAnimation(e):(t/=e.options.duration,void 0!==e.options.easing&&(t=e.options.easing(t)),e.isFigureAnimation?FigureAnimations.fillCurrentAttrs.call(this,this.attrs,t,e.params):this.animationFuncInternal(t))}}if(this.sprite&&this.sprite.params.spriteVertical)this.attrs.backgroundYOffset=this.sprite.getCurrentFrame()*this.attrs["background-height"];else if(this.attrs["background-image"]&&0<this.attrs["background-width"]){var i=_Figure.imageByFilename(this.attrs["background-image"]),o=_Figure.scaleImages[this.attrs["background-image"]],a=0;void 0!==this.attrs.frameAnimation?a=this.attrs.frameAnimation:this.sprite?a=this.sprite.getCurrentFrame():this.attrs.frame&&(a=this.attrs.frame);var n=this.attrs["background-height"],r=this.attrs["background-width"];n+=this.attrs["background-indent"],r+=this.attrs["background-indent"];var s=Math.floor(i.width/o/r);this.attrs.backgroundYOffset=n*Math.floor(a/s),this.attrs.backgroundXOffset=r*(a%s)}else if(this.attrs["sprite-name"]){a="1";this.sprite?a=(this.sprite.getCurrentFrame()+1).toString():this.attrs.frame&&(a=this.attrs.frame.toString()),a.length<2&&(a="0"+a),this.spriteName=this.attrs["sprite-name"].replace("{n}",a)}if(this.children)for(var l=0;l<this.children.length&&(this.children[l]&&this.children[l].calcAnimatedAttrs(),this.children);l++);},_unOptimizedPartRec:function(){if(this._unOptimizedPart(),this.children)for(var e=0;e<this.children.length;e++)this.children[e]&&this.children[e]._unOptimizedPartRec()},_unOptimizedPart:function(){this.classChanged&&(this.calculateAttrs(),this.modelChanged=!0),this.modelChanged&&(myExtend(this.attrs,this.model),this.modelChanged=!1)},multipleKoef:function(e){for(var t,i=["x","y","dx","dy","margin-left","margin-top","width","height"],o=0;o<i.length;o++){var a=i[o];for(this.model[a]&&(this.model[a]*=e),t=0;t<this.animationQueue.length;t++)if(this.animationQueue[t].params[a])if("object"==_typeof(this.animationQueue[t].params[a])){this.animationQueue[t].params[a]=_.clone(this.animationQueue[t].params[a]);for(var n=0;n<this.animationQueue[t].params[a].length;n++)this.animationQueue[t].params[a][n]*=e}else this.animationQueue[t].params[a]*=e;this.baseValues&&(this.baseValues[a]&&(this.baseValues[a]*=e),this.deltaValues[a]&&(this.deltaValues[a]*=e))}if(this.modelChanged=!0,this.classChanged=!0,this.children)for(t=0;t<this.children.length;t++){var r=this.children[t];r&&r.multipleKoef&&r.multipleKoef(e)}},animationStepFunction:function(e){for(var t in this.baseValues)this.attrs[t]=e*this.deltaValues[t]+this.baseValues[t]},width:function(){return this.attrs.width},height:function(){return this.attrs.height},contains:function(e,t){var i=this.offset();return i.left+=this.width()/2*(1-this.attrs.scale*this.attrs["scale-x"]),i.top+=this.height()/2*(1-this.attrs.scale*this.attrs["scale-y"]),i.left<=e&&i.top<=t&&i.left+this.width()*this.attrs.scale*this.attrs["scale-x"]>e&&i.top+this.height()*this.attrs.scale*this.attrs["scale-y"]>t},setCache:function(e){this.set("cache",1),this.clearCache()},clearCache:function(){this._cache=null;for(var e=this._parent;e;)e._cache=null,e=e._parent},box:function(){return canvas.box(this)},draw:function(e,t){this.attrs["sprite-json"]&&this.spriteName?_Figure.textureCache[this.attrs["sprite-json"]].draw(e,t.X,t.Y,this.attrs.width,this.attrs.height,this.spriteName):this.attrs["background-image"]?this.drawImage(e,t):this.attrs["background-color"]&&(e.fillStyle=this.attrs["background-color"],e.fillRect(t.X,t.Y,this.attrs.width,this.attrs.height))},drawImage:function(e,t){var i=_Figure.imageByFilename(this.attrs["background-image"]);if(i){var o=_Figure.scaleImages[this.attrs["background-image"]];e.drawImage(i,(this.attrs.backgroundXOffset+this.attrs["background-position-x"])*o,(this.attrs.backgroundYOffset+this.attrs["background-position-y"])*o,this.attrs["background-width"]*o,this.attrs["background-height"]*o,t.X,t.Y,this.attrs.width,this.attrs.height)}}}),_.extend(_Figure,{imagesCache:{},textureCache:{},stepDown:function(e,t,i,o,a){var n;if(_Figure.tmpOC||(_Figure.tmpOC=document.createElement("canvas"),_Figure.tmpFC=document.createElement("canvas"),_Figure.tmpOCctx=_Figure.tmpOC.getContext("2d"),_Figure.tmpFCctx=_Figure.tmpFC.getContext("2d")),(n=Math.ceil(Math.log(t/o)/Math.log(2)))<=1)_Figure.tmpFC.width=Math.ceil(o),_Figure.tmpFC.height=Math.ceil(a),_Figure.tmpFCctx.clearRect(0,0,_Figure.tmpFC.width,_Figure.tmpFC.height),_Figure.tmpFCctx.drawImage(e,0,0,t,i,0,0,o,a);else{for(_Figure.tmpFC.width=Math.ceil(t),_Figure.tmpFC.height=Math.ceil(i),_Figure.tmpFCctx.clearRect(0,0,_Figure.tmpFC.width,_Figure.tmpFC.height),_Figure.tmpFCctx.drawImage(e,0,0,t,i,0,0,t,i),n--;0<n;)t*=.5,i*=.5,_Figure.tmpOC.width=Math.ceil(t),_Figure.tmpOC.height=Math.ceil(i),_Figure.tmpOCctx.clearRect(0,0,_Figure.tmpOC.width,_Figure.tmpOC.height),_Figure.tmpOCctx.drawImage(_Figure.tmpFC,0,0,2*t,2*i,0,0,t,i),_Figure.tmpFC.width=Math.ceil(t),_Figure.tmpFC.height=Math.ceil(i),_Figure.tmpFCctx.clearRect(0,0,_Figure.tmpFC.width,_Figure.tmpFC.height),_Figure.tmpFCctx.drawImage(_Figure.tmpOC,0,0,t,i,0,0,t,i),n--;_Figure.tmpFC.width=Math.ceil(o),_Figure.tmpFC.height=Math.ceil(a),_Figure.tmpFCctx.clearRect(0,0,_Figure.tmpFC.width,_Figure.tmpFC.height),_Figure.tmpFCctx.drawImage(_Figure.tmpOC,0,0,t,i,0,0,o,a)}return _Figure.tmpFC},preloadImage:function(e,t){if(this.recache&&(_Figure.imagesCache[e]=void 0),void 0===_Figure.imagesCache[e]){if(figureRulesProcess.setupScaleImages&&figureRulesProcess.setupScaleImages(),_Figure.scaleImages||(_Figure.scaleImages={}),Config.renderNoImgToCanvas)return _Figure.imagesCache[e]=t,void(_Figure.scaleImages[e]=1);var i=document.createElement("canvas"),o=t.naturalWidth||t.width,a=t.naturalHeight||t.height,n=1,r=1;window.devicePixelRatio&&(r=window.devicePixelRatio),this.recache&&_Figure.preScaleImages[e]?n=_Figure.preScaleImages[e]:_Figure.scaleImages[e]&&(n=_Figure.scaleImages[e]),1<n*r&&(n=1/r),_Figure.scaleImages[e]=n*r;var s=o*n,l=a*n;i.width=Math.ceil(s*r),i.height=Math.ceil(l*r);var d=i.getContext("2d");1!=r&&d.scale(r,r),d.drawImage(_Figure.stepDown(t,o,a,s*r,l*r),0,0,s*r,l*r,0,0,s,l),_Figure.imagesCache[e]=i,t=void 0}return _Figure.imagesCache[e]},recacheImages:function(){var e=_.keys(_Figure.imagesCache),t=e.length,i=_.after(t,_.bind(function(){this.recache=!1,canvas.onChangeLayout()},this)),o=_Figure.scaleImages;figureRulesProcess.setupScaleImages&&(_Figure.scaleImages=void 0,figureRulesProcess.setupScaleImages(),_Figure.preScaleImages=_Figure.scaleImages,_Figure.scaleImages=o),this.recache=!0,_.each(e,function(e){application.preloader.resourceStatus[e]=0,application.preloader.preloadImage(e,i)})},imageByFilename:function(e){if(void 0===_Figure.imagesCache[e])throw new Error("Not found image "+e);return _Figure.imagesCache[e]},defaults:{cache:void 0,width:0,height:0,"background-width":0,"background-height":0,"background-image":void 0,"background-position-x":0,"background-position-y":0,"background-indent":0,"margin-left":0,"margin-top":0,"scale-x":1,"scale-y":1,scale:1,x:0,y:0,rotate:0,opacity:1,frame:0,left:void 0,"sprite-name":void 0,"background-color":void 0,backgroundXOffset:0,backgroundYOffset:0},SPRITE_FIELDS:["spriteFrames","spriteVertical","duration","playRound","frames","delay","alternate","framesOrder","lastFrame","startFrame"],DegToRadMultiple:Math.PI/180}),_Figure.ATTRS_FIELDS=_.keys(_Figure.defaults);var EmptyFigure=function(){};_.extend(EmptyFigure.prototype,{length:0,classes:{},remove:function(){return this},addClass:function(){return this},hasClass:function(){return!1},removeClass:function(){return this},animationByName:function(){return this},html:function(){return this},delay:function(){return this},queue:function(){return this},_find:function(){return!1},set:function(){return this},get:function(){},fadeOut:function(){return this},fadeIn:function(){return this},forEachChildren:function(){return this}});var TextFigure=_Figure.extend({constructor:function(){_Figure.call(this),this.text=void 0,_.extend(this.model,{font:void 0,color:void 0}),_.extend(this.attrs,_.pick(TextFigure.defaults,TextFigure.ATTRS_FIELDS))},_getClassName:function(){return"TextFigure"},clone:function(){var e=_Figure.prototype.clone.call(this);return e.html(this.text),!1===this.classChanged?(_.extend(e.attrs,_.pick(this.attrs,TextFigure.ATTRS_FIELDS)),e.classChanged=!1):e.classChanged=!0,e},createClone:function(){return new TextFigure},html:function(e){return this.text!=e&&(this.text=e.toString()),this.clearCache(),this},draw:function(e,t){if(this.text){this.attrs.font&&(e.font=this.attrs.font),this.attrs.textAlign&&(e.textAlign=this.attrs.textAlign);var i=this.attrs["text-left"],o=this.attrs["text-top"];this.attrs.strokeStyle&&(e.strokeStyle=this.attrs.strokeStyle,this.attrs.lineWidth&&(e.lineWidth=this.attrs.lineWidth),e.strokeText(this.text,t.X+i,t.Y+o)),this.attrs.color&&(e.fillStyle=this.attrs.color,e.fillText(this.text,t.X+i,t.Y+o))}}},{defaults:{color:void 0,textAlign:void 0,font:void 0,"text-left":0,"text-top":0,strokeStyle:void 0,lineWidth:void 0,"sprite-json":void 0}});TextFigure.ATTRS_FIELDS=_.keys(TextFigure.defaults);var ProxyFigure=function(e){this.realFigure=e,this._parent=void 0,this.offset={x:0,y:0}};_.extend(ProxyFigure.prototype,{_find:function(){return null},get:function(e){return this.realFigure.get(e)},find:function(){return new EmptyFigure},hide:function(){this.realFigure.hide()},clone:function(){return new EmptyFigure},reCalculateStylesRec:_.noop,hasClass:function(){return!1},alignTo:function(e){var t=this.realFigure.offset(),i=e.offset();this.offset.x=i.left-t.left,this.offset.y=i.top-t.top},remove:function(){this._parent&&this._parent.removeChildren(this)},getCoords:function(){return this.realFigure.getCoords()},calcAnimatedAttrs:function(){},forEachChildren:function(){},animate:_.noop});var FigureClass=function(e){var i=this;i.params={},_.each(e,function(e,t){-1!=_Figure.SPRITE_FIELDS.indexOf(t)?(i.sprite||(i.sprite={}),i.sprite[t]=e):"animation"===t?i.animation=e:(-1!=_Figure.ATTRS_FIELDS.indexOf(t)||-1!=TextFigure.ATTRS_FIELDS.indexOf(t))&&(i.params[t]=e)})};FigureClass.prototype.getParams=function(){return this.params};var FigureRules={addRule:function(e,t){void 0===FigureRules[e]&&(FigureRules[e]=[]),FigureRules[e].push(t)},add:function(e,a){_.each(e.split(", "),function(e){var t=e.lastIndexOf("."),i=e.lastIndexOf("#");t<i&&(t=i);var o=new FigureClass(a);0<t&&(o.rootSelector=e.substr(0,t));e=e.substr(t+1),FigureRules.addRule(e,o)})},reset:function(){FigureRules={addRule:this.addRule,add:this.add,reset:this.reset}}},FigureAnimations={fillCurrentAttrs:function(e,t,i){if(!(t<0)){if(1<t&&(console&&console.log&&this.animationQueue[0]&&console.log('WARN: animation "'+this.animationQueue[0].name+'" delayed over duration in '+t+" times"),t=1),i.spriteFrames){var o=t<1?Math.floor(t*i.spriteFrames):i.spriteFrames-1;return i.framesOrder&&i.framesOrder.length&&(o>=i.framesOrder.length&&(o=i.framesOrder.length-1),o=i.framesOrder[o]),void(e.frameAnimation=o)}for(var a in i){var n=t/(1/(i[a].length-1)),r=Math.floor(n);r>=i[a].length-1&&(r=i[a].length-2),n-=r,e[a]=i[a][r]+(i[a][r+1]-i[a][r])*n}}}},Sprite=function(e){this.params=e};_.extend(Sprite.prototype,Backbone.Events,{initialize:function(){this._events=void 0,this.triggerRound=void 0,this.removed=void 0,this.frameTime=this.params.duration/this.params.spriteFrames,this.waitAndPlay()},waitAndPlay:function(){if(!this.removed&&(this.startTime=canvasTime,this.params.delay)){var e=this.params.delay;this.startTime+=Math.random()*(e[1]-e[0])+e[0]}},getCurrentFrame:function(){var e=0;if(!1!==this.startTime){var t=canvasTime-this.startTime;t>=this.params.duration?(e=this.params.spriteFrames-1,this.triggerRound||(canvas.finishedCssAnimations.push(this),this.triggerRound=!0),this.startTime=!1,this.params.playRound?this.waitAndPlay():this.destructor()):e=Math.floor(t/this.frameTime)}else if(this.params.playRound||(e=this.params.spriteFrames-1),void 0!==this.params.lastFrame)return this.params.lastFrame;return e<0&&(e=0),this.params.startFrame&&(e+=this.params.startFrame),void 0===this.params.framesOrder?e:this.params.framesOrder[e]},destructor:function(){this.removed=!0},clone:function(){var e=new Sprite(this.params);return e.initialize(),e}});var RuleAnimation=Backbone.Model.extend({initialize:function(){this._events=void 0,this.waitAndPlay(this.get("delay")),this.triggerRound=void 0},waitAndPlay:function(e){this.removed||(this.startTime=canvasTime,this.prevTime=canvasTime,e&&(this.startTime+=Math.random()*(e[1]-e[0])+e[0]))},fillCurrentAttrs:function(e){if(!1===this.startTime)return{};var t=canvasTime-this.startTime;if(t<0)return{};var i=this.get("duration");i<t&&(this.triggerRound||(canvas.finishedCssAnimations.push(this),this.triggerRound=!0),this.get("playRound")?(this.waitAndPlay(this.get("playRoundDelay")),t%=i):t=i);var o=this.get("easing");t/=i;var a=this.get("params");for(var n in a){var r=t/(1/(a[n].length-1)),s=Math.floor(r);s>=a[n].length-1&&s--,r-=s,o&&(r=o(r)),e[n]=a[n][s]+(a[n][s+1]-a[n][s])*r}},destructor:function(){this.removed||(this.removed=!0,this.trigger("removed"),this.startTime=!1)}}),figureRulesProcess={process:function(){FigureRules.reset(),this.setupScaleImages&&this.setupScaleImages(),this.baseClasses(),this.commonClasses(),this.commonFeaturesClasses(),this.additionalClasses(),this.additionalBonusClasses(),this.fieldPositionClasses(),void 0!==figureAnimationProcess&&figureAnimationProcess()},baseClasses:function(){FigureRules.add(".gameMessageBlock",{width:760,height:660}),FigureRules.add(".gameMessageBlock .gameMessageBlockBg",{width:760,height:660,"background-color":"rgba(0, 0, 0, 0.50)"}),FigureRules.add(".gameMessageBlock .gameMessage",{"margin-left":380,"margin-top":330,textAlign:"center",color:"#03ff70",font:"bold 80px Tahoma"}),FigureRules.add(".fpsCounter",{color:"red",font:"bold 15px Tahoma",x:100,y:30}),FigureRules.add(".info",{color:"black",font:"bold 15px Tahoma",x:100,y:60}),FigureRules.add(".gameTimeBlock",{opacity:0}),FigureRules.add(".level_bonus .gameTimeBlock",{opacity:1}),FigureRules.add(".level_bonus .gameScoreBlock, .level_bonus .moves, .level_bonus .powerUps",{opacity:0}),FigureRules.add(".fieldBlock",{"margin-top":Config.needBorder?2*Config.borderHeight:0,"margin-left":Config.needBorder?2*Config.borderHeight:0}),FigureRules.add(".fieldBorder",{"margin-top":Config.needBorder?2*Config.borderHeight:0,"margin-left":Config.needBorder?2*Config.borderHeight:0}),FigureRules.add(".fieldAndBorderContaner",{cache:!Config.renderNoFieldCache,width:Config.cellWidth*Config.cols+(Config.needBorder?4*Config.borderHeight:0),height:Config.cellHeight*Config.rows+(Config.needBorder?4*Config.borderHeight:0),"margin-top":Config.needBorder?2*-Config.borderHeight:0,"margin-left":Config.needBorder?2*-Config.borderHeight:0})},setupScaleImages:function(){},additionalBonusScaleImages:function(){},additionalBonusClasses:function(){},commonClasses:function(){},additionalClasses:function(){},fieldPositionClasses:function(){},commonBonusClasses:function(){}};figureRulesProcess.setupScaleImages=function(){_Figure.scaleImages||(_Figure.scaleKoef=Config.cellWidth/180,_Figure.scaleImages={"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Y.53f87ef80a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_R.46d878744f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_G.b89dd075cb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_B.ae1e312675.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_P.20cab9d90d.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_W.1ef765c038.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Pearl.d109d28766.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1.7c56771edf.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1Small.9dc3c7a107.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fish/dancingFish.788c5f4c6a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/suggestArrow.8a9ecad35e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzaHead.f0774883b5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzalifes.eed999d289.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast.c6603d2a42.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast01.6ff3b060f8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast02.79a9badc3e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast03.1604ac4577.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast04.65625272e4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast05.b09ca3ac6b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast06.f08ec322b6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice2.17411cf33e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice3.47077275ee.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box.f3a52eed6f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box2.cec6d040f9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box3.fecdcd9763.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box4.4baf11ff6b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box5.e70fd68d66.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/vortex.0bebb41a97.png":6*Config.cellWidth/500,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/explode.43d72ab81c.png":Config.cellWidth/45,"../img/selectedCellBg.png":Config.cellWidth/40,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/multicolor.3c5bbe1e0b.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/selectedCellBg.15c33a6e94.png":Config.cellWidth/40,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/star.743162900c.png":Config.cellWidth/74,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast.b4e5cd791e.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast2.227a90f218.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast3.2d09bdb077.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlastAlt.66fcb64211.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChain.d9fb22ea82.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChainVert.84a7a2f516.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChainBlast.7c5028a92f.png":Config.cellWidth/40,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate/chocolate_appearance.48e5c4fdb3.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate/chocolate_annihilation.c193a0899b.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombY.10761ce882.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombR.3b5ffa0faf.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombW.64057e376f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombP.56a5d27262.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombB.a264f0111a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombG.ac2a163b8f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombLight.c46d50aade.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/movesToExplode.52341a8f6b.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombDangerHighlight.bd4b7394bb.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCenter.c4040173f8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCorner.670cdb94f5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeSide.145dd1c813.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolatefarm/chocolateFarm.fbb6b419f7.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabfarm/crabFarm.5f39b6e66a.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderwebfarm/spider.68dfeaa0ba.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/snapCrab.11943552b2.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/runCrab.ab17f97419.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/diecrab.4dc1421e7a.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crab2/snapCrab2.002d69fff2.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crab2/runCrab2.a1baac4b28.png":Config.cellWidth/80,"../../../gems/site/img/features/crab2/dieCrab2.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/changecolor/changecolor.ad605bb7dc.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornado.1fe313c5a7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/aftertornado.4414266860.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornadoExplode_xlarge.094be48227.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornadoSparks.30dd9ba626.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderweb/spiderweb.4c06435ae2.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderweb/spiderweb2.456ddbecb9.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/snapCrabIce.5a7496f13d.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIce.ca38642a95.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/runCrabIce.fae2f47d63.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIceExplosion.1fcc54e30c.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/snapCrabIce.cfbe78bfeb.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/dieCrabIce.2b8d22cec9.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/runCrabIce.412d0c20af.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishBall/fishBall.abc5be39a1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishBall/fishBallJump.0abc3f08a8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ghost/ghost.32bc4996e0.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/ghost/ghostfishlight.e40fc9b43d.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl/pearlBg.2d17b7b2dd.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl/pearl.5731465cc5.png":Config.cellWidth/82,"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/shark.058a58db12.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkDamaged.d939167236.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkEat.5709fc14f8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkStable.ddace4e8d9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/well/well.2a3f584947.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/well/water.e8b6c970e0.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/skat/devilfish.8113ec8246.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/life/devilfish-life.c940445916.png":Config.cellWidth/50,"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png":Config.cellWidth/52,"//gems-ok.akamaized.net/gems/gems/site/img/features/bulb/lightninglamp.99a89cf768.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/egg/fishka.bd4c63ce83.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/walrus/walrusStable.254f0ba93e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/walrus/walrusDamaged.198db770ad.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotBg.0d4d465e5f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotCage.8b06d32ce1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotFly.53c6d8bc12.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotLock.308abfe24b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator/alligatorStable.c207e23d10.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator/alligatorDamaged.cb16ab32a2.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/crabSnail.1d0a17e13d.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusa.106a818c95.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusaEyes.8d7c580c53.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment1.6a02af8e8b.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment2.bf2ab489f4.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3.e4caebe3e0.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3R.c171dcbf2c.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3Y.2b56f743d7.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3P.67042cec10.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment4.b63bfe19df.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/palm/palm.e164d57b8f.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/palm/coconut.4a3d74cfa3.png":Config.cellWidth/80,"../../../gems/site/img/features/vasebox/vasebox.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerBg.476a898b41.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerHead.700b43b95b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerlifes.ff2c0b4594.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/candy/candyStatic.ee6f399777.png":_Figure.scaleKoef/60*80,"//gems-ok.akamaized.net/gems/gems/site/img/features/candy/candyDie.0c4e6bb778.png":_Figure.scaleKoef/60*80,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_Y.fe9ce1723e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_R.1468a33497.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_G.f0b4051bbf.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_B.e7c6d3f496.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_P.a9576adcc9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_W.c6f4285c78.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/body.b2024c068f.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/eyes.26ceb0911c.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/mouth.bed443d424.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/medusaBubbles.1c95f9bdbd.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/medusaDanger.cbc8081606.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/dolphinHor.075e713235.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/dolphinVer.29dfc4719f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/rope.f49eadd2b7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/ropeThing.6447dd2e68.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/ropeCenter.b5860d009e.png":_Figure.scaleKoef,"../../../gems/site/img/features/mermaid/mermaidLifes.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid/pearl.3390395f21.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerZero.f53c66085a.png":2*_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerFull.78b607e8f8.png":2*_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerLight.ddbc029909.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/light.4807a16b7e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/tower_light.f8961eb58c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/blackhole/web/coral.7144964957.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/blackhole/mobile/coral.604dd94f7e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coral/coral.1bc47479dd.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coin/coin.78187034e1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest/web/coinChest_large.bf11d4cc57.png":2*_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest/mobile/coinChest.b0ad2a242e.png":2*_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest/color_any.ce031a0626.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate1.06ee9f055c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate2.71f7558256.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/gravity/arrow.498be9a2ac.png":Config.cellWidth/200,"//gems-ok.akamaized.net/gems/gems/site/img/features/gravitycore/core.070e7a007b.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/cannon/cannon_large.d2822f5660.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/cannon/cannonLight.f7646eaad8.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/stream/streamLine.5970a05878.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/stream/streamCorner.138f728260.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/carnivores/liana.f8ebe0b07c.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/carnivores/lianaEater.eacce23a83.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlower.b32879d4aa.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerExplosion.ed9c26d8fd.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerFire.6369277474.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerFireball.399130a6e2.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugR.ecbfcf1120.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugG.0a38f4c0ea.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugB.d3396fe2fb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugY.934d04c5ab.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugP.35994ee369.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugW.1432054e18.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogEat.484c9dd23e.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_R.7dd1474f65.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_G.55eb74a141.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_B.e1c976b5af.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_Y.17840c3df7.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_P.be025ee07e.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_W.df01c61c68.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogHouse.8fcb54740c.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogJump.9194bc5743.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogPath.4d271cc033.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogStable.05a8384497.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogStableBlink.26a496ded7.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogTarget.f211b1174b.png":Config.cellWidth/90,"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy/flamyStable.0b7f9c42b9.png":_Figure.scaleKoef,"../../../gems/site/img/features/flamy/flamyDamaged.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg1.2e03356483.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg2.e0cdee723d.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg3.6867fe3977.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg4.787a5257a6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg5.b25ba67c28.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig1.542282f1d8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig2.3ca5c69000.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig3.17e7e7e835.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigHorizontal1.5212f36e8b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigVertical1.5084d50b67.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barCenter.1e082b7961.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingCenter.0f9d3d2a8b.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingLeft.2098d18ddb.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingRight.7ecd73bf8f.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barLeft.e5ba370916.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barRight.48cfaccadb.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/caviarTask.77e1e833c3.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBar.781f209b28.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBottomCenter.e02345abc0.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBottomRight.81c49c4b9a.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingCenterCenter.ad28a48649.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingCenterRight.ddec635cc3.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingTopCenter.612c5fa91b.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingTopRight.9a3b89098e.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/coconutTask.4a3d74cfa3.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/fallingTask.7de4233154.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/patch.82193df4ba.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticBottomCenter.43f59da884.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticCenterCenter.5036b9597d.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticTopCenter.2aa2387507.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/water.e8b6c970e0.png":Config.cellWidth/120,"../../../gems/site/img/features/anemone/fishB.png":_Figure.scaleKoef,"../../../gems/site/img/features/anemone/fishG.png":_Figure.scaleKoef,"../../../gems/site/img/features/anemone/fishN.png":_Figure.scaleKoef,"../../../gems/site/img/features/anemone/fishP.png":_Figure.scaleKoef,"../../../gems/site/img/features/anemone/fishR.png":_Figure.scaleKoef,"../../../gems/site/img/features/anemone/fishY.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sand.60db2bb5c1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sandCorner.fc399e4949.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sandEnd.9b10996255.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/hole.76f47584a4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/cancerN.3531434bff.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/fish.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starR.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starG.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starB.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starY.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starP.png":_Figure.scaleKoef,"../../../gems/site/img/features/cosmo/starW.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/ground.bd4ea77628.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/groundBreak.4873230246.png":Config.cellWidth/60,"../../../gems/site/img/features/catacomb/groundGems.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/pickaxe.46d46ef1d5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/tnt.e5eebffae5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/minecart.0c19231cd6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteStep.1d40e35e49.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteBg.ba08b01073.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteMovesBg.1f0d0475a1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/leaf.e8a31403be.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/umbrella.26362f23b9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment1.966075d468.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment2.2e3cfc10b9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment3.1447ab0aea.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment4.44bf30d5a2.png":_Figure.scaleKoef,"../../../gems/site/img/features/AutumnForest/mushroom.png":_Figure.scaleKoef,"../../../gems/site/img/features/AutumnForest/plant.png":Config.cellWidth/120,"../../../gems/site/img/features/AutumnForest/sun1.png":_Figure.scaleKoef,"../../../gems/site/img/features/AutumnForest/sun2.png":_Figure.scaleKoef,"../../../gems/site/img/features/AutumnForest/sun3.png":_Figure.scaleKoef,"../../../gems/site/img/features/AutumnForest/sun4.png":_Figure.scaleKoef,"../../../gems/site/img/features/ValentinesDay/fish.png":_Figure.scaleKoef,"../../../gems/site/img/features/ValentinesDay/flower1.png":_Figure.scaleKoef,"../../../gems/site/img/features/ValentinesDay/flower2.png":_Figure.scaleKoef,"../../../gems/site/img/features/ValentinesDay/flower3.png":_Figure.scaleKoef,"../../../gems/site/img/features/ValentinesDay/flower4.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloverfields/clover.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloverfields/beer.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloverfields/snakeStable.png":2*_Figure.scaleKoef,"../../../gems/site/img/features/cloverfields/snakeDamage.png":2*_Figure.scaleKoef,"../../../gems/site/img/features/dacha/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/chocolateDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass1.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass2.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass3.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass1Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass2Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/grass3Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/ground.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/groundBreak.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/groundGems.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/plant.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/plantchest.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/plantEaterDamaged.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/plantEaterFly.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/plantEaterStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/seed.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/vegetable1.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/vegetable2.png":_Figure.scaleKoef,"../../../gems/site/img/features/dacha/vegetable3.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/poem.4ed09117fc.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece1.e311f80060.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece2.331698afc1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece3.65f9db40d8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece4.855099b483.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlast.17683cb14c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlast2.28f2c6de99.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlastAlt.3008127fa5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/firework1.c4a1140d5f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/firework2.f23df63788.png":_Figure.scaleKoef,"../../../gems/site/img/features/spaceworld/body.png":Config.cellWidth/90,"../../../gems/site/img/features/spaceworld/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/spaceworld/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/spaceworld/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/spaceworld/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/piratesbirthday/keks.png":_Figure.scaleKoef,"../../../gems/site/img/features/piratesbirthday/kolpak.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/bublik.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumngoodbuy/spider.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/coin.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/parrotBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/parrotLock.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/amonite1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/lighthouse.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2018/parrot.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/bigRacoon.dcc959fda0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/book.9722dbf197.png":_Figure.scaleKoef,"../../../gems/site/img/features/schoolbell/cat.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/coinChest.0e3fcf36d0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/greedyPirate1.cde2ee7810.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/leaf.7f92f76bf0.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/bat.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/ground.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/groundBreak.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/groundGems.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/hand.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/dancingFish.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/dustAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/dustRemove.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthdayworld/cat.png":Config.cellWidth/120,"../../../gems/site/img/features/birthdayworld/specialFeature.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/banka1.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/banka2.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/banka3.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/bankaFire.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/bankaPiece.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/leaf.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/racoon.png":_Figure.scaleKoef,"../../../gems/site/img/features/autumnworld/turtle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/cat.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/pumpkin.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/cauldron.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/candy.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/candyChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/greedyPirate2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/chainBlast.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/chainBlast2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/chainBlast3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/chainBlastAlt.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/drop.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/hand.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/ktulhu.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/ktulhuFly.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/specialFeature.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/pearlBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2018/pearl.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/food.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/foodChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/genry_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/genryFly_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/hand.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/greedyPirate2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/hamster.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/sunflower.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass3.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass1Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass2Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/grass3Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/vegetable1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/vegetable2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/vegetable3.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanxgivingday/specialFeature.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/cursorLightingOld.2c41461e88.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/base/hammerOld.512103c6cb.png":_Figure.scaleKoef,"../../../gems/site/img/features/bug/kingBugIdle.png":_Figure.scaleKoef,"../../../gems/site/img/features/bug/kingBugIdle2.png":_Figure.scaleKoef,"../../../gems/site/img/features/bug/kingBugEat.png":_Figure.scaleKoef,"../../../gems/site/img/features/bug/kingBugDie.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox/strongbox_xlarge.407f246c37.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox/strongboxCollectItem.2816be1634.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/iceberg.e9ea4881b9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergDie.0eb0c89754.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergShard.71cb21b109.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergWater.8068866888.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround1.2311b1ae03.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround2.d59367c1e5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround3.c768fc9e16.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/gold.14d54b15a7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloud_xlarge.4955d55d6d.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudDark_xlarge.964ea49504.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudLumps.202b8210f4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudDarkLumps.7ea163c4c6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheep_xlarge.335ce10efa.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheepDark_xlarge.dbd00f2d21.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheepFlying.5b9c2f9b27.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealerLIfeblock.1121e81ba7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullFly.f6805d0a10.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullSit_xlarge.30e4a68020.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullStun.87c93261fe.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/lifebelt.d5f027f4d3.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/lifebeltFront.a1f9c9ba01.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/stunStars.06702983ea.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullHit.2401537935.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/body.8eb13fcdcc.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eye.1f41cf5eaa.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/babyEye.2b972852e0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/fin.51ec816ee1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/fin2.3d4b5943f1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/head.d078754e47.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/stars.8d79373e8c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/tail.fd3b2ef55c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelBaby.81bf2ca48e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformHead.b9be984e41.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformTail.e65e9d304f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_R.717ffe2b93.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_G.0ab88a5e8e.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_B.f75987be83.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_P.4b311e5e71.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_Y.c8b3130666.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_W.c736e2e4ad.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_R.9729e4bd40.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_G.e4c3812e4c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_B.f13686cca0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_P.c5403d3036.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_Y.1040136879.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_W.cec4858db7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_R.68929878ab.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_G.b94595567a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_B.90edc70626.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_P.ff21cd104c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_Y.22a47ad61a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_W.e357311d0b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask.0ac1696f41.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_R.efe0d9e559.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_G.dbaa6e19b2.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_B.6652d6bd51.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_P.6ef23382cf.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_Y.8e37ef7af6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_W.de20874b8d.png":_Figure.scaleKoef},this.additionalBonusScaleImages instanceof Function&&this.additionalBonusScaleImages())},figureRulesProcess.commonClasses=function(){FigureRules.add(".suggestArrow",{"background-position-x":0,"background-position-y":0,"background-width":73,"background-height":54,width:.4*Config.cellWidth,height:.3*Config.cellHeight,"margin-left":.3*Config.cellHeight,"margin-top":.35*Config.cellWidth,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/suggestArrow.8a9ecad35e.png"}),FigureRules.add(".taskAmount",{cache:!0,width:30,height:16,"text-top":14}),FigureRules.add(".gameMessageBlock",{width:480}),FigureRules.add(".gameMessageBlock .gameMessage",{textAlign:"center",font:"normal 48px 'Marvin', 'Tahoma'",color:"#ebe709"}),FigureRules.add(".fieldPoints",{width:80/60*Config.cellWidth,"margin-left":.5*Config.cellWidth,color:"#ffffff",lineWidth:1,strokeStyle:"#222222",textAlign:"center",font:"normal 28px 'Marvin', Tahoma, 'Geneva CY', sans-serif"}),FigureRules.add(".fieldPoints.explodeArrowCell, .fieldPoints.explodeBombCell, .fieldPoints.explodeMulticolorCell",{font:"normal 22px 'Marvin', Tahoma, 'Geneva CY', sans-serif"}),FigureRules.add(".fieldPoints.collectTaskElem",{color:"#ffffff"}),FigureRules.add(".tournamentPoints",{"background-position-x":0,"background-position-y":0,"background-width":89,"background-height":78,width:89/60*Config.cellWidth,height:1.3*Config.cellHeight,"margin-left":-.25*Config.cellWidth,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".tournamentPoints.points1",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/tournamentScore_1.8911fb3f2b.png"}),FigureRules.add(".tournamentPoints.points2",{}),FigureRules.add(".tournamentPoints.points3",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/tournamentScore_3.693643e7bf.png"}),FigureRules.add(".tournamentPoints.points4",{}),FigureRules.add(".tournamentPoints.points5",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/tournamentScore_5.3e91da5df4.png"}),FigureRules.add(".fieldPoints.explodeCell_Y",{color:"#f0b74f"}),FigureRules.add(".fieldPoints.explodeCell_W",{color:"#ffffff"}),FigureRules.add(".fieldPoints.explodeCell_B",{color:"#4f89f0"}),FigureRules.add(".fieldPoints.explodeCell_P",{color:"#e34ff0"}),FigureRules.add(".fieldPoints.explodeCell_G",{color:"#7cf04f"}),FigureRules.add(".fieldPoints.explodeCell_R",{color:"#f71919"}),FigureRules.add(".fieldPoints.explodeCell_N",{color:"#4f89f0"}),FigureRules.add(".gameScoreBlock",{x:50,y:623}),FigureRules.add(".gameScoreBlock .gameScore",{font:"normal 16px 'Marvin', Tahoma, 'Geneva CY', sans-serif",color:"#fbf3c3",width:200,height:20,"text-left":100,"text-top":16,textAlign:"center"}),FigureRules.add(".fieldDisabled",{"background-color":"#000000",opacity:.65}),FigureRules.add(".fieldDisabledNoOpacity.fieldDisabled",{opacity:0}),FigureRules.add(".cellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/cellBg.c21c5969c7.png"}),FigureRules.add(".powerUpHighlight",{animation:{params:{"margin-top":[0,-.05*Config.cellHeight]},duration:200}}),FigureRules.add(".powerUpHighlightBg.powerUpHighlightBgAnimation",{"background-position-x":0,"background-position-y":0,"background-width":41,"background-height":42,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/powerUpHighlightBg.5cd7b78063.png",width:41/60*Config.cellWidth,height:.7*Config.cellHeight,"margin-top":.55*Config.cellWidth,"margin-left":10/60*Config.cellHeight,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".suggest",{animation:{params:{"margin-top":[0,-.05*Config.cellHeight,0,.05*Config.cellHeight,0]},duration:400,playRound:!0}}),FigureRules.add(".cell",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".cursorLighting .body",{"background-width":98,"background-height":128,width:98/60*Config.cellWidth,height:128/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/cursorLighting.a64382746e.png","margin-left":-10/60*Config.cellWidth,"margin-top":-112/60*Config.cellWidth}),FigureRules.add(".cursorDeleteRowPowerUp .body",{"background-width":225,"background-height":181,width:1.5*Config.cellWidth,height:181/150*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/cursorDeleteRowPowerUp.7e16ee16da.png","margin-left":-.8*Config.cellWidth,"margin-top":-90/140*Config.cellWidth}),FigureRules.add(".cell.color_Y, .cell.color_R, .cell.color_G, .cell.color_B, .cell.color_P, .cell.color_W, .cell.color_",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".cell.color_R",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_R.46d878744f.png"}),FigureRules.add(".cell.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_G.b89dd075cb.png"}),FigureRules.add(".cell.color_B",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_B.ae1e312675.png"}),FigureRules.add(".cell.color_Y",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Y.53f87ef80a.png"}),FigureRules.add(".cell.color_P",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_P.20cab9d90d.png"}),FigureRules.add(".cell.color_W",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_W.1ef765c038.png"}),FigureRules.add(".cell.color_",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Pearl.d109d28766.png"}),FigureRules.add(".cell_explode",{"background-position-x":0,"background-position-y":0,"background-width":45,"background-height":45,width:.75*Config.cellWidth,height:.75*Config.cellWidth,"margin-left":.1*Config.cellWidth,"margin-top":.1*Config.cellWidth,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/explode.43d72ab81c.png",spriteFrames:7,duration:200,playRound:!1}),FigureRules.add(".selectedCellBg",{"background-position-x":0,"background-position-y":0,"background-width":40,"background-height":40,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/selectedCellBg.15c33a6e94.png"}),FigureRules.add(".multicolor",{"background-width":80,"background-height":80,"background-position-x":0,"background-position-y":0,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/multicolor.3c5bbe1e0b.png",spriteFrames:20,duration:1200,playRound:!0}),FigureRules.add(".vortex",{"margin-left":Config.cellWidth,"margin-top":Config.cellHeight}),FigureRules.add(".vortexBg",{opacity:.6,width:6*Config.cellWidth,height:6*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/vortex.0bebb41a97.png","background-position-x":0,"background-position-y":0,"background-width":500,"background-height":500,animation:{params:{rotate:[0,360]},duration:500,playRound:!0}}),FigureRules.add(".fallingStar",{"background-position-x":0,"background-position-y":0,"background-width":74,"background-height":71,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/star.743162900c.png",width:74,height:71}),FigureRules.add(".decorator_blocked_alt, .decorator_blocked_alt_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlastAlt.66fcb64211.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_blocked_alt_remove_animatePiece1.decorator_blocked_alt_remove_animatePiece",{"background-position-x":80,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".decorator_blocked_alt_remove_animatePiece2.decorator_blocked_alt_remove_animatePiece",{"background-position-x":160,"margin-left":0,"margin-top":0}),FigureRules.add(".decorator_blocked_alt_remove_animatePiece3.decorator_blocked_alt_remove_animatePiece",{"background-position-x":240,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".decorator_blocked_alt_remove_animatePiece4.decorator_blocked_alt_remove_animatePiece",{"background-position-x":320,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".decorator_blocked, .decorator_blocked_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast.b4e5cd791e.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_blocked_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":80,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".decorator_blocked_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":160,"margin-left":0,"margin-top":0}),FigureRules.add(".decorator_blocked_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":240,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".decorator_blocked_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":320,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".decorator_chocolate.stable",{"background-position-x":240,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate/chocolate_appearance.48e5c4fdb3.png",width:1.1*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-.05*Config.cellWidth,"margin-top":-.05*Config.cellHeight}),FigureRules.add(".decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate/chocolate_appearance.48e5c4fdb3.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,duration:300}),FigureRules.add(".chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":238,"background-height":227,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate/chocolate_annihilation.c193a0899b.png",width:179/60*Config.cellWidth,height:170/60*Config.cellHeight,"margin-left":-1*Config.cellWidth,"margin-top":-55/60*Config.cellHeight,spriteFrames:5,duration:400}),FigureRules.add(".decorator_blocked2",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast2.227a90f218.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_blocked2_remove_animatePiece",{"background-position-x":160,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast2.227a90f218.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_blocked2_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":160,"margin-left":.1*Config.cellWidth,"margin-top":-.13*Config.cellHeight}),FigureRules.add(".decorator_blocked2_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":240,"margin-left":-.18*Config.cellWidth,"margin-top":.13*Config.cellHeight}),FigureRules.add(".decorator_blocked2_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":320,"margin-left":.35*Config.cellWidth,"margin-top":-.38*Config.cellHeight}),FigureRules.add(".decorator_blocked2_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":400,"margin-left":-.38*Config.cellWidth,"margin-top":.37*Config.cellHeight}),FigureRules.add(".bomb",{width:Config.cellWidth,height:Config.cellHeight,"background-image":""}),FigureRules.add(".bomb.color_Y",{"background-image":""}),FigureRules.add(".bomb.color_R",{"background-image":""}),FigureRules.add(".bomb.color_W",{"background-image":""}),FigureRules.add(".bomb.color_P",{"background-image":""}),FigureRules.add(".bomb.color_B",{"background-image":""}),FigureRules.add(".bomb.color_G",{"background-image":""}),FigureRules.add(".bomb .cellSubBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"",animation:{params:{scale:[1,1.1,1]},duration:300,playRoundDelay:[3e3,5e3],playRound:!0}}),FigureRules.add(".bomb .light",{width:113/180*Config.cellWidth,height:.6*Config.cellHeight,"background-width":113,"background-height":108,"margin-left":38/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombLight.c46d50aade.png",spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".bomb.color_Y .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombY.10761ce882.png"}),FigureRules.add(".bomb.color_R .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombR.3b5ffa0faf.png"}),FigureRules.add(".bomb.color_W .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombW.64057e376f.png"}),FigureRules.add(".bomb.color_P .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombP.56a5d27262.png"}),FigureRules.add(".bomb.color_B .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombB.a264f0111a.png"}),FigureRules.add(".bomb.color_G .cellSubBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombG.ac2a163b8f.png"}),FigureRules.add(".bombMoves",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/movesToExplode.52341a8f6b.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".movesToExplode",{font:"bold "+.3*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Tahoma",color:"#000000","text-left":.25*Config.cellWidth,"text-top":.85*Config.cellHeight}),FigureRules.add(".movesToExplode.movesToExplodeTwoDigits",{font:"bold "+14/60*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Tahoma","text-left":11/60*Config.cellWidth,"text-top":50/60*Config.cellHeight}),FigureRules.add(".movesToExplode.bombSoonExplode",{color:"#8b0000"}),FigureRules.add(".bombDangerHighlight.bombSoonExplode",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombDangerHighlight.bd4b7394bb.png",width:Config.cellWidth,height:Config.cellHeight,animation:{params:{opacity:[1,.1,1]},duration:600,playRound:!0}}),FigureRules.add(".bombExplode",{"background-position-x":0,"background-position-y":0,"background-width":411,"background-height":257,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCenter.c4040173f8.png",width:411/180*Config.cellWidth,height:257/180*Config.cellHeight,"margin-left":-115/180*Config.cellWidth,"margin-top":-38/180*Config.cellHeight,spriteFrames:9,duration:450}),FigureRules.add(".bombExplode.up",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeSide.145dd1c813.png"}),FigureRules.add(".bombExplode.down",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeSide.145dd1c813.png",rotate:180}),FigureRules.add(".bombExplode.left",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeSide.145dd1c813.png",rotate:-90}),FigureRules.add(".bombExplode.right",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeSide.145dd1c813.png",rotate:90}),FigureRules.add(".bombExplode.leftup",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCorner.670cdb94f5.png"}),FigureRules.add(".bombExplode.leftdown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCorner.670cdb94f5.png",rotate:-90}),FigureRules.add(".bombExplode.rightup",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCorner.670cdb94f5.png",rotate:90}),FigureRules.add(".bombExplode.rightdown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb/bombExplodeCorner.670cdb94f5.png",rotate:180}),FigureRules.add(".chocolateFarm",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolatefarm/chocolateFarm.fbb6b419f7.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:6,duration:800,playRound:!0}),FigureRules.add(".decorator_crab",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/snapCrab.11943552b2.png",spriteFrames:16,duration:800,playRound:!0}),FigureRules.add(".move_crab",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/runCrab.ab17f97419.png",spriteFrames:2,duration:300,playRound:!0}),FigureRules.add(".die_crab",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab/diecrab.4dc1421e7a.png"}),FigureRules.add(".decorator_blocked3, .decorator_blocked3_remove_animatePiece",{"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blocked/chainBlast3.2d09bdb077.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_blocked3",{"background-position-x":0}),FigureRules.add(".decorator_blocked3_remove_animatePiece",{"background-position-x":80}),FigureRules.add(".decorator_blocked3_remove_animatePiece1.decorator_blocked3_remove_animatePiece",{"background-position-x":160,"margin-left":-22/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".decorator_blocked3_remove_animatePiece2.decorator_blocked3_remove_animatePiece",{"background-position-x":240,"margin-left":-4/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".decorator_blocked3_remove_animatePiece3.decorator_blocked3_remove_animatePiece",{"background-position-x":320,"margin-left":11/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".decorator_blocked3_remove_animatePiece4.decorator_blocked3_remove_animatePiece",{"background-position-x":400,"margin-left":31/60*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".decorator_crab2",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab2/snapCrab2.002d69fff2.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,framesOrder:[0,1,0],duration:450,delay:[2700,3e3],playRound:!0}),FigureRules.add(".move_crab2",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab2/runCrab2.a1baac4b28.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:2,duration:300,playRound:!0}),FigureRules.add(".decorator_crab2_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crab2/diecrab2.01d190cfb1.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crab2_remove_animatePiece1.decorator_crab2_remove_animatePiece",{"margin-left":14/60*Config.cellHeight}),FigureRules.add(".decorator_crab2_remove_animatePiece2.decorator_crab2_remove_animatePiece",{"background-position-x":80,"margin-left":14/60*Config.cellHeight}),FigureRules.add(".decorator_crab2_remove_animatePiece3.decorator_crab2_remove_animatePiece",{"background-position-x":160,"margin-left":-10/60*Config.cellHeight}),FigureRules.add(".decorator_crab2_remove_animatePiece4.decorator_crab2_remove_animatePiece",{"background-position-x":240,"margin-left":-.15*Config.cellHeight}),FigureRules.add(".decorator_changecolor",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".changeColorAnimation",{"background-position-x":0,"background-position-y":0,"background-width":107,"background-height":107,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/changecolor/changecolor.ad605bb7dc.png",width:40/60*Config.cellWidth,height:40/60*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellHeight,opacity:.7,animation:{params:{rotate:[0,360]},duration:600,playRound:!0}}),FigureRules.add(".decorator_changecolor.changeMove",{animation:{params:{scale:[1,2,1]},duration:600}}),FigureRules.add(".tornadoCell",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".tornado",{"background-position-x":0,"background-position-y":0,"background-width":320,"background-height":320,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornado.1fe313c5a7.png",width:320/180*Config.cellWidth,height:320/180*Config.cellHeight,"margin-left":-70/180*Config.cellWidth,"margin-top":-60/180*Config.cellHeight,spriteFrames:6,duration:600,playRound:!0}),FigureRules.add(".afterTornado",{"background-position-x":0,"background-position-y":0,"background-width":200,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/aftertornado.4414266860.png",width:200/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-15/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".afterTornado.afterTornadoHide",{spriteFrames:7,duration:400}),FigureRules.add(".tornadoExplode",{"background-position-x":0,"background-position-y":0,"background-width":320,"background-height":320,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornadoExplode_xlarge.094be48227.png",width:320/180*Config.cellWidth,height:320/180*Config.cellHeight,"margin-left":-70/180*Config.cellWidth,"margin-top":-60/180*Config.cellHeight,spriteFrames:6,duration:500,playRound:!0}),FigureRules.add(".tornadoSparks",{"background-position-x":0,"background-position-y":0,"background-width":213,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tornado/tornadoSparks.30dd9ba626.png",width:213/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":60/180*Config.cellWidth,"margin-top":60/180*Config.cellHeight,spriteFrames:5,duration:400,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".crabFarmCell",{"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabfarm/crabFarm.5f39b6e66a.png",width:62/60*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":-1/60*Config.cellWidth,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".crabFarmCell.crabFarmLevel0",{"background-position-x":0,spriteFrames:4,duration:300,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".crabFarmCell.crabFarmLevel1, .crabFarmCell.crabFarmLevel2, .crabFarmCell.crabFarmLevel3",{"background-position-x":240}),FigureRules.add(".decorator_spiderweb.stable",{"background-position-x":240,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderweb/spiderweb.4c06435ae2.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_spiderweb.spiderweb_appearance",{"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderweb/spiderweb.4c06435ae2.png",width:Config.cellWidth,height:Config.cellHeight,"background-position-x":0,spriteFrames:3,duration:300}),FigureRules.add(".spiderweb_remove",{"background-position-x":0,"background-position-y":0,"background-width":200,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderweb/spiderweb2.456ddbecb9.png",width:1.67*Config.cellWidth,height:1.67*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-.32*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".spiderwebFarm",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderwebfarm/spider.68dfeaa0ba.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".stable.decorator_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/snapCrabIce.5a7496f13d.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:9,duration:1200,delay:[4e3,6e3],playRound:!0}),FigureRules.add(".decorator_crabIce.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIce.ca38642a95.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabIce.magicCrabIce",{"background-position-x":160,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/runCrabIce.fae2f47d63.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:4,duration:400}),FigureRules.add(".decorator_crabIce .life, .move_crabIce .life",{font:"bold "+16/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px Tahoma",color:"#ff0000","text-left":26/60*Config.cellWidth,"text-top":50/60*Config.cellWidth}),FigureRules.add(".decorator_crabIce.magicCrabIce .life",{"text-left":.425*Config.cellWidth}),FigureRules.add(".move_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/runCrabIce.fae2f47d63.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:2,duration:300,playRound:!0}),FigureRules.add(".die_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":89,"background-height":89,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIceExplosion.1fcc54e30c.png",width:89/60*Config.cellWidth,height:89/60*Config.cellHeight,"margin-left":-14/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".decorator_crabIce_remove_animatePiece1",{"background-position-x":80,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIce.ca38642a95.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabIce_remove_animatePiece2",{"background-position-x":160,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIce.ca38642a95.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabIce_remove_animatePiece3",{"background-position-x":240,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIce.ca38642a95.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".ghostCell",{"background-position-y":0,"background-width":103,"background-height":103,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ghost/ghost.32bc4996e0.png",width:79/60*Config.cellWidth,height:79/60*Config.cellHeight,"margin-left":-.15*Config.cellWidth,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".ghostCell.ghostLevel0",{"background-position-x":0,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".ghostCell.ghostLevel0NextSize",{"background-position-x":412}),FigureRules.add(".ghostCell.ghostLevel1",{"background-position-x":515,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".ghostCell.ghostLevel1NextSize",{"background-position-x":927}),FigureRules.add(".ghostCell.ghostLevel2",{"background-position-x":1030,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".ghostCell.ghostGrowDown",{"background-position-x":412,spriteFrames:5,framesOrder:[7,6,2,1,0],lastFrame:0,duration:500}),FigureRules.add(".ghostCell.ghostUpFishesAnimation",{"background-position-x":1442,spriteFrames:3,lastFrame:0,duration:400}),FigureRules.add(".ghostFishLight",{"background-position-x":0,"background-position-y":0,"background-width":95,"background-height":95,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ghost/ghostfishlight.e40fc9b43d.png",width:95/60*Config.cellWidth,height:95/60*Config.cellHeight,"margin-left":-17/60*Config.cellWidth,"margin-top":-17/60*Config.cellHeight,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".pearlCell.cell",{"background-image":""}),FigureRules.add(".pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl/pearlBg.2d17b7b2dd.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":240,"background-position-y":0}),FigureRules.add(".pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":160,"background-position-y":0}),FigureRules.add(".pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":80,"background-position-y":0}),FigureRules.add(".pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".die_pearl",{"background-position-x":320,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl/pearlBg.2d17b7b2dd.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pearl",{"background-position-x":0,"background-position-y":0,"background-width":82,"background-height":82,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl/pearl.5731465cc5.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".sharkCell",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/shark.058a58db12.png",width:Config.cellWidth,height:Config.cellHeight,animation:{params:{"margin-top":[0,.05*Config.cellHeight,0,-.05*Config.cellHeight,0]},duration:2500,playRound:!0}}),FigureRules.add(".sharkCell.stable",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkStable.ddace4e8d9.png",spriteFrames:6,duration:600,playRound:!0,delay:[1e3,3e3]}),FigureRules.add(".sharkCell.angryShark",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/shark.058a58db12.png",spriteFrames:9,duration:900,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".sharkCell.eatShark",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkEat.5709fc14f8.png",spriteFrames:5,duration:500}),FigureRules.add(".sharkCell.damaged",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shark/sharkDamaged.d939167236.png",spriteFrames:3,duration:330,playRound:!0}),FigureRules.add(".wellCell",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well/well.2a3f584947.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".wellLevel1.wellCell",{"background-position-x":80,"background-position-y":0}),FigureRules.add(".wellLevel2.wellCell",{"background-position-x":160,"background-position-y":0}),FigureRules.add(".wellCell.wellLevel3",{"background-position-x":240,"background-position-y":0,spriteFrames:3,duration:500,playRound:!0}),FigureRules.add(".wellCell.wellLevel4",{"background-position-x":480,"background-position-y":0,spriteFrames:2,duration:300,playRound:!0}),FigureRules.add(".color_N",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well/water.e8b6c970e0.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".color_N.waterAnimated",{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".flyWater",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well/water.e8b6c970e0.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".floorLevelAnimation3",{"background-position-x":0,"background-position-y":0,"background-width":113,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png",width:113/60*Config.cellWidth,height:3.3*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-26/60*Config.cellHeight,spriteFrames:3,duration:350,playRound:!0}),FigureRules.add(".stable.decorator_crabIce2",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/snapCrabIce.cfbe78bfeb.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,duration:600,delay:[5400,6e3],playRound:!0}),FigureRules.add(".decorator_crabIce2.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/dieCrabIce.2b8d22cec9.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabIce2.magicCrabIce2",{"background-position-x":160,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/runCrabIce.412d0c20af.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,duration:500,playRound:!0}),FigureRules.add(".decorator_crabIce2 .life, .move_crabIce2 .life",{font:"bold "+16/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px tahoma",color:"#ff0000","text-left":35/60*Config.cellWidth,"text-top":.7*Config.cellWidth}),FigureRules.add(".move_crabIce2",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/runCrabIce.412d0c20af.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:2,duration:300,playRound:!0}),FigureRules.add(".die_crabIce2",{"background-position-x":0,"background-position-y":0,"background-width":89,"background-height":89,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice/dieCrabIceExplosion.1fcc54e30c.png",width:89/60*Config.cellWidth,height:89/60*Config.cellHeight,"margin-left":-14/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:4,duration:300,playRound:!0}),FigureRules.add(".decorator_crabIce2_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabice2/dieCrabIce.2b8d22cec9.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabIce2_remove_animatePiece1.decorator_crabIce2_remove_animatePiece",{"background-position-x":240}),FigureRules.add(".decorator_crabIce2_remove_animatePiece2.decorator_crabIce2_remove_animatePiece",{"background-position-x":320}),FigureRules.add(".decorator_crabIce2_remove_animatePiece3.decorator_crabIce2_remove_animatePiece",{"background-position-x":400}),FigureRules.add(".decorator_crabBomb.stable",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/snapCrabBomb.5dd92dcc56.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".decorator_crabBomb.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/dieCrabBomb.d36af54e77.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:6,duration:300}),FigureRules.add(".decorator_crabBomb .decoratorLifeBlock",{"background-width":25,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/crabBombLife.40bc58ef3e.png",width:25/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":46/60*Config.cellHeight}),FigureRules.add(".setBomb_crabBomb .decoratorLifeBlock",{"background-width":25,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/crabBombLife.40bc58ef3e.png",width:25/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":46/60*Config.cellHeight}),FigureRules.add(".setBomb_crabBomb .life, .decorator_crabBomb .life, .move_crabBomb .life",{font:"bold "+16/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px tahoma",color:"#ffffff",textAlign:"center","text-left":.2*Config.cellWidth,"text-top":.3*Config.cellWidth}),FigureRules.add(".move_crabBomb",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/runCrabBomb.cd0b7b02f4.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-.1*Config.cellHeight,spriteFrames:6,duration:300,playRound:!0}),FigureRules.add(".die_crabBomb",{"background-position-x":320,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/dieCrabBomb.d36af54e77.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".setBomb_crabBomb",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/setCrabBomb.21835bc903.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:5,duration:300,playRound:!1}),FigureRules.add(".decorator_crabBomb_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/dieCrabBomb.d36af54e77.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".decorator_crabBomb_remove_animatePiece1.decorator_crabBomb_remove_animatePiece",{"background-position-x":384}),FigureRules.add(".decorator_crabBomb_remove_animatePiece2.decorator_crabBomb_remove_animatePiece",{"background-position-x":448}),FigureRules.add(".decorator_crabBomb_remove_animatePiece3.decorator_crabBomb_remove_animatePiece",{"background-position-x":512}),FigureRules.add(".crabBombCollect",{"background-position-x":0,"background-position-y":0,"background-width":64,"background-height":74,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabbomb/runCrabBomb.cd0b7b02f4.png",width:64/60*Config.cellWidth,height:74/60*Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:6,duration:300,playRound:!0}),FigureRules.add(".skatCellBg",{"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/skat/devilfish.8113ec8246.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".skatCellBg.stable",{"background-position-x":0,spriteFrames:3,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".skatCellBg.angrySkat",{"background-position-x":240,spriteFrames:3,duration:500,playRound:!0}),FigureRules.add(".skatCellBg.eatSkat",{"background-position-x":560,spriteFrames:3,duration:500,playRound:!0}),FigureRules.add(".die_skat",{"background-position-x":800,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/skat/devilfish.8113ec8246.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".skatCell .life",{"background-position-y":0,"background-width":50,"background-height":17,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/devilfish-life.c940445916.png",width:38/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":11/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".life.skatLevel3",{"background-position-x":0}),FigureRules.add(".life.skatLevel2",{"background-position-x":50}),FigureRules.add(".life.skatLevel1",{"background-position-x":100}),FigureRules.add(".bulbCell",{"background-position-y":0,"background-width":117,"background-height":109,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bulb/lightninglamp.99a89cf768.png",width:88/60*Config.cellWidth,height:82/60*Config.cellHeight,"margin-left":-.25*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".bulbCell.bulbLevel3",{"background-position-x":0}),FigureRules.add(".bulbCell.bulbLevel2",{"background-position-x":117,spriteFrames:2,duration:160,playRound:!0}),FigureRules.add(".bulbCell.bulbLevel1",{"background-position-x":351,spriteFrames:2,duration:160,playRound:!0}),FigureRules.add(".bulbCell.bulbLevel0",{"background-position-x":585,spriteFrames:2,duration:160,playRound:!0}),FigureRules.add(".bulbCell.powerUpHighlight",{animation:{params:{"margin-top":[-10/60*Config.cellHeight,-13/60*Config.cellHeight]},duration:200}}),FigureRules.add(".bulbCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-left":25/60*Config.cellHeight,"margin-top":43/60*Config.cellWidth}),FigureRules.add(".color_0, .color_1, .color_2",{"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/egg/fishka.bd4c63ce83.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".color_0",{"background-position-x":880}),FigureRules.add(".color_1",{"background-position-x":240}),FigureRules.add(".collectedcolor_1",{spriteFrames:9,duration:900,framesOrder:[0,1,2,3,4,5,6,7,8]}),FigureRules.add(".color_2",{"background-position-x":0}),FigureRules.add(".collectedcolor_2",{spriteFrames:4,duration:900,framesOrder:[0,1,2,3]}),FigureRules.add(".walrusBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/walrus/walrusStable.254f0ba93e.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:20,framesOrder:[0,0,0,0,1,2,1,0,0,0,0,1,2,1,3,4,5,6,7,8,9],duration:3e3,playRound:!0}),FigureRules.add(".walrusBg.walrusAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/walrus/walrusDamaged.198db770ad.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:9,framesOrder:[0,1,2,3,4,3,2,1,0],duration:900}),FigureRules.add(".walrusFly",{"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/walrus/walrusDamaged.198db770ad.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,frame:6,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".walrusLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":34/60*Config.cellWidth,"margin-top":100/60*Config.cellHeight}),FigureRules.add(".walrusLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".less50PercentLife.walrusLife",{"background-color":"#ffff00"}),FigureRules.add(".less25PercentLife.walrusLife",{"background-color":"#f2342c"}),FigureRules.add(".walrusHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight}),FigureRules.add(".parrotCell.cell",{"background-image":""}),FigureRules.add(".parrotCellBg",{"background-position-y":0,"background-width":83,"background-height":83,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotBg.0d4d465e5f.png",width:62/60*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":-1/60*Config.cellWidth,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".parrotLevel1 .parrotCellBg",{"background-position-x":83}),FigureRules.add(".parrotLevel1 .parrotCellBg.stable",{spriteFrames:6,framesOrder:[0,1,2,3,2,1],duration:600,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".parrotLevel2 .parrotCellBg",{"background-position-x":415}),FigureRules.add(".parrotLevel2 .parrotCellBg.stable",{spriteFrames:4,framesOrder:[0,1,2,1],duration:400,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".parrotLevel3 .parrotCellBg",{"background-position-x":664}),FigureRules.add(".parrotLevel3 .parrotCellBg.stable",{spriteFrames:4,framesOrder:[1,1,2,1],duration:400,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".die_parrot",{"background-position-x":0,"background-position-y":0,"background-width":83,"background-height":83,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotBg.0d4d465e5f.png",width:62/60*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":-1/60*Config.cellWidth,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".die_parrotDoor",{"background-position-x":60,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotLock.308abfe24b.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":-11/60*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".die_parrotLock",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotLock.308abfe24b.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":-1/60*Config.cellWidth,"margin-top":Config.cellHeight}),FigureRules.add(".parrot",{"background-position-x":0,"background-position-y":0,"background-width":90,"background-height":75,"background-image":"../../../gems/site/img/features/parrot/parrot.png",width:67/60*Config.cellWidth,height:56/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":2/60*Config.cellHeight,spriteFrames:6,framesOrder:[0,1,2,3,2,1],duration:400,playRound:!0}),FigureRules.add(".parrotCell.cell",{"background-image":""}),FigureRules.add(".parrotCellBg",{"background-position-y":0,"background-width":180,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotBg.0d4d465e5f.png",width:Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":0,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".parrotCellCage",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotCage.8b06d32ce1.png",width:Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":0,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".parrotLevel3 .parrotCellCage",{"background-position-x":0}),FigureRules.add(".parrotLevel2 .parrotCellCage",{"background-position-x":180}),FigureRules.add(".parrotLevel1 .parrotCellCage",{"background-position-x":360}),FigureRules.add(".parrotLevel1 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".parrotLevel1 .parrotCellBg.stable",{spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".parrotLevel2 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".parrotLevel2 .parrotCellBg.stable",{spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".parrotLevel3 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".parrotLevel3 .parrotCellBg.stable",{spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".die_parrot",{"background-position-x":360,"background-position-y":0,"background-width":180,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotCage.8b06d32ce1.png",width:Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":0,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".die_parrotDoor",{"background-position-x":180,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotLock.308abfe24b.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".die_parrotLock",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotLock.308abfe24b.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".parrot",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot/parrotFly.53c6d8bc12.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:3,framesOrder:[0,1,2],duration:300,playRound:!0}),FigureRules.add(".alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator/alligatorStable.c207e23d10.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:12,framesOrder:[0,0,0,0,1,0,2,3,4,3,2,0],duration:3e3,playRound:!0}),FigureRules.add(".alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator/alligatorDamaged.cb16ab32a2.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:5,framesOrder:[0,1,2,1,0],duration:1e3}),FigureRules.add(".alligatorFly",{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator/alligatorDamaged.cb16ab32a2.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:4,framesOrder:[0,3,4,5],duration:400,playRound:!0,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".alligatorLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":34/60*Config.cellWidth,"margin-top":88/60*Config.cellHeight}),FigureRules.add(".alligatorLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".less50PercentLife.alligatorLife",{"background-color":"#ffff00"}),FigureRules.add(".less25PercentLife.alligatorLife",{"background-color":"#f2342c"}),FigureRules.add(".alligatorHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight}),FigureRules.add(".hammer",{width:175/60*Config.cellWidth,height:136/60*Config.cellHeight,"margin-left":-.95*Config.cellWidth,"margin-top":-.45*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/hammer.ac99985544.png","background-position-x":0,"background-position-y":0,"background-width":175,"background-height":136,spriteFrames:13,duration:500}),FigureRules.add(".cursorHammer .body",{width:175/60*Config.cellWidth,height:136/60*Config.cellHeight,"margin-left":-1.45*Config.cellWidth,"margin-top":-58/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/hammer.ac99985544.png","background-position-x":0,"background-position-y":0,"background-width":175,"background-height":136}),FigureRules.add(".decorator_crabMedusa",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/crabSnail.1d0a17e13d.png","margin-top":.1*Config.cellHeight,spriteFrames:2,framesOrder:[0,4],duration:300,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".decorator_crabMedusa.special",{"background-position-x":0,"background-position-y":0,"background-width":62,"background-height":60,width:62/60*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/snail.851be9c47d.png","margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".move_crabMedusa",{"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/crabSnail.1d0a17e13d.png",spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".move_crabMedusa.special",{"background-position-x":558,"background-position-y":0,"background-width":62,"background-height":60,width:62/60*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/snail.851be9c47d.png",spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".move_crabMedusa.special.delay",{"background-position-x":0,"background-position-y":0,"background-width":62,"background-height":60,width:62/60*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/snail.851be9c47d.png",spriteFrames:5,framesOrder:[5,6,7,8,9],duration:250,playRound:!1}),FigureRules.add(".right.move_crabMedusa",{"scale-x":-1}),FigureRules.add(".right.move_crabMedusa.special",{"scale-x":1}),FigureRules.add(".moveLeft.move_crabMedusa.special",{"scale-x":-1}),FigureRules.add(".die_crabMedusa",{"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/crabSnail.1d0a17e13d.png"}),FigureRules.add(".die_crabMedusa.special",{"background-width":62,"background-height":60,width:62/60*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa/snail.851be9c47d.png"}),FigureRules.add(".crabMedusaMovesBlock .crabMedusaMoves",{opacity:1,textAlign:"center",font:"normal "+16/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#ffffff","text-left":.25*Config.cellWidth,"text-top":47/60*Config.cellHeight}),FigureRules.add(".medusaHead, .medusaDie",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusa.106a818c95.png","background-width":90,"background-height":90,"background-position-x":0,"background-position-y":0,width:68/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".medusaOuch, .medusaDie",{"background-position-x":1260}),FigureRules.add(".medusaHead.stable",{spriteFrames:12,framesOrder:[3,2,1,0,1,2,3,2,1,0,1,2],duration:2500,playRound:!0}),FigureRules.add(".medusaHead.medusaHorizontal",{"background-position-x":360}),FigureRules.add(".medusaHead.medusaHorizontal.medusaOuch",{"background-position-x":1080}),FigureRules.add(".medusaHead.medusaVertical",{"background-position-x":720}),FigureRules.add(".medusaHead.medusaVertical.medusaOuch",{"background-position-x":1170}),FigureRules.add(".medusaSprite",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusaEyes.8d7c580c53.png","background-width":52,"background-height":16,"background-position-x":0,"background-position-y":0,width:.65*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":.25*Config.cellWidth,"margin-top":.15*Config.cellHeight,spriteFrames:2,framesOrder:[1,0],delay:[1e3,2e3],duration:300,playRound:!0,opacity:0}),FigureRules.add(".medusaHead.medusaVertical .medusaSprite, .medusaHead.medusaHorizontal .medusaSprite",{opacity:1}),FigureRules.add(".medusaLife",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/devilfish-life.c940445916.png","background-width":50,"background-height":17,"background-position-y":0,width:38/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":11/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".life3.medusaLife",{"background-position-x":0}),FigureRules.add(".life2.medusaLife",{"background-position-x":50}),FigureRules.add(".life1.medusaLife",{"background-position-x":100}),FigureRules.add(".life0.medusaLife",{"background-image":""}),FigureRules.add(".medusaTailDir_LEFT, .medusaTailDir_RIGHT",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusa_hor_tail.6998ef19e0.png","background-width":650,"background-height":80,"background-position-x":0,"background-position-y":10,width:469/60*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".medusaTailDir_LEFT",{"margin-left":23/60*Config.cellWidth}),FigureRules.add(".medusaTailDir_RIGHT",{"margin-left":-23/60*Config.cellWidth,"scale-x":-1}),FigureRules.add(".tailCreated .medusaTailDir_LEFT, .tailCreated .medusaTailDir_RIGHT",{"background-position-y":90}),FigureRules.add(".medusaTailDir_UP, .medusaTailDir_DOWN",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/medusa/medusa_vert_tail.48ce4842ff.png","background-position-x":10,"background-position-y":0,"background-width":50,"background-height":80,width:1*Config.cellWidth,height:469/60*Config.cellHeight}),FigureRules.add(".medusaTailDir_UP",{"margin-top":23/60*Config.cellWidth,"scale-x":-1}),FigureRules.add(".medusaTailDir_DOWN",{"margin-top":-23/60*Config.cellWidth,"scale-y":-1}),FigureRules.add(".tailCreated .medusaTailDir_UP, .tailCreated .medusaTailDir_DOWN",{"background-position-x":90}),FigureRules.add(".attribute_hat_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment1.6a02af8e8b.png","background-width":80,"background-height":80}),FigureRules.add(".attribute_shirt_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment2.bf2ab489f4.png","background-width":80,"background-height":80}),FigureRules.add(".attribute_pants_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3.e4caebe3e0.png","background-width":80,"background-height":80}),FigureRules.add(".color_R .attribute_pants_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3R.c171dcbf2c.png","background-width":80,"background-height":80}),FigureRules.add(".color_Y .attribute_pants_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3Y.2b56f743d7.png","background-width":80,"background-height":80}),FigureRules.add(".color_P .attribute_pants_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment3P.67042cec10.png","background-width":80,"background-height":80,"margin-top":-1/60*Config.cellWidth}),FigureRules.add(".color_ .attribute_pants_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Pearl.d109d28766.png","background-width":80,"background-height":80,"margin-top":-1/60*Config.cellWidth}),FigureRules.add(".attribute_boots_mark",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/girl/garment4.b63bfe19df.png","background-width":80,"background-height":80}),FigureRules.add(".palmHeadCell",{"background-position-x":0,"background-position-y":0,"background-width":160,"background-height":160,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/palm/palm.e164d57b8f.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".palmHeadCell.fireAnimation",{spriteFrames:8,duration:800,playRound:!1}),FigureRules.add(".color_U",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/palm/coconut.4a3d74cfa3.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".flyCoconut",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/palm/coconut.4a3d74cfa3.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_stickyChain.horizontal",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChain.d9fb22ea82.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_stickyChain.vertical",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChainVert.84a7a2f516.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_stickyChain_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":40,"background-height":53,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stickychain/stickyChainBlast.7c5028a92f.png",width:40/60*Config.cellWidth,height:53/60*Config.cellHeight}),FigureRules.add(".multicolorExplode",{width:67/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-3.5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,"background-width":67,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/multiColExplode.b5452a4344.png",spriteFrames:10,duration:500,playRound:!1}),FigureRules.add(".smallFire",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/small_fire.f0b20fc32a.png","background-width":31,"background-height":31,"margin-left":14.5/60*Config.cellWidth,"margin-top":14.5/60*Config.cellWidth,width:31/60*Config.cellWidth,height:31/60*Config.cellHeight}),FigureRules.add(".attribute",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".attribute_key",{width:.55*Config.cellWidth,height:.55*Config.cellHeight,"margin-left":.225*Config.cellWidth,"margin-top":.225*Config.cellHeight,"background-width":100,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/key/attribute_key.775bdb8469.png"}),FigureRules.add(".attribute_coin",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coin/coin.78187034e1.png"}),FigureRules.add(".attribute_coin_remove",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coin/coin.78187034e1.png"}),FigureRules.add(".arrow",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".arrow.dir_horizontal",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/dir_horizontal.416ae60e5c.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".arrow.dir_vertical",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/dir_vertical.c39dd2ac4a.png",spriteFrames:4,duration:400,playRound:!0,spriteVertical:!0}),FigureRules.add(".arrow.dir_both",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/dir_both.4f4a1644c1.png",spriteFrames:4,duration:400,playRound:!0,spriteVertical:!0}),FigureRules.add(".leftLight_horizontal",{"background-position-x":0,"background-position-y":0,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/lightTail.1bc6a36b25.png",height:1.6*Config.cellHeight,"margin-top":-.3*Config.cellHeight,animation:{params:{"background-width":[30,660],width:[.5*Config.cellWidth,11*Config.cellWidth],"margin-left":[.5*Config.cellWidth,-10.5*Config.cellWidth]},duration:370},spriteFrames:2,duration:160,playRound:!0,spriteVertical:!0}),FigureRules.add(".rightLight_horizontal",{"background-position-x":0,"background-position-y":0,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/lightTail.1bc6a36b25.png",height:1.6*Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":-.3*Config.cellHeight,"scale-x":-1,animation:{params:{"background-width":[30,660],width:[.5*Config.cellWidth,11*Config.cellWidth]},duration:370},spriteFrames:2,duration:160,playRound:!0,spriteVertical:!0}),FigureRules.add(".centerLight_horizontal",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/centerLight.f8fef648c2.png",width:3*Config.cellWidth,height:1.6*Config.cellHeight,spriteVertical:!0,"margin-left":-Config.cellWidth,"margin-top":-.3*Config.cellHeight,spriteFrames:2,duration:100,playRound:!0}),FigureRules.add(".leftLight_vertical",{"background-position-x":0,"background-position-y":0,"background-width":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/lightTailVert.605577d5fa.png",width:1.6*Config.cellWidth,spriteVertical:!1,"margin-left":-.3*Config.cellWidth,animation:{params:{"background-height":[30,660],height:[.5*Config.cellHeight,11*Config.cellHeight],"margin-top":[.5*Config.cellHeight,-10.5*Config.cellHeight]},duration:370},spriteFrames:2,duration:160,playRound:!0}),FigureRules.add(".rightLight_vertical",{"background-position-x":0,"background-position-y":0,"background-width":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/lightTailVert.605577d5fa.png",width:1.6*Config.cellWidth,spriteVertical:!1,"margin-left":-.3*Config.cellWidth,"margin-top":.5*Config.cellHeight,"scale-y":-1,animation:{params:{"background-height":[30,660],height:[.5*Config.cellHeight,11*Config.cellHeight]},duration:370},spriteFrames:2,duration:160,playRound:!0}),FigureRules.add(".centerLight_vertical",{"background-position-x":0,"background-position-y":0,"background-width":100,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/centerLightVert.22cb04c25f.png",width:1.6*Config.cellWidth,height:3*Config.cellHeight,"margin-left":-.3*Config.cellWidth,"margin-top":-Config.cellHeight,spriteFrames:2,duration:100,playRound:!0}),FigureRules.add(".punishCannonCell",{y:476}),FigureRules.add(".punishCannonCell",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/punishBtn.9b5641f521.png","background-width":261,"background-height":187,width:4.35*Config.cellWidth,height:187/60*Config.cellHeight}),FigureRules.add(".punishCannonCell.animated",{"background-position-x":261,spriteFrames:4,duration:150,playRound:!0}),FigureRules.add(".punishCannonExplosion",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/punishCannonExplosion.251642a8a6.png","background-width":101,"background-height":108,width:101/60*Config.cellWidth,height:1.8*Config.cellHeight,"margin-left":-20,"margin-top":-24,spriteFrames:6,duration:400}),FigureRules.add(".floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast.c6603d2a42.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".iceBlast",{"background-position-x":0,"background-position-y":0,"background-width":114,"background-height":140,width:38/60*Config.cellWidth,height:140/3/60*Config.cellHeight}),FigureRules.add(".iceBlast1.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast01.6ff3b060f8.png","margin-left":26/60*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".iceBlast2.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast02.79a9badc3e.png","margin-left":.45*Config.cellWidth,"margin-top":.35*Config.cellHeight}),FigureRules.add(".iceBlast3.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast03.1604ac4577.png","margin-left":-.35*Config.cellWidth,"margin-top":22/60*Config.cellHeight}),FigureRules.add(".iceBlast4.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast04.65625272e4.png","margin-left":-25/60*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".iceBlast5.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast05.b09ca3ac6b.png","margin-left":-25/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".iceBlast6.iceBlast",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast06.f08ec322b6.png","margin-left":22/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".floorLevelAnimation2",{"background-position-x":0,"background-position-y":0,"background-width":113,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png",width:113/60*Config.cellWidth,height:3.3*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-26/60*Config.cellHeight,spriteFrames:4,duration:350}),FigureRules.add(".hidden.floorLevel",{opacity:0}),FigureRules.add(".pizzaHead",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzaHead.f0774883b5.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-Config.cellWidth,"margin-top":-Config.cellHeight}),FigureRules.add(".pizzaHead.powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-left":Config.cellWidth-20/60*Config.cellWidth,"margin-top":Config.cellHeight+20/60*Config.cellHeight}),FigureRules.add(".pizzaHead.stable",{spriteFrames:5,duration:840,delay:[3200,3600],playRound:!0,framesOrder:[0,1,2,1,0]}),FigureRules.add(".pizzaHead.pizzaOuch",{spriteFrames:8,duration:1e3,framesOrder:[0,1,2,3,3,2,1,0]}),FigureRules.add(".pizzaLife",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pizzaLife2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzalifes.eed999d289.png","margin-left":10/60*Config.cellHeight,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pizzaLife0",{"background-position-x":0,"background-position-y":180,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzalifes.eed999d289.png","margin-left":-2/60*Config.cellHeight,"margin-top":8/60*Config.cellHeight,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pizzaLife1",{"background-position-x":0,"background-position-y":360,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pizza/pizzalifes.eed999d289.png","margin-top":.4*Config.cellHeight,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".pizzaType_1_0 .pizzaLife",{"scale-x":-1}),FigureRules.add(".pizzaType_0_1 .pizzaLife",{"scale-y":-1}),FigureRules.add(".pizzaType_1_1 .pizzaLife",{"scale-x":-1,"scale-y":-1}),FigureRules.add(".pizzaLifeDone",{"background-position-x":540}),FigureRules.add(".pizzaTakeLife",{spriteFrames:3,duration:240}),FigureRules.add(".diePizza",{width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".diePizza .pizzaType_0_0",{"margin-left":0,"margin-top":0}),FigureRules.add(".diePizza .pizzaType_1_0",{"margin-left":Config.cellWidth,"margin-top":0}),FigureRules.add(".diePizza .pizzaType_0_1",{"margin-left":0,"margin-top":Config.cellHeight}),FigureRules.add(".diePizza .pizzaType_1_1",{"margin-left":Config.cellWidth,"margin-top":Config.cellHeight}),FigureRules.add(".wall",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/wall/wall.6d051fe4c7.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".huntertarget",{"background-position-x":0,"background-position-y":0,"background-width":59,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/huntertarget/door.0d8ac013e7.png",width:Config.cellWidth/60*59,height:Config.cellHeight}),FigureRules.add(".gravity",{"background-position-x":0,"background-position-y":0,"background-width":200,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gravity/arrow.498be9a2ac.png",width:200/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight,spriteFrames:6,duration:600,delay:[2e3,6e3],playRound:!0}),FigureRules.add(".cannonBg .light",{"margin-left":-97/120*Config.cellWidth,"margin-top":-28/120*Config.cellHeight,"background-position-x":0,"background-position-y":0,"background-width":270,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/cannon/cannonLight.f7646eaad8.png",width:2.25*Config.cellWidth,height:1.5*Config.cellHeight,opacity:0}),FigureRules.add(".cannonBg .light.charged",{animation:{params:{opacity:[0,1,0]},duration:500,playRound:!0}}),FigureRules.add(".cannonBg .cannon",{"margin-left":-97/120*Config.cellWidth,"margin-top":-28/120*Config.cellHeight,"background-position-x":0,"background-position-y":0,"background-width":270,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/cannon/cannon_large.d2822f5660.png",width:2.25*Config.cellWidth,height:1.5*Config.cellHeight}),FigureRules.add(".cannonBg .cannon.stable",{spriteVertical:!0,spriteFrames:3,framesOrder:[2,3,4],duration:300,playRound:!0}),FigureRules.add(".cannonBg .cannon.shot",{spriteVertical:!0,spriteFrames:7,framesOrder:[4,5,6,7,8,9,10],duration:500,playRound:!1}),FigureRules.add(".cannonBg .cannon.reflect1",{"scale-x":1,spriteVertical:!0,spriteFrames:3,framesOrder:[2,0,1],duration:250,playRound:!1}),FigureRules.add(".cannonBg .cannon.reflect2",{"scale-x":-1,"margin-left":-50/120*Config.cellWidth,spriteVertical:!0,spriteFrames:3,framesOrder:[1,0,2],duration:250,playRound:!1}),FigureRules.add(".decorator_hide, .decorator_hide_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box.f3a52eed6f.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_hide_remove_animatePiece1.decorator_hide_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".decorator_hide_remove_animatePiece2.decorator_hide_remove_animatePiece",{"background-position-x":360}),FigureRules.add(".decorator_hide_remove_animatePiece3.decorator_hide_remove_animatePiece",{"background-position-x":540}),FigureRules.add(".decorator_hide_remove_animatePiece4.decorator_hide_remove_animatePiece",{"background-position-x":720}),FigureRules.add(".decorator_hide_remove_animatePiece5.decorator_hide_remove_animatePiece",{"background-position-x":900}),FigureRules.add(".decorator_hide_remove_animatePiece6.decorator_hide_remove_animatePiece",{"background-position-x":1080}),FigureRules.add(".decorator_hide2, .decorator_hide2_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box2.cec6d040f9.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_hide2_remove_animatePiece1.decorator_hide2_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".decorator_hide2_remove_animatePiece2.decorator_hide2_remove_animatePiece",{"background-position-x":360}),FigureRules.add(".decorator_hide2_remove_animatePiece3.decorator_hide2_remove_animatePiece",{"background-position-x":540}),FigureRules.add(".decorator_hide2_remove_animatePiece4.decorator_hide2_remove_animatePiece",{"background-position-x":720}),FigureRules.add(".decorator_hide2_remove_animatePiece5.decorator_hide2_remove_animatePiece",{"background-position-x":900}),FigureRules.add(".decorator_hide2_remove_animatePiece6.decorator_hide2_remove_animatePiece",{"background-position-x":1080}),FigureRules.add(".decorator_hide2_remove_animatePiece7.decorator_hide2_remove_animatePiece",{"background-position-x":1260}),FigureRules.add(".decorator_hide2_remove_animatePiece8.decorator_hide2_remove_animatePiece",{"background-position-x":1440}),FigureRules.add(".decorator_hide2_remove_animatePiece9.decorator_hide2_remove_animatePiece",{"background-position-x":1620}),FigureRules.add(".decorator_hide3, .decorator_hide3_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box3.fecdcd9763.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_hide3_remove_animatePiece1.decorator_hide3_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".decorator_hide3_remove_animatePiece2.decorator_hide3_remove_animatePiece",{"background-position-x":360}),FigureRules.add(".decorator_hide3_remove_animatePiece3.decorator_hide3_remove_animatePiece",{"background-position-x":540}),FigureRules.add(".decorator_hide3_remove_animatePiece4.decorator_hide3_remove_animatePiece",{"background-position-x":720}),FigureRules.add(".decorator_hide4, .decorator_hide4_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box4.4baf11ff6b.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_hide4_remove_animatePiece1.decorator_hide4_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".decorator_hide4_remove_animatePiece2.decorator_hide4_remove_animatePiece",{"background-position-x":360}),FigureRules.add(".decorator_hide4_remove_animatePiece3.decorator_hide4_remove_animatePiece",{"background-position-x":540}),FigureRules.add(".decorator_hide4_remove_animatePiece4.decorator_hide4_remove_animatePiece",{"background-position-x":720}),FigureRules.add(".decorator_hide5, .decorator_hide5_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hide/box5.e70fd68d66.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_hide5_remove_animatePiece1.decorator_hide5_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".decorator_hide5_remove_animatePiece2.decorator_hide5_remove_animatePiece",{"background-position-x":360}),FigureRules.add(".decorator_hide5_remove_animatePiece3.decorator_hide5_remove_animatePiece",{"background-position-x":540}),FigureRules.add(".decorator_hide5_remove_animatePiece4.decorator_hide5_remove_animatePiece",{"background-position-x":720}),FigureRules.add(".decorator_hide5_remove_animatePiece5.decorator_hide5_remove_animatePiece",{"background-position-x":900}),FigureRules.add(".decorator_hide5_remove_animatePiece6.decorator_hide5_remove_animatePiece",{"background-position-x":1080}),FigureRules.add(".decorator_hide5_remove_animatePiece7.decorator_hide5_remove_animatePiece",{"background-position-x":1260}),FigureRules.add(".decorator_hide5_remove_animatePiece8.decorator_hide5_remove_animatePiece",{"background-position-x":1440}),FigureRules.add(".decorator_hide5_remove_animatePiece9.decorator_hide5_remove_animatePiece",{"background-position-x":1620}),FigureRules.add(".floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice2.17411cf33e.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice3.47077275ee.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".crabFarmLevel1 .crabFarmCellCrab, .crabFarmLevel2 .crabFarmCellCrab, .crabFarmLevel3 .crabFarmCellCrab",{"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabfarm/crabFarmCrab.ca65b21225.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".crabFarmLevel1 .crabFarmCellCrab.stable",{"background-position-x":120,spriteFrames:2,duration:250,delay:[250,500],playRound:!0}),FigureRules.add(".crabFarmLevel2 .crabFarmCellCrab.stable",{"background-position-x":360,spriteFrames:2,duration:250,delay:[250,500],playRound:!0}),FigureRules.add(".crabFarmLevel3 .crabFarmCellCrab.stable",{"background-position-x":600,spriteFrames:2,duration:250,delay:[250,500],playRound:!0}),FigureRules.add(".crabFarmLevel1 .crabFarmCellCrab.crabFarmMove",{"background-position-x":0,spriteFrames:3,duration:300,delay:[0,0]}),FigureRules.add(".crabFarmLevel2 .crabFarmCellCrab.crabFarmMove",{"background-position-x":240,spriteFrames:3,duration:300,delay:[0,0]}),FigureRules.add(".crabFarmLevel3 .crabFarmCellCrab.crabFarmMove",{"background-position-x":480,spriteFrames:3,duration:300,delay:[0,0]}),FigureRules.add(".fishcellBg",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish/dancingFish.788c5f4c6a.png"}),FigureRules.add(".fish2.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish2/task_fish2.1e5c0f400f.png"}),FigureRules.add(".fish3.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish3/task_fish3.15fd8cd7a0.png"}),FigureRules.add(".fish4.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish4/task_fish4.84002ec566.png"}),FigureRules.add(".fish5.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish5/task_fish5.8f636dae8f.png"}),FigureRules.add(".fish6.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish6/task_fish6.25db1d0f45.png"}),FigureRules.add(".fish7.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish7/task_fish7.47b142698e.png"}),FigureRules.add(".pumpkinCell",{"background-image":""}),FigureRules.add(".pumpkin",{"background-position-x":0,"background-position-y":0,"background-width":86,"background-height":86,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/pumpkinDamage.c85dd40fe4.png",width:86/60*Config.cellWidth,height:86/60*Config.cellHeight,"margin-left":-13/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight}),FigureRules.add(".pumpkin.pumpkinShot",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/pumpkinAttack.a949082c7c.png",spriteFrames:9,duration:500}),FigureRules.add(".pumpkin.pumpkinDamage",{spriteFrames:3,playRound:!1,duration:250}),FigureRules.add(".pumpkinFire",{"background-position-x":0,"background-position-y":0,"background-width":86,"background-height":86,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/pumpkinFire.170350ca5d.png",width:86/60*Config.cellWidth,height:86/60*Config.cellHeight,spriteFrames:4,duration:200,playRound:!0}),FigureRules.add(".pumpkin.pumpkinDie",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/pumpkinDie.605a44e426.png",spriteFrames:8,duration:500,"margin-left":-.2*Config.cellWidth,"margin-top":-16/60*Config.cellHeight}),FigureRules.add(".pumpkinLife",{width:20/60*Config.cellWidth,height:14/60*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.2*Config.cellWidth+"px Tahoma",color:"#6b1200","text-left":43/60*Config.cellWidth,"text-top":67/60*Config.cellHeight,textAlign:"center"}),FigureRules.add(".cannonball",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/cannonball.d535fb1e6f.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".cannonball.cannonballExplosion",{"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin/cannonballExplosion.b4d5539a30.png",width:80/60*Config.cellWidth,height:80/60*Config.cellHeight,"margin-left":-10/60*Config.cellWidth,"margin-top":-.2*Config.cellHeight,spriteFrames:5,duration:400}),FigureRules.add(".fish8.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish8/task_fish8.1ce70e9c13.png"}),FigureRules.add(".fish9.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish9/task_fish9.f1d25e3d66.png"}),FigureRules.add(".fish10.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fish10/task_fish10.96795aeced.png"}),FigureRules.add(".attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":102,"background-height":92,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/falling/attribute_falling.b958c84f4e.png",width:.85*Config.cellWidth,height:46/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,spriteFrames:4,framesOrder:[0,1,2,1],duration:400,delay:[3e3,4e3],playRound:!0}),FigureRules.add(".turtleCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoise1.21993dd55b.png","background-width":75,"background-height":54,width:1.25*Config.cellWidth,height:.9*Config.cellHeight,"margin-left":-11/60*Config.cellWidth,"margin-top":8/60*Config.cellHeight}),FigureRules.add(".turtleCell.turtleLevel3",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoise1.21993dd55b.png"}),FigureRules.add(".turtleCell.turtleLevel2",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoise2.6fe3f05b5d.png"}),FigureRules.add(".turtleCell.turtleLevel1",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoise3.1e4b5b1e92.png"}),FigureRules.add(".turtle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoise3.1e4b5b1e92.png","background-width":75,"background-height":54,width:1.25*Config.cellWidth,height:.9*Config.cellHeight,"margin-left":-.05*Config.cellWidth,"margin-top":-.05*Config.cellHeight,spriteFrames:4,duration:300,playRound:!0}),FigureRules.add(".turtleCell.turtleLevel3 .zzz1.stable, .turtleCell.turtleLevel2 .zzz1.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/zzz.f16ebe163a.png","background-width":20,"background-height":24,width:20/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:16,duration:1400,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,10,10,10,10,10],playRound:!0}),FigureRules.add(".turtleCell.turtleLevel3 .zzz2.stable, .turtleCell.turtleLevel2 .zzz2.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/zzz.f16ebe163a.png","background-width":20,"background-height":24,width:20/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:16,duration:1400,framesOrder:[10,10,10,10,10,10,0,1,2,3,4,5,6,7,8,9],playRound:!0}),FigureRules.add(".turtleCell.turtleLevel2.turtleLifeTransition .zzz1, .turtleCell.turtleLevel2.turtleLifeTransition .zzz2",{opacity:"0"}),FigureRules.add(".turtleCell.turtleLevel1 .blink.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/tortoiseBlink.72762ba489.png","background-width":25,"background-height":13,width:25/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":13/60*Config.cellWidth,"margin-top":8/60*Config.cellHeight,spriteFrames:5,duration:300,framesOrder:[0,1,2,3,2],delay:[3e3,5e3],playRound:!0}),FigureRules.add(".flowerHead",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerBg.476a898b41.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".flowerFrog",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerHead.700b43b95b.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".flowerHead.powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-left":Config.cellWidth-20/60*Config.cellWidth,"margin-top":Config.cellHeight+20/60*Config.cellHeight}),FigureRules.add(".flowerFrog.stable",{spriteFrames:5,framesOrder:[0,1,2,3,2,1,0],delay:[2e3,6e3],lastFrame:0,duration:600,playRound:!0}),FigureRules.add(".flowerLife",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".flowerLife1, .flowerLife0",{"background-position-x":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerlifes.ff2c0b4594.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".flowerLife1",{"background-position-y":360}),FigureRules.add(".flowerLife0",{"background-position-y":0}),FigureRules.add(".flowerType_1_0 .flowerLife",{"scale-x":-1}),FigureRules.add(".flowerType_0_1 .flowerLife",{"scale-y":-1}),FigureRules.add(".flowerType_1_1 .flowerLife",{"scale-x":-1,"scale-y":-1}),FigureRules.add(".flowerLifeDone",{"background-position-x":1440}),FigureRules.add(".flowerTakeLife",{spriteFrames:5,duration:350,lastFrame:4}),FigureRules.add(".flowerHead.die",{"background-image":""}),FigureRules.add(".flowerHead.die .flowerFrog",{spriteFrames:10,framesOrder:[0,4,5,6,7,8,7,6,5,4],lastFrame:0,duration:600,playRound:!0}),FigureRules.add(".dieFlower .flowerType_0_0, .dieFlower .flowerType_1_0, .dieFlower .flowerType_0_1, .dieFlower .flowerType_1_1",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerBg.476a898b41.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".dieFlower .flowerType_0_0",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".dieFlower .flowerType_1_0",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".dieFlower .flowerType_0_1",{"background-position-x":0,"background-position-y":180}),FigureRules.add(".dieFlower .flowerType_1_1",{"background-position-x":180,"background-position-y":180}),FigureRules.add(".dieFlower",{width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".dieFlower .flowerType_0_0",{"margin-left":0,"margin-top":0}),FigureRules.add(".dieFlower .flowerType_1_0",{"margin-left":Config.cellWidth,"margin-top":0}),FigureRules.add(".dieFlower .flowerType_0_1",{"margin-left":0,"margin-top":Config.cellHeight}),FigureRules.add(".dieFlower .flowerType_1_1",{"margin-left":Config.cellWidth,"margin-top":Config.cellHeight}),FigureRules.add(".decorator_crabMouse",{"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse/mouse.ebcec92f80.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:400,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".decorator_crabMouse.takeLife",{"background-position-x":360}),FigureRules.add(".decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".move_crabMouse, .crabMouseCollect",{"background-position-x":480,"background-position-y":0,"background-width":176,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse/mouse.ebcec92f80.png",width:88/60*Config.cellWidth,height:Config.cellHeight,spriteFrames:2,duration:260,playRound:!0}),FigureRules.add(".move_crabMouse.moveRight",{"scale-x":-1,"margin-left":-28/60*Config.cellWidth}),FigureRules.add(".move_crabMouse .life",{opacity:"0"}),FigureRules.add(".decorator_greedypirate",{"background-position-y":0,"background-width":202,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate1.06ee9f055c.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight}),FigureRules.add(".move_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate1.06ee9f055c.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,lastFrame:2,duration:130,playRound:!1}),FigureRules.add(".grab_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate1.06ee9f055c.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:7,framesOrder:[3,4,5,6,7,8,9],duration:500,playRound:!1}),FigureRules.add(".decorator_greedypirate.hasCoins",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate2.71f7558256.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".decorator_greedypirate .coins",{opacity:0,font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#ffffff","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".sleep_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate2.71f7558256.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!0}),FigureRules.add(".hit_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate/greedyPirate2.71f7558256.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:2,lastFrame:2,framesOrder:[5,6],duration:250,playRound:!1}),FigureRules.add(".decorator_hunter",{"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotStable.cae93ace49.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-28/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,spriteFrames:5,duration:500,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".hunterLifeBlock",{"background-width":20,"background-height":20,width:20/60*Config.cellWidth,height:20/60*Config.cellHeight,"margin-left":68/60*Config.cellWidth,"margin-top":.8*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotLife.511778fa87.png"}),FigureRules.add(".decorator_hunter.left .hunterLifeBlock",{"scale-x":-1,"margin-left":28/60*Config.cellWidth}),FigureRules.add(".hunterLifeBlock .hunterLife",{opacity:1,textAlign:"center",font:"normal "+.25*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#0d1f02","text-left":10/60*Config.cellWidth,"text-top":16/60*Config.cellHeight}),FigureRules.add(".move_hunter",{"background-position-x":0,"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotMove.5c7a11abea.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-top":-8/60*Config.cellHeight,spriteFrames:10,duration:750,playRound:!1,delay:0}),FigureRules.add(".move_hunter.left",{"scale-x":-1}),FigureRules.add(".sleep_hunter",{"background-position-x":0,"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotDamage.02bb48963e.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-28/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,spriteFrames:9,duration:900,playRound:!0,delay:0}),FigureRules.add(".sleep_hunter.left",{"scale-x":-1}),FigureRules.add(".hit_hunter",{"background-position-x":0,"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotDamage.02bb48963e.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-28/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight}),FigureRules.add(".left.sleep_hunter",{"scale-x":-1,"margin-left":8/60*Config.cellWidth}),FigureRules.add(".left.hit_hunter",{"scale-x":-1,"margin-left":8/60*Config.cellWidth}),FigureRules.add(".die_hunter",{"background-position-x":0,"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotDamage.02bb48963e.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-28/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight}),FigureRules.add(".grab_hunter",{"background-position-x":0,"background-position-y":0,"background-width":88,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/hunter/parrotOpensDoor.f4f06169fd.png",width:80/60*Config.cellWidth,height:70/60*Config.cellHeight,"margin-left":-28/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,spriteFrames:11,duration:1100,playRound:!1,delay:0}),FigureRules.add(".huntertarget.opendoor",{"background-position-x":0,"background-position-y":0,"background-width":59,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/huntertarget/door.0d8ac013e7.png",width:Config.cellWidth/60*59,height:Config.cellHeight,spriteFrames:3,duration:250,playRound:!1,delay:0}),FigureRules.add(".huntertarget.closedoor",{"background-position-x":0,"background-position-y":0,"background-width":59,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/huntertarget/door.0d8ac013e7.png",width:Config.cellWidth/60*59,height:Config.cellHeight,spriteFrames:3,framesOrder:[2,1,0],duration:250,playRound:!1,delay:0}),FigureRules.add(".decorator_hunter.left",{"scale-x":-1,"margin-left":8/60*Config.cellWidth}),FigureRules.add(".crabMouseFarmCell",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmousefarm/hole.4f3cb59ba4.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".crabMouseFarmCellCrabMouse",{"background-position-x":600,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmousefarm/mouse.671d7b320a.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".crabMouseFarmLevel0 .crabMouseFarmCellCrabMouse.stable",{"background-image":""}),FigureRules.add(".crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":60,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":240,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":420,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":0,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":240,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":480,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".mouseFarmCell",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmousefarm/hole.4f3cb59ba4.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".farmCell",{"background-position-x":600,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmousefarm/mouse.671d7b320a.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".FarmLevel0 .farmCell.stable",{"background-image":""}),FigureRules.add(".FarmLevel1 .farmCell.stable",{"background-position-x":60,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".FarmLevel2 .farmCell.stable",{"background-position-x":240,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".FarmLevel3 .farmCell.stable",{"background-position-x":420,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".FarmLevel1 .farmCell.FarmMove",{"background-position-x":0,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".FarmLevel2 .farmCell.FarmMove",{"background-position-x":240,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".FarmLevel3 .farmCell.FarmMove",{"background-position-x":480,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".decorator_crabMouse",{"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse/mouse.ebcec92f80.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:400,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".decorator_crabMouse.takeLife",{"background-position-x":360}),FigureRules.add(".decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".move_crabMouse, .crabMouseCollect",{"background-position-x":480,"background-position-y":0,"background-width":176,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse/mouse.ebcec92f80.png",width:88/60*Config.cellWidth,height:Config.cellHeight,spriteFrames:2,duration:260,playRound:!0}),FigureRules.add(".move_crabMouse.moveRight",{"scale-x":-1,"margin-left":-28/60*Config.cellWidth}),FigureRules.add(".move_crabMouse .life",{opacity:"0"}),FigureRules.add(".decorator_monkey",{"background-position-x":0,"background-position-y":0,"background-width":90,"background-height":90,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/monkey/monkey.b0c919a6cf.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".decorator_monkey.stable",{spriteFrames:4,duration:500,framesOrder:[0,1,2,1],delay:[2e3,5e3],playRound:!0}),FigureRules.add(".decorator_monkey.die",{spriteFrames:2,duration:90,framesOrder:[3,4],playRound:!1}),FigureRules.add(".decorator_monkey.monkeyCollect",{"background-position-x":450}),FigureRules.add(".fishcellBg.fish12",{"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy/garment1.023712c834.png"}),FigureRules.add(".fishcellBg.fish13",{"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy/garment2.25c41e7c1b.png"}),FigureRules.add(".fishcellBg.fish14",{"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy/garment3.ad2c0ca4e4.png"}),FigureRules.add(".fishcellBg.fish15",{"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy/garment4.90e4c5cc39.png"}),FigureRules.add(".chestCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chest/chest.45fc7be6b5.png","background-width":80,"background-height":124,width:Config.cellWidth,height:1.55*Config.cellHeight,"margin-top":-.55*Config.cellHeight,"background-position-x":0,"background-position-y":0}),FigureRules.add(".chestCell .microStones",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chest/microStones.73c88fb093.png","background-width":80,"background-height":124,width:Config.cellWidth,height:1.55*Config.cellHeight,"background-position-x":0}),FigureRules.add(".chestColor_B .microStones",{"background-position-y":0}),FigureRules.add(".chestColor_G .microStones",{"background-position-y":124}),FigureRules.add(".chestColor_P .microStones",{"background-position-y":248}),FigureRules.add(".chestColor_R .microStones",{"background-position-y":372}),FigureRules.add(".chestColor_W .microStones",{"background-position-y":496}),FigureRules.add(".chestColor_Y .microStones",{"background-position-y":620}),FigureRules.add(".chestCell.beforeRemove",{"background-position-x":80,spriteFrames:9,duration:700,playRound:!1}),FigureRules.add(".chestCell.beforeRemove .microStones",{"background-position-x":80,spriteFrames:3,duration:700,playRound:!1}),FigureRules.add(".chestCell.afterRemove,",{"background-position-x":800}),FigureRules.add(".chestCell.afterRemove .microStones",{"background-image":""}),FigureRules.add(".chestCell .needToOpen",{"text-left":.5*Config.cellWidth,"text-top":73/60*Config.cellHeight,font:"bold "+16/60*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Tahoma",color:"#000000",textAlign:"center"}),FigureRules.add(".chestCell .needToOpen.twoDigit",{"text-left":.5*Config.cellWidth,"text-top":1.2*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px Tahoma",color:"#000000",textAlign:"center"}),FigureRules.add(".chestColor_R .needToOpen, .chestColor_P .needToOpen, .chestColor_R .chestCell .needToOpen.twoDigit, .chestColor_P .chestCell .needToOpen.twoDigit",{color:"#ffffff"}),FigureRules.add(".gull",{"background-position-x":0,"background-position-y":0,"background-width":200,"background-height":139,"margin-left":-100,"margin-top":-139,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gull/gull.da1b2ce82c.png",width:200,height:139,spriteFrames:10,framesOrder:[0,1,2,3,1,4,5,6,3,1],lastFrame:0,duration:1e3,playRound:!0}),FigureRules.add(".gull.snatch",{startFrame:2,spriteFrames:6,framesOrder:[2,1,3,0,1,2],lastFrame:0,duration:600,playRound:!0,spriteVertical:!0}),FigureRules.add(".gull.snatch .paw",{"margin-left":70,"margin-top":112}),FigureRules.add(".gull.free",{"background-position-x":0,spriteFrames:10,framesOrder:[0,1,2,3,1,4,5,6,3,1],lastFrame:0,duration:1e3,playRound:!0}),FigureRules.add(".fishBallCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":222,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishBall/fishBall.abc5be39a1.png","margin-left":0,"margin-top":-26/180*Config.cellHeight,width:1*Config.cellWidth,height:222/180*Config.cellHeight,spriteFrames:4,framesOrder:[0,1,2,1],delay:[1e3,2e3],duration:600,playRound:!0}),FigureRules.add(".fishBallCell.powerUpHighlight",{animation:{params:{"margin-top":[-26/180*Config.cellHeight,-42/180*Config.cellHeight]},duration:200}}),FigureRules.add(".fishBallCell.fishBallAngry",{startFrame:3,spriteFrames:4,duration:600,playRound:!0}),FigureRules.add(".fishBallCell.create",{"background-width":180,"background-height":222,"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishBall/fishBallJump.0abc3f08a8.png","margin-left":0,"margin-top":-26/180*Config.cellHeight,width:1*Config.cellWidth,height:222/180*Config.cellHeight,spriteFrames:8,duration:800,playRound:!1}),FigureRules.add(".fishBallCell.fishBallDie",{startFrame:7,spriteFrames:2,duration:200,playRound:!1}),FigureRules.add(".fishBallCell.fishBallFly",{startFrame:9,spriteFrames:10,duration:800,playRound:!1}),FigureRules.add(".fishBallCell .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":51,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlockSoc.f27a59efc8.png",width:170/180*Config.cellWidth,height:51/180*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight}),FigureRules.add(".fishBallCell.fishBallDie .lifeBlock, .fishBallCell.fishBallFly .lifeBlock, .fishBallCell.create .lifeBlock",{opacity:0}),FigureRules.add(".fishBallCell .shallow",{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeYellow.45b3115da4.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".fishBallCell .middle",{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeGreen.c90bcd3e5f.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".fishBallCell .deep",{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBGreen.10127306b5.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".alligatorlighthouseCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight}),FigureRules.add(".bigChestHeadCell",{"margin-top":0}),FigureRules.add(".bigChestBody",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bigchest/lightningBoxIdle.e4afc15a8c.png","background-width":255,"background-height":257,width:4.25*Config.cellWidth,height:257/60*Config.cellHeight,"margin-left":-67/60*Config.cellWidth,"margin-top":-65/60*Config.cellHeight}),FigureRules.add(".bigChestBody.stable",{spriteFrames:7,duration:500,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".bigChestBody.hit",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bigchest/lightningBoxDamaged.2239534075.png",spriteFrames:9,duration:600}),FigureRules.add(".bigChestBody.opened",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bigchest/lightningBoxOpen.47c694f89b.png",spriteFrames:15,framesOrder:[0,1,2,1,3,4,5,6,7,8,9,10,11,12,13],duration:1100,playRound:!1}),FigureRules.add(".bigChestBody .bigChestCell",{"background-width":64,"background-height":64,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bigchest/chestStones.10ef43b76b.png",width:.6*Config.cellWidth,height:.6*Config.cellHeight,"margin-top":124/60*Config.cellHeight}),FigureRules.add(".bigChestBody .bigChestCell1",{"margin-left":85/60*Config.cellWidth}),FigureRules.add(".bigChestBody .bigChestCell2",{"margin-left":133/60*Config.cellWidth}),FigureRules.add(".bigChestBody .bigChestCell.color_R",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":0}),FigureRules.add(".bigChestBody .bigChestCell.color_G",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":64}),FigureRules.add(".bigChestBody .bigChestCell.color_B",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":128}),FigureRules.add(".bigChestBody .bigChestCell.color_Y",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":192}),FigureRules.add(".bigChestBody .bigChestCell.color_P",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":256}),FigureRules.add(".bigChestBody .bigChestCell.color_",{"background-width":64,"background-height":64,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"background-position-x":256}),FigureRules.add(".bigChestBody .bigChestCell .bigChestCellLife",{textAlign:"center",font:"normal "+25/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#ffffff","text-left":.3*Config.cellWidth,"text-top":26/60*Config.cellHeight,lineWidth:1/60*Config.cellWidth,strokeStyle:"#a33300"}),FigureRules.add(".coinChestHeadCell",{width:131/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest/web/coinChest_large.bf11d4cc57.png"}),FigureRules.add(".coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".coinChestCell",{opacity:1,"background-width":180,"background-height":180,width:.6*Config.cellWidth,height:.6*Config.cellHeight,"margin-top":46/60*Config.cellHeight}),FigureRules.add(".coinChestColorNext",{width:20/60*Config.cellWidth,height:20/60*Config.cellHeight,"margin-left":29/60*Config.cellWidth,"margin-top":.9*Config.cellHeight}),FigureRules.add(".coinChestColor",{"margin-left":47/60*Config.cellWidth}),FigureRules.add(".coinChestColorPrev",{width:20/60*Config.cellWidth,height:20/60*Config.cellHeight,"margin-left":82/60*Config.cellWidth,"margin-top":.9*Config.cellHeight}),FigureRules.add(".coinChestCell.color_R",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_R.46d878744f.png"}),FigureRules.add(".coinChestCell.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_G.b89dd075cb.png"}),FigureRules.add(".coinChestCell.color_B",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_B.ae1e312675.png"}),FigureRules.add(".coinChestCell.color_Y",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Y.53f87ef80a.png"}),FigureRules.add(".coinChestCell.color_P",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_P.20cab9d90d.png"}),FigureRules.add(".coinChestCell.color_W",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_W.1ef765c038.png"}),FigureRules.add(".coinChestCell.color_",{"background-image":"../../../gems/site/img/features/base/base/color_Pearl.png"}),FigureRules.add(".coinChestCell.color_any",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest/color_any.ce031a0626.png"}),FigureRules.add(".coinChestLifeBlock .coinChestLife",{opacity:1,textAlign:"center",font:"normal "+20/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#ffc600","text-left":65/60*Config.cellWidth,"text-top":.6*Config.cellHeight}),FigureRules.add(".coinChestHeadCell.opened .coinChestLifeBlock .coinChestLife, .coinChestHeadCell.opened .coinChestCell",{opacity:0}),FigureRules.add(".coinChestHeadCell.closed .coinChestLifeBlock .coinChestLife, .coinChestHeadCell.closed .coinChestCell",{opacity:0}),FigureRules.add(".genrymorganLeftHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan/hand.5bcb2783ad.png","scale-x":-1}),FigureRules.add(".genrymorganRightHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan/hand.5bcb2783ad.png"}),FigureRules.add(".genrymorganLeftHand.process, .genrymorganRightHand.process",{"background-position-x":60}),FigureRules.add(".genrymorganLeftHand.stable",{"margin-left":-.4*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".genrymorganRightHand.stable",{"margin-left":.4*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".genrymorganFly",{width:119/60*Config.cellWidth,height:151/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,"background-width":119,"background-height":151,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan/genryFly.b268fe24bb.png",spriteFrames:10,duration:1e3}),FigureRules.add(".genrymorganLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":110/60*Config.cellHeight}),FigureRules.add(".genrymorganLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".less50PercentLife.genrymorganLife",{"background-color":"#ffff00"}),FigureRules.add(".less25PercentLife.genrymorganLife",{"background-color":"#f2342c"}),FigureRules.add(".genrymorganHeadCell.cell",{width:119/60*Config.cellWidth,height:151/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,"background-width":119,"background-height":151,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan/genry.e4f912e17f.png"}),FigureRules.add(".genrymorganHeadCell.powerUpHighlight",{animation:{params:{"margin-top":[-.25*Config.cellHeight,-20/60*Config.cellHeight]},duration:200}}),FigureRules.add(".genrymorganHeadCell.cell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-17/60*Config.cellHeight}),FigureRules.add(".genrymorganHeadCell.cell.stable",{spriteFrames:17,duration:900,framesOrder:[0,1,2,3,4,5,6,7,8,5,6,7,8,5,6,7,8],playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".genrymorganHeadCell.cell.genrymorganAngry",{spriteFrames:3,framesOrder:[9,10,11],duration:300}),FigureRules.add(".genrymorganLifeBlock .genrymorganLife",{opacity:1,textAlign:"center",font:"normal "+20/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#ffc600","text-left":65/60*Config.cellWidth,"text-top":.6*Config.cellHeight}),FigureRules.add(".magneto",{width:Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magneto/magneto.41e2909123.png","background-width":60,"background-height":60,scale:.8}),FigureRules.add(".magneto.color_R",{"background-position-x":0}),FigureRules.add(".magneto.color_G",{"background-position-x":60}),FigureRules.add(".magneto.color_B",{"background-position-x":120}),FigureRules.add(".magneto.color_Y",{"background-position-x":180}),FigureRules.add(".magneto.color_P",{"background-position-x":240}),FigureRules.add(".magneto.color_W",{"background-position-x":300}),FigureRules.add(".magneto.color_",{"background-position-x":300}),FigureRules.add(".magneto.bzzz .stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magneto/bzzz.88da749280.png","background-width":48,"background-height":57,width:.8*Config.cellWidth,height:.95*Config.cellHeight,"margin-left":.1*Config.cellWidth,"margin-top":-32/60*Config.cellHeight,rotate:180,spriteFrames:11,duration:450,playRound:!0}),FigureRules.add(".maelstorm",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/maelstorm/maelstorm.ae50931d32.png","background-width":120,"background-height":120,width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".maelstorm.leftDirection",{"scale-x":-1}),FigureRules.add(".maelstorm.speedUp",{animation:{params:{speedRotate:[30,300]},duration:600}}),FigureRules.add(".frogCell",{width:1.55*Config.cellWidth,height:1.55*Config.cellHeight,"margin-left":-34/120*Config.cellWidth,"margin-top":-62/120*Config.cellHeight,"background-width":186,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogStable.05a8384497.png"}),FigureRules.add(".frogCell.stable",{spriteFrames:10,duration:500,playRound:!0}),FigureRules.add(".frogCell.movingRight",{"scale-x":-1,"margin-left":-32/120*Config.cellWidth}),FigureRules.add(".frogCell.movingStart",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogJump.9194bc5743.png",spriteFrames:3,duration:150}),FigureRules.add(".frogCell.blink",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogStableBlink.26a496ded7.png",spriteFrames:10,duration:300}),FigureRules.add(".frogCell.moving",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogJump.9194bc5743.png",spriteFrames:6,framesOrder:[3,4,5,6,7,8],duration:300}),FigureRules.add(".frogCell.eat",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogEat.484c9dd23e.png",spriteFrames:10,duration:300}),FigureRules.add(".frogfuelCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":""}),FigureRules.add(".frogfuelCell .cellStone",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180}),FigureRules.add(".frogfuelCell_R .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_R.7dd1474f65.png"}),FigureRules.add(".frogfuelCell_G .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_G.55eb74a141.png"}),FigureRules.add(".frogfuelCell_B .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_B.e1c976b5af.png"}),FigureRules.add(".frogfuelCell_Y .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_Y.17840c3df7.png"}),FigureRules.add(".frogfuelCell_P .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_P.be025ee07e.png"}),FigureRules.add(".frogfuelCell_W .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogFuel_W.df01c61c68.png"}),FigureRules.add(".frogpath",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogPath.4d271cc033.png"}),FigureRules.add(".frogtarget",{width:1.55*Config.cellWidth,height:1.625*Config.cellHeight,"margin-left":-31/120*Config.cellWidth,"margin-top":-80/120*Config.cellHeight,"background-width":186,"background-height":195,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogTarget.f211b1174b.png",spriteFrames:15,duration:750,delay:[3e3,5e3]}),FigureRules.add(".frogtarget.done",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog/frogHouse.8fcb54740c.png",spriteFrames:13,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11,12],duration:1e3}),FigureRules.add(".stream",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stream/streamLine.5970a05878.png"}),FigureRules.add(".stream.moving",{spriteFrames:6,duration:666,playRound:!1}),FigureRules.add(".stream_up",{rotate:90}),FigureRules.add(".stream_down",{rotate:-90}),FigureRules.add(".stream_left",{}),FigureRules.add(".stream_right",{rotate:180}),FigureRules.add(".turn_up_left, .turn_left_down, .turn_down_right, .turn_right_up",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stream/streamCorner.138f728260.png"}),FigureRules.add(".turn_left_up, .turn_up_right, .turn_right_down, .turn_down_left",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stream/streamCornerClockwise.abf7f3465d.png"}),FigureRules.add(".turn_left_up",{rotate:-90}),FigureRules.add(".turn_up_right",{rotate:0}),FigureRules.add(".turn_right_down",{rotate:90}),FigureRules.add(".turn_down_left",{rotate:180}),FigureRules.add(".portal",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/portal/portal_in.1b3b4a3729.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".portal_in",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/portal/portal_in.1b3b4a3729.png"}),FigureRules.add(".portal_out",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/portal/portal_out.a02fa6b320.png"}),FigureRules.add(".frozen",{width:1.85*Config.cellWidth,height:1.85*Config.cellHeight,"margin-left":.075*Config.cellWidth,"margin-top":.075*Config.cellHeight,"background-width":111,"background-height":111}),FigureRules.add(".frozen_amonite1",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/amonite/amonite1.7b7e9c9886.png"}),FigureRules.add(".frozen_amonite2",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/amonite/amonite2.a30a8bf3d4.png"}),FigureRules.add(".frozen_amonite3",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/amonite/amonite3.9e45efdb7f.png"}),FigureRules.add(".frozenegg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,animation:{params:{"scale-x":[1,1.1,1.05,1.1,1.05,1],"scale-y":[1,1.05,1.1,1.05,1.1,1]},duration:1e3,playRoundDelay:[2e3,1e4],delay:[1e3,3e3],playRound:!0}}),FigureRules.add(".frozen_frozenegg.variant1",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg1.2e03356483.png"}),FigureRules.add(".frozen_frozenegg.variant2",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg2.e0cdee723d.png"}),FigureRules.add(".frozen_frozenegg.variant3",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg3.6867fe3977.png"}),FigureRules.add(".frozen_frozenegg.variant4",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg4.787a5257a6.png"}),FigureRules.add(".frozen_frozenegg.variant5",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/egg5.b25ba67c28.png"}),FigureRules.add(".frozen_frozenegg.variantbig1",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig1.542282f1d8.png"}),FigureRules.add(".frozen_frozenegg.variantbig2",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig2.3ca5c69000.png"}),FigureRules.add(".frozen_frozenegg.variantbig3",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbig3.17e7e7e835.png"}),FigureRules.add(".frozen_frozenegg.variantbigVertical1",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":353,"background-height":547,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigVertical1.5084d50b67.png"}),FigureRules.add(".frozen_frozenegg.variantbigVertical2",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":353,"background-height":547,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigVertical1.5084d50b67.png"}),FigureRules.add(".frozen_frozenegg.variantbigVertical3",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":353,"background-height":547,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigVertical1.5084d50b67.png"}),FigureRules.add(".frozen_frozenegg.variantbigHorizontal1",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":516,"background-height":352,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigHorizontal1.5212f36e8b.png"}),FigureRules.add(".frozen_frozenegg.variantbigHorizontal2",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":516,"background-height":352,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigHorizontal1.5212f36e8b.png"}),FigureRules.add(".frozen_frozenegg.variantbigHorizontal3",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":516,"background-height":352,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg/eggbigHorizontal1.5212f36e8b.png"}),FigureRules.add(".parts .sailPart",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".parts .sailPart.topLeft",{"background-width":66,"background-height":63,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticTopLeft.56f21d495b.png",width:199/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-17/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.topCenter",{"background-width":182,"background-height":189,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticTopCenter.2aa2387507.png",width:182/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-1/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.topRight",{"background-width":66,"background-height":63,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticTopRight.bf4dc7cf68.png",width:200/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.centerLeft",{"background-width":62,"background-height":60,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticCenterLeft.83f47a8105.png",width:186/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-5/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.centerCenter",{"background-width":182,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticCenterCenter.5036b9597d.png",width:182/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-1/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.centerRight",{"background-width":66,"background-height":60,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticCenterRight.6a8f28f183.png",width:200/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.bottomLeft",{"background-width":66,"background-height":62,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticBottomLeft.99846dc2a4.png",width:200/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-17/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.bottomCenter",{"background-width":182,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticBottomCenter.43f59da884.png",width:182/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-1/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.bottomRight",{"background-width":66,"background-height":62,"background-indent":2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/staticBottomRight.51cb9b0588.png",width:200/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,spriteFrames:32,duration:2100,playRound:!0}),FigureRules.add(".parts .sailPart.topLeft.closing",{"background-width":200,"background-height":189,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingTopLeft.4e1e4d1fbc.png",width:200/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-17/180*Config.cellWidth,"margin-top":-.05*Config.cellHeight,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.topCenter.closing",{"background-width":184,"background-height":189,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingTopCenter.612c5fa91b.png",width:184/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,"margin-top":-.05*Config.cellHeight,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.topRight.closing",{"background-width":202,"background-height":189,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingTopRight.9a3b89098e.png",width:202/180*Config.cellWidth,height:1.05*Config.cellHeight,"margin-left":-3/180*Config.cellWidth,"margin-top":-.05*Config.cellHeight,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.centerLeft.closing",{"background-width":188,"background-height":180,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingCenterLeft.a64cfd5431.png",width:188/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-5/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.centerCenter.closing",{"background-width":184,"background-height":180,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingCenterCenter.ad28a48649.png",width:184/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.centerRight.closing",{"background-width":201,"background-height":180,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingCenterRight.ddec635cc3.png",width:201/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":-3/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.bottomLeft.closing",{"background-width":200,"background-height":186,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBottomLeft.5b602bbcaa.png",width:200/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-17/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.bottomCenter.closing",{"background-width":184,"background-height":186,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBottomCenter.e02345abc0.png",width:184/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".parts .sailPart.bottomRight.closing",{"background-width":202,"background-height":186,"background-indent":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/closingBottomRight.81c49c4b9a.png",width:202/180*Config.cellWidth,height:186/180*Config.cellHeight,"margin-left":-3/180*Config.cellWidth,spriteFrames:6,duration:210,playRound:!1}),FigureRules.add(".sail .bar",{"background-position-x":0,"background-position-y":0,"scale-y":1.2}),FigureRules.add(".sail .bar .barPart.left",{"background-width":192,"background-height":68,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barLeft.e5ba370916.png",width:192/180*Config.cellWidth,height:68/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,spriteFrames:1,duration:350,playRound:!0}),FigureRules.add(".sail .bar .barPart.center",{"background-width":180,"background-height":68,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barCenter.1e082b7961.png",width:1*Config.cellWidth,height:68/180*Config.cellHeight,spriteFrames:1,duration:350,playRound:!0}),FigureRules.add(".sail .bar .barPart.right",{"background-width":204,"background-height":68,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barRight.48cfaccadb.png",width:204/180*Config.cellWidth,height:68/180*Config.cellHeight,spriteFrames:1,duration:350,playRound:!0}),FigureRules.add(".sail .bar .barPart.left.closing",{"background-width":192,"background-height":75,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingLeft.2098d18ddb.png",width:192/180*Config.cellWidth,height:75/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,spriteFrames:6,duration:350,playRound:!0}),FigureRules.add(".sail .bar .barPart.center.closing",{"background-width":180,"background-height":75,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingCenter.0f9d3d2a8b.png",width:1*Config.cellWidth,height:75/180*Config.cellHeight,spriteFrames:6,duration:350,playRound:!0}),FigureRules.add(".sail .bar .barPart.right.closing",{"background-width":204,"background-height":75,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/barClosingRight.7ecd73bf8f.png",width:204/180*Config.cellWidth,height:75/180*Config.cellHeight,"margin-left":-2/180*Config.cellWidth,spriteFrames:6,duration:350,playRound:!0}),FigureRules.add(".sail .taskBlock",{"background-width":183,"background-height":193,width:183/180*Config.cellWidth,height:193/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/patch.82193df4ba.png"}),FigureRules.add(".sail .taskWrapper",{"background-width":28,"background-height":36,width:28/180*Config.cellWidth,height:.2*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/taskBlockAnchor.605bdce0c2.png"}),FigureRules.add(".sail .rope.active",{"background-width":26,"background-height":149,width:26/180*Config.cellWidth,height:149/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/sailRope.973f62bfe0.png"}),FigureRules.add(".sail .ropeTop.active",{"background-width":22,"background-height":75,width:22/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/sailRopeTop.54dc4b971e.png"}),FigureRules.add(".sail .ropeBottom.active",{"background-width":26,"background-height":85,width:26/180*Config.cellWidth,height:85/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/sailRopeBottom.e4756e6744.png"}),FigureRules.add(".sail .ropeCutFlare.processing",{"background-width":196,"background-height":84,width:196/180*Config.cellWidth,height:84/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/ropeCutFlare.4f0ff0676a.png",spriteFrames:5,duration:300,playRound:!1}),FigureRules.add(".sail .taskIconContainer",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".sail .taskIconContainer .taskIco",{"background-height":180,"background-width":180,"margin-left":1/120*Config.cellWidth,"margin-top":.05*Config.cellHeight,height:Config.cellHeight,width:Config.cellWidth,scale:.7}),FigureRules.add(".sail .taskIconContainer .taskIco.color_R",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_R.46d878744f.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_G.b89dd075cb.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_B",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_B.ae1e312675.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_Y",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Y.53f87ef80a.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_P",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_P.20cab9d90d.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_W",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_W.1ef765c038.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Pearl.d109d28766.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_N",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/water.e8b6c970e0.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_CollectCaviar",{"background-height":80,"background-width":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/caviarTask.77e1e833c3.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_U",{"background-height":80,"background-width":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/coconutTask.4a3d74cfa3.png"}),FigureRules.add(".sail .taskIconContainer .taskIco.color_ClearFallingCellAttributes",{"background-height":80,"background-width":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/sail/fallingTask.7de4233154.png"}),FigureRules.add(".sail .text",{width:Config.cellWidth,height:16/60*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#863f01",lineWidth:4,textAlign:"center","margin-left":32/60*Config.cellWidth,"margin-top":.8*Config.cellHeight}),FigureRules.add(".episode_cosmo .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cosmo/garment1.png"}),FigureRules.add(".episode_cosmo .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cosmo/garment2.png"}),FigureRules.add(".episode_cosmo .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cosmo/garment3.png"}),FigureRules.add(".episode_cosmo .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cosmo/garment4.png"}),FigureRules.add(".episode_cosmo .fish6.fishcellBg",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cosmo/fish.png"}),FigureRules.add(".episode_cosmo .color_R .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starR.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_G .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starG.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_B .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starB.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_Y .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starY.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_P .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starP.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_W .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starW.png","background-width":180,"background-height":180}),FigureRules.add(".episode_cosmo .color_ .attribute_key",{"background-image":"../../../gems/site/img/features/cosmo/starW.png","background-width":180,"background-height":180}),FigureRules.add(".candyCell.candyCell2 .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/candy/candyStatic.ee6f399777.png","background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"margin-left":-10/60*Config.cellWidth,"margin-top":-.1*Config.cellHeight,width:80/60*Config.cellWidth,height:80/60*Config.cellHeight}),FigureRules.add(".candyCell.candyCell1 .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/candy/candyStatic.ee6f399777.png","background-position-x":1620,"background-position-y":0,"background-width":180,"background-height":180,"margin-left":-10/60*Config.cellWidth,"margin-top":-.1*Config.cellHeight,width:80/60*Config.cellWidth,height:80/60*Config.cellHeight}),FigureRules.add(".candyCell.candyCellRemove .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/candy/candyDie.0c4e6bb778.png","background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"margin-left":-10/60*Config.cellWidth,"margin-top":-.1*Config.cellHeight,width:80/60*Config.cellWidth,height:80/60*Config.cellHeight}),FigureRules.add(".caviarCell",{"background-image":""}),FigureRules.add(".caviarCell .cellStone",{"background-width":300,"background-height":180,width:100/60*Config.cellWidth,height:Config.cellHeight,"margin-left":-20/60*Config.cellWidth}),FigureRules.add(".caviarCell.caviarCell3 .cellStone",{"background-position-x":0}),FigureRules.add(".caviarCell.caviarCell3 .stable",{animation:{params:{"scale-x":[1,1.1,1.05,1.1,1.05,1],"scale-y":[1,1.05,1.1,1.05,1.1,1]},duration:1e3,playRoundDelay:[2e3,1e4],delay:[1e3,3e3],playRound:!0}}),FigureRules.add(".caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".caviarCell.caviarCell2 .stable",{animation:{params:{"scale-x":[1,1.2,1.1,1.2,1.1,1],"scale-y":[1,1.1,1.2,1.1,1.2,1]},duration:1e3,playRoundDelay:[2e3,1e4],delay:[1e3,3e3],playRound:!0}}),FigureRules.add(".caviarCell .cellStone.caviarTakeLife1",{startFrame:1,spriteFrames:7,duration:700}),FigureRules.add(".caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".caviarCell_R .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_R.1468a33497.png"}),FigureRules.add(".caviarCell_G .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_G.f0b4051bbf.png"}),FigureRules.add(".caviarCell_B .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_B.e7c6d3f496.png"}),FigureRules.add(".caviarCell_Y .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_Y.fe9ce1723e.png"}),FigureRules.add(".caviarCell_P .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_P.a9576adcc9.png"}),FigureRules.add(".caviarCell_W .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar/caviar_W.c6f4285c78.png"}),FigureRules.add(".popUpColorCell .popBody",{width:133/3/60*Config.cellWidth,height:154/3/60*Config.cellHeight,"background-width":133,"background-height":154,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/body.b2024c068f.png","margin-left":47/6/60*Config.cellWidth,"margin-top":26/6/60*Config.cellHeight}),FigureRules.add(".popUpColorCell.upAnimate .popBody.stable",{spriteFrames:6,duration:300}),FigureRules.add(".popUpColorCell .popEyes.stable",{width:53/3/60*Config.cellWidth,height:32/3/60*Config.cellHeight,"background-width":53,"background-height":32,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/eyes.26ceb0911c.png","margin-left":.35*Config.cellWidth,"margin-top":16/60*Config.cellHeight}),FigureRules.add(".popUpColorCell .popEyes.stable",{spriteFrames:5,framesOrder:[0,1,2,1,0],duration:250,delay:[2e3,4e3],playRound:!0}),FigureRules.add(".popUpColorCell .popMouth",{width:31/3/60*Config.cellWidth,height:5/60*Config.cellHeight,"background-width":31,"background-height":15,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/mouth.bed443d424.png","margin-left":25/60*Config.cellWidth,"margin-top":28/60*Config.cellHeight}),FigureRules.add(".popUpColorCell.removal .popMouth.stable",{spriteFrames:3,duration:150}),FigureRules.add(".popUpColorExplode",{width:310/60*Config.cellWidth,height:4.4*Config.cellHeight,"background-width":310,"background-height":264,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/medusaBoom.1412f77bd7.png","margin-left":-2.2*Config.cellWidth,"margin-top":-1.55*Config.cellHeight,spriteFrames:4,duration:600,lastFrame:3}),FigureRules.add(".popUpColorCell.explode .popBody, .popUpColorCell.explode .popEyes, .popUpColorCell.explode .popMouth",{opacity:0}),FigureRules.add(".popUpColorCell.popUp .popBody.stable",{animation:{params:{"margin-top":[Config.cellHeight,26/6/60*Config.cellHeight],"background-height":[0,154],height:[0,154/3/60*Config.cellHeight]},duration:300}}),FigureRules.add(".popUpColorCell.popUp .popEyes.stable",{animation:{params:{"margin-top":[Config.cellHeight,16/60*Config.cellHeight]},duration:300}}),FigureRules.add(".popUpColorCell.popUp .popMouth.stable",{animation:{params:{"margin-top":[Config.cellHeight,28/60*Config.cellHeight]},duration:300}}),FigureRules.add(".PopUpColorCellBubble",{width:Config.cellWidth,height:92/3/60*Config.cellHeight,"background-width":182,"background-height":92,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/medusaBubbles.1c95f9bdbd.png","margin-top":.5*Config.cellWidth,spriteFrames:6,duration:600,spriteVertical:!0}),FigureRules.add(".popUpColor_G .popBody",{"background-position-y":154}),FigureRules.add(".popUpColor_B .popBody",{"background-position-y":308}),FigureRules.add(".popUpColor_Y .popBody",{"background-position-y":462}),FigureRules.add(".popUpColor_P .popBody",{"background-position-y":616}),FigureRules.add(".popUpColor_W .popBody",{"background-position-y":770}),FigureRules.add(".popUpColor_ .popBody",{"background-position-y":770}),FigureRules.add(".popUpColor_G .popEyes",{"background-position-x":159}),FigureRules.add(".popUpColor_B .popEyes",{"background-position-y":32}),FigureRules.add(".popUpColor_Y .popEyes",{"background-position-x":159,"background-position-y":32}),FigureRules.add(".popUpColor_P .popEyes",{"background-position-y":64}),FigureRules.add(".popUpColor_W .popEyes",{"background-position-x":159,"background-position-y":64}),FigureRules.add(".popUpColor_ .popEyes",{"background-position-x":159,"background-position-y":64}),FigureRules.add(".popUpColor_G .popMouth",{"background-position-x":93}),FigureRules.add(".popUpColor_B .popMouth",{"background-position-x":186}),FigureRules.add(".popUpColor_Y .popMouth",{"background-position-x":279}),FigureRules.add(".popUpColor_P .popMouth",{"background-position-x":372}),FigureRules.add(".popUpColor_W .popMouth",{"background-position-x":465}),FigureRules.add(".popUpColor_ .popMouth",{"background-position-x":465}),FigureRules.add(".popUpColorCell .popDanger.onTheEdge",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/popupcolor/medusaDanger.cbc8081606.png","margin-left":0,"margin-top":0,spriteFrames:5,duration:1e3,framesOrder:[0,1,2,1,0],lastFrame:0,playRound:!0,delay:[2e3,3e3]}),FigureRules.add(".groundCell",{width:1.2*Config.cellWidth,height:1.2*Config.cellHeight,"background-width":213,"background-height":213,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/ground.bd4ea77628.png","margin-left":-.1*Config.cellWidth,"margin-top":-.1*Config.cellHeight}),FigureRules.add(".groundCell.explode",{spriteFrames:4,duration:400}),FigureRules.add(".groundExplode",{width:1.2*Config.cellWidth,height:1.2*Config.cellHeight,"background-width":72,"background-height":72,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/groundBreak.4873230246.png","margin-left":-.1*Config.cellWidth,"margin-top":-.1*Config.cellHeight}),FigureRules.add(".groundExplode1.groundExplode",{"background-position-x":0}),FigureRules.add(".groundExplode2.groundExplode",{"background-position-x":72}),FigureRules.add(".groundExplode3.groundExplode",{"background-position-x":144}),FigureRules.add(".groundExplode4.groundExplode",{"background-position-x":216}),FigureRules.add(".episode_catacomb .fish5.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/pickaxe.46d46ef1d5.png"}),FigureRules.add(".episode_catacomb .fish6.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/minecart.0c19231cd6.png"}),FigureRules.add(".episode_catacomb .fish7.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/tnt.e5eebffae5.png"}),FigureRules.add(".episode_catacomb .TNT",{width:Config.cellWidth,height:Config.cellHeight,"background-image":"",spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_catacomb .TNT .cellSubBg",{width:Config.cellWidth,height:Config.cellHeight/2,"background-width":180,"background-height":90,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteStep.1d40e35e49.png"}),FigureRules.add(".episode_catacomb .TNT.movesToExplode6 .cellSubBg",{"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_catacomb .TNT.movesToExplode3 .cellSubBg",{"margin-top":.1*Config.cellHeight}),FigureRules.add(".episode_catacomb .TNT.color_G .cellSubBg",{"background-position-x":180}),FigureRules.add(".episode_catacomb .TNT.color_B .cellSubBg",{"background-position-x":360}),FigureRules.add(".episode_catacomb .TNT.color_Y .cellSubBg",{"background-position-x":540}),FigureRules.add(".episode_catacomb .TNT.color_P .cellSubBg",{"background-position-x":720}),FigureRules.add(".episode_catacomb .TNT.color_W .cellSubBg",{"background-position-x":900});FigureRules.add(".episode_catacomb .TNT.color_ .cellSubBg",{"background-position-x":900}),FigureRules.add(".episode_catacomb .bomb .cellSubWrapper",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteBg.ba08b01073.png"}),FigureRules.add(".episode_catacomb .bomb .cellStone",{width:.5*Config.cellWidth,height:20/60*Config.cellHeight,"margin-left":.25*Config.cellWidth,"margin-top":.55*Config.cellHeight}),FigureRules.add(".episode_catacomb .bomb.color_R .cellStone",{"background-color":"#ff0026"}),FigureRules.add(".episode_catacomb .bomb.color_G .cellStone",{"background-color":"#54dc04"}),FigureRules.add(".episode_catacomb .bomb.color_B .cellStone",{"background-color":"#1b84fd"}),FigureRules.add(".episode_catacomb .bomb.color_Y .cellStone",{"background-color":"#f7db00"}),FigureRules.add(".episode_catacomb .bomb.color_P .cellStone",{"background-color":"#da58d4"}),FigureRules.add(".episode_catacomb .bomb.color_W .cellStone",{"background-color":"#ffffff"}),FigureRules.add(".episode_catacomb .bomb.color_ .cellStone",{"background-color":"#ffffff"}),FigureRules.add(".episode_catacomb .bombMoves",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/dynamiteMovesBg.1f0d0475a1.png",width:20/60*Config.cellWidth,height:20/60*Config.cellHeight,"margin-left":20/60*Config.cellWidth,"margin-top":.55*Config.cellHeight}),FigureRules.add(".episode_catacomb .movesToExplode",{font:"normal "+16/60*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Marvin",color:"#552024","text-left":4/60*Config.cellWidth,"text-top":16/60*Config.cellHeight}),FigureRules.add(".episode_catacomb .movesToExplode.movesToExplodeTwoDigits",{font:"normal "+.2*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Marvin","text-left":.05*Config.cellWidth,"text-top":.25*Config.cellHeight}),FigureRules.add(".episode_catacomb .movesToExplode.bombSoonExplode",{color:"#cb0000"}),FigureRules.add(".episode_catacomb .bombDangerHighlight.bombSoonExplode",{"background-image":""}),FigureRules.add(".fishnetCell.vertical",{width:68/60*Config.cellWidth,height:118/60*Config.cellHeight,"margin-left":-.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight,"background-width":205,"background-height":355,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/dolphinVer.29dfc4719f.png",spriteFrames:10,framesOrder:[0,1,2,1,0,0,3,4,3,0],duration:1e3,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".fishnetCell.horizontal",{width:2.15*Config.cellWidth,height:1.3*Config.cellHeight,"margin-left":0,"margin-top":-.2*Config.cellHeight,"background-width":386,"background-height":233,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/dolphinHor.075e713235.png",spriteFrames:10,spriteVertical:!0,framesOrder:[0,1,2,1,0,0,3,4,3,0],duration:1e3,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".fishnetCellRope",{width:Config.cellWidth,height:Config.cellHeight,"background-width":171,"background-height":171,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/rope.f49eadd2b7.png"}),FigureRules.add(".fishnetCellRope .ropeThing1, .fishnetCellRope .ropeThing2",{width:11/60*Config.cellWidth,height:23/60*Config.cellHeight,"background-width":30,"background-height":63,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/ropeThing.6447dd2e68.png",opacity:0}),FigureRules.add(".fishnetCellRope .ropeThing3, .fishnetCellRope .ropeThing4",{width:10/60*Config.cellWidth,height:10/60*Config.cellHeight,"background-width":28,"background-height":28,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishnet/ropeCenter.b5860d009e.png",opacity:0}),FigureRules.add(".fishnetCellRope.ropeLeft .ropeThing1",{"margin-left":-13/60*Config.cellHeight,"margin-top":-11/60*Config.cellWidth,rotate:-90,opacity:1}),FigureRules.add(".fishnetCellRope.ropeLeft .ropeThing2",{"margin-left":-13/60*Config.cellHeight,"margin-top":49/60*Config.cellWidth,rotate:-90,opacity:1}),FigureRules.add(".fishnetCellRope.ropeRight .ropeThing1",{"margin-left":61/60*Config.cellHeight,"margin-top":-11/60*Config.cellWidth,rotate:90,opacity:1}),FigureRules.add(".fishnetCellRope.ropeRight .ropeThing2",{"margin-left":61/60*Config.cellHeight,"margin-top":49/60*Config.cellWidth,rotate:90,opacity:1}),FigureRules.add(".fishnetCellRope.ropeTop .ropeThing1",{"margin-left":-.1*Config.cellWidth,"margin-top":-.3*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeTop .ropeThing2",{"margin-left":.9*Config.cellWidth,"margin-top":-.3*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeBottom .ropeThing1",{"margin-left":-.1*Config.cellWidth,"margin-top":56/60*Config.cellHeight,opacity:1,rotate:180}),FigureRules.add(".fishnetCellRope.ropeBottom .ropeThing2",{"margin-left":.9*Config.cellWidth,"margin-top":56/60*Config.cellHeight,opacity:1,rotate:180}),FigureRules.add(".fishnetCellRope.ropeLeft.ropeTop .ropeThing1",{"margin-left":-11/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,opacity:1,rotate:-45}),FigureRules.add(".fishnetCellRope.ropeLeft.ropeTop .ropeThing2",{opacity:0}),FigureRules.add(".fishnetCellRope.ropeRight.ropeTop .ropeThing1",{"margin-left":59/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,opacity:1,rotate:45}),FigureRules.add(".fishnetCellRope.ropeRight.ropeTop .ropeThing2",{opacity:0}),FigureRules.add(".fishnetCellRope.ropeLeft.ropeBottom .ropeThing1",{"margin-left":-10/60*Config.cellWidth,"margin-top":53/60*Config.cellHeight,opacity:1,rotate:-135}),FigureRules.add(".fishnetCellRope.ropeLeft.ropeBottom .ropeThing2",{opacity:0}),FigureRules.add(".fishnetCellRope.ropeRight.ropeBottom .ropeThing1",{"margin-left":59/60*Config.cellWidth,"margin-top":53/60*Config.cellHeight,opacity:1,rotate:135}),FigureRules.add(".fishnetCellRope.ropeRight.ropeBottom .ropeThing2",{opacity:0}),FigureRules.add(".fishnetCellRope.ropeTop .ropeThing3",{"margin-left":-5/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeLeft .ropeThing3",{"margin-left":55/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeBottom .ropeThing3",{"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeRight .ropeThing3",{"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeTop .ropeThing4",{"margin-left":55/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeLeft .ropeThing4",{"margin-left":55/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeBottom .ropeThing4",{"margin-left":55/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,opacity:1}),FigureRules.add(".fishnetCellRope.ropeRight .ropeThing4",{"margin-left":-5/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight,opacity:1}),FigureRules.add(".mermaidCellBg",{width:110/60*Config.cellWidth,height:110/60*Config.cellHeight,"background-width":128,"background-height":128,"margin-left":.05*Config.cellWidth,"margin-top":7/60*Config.cellHeight}),FigureRules.add(".mermaidCellBg.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid/mermaid.6a72e89c49.png",spriteFrames:5,duration:600,playRound:!0,delay:[1e3,6e3]}),FigureRules.add(".mermaidCellBg.onCollect",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid/mermaidLaugh.8c959f0205.png",spriteFrames:9,duration:1200,playRound:!1}),FigureRules.add(".mermaidCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".mermaidCell .lifeBlock .taskIco",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Pearl.d109d28766.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".mermaidCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".mermaidCell .lifeBlock .lifeText .currentLife, .mermaidCell .lifeBlock .lifeText .divider, .mermaidCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".mermaidCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".mermaidCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".mermaidCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_mermaid .attribute_key",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid/mermaidAttribute.dfd0d2cb69.png"}),FigureRules.add(".episode_mermaid .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid/mermaidShell.4d0e56a5d0.png"}),FigureRules.add(".SeaweedKeyCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-top":0,spriteFrames:19,duration:1e3,delay:[2e3,5e3],playRound:!0}),FigureRules.add(".SeaweedKeyColorR",{"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/seaweed_R.8e7e895ce6.png"}),FigureRules.add(".SeaweedKeyColorG",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/seaweed_G.a14b3ce62a.png"}),FigureRules.add(".SeaweedKeyColorB",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/seaweed_B.53f734a0c6.png"}),FigureRules.add(".SeaweedKeyColorY",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/seaweed_Y.f55c8151ac.png"}),FigureRules.add(".SeaweedKeyColorP",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/seaweed_P.b8477c288b.png"}),FigureRules.add(".SeaweedDecorator",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".SeaweedDecorator .weedBg",{width:Config.cellWidth-10,height:Config.cellHeight-10,"background-color":"#000000",opacity:.5,"margin-left":5/60*Config.cellWidth,"margin-top":5/60*Config.cellHeight}),FigureRules.add(".SeaweedDecorator .weedTop, .SeaweedDecorator .weedBottom",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/weed.71272e75fb.png"}),FigureRules.add(".SeaweedDecoratorColorR .weedBottom",{"background-position-x":420}),FigureRules.add(".SeaweedDecoratorColorR .weedTop",{"background-position-x":360}),FigureRules.add(".SeaweedDecoratorColorG .weedBottom",{"background-position-x":180}),FigureRules.add(".SeaweedDecoratorColorG .weedTop",{"background-position-x":120}),FigureRules.add(".SeaweedDecoratorColorB .weedBottom",{"background-position-x":60}),FigureRules.add(".SeaweedDecoratorColorB .weedTop",{"background-position-x":0}),FigureRules.add(".SeaweedDecoratorColorY .weedBottom",{"background-position-x":660}),FigureRules.add(".SeaweedDecoratorColorY .weedTop",{"background-position-x":600}),FigureRules.add(".SeaweedDecoratorColorP .weedBottom",{"background-position-x":300}),FigureRules.add(".SeaweedDecoratorColorP .weedTop",{"background-position-x":240}),FigureRules.add(".SeaweedDecorator.die",{animation:{params:{opacity:[1,0]},duration:200}}),FigureRules.add(".SeaweedDecorator.die .weedBg.stable",{animation:{params:{opacity:[.5,0]},duration:100}}),FigureRules.add(".SeaweedDecorator.die .weedBottom.stable",{animation:{params:{"margin-top":[-1/60*Config.cellHeight,14/60*Config.cellHeight]},duration:100}}),FigureRules.add(".SeaweedDecorator.die .weedTop.stable",{animation:{params:{"margin-top":[-1/60*Config.cellHeight,-17/60*Config.cellHeight]},duration:100}}),FigureRules.add(".SeaweedKeyCell .lifeBlock",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":17,"background-height":17,"margin-left":40/60*Config.cellWidth,"margin-top":40/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seaweed/lifeBg.057a331925.png"}),FigureRules.add(".SeaweedKeyCell .lifeBlock .currentLife",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"margin-left":8/60*Config.cellWidth,"margin-top":13/60*Config.cellHeight,textAlign:"center",font:"bold "+13/60*Config.cellWidth+"px/"+.25*Config.cellWidth+"px Marvin"}),FigureRules.add(".SeaweedKeyColorR .lifeBlock .currentLife",{color:"#bd011a"}),FigureRules.add(".SeaweedKeyColorG .lifeBlock .currentLife",{color:"#015e01"}),FigureRules.add(".SeaweedKeyColorB .lifeBlock .currentLife",{color:"#0033e3"}),FigureRules.add(".SeaweedKeyColorY .lifeBlock .currentLife",{color:"#d34f00"}),FigureRules.add(".SeaweedKeyColorP .lifeBlock .currentLife",{color:"#9a00ae"}),FigureRules.add(".eaterStarsCell",{width:130/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"background-width":130,"background-height":120}),FigureRules.add(".eaterStarsCell.stable",{"background-position-x":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars/eaterStarStable.86b833665d.png",spriteFrames:8,duration:600,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".eaterStarsCell.beforeCollect",{"background-position-x":0,spriteFrames:8,duration:600,playRound:!1,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars/eaterStarEat.7c73e707d2.png"}),FigureRules.add(".eaterStarsCell.afterCollect",{"background-position-x":0,playRound:!1,duration:100,spriteFrames:3,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars/eaterStarEaten.b386b749a8.png"}),FigureRules.add(".eaterStarsCell .target",{x:65/60*Config.cellWidth,y:70/60*Config.cellHeight}),FigureRules.add(".eaterStarsCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":58/60*Config.cellWidth,"margin-top":95/60*Config.cellHeight}),FigureRules.add(".eaterStarsCell .lifeBlock .taskIco",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/multicolor.3c5bbe1e0b.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".eaterStarsCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".eaterStarsCell .lifeBlock .lifeText .currentLife, .eaterStarsCell .lifeBlock .lifeText .divider, .eaterStarsCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".eaterStarsCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".eaterStarsCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".eaterStarsCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_japanfall .attribute_key",{width:1.85*Config.cellWidth/3,height:1.8*Config.cellHeight/3,"background-width":111,"background-height":108,"margin-left":.575*Config.cellWidth/3,"margin-top":.6*Config.cellHeight/3,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/leaf.e8a31403be.png"}),FigureRules.add(".episode_japanfall .fish2.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/umbrella.26362f23b9.png"}),FigureRules.add(".episode_japanfall .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment1.966075d468.png"}),FigureRules.add(".episode_japanfall .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment2.2e3cfc10b9.png"}),FigureRules.add(".episode_japanfall .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment3.1447ab0aea.png"}),FigureRules.add(".episode_japanfall .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/japanfall/garment4.44bf30d5a2.png"}),FigureRules.add(".episode_AutumnForest .attribute_falling",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/AutumnForest/mushroom.png",spriteFrames:0,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_AutumnForest .turtleCell",{width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-13/60*Config.cellWidth,"margin-top":-.1*Config.cellHeight,"background-image":"../../../gems/site/img/features/AutumnForest/plant.png"}),FigureRules.add(".episode_AutumnForest .turtleCell.turtleLevel3",{width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/AutumnForest/plant.png"}),FigureRules.add(".episode_AutumnForest .turtleCell.turtleLevel2",{"background-position-y":132,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/AutumnForest/plant.png"}),FigureRules.add(".episode_AutumnForest .turtleCell.turtleLevel1",{"background-position-y":264,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/AutumnForest/plant.png"}),FigureRules.add(".episode_AutumnForest .turtle",{"background-position-y":264,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/AutumnForest/plant.png"}),FigureRules.add(".episode_AutumnForest .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/AutumnForest/sun1.png"}),FigureRules.add(".episode_AutumnForest .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/AutumnForest/sun2.png"}),FigureRules.add(".episode_AutumnForest .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/AutumnForest/sun3.png"}),FigureRules.add(".episode_AutumnForest .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/AutumnForest/sun4.png"}),FigureRules.add(".magicWandCell",{width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".magicWandCell .charge.stable",{width:278/180*Config.cellWidth,height:278/180*Config.cellHeight,"background-width":278,"background-height":278,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerLight.ddbc029909.png","margin-left":41/180*Config.cellWidth,"margin-top":-41/180*Config.cellHeight,animation:{params:{rotate:[0,360]},duration:1e4,playRound:!0}}),FigureRules.add(".magicWandCell .taskIco",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerZero.f53c66085a.png"}),FigureRules.add(".magicWandCell .taskIcoFull",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/towerFull.78b607e8f8.png",opacity:0}),FigureRules.add(".magicWandCell .chargeText .chargeAmount",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":1*Config.cellWidth,"margin-top":100/60*Config.cellWidth,font:"bold "+20/60*Config.cellWidth+"px/"+26/60*Config.cellWidth+"px Marvin",color:"#ffffff",strokeStyle:"#43269c",lineWidth:1,textAlign:"center"}),FigureRules.add(".magicWandCell .chargeText.lighting",{width:55/180*Config.cellWidth,height:79/180*Config.cellHeight,"background-width":55,"background-height":79,"margin-left":50/60*Config.cellWidth,"margin-top":80/60*Config.cellWidth,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/tower_light.f8961eb58c.png"}),FigureRules.add(".magicWandCell .chargeText.lighting .chargeAmount",{opacity:0}),FigureRules.add(".magicWandLighting",{width:266/180*Config.cellWidth,height:266/180*Config.cellHeight,"background-width":266,"background-height":266,"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/magicwand/light.4807a16b7e.png","margin-left":-43/180*Config.cellWidth,"margin-top":-43/180*Config.cellHeight,spriteFrames:5,duration:150,playRound:!0}),FigureRules.add(".magicStartPoint",{"margin-left":Config.cellWidth/2,"margin-top":0}),FigureRules.add(".episode_clocktower .attribute_key",{width:34/60*Config.cellWidth,height:34/60*Config.cellHeight,"margin-left":13/60*Config.cellWidth,"margin-top":25/60*Config.cellHeight,"background-width":34,"background-height":34,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/miniClock.03b4a7d6a4.png"}),FigureRules.add(".episode_clocktower .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/gear.c7d484e593.png"}),FigureRules.add(".episode_clocktower .decorator_monkey",{"background-position-x":0,"background-position-y":0,"background-width":90,"background-height":90,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/troll.ff4fe0c97f.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".episode_clocktower .decorator_monkey.stable",{spriteFrames:4,duration:500,framesOrder:[0,1,2,1],delay:[2e3,5e3],playRound:!0}),FigureRules.add(".episode_clocktower .decorator_monkey.die",{spriteFrames:2,duration:90,framesOrder:[3,4],playRound:!1}),FigureRules.add(".episode_clocktower .decorator_monkey.monkeyCollect",{"background-position-x":450}),FigureRules.add(".episode_clocktower .walrusBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":133,"background-height":124,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/clockBoss.d3c1abb3b1.png",width:133/60*Config.cellWidth,height:124/60*Config.cellHeight,"margin-left":-7/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight,spriteFrames:14,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],duration:2800,playRound:!0,delay:[1e3,1e3]}),FigureRules.add(".episode_clocktower .walrusBg.walrusAngry",{"background-position-x":0,"background-position-y":0,"background-width":133,"background-height":124,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/clockBoss.d3c1abb3b1.png",width:133/60*Config.cellWidth,height:124/60*Config.cellHeight,"margin-left":-7/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight,spriteFrames:4,framesOrder:[14,15,16,17],duration:800}),FigureRules.add(".episode_clocktower .walrusBg.clockGood",{"background-position-x":0,"background-position-y":0,"background-width":133,"background-height":124,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/clockBoss.d3c1abb3b1.png",width:133/60*Config.cellWidth,height:124/60*Config.cellHeight,"margin-left":-7/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight,spriteFrames:3,framesOrder:[18,19,20],duration:600,lastFrame:20}),FigureRules.add(".episode_clocktower .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice3.47077275ee.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,width:38/60*Config.cellWidth,height:140/3/60*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast1.iceBlast",{"background-position-x":60,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":26/60*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast2.iceBlast",{"background-position-x":120,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":.45*Config.cellWidth,"margin-top":.35*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast3.iceBlast",{"background-position-x":180,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":-.35*Config.cellWidth,"margin-top":22/60*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast4.iceBlast",{"background-position-x":240,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":-25/60*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast5.iceBlast",{"background-position-x":300,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":-25/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".episode_clocktower .iceBlast6.iceBlast",{"background-position-x":360,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/clocktower/iceBlast1.1927769cb9.png","margin-left":22/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".episode_clocktower .walrusLifeBlock",{opacity:0}),FigureRules.add(".episode_clocktower .walrusLife",{opacity:0}),FigureRules.add(".episode_clocktower .walrusHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{opacity:0}),FigureRules.add(".barCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60}),FigureRules.add(".barCellLifeBlock .lifeGem",{"background-width":30,"background-height":34}),FigureRules.add(".barCellLifeBlock .lifeGem1",{width:.5*Config.cellWidth,height:34/60*Config.cellHeight,"margin-left":-.25*Config.cellWidth,"margin-top":-17/60*Config.cellWidth}),FigureRules.add(".barCellLifeBlock .lifeGem2",{width:.25*Config.cellWidth,height:17/60*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".barCellLifeBlock .lifeGem3",{width:.25*Config.cellWidth,height:17/60*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".barCellLifeBlock .lifeGem4",{width:.25*Config.cellWidth,height:17/60*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".barCellLifeBlock .lifeGem5",{width:.25*Config.cellWidth,height:17/60*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".barCellLifeBlock.life4 .lifeGem5",{opacity:0}),FigureRules.add(".barCellLifeBlock.life3 .lifeGem5, .barCellLifeBlock.life3 .lifeGem4",{opacity:0}),FigureRules.add(".barCellLifeBlock.life2 .lifeGem5, .barCellLifeBlock.life2 .lifeGem4, .barCellLifeBlock.life2 .lifeGem3",{opacity:0}),FigureRules.add(".barCellLifeBlock.life1 .lifeGem5, .barCellLifeBlock.life1 .lifeGem4, .barCellLifeBlock.life1 .lifeGem3, .barCellLifeBlock.life1 .lifeGem2",{opacity:0}),FigureRules.add(".barCellLifeBlock.color_R .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeRed.19134f7161.png"}),FigureRules.add(".barCellLifeBlock.color_G .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeGreen.6a18dac21a.png"}),FigureRules.add(".barCellLifeBlock.color_B .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeBlue.bc19cdb9b2.png"}),FigureRules.add(".barCellLifeBlock.color_Y .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeYellow.6a3c84965a.png"}),FigureRules.add(".barCellLifeBlock.color_P .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifePurple.ae7360a224.png"}),FigureRules.add(".barCellLifeBlock.color_W .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeWhite.b9ba8ae0dd.png"}),FigureRules.add(".barCellLifeBlock.color_ .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeWhite.b9ba8ae0dd.png"}),FigureRules.add(".barCellLifeBlock.color_s .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barLifeMulti.e58a812230.png"}),FigureRules.add(".barCell.Middle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barCenter.c5780fb23f.png"}),FigureRules.add(".barCell.TopLeftCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barCorner.8a23b6a988.png","scale-x":-1}),FigureRules.add(".barCell.TopRightCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barCorner.8a23b6a988.png"}),FigureRules.add(".barCell.BottomLeftCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barCorner.8a23b6a988.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".barCell.BottomRightCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barCorner.8a23b6a988.png","scale-y":-1}),FigureRules.add(".barCell.LeftSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barSide.d2da8de56f.png",rotate:-90}),FigureRules.add(".barCell.TopSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barSide.d2da8de56f.png"}),FigureRules.add(".barCell.RightSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barSide.d2da8de56f.png",rotate:90}),FigureRules.add(".barCell.BottomSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barSide.d2da8de56f.png","scale-y":-1}),FigureRules.add(".barCell.VerticalTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barEdge.dea20c99c7.png"}),FigureRules.add(".barCell.VerticalMiddle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barMiddle.0f7f34f964.png"}),FigureRules.add(".barCell.VerticalBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barEdge.dea20c99c7.png","scale-y":-1}),FigureRules.add(".barCell.HorizontalLeft",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barEdge.dea20c99c7.png",rotate:-90,"scale-y":-1}),FigureRules.add(".barCell.HorizontalMiddle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barMiddle.0f7f34f964.png",rotate:90}),FigureRules.add(".barCell.HorizontalRight",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar/barEdge.dea20c99c7.png",rotate:90}),FigureRules.add(".fieldPoints.barCellRemove",{color:"#fac921"}),FigureRules.add(".gravitycoreBg",{"background-position-x":0,"background-position-y":0,"background-width":201,"background-height":203,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gravitycore/core.070e7a007b.png",width:201/180*Config.cellWidth,height:203/180*Config.cellHeight,"margin-left":-11/180*Config.cellWidth,"margin-top":-11/180*Config.cellHeight,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".gravitycoreBg.gravityCoreRun",{spriteFrames:1,duration:1,playRound:!1,framesOrder:[3],animation:{params:{rotate:[0,360]},duration:150,playRound:!0}}),FigureRules.add(".leftMove.gravitycoreBg.gravityCoreRun",{spriteFrames:1,duration:1,playRound:!1,framesOrder:[3],animation:{params:{rotate:[0,-360]},duration:150,playRound:!0}}),FigureRules.add(".downMove.gravitycoreBg",{}),FigureRules.add(".upMove.gravitycoreBg",{}),FigureRules.add(".leftMove.downMove.gravitycoreBg",{}),FigureRules.add(".leftMove.upMove.gravitycoreBg",{}),FigureRules.add(".gravitycoreBg.downMove.gravityCoreRun, .gravitycoreBg.upMove.gravityCoreRun",{}),FigureRules.add(".gravitycoreBg.gravityCoreStop",{"background-position-x":0,spriteFrames:2,duration:200,playRound:!1,framesOrder:[4,5]}),FigureRules.add(".gravitycoreBg.downMove.gravityCoreStop, .gravitycoreBg.upMove.gravityCoreStop",{}),FigureRules.add(".seahorseBg",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":66,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seahorse/seaHorseHor.ebf6b3fa77.png",width:80/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-top":-.1*Config.cellHeight}),FigureRules.add(".leftMove.seahorseBg",{"scale-x":-1,"margin-left":-20/60*Config.cellWidth}),FigureRules.add(".downMove.seahorseBg",{"background-position-x":0,"background-position-y":0,"background-width":70,"background-height":81,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seahorse/seaHorseDown.bed500487a.png",width:70/60*Config.cellWidth,height:1.35*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":1/60*Config.cellWidth}),FigureRules.add(".upMove.seahorseBg",{"background-position-x":0,"background-position-y":0,"background-width":70,"background-height":72,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seahorse/seaHorseUp.eeb00316c5.png",width:70/60*Config.cellWidth,height:1.2*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":-11/60*Config.cellWidth}),FigureRules.add(".leftMove.downMove.seahorseBg",{"margin-left":-4/60*Config.cellWidth,"margin-top":1/60*Config.cellWidth}),FigureRules.add(".leftMove.upMove.seahorseBg",{"margin-left":-4/60*Config.cellWidth,"margin-top":-11/60*Config.cellWidth}),FigureRules.add(".seahorseBg.stable",{spriteFrames:13,framesOrder:[0,1,2,3,2,1,2,3,2,4,5,6,7],duration:1300,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".seahorseBg.seaHorseRun",{spriteFrames:4,framesOrder:[11,12,13,12],duration:200,playRound:!0}),FigureRules.add(".seahorseBg.downMove.seaHorseRun, .seahorseBg.upMove.seaHorseRun",{spriteFrames:4,framesOrder:[0,1,2,3],duration:200,playRound:!0}),FigureRules.add(".seahorseBg.seaHorseStop",{spriteFrames:5,framesOrder:[15,16,17,18,19],duration:500,playRound:!1}),FigureRules.add(".seahorseBg.downMove.seaHorseStop, .seahorseBg.upMove.seaHorseStop",{spriteFrames:4,framesOrder:[4,5,6,7],duration:400,playRound:!1}),FigureRules.add(".frozen_aries",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":0}),FigureRules.add(".frozen_taurus",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":120}),FigureRules.add(".frozen_gemini",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":240}),FigureRules.add(".frozen_cancer",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":360}),FigureRules.add(".frozen_leo",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":480}),FigureRules.add(".frozen_virgo",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":600}),FigureRules.add(".frozen_libra",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":720}),FigureRules.add(".frozen_scorpio",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":840}),FigureRules.add(".frozen_sagittarius",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":960}),FigureRules.add(".frozen_capricorn",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":1080}),FigureRules.add(".frozen_aquarius",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":1200}),FigureRules.add(".frozen_pisces",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/znaki.ad29f26f10.png","background-position-x":1320}),FigureRules.add(".episode_NewYearHoroscope .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice3.47077275ee.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,width:38/60*Config.cellWidth,height:140/3/60*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast1.iceBlast",{"background-position-x":60,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":26/60*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast2.iceBlast",{"background-position-x":120,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":.45*Config.cellWidth,"margin-top":.35*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast3.iceBlast",{"background-position-x":180,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":-.35*Config.cellWidth,"margin-top":22/60*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast4.iceBlast",{"background-position-x":240,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":-25/60*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast5.iceBlast",{"background-position-x":300,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":-25/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".episode_NewYearHoroscope .iceBlast6.iceBlast",{"background-position-x":360,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/NewYearHoroscope/iceBlast.720e25cade.png","margin-left":22/60*Config.cellWidth,"margin-top":-.35*Config.cellHeight}),FigureRules.add(".blackholeBg",{width:274/3/60*Config.cellWidth,height:236/3/60*Config.cellHeight,"background-width":274,"background-height":236,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/blackhole/web/coral.7144964957.png","margin-left":-.25*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".blackholeBg.stable",{startFrame:14,spriteFrames:6,duration:600,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".blackholeBg.fly",{"background-position-x":0,spriteFrames:4,duration:300,playRound:!0}),FigureRules.add(".coralBg",{width:178/3/60*Config.cellWidth,height:181/3/60*Config.cellHeight,"background-width":178,"background-height":181,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coral/coral.1bc47479dd.png","margin-left":2/60*Config.cellWidth,"margin-top":2/60*Config.cellHeight}),FigureRules.add(".coralBg.stable",{spriteFrames:4,duration:200,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".episode_lighthouse .attribute_key",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/attribute.1c3c758075.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".lighthouseHeadCell",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":120,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/lighthouse.6f0fff0549.png"}),FigureRules.add(".lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/flame.f5530374a3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":1/60*Config.cellHeight,spriteFrames:5,duration:1e3,playRound:!0}),FigureRules.add(".lighthouseBg.lighthouseAngry",{"background-position-x":300,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/flame.f5530374a3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":1/60*Config.cellHeight,spriteFrames:2,duration:400,playRound:!0}),FigureRules.add(".less50PercentLife .lighthouseBg.stable",{"background-position-x":420,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/flame.f5530374a3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":1/60*Config.cellHeight,spriteFrames:4,duration:800,playRound:!0}),FigureRules.add(".less50PercentLife .lighthouseBg.lighthouseAngry",{"background-position-x":660,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/flame.f5530374a3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":1/60*Config.cellHeight,spriteFrames:2,duration:400,playRound:!0}),FigureRules.add(".less25PercentLife .lighthouseBg.stable",{"background-position-x":780,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/flame.f5530374a3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":1/60*Config.cellHeight,spriteFrames:5,duration:1e3,playRound:!0}),FigureRules.add(".lighthouseFly",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/lighthouse/lighthouseDone.02d1c5a61e.png",width:2*Config.cellWidth,height:3*Config.cellHeight,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[3*Config.cellHeight,.8*Config.cellHeight],"margin-left":[0*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,1.1*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".lighthouseLifeBlock",{"background-position-x":0,"background-position-y":0,width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":7/60*Config.cellWidth,"margin-top":164/60*Config.cellHeight}),FigureRules.add(".lighthouseLife",{"background-color":"#57ec01",width:46/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".less50PercentLife.lighthouseLife",{"background-color":"#ffff00"}),FigureRules.add(".less25PercentLife.lighthouseLife",{"background-color":"#f2342c"}),FigureRules.add(".episode_february23 .attribute_key",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/february23/attribute.541e7d728e.png","background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_february23 .fish5.fishcellBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/february23/gun.405afdb4ca.png","background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_pushkin .attribute_falling",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/poem.4ed09117fc.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_pushkin .decorator_blocked_alt, .episode_pushkin .decorator_blocked_alt_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlastAlt.3008127fa5.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_alt_remove_animatePiece1.decorator_blocked_alt_remove_animatePiece",{"background-position-x":180,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_alt_remove_animatePiece2.decorator_blocked_alt_remove_animatePiece",{"background-position-x":360,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_pushkin .decorator_blocked_alt_remove_animatePiece3.decorator_blocked_alt_remove_animatePiece",{"background-position-x":540,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_alt_remove_animatePiece4.decorator_blocked_alt_remove_animatePiece",{"background-position-x":720,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked, .episode_pushkin .decorator_blocked_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlast.17683cb14c.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":180,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":360,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_pushkin .decorator_blocked_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":540,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":720,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlast2.28f2c6de99.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2_remove_animatePiece",{"background-position-x":360,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/chainBlast2.28f2c6de99.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":360,"margin-left":.1*Config.cellWidth,"margin-top":-.13*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":540,"margin-left":-.18*Config.cellWidth,"margin-top":.13*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":720,"margin-left":.35*Config.cellWidth,"margin-top":-.38*Config.cellHeight}),FigureRules.add(".episode_pushkin .decorator_blocked2_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":900,"margin-left":-.38*Config.cellWidth,"margin-top":.37*Config.cellHeight}),FigureRules.add(".episode_pushkin .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece1.e311f80060.png"}),FigureRules.add(".episode_pushkin .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece2.331698afc1.png"}),FigureRules.add(".episode_pushkin .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece3.65f9db40d8.png"}),FigureRules.add(".episode_pushkin .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkin/piece4.855099b483.png"}),FigureRules.add(".episode_waterworld .attribute_key",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1.7c56771edf.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_eagleworld .attribute_falling",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/fire.7fe9864511.png","background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_eagleworld .fish5.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/firework1.c4a1140d5f.png"}),FigureRules.add(".episode_eagleworld .fish6.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/firework2.f23df63788.png"}),FigureRules.add(".episode_eagleworld .decorator_monkey",{"background-position-x":0,"background-position-y":0,"background-width":90,"background-height":90,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eagleworld/troll.2d8348caf7.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".episode_eagleworld .decorator_monkey.stable",{spriteFrames:4,duration:500,framesOrder:[0,1,2,1],delay:[2e3,5e3],playRound:!0}),FigureRules.add(".episode_eagleworld .decorator_monkey.die",{spriteFrames:2,duration:90,framesOrder:[3,4],playRound:!1}),FigureRules.add(".episode_eagleworld .decorator_monkey.monkeyCollect",{"background-position-x":450}),FigureRules.add(".episode_spaceworld .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/spaceworld/garment1.png"}),FigureRules.add(".episode_spaceworld .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/spaceworld/garment2.png"}),FigureRules.add(".episode_spaceworld .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/spaceworld/garment3.png"}),FigureRules.add(".episode_spaceworld .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/spaceworld/garment4.png"}),FigureRules.add(".episode_spaceworld .popUpColorCell .popBody",{"background-image":"../../../gems/site/img/features/spaceworld/body_large.png"}),FigureRules.add(".episode_autumnworld .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/leaf.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_autumnworld .parrotCell.cell",{"background-image":""}),FigureRules.add(".episode_autumnworld .parrotCellBg",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/banka.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .parrotLevel1 .parrotCellBg",{"background-position-x":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/banka1.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .parrotLevel1 .parrotCellBg.stable",{spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[1,2],playRound:!0}),FigureRules.add(".episode_autumnworld .parrotLevel2 .parrotCellBg",{"background-position-x":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/banka2.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .parrotLevel2 .parrotCellBg.stable",{spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[1,2],playRound:!0}),FigureRules.add(".episode_autumnworld .parrotLevel3 .parrotCellBg",{"background-position-x":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/banka3.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .parrotLevel3 .parrotCellBg.stable",{spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[1,2],playRound:!0}),FigureRules.add(".episode_autumnworld .die_parrot",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/banka.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .die_parrotDoor",{"background-position-x":180,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/bankaPiece.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .die_parrotLock",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/bankaPiece.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_autumnworld .parrot",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/bankaFire.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_autumnworld .decorator_monkey",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/turtle.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":0}),FigureRules.add(".episode_autumnworld .decorator_monkey.monkeyCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/turtleTask.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":0}),FigureRules.add(".episode_piratesbirthday .attribute_key",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/piratesbirthday/keks.png"}),FigureRules.add(".episode_piratesbirthday .fish2.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/piratesbirthday/kolpak.png"}),FigureRules.add(".episode_halloween .attribute_falling",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/halloween/candy.png",spriteFrames:0,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_halloween .fish2.fishcellBg",{width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":65,"background-height":66,"background-image":"../../../gems/site/img/features/halloween/pumpkin.png","margin-left":-2/60*Config.cellWidth}),FigureRules.add(".episode_halloween .caviarCell .cellStone",{"background-width":70,"background-height":66,width:70/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_halloween .caviarCell.caviarCell3 .cellStone",{"background-position-x":0}),FigureRules.add(".episode_halloween .caviarCell.caviarCell3 .stable",{animation:null}),FigureRules.add(".episode_halloween .caviarCell.caviarCell2 .cellStone",{"background-position-x":70}),FigureRules.add(".episode_halloween .caviarCell.caviarCell2 .stable",{animation:null}),FigureRules.add(".episode_halloween .caviarCell.caviarCell1 .cellStone",{"background-position-x":490}),FigureRules.add(".episode_halloween .caviarCell.caviarCell0 .cellStone",{"background-position-x":560}),FigureRules.add(".episode_halloween .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_R.png"}),FigureRules.add(".episode_halloween .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_G.png"}),FigureRules.add(".episode_halloween .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_B.png"}),FigureRules.add(".episode_halloween .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_Y.png"}),FigureRules.add(".episode_halloween .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_P.png"}),FigureRules.add(".episode_halloween .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/halloween/spider_W.png"}),FigureRules.add(".episode_autumngoodbuy .attribute_falling",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/autumngoodbuy/bublik.png",spriteFrames:0,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_autumngoodbuy .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumngoodbuy/garment1.png"}),FigureRules.add(".episode_autumngoodbuy .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumngoodbuy/garment2.png"}),FigureRules.add(".episode_autumngoodbuy .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumngoodbuy/garment3.png"}),FigureRules.add(".episode_autumngoodbuy .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumngoodbuy/garment4.png"}),FigureRules.add(".episode_autumngoodbuy .spiderwebFarm",{"background-width":182,"background-height":180,"background-image":"../../../gems/site/img/features/autumngoodbuy/spider.png"}),FigureRules.add(".carnivores",{width:257/3/60*Config.cellWidth,height:266/3/60*Config.cellHeight,"background-width":200,"background-height":207,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/carnivores/lianaEater.eacce23a83.png",spriteFrames:6,framesOrder:[0,1,0,1,0,1],duration:600,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".carnivores.eat",{spriteFrames:7,framesOrder:[2,3,4,5,6,7,8],duration:700,playRound:!1}),FigureRules.add(".carnivores.leftDirection",{rotate:90,"margin-left":-46/3/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".carnivores.rightDirection",{rotate:-90,"margin-left":-40/3/60*Config.cellWidth,"margin-top":-35/3/60*Config.cellHeight}),FigureRules.add(".carnivores.topDirection",{rotate:180,"margin-left":-35/3/60*Config.cellWidth,"margin-top":-46/3/60*Config.cellHeight}),FigureRules.add(".carnivores.bottomDirection",{"margin-left":-14/60*Config.cellWidth,"margin-top":-40/3/60*Config.cellHeight}),FigureRules.add(".carnivoresLiana",{width:188/3/60*Config.cellWidth,height:98/3/60*Config.cellHeight,"background-width":188,"background-height":98,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/carnivores/liana.f8ebe0b07c.png"}),FigureRules.add(".carnivoresLiana.topDirection",{"margin-top":-98/3/60/2*Config.cellHeight}),FigureRules.add(".carnivoresLiana.bottomDirection",{"margin-top":Config.cellHeight-98/3/60/2*Config.cellHeight}),FigureRules.add(".carnivoresLiana.leftDirection",{rotate:-90,"margin-top":98/3/60/2*Config.cellHeight,"margin-left":-Config.cellWidth/2}),FigureRules.add(".carnivoresLiana.rightDirection",{rotate:90,"margin-top":98/3/60/2*Config.cellHeight,"margin-left":Config.cellWidth/2}),FigureRules.add(".episode_newyear2018 .decorator_greedypirate",{"background-image":"../../../gems/site/img/features/newyear2018/greedyPirate1.png"}),FigureRules.add(".episode_newyear2018 .move_greedypirate",{"background-image":"../../../gems/site/img/features/newyear2018/greedyPirate1.png"}),FigureRules.add(".episode_newyear2018 .grab_greedypirate",{"background-image":"../../../gems/site/img/features/newyear2018/greedyPirate1.png"}),FigureRules.add(".episode_newyear2018 .attribute_coin",{"background-image":"../../../gems/site/img/features/newyear2018/coin.png"}),FigureRules.add(".episode_newyear2018 .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/newyear2018/coin.png"}),FigureRules.add(".episode_newyear2018 .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/ice3.47077275ee.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2018 .parrotCellBg",{"background-position-y":0,"background-width":184,"background-height":190,"background-image":"../../../gems/site/img/features/newyear2018/parrotBg.png",width:184/3/60*Config.cellWidth,height:190/3/60*Config.cellHeight,"margin-left":2/3/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_newyear2018 .parrotLevel1 .parrotCellBg",{"background-position-x":368}),FigureRules.add(".episode_newyear2018 .parrotLevel1 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .parrotLevel2 .parrotCellBg",{"background-position-x":184}),FigureRules.add(".episode_newyear2018 .parrotLevel2 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .parrotLevel3 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".episode_newyear2018 .parrotLevel3 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .die_parrot",{"background-position-x":368,"background-position-y":0,"background-width":184,"background-height":190,"background-image":"../../../gems/site/img/features/newyear2018/parrotLock.png",width:184/3/60*Config.cellWidth,height:190/3/60*Config.cellHeight,"margin-left":2/3/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_newyear2018 .die_parrotDoor",{"background-position-x":184,"background-position-y":0,"background-width":184,"background-height":190,"background-image":"../../../gems/site/img/features/newyear2018/parrotLock.png",width:184/3/60*Config.cellWidth,height:190/3/60*Config.cellHeight,"margin-left":2/3/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_newyear2018 .die_parrotLock",{"background-position-x":0,"background-position-y":0,"background-width":184,"background-height":190,"background-image":"../../../gems/site/img/features/newyear2018/parrotLock.png",width:184/3/60*Config.cellWidth,height:190/3/60*Config.cellHeight,"margin-left":2/3/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_newyear2018 .parrot",{"background-position-x":0,"background-position-y":0,"background-width":184,"background-height":190,"background-image":"../../../gems/site/img/features/newyear2018/parrot.png",width:184/3/60*Config.cellWidth,height:190/3/60*Config.cellHeight,"margin-left":2/3/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .frozen",{width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":360,"background-height":360}),FigureRules.add(".episode_newyear2018 .frozen_amonite1",{"background-image":"../../../gems/site/img/features/newyear2018/amonite1.png"}),FigureRules.add(".episode_newyear2018 .decorator_crabMedusa.special",{"background-position-x":0,"background-position-y":0,"background-width":63,"background-height":60,width:1.05*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2018/snail.png","margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_newyear2018 .move_crabMedusa.special",{"background-position-x":567,"background-position-y":0,"background-width":63,"background-height":60,width:1.05*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2018/snail.png",spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .move_crabMedusa.special.delay",{"background-position-x":0,"background-position-y":0,"background-width":63,"background-height":60,width:1.05*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2018/snail.png",spriteFrames:5,framesOrder:[5,6,7,8,9],duration:250,playRound:!1}),FigureRules.add(".episode_newyear2018 .die_crabMedusa.special",{"background-width":63,"background-height":60,width:1.05*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2018/snail.png"}),FigureRules.add(".episode_newyear2018 .crabMedusaMovesBlock .crabMedusaMoves",{opacity:0}),FigureRules.add(".episode_newyear2018 .lighthouseHeadCell",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":""}),FigureRules.add(".episode_newyear2018 .lighthouseBg",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png"}),FigureRules.add(".episode_newyear2018 .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .lighthouseBg.lighthouseAngry",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,1,0],duration:500,playRound:!1}),FigureRules.add(".episode_newyear2018 .less50PercentLife .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .less50PercentLife .lighthouseBg.lighthouseAngry",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,1,0],duration:500,playRound:!1}),FigureRules.add(".episode_newyear2018 .less25PercentLife .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .less0PercentLife .lighthouseBg.stable",{"background-position-x":720,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2018 .lighthouseFly",{"background-position-x":720,"background-position-y":0,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2018/lighthouseDone.png",width:2*Config.cellWidth,height:3*Config.cellHeight,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[3*Config.cellHeight,.8*Config.cellHeight],"margin-left":[0*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,1.1*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_newyear2018 .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2018/garment1.png"}),FigureRules.add(".episode_newyear2018 .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2018/garment2.png"}),FigureRules.add(".episode_newyear2018 .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2018/garment3.png"}),FigureRules.add(".episode_newyear2018 .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2018/garment4.png"}),FigureRules.add(".episode_cloverfields .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloverfields/beer.png"}),FigureRules.add(".episode_cloverfields .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloverfields/clover.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:0,framesOrder:[0],duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_cloverfields .snakeBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/cloverfields/snakeStable.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],delay:[2e3,4e3],duration:500,playRound:!0}),FigureRules.add(".episode_cloverfields .snakeBg.snakeAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/cloverfields/snakeDamage.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400}),FigureRules.add(".snakeFly",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/cloverfields/snakeDamage.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:0,framesOrder:[0],duration:0,playRound:!1,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[2*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[0,.5*Config.cellWidth],"margin-top":[0,.5*Config.cellHeight],opacity:[1,0]},duration:1e3}}),FigureRules.add(".shooterCell",{width:1.2*Config.cellWidth,height:1.55*Config.cellHeight,"background-width":72,"background-height":93,"margin-left":-.1*Config.cellWidth,"margin-top":-.55*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter/barrelMonkey.c63f0faa65.png"}),FigureRules.add(".shooterCell.powerUpHighlight",{animation:{params:{"margin-top":[-.55*Config.cellHeight,-.6*Config.cellHeight]},duration:200}}),FigureRules.add(".shooterCell.activated",{spriteFrames:7,duration:700,playRound:!1}),FigureRules.add(".shooterCell.active",{"background-position-x":432}),FigureRules.add(".shooterCell.deactivated",{"background-position-x":432,spriteFrames:11,duration:1100,playRound:!1}),FigureRules.add(".shooterCell.animateShot",{"background-position-x":432,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".shooterCell.animateRemoval",{"background-position-x":864,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".shooterTask",{width:.55*Config.cellWidth,height:31/60*Config.cellHeight,"background-width":33,"background-height":31,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter/barrelBanana.42679ff7e7.png"}),FigureRules.add(".shooterCell.movable",{width:1.2*Config.cellWidth,height:1.6*Config.cellHeight,"background-width":72,"background-height":96,"margin-left":-5/60*Config.cellWidth,"margin-top":-.6*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter/barrelMonkeyMoving.c305524745.png"}),FigureRules.add(".shooterCell.movable.powerUpHighlight",{animation:{params:{"margin-top":[-.6*Config.cellHeight,-.65*Config.cellHeight]},duration:200}}),FigureRules.add(".shooterCell.movable.activated",{spriteFrames:7,duration:700,playRound:!1}),FigureRules.add(".shooterCell.movable.active",{"background-position-x":432}),FigureRules.add(".shooterCell.movable.deactivated",{"background-position-x":432,spriteFrames:11,duration:1100,playRound:!1}),FigureRules.add(".shooterCell.movable.movingRight",{"scale-x":-1,"margin-left":-7/60*Config.cellWidth}),FigureRules.add(".shooterCell.movable.moving",{"background-position-x":1296,spriteFrames:2,duration:200,playRound:!0}),FigureRules.add(".shooterCell.movable.movingStart",{"background-position-x":1152,spriteFrames:2,duration:200,playRound:!1}),FigureRules.add(".shooterCell.movable.hide",{"background-position-x":864,spriteFrames:6,duration:400,playRound:!1}),FigureRules.add(".shooterCell.movable.show",{"background-position-x":0,spriteFrames:7,duration:400,playRound:!1}),FigureRules.add(".shooterCell .color",{width:19/60*Config.cellWidth,height:20/60*Config.cellHeight,"background-width":19,"background-height":20,"margin-left":28/60*Config.cellWidth,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter/monkeyStones.30b74e4869.png","margin-top":1.15*Config.cellHeight}),FigureRules.add(".shooterCell.movable .color",{"margin-left":20/60*Config.cellWidth,"margin-top":68/60*Config.cellHeight}),FigureRules.add(".shooterCell.moving .color, .shooterCell.movingStart .color",{opacity:0}),FigureRules.add(".shooterCell .color.colorR",{}),FigureRules.add(".shooterCell .color.colorG",{"background-position-x":19}),FigureRules.add(".shooterCell .color.colorB",{"background-position-x":38}),FigureRules.add(".shooterCell .color.colorY",{"background-position-x":57}),FigureRules.add(".shooterCell .color.colorP",{"background-position-x":76}),FigureRules.add(".shooterCell .color.colorW",{"background-position-x":95}),FigureRules.add(".fireFlowerCell",{"background-image":""}),FigureRules.add(".fireFlowerBg",{"background-position-x":0,"background-position-y":0,"background-width":189,"background-height":179,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlower.b32879d4aa.png","margin-left":-4/180*Config.cellWidth,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".fireFlowerCell .fireFlowerBg.stable0",{"background-position-x":1701,"background-position-y":0}),FigureRules.add(".fireFlowerCell .fireFlowerBg.run1to0",{spriteFrames:3,duration:400,framesOrder:[7,8,9]}),FigureRules.add(".fireFlowerCell .fireFlowerBg.stable1",{"background-position-x":1134,"background-position-y":0}),FigureRules.add(".fireFlowerCell .fireFlowerBg.run2to1",{spriteFrames:3,duration:400,framesOrder:[4,5,6]}),FigureRules.add(".fireFlowerCell .fireFlowerBg.stable2",{"background-position-x":567,"background-position-y":0}),FigureRules.add(".fireFlowerCell .fireFlowerBg.run3to2",{spriteFrames:3,duration:400,framesOrder:[1,2,3]}),FigureRules.add(".fireFlowerCell .fireFlowerBg.stable3",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".fireFlowerFireBg.run",{"background-width":124,"background-height":139,"background-position-x":0,"background-position-y":0,width:124/180*Config.cellWidth,height:139/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerFire.6369277474.png",spriteFrames:12,duration:1200,playRound:!0}),FigureRules.add(".fireFlowerFireballExplosion",{"background-image":""}),FigureRules.add(".fireFlowerFireball.run",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerFireball.399130a6e2.png","background-width":158,"background-height":146,"margin-left":5/60*Config.cellWidth,"margin-top":5/60*Config.cellHeight,width:158/180*Config.cellWidth,height:146/180*Config.cellHeight,spriteFrames:14,duration:1400,playRound:!0}),FigureRules.add(".fireFlowerExplosion.run",{"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlowerExplosion.ed9c26d8fd.png","background-width":283,"background-height":274,"margin-left":-66/180*Config.cellWidth,"margin-top":-40/180*Config.cellHeight,width:283/180*Config.cellWidth,height:274/180*Config.cellHeight,spriteFrames:7,duration:700,playRound:!1}),FigureRules.add(".fireFlowerDie",{"background-position-x":0,"background-position-y":0,"background-width":189,"background-height":179,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fireFlower/fireFlower.b32879d4aa.png","margin-left":-4/180*Config.cellWidth,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".twinkleCell",{"background-image":""}),FigureRules.add(".twinkleBg",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":250,width:250/180*Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-35/180*Config.cellHeight,spriteFrames:1,duration:1,delay:[2e3,4e3],playRound:!0}),FigureRules.add(".twinkleBg.growUp",{startFrame:0,spriteFrames:4,duration:400,delay:0,playRound:!1}),FigureRules.add(".twinkleBg.growDown",{startFrame:0,spriteFrames:4,framesOrder:[3,2,1,0],duration:400,delay:0,playRound:!1}),FigureRules.add(".twinkleBg.active",{startFrame:2,spriteFrames:1,duration:1,delay:0,playRound:!1}),FigureRules.add(".twinkleBg.die",{startFrame:2,spriteFrames:2,duration:200,delay:0,playRound:!0}),FigureRules.add(".twinkleCell .twinkleBg.typeR",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugR.ecbfcf1120.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeG",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugG.0a38f4c0ea.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeB",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugB.d3396fe2fb.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeY",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugY.934d04c5ab.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeP",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugP.35994ee369.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeW",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugW.1432054e18.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeR.active, .twinkleCell .twinkleBg.typeR.growUp, .twinkleCell .twinkleBg.typeR.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugR.ecbfcf1120.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeG.active, .twinkleCell .twinkleBg.typeG.growUp, .twinkleCell .twinkleBg.typeG.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugG.0a38f4c0ea.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeB.active, .twinkleCell .twinkleBg.typeB.growUp, .twinkleCell .twinkleBg.typeB.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugB.d3396fe2fb.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeY.active, .twinkleCell .twinkleBg.typeY.growUp, .twinkleCell .twinkleBg.typeY.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugY.934d04c5ab.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeP.active, .twinkleCell .twinkleBg.typeP.growUp, .twinkleCell .twinkleBg.typeP.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugP.35994ee369.png"}),FigureRules.add(".twinkleCell .twinkleBg.typeW.active, .twinkleCell .twinkleBg.typeW.growUp, .twinkleCell .twinkleBg.typeW.growDown",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/twinkle/lightbugW.1432054e18.png"}),FigureRules.add(".episode_schoolbell .coinChestHeadCell",{width:362/3/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":362,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/coinChest.0e3fcf36d0.png"}),FigureRules.add(".episode_schoolbell .coinChestHeadCell.opened",{spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_schoolbell .coinChestHeadCell.closed",{framesOrder:[4,3,2,1,0],spriteFrames:5,duration:250,playRound:!1}),FigureRules.add(".episode_schoolbell .coinChestLifeBlock .coinChestLife",{"text-left":1*Config.cellWidth}),FigureRules.add(".episode_schoolbell .coinChestColorNext",{"margin-left":.4*Config.cellWidth}),FigureRules.add(".episode_schoolbell .coinChestColor",{"margin-left":.7*Config.cellWidth}),FigureRules.add(".episode_schoolbell .coinChestColorPrev",{"margin-left":77/60*Config.cellWidth}),FigureRules.add(".episode_schoolbell .parrotCell.cell",{"background-image":""}),FigureRules.add(".episode_schoolbell .parrotCellBg",{"background-position-y":0,"background-width":156,"background-height":163,"background-image":"../../../gems/site/img/features/schoolbell/cat.png",width:1.3*Config.cellWidth,height:163/120*Config.cellHeight,"margin-left":-.125*Config.cellWidth,"margin-top":-.3*Config.cellHeight}),FigureRules.add(".episode_schoolbell .parrotLevel1 .parrotCellBg",{"background-position-x":1248}),FigureRules.add(".episode_schoolbell .parrotLevel1 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,delay:[2e3,3e3],playRound:!1}),FigureRules.add(".episode_schoolbell .parrotLevel2 .parrotCellBg",{"background-position-x":624}),FigureRules.add(".episode_schoolbell .parrotLevel2 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,delay:[2e3,3e3],playRound:!1}),FigureRules.add(".episode_schoolbell .parrotLevel3 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".episode_schoolbell .parrotLevel3 .parrotCellBg.stable",{spriteFrames:1,framesOrder:[0],duration:1,delay:[2e3,3e3],playRound:!1}),FigureRules.add(".episode_schoolbell .die_parrot",{"background-position-x":1872,"background-position-y":0,"background-width":156,"background-height":163,"background-image":"../../../gems/site/img/features/schoolbell/cat.png",width:1.3*Config.cellWidth,height:163/120*Config.cellHeight,"margin-left":-.125*Config.cellWidth,"margin-top":-.3*Config.cellHeight,opacity:0}),FigureRules.add(".episode_schoolbell .die_parrotDoor",{"background-position-x":0,"background-position-y":0,"background-width":156,"background-height":163,"background-image":"../../../gems/site/img/features/schoolbell/cat.png",width:1.3*Config.cellWidth,height:163/120*Config.cellHeight,"margin-left":-.125*Config.cellWidth,"margin-top":-.3*Config.cellHeight,opacity:0}),FigureRules.add(".episode_schoolbell .die_parrotLock",{"background-position-x":0,"background-position-y":0,"background-width":156,"background-height":163,"background-image":"../../../gems/site/img/features/schoolbell/cat.png",width:1.3*Config.cellWidth,height:163/120*Config.cellHeight,"margin-left":-.125*Config.cellWidth,"margin-top":-.3*Config.cellHeight,opacity:0}),FigureRules.add(".episode_schoolbell .parrot",{"background-position-x":1872,"background-position-y":0,"background-width":156,"background-height":163,"background-image":"../../../gems/site/img/features/schoolbell/cat.png",width:1.3*Config.cellWidth,height:163/120*Config.cellHeight,"margin-left":-.125*Config.cellWidth,"margin-top":-.3*Config.cellHeight,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_schoolbell .caviarCell .cellStone",{"background-width":57,"background-height":62,width:.95*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":-2/60*Config.cellWidth}),FigureRules.add(".episode_schoolbell .caviarCell.caviarCell3 .cellStone",{"background-position-x":0}),FigureRules.add(".episode_schoolbell .caviarCell.caviarCell2 .cellStone",{"background-position-x":57}),FigureRules.add(".episode_schoolbell .caviarCell.caviarCell1 .cellStone",{"background-position-x":399}),FigureRules.add(".episode_schoolbell .caviarCell.caviarCell0 .cellStone",{"background-position-x":456}),FigureRules.add(".episode_schoolbell .caviarCell_R .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyR.931b35ee74.png"}),FigureRules.add(".episode_schoolbell .caviarCell_G .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyG.c850bb9041.png"}),FigureRules.add(".episode_schoolbell .caviarCell_B .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyB.2a5f8096ee.png"}),FigureRules.add(".episode_schoolbell .caviarCell_Y .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyY.5831968549.png"}),FigureRules.add(".episode_schoolbell .caviarCell_P .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyP.681e147170.png"}),FigureRules.add(".episode_schoolbell .caviarCell_W .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/jellyW.a1c2dfc049.png"}),FigureRules.add(".episode_autumnworld .move_crabMouse, .episode_autumnworld .crabMouseCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/racoon.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:260,playRound:!1}),FigureRules.add(".episode_autumnworld .move_crabMouse",{"background-position-x":1080,animation:{params:{rotate:[0,-360]},duration:150,playRound:!0}}),FigureRules.add(".episode_autumnworld .move_crabMouse.moveRight",{"scale-x":-1,"margin-left":0}),FigureRules.add(".episode_autumnworld .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_autumnworld .decorator_crabMouse",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/autumnworld/racoon.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_autumnworld .decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:400,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_autumnworld .decorator_crabMouse.takeLife",{"background-position-x":0,spriteFrames:3,duration:300,framesOrder:[3,4,5]}),FigureRules.add(".episode_schoolbell .attribute_falling",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/leaf.7f92f76bf0.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_schoolbell .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/bigRacoon.dcc959fda0.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:10,framesOrder:[0,2,3,2,0,1,0,1,0,1],duration:1e3,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_schoolbell .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/bigRacoon.dcc959fda0.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[4],duration:150}),FigureRules.add(".episode_schoolbell .alligatorSpecial",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/bigRacoon.dcc959fda0.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:9,framesOrder:[0,1,0,1,0,1,0,1],duration:800,playRound:!1,animation:{params:{width:[2*Config.cellWidth,.5*Config.cellWidth],height:[2*Config.cellHeight,.5*Config.cellHeight],"margin-left":[0,.75*Config.cellWidth],"margin-top":[0,.75*Config.cellHeight],opacity:[1,0]},duration:800}}),FigureRules.add(".episode_schoolbell .alligatorLifeBlock",{"margin-top":100/60*Config.cellHeight}),FigureRules.add(".episode_schoolbell .decorator_greedypirate",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/greedyPirate1.cde2ee7810.png"}),FigureRules.add(".episode_schoolbell .move_greedypirate",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/greedyPirate1.cde2ee7810.png"}),FigureRules.add(".episode_schoolbell .grab_greedypirate",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/greedyPirate1.cde2ee7810.png"}),FigureRules.add(".episode_schoolbell .attribute_coin",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/book.9722dbf197.png"}),FigureRules.add(".episode_schoolbell .attribute_coin_remove",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/book.9722dbf197.png"}),FigureRules.add(".episode_schoolbell .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/garment1.52ef8bcede.png"}),FigureRules.add(".episode_schoolbell .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/garment2.502fabdff2.png"}),FigureRules.add(".episode_schoolbell .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/garment3.35b1c155c2.png"}),FigureRules.add(".episode_schoolbell .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/schoolbell/garment4.07994511da.png"}),FigureRules.add(".episode_thanxgivingday .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/thanxgivingday/vegetable1.png"}),FigureRules.add(".episode_thanxgivingday .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/thanxgivingday/vegetable2.png"}),FigureRules.add(".episode_thanxgivingday .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/thanxgivingday/vegetable3.png"}),FigureRules.add(".episode_thanxgivingday .decorator_greedypirate",{"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight}),FigureRules.add(".episode_thanxgivingday .move_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,lastFrame:2,duration:130,playRound:!1}),FigureRules.add(".episode_thanxgivingday .grab_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:7,framesOrder:[3,4,5,6,7,8,9],duration:500,playRound:!1}),FigureRules.add(".episode_thanxgivingday .decorator_greedypirate.hasCoins",{"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate2.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".episode_thanxgivingday .decorator_greedypirate .coins",{opacity:0,font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#ffffff","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_thanxgivingday .sleep_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!0}),FigureRules.add(".episode_thanxgivingday .hit_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/thanxgivingday/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:2,lastFrame:2,framesOrder:[5,6],duration:250,playRound:!1}),FigureRules.add(".episode_thanxgivingday .coinChestHeadCell",{"background-image":"../../../gems/site/img/features/thanxgivingday/foodChest.png"}),FigureRules.add(".episode_thanxgivingday .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_thanxgivingday .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_thanxgivingday .attribute_coin",{"background-image":"../../../gems/site/img/features/thanxgivingday/food.png"}),FigureRules.add(".episode_thanxgivingday .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/thanxgivingday/food.png"}),FigureRules.add(".episode_thanxgivingday .fish2.fishcellBg",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanxgivingday/hamster.png"}),FigureRules.add(".episode_thanxgivingday .attribute_falling",{"background-image":"../../../gems/site/img/features/thanxgivingday/sunflower.png","background-width":123,"background-height":100,width:123/180*Config.cellWidth,height:100/180*Config.cellHeight,"margin-left":28/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".flamyCellBg",{width:2.2*Config.cellWidth,height:404/180*Config.cellHeight,"background-width":396,"background-height":404,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy/flamyStable.0b7f9c42b9.png","margin-left":-.2*Config.cellWidth,"margin-top":-60/180*Config.cellHeight,spriteFrames:31,framesOrder:[0,1,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,5,4,5,4,5,4,5],duration:3100,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".flamyCellBg.damaged",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy/flamyDamaged_xlarge.d91fa6a4e3.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200,playRound:!1,delay:[1,2]}),FigureRules.add(".flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".flamyCell .lifeBlock .taskIco",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well/water.e8b6c970e0.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".flamyCell .lifeBlock .lifeText .currentLife, .flamyCell .lifeBlock .lifeText .divider, .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".bugCell .bugCellBg",{width:598/180*Config.cellWidth,height:546/180*Config.cellHeight,"background-width":598,"background-height":546,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugIdle_xlarge.2e4b3f3b64.png","margin-left":-119/180*Config.cellWidth,"margin-top":-93/180*Config.cellHeight}),FigureRules.add(".bugCell .bugCellBg.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugIdle_xlarge.2e4b3f3b64.png",spriteFrames:7,duration:700,playRound:!0}),FigureRules.add(".bugCell .bugCellBg.blink",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugIdle2_xlarge.7f50762951.png",spriteFrames:8,duration:800,playRound:!0}),FigureRules.add(".bugCell .bugCellBg.damaged",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugEat_xlarge.51a4809823.png",spriteFrames:8,duration:800}),FigureRules.add(".bugCell .bugCellBg.die",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugDie_xlarge.a019589917.png",spriteFrames:8,duration:800}),FigureRules.add(".bugCell .mTask",{width:185/180*Config.cellWidth,height:.4*Config.cellHeight,"background-width":185,"background-height":72,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/bugLifeBlock.9be5443c60.png"}),FigureRules.add(".bugCell .mTask1",{"margin-left":55/60*Config.cellWidth,"margin-top":65/60*Config.cellHeight}),FigureRules.add(".bugCell .mTask1 .taskIco",{width:.5*Config.cellWidth,height:.5*Config.cellHeight,"background-width":180,"background-height":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".bugCell .mTask2",{"margin-left":55/60*Config.cellWidth,"margin-top":95/60*Config.cellHeight}),FigureRules.add(".bugCell .mTask2 .taskIco",{width:47/95*Config.cellWidth,height:47/95*Config.cellHeight,"background-width":95,"background-height":95,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".bugCell .text",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".bugCell .text.mCurrentCount",{"margin-left":23/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".bugCell .text.divider",{"margin-left":35/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".bugCell .text.mMaxCount",{"margin-left":47/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".strongboxCell .strongboxBg",{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox/strongbox_xlarge.407f246c37.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight}),FigureRules.add(".strongboxCell.closed .strongboxBg.stable",{frame:0}),FigureRules.add(".strongboxCell.opened .strongboxBg.stable",{frame:5}),FigureRules.add(".strongboxCell.animateOpening .strongboxBg.stable",{spriteFrames:6,duration:700}),FigureRules.add(".strongboxCell.animateClosing .strongboxBg.stable",{startFrame:7,spriteFrames:4,duration:500}),FigureRules.add(".strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:10,spriteFrames:10,duration:500}),FigureRules.add(".strongboxCellLoot",{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox/strongboxCollectItem.2816be1634.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight}),FigureRules.add(".icebergCellBg",{"background-width":360,"background-height":360,width:2*Config.cellWidth,height:2*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/iceberg.e9ea4881b9.png","margin-left":0,"margin-top":0}),FigureRules.add(".icebergCellBg.animate",{animation:{params:{"margin-top":[0,5/60*Config.cellHeight,0]},duration:900}}),FigureRules.add(".icebergHeadCell.icebergLevel3 .icebergCellBg",{frame:1}),FigureRules.add(".icebergHeadCell.icebergLevel2 .icebergCellBg",{frame:2}),FigureRules.add(".icebergHeadCell.icebergLevel1 .icebergCellBg",{frame:3}),FigureRules.add(".icebergCellWater",{"background-width":360,"background-height":110,width:2*Config.cellWidth,height:110/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergWater.8068866888.png","margin-top":70/60*Config.cellHeight}),FigureRules.add(".icebergCellWater.animate",{spriteFrames:12,duration:1800}),FigureRules.add(".flyingIceShard",{"background-position-x":0,"background-position-y":0,"background-width":214,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergShard.71cb21b109.png",width:214/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-17/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".flyingIceShard.splash",{spriteFrames:6,duration:600}),FigureRules.add(".icebergExplode",{"background-width":360,"background-height":360,width:2*Config.cellWidth,height:2*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg/icebergDie.0eb0c89754.png"}),FigureRules.add(".icebergExplode1.icebergExplode",{frame:0}),FigureRules.add(".icebergExplode2.icebergExplode",{frame:1}),FigureRules.add(".icebergExplode3.icebergExplode",{frame:2}),FigureRules.add(".icebergExplode4.icebergExplode",{frame:3}),FigureRules.add(".muffinRackBg",{"background-position-x":0,"background-position-y":0,"background-width":130,"background-height":133,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/muffinrack/muffinRack.162a449606.png",width:380/180*Config.cellWidth,height:395/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add("muffinRackBg.animateOpening",{startFrame:0,spriteFrames:6,duration:600,delay:[300,300]}),FigureRules.add(".muffinRackHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":45,"margin-left":45}),FigureRules.add(".muffinRackDoor",{"background-position-x":0,"background-position-y":0,"background-width":126,"background-height":126,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/muffinrack/rackDoor.c31b5db02f.png",width:380/180*Config.cellWidth,height:380/180*Config.cellHeight,"margin-left":-7/180*Config.cellWidth,"margin-top":-16/180*Config.cellHeight}),FigureRules.add(".muffinRackDoor.animateOpening",{startFrame:0,spriteFrames:6,duration:600,delay:[300,300],lastFrame:6}),FigureRules.add(".muffinRackDoor.opened",{frame:6}),FigureRules.add(".muffinLightning",{"background-position-x":0,"background-position-y":0,"background-width":126,"background-height":126,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/muffinrack/muffinLightning.67f54a95ce.png",width:380/180*Config.cellWidth,height:380/180*Config.cellHeight,"margin-left":-5/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add("muffinLightning.animateOpening",{spriteFrames:9,framesOrder:[0,1,2,3,4,5,6,7,8],lastFrame:8,duration:300}),FigureRules.add("muffinLightning.inactive",{"margin-top":1e3/180*Config.cellHeight}),FigureRules.add(".muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":20,"background-height":16,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/muffinrack/muffinInside.4e6b2edcdd.png",width:55/180*Config.cellWidth,height:46/180*Config.cellHeight}),FigureRules.add(".muffin.muffin1",{"margin-left":114/180*Config.cellWidth,"margin-top":140/180*Config.cellHeight}),FigureRules.add(".muffin.muffin2",{"margin-left":176/180*Config.cellWidth,"margin-top":140/180*Config.cellHeight}),FigureRules.add(".muffin.muffin3",{"margin-left":238/180*Config.cellWidth,"margin-top":140/180*Config.cellHeight}),FigureRules.add(".muffin.muffin4",{"margin-left":116/180*Config.cellWidth,"margin-top":210/180*Config.cellHeight}),FigureRules.add(".muffin.muffin5",{"margin-left":176/180*Config.cellWidth,"margin-top":210/180*Config.cellHeight}),FigureRules.add(".muffin.muffin6",{"margin-left":236/180*Config.cellWidth,"margin-top":210/180*Config.cellHeight}),FigureRules.add(".muffin1.muffinShake, .muffin2.muffinShake, .muffin3.muffinShake",{animation:{params:{"margin-top":[145/180*Config.cellWidth,148/180*Config.cellWidth,145/180*Config.cellWidth,148/180*Config.cellWidth,140/180*Config.cellWidth,140/180*Config.cellWidth,140/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".muffin4.muffinShake, .muffin5.muffinShake, .muffin6.muffinShake",{animation:{params:{"margin-top":[215/180*Config.cellWidth,218/180*Config.cellWidth,215/180*Config.cellWidth,218/180*Config.cellWidth,210/180*Config.cellWidth,210/180*Config.cellWidth,210/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":64,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/muffinrack/muffin.75cf29fd3e.png",width:110/180*Config.cellWidth,height:92/180*Config.cellHeight}),FigureRules.add(".muffin6.flyingMuffin",{animation:{params:{"margin-top":[65,10],"margin-left":[70,20]},duration:1e3}}),FigureRules.add(".muffin5.flyingMuffin",{animation:{params:{"margin-top":[65,10],"margin-left":[45,20]},duration:1e3}}),FigureRules.add(".muffin4.flyingMuffin",{animation:{params:{"margin-top":[65,10],"margin-left":[25,20]},duration:1e3}}),FigureRules.add(".muffin3.flyingMuffin",{animation:{params:{"margin-top":[40,10],"margin-left":[70,20]},duration:1e3}}),FigureRules.add(".muffin2.flyingMuffin",{animation:{params:{"margin-top":[40,10],"margin-left":[45,20]},duration:1e3}}),FigureRules.add(".muffin1.flyingMuffin",{animation:{params:{"margin-top":[40,10],"margin-left":[25,20]},duration:1e3}}),FigureRules.add(".chestWithKeysHead .chestWithKeyskBg",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chestWithKeys/chestWithKeys.a25dd461e9.png","background-position-x":0,"background-position-y":0,"background-width":120,"background-height":127,width:2*Config.cellWidth,height:127/60*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-7/60*Config.cellHeight}),FigureRules.add(".chestWithKeyskBg.chestWithKeysDie",{spriteFrames:9,duration:900,playRound:!1,lastFrame:9}),FigureRules.add(".chestWithKeyskBg.chestWithKeysFlying",{frame:8,animation:{params:{"margin-top":[0*Config.cellWidth,-.5*Config.cellWidth],"margin-left":[-7/60*Config.cellHeight,-37/60*Config.cellHeight]},duration:1e3}}),FigureRules.add(".chestLock",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chestWithKeys/chestLocks.c1a67fe2a4.png","background-position-x":0,"background-position-y":0,"background-width":37,"background-height":49,width:37/60*Config.cellWidth,height:49/60*Config.cellHeight}),FigureRules.add(".chestLock.chestLock1",{"margin-left":.7*Config.cellWidth,"margin-top":.85*Config.cellHeight}),FigureRules.add(".chestLock.chestLock2",{"background-position-x":37,"margin-left":70/60*Config.cellWidth,"margin-top":1.2*Config.cellHeight}),FigureRules.add(".chestLock.chestLock3",{"background-position-x":74,"margin-left":10/60*Config.cellWidth,"margin-top":1.25*Config.cellHeight}),FigureRules.add(".chestLock.chestLock4",{"background-position-x":111,"margin-left":1.3*Config.cellWidth,"margin-top":.3*Config.cellHeight}),FigureRules.add(".chestLock.chestLock5",{"background-position-x":148,"margin-left":5/60*Config.cellWidth,"margin-top":.3*Config.cellHeight}),FigureRules.add(".lockFlying01, .lockFlying11, .lockFlying21, .lockFlying31, .lockFlying41",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chestWithKeys/chestLocksFlying.15a8746d49.png","background-position-x":0,"background-position-y":0,"background-width":31,"background-height":46,width:31/60*Config.cellWidth,height:46/60*Config.cellHeight}),FigureRules.add(".lockFlying01",{"background-position-x":0,"margin-left":.7*Config.cellWidth,"margin-top":.85*Config.cellHeight}),FigureRules.add(".lockFlying11",{"background-position-x":31,"margin-left":70/60*Config.cellWidth,"margin-top":1.2*Config.cellHeight}),FigureRules.add(".lockFlying21",{"background-position-x":62,"margin-left":10/60*Config.cellWidth,"margin-top":1.25*Config.cellHeight}),FigureRules.add(".lockFlying31",{"background-position-x":93,"margin-left":1.3*Config.cellWidth,"margin-top":.3*Config.cellHeight}),FigureRules.add(".lockFlying41",{"background-position-x":124,"margin-left":5/60*Config.cellWidth,"margin-top":.3*Config.cellHeight}),FigureRules.add(".chestKeyCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60}),FigureRules.add(".chestKeyCell .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chestWithKeys/chestKeys.fd6db8a8bd.png","background-position-x":0,"background-position-y":0,width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60}),FigureRules.add(".chestKeyCell_R .cellStone",{"background-position-x":0}),FigureRules.add(".chestKeyCell_G .cellStone",{"background-position-x":60}),FigureRules.add(".chestKeyCell_B .cellStone",{"background-position-x":120}),FigureRules.add(".chestKeyCell_P .cellStone",{"background-position-x":180}),FigureRules.add(".chestKeyCell_Y .cellStone",{"background-position-x":240}),FigureRules.add(".chestKeyCell_W .cellStone",{"background-position-x":300}),FigureRules.add(".gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround3.c768fc9e16.png"}),FigureRules.add(".gravityGroundCell.gravityGroundLife2",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround2.d59367c1e5.png"}),FigureRules.add(".gravityGroundCell.gravityGroundLife1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround3.c768fc9e16.png"}),FigureRules.add(".groundLife2.gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround2.d59367c1e5.png"}),FigureRules.add(".groundLife3.gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGround1.2311b1ae03.png"}),FigureRules.add(".gravityGroundCell.explode",{spriteFrames:3,duration:100}),FigureRules.add(".attribute_ground",{width:140/180*Config.cellWidth,height:160/180*Config.cellHeight,"background-width":140,"background-height":160,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/gold.14d54b15a7.png","margin-left":.05*Config.cellWidth,x:4/60*Config.cellWidth,y:4/60*Config.cellHeight,scale:.8}),FigureRules.add(".attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".attribute_ground.flying",{width:.55*Config.cellWidth,height:132/180*Config.cellHeight,"background-width":99,"background-height":132,"margin-left":.05*Config.cellWidth,x:8/60*Config.cellWidth,y:4/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldTask.c815329fac.png",scale:.8}),FigureRules.add(".gravityGroundExplode1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGroundBreak3.d7b3cce73a.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".gravityGroundExplode2",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGroundBreak2.91fc7398c3.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".gravityGroundExplode1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/catacomb/goldGroundBreak1.ce73abf541.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":220}),FigureRules.add(".gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":440}),FigureRules.add(".gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":660}),FigureRules.add(".pastureCell .pastureBg",{"background-position-x":0,"background-position-y":0,"background-width":272,"background-height":267,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloud_xlarge.4955d55d6d.png",width:272/180*Config.cellWidth,height:267/180*Config.cellHeight,"margin-left":-55/180*Config.cellWidth,"margin-top":-55/180*Config.cellHeight}),FigureRules.add(".pastureCell.life2 .pastureBg, .pastureCell.animateTakeLife1 .pastureBg",{"background-position-x":0,"background-position-y":0,"background-width":272,"background-height":267,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudDark_xlarge.964ea49504.png",width:272/180*Config.cellWidth,height:267/180*Config.cellHeight,"margin-left":-55/180*Config.cellWidth,"margin-top":-55/180*Config.cellHeight}),FigureRules.add(".pastureCell.powerUpHighlight",{animation:{params:{"margin-top":[-25/180*Config.cellHeight,-30/180*Config.cellHeight]},duration:200}}),FigureRules.add(".pastureCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":40/60*Config.cellWidth,"margin-left":5/60*Config.cellHeight}),FigureRules.add(".pastureCell.bottom .pastureBg.stable",{frame:1}),FigureRules.add(".pastureCell.variant2 .pastureDecorator",{"background-position-x":0,"background-position-y":0,"background-width":178,"background-height":183,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudLumps.202b8210f4.png",width:178/180*Config.cellWidth,height:183/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".pastureCell.life2.variant2 .pastureDecorator",{"background-position-x":0,"background-position-y":0,"background-width":178,"background-height":183,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/cloudDarkLumps.7ea163c4c6.png",width:178/180*Config.cellWidth,height:183/180*Config.cellHeight,"margin-left":-19/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".pastureCell.animateRemoval .pastureDecorator, .pastureCell.animateTakeLife1 .pastureDecorator, ",{opacity:0}),FigureRules.add(".pastureCell.animateTakeLife1 .pastureBg.stable",{spriteFrames:10,framesOrder:[0,2,3,4,5,6,7,8,9,10],duration:700,lastFrame:0}),FigureRules.add(".pastureCell.bottom.animateTakeLife1 .pastureBg.stable",{spriteFrames:10,framesOrder:[0,2,3,4,5,6,7,8,9,10],duration:700,lastFrame:1}),FigureRules.add(".pastureCell.animateRemoval .pastureBg.stable",{spriteFrames:10,framesOrder:[0,2,3,4,5,6,7,8,9,10],duration:800}),FigureRules.add(".pastureCell.bottom.animateRemoval .pastureBg.stable",{spriteFrames:10,framesOrder:[1,2,3,4,5,6,7,8,9,10],duration:800}),FigureRules.add(".attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":228,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheep_xlarge.335ce10efa.png",width:206/180*Config.cellWidth,height:228/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".pastureCell.life2 .attribute_animal",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheepDark_xlarge.dbd00f2d21.png"}),FigureRules.add(".attribute_animal.animateHide",{spriteFrames:8,duration:650}),FigureRules.add(".attribute_animal.animateShow",{spriteFrames:8,startFrame:7,duration:600}),FigureRules.add(".attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture/sheepFlying.5b9c2f9b27.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".gemStealer.stable",{spriteFrames:6,duration:300,playRound:!0,delay:[2e3,5e3]}),FigureRules.add(".gemStealer.startEating",{spriteFrames:10,framesOrder:[5,6,7,8,9,10,10,10,10,10],duration:800}),FigureRules.add(".gemStealer.finishEating",{spriteFrames:4,framesOrder:[10,11,12,13],duration:400}),FigureRules.add(".gemStealer.startEating .lifeBlock",{opacity:0}),FigureRules.add(".gemStealer.finishEating .lifeBlock",{opacity:0}),FigureRules.add(".gemStealer.animateCollect .lifeBlock",{opacity:0}),FigureRules.add(".gemStealer.gemStealer_R",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_R.7f7f8c084d.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_G",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_G.f85dca2991.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_B",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":61,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_B.2cf084604e.png",width:61/60*Config.cellWidth,height:61/60*Config.cellHeight,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_Y",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":62,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_Y.6760ba0634.png",width:1*Config.cellWidth,height:62/60*Config.cellHeight,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_P",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":62,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_P.a0f9be111e.png",width:1*Config.cellWidth,height:62/60*Config.cellHeight,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_W",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":61,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealer_W.6528bc2815.png",width:1*Config.cellWidth,height:61/60*Config.cellHeight,"margin-top":-1/60*Config.cellHeight}),FigureRules.add(".gemStealer .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":74,"background-height":68,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer/gemstealerLIfeblock.1121e81ba7.png",width:74/180*Config.cellWidth,height:68/180*Config.cellHeight,"margin-left":50/180*Config.cellWidth,"margin-top":110/180*Config.cellHeight}),FigureRules.add(".gemStealer .lifeBlock .life",{textAlign:"center",font:"normal 16px 'Marvin', 'Tahoma'","margin-left":38/180*Config.cellWidth,"margin-top":52/180*Config.cellHeight}),FigureRules.add(".gemStealer.gemStealer_R .lifeBlock .life",{color:"#891b1b"}),FigureRules.add(".gemStealer.gemStealer_G .lifeBlock .life",{color:"#235600"}),FigureRules.add(".gemStealer.gemStealer_B .lifeBlock .life",{color:"#123a8f"}),FigureRules.add(".gemStealer.gemStealer_Y .lifeBlock .life",{color:"#891b1b"}),FigureRules.add(".gemStealer.gemStealer_P .lifeBlock .life",{color:"#57167e"}),FigureRules.add(".gemStealer.gemStealer_W .lifeBlock .life",{color:"#2c4c4b"}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/firstbonusworld2/artifactPlatform.9da3162586.png"}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/firstbonusworld2/artifactPart.d97d1332f7.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_firstbonusworld2 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".seagullRockCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":169,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/lifebelt.d5f027f4d3.png",width:1*Config.cellWidth,height:169/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":11/180*Config.cellHeight}),FigureRules.add(".rockFront",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":169,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/lifebeltFront.a1f9c9ba01.png",width:1*Config.cellWidth,height:169/180*Config.cellHeight,"margin-left":10/180*Config.cellWidth,"margin-top":80/180*Config.cellHeight}),FigureRules.add(".seagullOnRock.isFlyingToCell .rockFront",{opacity:0}),FigureRules.add(".seagullOnRock .stunStars",{"background-position-x":0,"background-position-y":0,"background-width":153,"background-height":112,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/stunStars.06702983ea.png",width:.85*Config.cellWidth,height:112/180*Config.cellHeight,"margin-left":30/180*Config.cellWidth,"margin-top":40/180*Config.cellHeight,spriteFrames:9,duration:600,playRound:!0,opacity:0}),FigureRules.add(".seagullOnRock.stunned .stunStars",{opacity:1}),FigureRules.add(".seagullOnRock",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":250,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullSit_xlarge.30e4a68020.png",width:250/180*Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-80/180*Config.cellHeight,frame:15}),FigureRules.add(".seagullOnRock.sitting",{spriteFrames:16,duration:1e3}),FigureRules.add(".seagullOnRock.stunned",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":250,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullStun.87c93261fe.png",width:250/180*Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-80/180*Config.cellHeight,frame:0,spriteFrames:0,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".seagullOnRock.hitAnimation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":250,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullHit.2401537935.png",width:250/180*Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-80/180*Config.cellHeight,spriteFrames:2,duration:150,playRound:!1}),FigureRules.add(".seagullOnRock.isFlyingToCell",{"background-position-x":0,"background-position-y":0,"background-width":260,"background-height":207,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/seagullRock/seagullFly.f6805d0a10.png",width:260/180*Config.cellWidth,height:1.15*Config.cellHeight,"margin-left":-50/180*Config.cellWidth,"margin-top":-60/180*Config.cellHeight,spriteFrames:4,duration:150,playRound:!0}),FigureRules.add(".seagullOnRock.isFlyingToCell.flyingRight",{"scale-x":1}),FigureRules.add(".seagullOnRock.isFlyingToCell.flyingRight",{"scale-x":-1}),FigureRules.add(".seagullRockCell.powerUpHighlight",{animation:{params:{"margin-top":[-25/180*Config.cellHeight,-30/180*Config.cellHeight]},duration:200}}),FigureRules.add(".fortHeadCell",{"background-position-x":0,"background-position-y":0,"background-width":134,"background-height":139,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/fortIdle.3caa215c73.png",width:134/60*Config.cellWidth,height:139/60*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":-.1*Config.cellHeight,spriteFrames:8,duration:950,playRound:!0}),FigureRules.add(".fortHeadCell .taskIconContainer",{width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-left":41/60*Config.cellWidth,"margin-top":.5*Config.cellHeight}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_R",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_R.46d878744f.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_G",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_G.b89dd075cb.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_B",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_B.ae1e312675.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_Y",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_Y.53f87ef80a.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_P",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_P.20cab9d90d.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_W",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/color_W.1ef765c038.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_",{"background-height":180,"background-image":"../../../gems/site/img/features/base/g.png","background-width":180,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_CollectCaviar",{"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/caviarTask.77e1e833c3.png","background-width":80,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskIconContainer .taskIco.color_CollectFireFlower",{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/fireFlowerTask.3b597583ec.png","background-width":180,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".fortHeadCell .taskCounterContainer",{"background-height":72,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/bugLifeBlock.9be5443c60.png","background-width":185,"margin-left":35/60*Config.cellWidth,"margin-top":1.25*Config.cellHeight,height:.4*Config.cellHeight,width:185/180*Config.cellWidth}),FigureRules.add(".fortHeadCell .text",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".fortHeadCell .text.currentCount",{"margin-left":23/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".fortHeadCell .text.divider",{"margin-left":35/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".fortHeadCell .text.maximumCount",{"margin-left":47/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".fortHeadCell.removing",{"background-position-x":0,"background-position-y":0,"background-width":134,"background-height":139,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/fortDie.0a1510d2a2.png",width:134/60*Config.cellWidth,height:139/60*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":-.1*Config.cellHeight,spriteFrames:7,duration:500,playRound:!0}),FigureRules.add(".fortExplode.top",{"background-position-x":0,"background-position-y":0,"background-width":124,"background-height":173,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/sharkTop.41e190d827.png",width:124/60*Config.cellWidth,height:173/60*Config.cellHeight,spriteFrames:7,duration:400,playRound:!0}),FigureRules.add(".fortExplode.bottom",{"background-position-x":0,"background-position-y":0,"background-width":124,"background-height":173,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/sharkBottom.0baccc1ffe.png",width:124/60*Config.cellWidth,height:173/60*Config.cellHeight,spriteFrames:7,duration:400,playRound:!0}),FigureRules.add(".fortExplode.left",{"background-position-x":0,"background-position-y":0,"background-width":229,"background-height":123,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/sharkSide.2a3d137079.png",width:229/60*Config.cellWidth,height:2.05*Config.cellHeight,spriteFrames:5,duration:300,playRound:!0}),FigureRules.add(".fortExplode.right",{"background-position-x":0,"background-position-y":0,"background-width":229,"background-height":123,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fort/sharkSide.2a3d137079.png",width:229/60*Config.cellWidth,height:2.05*Config.cellHeight,"scale-x":-1,spriteFrames:5,duration:300,playRound:!0}),FigureRules.add(".squash",{animation:{params:{"scale-y":[1,.8,1],"margin-top":[0,4/62*Config.cellWidth,0]},duration:150}}),FigureRules.add(".vaseBoxHeadCell .vaseBox",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box.e0715f0659.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vaseBoxCover",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box5.f90f30c6df.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell.cover1 .vaseBoxCover",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box1.9025885d4b.png"}),FigureRules.add(".vaseBoxHeadCell.cover2 .vaseBoxCover",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box2.a387f7d603.png"}),FigureRules.add(".vaseBoxHeadCell.cover3 .vaseBoxCover",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box3.f8f8700ca8.png"}),FigureRules.add(".vaseBoxHeadCell.cover4 .vaseBoxCover",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box4.1584b2de0b.png"}),FigureRules.add(".vaseBoxHeadCell .vase",{"background-width":33,"background-height":41,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/vase.f019262207.png",width:.55*Config.cellWidth,height:41/60*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase1",{"margin-left":13/60*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase2",{"margin-left":44/60*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase3",{"margin-left":1.25*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase4",{"margin-left":13/60*Config.cellWidth,"margin-top":.65*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase5",{"margin-left":44/60*Config.cellWidth,"margin-top":.65*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase6",{"margin-left":1.25*Config.cellWidth,"margin-top":.65*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase7",{"margin-left":13/60*Config.cellWidth,"margin-top":1.1*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase8",{"margin-left":44/60*Config.cellWidth,"margin-top":1.1*Config.cellHeight}),FigureRules.add(".vaseBoxHeadCell .vase.vase9",{"margin-left":1.25*Config.cellWidth,"margin-top":1.1*Config.cellHeight}),FigureRules.add(".vaseBoxCover1_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box1.9025885d4b.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxCover1_piece1.vaseBoxCover1_piece",{"background-position-x":120}),FigureRules.add(".vaseBoxCover1_piece2.vaseBoxCover1_piece",{"background-position-x":240}),FigureRules.add(".vaseBoxCover1_piece3.vaseBoxCover1_piece",{"background-position-x":360}),FigureRules.add(".vaseBoxCover1_piece4.vaseBoxCover1_piece",{"background-position-x":480}),FigureRules.add(".vaseBoxCover1_piece5.vaseBoxCover1_piece",{"background-position-x":600}),FigureRules.add(".vaseBoxCover1_piece6.vaseBoxCover1_piece",{"background-position-x":720}),FigureRules.add(".vaseBoxCover1_piece7.vaseBoxCover1_piece",{"background-position-x":840}),FigureRules.add(".vaseBoxCover2_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box2.a387f7d603.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxCover2_piece1.vaseBoxCover2_piece",{"background-position-x":120}),FigureRules.add(".vaseBoxCover2_piece2.vaseBoxCover2_piece",{"background-position-x":240}),FigureRules.add(".vaseBoxCover2_piece3.vaseBoxCover2_piece",{"background-position-x":360}),FigureRules.add(".vaseBoxCover2_piece4.vaseBoxCover2_piece",{"background-position-x":480}),FigureRules.add(".vaseBoxCover2_piece5.vaseBoxCover2_piece",{"background-position-x":600}),FigureRules.add(".vaseBoxCover2_piece6.vaseBoxCover2_piece",{"background-position-x":720}),FigureRules.add(".vaseBoxCover2_piece7.vaseBoxCover2_piece",{"background-position-x":840}),FigureRules.add(".vaseBoxCover2_piece8.vaseBoxCover2_piece",{"background-position-x":960}),FigureRules.add(".vaseBoxCover2_piece9.vaseBoxCover2_piece",{"background-position-x":1080}),FigureRules.add(".vaseBoxCover2_piece10.vaseBoxCover2_piece",{"background-position-x":1200}),FigureRules.add(".vaseBoxCover2_piece11.vaseBoxCover2_piece",{"background-position-x":1320}),FigureRules.add(".vaseBoxCover2_piece12.vaseBoxCover2_piece",{"background-position-x":1440}),FigureRules.add(".vaseBoxCover2_piece13.vaseBoxCover2_piece",{"background-position-x":1560}),FigureRules.add(".vaseBoxCover3_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box3.f8f8700ca8.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxCover3_piece1.vaseBoxCover3_piece",{"background-position-x":120}),FigureRules.add(".vaseBoxCover3_piece2.vaseBoxCover3_piece",{"background-position-x":240}),FigureRules.add(".vaseBoxCover3_piece3.vaseBoxCover3_piece",{"background-position-x":360}),FigureRules.add(".vaseBoxCover3_piece4.vaseBoxCover3_piece",{"background-position-x":480}),FigureRules.add(".vaseBoxCover4_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box4.1584b2de0b.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxCover4_piece1.vaseBoxCover4_piece",{"background-position-x":120}),FigureRules.add(".vaseBoxCover4_piece2.vaseBoxCover4_piece",{"background-position-x":240}),FigureRules.add(".vaseBoxCover4_piece3.vaseBoxCover4_piece",{"background-position-x":360}),FigureRules.add(".vaseBoxCover4_piece4.vaseBoxCover4_piece",{"background-position-x":480}),FigureRules.add(".vaseBoxCover4_piece5.vaseBoxCover4_piece",{"background-position-x":600}),FigureRules.add(".vaseBoxCover4_piece6.vaseBoxCover4_piece",{"background-position-x":720}),FigureRules.add(".vaseBoxCover5_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box5.f90f30c6df.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBoxCover5_piece1.vaseBoxCover5_piece",{"background-position-x":120}),FigureRules.add(".vaseBoxCover5_piece2.vaseBoxCover5_piece",{"background-position-x":240}),FigureRules.add(".vaseBoxCover5_piece3.vaseBoxCover5_piece",{"background-position-x":360}),FigureRules.add(".vaseBoxCover5_piece4.vaseBoxCover5_piece",{"background-position-x":480}),FigureRules.add(".vaseBoxCover5_piece5.vaseBoxCover5_piece",{"background-position-x":600}),FigureRules.add(".vaseBoxCover5_piece6.vaseBoxCover5_piece",{"background-position-x":720}),FigureRules.add(".vaseBoxCover5_piece7.vaseBoxCover5_piece",{"background-position-x":840}),FigureRules.add(".vaseBoxCover5_piece8.vaseBoxCover5_piece",{"background-position-x":960}),FigureRules.add(".vaseBoxCover5_piece9.vaseBoxCover5_piece",{"background-position-x":1080}),FigureRules.add(".vase_piece",{"background-width":33,"background-height":41,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/vase.f019262207.png",width:.55*Config.cellWidth,height:41/60*Config.cellHeight}),FigureRules.add(".vase_piece1.vase_piece",{"background-position-x":33}),FigureRules.add(".vase_piece2.vase_piece",{"background-position-x":66}),FigureRules.add(".vase_piece3.vase_piece",{"background-position-x":99}),FigureRules.add(".vase_piece4.vase_piece",{"background-position-x":132}),FigureRules.add(".vase_piece5.vase_piece",{"background-position-x":165}),FigureRules.add(".vase_piece6.vase_piece",{"background-position-x":198}),FigureRules.add(".vase_piece7.vase_piece",{"background-position-x":231}),FigureRules.add(".vase_piece8.vase_piece",{"background-position-x":264}),FigureRules.add(".vaseBox_piece",{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/vasebox/box.e0715f0659.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".vaseBox_piece1.vaseBox_piece",{"background-position-x":120}),FigureRules.add(".vaseBox_piece2.vaseBox_piece",{"background-position-x":240}),FigureRules.add(".vaseBox_piece3.vaseBox_piece",{"background-position-x":360}),FigureRules.add(".vaseBox_piece4.vaseBox_piece",{"background-position-x":480}),FigureRules.add(".vaseBox_piece5.vaseBox_piece",{"background-position-x":600}),FigureRules.add(".vaseBox_piece6.vaseBox_piece",{"background-position-x":720}),FigureRules.add(".vaseBox_piece7.vaseBox_piece",{"background-position-x":840}),FigureRules.add(".vaseBox_piece8.vaseBox_piece",{"background-position-x":960}),FigureRules.add(".vaseBox_piece9.vaseBox_piece",{"background-position-x":1080}),FigureRules.add(".decorator_eel.head",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/head.d078754e47.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.next_bottom.head",{rotate:90}),FigureRules.add(".decorator_eel.next_left.head",{"scale-x":-1}),FigureRules.add(".decorator_eel.next_top.head",{rotate:-90,"scale-x":-1}),FigureRules.add(".decorator_eel.afterHead .eel_fin",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/fin.51ec816ee1.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.afterHead .fin2.stable",{"background-position-x":0,"background-position-y":0,"background-width":210,"background-height":118,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/fin2.3d4b5943f1.png",width:210/180*Config.cellWidth,height:118/180*Config.cellHeight,"margin-left":-.5*Config.cellWidth,"margin-top":.25*Config.cellHeight,animation:{params:{rotate:[0,10,20,30,20,10,0,-10,0]},playRoundDelay:[4e3,1e4],duration:1e3,playRound:!0}}),FigureRules.add(".decorator_eel.prev_right.next_left.afterHead .eel_fin",{"scale-y":-1}),FigureRules.add(".decorator_eel.tail",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/tail.fd3b2ef55c.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.prev_left.tail",{rotate:90}),FigureRules.add(".decorator_eel.prev_top.tail",{rotate:180}),FigureRules.add(".decorator_eel.prev_right.tail",{rotate:270}),FigureRules.add(".decorator_eel.body",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/body.8eb13fcdcc.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.horizontal.body",{rotate:90}),FigureRules.add(".decorator_eel.horizontal.body .eel_fin",{rotate:-90}),FigureRules.add(".decorator_eel.vertical.body .eel_fin",{rotate:90,"scale-y":-1}),FigureRules.add(".decorator_eel.vertical.prev_top.next_bottom.body .eel_fin",{"scale-y":1}),FigureRules.add(".decorator_eel.next_bottom.prev_left.corner .part1, .decorator_eel.next_left.prev_bottom.corner .part1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner1.ce2bc79353.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-180}),FigureRules.add(".decorator_eel.next_bottom.prev_left.corner .part2, .decorator_eel.next_left.prev_bottom.corner .part2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner2.dcea78cfa7.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-180}),FigureRules.add(".decorator_eel.next_bottom.prev_left.corner .part3, .decorator_eel.next_left.prev_bottom.corner .part3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner3.51e6c88d00.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-180}),FigureRules.add(".decorator_eel.next_left.prev_bottom.corner .eel_fin",{rotate:90,"scale-y":-1}),FigureRules.add(".decorator_eel.next_right.prev_top.corner .part1, .decorator_eel.next_top.prev_right.corner .part1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner1.ce2bc79353.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:0}),FigureRules.add(".decorator_eel.next_right.prev_top.corner .part2, .decorator_eel.next_top.prev_right.corner .part2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner2.dcea78cfa7.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.next_right.prev_top.corner .part3, .decorator_eel.next_top.prev_right.corner .part3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner3.51e6c88d00.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.next_right.prev_top.corner .eel_fin",{rotate:90}),FigureRules.add(".decorator_eel.next_top.prev_right.corner .eel_fin",{rotate:180,"scale-y":-1}),FigureRules.add(".decorator_eel.corner.hidePart1 .part1",{opacity:"0"}),FigureRules.add(".decorator_eel.corner.hidePart2 .part2",{opacity:"0"}),FigureRules.add(".decorator_eel.corner.hidePart3 .part3",{opacity:"0"}),FigureRules.add(".decorator_eel.next_top.prev_left.corner .part1, .decorator_eel.next_left.prev_top.corner .part1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner1.ce2bc79353.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-90}),FigureRules.add(".decorator_eel.next_top.prev_left.corner .part2, .decorator_eel.next_left.prev_top.corner .part2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner2.dcea78cfa7.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-90}),FigureRules.add(".decorator_eel.next_top.prev_left.corner .part3, .decorator_eel.next_left.prev_top.corner .part3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner3.51e6c88d00.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:-90}),FigureRules.add(".decorator_eel.next_top.prev_left.corner .eel_fin",{rotate:0}),FigureRules.add(".decorator_eel.next_left.prev_top.corner .eel_fin",{rotate:90}),FigureRules.add(".decorator_eel.next_right.prev_bottom.corner .part1, .decorator_eel.next_bottom.prev_right.corner .part1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner1.ce2bc79353.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:90}),FigureRules.add(".decorator_eel.next_right.prev_bottom.corner .part2, .decorator_eel.next_bottom.prev_right.corner .part2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner2.dcea78cfa7.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:90}),FigureRules.add(".decorator_eel.next_right.prev_bottom.corner .part3, .decorator_eel.next_bottom.prev_right.corner .part3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/corner3.51e6c88d00.png",width:1*Config.cellWidth,height:1*Config.cellHeight,rotate:90}),FigureRules.add(".decorator_eel.next_right.prev_bottom.corner .eel_fin",{rotate:90,"scale-y":-1}),FigureRules.add(".decorator_eel.next_bottom.prev_right.corner .eel_fin",{rotate:-180,"scale-y":-1}),FigureRules.add(".decorator_eel.babyEel.tail",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformTail.e65e9d304f.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".decorator_eel.babyEel.prev_bottom.tail",{"scale-x":-1}),FigureRules.add(".decorator_eel.babyEel.prev_right.tail",{"scale-y":-1}),FigureRules.add(".decorator_eel.babyEel.head",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformHead.b9be984e41.png",width:1*Config.cellWidth,height:1*Config.cellHeight});FigureRules.add(".decorator_eel.babyEel .eel_fin",{opacity:0}),FigureRules.add(".decorator_eel.babyEelTask",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelBaby.81bf2ca48e.png",width:2*Config.cellWidth,height:1*Config.cellHeight,"margin-left":5/60*Config.cellWidth,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".decorator_eel.head.damaged",{spriteFrames:4,duration:400,playRound:!1}),FigureRules.add(".decorator_eel.head.damaged .eel_stars",{"background-position-x":0,"background-position-y":0,"background-width":89,"background-height":44,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/stars.8d79373e8c.png",width:89/180*Config.cellWidth,height:44/180*Config.cellHeight,"margin-left":.2*Config.cellWidth,"margin-top":-.1*Config.cellHeight,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".decorator_eel.head .eel_fin.stable",{"background-position-x":0,"background-position-y":0,"background-width":58,"background-height":59,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eye.1f41cf5eaa.png",width:58/180*Config.cellWidth,height:59/180*Config.cellHeight,"margin-left":.45*Config.cellWidth,"margin-top":17/60*Config.cellHeight,spriteFrames:19,framesOrder:[0,1,2,3,4,5,6,7,7,7,7,7,6,5,4,3,2,1,0],delay:[3e3,5e3],duration:1500,playRound:!0}),FigureRules.add(".decorator_eel.babyEel.head .eel_fin.stable",{"background-position-x":0,"background-position-y":0,"background-width":63,"background-height":65,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/babyEye.2b972852e0.png",width:.35*Config.cellWidth,height:65/180*Config.cellHeight,opacity:1,"margin-left":20/60*Config.cellWidth,"margin-top":11/60*Config.cellHeight,spriteFrames:11,framesOrder:[0,1,2,3,3,3,3,3,2,1,0],delay:[3e3,5e3],duration:700,playRound:!0}),FigureRules.add(".decorator_eel.head.damaged .eel_fin",{opacity:0}),FigureRules.add(".decorator_eel.body.damaged",{spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".decorator_eel.damaged .part1, .decorator_eel.corner.damaged .part2, .decorator_eel.corner.damaged .part3",{spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".decorator_eel.tail.damaged",{spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".eelDecoratorOnCell .attribute.attribute_falling",{opacity:0}),FigureRules.add(".eelDecoratorOnCell.caviarCell .stable",{animation:{}}),FigureRules.add(".topRightFieldSide .decorator_eel.head.vertical.next_bottom",{"scale-x":-1}),FigureRules.add(".topRightFieldSide .decorator_eel.afterHead.vertical.next_bottom .eel_fin",{"scale-x":-1}),FigureRules.add(".topRightFieldSide .decorator_eel.head.vertical.next_top",{"scale-x":1}),FigureRules.add(".topRightFieldSide .decorator_eel.afterHead.vertical.next_top .eel_fin",{"scale-x":-1}),FigureRules.add(".topRightFieldSide .decorator_eel.tail.vertical.prev_top",{"scale-x":-1}),FigureRules.add(".topRightFieldSide .decorator_eel.tail.vertical.prev_bottom",{"scale-x":1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.head.vertical.next_top",{"scale-x":1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.afterHead.vertical.next_top .eel_fin",{"scale-x":-1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.head.vertical.next_bottom",{"scale-x":-1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.afterHead.vertical.next_bottom .eel_fin",{"scale-x":-1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.tail.vertical.prev_top",{"scale-x":-1}),FigureRules.add(".bottomRightFieldSide .decorator_eel.tail.vertical.prev_bottom",{"scale-x":1}),FigureRules.add(".babyEelTransform .decorator_eel.head",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformHead.b9be984e41.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".babyEelTransform .decorator_eel.tail",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eel/eelTransformTail.e65e9d304f.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".babyEelTransform .decorator_eel.babyEel.head .eel_fin.stable",{opacity:0}),FigureRules.add(".babyEelEyeAnimation .decorator_eel.babyEel.head .eel_fin.stable",{opacity:1}),FigureRules.add(".eelDecoratorOnCell .eelDecoratorShadow",{"background-color":"#000000","background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight,opacity:.3}),FigureRules.add(".glowwormCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":""}),FigureRules.add(".glowwormCell.stable",{"background-width":180,"background-height":180,"background-position-x":0,"background-position-y":0,width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:12,duration:1200,playRound:!0}),FigureRules.add(".glowwormCell.damage",{"background-width":270,"background-height":270,"background-position-x":0,"background-position-y":0,width:1.5*Config.cellWidth,height:1.5*Config.cellHeight,"margin-left":-.25*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:9,duration:500}),FigureRules.add(".glowwormCell.afterDamage",{"background-width":270,"background-height":270,"background-position-x":0,"background-position-y":0,width:1.5*Config.cellWidth,height:1.5*Config.cellHeight,"margin-left":-.25*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:9,duration:500}),FigureRules.add(".glowwormCell.beforeCollect",{width:104,height:110,"background-width":104,"background-height":110}),FigureRules.add(".glowwormCollect",{width:104,height:110,"background-width":104,"background-height":110,"margin-left":-30,"margin-top":-30,"scale-x":.5,"scale-y":.5}),FigureRules.add(".glowwormCell_R.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_R.717ffe2b93.png"}),FigureRules.add(".glowwormCell_R.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_R.9729e4bd40.png"}),FigureRules.add(".glowwormCell_R.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_R.68929878ab.png"}),FigureRules.add(".glowwormCollect.glowwormCell_R",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_R.efe0d9e559.png"}),FigureRules.add(".glowwormCell_G.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_G.0ab88a5e8e.png"}),FigureRules.add(".glowwormCell_G.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_G.e4c3812e4c.png"}),FigureRules.add(".glowwormCell_G.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_G.b94595567a.png"}),FigureRules.add(".glowwormCollect.glowwormCell_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_G.dbaa6e19b2.png"}),FigureRules.add(".glowwormCell_B.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_B.f75987be83.png"}),FigureRules.add(".glowwormCell_B.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_B.f13686cca0.png"}),FigureRules.add(".glowwormCell_B.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_B.90edc70626.png"}),FigureRules.add(".glowwormCollect.glowwormCell_B",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_B.6652d6bd51.png"}),FigureRules.add(".glowwormCell_Y.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_Y.c8b3130666.png"}),FigureRules.add(".glowwormCell_Y.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_Y.1040136879.png"}),FigureRules.add(".glowwormCell_Y.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_Y.22a47ad61a.png"}),FigureRules.add(".glowwormCollect.glowwormCell_Y",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_Y.8e37ef7af6.png"}),FigureRules.add(".glowwormCell_P.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_P.4b311e5e71.png"}),FigureRules.add(".glowwormCell_P.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_P.c5403d3036.png"}),FigureRules.add(".glowwormCell_P.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_P.ff21cd104c.png"}),FigureRules.add(".glowwormCollect.glowwormCell_P",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_P.6ef23382cf.png"}),FigureRules.add(".glowwormCell_W.stable",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle_W.c736e2e4ad.png"}),FigureRules.add(".glowwormCell_W.damage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-open_W.cec4858db7.png"}),FigureRules.add(".glowwormCell_W.afterDamage",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowworm-bottle-fill_W.e357311d0b.png"}),FigureRules.add(".glowwormCollect.glowwormCell_W",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/glowworm/glowwormTask_W.de20874b8d.png"}),FigureRules.add(".secondAttribute_prizePointMark",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/prizePointMark/prizeMark.fa83b29fec.png",width:.5*Config.cellWidth,height:.5*Config.cellHeight,"margin-top":.5*Config.cellHeight,"margin-left":.5*Config.cellWidth}),FigureRules.add(".secondAttribute_diceAdventurePrizePointMark",{"background-position-x":0,"background-position-y":0,"background-width":55,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/diceAdventurePrizePointMark/prizeMark.dbc47fe6d6.png",width:.5*Config.cellWidth,height:.5*Config.cellHeight,"margin-top":.5*Config.cellHeight,"margin-left":.5*Config.cellWidth}),FigureRules.add(".boxCell",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/artifactBox.617fb791a4.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".boxCellExplode1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png"}),FigureRules.add(".boxCellExplode2",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":60}),FigureRules.add(".boxCellExplode3",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":120}),FigureRules.add(".boxCellExplode4",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":180}),FigureRules.add(".boxCellExplode5",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":240}),FigureRules.add(".boxCellExplode6",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":300}),FigureRules.add(".boxCellExplode7",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":360}),FigureRules.add(".boxCellExplode8",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":420}),FigureRules.add(".boxCellExplode9",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/box/boxParts.54fa1839b8.png","background-position-x":480}),FigureRules.add(".cancerBgCell, .cancerBgCornerCell, .cancerBgEndCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".cancerBgCell.rotation, .cancerBgCornerCell.rotation, .cancerBgEndCell.rotation, .middleAnemoneCell.rotation, .endAnemoneCell.rotation",{rotate:90}),FigureRules.add(".cancerBgCell.rotationRevers, .cancerBgCornerCell.rotationRevers, .cancerBgEndCell.rotationRevers, .endAnemoneCell.rotationRevers",{rotate:-90}),FigureRules.add(".cancerBgCell.rotation180, .cancerBgCornerCell.rotation180, .cancerBgEndCell.rotation180,",{rotate:180}),FigureRules.add(".cancerBgCornerCell.rotationRevers180",{rotate:-180}),FigureRules.add(".cancerBgCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sand.60db2bb5c1.png"}),FigureRules.add(".cancerBgCornerCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sandCorner.fc399e4949.png"}),FigureRules.add(".cancerBgEndCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/sandEnd.9b10996255.png"}),FigureRules.add(".middleAnemoneCell .lineTop, .middleAnemoneCell .lineBottom, .endAnemoneCell .lineTop, .endAnemoneCell .lineBottom, .endAnemoneCell .lineLeft, .cornerAnemoneCell .lineTop, .cornerAnemoneCell .lineRight",{"background-width":30,"background-height":30,width:1/6*Config.cellWidth,height:1/6*Config.cellHeight,"margin-top":0,"margin-left":0}),FigureRules.add(".endAnemoneCell .cornerTop, .endAnemoneCell .cornerBottom, .cornerAnemoneCell .cornerTop",{"background-width":48,"background-height":48,width:48/180*Config.cellWidth,height:48/180*Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".middleAnemoneCell .lineTop",{"scale-x":6,"margin-left":5/6*Config.cellWidth/2}),FigureRules.add(".middleAnemoneCell .lineBottom",{"scale-x":6,"margin-left":5/6*Config.cellWidth/2,"margin-top":5/6*Config.cellWidth}),FigureRules.add(".endAnemoneCell .lineTop",{"scale-x":134/30,"margin-left":32.5}),FigureRules.add(".endAnemoneCell .lineBottom",{"scale-x":134/30,"margin-left":32.5,"margin-top":5/6*Config.cellWidth}),FigureRules.add(".endAnemoneCell .lineLeft",{"scale-y":(Config.cellWidth-96/180*Config.cellHeight)/(1/6*Config.cellWidth),"margin-top":Config.cellHeight/2-1/12*Config.cellHeight,rotate:90}),FigureRules.add(".endAnemoneCell .cornerBottom",{"margin-top":Config.cellHeight-48/180*Config.cellHeight,"scale-y":-1}),FigureRules.add(".cornerAnemoneCell .cornerTop",{"margin-left":Config.cellWidth-48/180*Config.cellWidth,"scale-x":-1}),FigureRules.add(".cornerAnemoneCell .cornerBottom",{"background-width":30,"background-height":30,width:30/180*Config.cellWidth,height:30/180*Config.cellHeight,"margin-left":0,"margin-top":Config.cellHeight-30/180*Config.cellHeight,"scale-x":-1}),FigureRules.add(".cornerAnemoneCell .lineTop",{"scale-x":134/30,"margin-left":104/30*(1/6*Config.cellWidth)/2}),FigureRules.add(".cornerAnemoneCell .lineRight",{"scale-y":134/30,"margin-left":5/6*Config.cellWidth,"margin-top":32.5,rotate:90}),FigureRules.add(".colorBorderG .cornerAnemoneCell .lineRight, .colorBorderG .cornerAnemoneCell .lineTop, .colorBorderG .endAnemoneCell .lineLeft, .colorBorderG .endAnemoneCell .lineBottom, .colorBorderG .endAnemoneCell .lineTop, .colorBorderG .middleAnemoneCell .lineBottom, .colorBorderG .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameG.6487d57a55.png"}),FigureRules.add(".colorBorderW .cornerAnemoneCell .lineRight, .colorBorderW .cornerAnemoneCell .lineTop, .colorBorderW .endAnemoneCell .lineLeft, .colorBorderW .endAnemoneCell .lineBottom, .colorBorderW .endAnemoneCell .lineTop, .colorBorderW .middleAnemoneCell .lineBottom, .colorBorderW .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameW.7010d3ef95.png"}),FigureRules.add(".colorBorderR .cornerAnemoneCell .lineRight, .colorBorderR .cornerAnemoneCell .lineTop, .colorBorderR .endAnemoneCell .lineLeft, .colorBorderR .endAnemoneCell .lineBottom, .colorBorderR .endAnemoneCell .lineTop, .colorBorderR .middleAnemoneCell .lineBottom, .colorBorderR .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameR.cfb6ff0c18.png"}),FigureRules.add(".colorBorderP .cornerAnemoneCell .lineRight, .colorBorderP .cornerAnemoneCell .lineTop, .colorBorderP .endAnemoneCell .lineLeft, .colorBorderP .endAnemoneCell .lineBottom, .colorBorderP .endAnemoneCell .lineTop, .colorBorderP .middleAnemoneCell .lineBottom, .colorBorderP .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameP.b497dc3426.png"}),FigureRules.add(".colorBorderB .cornerAnemoneCell .lineRight, .colorBorderB .cornerAnemoneCell .lineTop, .colorBorderB .endAnemoneCell .lineLeft, .colorBorderB .endAnemoneCell .lineBottom, .colorBorderB .endAnemoneCell .lineTop, .colorBorderB .middleAnemoneCell .lineBottom, .colorBorderB .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameB.1970447a20.png"}),FigureRules.add(".colorBorderY .cornerAnemoneCell .lineRight, .colorBorderY .cornerAnemoneCell .lineTop, .colorBorderY .endAnemoneCell .lineLeft, .colorBorderY .endAnemoneCell .lineBottom, .colorBorderY .endAnemoneCell .lineTop, .colorBorderY .middleAnemoneCell .lineBottom, .colorBorderY .middleAnemoneCell .lineTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameY.fa53f838c6.png"}),FigureRules.add(".colorBorderG .endAnemoneCell .cornerTop, .colorBorderG .endAnemoneCell .cornerBottom, .colorBorderG .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerG.919b6095c7.png"}),FigureRules.add(".colorBorderW .endAnemoneCell .cornerTop, .colorBorderW .endAnemoneCell .cornerBottom, .colorBorderW .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerW.0c90947e82.png"}),FigureRules.add(".colorBorderR .endAnemoneCell .cornerTop, .colorBorderR .endAnemoneCell .cornerBottom, .colorBorderR .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerR.5cf547018a.png"}),FigureRules.add(".colorBorderY .endAnemoneCell .cornerTop, .colorBorderY .endAnemoneCell .cornerBottom, .colorBorderY .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerY.9c48b16119.png"}),FigureRules.add(".colorBorderB .endAnemoneCell .cornerTop, .colorBorderB .endAnemoneCell .cornerBottom, .colorBorderB .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerB.80ab6c2914.png"}),FigureRules.add(".colorBorderP .endAnemoneCell .cornerTop, .colorBorderP .endAnemoneCell .cornerBottom, .colorBorderP .cornerAnemoneCell .cornerTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerP.b6528bc4b9.png"}),FigureRules.add(".colorBorderG .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDG.315e02f335.png"}),FigureRules.add(".colorBorderW .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDW.da3c7fcd85.png"}),FigureRules.add(".colorBorderR .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDR.480d68ba1c.png"}),FigureRules.add(".colorBorderY .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDY.0bd2267def.png"}),FigureRules.add(".colorBorderB .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDB.44e27889c6.png"}),FigureRules.add(".colorBorderP .cornerAnemoneCell .cornerBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/frameCornerDP.6d9003f0bc.png"}),FigureRules.add(".colorBorderP.showBorder, colorBorderR.showBorder, colorBorderW.showBorder, colorBorderB.showBorder, colorBorderG.showBorder, colorBorderY.showBorder",{animation:{params:{opacity:[0,1],scale:[1,.995,1]},duration:400}}),FigureRules.add(".colorBorderP.hideBorder, colorBorderR.hideBorder, colorBorderW.hideBorder, colorBorderB.hideBorder, colorBorderG.hideBorder, colorBorderY.hideBorder",{animation:{params:{opacity:[1,0],scale:[1,.995,1]},duration:400}}),FigureRules.add(".anemoneGroupRemove",{animation:{params:{opacity:[1,0]},duration:200}}),FigureRules.add(".cancerGroup",{width:.5*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".cancerHole",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/hole.76f47584a4.png","background-width":80,"background-height":65,"margin-top":115/180*Config.cellWidth/2,"margin-left":100/180*Config.cellWidth/2,width:80/180*Config.cellWidth,height:65/180*Config.cellHeight}),FigureRules.add(".cancerHole.top",{"margin-left":280/180*Config.cellWidth/2}),FigureRules.add(".cancerHole.left",{"margin-top":295/180*Config.cellWidth/2}),FigureRules.add(".cancerHole.bottom",{"margin-left":-80/180*Config.cellHeight/2}),FigureRules.add(".cancerHole.right",{"margin-top":-65/180*Config.cellWidth/2}),FigureRules.add(".cancer.cancerB, .cancer.cancerG, .cancer.cancerW, .cancer.cancerP, .cancer.cancerR, .cancer.cancerY",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".cancerGroup.top",{"margin-left":Config.cellHeight/2}),FigureRules.add(".cancerGroup.left",{"margin-top":Config.cellWidth/2}),FigureRules.add(".cancerGroup.bottom",{"margin-left":-Config.cellHeight/2}),FigureRules.add(".cancerGroup.right",{"margin-top":-Config.cellWidth/2}),FigureRules.add(".cancer.cancerB",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearB.e099c3b0ce.png"}),FigureRules.add(".cancer.cancerW",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearW.c8a5f61a5d.png"}),FigureRules.add(".cancer.cancerG",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearG.f75c29067a.png"}),FigureRules.add(".cancer.cancerP",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearP.39c791d125.png"}),FigureRules.add(".cancer.cancerR",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearR.a57cc6867c.png"}),FigureRules.add(".cancer.cancerY",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/appearY.294e82821a.png"}),FigureRules.add(".cancer.animateAppear",{duration:600,spriteFrames:11,playRound:!1}),FigureRules.add(".cancerGroup .blink.animateBlink",{"background-position-x":0,"background-position-y":0,"background-width":95,"background-height":70,width:95/180*Config.cellWidth,height:70/180*Config.cellHeight,"margin-top":26,"margin-left":85/180*Config.cellWidth/2,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/blink.291512f9e7.png",duration:500,spriteFrames:5,delay:[4e3,7e3],playRound:!0}),FigureRules.add(".cancer.animateFlyB, .cancer.animateFlyW, .cancer.animateFlyG, .cancer.animateFlyP, .cancer.animateFlyR, .cancer.animateFlyY",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":254,width:180/139*Config.cellWidth,height:254/139*Config.cellHeight,"margin-top":-25,"margin-left":(Config.cellWidth-180/139*Config.cellWidth)/2,spriteFrames:7,duration:700}),FigureRules.add(".cancer.animateFlyB",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyB.9675df1103.png"}),FigureRules.add(".cancer.animateFlyW",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyW.80b5b906d0.png"}),FigureRules.add(".cancer.animateFlyG",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyG.4864f07ea2.png"}),FigureRules.add(".cancer.animateFlyP",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyP.6ba579a768.png"}),FigureRules.add(".cancer.animateFlyR",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyR.151db0fcde.png"}),FigureRules.add(".cancer.animateFlyY",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/anemone/flyY.04f61b4d33.png"})},figureRulesProcess.commonFeaturesClasses=function(){};var figureAnimationProcess=function(){FigureAnimations.powerUpHighlight={params:{"margin-top":[0,-.05*Config.cellHeight,0]},duration:2e3},FigureAnimations.gameMessageBlockShow={params:{opacity:[0,1]},duration:100},FigureAnimations.gameMessageBlockHide={params:{opacity:[1,0]},duration:100},FigureAnimations.scoreAnimation={params:{scale:[1,1.5,1],"margin-top":[0,-10,0]},duration:300},FigureAnimations.bonusLevelMonsterOut={params:{"margin-left":[0,125]},duration:800},FigureAnimations.bonusLevelPrizeFly={params:{x:[671,350],y:[564,225],width:[74,149],height:[60,121]},duration:1e3},FigureAnimations.turtleDowngrade3={params:{spriteFrames:5},duration:400},FigureAnimations.turtleDowngrade2={params:{spriteFrames:8},duration:700},FigureAnimations.turtleUpgrade3={params:{spriteFrames:5,framesOrder:[4,3,2,1,0]},duration:500},FigureAnimations.turtleUpgrade2={params:{spriteFrames:8,framesOrder:[7,6,5,4,3,2,1,0]},duration:700},FigureAnimations.bonusLevelPrizeOpen={params:{spriteFrames:3,framesOrder:[0,1,2]},duration:300},FigureAnimations.candyCellRemove={params:{spriteFrames:9},duration:500},FigureAnimations.candyCellAnimate2={params:{spriteFrames:10},duration:500},FigureAnimations.caviarTakeLife2={params:{scale:[1,1.3]},duration:100},FigureAnimations.caviarTakeLife1={params:{},duration:700},FigureAnimations.caviarTakeLife2wildwildwest={params:{},duration:700},FigureAnimations.caviarTakeLife1wildwildwest={params:{},duration:700},FigureAnimations.caviarTakeLife0wildwildwest={params:{},duration:700},FigureAnimations.FishnetRemoveRope={params:{spriteFrames:3},duration:270},FigureAnimations.MermaidDie={params:{scale:[1,0],opacity:[1,0],"margin-left":[0*Config.cellWidth,.5*Config.cellWidth],"margin-top":[0*Config.cellHeight,.5*Config.cellHeight]},duration:700},FigureAnimations.FlamyDie={params:{scale:[1,0],opacity:[1,0],"margin-left":[0*Config.cellWidth,.5*Config.cellWidth],"margin-top":[0*Config.cellHeight,.5*Config.cellHeight]},duration:700},FigureAnimations.BugDie={params:{scale:[1,0],opacity:[1,0],"margin-left":[0*Config.cellWidth,.5*Config.cellWidth],"margin-top":[0*Config.cellHeight,.5*Config.cellHeight]},duration:700},FigureAnimations.eaterstarsBeforeCollect={params:{},duration:600},FigureAnimations.eaterstarsAfterCollect={params:{},duration:100},FigureAnimations.eaterstarsDie={params:{scale:[1,0],opacity:[1,0]},duration:700},FigureAnimations.seaweedDecoratorDie=[{params:{spriteFrames:2},duration:100},{params:{opacity:[1,0]},duration:100}],FigureAnimations.seaHorseStart={params:{spriteFrames:3,framesOrder:[8,9,10]},duration:150},FigureAnimations.blackholeEat={params:{spriteFrames:9,framesOrder:[5,6,7,8,9,10,11,12,13]},duration:450},FigureAnimations.twinkleDie={params:{scale:[1,0],opacity:[1,0]},duration:700},FigureAnimations.parrotChangeLevel2={params:{spriteFrames:5},duration:500},FigureAnimations.parrotChangeLevel1={params:{spriteFrames:5,framesOrder:[5,6,7,8,9]},duration:500},"undefined"!=typeof mobileFigureAnimationProcess&&mobileFigureAnimationProcess()};figureRulesProcess.additionalClasses=function(){var e=document.getElementById("canvas");FigureRules.add(".fieldContainer",{"margin-left":114,"margin-top":30}),FigureRules.add(".level_bonus .fieldContainer",{"margin-left":90,"margin-top":10}),FigureRules.add(".moves, .fpsCounter, .gameTimeBlock",{cache:!0}),FigureRules.add(".fieldPoints.collectTaskElem",{width:100,"text-left":50}),FigureRules.add(".fieldDisabledArrow",{"background-position-x":0,"background-position-y":0,"background-width":45,"background-height":70,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/animations/levelAnimation.e5e816bb62.png",width:45,height:70,"margin-left":-25,"margin-top":-70,spriteFrames:6,duration:650,playRound:!0}),FigureRules.add(".layer",{width:760,height:660}),FigureRules.add(".bottomGamePanel",{width:760,height:88,x:0,y:"100%","margin-top":-88}),FigureRules.add(".level_bonus .bottomGamePanel, .level_bonus .moves",{opacity:0}),FigureRules.add(".gameProgress",{width:440,height:20,x:220,y:"auto","margin-left":2,"margin-top":2}),FigureRules.add(".gameProgress .gameProgressBorder",{width:"auto",height:"auto","margin-left":1,"margin-top":1}),FigureRules.add(".gameProgress .gameProgressLine",{width:0,height:18}),FigureRules.add(".gameProgress .scoreMarkSign1",{x:"50%"}),FigureRules.add(".gameProgress .scoreMarkSign2",{x:"75%"}),FigureRules.add(".gameProgress .scoreMark1",{x:"50%"}),FigureRules.add(".gameProgress .scoreMark2",{x:"75%"}),FigureRules.add(".gameProgress .scoreMark3",{x:"100%"}),FigureRules.add(".gameProgress .scoreMarkSign",{"margin-top":-13,"margin-left":-2,"background-color":"#9f3f05",width:4,height:45}),FigureRules.add(".gameProgress .scoreMarkStars",{x:0,y:-40}),FigureRules.add(".gameProgress .scoreMarkStars",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/scoreMarkStars.d35f96460e.png"}),FigureRules.add(".gameProgress .scoreMarkStars.complete",{"background-position-y":53}),FigureRules.add(".gameProgress .scoreMark1 .scoreMarkStars",{"background-position-y":9,width:32,height:32,"background-width":32,"background-height":32,"margin-left":-16}),FigureRules.add(".gameProgress .scoreMark2 .scoreMarkStars",{"background-position-x":32,"background-position-y":9,width:62,height:35,"background-width":62,"background-height":35,"margin-left":-31}),FigureRules.add(".gameProgress .scoreMark3 .scoreMarkStars",{"background-position-x":94,width:74,height:44,"background-width":74,"background-height":44,"margin-left":-60}),FigureRules.add(".gameProgress .scoreMark3 .scoreMarkStars.complete",{"background-position-y":44}),FigureRules.add(".moves",{width:60,height:40,font:"normal 34px 'Marvin', Tahoma, 'Geneva CY', sans-serif","text-left":24,"text-top":35,textAlign:"center",color:"#fcebc4",x:33,y:131}),FigureRules.add(".moves.levelSpecial",{y:131}),FigureRules.add(".gameTimeBlock",{font:"normal 52px 'Marvin', Tahoma, 'Geneva CY', sans-serif",textAlign:"center",color:"#fff",strokeStyle:"#28326a",lineWidth:6,x:700,y:100,scale:.5}),FigureRules.add(".moves.lessAmount",{color:"#fe8923"}),FigureRules.add(".powerUps",{x:650,y:270}),FigureRules.add(".powerUp",{"background-position-x":0,"background-position-y":0,"background-width":91,"background-height":91,width:91,height:91,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/web/boostersBg.7bc333a9c1.png"}),FigureRules.add(".powerUp.inForce",{}),FigureRules.add(".powerUp .powerUpImageIcon",{"background-width":50,"background-height":54,width:50,height:54,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/web/boosters.68528178df.png","margin-left":21,"margin-top":18}),FigureRules.add(".shufflePowerUp .powerUpImageIcon",{"background-position-x":50}),FigureRules.add(".lightingPowerUp .powerUpImageIcon",{"background-position-x":100}),FigureRules.add(".powerUp .powerUpCircle",{width:36,height:36,"background-width":36,"background-height":36,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/web/boosterAmount.141d819222.png",font:"normal 20px 'Marvin', Tahoma, 'Geneva CY', sans-serif",color:"#fcebc4",lineWidth:3,strokeStyle:"#5d7600",textAlign:"center","margin-left":60,"margin-top":60,"text-left":18,"text-top":25}),FigureRules.add(".powerUp .powerUpZero",{width:36,height:36,"background-width":36,"background-height":36,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/boosterAdd.54e0ec0319.png","margin-left":60,"margin-top":60}),FigureRules.add(".powerUp .powerUpLight",{width:91,height:91,"background-width":91,"background-height":91,opacity:0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/web/boostersLight.7119f644df.png",animation:{params:{rotate:[0,360]},duration:8e3,playRound:!0}}),FigureRules.add(".powerUp .powerUpCancel",{width:91,height:91,"background-width":91,"background-height":91,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/boosterCancel.d6663ead69.png",opacity:0}),FigureRules.add(".powerUp .powerUpInfo, .powerUp .powerUpZero",{opacity:0}),FigureRules.add(".powerUp .powerUpInfo",{width:136,height:103,"background-color":"#fcebc4","margin-left":-140,"margin-top":-4}),FigureRules.add(".powerUp .powerUpInfo .powerUpName",{width:134,color:"#fe8923",font:"normal 20px 'Marvin', Tahoma, 'Geneva CY', sans-serif",textAlign:"center","margin-left":67,"margin-top":23}),FigureRules.add(".powerUp .powerUpInfo .powerUpTitle",{width:134,color:"#77320f",font:"normal 14px 'Marvin', Tahoma, 'Geneva CY', sans-serif",textAlign:"center","margin-left":67,"margin-top":44}),FigureRules.add(".powerUp .powerUpInfo .powerUpAmountBlock, .powerUp .powerUpInfo .powerUpPriceBlock",{width:134,color:"#77320f",font:"normal 14px 'Marvin', Tahoma, 'Geneva CY', sans-serif",textAlign:"center","margin-left":67,"margin-top":86}),FigureRules.add(".powerUp .powerUpInfo .powerUpPriceBlock",{height:30,"margin-left":40,opacity:0}),FigureRules.add(".powerUp .powerUpInfo .powerUpAmountBlock .powerUpAmount, .powerUp .powerUpInfo .powerUpPriceBlock .powerUpPrice",{width:30,color:"#77320f",font:"normal 14px 'Marvin', Tahoma, 'Geneva CY', sans-serif"}),FigureRules.add(".powerUp .powerUpPrice",{"text-top":6}),FigureRules.add(".powerUp .powerUpAmountText",{width:70,font:"normal 14px 'Marvin', Tahoma, 'Geneva CY', sans-serif",color:"#77320f",textAlign:"center","margin-left":-5,"margin-top":0,"text-top":6}),FigureRules.add(".powerUp .powerUpAmountBlock .powerUpAmount",{"margin-left":40,"text-top":6}),FigureRules.add(".powerUp .inlineCoin27x27",{"background-position-x":33,"background-position-y":1,width:25,height:26,"background-width":25,"background-height":26,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/icons/topIcons.648713f1c8.png","margin-left":30,"margin-top":-12}),FigureRules.add(".powerUp .powerUpImageTextDisabled",{opacity:0}),FigureRules.add(".powerUp.disabled .powerUpImageLocked",{width:33,height:46,"background-width":33,"background-height":46,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/web/boosterLocked.9c65758018.png","margin-left":28,"margin-top":23}),FigureRules.add(".powerUp.disabled .powerUpImageTextDisabled",{opacity:1,width:85,font:"normal 12px 'Marvin', Tahoma, 'Geneva CY', sans-serif",color:"#77320f",textAlign:"center","margin-left":45.5,"margin-top":98}),FigureRules.add(".powerUp.powerUpAmountZero .powerUpPriceBlock",{opacity:1}),FigureRules.add(".powerUp.hover .powerUpInfo",{opacity:1}),FigureRules.add(".powerUp.hover .powerUpLight",{opacity:1}),FigureRules.add(".powerUp.hover",{"background-position-x":91}),FigureRules.add(".powerUp.accentuation, .powerUp.disabled",{"background-position-x":182}),FigureRules.add(".powerUp.disabled.hover",{"background-position-x":182}),FigureRules.add(".powerUp.disabled.hover .powerUpLight",{opacity:0}),FigureRules.add(".powerUp.disabled .powerUpImageIcon, .powerUp.disabled .powerUpInfo, .powerUp.disabled .powerUpCircle",{opacity:0}),FigureRules.add(".powerUp.accentuation .powerUpCancel",{opacity:1}),FigureRules.add(".powerUp.accentuation .powerUpImageIcon",{opacity:0}),FigureRules.add(".powerUp.powerUpAmountZero .powerUpZero",{opacity:1,font:"normal 36px 'Marvin', Tahoma, 'Geneva CY', sans-serif","text-top":30}),FigureRules.add(".powerUp.powerUpAmountZero.disabled .powerUpZero",{opacity:0}),FigureRules.add(".powerUp.powerUpAmountZero .powerUpCircle, .powerUp.powerUpAmountZero .powerUpAmountBlock",{opacity:0}),FigureRules.add(".deleteCellPowerUp",{}),FigureRules.add(".shufflePowerUp",{y:102}),FigureRules.add(".lightingPowerUp",{y:204}),FigureRules.add(".bonusLevelTaskView",{width:e.width,height:e.height}),FigureRules.add(".bonusLevelMonster",{x:760,y:330}),FigureRules.add(".bonusLevelMod3_0 .bonusLevelMonster",{"background-position-x":0,"background-position-y":0,"background-width":140,"background-height":263,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/monster1Idle.dfdf201e00.png",width:140,height:263,"margin-top":-120,"margin-left":-138,spriteFrames:11,duration:800,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".bonusLevelMod3_1 .bonusLevelMonster",{"background-position-x":0,"background-position-y":0,"background-width":140,"background-height":263,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel1/monster2Idle.09393180af.png",width:140,height:263,"margin-top":-120,"margin-left":-138,spriteFrames:11,duration:800,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".bonusLevelMod3_2 .bonusLevelMonster",{"background-position-x":0,"background-position-y":0,"background-width":140,"background-height":263,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel2/monster3Idle.be6bfca8f0.png",width:140,height:263,"margin-top":-120,"margin-left":-138,spriteFrames:11,duration:800,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".bonusLevelMod3_0 .bonusLevelMonster .monsterCollectPoint",{x:0,y:120}),FigureRules.add(".bonusLevelMod3_0 .bonusLevelMonster .monsterCollectPoint2",{x:120,y:120}),FigureRules.add(".bonusLevelMod3_1 .bonusLevelMonster .monsterCollectPoint",{x:0,y:91}),FigureRules.add(".bonusLevelMod3_1 .bonusLevelMonster .monsterCollectPoint2",{x:120,y:96}),FigureRules.add(".bonusLevelMod3_2 .bonusLevelMonster .monsterCollectPoint",{x:0,y:120}),FigureRules.add(".bonusLevelMod3_2 .bonusLevelMonster .monsterCollectPoint2",{x:120,y:120}),FigureRules.add(".bonusLevelMod3_0 .bonusLevelMonster.openMouth",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/monster1Eat.06ecdda927.png",spriteFrames:19,duration:1200}),FigureRules.add(".bonusLevelMod3_1 .bonusLevelMonster.openMouth",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel1/monster2Eat.0128ac5d76.png",spriteFrames:19,duration:1200}),FigureRules.add(".bonusLevelMod3_2 .bonusLevelMonster.openMouth",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel2/monster3Eat.e07783c42d.png",spriteFrames:19,duration:1200}),FigureRules.add(".bonusLevelTaskView .taskProgressBorder",{width:496,height:20,x:132,y:602}),FigureRules.add(".bonusLevelTaskView .taskProgress",{height:20}),FigureRules.add(".bonusLevelTaskView .bonusLevelTask",{x:20,y:540}),FigureRules.add(".bonusLevelMod3_0 .bonusLevelTaskView .bonusLevelTask .taskNameIco",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1.7c56771edf.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".bonusLevelMod3_1 .bonusLevelTaskView .bonusLevelTask .taskNameIco",{width:48,height:48,"background-width":48,"background-height":48,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel1/bonusLevelFish2.a6774f832d.png","margin-left":12,"margin-top":9}),FigureRules.add(".bonusLevelMod3_2 .bonusLevelTaskView .bonusLevelTask .taskNameIco",{width:55,height:53,"background-width":55,"background-height":53,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel2/bonusLevelFish3.a181c82b98.png","margin-left":8,"margin-top":8}),FigureRules.add(".bonusLevelTaskView .bonusLevelTask .taskAmountBlock",{x:15,y:80}),FigureRules.add(".bonusLevelTaskView .bonusLevelTask .taskAmount, .bonusLevelTaskView .bonusLevelTask .taskNeed, .bonusLevelTaskView .bonusLevelTask .taskSlash",{font:"normal 18px 'Marvin', Tahoma, 'Geneva CY', sans-serif",color:"#fcebc4",textAlign:"center"}),FigureRules.add(".bonusLevelTaskView .bonusLevelTask .taskSlash",{"margin-left":20}),FigureRules.add(".bonusLevelTaskView .bonusLevelTask .taskNeed",{"margin-left":40}),FigureRules.add(".bonusLevelMod3_0 .bigCrystal",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1.7c56771edf.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".bonusLevelMod3_0 .attribute_crystal.attribute",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1Small.9dc3c7a107.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".bonusLevelMod3_1 .attribute_crystal.attribute",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel1/bonusLevelFish2Small.40230d3c79.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".bonusLevelMod3_1 .bigCrystal",{"background-position-x":0,"background-position-y":0,"background-width":48,"background-height":48,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel1/bonusLevelFish2.a6774f832d.png",width:.8*Config.cellWidth,height:.8*Config.cellHeight,"margin-left":.1*Config.cellWidth,"margin-top":.1*Config.cellHeight}),FigureRules.add(".bonusLevelMod3_2 .attribute_crystal.attribute",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel2/bonusLevelFish3Small.a0cb4e2ceb.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".bonusLevelMod3_2 .bigCrystal",{"background-position-x":0,"background-position-y":0,"background-width":55,"background-height":53,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel2/bonusLevelFish3.a181c82b98.png",width:55/60*Config.cellWidth,height:53/60*Config.cellHeight,"margin-left":1/60*Config.cellWidth,"margin-top":.1*Config.cellHeight})};var CollectComplexTask=Task.extend({initialize:function(){this.set("event","removedItem"),this.set("type","CollectComplexTask"),this.set("taskName",this.get("description").taskName),this.set("parts",this.get("description").parts);var t={};this.get("parts").split("").forEach(function(e){t[e]=!1}),this.set("leftParts",t),this.set("amount",_.keys(t).length),this.set("collectedAmount",0),Task.prototype.initialize.call(this)},isWin:function(){var e=this.get("leftParts");for(var t in e)if(!e[t])return!1;return!0},collectPartAnimation:function(e,t,i,o,a){this.animateCollect(t,i,Game.endTurnAnimate(function(){this.trigger("collectPart",this,a),this.isWin()&&this.set("completed",!0)},this),void 0,o)},canCollect:function(e){return e.char&&!1===this.get("leftParts")[e.char]},tick:function(e){var t=e.char,i=".charcode_"+t.charCodeAt(0),o=this.$div.find(i);this.get("leftParts")[t]=!0,this.set("collectedAmount",this.get("collectedAmount")+1),this.collectPartAnimation(e,e.$div,GameScores.complexTask,o,i)}});CollectComplexTask.getCssClass=function(e){return"CollectComplexTask"},CollectComplexTask.getTaskAmount=function(e,t){return this.countCellsInMap(e.map,"["+t.parts+"]")};var PunishWindow=TWindow.extend({templateClass:".punishWindow_template",events:{"click .close":"close","click .punishNo":"close","click .punishYes":"buyPunish"},getProduct:function(){for(var e in prices)if("punish"===prices[e].type)return prices[e]},buyPunish:function(){user.get("freePunish")?(user.unset("freePunish"),$(".punish").removeClass("free"),callServiceAddInQueue("../../../levelbase/src/services/usefreepunish.php"),new PunishNowWindow):showBuy(this.getProduct()),this.close()},onOpen:function(){user.get("freePunish")&&this.$el.addClass("free"),this.$(".punishPrice").html(this.getProduct().desc.price),TWindow.prototype.onOpen.call(this)}}),PunishNowWindow=TWindow.extend({templateClass:".punishNowWindow_template",onOpenSound:"finishwindow",events:{"click .close":"close","click .punishNow":"close","click .punishNowVariant1":"punish1","click .punishNowVariant2":"punish2","click .punishNowVariant3":"punish3"},onClose:function(){gameView.punish(this.punishType)},onOpen:function(){$(".punish").addClass("usingNow"),Game.once("endTurn",function(){$(".punish").removeClass("usingNow")})},punish1:function(){this.punishType=1,this.close()},punish2:function(){this.punishType=2,this.close()},punish3:function(){this.punishType=3,this.close()}}),animationConfig={getMethod:function(e,t){return this[this[e]?e:"default"][t]||this.default[t]},default:{removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&gameView.fallDownExplode(o,6,"iceBlast"),e()},changeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);if(o){var a=i.level,n=i.oldLevel,r=FigureView.createByTemplate(".invisible .emptyTemplate",["floorLevelAnimation"+n]);_Figure.blockedAnimations.append(r),r.alignTo(o),r.delay(350).queue(function(e){e(),this.remove()}),o.addClass("floorLevelBetween"+a+"and"+n).delay(200).queue(function(e){this.removeClass("floorLevel"+n).removeClass("floorLevelBetween"+a+"and"+n).addClass("floorLevel"+a),e()})}e()}}},featuresAdder={commonFeatures:[],_features:{},addFeature:function(e,t){var i=[];if("common"===e)i=this.commonFeatures;else{var o=Config.bonusWorlds.getByName(e);if(!o)return;i=o.get("features")}if(!this._features[t])throw'Feature view "'.concat(t,'" is not exists');this._features[t](e),_.find(i,function(e){return e==t})||i.push(t)},registry:function(e,t){this._features[e]=t},getActiveFeatureStyle:function(t){var e,i=null;episode.isBonusWorld()&&(i=null===(e=Config.bonusWorld)||void 0===e||null===(e=e.get("features"))||void 0===e?void 0:e.find(function(e){return 0===e.indexOf(t)}));return i||(i=this.commonFeatures.find(function(e){return 0===e.indexOf(t)})),i||"default"}},Sfc,Wfc,Yfc,$fc,agc,dgc,fgc,kgc,mgc,ogc,qgc,sgc,ugc,wgc,ygc,Cgc,Fgc,Mgc,Ogc,Sgc,Vgc,ahc,chc,ehc;featuresAdder.registry("alligator_bandit",function(e){FigureRules.add(".episode_".concat(e," .alligatorBg.stable"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_bandit/banditIdle.1557443895.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:12,framesOrder:[0,0,0,0,1,0,2,3,4,3,2,0],duration:2400,playRound:!0}),FigureRules.add(".episode_".concat(e," .alligatorBg.alligatorAngry"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_bandit/banditAngry.eb447ff085.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:8,duration:1e3}),FigureRules.add(".episode_".concat(e," .alligatorFly"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_bandit/banditDead.3da6039f7e.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:1,duration:2400,playRound:!0})}),featuresAdder.registry("alligator_mummy",function(e){FigureRules.add(".episode_".concat(e," .alligatorBg.stable"),{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_mummy/mummyStable.60d1f3ebce.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-top":4/60*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],delay:[3e3,6e3],duration:500,playRound:!0}),FigureRules.add(".episode_".concat(e," .alligatorBg.alligatorAngry"),{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_mummy/mummyDamaged.ac7240b7e3.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-top":4/60*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:500}),FigureRules.add(".episode_".concat(e," .alligatorFly"),{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_mummy/mummyDamaged.ac7240b7e3.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-top":4/60*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:500,playRound:!0,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[2*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[0*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_".concat(e," .alligatorLifeBlock"),{"margin-top":106/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(Sfc=figureRulesProcess.additionalBonusScaleImages,function(){Sfc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/alligator_mummy/cloudMummy_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/alligator_mummy/cloudDarkMummy_xlarge.png":_Figure.scaleKoef})}),featuresAdder.registry("alligator_oven",function(e){FigureRules.add(".episode_".concat(e," .alligatorBg.stable"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_oven/ovenIdle.135fa419c5.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:11,duration:1e3,playRound:!0,delay:[1e3,5e3]}),FigureRules.add(".episode_".concat(e," .alligatorBg.alligatorAngry"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_oven/ovenEat.5d87644a0f.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:17,duration:1e3,delay:0}),FigureRules.add(".episode_".concat(e," .alligatorFly"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_oven/ovenIdle.135fa419c5.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:11,duration:1e3,playRound:!0,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_".concat(e," .alligatorHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation"),{"margin-top":Config.cellWidth-.3*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight})}),featuresAdder.registry("alligator_yeti",function(e){FigureRules.add(".episode_".concat(e," .alligatorBg.stable"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_yeti/yetiStable.c773405efc.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:12,framesOrder:[0,0,0,0,1,0,2,3,4,3,2,0],duration:3e3,playRound:!0}),FigureRules.add(".episode_".concat(e," .alligatorBg.alligatorAngry"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_yeti/yetiDamaged.d2e1c38d75.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:6,framesOrder:[0,1,2,3,4,5],duration:600}),FigureRules.add(".episode_".concat(e," .alligatorFly"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":170,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/alligator_yeti/yetiDamaged.d2e1c38d75.png",width:128/60*Config.cellWidth,height:128/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:4,framesOrder:[0,3,4,5],duration:400,playRound:!0,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_".concat(e," .alligatorHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation"),{"margin-top":Config.cellWidth-.3*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight})}),featuresAdder.registry("attribute_scarab",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_scarab/bugDecor.b3aebdbbb6.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:1,duration:1,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=(Wfc=figureRulesProcess.additionalBonusScaleImages,function(){Wfc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_scarab/bugDecor.b3aebdbbb6.png":_Figure.scaleKoef})}),featuresAdder.registry("attribute_teacup",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_teacup/cup.1784c2485e.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=(Yfc=figureRulesProcess.additionalBonusScaleImages,function(){Yfc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_teacup/cup.1784c2485e.png":_Figure.scaleKoef})}),featuresAdder.registry("attribute_teamug",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_teamug/mug.34f8d54a98.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=($fc=figureRulesProcess.additionalBonusScaleImages,function(){$fc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_teamug/mug.34f8d54a98.png":_Figure.scaleKoef})}),featuresAdder.registry("attribute_butterfly",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":102,"background-height":92,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_butterfly/butterfly.639fe6295d.png",width:.85*Config.cellWidth,height:46/60*Config.cellHeight,"margin-left":5/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,scale:.8,spriteFrames:1,duration:400,playRound:!0}),FigureRules.add(".episode_".concat(e," .sail .taskIconContainer .taskIco.color_ClearFallingCellAttributes"),{"background-height":180,"background-width":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_butterfly/butterflyTask.a2e153a82d.png"})}),figureRulesProcess.additionalBonusScaleImages=(agc=figureRulesProcess.additionalBonusScaleImages,function(){agc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_butterfly/butterfly.639fe6295d.png":_Figure.scaleKoef})}),featuresAdder.registry("attribute_blotch",function(e){FigureRules.add(".episode_".concat(e," .attribute_key"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_blotch/attribute_blotchkey.92136decbc.png"})}),featuresAdder.registry("attribute_lollipop",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_lollipop/lollipopDecor.8b0a401a5d.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:1,duration:1,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=(dgc=figureRulesProcess.additionalBonusScaleImages,function(){dgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_lollipop/lollipopDecor.8b0a401a5d.png":_Figure.scaleKoef})}),featuresAdder.registry("attribute_fireworks",function(e){FigureRules.add(".episode_".concat(e," .attribute_falling"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_fireworks/fireworks.cdbcd13907.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:1,duration:1,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=(fgc=figureRulesProcess.additionalBonusScaleImages,function(){fgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_fireworks/fireworks.cdbcd13907.png":_Figure.scaleKoef})}),featuresAdder.registry("bar_cactus",function(e){FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem"),{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem1"),{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem2"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem3"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem4"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem5"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_R .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_R.20a8979f3a.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_G .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_G.608b85bf2e.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_B .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_B.b80fa28a5e.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_Y .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_Y.6ebfb2ab88.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_P .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_P.cd4a56d595.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_W .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_W.54d7038e34.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_s .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_multi.f04dbe5ea1.png"}),FigureRules.add(".episode_".concat(e," .barCell"),{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCell.Middle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCenter.2dee3da3df.png"}),FigureRules.add(".episode_".concat(e," .barCell.TopLeftCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCorner.4c4a5415b0.png","scale-x":-1}),FigureRules.add(".episode_".concat(e," .barCell.TopRightCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCorner.4c4a5415b0.png"}),FigureRules.add(".episode_".concat(e," .barCell.BottomLeftCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCorner.4c4a5415b0.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.BottomRightCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCorner.4c4a5415b0.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.LeftSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusSide.670d00e885.png",rotate:-90}),FigureRules.add(".episode_".concat(e," .barCell.TopSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusSide.670d00e885.png"}),FigureRules.add(".episode_".concat(e," .barCell.RightSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusSide.670d00e885.png",rotate:90}),FigureRules.add(".episode_".concat(e," .barCell.BottomSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusSide.670d00e885.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.VerticalTop"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusEdge.5a1ba1b94c.png"}),FigureRules.add(".episode_".concat(e," .barCell.VerticalMiddle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusMiddle.7889ed9079.png"}),FigureRules.add(".episode_".concat(e," .barCell.VerticalBottom"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusEdge.5a1ba1b94c.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalLeft"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusEdge.5a1ba1b94c.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalMiddle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusMiddle.7889ed9079.png",rotate:90}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalRight"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusEdge.5a1ba1b94c.png",rotate:90})}),featuresAdder.registry("bar_ice",function(e){FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem"),{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem1"),{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem2"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem3"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem4"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock .lifeGem5"),{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_R .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_R.e5a4097096.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_G .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_G.8c714bcf50.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_B .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_B.ccb4e67a75.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_Y .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_Y.5fbd38281a.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_P .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_P.146e6ce73c.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_W .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_W.644ea4986b.png"}),FigureRules.add(".episode_".concat(e," .barCellLifeBlock.color_s .lifeGem"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceLife_multi.a414d08647.png"}),FigureRules.add(".episode_".concat(e," .barCell"),{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .barCell.Middle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceCenter.afa59aa944.png"}),FigureRules.add(".episode_".concat(e," .barCell.TopLeftCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceCorner.e7c72771cc.png","scale-x":-1}),FigureRules.add(".episode_".concat(e," .barCell.TopRightCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceCorner.e7c72771cc.png"}),FigureRules.add(".episode_".concat(e," .barCell.BottomLeftCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceCorner.e7c72771cc.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.BottomRightCorner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceCorner.e7c72771cc.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.LeftSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceSide.dee5d889b4.png",rotate:-90}),FigureRules.add(".episode_".concat(e," .barCell.TopSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceSide.dee5d889b4.png"}),FigureRules.add(".episode_".concat(e," .barCell.RightSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceSide.dee5d889b4.png",rotate:90}),FigureRules.add(".episode_".concat(e," .barCell.BottomSide"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceSide.dee5d889b4.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.VerticalTop"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceEdge.0db9622261.png"}),FigureRules.add(".episode_".concat(e," .barCell.VerticalMiddle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceMiddle.0ef6559de0.png"}),FigureRules.add(".episode_".concat(e," .barCell.VerticalBottom"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceEdge.0db9622261.png","scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalLeft"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceEdge.0db9622261.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalMiddle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceMiddle.0ef6559de0.png",rotate:90}),FigureRules.add(".episode_".concat(e," .barCell.HorizontalRight"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_ice/iceEdge.0db9622261.png",rotate:90})}),featuresAdder.registry("bomb_snowflake",function(e){FigureRules.add(".episode_".concat(e," .bomb.color_Y .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeY.c54910e30f.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_R .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeR.5933d17b52.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_W .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeW.bec1ab1750.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_P .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeP.585001dcc8.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_B .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeB.f51295b239.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_G .cellSubBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bomb_snowflake/bombsnowflakeG.b7054723de.png"})}),featuresAdder.registry("boy_chef",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment1.81eea9bb63.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment2.41764fc910.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment3.3f914b957a.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment4.b63ad92469.png"})}),figureRulesProcess.additionalBonusScaleImages=(kgc=figureRulesProcess.additionalBonusScaleImages,function(){kgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment1.81eea9bb63.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment2.41764fc910.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment3.3f914b957a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment4.b63ad92469.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_gentleman",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment1.b966885b5a.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment2.07b4704775.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment3.b9030810e6.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment4.b65069c6b3.png"})}),figureRulesProcess.additionalBonusScaleImages=(mgc=figureRulesProcess.additionalBonusScaleImages,function(){mgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment1.b966885b5a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment2.07b4704775.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment3.b9030810e6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_gentleman/garment4.b65069c6b3.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_cowboy",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_cowboy/garment1.7d973389b9.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_cowboy/garment2.9848a47baf.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_cowboy/garment3.1e692fc5ed.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_cowboy/garment4.17fea700ae.png"})}),figureRulesProcess.additionalBonusScaleImages=(ogc=figureRulesProcess.additionalBonusScaleImages,function(){ogc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment1.81eea9bb63.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment2.41764fc910.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment3.3f914b957a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chef/garment4.b63ad92469.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_fisherman",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment1.9dd82b0123.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment2.f3003a23cb.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment3.a146e806b0.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment4.4be1ba0bfb.png"})}),figureRulesProcess.additionalBonusScaleImages=(qgc=figureRulesProcess.additionalBonusScaleImages,function(){qgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment1.9dd82b0123.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment2.f3003a23cb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment3.a146e806b0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_fisherman/garment4.4be1ba0bfb.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_holidaypirate",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment1.f5f4367196.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment2.fd69f69c40.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment3.bab58c3e7e.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment4.18d8bbd1c2.png"})}),figureRulesProcess.additionalBonusScaleImages=(sgc=figureRulesProcess.additionalBonusScaleImages,function(){sgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment1.f5f4367196.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment2.fd69f69c40.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment3.bab58c3e7e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_holidaypirate/garment4.18d8bbd1c2.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_snowman",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment1.77e9466b0e.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment2.e52fa7b518.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment3.f5fc2977a6.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment4.5c135809ee.png"})}),figureRulesProcess.additionalBonusScaleImages=(ugc=figureRulesProcess.additionalBonusScaleImages,function(){ugc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment1.77e9466b0e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment2.e52fa7b518.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment3.f5fc2977a6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_snowman/garment4.5c135809ee.png":_Figure.scaleKoef})}),featuresAdder.registry("boy_chinese",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg.fish12"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment1.9f2a7e2157.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish13"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment2.c348eefb86.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish14"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment3.de9aa6b4ef.png"}),FigureRules.add(".episode_".concat(e," .fishcellBg.fish15"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment4.2841c8a831.png"})}),figureRulesProcess.additionalBonusScaleImages=(wgc=figureRulesProcess.additionalBonusScaleImages,function(){wgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment1.9f2a7e2157.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment2.c348eefb86.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment3.de9aa6b4ef.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/boy_chinese/garment4.2841c8a831.png":_Figure.scaleKoef})}),featuresAdder.registry("frog_steamtrain",function(e){FigureRules.add(".episode_".concat(e," .trainCell"),{width:232/180*Config.cellWidth,height:183/180*Config.cellHeight,"background-width":232,"background-height":183,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainHor.793a309e9d.png","margin-left":-10/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .trainCell.movingLeft"),{width:232/180*Config.cellWidth,height:183/180*Config.cellHeight,"background-width":232,"background-height":183,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainHor.793a309e9d.png","margin-left":-10/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight,"scale-x":-1}),FigureRules.add(".episode_".concat(e," .trainCell.movingUp"),{width:141/180*Config.cellWidth,height:211/180*Config.cellHeight,"background-width":141,"background-height":211,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainBack.c2158d57dc.png","margin-left":.1*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .trainCell.movingDown"),{width:141/180*Config.cellWidth,height:228/180*Config.cellHeight,"background-width":141,"background-height":228,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainFront.252e36a728.png","margin-left":.1*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .frogpath"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadBar.60ffaac9e8.png"}),FigureRules.add(".episode_".concat(e," .frogpath.horizontal"),{rotate:0}),FigureRules.add(".episode_".concat(e," .frogpath.vertical"),{rotate:90}),FigureRules.add(".episode_".concat(e," .frogpath.corner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadCorner.ca9cb5ce2f.png"}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_left.neighbour_top"),{rotate:0}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_right.neighbour_top"),{rotate:90}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_right.neighbour_bottom"),{rotate:180}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_left.neighbour_bottom"),{rotate:270}),FigureRules.add(".episode_".concat(e," .frogfuelCell"),{width:146/180*Config.cellWidth,height:148/180*Config.cellHeight,"background-width":146,"background-height":148,"background-image":""}),FigureRules.add(".episode_".concat(e," .frogfuelCell .cellStone"),{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/toyKeys.1bf977770b.png"}),FigureRules.add(".episode_".concat(e," .frogfuelCell_B .cellStone"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .frogfuelCell_G .cellStone"),{"background-position-x":180}),FigureRules.add(".episode_".concat(e," .frogfuelCell_P .cellStone"),{"background-position-x":360}),FigureRules.add(".episode_".concat(e," .frogfuelCell_R .cellStone"),{"background-position-x":540}),FigureRules.add(".episode_".concat(e," .frogfuelCell_W .cellStone"),{"background-position-x":720}),FigureRules.add(".episode_".concat(e," .frogfuelCell_Y .cellStone"),{"background-position-x":900}),FigureRules.add(".episode_".concat(e," .frogtarget"),{width:271/180*Config.cellWidth,height:275/180*Config.cellHeight,"margin-left":-31/120*Config.cellWidth,"margin-top":-50/120*Config.cellHeight,"background-width":271,"background-height":275,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/vault.3f4507ae00.png",spriteFrames:1,lastFrame:0,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .frogtarget.done"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/vault.3f4507ae00.png",spriteFrames:5,lastFrame:0,duration:500})}),FrogCell.prototype.createDiv=(ygc=FrogCell.prototype.createDiv,function(e){return(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_steamtrain"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_steamtrain"==e}))&&(this.soundEnabled=!1),ygc.call(this,e)}),FrogCell.prototype.getTemplateClass=(Cgc=FrogCell.prototype.getTemplateClass,function(){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_steamtrain"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_steamtrain"==e})?"trainCell":Cgc.call(this)}),FrogCell.prototype.animateSwap=(Fgc=FrogCell.prototype.animateSwap,function(e,t){if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_steamtrain"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_steamtrain"==e})){var i=this.getCoords(),o=e.getCoords();e.$div.ourAnimate(o,300,"linear",_.noop),this.$div.ourAnimate(i,300,"linear",t)}else Fgc.call(this,e,t)}),figureRulesProcess.additionalBonusScaleImages=(Mgc=figureRulesProcess.additionalBonusScaleImages,function(){Mgc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/frog_steamtrain/bearSafe.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadCorner.ca9cb5ce2f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadBar.60ffaac9e8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/toyKeys.1bf977770b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainHor.793a309e9d.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainBack.c2158d57dc.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/steamTrainFront.252e36a728.png":_Figure.scaleKoef})}),featuresAdder.registry("frog_cart",function(e){FigureRules.add(".episode_".concat(e," .cartCell"),{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_H.d2228d9367.png","margin-left":2/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .cartCell.movingVertical"),{width:1*Config.cellWidth,height:206/180*Config.cellHeight,"background-width":180,"background-height":206,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_V.0f3b149de7.png","margin-left":2/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .cartCell.stable"),{spriteFrames:7,duration:300,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .cartCell.stable.movingVertical"),{spriteFrames:7,duration:300,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .cartCell.movingRight"),{"scale-x":1,"margin-left":2/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .cartCell.movingStart"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_H.d2228d9367.png",spriteFrames:1,duration:150}),FigureRules.add(".episode_".concat(e," .cartCell.movingVertical.movingStart"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_V.0f3b149de7.png",spriteFrames:1,duration:150}),FigureRules.add(".episode_".concat(e," .cartCell.blink"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_H.d2228d9367.png",spriteFrames:1,duration:1e3}),FigureRules.add(".episode_".concat(e," .cartCell.movingVertical.blink"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_V.0f3b149de7.png",spriteFrames:1,duration:1e3}),FigureRules.add(".episode_".concat(e," .cartCell.moving"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_H.d2228d9367.png",spriteFrames:1,duration:300}),FigureRules.add(".episode_".concat(e," .cartCell.movingVertical.moving"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_V.0f3b149de7.png",spriteFrames:1,duration:300}),FigureRules.add(".episode_".concat(e," .cartCell.eat"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_H.d2228d9367.png",spriteFrames:1,duration:300}),FigureRules.add(".episode_".concat(e," .cartCell.movingVertical.eat"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/cart_V.0f3b149de7.png",spriteFrames:1,duration:300}),FigureRules.add(".episode_".concat(e," .frogpath"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/railroadBar.0c4dcdc304.png"}),FigureRules.add(".episode_".concat(e," .frogpath.horizontal"),{rotate:0}),FigureRules.add(".episode_".concat(e," .frogpath.vertical"),{rotate:90}),FigureRules.add(".episode_".concat(e," .frogpath.corner"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/railroadCorner.51324685fd.png"}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_left.neighbour_top"),{rotate:0}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_right.neighbour_top"),{rotate:90}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_right.neighbour_bottom"),{rotate:180}),FigureRules.add(".episode_".concat(e," .frogpath.corner.neighbour_left.neighbour_bottom"),{rotate:270}),FigureRules.add(".episode_".concat(e," .frogfuelCell"),{width:146/180*Config.cellWidth,height:148/180*Config.cellHeight,"background-width":146,"background-height":148,"background-image":""}),FigureRules.add(".episode_".concat(e," .frogfuelCell .cellStone"),{width:146/180*Config.cellWidth,height:148/180*Config.cellHeight,"background-width":146,"background-height":148,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/oil.79091fd8c4.png","margin-left":10/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .frogfuelCell_B .cellStone"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .frogfuelCell_G .cellStone"),{"background-position-x":146}),FigureRules.add(".episode_".concat(e," .frogfuelCell_P .cellStone"),{"background-position-x":292}),FigureRules.add(".episode_".concat(e," .frogfuelCell_R .cellStone"),{"background-position-x":438}),FigureRules.add(".episode_".concat(e," .frogfuelCell_W .cellStone"),{"background-position-x":584}),FigureRules.add(".episode_".concat(e," .frogfuelCell_Y .cellStone"),{"background-position-x":730}),FigureRules.add(".episode_".concat(e," .frogtarget"),{width:271/180*Config.cellWidth,height:275/180*Config.cellHeight,"margin-left":-31/120*Config.cellWidth,"margin-top":-50/120*Config.cellHeight,"background-width":271,"background-height":275,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/vault.3f4507ae00.png",spriteFrames:5,lastFrame:0,duration:400,delay:[3e3,5e3]}),FigureRules.add(".episode_".concat(e," .frogtarget.done"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_cart/vault.3f4507ae00.png",spriteFrames:1,duration:1e3})}),FrogCell.prototype.createDiv=(Ogc=FrogCell.prototype.createDiv,function(e){return(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_cart"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_cart"==e}))&&(this.soundEnabled=!1),Ogc.call(this,e)}),FrogCell.prototype.getTemplateClass=(Sgc=FrogCell.prototype.getTemplateClass,function(){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_cart"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_cart"==e})?"cartCell":Sgc.call(this)}),FrogCell.prototype.animateSwap=(Vgc=FrogCell.prototype.animateSwap,function(e,t){if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"frog_cart"==e})||featuresAdder.commonFeatures.find(function(e){return"frog_cart"==e})){var i=this.getCoords(),o=e.getCoords();e.$div.ourAnimate(o,300,"linear",_.noop),this.$div.ourAnimate(i,300,"linear",t)}else Vgc.call(this,e,t)}),figureRulesProcess.additionalBonusScaleImages=(ahc=figureRulesProcess.additionalBonusScaleImages,function(){ahc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/frog_steamtrain/cart_H.png":_Figure.scaleKoef,"../../../gems/site/img/features/frog_steamtrain/cart_V.png":_Figure.scaleKoef,"../../../gems/site/img/features/frog_steamtrain/oil.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadBar.60ffaac9e8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/railroadCorner.ca9cb5ce2f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_steamtrain/vault.3f4507ae00.png":_Figure.scaleKoef})}),featuresAdder.registry("frog_queen",function(e){FigureRules.add(".episode_".concat(e," .frogCell"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogStable.dc14f3e610.png"}),FigureRules.add(".episode_".concat(e," .frogCell.movingStart"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogJump.55d2808eb4.png",width:1.55*Config.cellWidth,height:205/120*Config.cellHeight,"margin-top":-.7*Config.cellHeight,"background-width":186,"background-height":205}),FigureRules.add(".episode_".concat(e," .frogCell.blink"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogStableBlink.c416d795f9.png"}),FigureRules.add(".episode_".concat(e," .frogCell.moving"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogJump.55d2808eb4.png",width:1.55*Config.cellWidth,height:205/120*Config.cellHeight,"margin-top":-.7*Config.cellHeight,"background-width":186,"background-height":205}),FigureRules.add(".episode_".concat(e," .frogCell.eat"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogEat.b27d4a3e6e.png"}),FigureRules.add(".episode_".concat(e," .frogtarget.done"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogHouse.f1cc712f4c.png",width:1.55*Config.cellWidth,height:1.55*Config.cellHeight,"background-width":186,"background-height":186,"margin-top":-35/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(chc=figureRulesProcess.additionalBonusScaleImages,function(){chc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogEat.b27d4a3e6e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogHouse.f1cc712f4c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogJump.55d2808eb4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogStable.dc14f3e610.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_queen/frogStableBlink.c416d795f9.png":_Figure.scaleKoef})}),featuresAdder.registry("frog_duck",function(e){FigureRules.add(".episode_".concat(e," .frogCell"),{width:Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":0,"margin-top":-35/180*Config.cellHeight,"background-width":180,"background-height":250,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",frame:1}),FigureRules.add(".episode_".concat(e," .frogCell.stable"),{spriteFrames:8,startFrame:30,duration:400,playRound:!0}),FigureRules.add(".episode_".concat(e," .frogCell.movingRight"),{"scale-x":-1,"margin-left":0}),FigureRules.add(".episode_".concat(e," .frogCell.movingStart"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",spriteFrames:3,startFrame:38,duration:150}),FigureRules.add(".episode_".concat(e," .frogCell.blink"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",spriteFrames:16,startFrame:14,duration:800}),FigureRules.add(".episode_".concat(e," .frogCell.moving"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",startFrame:41,spriteFrames:9,duration:450}),FigureRules.add(".episode_".concat(e," .frogCell.eat"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",spriteFrames:12,startFrame:1,duration:600}),FigureRules.add(".episode_".concat(e," .frogpath"),{width:240/180*Config.cellWidth,height:240/180*Config.cellHeight,"background-width":240,"background-height":240,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duckPath.57bc51fb73.png","margin-left":-30/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .frogtarget"),{width:Config.cellWidth,height:250/180*Config.cellHeight,"margin-left":0,"margin-top":-70/180*Config.cellHeight,"background-width":180,"background-height":250,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",spriteFrames:1,duration:1,delay:[1,1]}),FigureRules.add(".episode_".concat(e," .frogtarget.done"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png",spriteFrames:8,startFrame:60,duration:1e3})}),figureRulesProcess.additionalBonusScaleImages=(ehc=figureRulesProcess.additionalBonusScaleImages,function(){ehc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duck.b804b5733b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frog_duck/duckPath.57bc51fb73.png":_Figure.scaleKoef})}),featuresAdder.registry("bug_cake",function(e){FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg"),{width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_cake/cakeIdle.75f541cf29.png","margin-left":-5/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.stable"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_cake/cakeIdle.75f541cf29.png",width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,spriteFrames:10,lastFrame:0,duration:700,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.blink"),{animation:null}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.damaged"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_cake/cakeAngry.034733ae26.png",spriteFrames:8,lastFrame:0,duration:500}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.die"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugDie_xlarge.a019589917.png",spriteFrames:8,duration:800}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_cake/lollipopTask.57cd41bef5.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_cake/berryTask.ef3f6ea8c5.png","margin-left":-5/60*Config.cellWidth,"margin-top":0})});var imageWidth=376,imageHeight=374,khc,phc,shc,vhc,xhc,zhc,Dhc,Fhc,Hhc,Jhc,Lhc,Nhc,Phc,Thc,Vhc,Xhc,Zhc,_hc,dic,gic,kic,nic,pic,ric,tic,Jic,Ric,Zic,fjc,vjc,xjc,zjc,Djc,Fjc,Ijc,Jjc,Qjc,Yjc,$jc,akc,hkc,kkc,skc,ukc,Ekc,Gkc,Kkc,Skc,_kc,dlc,hlc,mlc,rlc,ylc,Clc,Glc,Llc,Qlc,Xlc,Zlc,cmc,emc,gmc,imc,kmc,mmc,omc,qmc,smc,umc;featuresAdder.registry("bug_yeti",function(e){FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg"),{width:(imageWidth+2)/180*Config.cellWidth,height:imageHeight/180*Config.cellHeight,"background-width":imageWidth,"background-height":imageHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_yeti/yeti.c2bd6ba7ba.png","margin-left":-3,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.stable"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_yeti/yeti.c2bd6ba7ba.png","margin-left":-3,"margin-top":0,spriteFrames:5,delay:[3e3,5e3],duration:700,playRound:!0}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.blink"),{animation:null}),FigureRules.add(".episode_".concat(e,".bugCell .bugCellBg.damaged"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_yeti/yetieat.a3302373d8.png",width:imageWidth/180*Config.cellWidth,height:imageHeight/180*Config.cellHeight,"background-width":imageWidth,"background-height":imageHeight,spriteFrames:8,duration:800,playRound:!1,delay:0}),FigureRules.add(".episode_".concat(e," .bugCell .mTask"),{width:185/180*Config.cellWidth,height:.4*Config.cellHeight,"background-width":185,"background-height":72,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/bugLifeBlock.9be5443c60.png"}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2"),{"margin-left":55/60*Config.cellWidth,"margin-top":65/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1"),{"margin-left":55/60*Config.cellWidth,"margin-top":95/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_yeti/eggsTask.b59d6826f8.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1 .taskIco"),{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_yeti/caviarTask.77e1e833c3.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .text"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".episode_".concat(e," .bugCell .text.mCurrentCount"),{"margin-left":23/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_".concat(e," .bugCell .text.divider"),{"margin-left":35/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_".concat(e," .bugCell .text.mMaxCount"),{"margin-left":47/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"})}),featuresAdder.registry("pumpkin_jelly",function(e){FigureRules.add(".episode_".concat(e," .pumpkinCell"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .pumpkin"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/jellyfish.827e72b9d9.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_".concat(e," .pumpkin.pumpkinShot"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/jellyfish.827e72b9d9.png",spriteFrames:12,duration:800}),FigureRules.add(".episode_".concat(e," .pumpkin.pumpkinDamage"),{spriteFrames:1,playRound:!1,duration:1}),FigureRules.add(".episode_".concat(e," .pumpkinFire"),{opacity:0}),FigureRules.add(".episode_".concat(e," .pumpkin.pumpkinDie"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/jellyfish.827e72b9d9.png",spriteFrames:1,duration:1,animation:{params:{width:[1*Config.cellWidth,.25*Config.cellWidth],height:[1*Config.cellHeight,.25*Config.cellHeight],"margin-left":[0*Config.cellWidth,20/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,20/60*Config.cellHeight],opacity:[1,0]},duration:500}}),FigureRules.add(".episode_".concat(e," .pumpkinLife"),{width:20/60*Config.cellWidth,height:14/60*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.2*Config.cellWidth+"px Tahoma",color:"#6b1200","text-left":43/60*Config.cellWidth,"text-top":67/60*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_".concat(e," .cannonball"),{"background-position-x":0,"background-position-y":0,"background-width":65,"background-height":79,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/inkParticle.974cab3d5a.png",width:65/180*Config.cellWidth,height:79/180*Config.cellHeight,"margin-left":25/65*Config.cellWidth,"margin-top":23/79*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .cannonball.cannonballExplosion"),{opacity:0}),FigureRules.add(".episode_".concat(e," .pumpkin .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/lifeBlock.e80b9c4868.png",width:56/60*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":.75*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .pumpkin .lifeBar"),{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:5/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .pumpkin .pumpkinLife"),{opacity:0}),FigureRules.add(".episode_".concat(e," .pumpkin .less50PercentLife.lifeBar"),{"background-color":"#ffff00"}),FigureRules.add(".episode_".concat(e," .pumpkin .less25PercentLife.lifeBar"),{"background-color":"#f2342c"})}),featuresAdder.registry("winter_ice",function(e){}),featuresAdder.registry("bug_ghost",function(e){FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghostIdle.e54169608b.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.stable"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghostIdle.e54169608b.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,spriteFrames:0,animation:null,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.blink"),{animation:null}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.damaged"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghost_eat.17712b8a00.png",spriteFrames:14,lastFrame:0,duration:800}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.die"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghost_die.8e5552afed.png",spriteFrames:6,duration:600}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/spiderTask.59d56775ce.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/coinCandyTask.5269760b49.png","margin-left":-5/60*Config.cellWidth,"margin-top":0})}),figureRulesProcess.additionalBonusScaleImages=(khc=figureRulesProcess.additionalBonusScaleImages,function(){khc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghost_die.8e5552afed.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghost_eat.17712b8a00.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_ghost/ghostIdle.e54169608b.png":_Figure.scaleKoef})}),featuresAdder.registry("bug_stagecoach",function(e){FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg"),{width:2.05*Config.cellWidth,height:2.15*Config.cellHeight,"background-width":2.05*Config.cellWidth,"background-height":2.15*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_stagecoach/stagecoachIdle.ae28d45539.png","margin-left":-5/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.stable"),{width:2.05*Config.cellWidth,height:2.15*Config.cellHeight,"background-width":123,"background-height":129,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_stagecoach/stagecoachIdle.ae28d45539.png",spriteFrames:13,framesOrder:[0,1,2,3,2,1,0,4,5,6,5,4,0],lastFrame:0,duration:700,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.blink"),{animation:null}),FigureRules.add(".episode_".concat(e," .bugCell .bugCellBg.damaged"),{width:2.05*Config.cellWidth,height:2.15*Config.cellHeight,"background-width":123,"background-height":129,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_stagecoach/stagecoachAngry.c886598880.png",spriteFrames:9,framesOrder:[0,1,2,3,4,5,6,0,1],lastFrame:0,duration:500}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":100,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_stagecoach/coinTask.9368be20a1.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug_stagecoach/armadilloTask.6f1f3a6e0a.png","margin-left":-5/60*Config.cellWidth,"margin-top":0})}),featuresAdder.registry("caviar_jellybear",function(e){FigureRules.add(".episode_".concat(e," .caviarCell .cellStone"),{"background-width":57,"background-height":62,width:.95*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":-2/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell3 .cellStone"),{frame:0}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell2 .cellStone"),{frame:1}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell1 .cellStone"),{frame:7}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell0 .cellStone"),{frame:8}),FigureRules.add(".episode_".concat(e," .caviarCell_R .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyR.586f4f335a.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_G .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyG.4d4250f263.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_B .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyB.63b84dacd2.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_Y .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyY.cea3cfbd55.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_P .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyP.52fcd8e8a5.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_W .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyW.301de16a53.png"}),FigureRules.add(".episode_".concat(e," .fortHeadCell .taskIconContainer .taskIco.color_CollectCaviar"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyTask.bdfb0d8856.png","background-height":180,"background-width":180,height:1*Config.cellHeight,width:1*Config.cellWidth,"margin-left":-4/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .sail .taskIconContainer .taskIco.color_CollectCaviar"),{"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_jellybear/jellyTask.bdfb0d8856.png","background-width":180,height:1*Config.cellHeight,width:1*Config.cellWidth})}),featuresAdder.registry("caviar_armadillo",function(e){FigureRules.add(".episode_".concat(e," .caviarCell .cellStone"),{"background-width":98,"background-height":98,width:98/60*Config.cellWidth,height:98/60*Config.cellHeight,"margin-left":-22/60*Config.cellWidth,"margin-top":-17/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell3 .cellStone"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell3 .stable"),{animation:{params:{"scale-x":[1,1.1,1.05,1.1,1.05,1],"scale-y":[1,1.05,1.1,1.05,1.1,1]},duration:1e3,playRoundDelay:[2e3,1e4],delay:[1e3,3e3],playRound:!0}}),FigureRules.add(".episode_".concat(e," .caviarCell .cellStone.caviarTakeLife2"),{duration:700,startFrame:0,spriteFrames:7}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell2 .cellStone"),{frame:6}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell2 .stable"),{animation:{params:{"scale-x":[1,1.2,1.1,1.2,1.1,1],"scale-y":[1,1.1,1.2,1.1,1.2,1]},duration:1e3,playRoundDelay:[2e3,1e4],delay:[1e3,3e3],playRound:!0}}),FigureRules.add(".episode_".concat(e," .caviarCell .cellStone.caviarTakeLife1"),{startFrame:7,spriteFrames:9,duration:700}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell1 .cellStone"),{frame:16}),FigureRules.add(".episode_".concat(e," .caviarCell .cellStone.caviarTakeLife0"),{startFrame:17,spriteFrames:6,duration:500}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell0 .cellStone"),{frame:22}),FigureRules.add(".episode_".concat(e," .caviarCell_R .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_R.e9f604f8fd.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_G .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_G.b58ed0e7c0.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_B .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_B.30c6791b94.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_Y .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_Y.52fb97bb5b.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_P .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_P.765eb0c0ce.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_W .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadillo_W.0e3572f842.png"})}),featuresAdder.registry("caviar_chick",function(e){FigureRules.add(".episode_".concat(e," .caviarCell .cellStone"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0}),FigureRules.add(".episode_".concat(e," .caviarCell_R .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickR.11ea711c9f.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_G .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickG.b1fbdf5f3e.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_B .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickB.a129da23f5.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_Y .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickY.dad13f1ae8.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_P .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickP.6c858e6bf7.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_W .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickW.826d82d2ae.png"}),FigureRules.add(".episode_".concat(e," .bugCell .mTask2 .taskIco"),{width:70/180*Config.cellWidth,height:70/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickTask.f6bb94c5d7.png","margin-left":-5/60*Config.cellWidth,"margin-top":0})}),figureRulesProcess.additionalBonusScaleImages=(phc=figureRulesProcess.additionalBonusScaleImages,function(){phc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickR.11ea711c9f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickG.b1fbdf5f3e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickB.a129da23f5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickY.dad13f1ae8.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickP.6c858e6bf7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_chick/chickW.826d82d2ae.png":_Figure.scaleKoef})}),featuresAdder.registry("caviar_spider",function(e){FigureRules.add(".episode_".concat(e," .caviarCell .cellStone"),{"background-width":70,"background-height":66,width:70/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell3 .cellStone"),{frame:0}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell3 .stable"),{animation:null}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell2 .cellStone"),{frame:1}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell2 .stable"),{animation:null}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell1 .cellStone"),{frame:7}),FigureRules.add(".episode_".concat(e," .caviarCell.caviarCell0 .cellStone"),{frame:8}),FigureRules.add(".episode_".concat(e," .caviarCell_R .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_R.d47d7ecabe.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_G .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_G.ea875cbda2.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_B .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_B.f6926deedc.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_Y .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_Y.13c9542d58.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_P .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_P.1a01064991.png"}),FigureRules.add(".episode_".concat(e," .caviarCell_W .cellStone"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spider_W.4b79a80214.png"})}),featuresAdder.registry("chocolate_chocolate",function(e){FigureRules.add(".episode_".concat(e," .decorator_chocolate.stable"),{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateAppear.e4ace34074.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_chocolate.chocolate_appearance"),{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateAppear.e4ace34074.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_".concat(e," .chocolate_annihilation"),{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateDie.f7003a6c8e.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400})}),figureRulesProcess.additionalBonusScaleImages=(shc=figureRulesProcess.additionalBonusScaleImages,function(){shc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateAppear.e4ace34074.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateDie.f7003a6c8e.png":_Figure.scaleKoef})}),featuresAdder.registry("chocolate_honey",function(e){FigureRules.add(".episode_".concat(e," .decorator_chocolate.stable"),{"background-position-x":558,"background-position-y":0,"background-width":62,"background-height":62,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_honey/honey_appearance.a8cdb3e77f.png",width:62/60*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_chocolate.chocolate_appearance"),{"background-position-x":0,"background-position-y":0,"background-width":62,"background-height":62,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_honey/honey_appearance.a8cdb3e77f.png",width:62/60*Config.cellWidth,height:62/60*Config.cellHeight,spriteFrames:10,duration:800}),FigureRules.add(".episode_".concat(e," .chocolate_annihilation"),{"background-position-x":0,"background-position-y":0,"background-width":103,"background-height":102,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_honey/honey_annihilation.2e3f1b6cff.png",width:103/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":-.4*Config.cellWidth,"margin-top":-.4*Config.cellHeight,spriteFrames:7,duration:500})}),featuresAdder.registry("chocolate_seaweed",function(e){FigureRules.add(".episode_".concat(e," .decorator_chocolate.stable"),{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_seaweed/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_chocolate.chocolate_appearance"),{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_seaweed/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_".concat(e," .chocolate_annihilation"),{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_seaweed/chocolateDie.f7003a6c8e.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400})}),figureRulesProcess.additionalBonusScaleImages=(vhc=figureRulesProcess.additionalBonusScaleImages,function(){vhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_seaweed/chocolateAppear.07005f5864.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_seaweed/chocolateDie.f7003a6c8e.png":_Figure.scaleKoef})}),featuresAdder.registry("chocolate_dough",function(e){FigureRules.add(".episode_".concat(e," .decorator_chocolate.stable"),{"background-position-x":2528,"background-position-y":0,"background-width":316,"background-height":308,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_dough/dough_appear.a7fa3d50b8.png",width:357.08/180*Config.cellWidth,height:308*1.13/180*Config.cellHeight,"margin-left":-.5*Config.cellWidth,"margin-top":-85/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_chocolate.chocolate_appearance"),{"background-position-x":0,"background-position-y":0,"background-width":316,"background-height":308,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_dough/dough_appear.a7fa3d50b8.png",width:357.08/180*Config.cellWidth,height:308*1.13/180*Config.cellHeight,"margin-left":-.5*Config.cellWidth,"margin-top":-85/180*Config.cellHeight,spriteFrames:9,duration:300}),FigureRules.add(".episode_".concat(e," .chocolate_annihilation"),{"background-position-x":0,"background-position-y":0,"background-width":316,"background-height":308,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_dough/dough_die.b64e52f708.png",width:357.08/180*Config.cellWidth,height:308*1.13/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:6,duration:400})}),figureRulesProcess.additionalBonusScaleImages=(xhc=figureRulesProcess.additionalBonusScaleImages,function(){xhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateAppear.e4ace34074.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_chocolate/chocolateDie.f7003a6c8e.png":_Figure.scaleKoef})}),featuresAdder.registry("chocolatefarm_chocolatefarmcocos",function(e){FigureRules.add(".episode_".concat(e," .chocolateFarm.stable"),{"background-position-x":0,"background-position-y":0,"background-width":227,"background-height":241,"margin-left":-25/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolatefarm_chocolatefarmcocos/chocolateFarm.8211f0c669.png",width:227/180*Config.cellWidth,height:241/180*Config.cellHeight,spriteFrames:17,duration:1700,playRound:!0}),FigureRules.add(".episode_".concat(e," .chocolateFarm.occupation"),{"background-position-x":0,"background-position-y":0,"background-width":227,"background-height":241,"margin-left":-25/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolatefarm_chocolatefarmcocos/chocolateFarmOccupation.54e98c23f7.png",width:227/180*Config.cellWidth,height:241/180*Config.cellHeight,spriteFrames:21,duration:2100,playRound:!1})}),ChocolateFarmCell.prototype.animateOccupation=(zhc=ChocolateFarmCell.prototype.animateOccupation,function(){episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"chocolatefarm_chocolatefarmcocos"==e})||featuresAdder.commonFeatures.find(function(e){return"chocolatefarm_chocolatefarmcocos"==e})?zhc.call(this,2100):zhc.call(this)}),featuresAdder.registry("coinchest_candychest",function(e){FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{width:131/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/candyChest.c98ee47dfb.png"}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.opened"),{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.closed"),{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_".concat(e," .attribute_coin"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/coinCandy.652a62a35b.png"}),FigureRules.add(".episode_".concat(e," .attribute_coin_remove"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/coinCandyTask.5269760b49.png"}),FigureRules.add(".episode_".concat(e," .decorator_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"}),FigureRules.add(".episode_".concat(e," .move_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"}),FigureRules.add(".episode_".concat(e," .grab_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"})}),figureRulesProcess.additionalBonusScaleImages=(Dhc=figureRulesProcess.additionalBonusScaleImages,function(){Dhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/candyChest.c98ee47dfb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/coinCandy.652a62a35b.png":_Figure.scaleKoef})}),featuresAdder.registry("coinchest_carrotchest",function(e){FigureRules.add(".episode_".concat(e," .attribute_coin"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_carrotchest/carrot.4be1d845fa.png","background-width":95,"background-height":111,width:95/180*Config.cellWidth,height:111/180*Config.cellHeight,x:48/180*Config.cellWidth,y:-5/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_carrotchest/coinChest_large.bf20bfd3a5.png"})}),figureRulesProcess.additionalBonusScaleImages=(Fhc=figureRulesProcess.additionalBonusScaleImages,function(){Fhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_carrotchest/carrot.4be1d845fa.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_carrotchest/coinChest_large.bf20bfd3a5.png":_Figure.scaleKoef})}),featuresAdder.registry("coinschest_aztecchest",function(e){FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{width:2.25*Config.cellWidth,height:134/60*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":-15,"background-width":135,"background-height":134,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinschest_aztecchest/coinChest.8d97f327c4.png"}),FigureRules.add(".episode_".concat(e," .coinChestColorNext"),{"margin-top":1.8*Config.cellHeight,scale:.9}),FigureRules.add(".episode_".concat(e," .coinChestColor"),{"margin-left":.8*Config.cellWidth,"margin-top":100/60*Config.cellWidth,scale:.9}),FigureRules.add(".episode_".concat(e," .coinChestColorPrev"),{"margin-top":1.8*Config.cellHeight,scale:.9}),FigureRules.add(".episode_".concat(e," .coinChestLifeBlock .coinChestLife"),{opacity:1,textAlign:"center",font:"normal "+20/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#fff","text-left":65/60*Config.cellWidth,"text-top":.9*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.opened .coinChestLifeBlock .coinChestLife, ")+".coinChestHeadCell.opened .coinChestCell",{opacity:0}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.closed .coinChestLifeBlock .coinChestLife, ")+".coinChestHeadCell.closed .coinChestCell",{opacity:0}),FigureRules.add(".episode_".concat(e," .attribute_coin"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinschest_aztecchest/coin.daa86496cc.png"}),FigureRules.add(".episode_".concat(e," .attribute_coin_remove"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinschest_aztecchest/coin.daa86496cc.png"}),FigureRules.add(".episode_".concat(e," .decorator_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"}),FigureRules.add(".episode_".concat(e," .move_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"}),FigureRules.add(".episode_".concat(e," .grab_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/greedyPirate1.a386a2ed64.png"})}),figureRulesProcess.additionalBonusScaleImages=(Hhc=figureRulesProcess.additionalBonusScaleImages,function(){Hhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/candyChest.c98ee47dfb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_candychest/coinCandy.652a62a35b.png":_Figure.scaleKoef})}),featuresAdder.registry("coinchest_eggschest",function(e){FigureRules.add(".episode_".concat(e," .attribute_coin"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_eggschest/coin.99f006da8b.png"}),FigureRules.add(".episode_".concat(e," .attribute_coin_remove"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_eggschest/coin.99f006da8b.png"}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_eggschest/coinChest.393fae73ac.png"}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.opened"),{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.closed"),{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1})}),figureRulesProcess.additionalBonusScaleImages=(Jhc=figureRulesProcess.additionalBonusScaleImages,function(){Jhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_eggschest/coin.99f006da8b.png":Config.cellWidth/110,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_eggschest/coinChest.393fae73ac.png":Config.cellWidth/80})}),featuresAdder.registry("coinchest_simplesnatch",function(e){FigureRules.add(".episode_".concat(e," .attribute_coin"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_simplesnatch/coin.02e7fe946a.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_simplesnatch/coinChest_large.a6763ea0a4.png"})}),figureRulesProcess.additionalBonusScaleImages=(Lhc=figureRulesProcess.additionalBonusScaleImages,function(){Lhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_simplesnatch/coin.02e7fe946a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_simplesnatch/coinChest_large.a6763ea0a4.png":_Figure.scaleKoef})}),featuresAdder.registry("coinchest_newyear",function(e){FigureRules.add(".episode_".concat(e," .coinChestHeadCell"),{width:131/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_newyear/newyearChest.26d14a6105.png"}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.opened"),{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .coinChestHeadCell.closed"),{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_".concat(e," .attribute_coin"),{width:.8*Config.cellWidth,height:.8*Config.cellHeight,"margin-left":.1*Config.cellWidth,"margin-top":-.2*Config.cellWidth,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_newyear/coinNewyear.ad9da71ade.png"}),FigureRules.add(".episode_".concat(e," .attribute_coin_remove"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_newyear/coinNewyearTask.f99f78359e.png"})}),figureRulesProcess.additionalBonusScaleImages=(Nhc=figureRulesProcess.additionalBonusScaleImages,function(){Nhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_newyear/newyearChest.26d14a6105.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_newyear/coinNewyear.ad9da71ade.png":_Figure.scaleKoef})}),featuresAdder.registry("color_fishdrop",function(e){FigureRules.add(".episode_".concat(e," .cell.color_G"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/color_fishdrop/color_G.0c8367e738.png"}),FigureRules.add(".episode_".concat(e," .bomb.color_G"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .sail .taskIconContainer .taskIco.color_G"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/color_fishdrop/color_G.0c8367e738.png"}),FigureRules.add(".episode_".concat(e," .fortHeadCell .taskIconContainer .taskIco.color_G"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/color_fishdrop/color_G.0c8367e738.png"})}),figureRulesProcess.additionalBonusScaleImages=(Phc=figureRulesProcess.additionalBonusScaleImages,function(){Phc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/color_fishdrop/color_G.0c8367e738.png":_Figure.scaleKoef})}),featuresAdder.registry("episodecollectiondroppable",function(e){FigureRules.add(".episode_".concat(e," .specialItemRemove, .episode_").concat(e," .artifactPartCell"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/episodecollectiondroppable/special8.25a966c9be.png"})}),featuresAdder.registry("dropcell_ankh",function(e){FigureRules.add(".episode_".concat(e," .fish5"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_ankh/ankh.d451b71e36.png"})}),featuresAdder.registry("dropcell_chest",function(e){FigureRules.add(".episode_".concat(e," .fish5.fishcellBg"),{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_chest/special2.260f753f49.png"})}),figureRulesProcess.additionalBonusScaleImages=(Thc=figureRulesProcess.additionalBonusScaleImages,function(){Thc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_chest/special2.260f753f49.png":_Figure.scaleKoef})}),featuresAdder.registry("dropcell_eggsbasket",function(e){FigureRules.add(".episode_".concat(e," .fish.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_eggsbasket/eggBasket.600ad34621.png"}),FigureRules.add(".episode_".concat(e," .fish5.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_eggsbasket/eggBasket.600ad34621.png"})}),figureRulesProcess.additionalBonusScaleImages=(Vhc=figureRulesProcess.additionalBonusScaleImages,function(){Vhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_eggsbasket/eggBasket.600ad34621.png":_Figure.scaleKoef})}),featuresAdder.registry("dropcell_foodbasket",function(e){FigureRules.add(".episode_".concat(e," .fish5.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_foodbasket/foodBasket.8e16314608.png"})}),figureRulesProcess.additionalBonusScaleImages=(Xhc=figureRulesProcess.additionalBonusScaleImages,function(){Xhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_foodbasket/foodBasket.8e16314608.png":_Figure.scaleKoef})}),featuresAdder.registry("dropcell_fruitbasket",function(e){FigureRules.add(".episode_".concat(e," .fish5.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_fruitbasket/specialFeature.84754f81f9.png"})}),figureRulesProcess.additionalBonusScaleImages=(Zhc=figureRulesProcess.additionalBonusScaleImages,function(){Zhc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_fruitbasket/specialFeature.84754f81f9.png":_Figure.scaleKoef})}),featuresAdder.registry("dropcell_hamster",function(e){FigureRules.add(".episode_".concat(e," .fish5.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_hamster/hamster.dc787bfc55.png"})}),figureRulesProcess.additionalBonusScaleImages=(_hc=figureRulesProcess.additionalBonusScaleImages,function(){_hc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/dropcell_dropcell_hamster/hamster.png":_Figure.scaleKoef})}),featuresAdder.registry("dropcell_book",function(e){FigureRules.add(".episode_".concat(e," .fish.fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_book/pushkinBook.99954e94ae.png"})}),featuresAdder.registry("dropcell_rustyanchorcell",function(e){FigureRules.add(".episode_".concat(e," .fishcellBg"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_rustyanchorcell/rustyAnchorCell.89bc7ecda9.png"})}),featuresAdder.registry("dropcell_flour",function(e){FigureRules.add(".episode_".concat(e," .fish5"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_flour/dropcell_flour.f2ceda3e0c.png"})}),figureRulesProcess.additionalBonusScaleImages=(dic=figureRulesProcess.additionalBonusScaleImages,function(){dic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/dropcell_flour/dropcell_flour.f2ceda3e0c.png":_Figure.scaleKoef})}),featuresAdder.registry("crabmedusa_snail",function(e){FigureRules.add(".episode_".concat(e," .decorator_crabMedusa.special"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa_snail/snail.89dc182ffc.png","margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .move_crabMedusa.special"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa_snail/snail.89dc182ffc.png",startFrame:9,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .move_crabMedusa.special.delay"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa_snail/snail.89dc182ffc.png",spriteFrames:5,framesOrder:[5,6,7,8,9],duration:250,playRound:!1}),FigureRules.add(".episode_".concat(e," .die_crabMedusa.special"),{"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmedusa_snail/snail.89dc182ffc.png"}),FigureRules.add(".episode_".concat(e," .crabMedusaMovesBlock .crabMedusaMoves"),{opacity:0})}),featuresAdder.registry("crabmouse_rabbit",function(e){FigureRules.add(".episode_".concat(e," .decorator_crabMouse"),{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_rabbit/rabbit.f805c965cd.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.stable"),{"background-position-x":0,spriteFrames:3,duration:400,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.takeLife"),{"background-position-x":540,spriteFrames:3,duration:150,playRound:!0}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse .life"),{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_".concat(e," .move_crabMouse, .episode_").concat(e," .crabMouseCollect"),{"background-position-x":1080,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_rabbit/rabbit.f805c965cd.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:3,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .move_crabMouse.moveRight"),{"scale-x":-1,"margin-left":0}),FigureRules.add(".episode_".concat(e," .move_crabMouse .life"),{opacity:"0"}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse .life"),{opacity:"0"}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":5/60*Config.cellWidth,"margin-top":.9*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse .lifeBar"),{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.lifeLevel2 .lifeBar"),{"background-color":"#ff0"}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.lifeLevel1 .lifeBar"),{"background-color":"#f2342c"})}),figureRulesProcess.additionalBonusScaleImages=(gic=figureRulesProcess.additionalBonusScaleImages,function(){gic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_rabbit/rabbit.f805c965cd.png":_Figure.scaleKoef})}),featuresAdder.registry("crabmouse_shootmouse",function(e){FigureRules.add(".episode_".concat(e," .decorator_crabMouse"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_shootmouse/shootMouse.96ebf4a9a5.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-top":8/60*Config.cellHeight,scale:.8}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.stable"),{"background-position-x":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse.takeLife"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .decorator_crabMouse .life"),{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#fff",strokeStyle:"#bd3f00",lineWidth:.1*Config.cellWidth,"text-left":28/60*Config.cellWidth,"text-top":52/60*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_".concat(e," .move_crabMouse, .episode_").concat(e," .crabMouseCollect"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_shootmouse/shootMouse.96ebf4a9a5.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:4,duration:300,playRound:!0,"margin-top":8/60*Config.cellHeight,scale:.8}),FigureRules.add(".episode_".concat(e," .move_crabMouse.moveRight"),{"scale-x":-.8,"margin-left":0}),FigureRules.add(".episode_".concat(e," .move_crabMouse .life"),{opacity:1})}),featuresAdder.registry("crabmousefarm_shootmousefarm",function(e){FigureRules.add(".episode_".concat(e," .mouseFarmCell"),{"background-position-x":0,"background-position-y":0,"background-width":66,"background-height":75,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmousefarm_shootmousefarm/shootMouseFarm.9655174e2e.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .farmCell"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/crabmouse_shootmouse/shootMouse.96ebf4a9a5.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .FarmLevel0.mouseFarmCell"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .FarmLevel1.mouseFarmCell"),{"background-position-x":66}),FigureRules.add(".episode_".concat(e," .FarmLevel2.mouseFarmCell"),{"background-position-x":132}),FigureRules.add(".episode_".concat(e," .FarmLevel3.mouseFarmCell"),{"background-position-x":198}),FigureRules.add(".episode_".concat(e," .farmCell"),{"background-position-x":0,spriteFrames:1,duration:1,playRound:!1,opacity:0}),FigureRules.add(".episode_".concat(e," .farmCell.FarmMove"),{"background-position-x":0,spriteFrames:1,duration:1,playRound:!1})}),featuresAdder.registry("fishball_bird",function(e){FigureRules.add(".episode_".concat(e," .fishBallCell"),{"background-position-x":0,"background-position-y":0,"background-width":218,"background-height":184,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_bird/bird_large.ca4c3b6830.png","margin-left":-19/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight,width:218/180*Config.cellWidth,height:184/180*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],delay:[2e3,4e3],duration:600,playRound:!0}),FigureRules.add(".episode_".concat(e," .fishBallCell.powerUpHighlight"),{animation:{params:{"margin-top":[-.05*Config.cellHeight,-24/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallAngry"),{startFrame:7,spriteFrames:8,duration:600,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.create"),{"background-position-x":0,"background-position-y":0,"background-width":218,"background-height":184,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_bird/bird_large.ca4c3b6830.png","margin-left":-19/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight,width:218/180*Config.cellWidth,height:184/180*Config.cellHeight,spriteFrames:15,duration:800,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie"),{"margin-left":0,"margin-top":0,startFrame:15,spriteFrames:3,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallFly"),{"margin-left":3,startFrame:18,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":51,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlockSoc.f27a59efc8.png",width:170/180*Config.cellWidth,height:51/180*Config.cellHeight,"margin-left":8/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie .lifeBlock, ")+".episode_".concat(e," .fishBallCell.fishBallFly .lifeBlock, ")+".episode_".concat(e," .fishBallCell.create .lifeBlock"),{opacity:0}),FigureRules.add(".episode_".concat(e," .fishBallCell .life"),{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell .shallow"),{width:170/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e,".fishBallCell .middle"),{width:170/180*Config.cellWidth}),FigureRules.add(".episode_".concat(e,".fishBallCell .deep"),{width:170/180*Config.cellWidth})}),figureRulesProcess.additionalBonusScaleImages=(kic=figureRulesProcess.additionalBonusScaleImages,function(){kic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_bird/bird_large.ca4c3b6830.png":Config.cellWidth/160})}),featuresAdder.registry("fishball_chicken",function(e){FigureRules.add(".episode_".concat(e," .fishBallCell"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_chicken/chickenDamage.5ce3b80eb1.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.powerUpHighlight"),{animation:{params:{"margin-top":[-26/180*Config.cellHeight,-42/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallAngry"),{spriteFrames:9,duration:800,playRound:!0}),FigureRules.add(".episode_".concat(e," .fishBallCell.create"),{"background-width":60,"background-height":60,"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_chicken/chickenSpawn.a8fb90210b.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:12,duration:1e3,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie"),{"background-width":104,"background-height":104,"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_chicken/chickenDead.775515c957.png","margin-left":-22/60*Config.cellWidth,"margin-top":-22/60*Config.cellHeight,width:104/60*Config.cellWidth,height:104/60*Config.cellHeight,spriteFrames:10,duration:900,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallFly"),{opacity:0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":51,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlockSoc.f27a59efc8.png",width:170/180*Config.cellWidth,height:51/180*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie .lifeBlock, .episode_fishball_chicken .fishBallCell.fishBallFly .lifeBlock, .fishBallCell.create .lifeBlock"),{opacity:0}),FigureRules.add(".episode_".concat(e," .fishBallCell .shallow"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeYellow.45b3115da4.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell .middle"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeGreen.c90bcd3e5f.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell .deep"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBGreen.10127306b5.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight})}),featuresAdder.registry("fishball_mysteryball",function(e){FigureRules.add(".episode_".concat(e," .fishBallCell"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_mysteryball/mysteryBall_xlarge.3760e3c1c3.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:6,framesOrder:[0,1,2,3,4,5],delay:[2e3,4e3],duration:600,playRound:!0}),FigureRules.add(".episode_".concat(e," .fishBallCell.powerUpHighlight"),{animation:{params:{"margin-top":[-0*Config.cellHeight,-24/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallAngry"),{startFrame:6,spriteFrames:8,duration:600,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.create"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_mysteryball/mysteryBall_xlarge.3760e3c1c3.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:14,duration:800,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie"),{startFrame:14,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallFly"),{startFrame:19,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fish2.fishcellBg"),{"background-image":"../../../gems/site/img/features/fishball_mysteryball/special2.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(nic=figureRulesProcess.additionalBonusScaleImages,function(){nic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_mysteryball/mysteryBall_xlarge.3760e3c1c3.png":Config.cellWidth/160})}),featuresAdder.registry("flamy_fairy",function(e){FigureRules.add(".episode_".concat(e," .flamyCellBg"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":383,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_fairy/fairyStable.539d3fe3f4.png","margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_".concat(e," .flamyCellBg.damaged"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_fairy/fairyDamaged_large.c27c01cbc9.png",spriteFrames:8,framesOrder:[0,1,2,3,4,5,6,7],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock"),{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .taskIco"),{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_fairy/flowerTask.321a4c8ea7.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .currentLife, .episode_flamy_fairy .flamyCell .lifeBlock .lifeText .divider, ")+".episode_".concat(e," .flamyCell .lifeBlock .lifeText .maxLife"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .currentLife"),{textAlign:"right"}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .divider"),{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .maxLife"),{"margin-left":.15*Config.cellWidth})}),figureRulesProcess.additionalBonusScaleImages=(pic=figureRulesProcess.additionalBonusScaleImages,function(){pic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_fairy/fairyDamaged_large.c27c01cbc9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_fairy/fairyStable.539d3fe3f4.png":_Figure.scaleKoef})}),featuresAdder.registry("flamy_egg",function(e){FigureRules.add(".episode_".concat(e," .flamyCellBg"),{width:95/60*Config.cellWidth,height:2*Config.cellHeight,"background-width":161,"background-height":202,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_egg/eggStable.dc4fbe8e8f.png","margin-left":.2*Config.cellWidth,"margin-top":-.1*Config.cellHeight,spriteFrames:43,duration:3e3,playRound:!0,delay:[4e3,6e3]}),FigureRules.add(".episode_".concat(e," .flamyCellBg.damaged"),{width:95/60*Config.cellWidth,height:2*Config.cellHeight,"background-width":161,"background-height":202,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_egg/eggDamage.d3d79a6bb0.png","margin-left":.2*Config.cellWidth,"margin-top":-.1*Config.cellHeight,spriteFrames:8,duration:700,playRound:!1}),FigureRules.add(".episode_".concat(e," .flamyCellBg.animateRemoval"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_egg/eggDead_xlarge.a5ee4996a8.png",width:95/60*Config.cellWidth,height:124/60*Config.cellHeight,"background-width":161,"background-height":216,"margin-left":.2*Config.cellWidth,"margin-top":-10/60*Config.cellHeight,spriteFrames:20,duration:1500,playRound:!1}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock"),{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .taskIco"),{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_egg/paintTask.b93b8a48d0.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .currentLife, .episode_easterfishing .flamyCell .lifeBlock .lifeText .divider, ")+".episode_".concat(e," .flamyCell .lifeBlock .lifeText .maxLife"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .currentLife"),{textAlign:"right"}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .divider"),{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .flamyCell .lifeBlock .lifeText .maxLife"),{"margin-left":.15*Config.cellWidth})}),figureRulesProcess.additionalBonusScaleImages=(ric=figureRulesProcess.additionalBonusScaleImages,function(){ric.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/flamy_egg/eggStable.dc4fbe8e8f.png":Config.cellWidth/75,"../../../gems/site/img/features/flamy_egg/eggDamaged_xlarge.png":Config.cellWidth/75})}),featuresAdder.registry("floor_autumngrass",function(e){FigureRules.add(".episode_".concat(e," .floorLevel1"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass1.a15ad7ffa6.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice1Blast1, ")+".episode_".concat(e," .ice1Blast2, ")+".episode_".concat(e," .ice1Blast3, ")+".episode_".concat(e," .ice1Blast4, ")+".episode_".concat(e," .ice1Blast5"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass1Die.d061054639.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice1Blast2"),{"background-position-x":240}),FigureRules.add(".episode_".concat(e," .ice1Blast3"),{"background-position-x":480}),FigureRules.add(".episode_".concat(e," .ice1Blast4"),{"background-position-x":480}),FigureRules.add(".episode_".concat(e," .ice1Blast5"),{"background-position-x":480}),FigureRules.add(".episode_".concat(e," .floorLevel2"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass2.0fe4dca232.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice2Blast1, ")+".episode_".concat(e," .ice2Blast2"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass2Die.cdef207694.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice2Blast2"),{"background-position-x":240}),FigureRules.add(".episode_".concat(e," .floorLevel3"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass3.cd94de2015.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice3Blast1, ")+".episode_".concat(e," .ice3Blast2, ")+".episode_".concat(e," .ice3Blast3"),{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass3Die.8cb6b57fac.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice3Blast2"),{"background-position-x":240}),FigureRules.add(".episode_".concat(e," .ice3Blast3"),{"background-position-x":480})}),figureRulesProcess.additionalBonusScaleImages=(tic=figureRulesProcess.additionalBonusScaleImages,function(){tic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass1.a15ad7ffa6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass2.0fe4dca232.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_autumngrass/grass3.cd94de2015.png":_Figure.scaleKoef})}),animationConfig.floor_autumngrass={removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&gameView.fallDownExplode(o,5,"ice1Blast"),e()},changeFloor:function(e,t,i){var o,a=FigureView.findById("floor_"+t.y+"_"+t.x);if(a){var n=i.level,r=i.oldLevel;a.hasClass("floorLevel3")&&(o="ice2Blast"),a.hasClass("floorLevel2")&&(o="ice1Blast"),gameView.fallDownExplodeWithoutRemove(a,2,o),a.addClass("floorLevelBetween"+n+"and"+r).queue(function(e){this.removeClass("floorLevel"+r).removeClass("floorLevelBetween"+n+"and"+r).addClass("floorLevel"+n),e()})}e()}},featuresAdder.registry("floor_flour",function(e){FigureRules.add(".episode_".concat(e," .floorLevel1"),{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour1.fc1c5d52f0.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,spriteFrames:0,framesOrder:[0],duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .floorLevel2"),{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour2.0c26c8f789.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevel3"),{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour3.6c6428769a.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevelAnimation3, ")+".episode_".concat(e," .floorLevelAnimation2, ")+".episode_".concat(e," .floorLevelAnimation1"),{"background-position-x":0,"background-position-y":0,"background-width":219,"background-height":240,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flourDie.6f58356123.png",width:219/180*Config.cellWidth,height:240/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:6,duration:350})}),figureRulesProcess.additionalBonusScaleImages=(Jic=figureRulesProcess.additionalBonusScaleImages,function(){Jic.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour1.fc1c5d52f0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour2.0c26c8f789.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flour3.6c6428769a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_flour/flourDie.6f58356123.png":_Figure.scaleKoef})}),animationConfig.floor_flour={removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&o.addClass("floorLevelAnimation2").delay(350).queue(function(e){e(),this.remove()}),e()}},featuresAdder.registry("floor_sand",function(e){FigureRules.add(".episode_".concat(e," .floorLevel1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_sand/sand1.c16bad630b.png","background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevel2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_sand/sand2.8e4fee45a9.png","background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevel3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_sand/sand3.58e7fdf656.png","background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevelAnimation3, ")+".episode_".concat(e," .floorLevelAnimation2, ")+".episode_".concat(e," .floorLevelAnimation1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_sand/sandDie.6f58356123.png","background-position-x":0,"background-position-y":0,"background-width":219,"background-height":240,width:219/180*Config.cellWidth,height:240/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:6,duration:350}),FigureRules.add(".episode_".concat(e," .iceBlast1.iceBlast, ")+".episode_".concat(e," .iceBlast2.iceBlast, ")+".episode_".concat(e," .iceBlast3.iceBlast, ")+".episode_".concat(e," .iceBlast4.iceBlast, ")+".episode_".concat(e," .iceBlast5.iceBlast, ")+".episode_".concat(e," .iceBlast6.iceBlast"),{opacity:0})}),figureRulesProcess.additionalBonusScaleImages=(Ric=figureRulesProcess.additionalBonusScaleImages,function(){Ric.call(this)}),animationConfig.floor_sand={removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&o.addClass("floorLevelAnimation3").delay(350).queue(function(e){e(),this.remove()}),e()}},featuresAdder.registry("floor_winter",function(e){FigureRules.add(".episode_".concat(e," .floorLevel1"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_winter/ice1.950e2ac2b6.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:0,framesOrder:[0],duration:0,delay:0}),FigureRules.add(".episode_".concat(e," .floorLevel2"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_winter/ice2.d06b42eefe.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevel3"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_winter/ice3.3412ba5f0c.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .floorLevelAnimation3, ")+".episode_".concat(e," .floorLevelAnimation2, ")+".episode_".concat(e," .floorLevelAnimation1"),{"background-position-x":0,"background-position-y":0,"background-width":113,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png",width:113/60*Config.cellWidth,height:3.3*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-26/60*Config.cellHeight,spriteFrames:4,duration:350})}),figureRulesProcess.additionalBonusScaleImages=(Zic=figureRulesProcess.additionalBonusScaleImages,function(){Zic.call(this)}),animationConfig.floor_winter={removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&o.addClass("floorLevelAnimation2").delay(350).queue(function(e){e(),this.remove()}),e()}},featuresAdder.registry("floor_foliage",function(e){FigureRules.add(".episode_".concat(e," .floorLevel1"),{"background-position-x":0,"background-position-y":0,"background-width":201,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage1.54c9544945.png",width:201/180*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice1Blast1, ")+".episode_".concat(e," .ice1Blast2, ")+".episode_".concat(e," .ice1Blast3, ")+".episode_".concat(e," .ice1Blast4, ")+".episode_".concat(e," .ice1Blast5, ")+".episode_".concat(e," .ice1Blast6"),{"background-position-x":0,"background-position-y":0,"background-width":201,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliageDie1.6a374b6284.png",width:201/180*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice1Blast2"),{"background-position-x":201}),FigureRules.add(".episode_".concat(e," .ice1Blast3"),{"background-position-x":402}),FigureRules.add(".episode_".concat(e," .ice1Blast4"),{"background-position-x":603}),FigureRules.add(".episode_".concat(e," .ice1Blast5"),{"background-position-x":804}),FigureRules.add(".episode_".concat(e," .floorLevel2"),{"background-position-x":0,"background-position-y":0,"background-width":201,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage2.a7f3610afc.png",width:201/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice2Blast1, ")+".episode_".concat(e," .ice2Blast2, ")+".episode_".concat(e," .ice2Blast3, ")+".episode_".concat(e," .ice2Blast4, ")+".episode_".concat(e," .ice2Blast5"),{"background-position-x":0,"background-position-y":0,"background-width":201,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliageDie2.e342b1efad.png",width:201/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice2Blast2"),{"background-position-x":201}),FigureRules.add(".episode_".concat(e," .ice2Blast3"),{"background-position-x":402}),FigureRules.add(".episode_".concat(e," .ice2Blast4"),{"background-position-x":603}),FigureRules.add(".episode_".concat(e," .ice2Blast5"),{"background-position-x":804}),FigureRules.add(".episode_".concat(e," .floorLevel3"),{"background-position-x":0,"background-position-y":0,"background-width":200,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage3.1f4ea34012.png",width:200/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice3Blast1, ")+".episode_".concat(e," .ice3Blast2, ")+".episode_".concat(e," .ice3Blast3, ")+".episode_".concat(e," .ice3Blast4, ")+".episode_".concat(e," .ice3Blast5"),{"background-position-x":0,"background-position-y":0,"background-width":203,"background-height":202,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliageDie3.dda4671dc6.png",width:203/180*Config.cellWidth,height:202/180*Config.cellHeight,"margin-left":-0*Config.cellWidth,"margin-top":-0*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .ice3Blast2"),{"background-position-x":203}),FigureRules.add(".episode_".concat(e," .ice3Blast3"),{"background-position-x":406}),FigureRules.add(".episode_".concat(e," .ice3Blast4"),{"background-position-x":609}),FigureRules.add(".episode_".concat(e," .ice3Blast5"),{"background-position-x":812})}),figureRulesProcess.additionalBonusScaleImages=(fjc=figureRulesProcess.additionalBonusScaleImages,function(){fjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage1.54c9544945.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage2.a7f3610afc.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/floor_foliage/foliage3.1f4ea34012.png":_Figure.scaleKoef})}),animationConfig.floor_foliage={removeFloor:function(e,t,i){var o=FigureView.findById("floor_"+t.y+"_"+t.x);o&&gameView.fallDownExplode(o,5,"ice1Blast"),e()},changeFloor:function(e,t,i){var o,a=FigureView.findById("floor_"+t.y+"_"+t.x);if(a){var n=i.level,r=i.oldLevel;a.hasClass("floorLevel3")&&(o="ice3Blast"),a.hasClass("floorLevel2")&&(o="ice2Blast"),gameView.fallDownExplodeWithoutRemove(a,6,o),a.addClass("floorLevelBetween"+n+"and"+r).queue(function(e){this.removeClass("floorLevel"+r).removeClass("floorLevelBetween"+n+"and"+r).addClass("floorLevel"+n),e()})}e()}},featuresAdder.registry("frozenegg_berry",function(e){FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry1.f3a22b43ea.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry2.5da6a1e711.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry3.de70489174.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant4"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry1.f3a22b43ea.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant5"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry2.5da6a1e711.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig1"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig1.c68be16142.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig2"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig2.283aaf832d.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig3"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig3.fee572f80b.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal1"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigHorizontal.698d2a8086.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal2"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigHorizontal.698d2a8086.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal3"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigHorizontal.698d2a8086.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical1"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigVertical.bdc0a450d3.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical2"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigVertical.bdc0a450d3.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical3"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigVertical.bdc0a450d3.png"})}),figureRulesProcess.additionalBonusScaleImages=(vjc=figureRulesProcess.additionalBonusScaleImages,function(){vjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry1.f3a22b43ea.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry2.5da6a1e711.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berry3.de70489174.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig1.c68be16142.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig2.283aaf832d.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berrybig3.fee572f80b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigHorizontal.698d2a8086.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_berry/berryBigVertical.bdc0a450d3.png":_Figure.scaleKoef})}),featuresAdder.registry("frozenegg_eggs",function(e){FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/egg1.9126751d33.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/egg2.7981f0bb59.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/egg3.1d91003bbb.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant4"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/egg1.9126751d33.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant5"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/egg2.7981f0bb59.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/bigEgg.c066eab154.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig1"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/bigEgg.c066eab154.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig2"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/bigEgg.c066eab154.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig3"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/bigEgg.c066eab154.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical1"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":125,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigVertical1.8a6a208bcd.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical2"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":125,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigVertical1.8a6a208bcd.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical3"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":125,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigVertical1.8a6a208bcd.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal1"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":180,"background-height":125,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigHorizontal1.d8dce8c304.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal2"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":180,"background-height":125,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigHorizontal1.d8dce8c304.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal3"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":180,"background-height":125,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggbigHorizontal1.d8dce8c304.png"})}),figureRulesProcess.additionalBonusScaleImages=(xjc=figureRulesProcess.additionalBonusScaleImages,function(){xjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/easterfishing/bigEgg.png":Config.cellWidth/80,"../../../gems/site/img/features/easterfishing/egg1.png":Config.cellWidth/180,"../../../gems/site/img/features/easterfishing/egg2.png":Config.cellWidth/180,"../../../gems/site/img/features/easterfishing/egg3.png":Config.cellWidth/180,"../../../gems/site/img/features/easterfishing/eggBasket.png":Config.cellWidth/180})}),featuresAdder.registry("frozenegg_gingerbread",function(e){FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread1.09f7530c28.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread2.c996c4db44.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread3.0cfae94cbf.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant4"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread1.09f7530c28.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variant5"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread2.c996c4db44.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig1"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig1.71a2564ccb.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig2"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig2.e9bbc5ced1.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbig3"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig3.362a05b905.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal1"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigHorizontal.299a0ce022.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal2"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigHorizontal.299a0ce022.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigHorizontal3"),{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigHorizontal.299a0ce022.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical1"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigVertical.22f4a5cbf3.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical2"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigVertical.22f4a5cbf3.png"}),FigureRules.add(".episode_".concat(e," .frozen_frozenegg.variantbigVertical3"),{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadBigVertical.22f4a5cbf3.png"})}),figureRulesProcess.additionalBonusScaleImages=(zjc=figureRulesProcess.additionalBonusScaleImages,function(){zjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread1.09f7530c28.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread2.c996c4db44.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbread3.0cfae94cbf.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig1.71a2564ccb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig2.e9bbc5ced1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_gingerbread/gingerbreadbig3.362a05b905.png":_Figure.scaleKoef,"../../../gems/site/img/features/frozenegg_gingerbread/gingerbreadhorizontal.png":_Figure.scaleKoef,"../../../gems/site/img/features/frozenegg_gingerbread/gingerbreadvertical.png":_Figure.scaleKoef})}),featuresAdder.registry("genrymorgan_coshey",function(e){FigureRules.add(".episode_".concat(e," .genrymorganHeadCell"),{width:2.1*Config.cellWidth,height:130/60*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,"background-width":126,"background-height":130,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_coshey/coshey.5d7157f00d.png"}),FigureRules.add(".episode_".concat(e," .genrymorganFly"),{width:2.1*Config.cellWidth,height:134/60*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":2/60*Config.cellHeight,"background-width":126,"background-height":134,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_coshey/cosheyFly.73f2551cfc.png",spriteFrames:9,duration:900}),FigureRules.add(".episode_".concat(e," .genrymorganLeftHand"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_coshey/hand.2838f132e6.png"}),FigureRules.add(".episode_".concat(e," .genrymorganRightHand"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_coshey/hand.2838f132e6.png"}),FigureRules.add(".episode_".concat(e," .genrymorganLifeBlock"),{"margin-left":38/60*Config.cellWidth})}),featuresAdder.registry("genrymorgan_jack",function(e){FigureRules.add(".episode_".concat(e," .genrymorganLeftHand"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_jack/jackHand.6b6839e623.png","scale-x":-1}),FigureRules.add(".episode_".concat(e," .genrymorganRightHand"),{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_jack/jackHand.6b6839e623.png"}),FigureRules.add(".episode_".concat(e," .genrymorganFly"),{width:2*Config.cellWidth,height:2.3*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight,"background-width":120,"background-height":138,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_jack/jackFly.075119df83.png",spriteFrames:9,duration:900}),FigureRules.add(".episode_".concat(e," .genrymorganHeadCell"),{width:2*Config.cellWidth,height:2.3*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-.25*Config.cellHeight,"background-width":120,"background-height":138,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/genrymorgan_jack/jack.24e52132c6.png"}),FigureRules.add(".episode_".concat(e," .genrymorganHeadCell.stable"),{spriteFrames:14,duration:900,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".episode_".concat(e," .genrymorganHeadCell.genrymorganAngry"),{spriteFrames:3,framesOrder:[14,15,16],duration:300})}),featuresAdder.registry("greedypirate_carrot",function(e){FigureRules.add(".episode_".concat(e," .decorator_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_carrot/greedyPirateCarrot1.edc9a40b38.png"}),FigureRules.add(".episode_".concat(e," .move_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_carrot/greedyPirateCarrot1.edc9a40b38.png"}),FigureRules.add(".episode_".concat(e," .grab_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_carrot/greedyPirateCarrot1.edc9a40b38.png"})}),figureRulesProcess.additionalBonusScaleImages=(Djc=figureRulesProcess.additionalBonusScaleImages,function(){Djc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_carrot/greedyPirateCarrot1.edc9a40b38.png":_Figure.scaleKoef})}),featuresAdder.registry("greedypirate_eggs",function(e){FigureRules.add(".episode_".concat(e," .decorator_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_eggs/greedyPirateeggs1.e57ec3ff33.png"}),FigureRules.add(".episode_".concat(e," .move_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_eggs/greedyPirateeggs1.e57ec3ff33.png"}),FigureRules.add(".episode_".concat(e," .grab_greedypirate"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_eggs/greedyPirateeggs1.e57ec3ff33.png"})}),figureRulesProcess.additionalBonusScaleImages=(Fjc=figureRulesProcess.additionalBonusScaleImages,function(){Fjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/greedypirate_eggs/greedyPirateeggs1.e57ec3ff33.png":Config.cellWidth/80})}),featuresAdder.registry("ground_bottle",function(e){FigureRules.add(".episode_".concat(e," .gravityGroundCell"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottle.d98b88fe30.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1 .gravityGroundCellFrame"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life2"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1 .gravityGroundCellFrame"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .groundLife1.gravityGroundCell"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapInside.ac3e6f83b9.png","margin-left":-7,"margin-top":-5,scale:1}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor2"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor3"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor4"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.explode"),{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode2"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode1.gravityGroundExplode"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode2.gravityGroundExplode"),{"background-position-x":180}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode3.gravityGroundExplode"),{"background-position-x":360}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode4.gravityGroundExplode"),{"background-position-x":540}),FigureRules.add(".episode_".concat(e," .cork"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/cork.0383f7ca25.png"}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapFlying.97138bceb0.png","background-position-x":0,"margin-left":-7,"margin-top":-2}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying.attributeColor2"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapFlying.97138bceb0.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying.attributeColor3"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapFlying.97138bceb0.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying.attributeColor4"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapFlying.97138bceb0.png","background-position-x":0})}),featuresAdder.registry("ground_foodbox",function(e){FigureRules.add(".episode_".concat(e," .gravityGroundCell"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png",frame:0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":378}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":189}),FigureRules.add(".episode_".concat(e," .groundLife3.gravityGroundCell"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundExplode"),{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundExplodeCell2"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundExplodeCell1"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":189}),FigureRules.add(".episode_".concat(e," .attribute_ground"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png",frame:3}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor4"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png",frame:0}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attribute_ground.attributeColor4"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png"}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell .attribute_ground"),{opacity:0}),FigureRules.add(".episode_".concat(e," .groundLife3.gravityGroundCell .attribute_ground"),{opacity:0}),FigureRules.add(".episode_".concat(e," .gravityGroundLife1.gravityGroundCell .attribute_ground"),{opacity:1}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png",scale:1}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor3.flying"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png"}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor4.flying"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attributeIcon1"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/shrimpIcon.7b3181f426.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attributeIcon2"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/shrimpIcon.7b3181f426.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attributeIcon3"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/shrimpIcon.7b3181f426.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .attributeIcon4"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/shrimpIcon.7b3181f426.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode1"),{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png","background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.explode"),{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2 .attributeIcon1"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1 .attributeIcon1"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell .attributeIcon1"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2 .attributeIcon2"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1 .attributeIcon2"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell .attributeIcon2"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2 .attributeIcon3"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1 .attributeIcon3"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell .attributeIcon3"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2 .attributeIcon4"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1 .attributeIcon4"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell .attributeIcon4"),{"background-position-x":189}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1 .attributeIcon1"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1 .attributeIcon2"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1 .attributeIcon3"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1 .attributeIcon4"),{"background-position-x":378}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.hasDecorator .attributeIcon1, ")+".episode_".concat(e," .gravityGroundCell.hasDecorator .attributeIcon2, ")+".episode_".concat(e," .gravityGroundCell.hasDecorator .attributeIcon3, ")+".episode_".concat(e," .gravityGroundCell.hasDecorator .attributeIcon4"),{opacity:0})}),figureRulesProcess.additionalBonusScaleImages=(Ijc=figureRulesProcess.additionalBonusScaleImages,function(){Ijc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/box.28fb5dc086.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/boxShrimp.51794a2597.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_foodbox/shrimpIcon.7b3181f426.png":_Figure.scaleKoef})}),GravityGroundCell.prototype.animateTakeLife=(Jjc=GravityGroundCell.prototype.animateTakeLife,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"ground_foodbox"==e})||featuresAdder.commonFeatures.find(function(e){return"ground_foodbox"==e})))return Jjc.call(this,t);var i=this;application.playSound("groundexplode"),this.$div.ourAnimate({"scale-y":.7,"scale-x":1.2},100).ourAnimate({"scale-y":1,"scale-x":1},100).queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundExplode"),this.addClass("gravityGroundExplodeCell"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),e()}).queue(function(e){this.removeClass("gravityGroundExplode"),this.removeClass("gravityGroundExplode"+(i.life+1)),t(),e()})}),GravityGroundCell.prototype.animateRemoval=(Qjc=GravityGroundCell.prototype.animateRemoval,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"ground_foodbox"==e})||featuresAdder.commonFeatures.find(function(e){return"ground_foodbox"==e})))return Qjc.call(this,t);var i=this;application.playSound("groundexplode"),this.$div.ourAnimate({"scale-y":.7,"scale-x":1.2},100).ourAnimate({"scale-y":1,"scale-x":1},100).addStyleAnimate("explode").queue(function(){t();var e=GameBaseView.createFallDownExplodePiece("gravityGroundExplode"+(i.life+1));e.alignTo(this),gameView.fallDownExplodePiece(e),this.remove()})}),featuresAdder.registry("ground_sweetdish",function(e){FigureRules.add(".episode_".concat(e," .gravityGroundCell"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_03.60488d0833.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife2"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_02.2db325b4ec.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.gravityGroundLife1"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_01.b66ea0c1a5.png"}),FigureRules.add(".episode_".concat(e," .groundLife2.gravityGroundCell"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_02.2db325b4ec.png"}),FigureRules.add(".episode_".concat(e," .groundLife1.gravityGroundCell"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_01.b66ea0c1a5.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.life1"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/ground_01.b66ea0c1a5.png"}),FigureRules.add(".episode_".concat(e," .groundExplode"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_03.05e8949607.png"}),FigureRules.add(".episode_".concat(e," .attribute_ground"),{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundFood_01.49e7669900.png",x:0,y:0}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor2"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor3"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.attributeColor4"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_01.2d7d56e669.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode2"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_01.2d7d56e669.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_".concat(e," .gravityGroundExplode1"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_01.2d7d56e669.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying"),{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,x:-10,y:-10,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/foodTask.29d121e90d.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode1.gravityGroundExplode"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_01.2d7d56e669.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode2.gravityGroundExplode"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_02.3cadb6c659.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode3.gravityGroundExplode"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_03.05e8949607.png"}),FigureRules.add(".episode_".concat(e," .gravityGroundCell .groundExplode4.gravityGroundExplode"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_sweetdish/groundBreak_02.3cadb6c659.png"}),FigureRules.add(".episode_".concat(e," .groundCell.explode"),{spriteFrames:1,duration:1,frame:3}),FigureRules.add(".episode_".concat(e," .gravityGroundCell.explode"),{spriteFrames:1,duration:1,frame:3})}),featuresAdder.registry("ground_greenstone",function(e){FigureRules.add(".episode_".concat(e," .attribute_ground"),{width:140/180*Config.cellWidth,height:160/180*Config.cellHeight,"background-width":140,"background-height":160,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_greenstone/gold.1790952f58.png","margin-left":.05*Config.cellWidth,x:4/60*Config.cellWidth,y:4/60*Config.cellHeight,scale:.8}),FigureRules.add(".episode_".concat(e," .attribute_ground.flying"),{width:.55*Config.cellWidth,height:132/180*Config.cellHeight,"background-width":99,"background-height":132,"margin-left":.05*Config.cellWidth,x:8/60*Config.cellWidth,y:4/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_greenstone/goldTask.c4d3e00e53.png",scale:.8})}),figureRulesProcess.additionalBonusScaleImages=(Yjc=figureRulesProcess.additionalBonusScaleImages,function(){Yjc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_greenstone/gold.1790952f58.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_greenstone/goldTask.c4d3e00e53.png":_Figure.scaleKoef})}),featuresAdder.registry("iceberg_berry",function(e){FigureRules.add(".episode_".concat(e," .icebergCellBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/iceberg.f2ea3bf9f7.png"}),FigureRules.add(".episode_".concat(e," .icebergExplode"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/icebergDie.105bd6bcd1.png"}),FigureRules.add(".episode_".concat(e," .flyingIceShard"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/icebergShard.3a291dbec9.png"})}),figureRulesProcess.additionalBonusScaleImages=($jc=figureRulesProcess.additionalBonusScaleImages,function(){$jc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/iceberg.f2ea3bf9f7.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/icebergDie.105bd6bcd1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berry/icebergShard.3a291dbec9.png":_Figure.scaleKoef})}),featuresAdder.registry("iceberg_berrybush",function(e){FigureRules.add(".episode_".concat(e," .icebergCellBg"),{"background-width":156,"background-height":137,width:2.6*Config.cellWidth,height:137/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berrybush/berryTreeX_xlarge.d64a7d3af7.png","margin-left":-.4*Config.cellWidth,"margin-top":-.1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .icebergCellBg.animate"),{animation:{params:{"margin-top":[-.1*Config.cellHeight,-.1*Config.cellHeight]},duration:900}}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife4"),{startFrame:0,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel3 .icebergCellBg"),{frame:4}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife3"),{startFrame:4,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel2 .icebergCellBg"),{frame:8}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife2"),{startFrame:8,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel1 .icebergCellBg"),{frame:12}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.nutTreeDie"),{startFrame:12,spriteFrames:9,duration:700}),FigureRules.add(".episode_".concat(e," .icebergCellWater"),{"background-width":151,"background-height":143,width:151/180*Config.cellWidth,height:143/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berrybush/berryTreeLeaf.fffb6aee42.png","margin-left":-24/180*Config.cellWidth,"margin-top":160/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .icebergCellWater"),{startFrame:0,spriteFrames:12,duration:1800,lastFrame:11,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyingIceShard"),{"background-position-x":0,"background-position-y":0,"background-width":273,"background-height":222,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_berrybush/berryTreeShard.61b825e0b8.png",width:273/180*Config.cellWidth,height:222/180*Config.cellHeight,"margin-left":-24/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flyingIceShard.splash"),{spriteFrames:4,duration:500}),FigureRules.add(".episode_".concat(e," .icebergExplode"),{opacity:0})}),IcebergCell.prototype.animateRemoval=(akc=IcebergCell.prototype.animateRemoval,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"iceberg_berrybush"==e})||featuresAdder.commonFeatures.find(function(e){return"iceberg_berrybush"==e})))return akc.call(this,t);for(var e=0;e<this.body.length;e++)Game.addFloor(this.body[e],2,{noTask:this.isIceInTask()});this.generateTreasure(_.shuffle(this.body).slice(0,this.remainingTreasures)),this.$div.queue(function(e){this.find(".icebergCellBg").addClass("nutTreeDie"),e()}).delay(700).queue(function(e){this.find(".icebergCellBg").removeClass("nutTreeDie"),e(),this.remove(),t()})}),IcebergCell.prototype.startWaterAnimation=(hkc=IcebergCell.prototype.startWaterAnimation,function(){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"iceberg_berrybush"==e})||featuresAdder.commonFeatures.find(function(e){return"iceberg_berrybush"==e})?void 0:hkc.call(this)}),IcebergCell.prototype.animateTakeLife=(kkc=IcebergCell.prototype.animateTakeLife,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"iceberg_berrybush"==e})||featuresAdder.commonFeatures.find(function(e){return"iceberg_berrybush"==e})))return kkc.call(this,t);var i=this;this.$div.queue(function(e){this.removeClass(i.baseName+"Level"+(i.life+1)),this.find(".icebergCellBg").addClass("animateTakeLife"+(i.life+1)),e()}).delay(500).queue(function(e){this.find(".icebergCellBg").removeClass("animateTakeLife"+(i.life+1)),this.addClass(i.baseName+"Level"+i.life),e(),t()})}),featuresAdder.registry("iceberg_eggs",function(e){FigureRules.add(".episode_".concat(e," .icebergCellBg"),{"background-width":165,"background-height":168,width:165/70*Config.cellWidth,height:2.4*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeX_xlarge.6624330317.png","margin-left":-12/70*Config.cellWidth,"margin-top":-.2*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .icebergCellBg.animate"),{animation:{}}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife4"),{startFrame:0,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel3 .icebergCellBg"),{frame:4}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife3"),{startFrame:4,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel2 .icebergCellBg"),{frame:8}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.animateTakeLife2"),{startFrame:8,spriteFrames:5,duration:500}),FigureRules.add(".episode_".concat(e," .icebergHeadCell.icebergLevel1 .icebergCellBg"),{frame:12}),FigureRules.add(".episode_".concat(e," .icebergHeadCell .icebergCellBg.nutTreeDie"),{startFrame:12,spriteFrames:9,duration:700}),FigureRules.add(".episode_".concat(e," .icebergCellWater"),{"background-width":151,"background-height":143,width:151/180*Config.cellWidth,height:143/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeLeaf.135cac05c1.png","margin-left":-24/180*Config.cellWidth,"margin-top":160/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .icebergCellWater"),{startFrame:0,spriteFrames:12,duration:1800,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyingIceShard"),{"background-position-x":0,"background-position-y":0,"background-width":273,"background-height":222,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeShard.61b825e0b8.png",width:273/180*Config.cellWidth,height:222/180*Config.cellHeight,"margin-left":-24/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .flyingIceShard.splash"),{spriteFrames:4,duration:500}),FigureRules.add(".episode_".concat(e," .icebergExplode"),{opacity:0})}),figureRulesProcess.additionalBonusScaleImages=(skc=figureRulesProcess.additionalBonusScaleImages,function(){skc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeLeaf.135cac05c1.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeShard.61b825e0b8.png":Config.cellWidth/136,"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_eggs/eggTreeX_xlarge.6624330317.png":Config.cellWidth/52})}),featuresAdder.registry("mermaid_oven",function(e){FigureRules.add(".episode_".concat(e," .mermaidCellBg.stable"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenIdle.135fa419c5.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:11,duration:1e3,playRound:!0,delay:[1e3,5e3]}),FigureRules.add(".episode_".concat(e," .mermaidCell .lifeBlock"),{width:201/180*Config.cellWidth,height:71/180*Config.cellHeight,"background-width":201,"background-height":71,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenLifes.655f00e380.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .mermaidCell .lifeBlock .taskIco"),{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenFish.8517deb6a2.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .mermaidCellBg.ovenEating"),{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenEat.5d87644a0f.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:17,duration:1e3,delay:0})}),MermaidCell.prototype.onCollect=(ukc=MermaidCell.prototype.onCollect,function(e,t){var i=this;if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"mermaid_oven"==e})||featuresAdder.commonFeatures.find(function(e){return"mermaid_oven"==e})){var o=Game.animate();this.lastTimeEating=this.lastTimeEating||0;var a=3e3<new Date-this.lastTimeEating;this.lastTimeEating=new Date,a?this.$div.queue(function(e){i.$div.find(".mermaidCellBg").addClass("ovenEating"),e()}).delay(1e3).queue(function(e){i.$div.find(".mermaidCellBg").removeClass("ovenEating"),i.$div.find(".currentLife").html(i.task.get("collectedAmount")),o(),e()}):o()}else ukc.call(this,e,t)}),figureRulesProcess.additionalBonusScaleImages=(Ekc=figureRulesProcess.additionalBonusScaleImages,function(){Ekc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenFish.8517deb6a2.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/mermaid_oven/ovenLifes.655f00e380.png":_Figure.scaleKoef})}),featuresAdder.registry("parrot_rabbit",function(e){FigureRules.add(".episode_".concat(e," .catboxCell.cell"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .catboxCellBg"),{"background-position-y":0,"background-width":236,"background-height":309,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbit_xlarge.e908293b85.png",width:236/180*Config.cellWidth,height:309/180*Config.cellHeight,"margin-left":-8/60*Config.cellWidth,"margin-top":-.6*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .catboxLevel1 .catboxCellBg"),{"background-position-x":1888}),FigureRules.add(".episode_".concat(e," .catboxLevel1 .catboxCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .catboxLevel2 .catboxCellBg"),{"background-position-x":944}),FigureRules.add(".episode_".concat(e," .catboxLevel2 .catboxCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .catboxLevel3 .catboxCellBg"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .catboxLevel3 .catboxCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .catboxCellCage"),{opacity:0}),FigureRules.add(".episode_".concat(e," .catboxChangeLevel2 .catboxCellBg.stable"),{spriteFrames:5,duration:400,playRound:!1}),FigureRules.add(".episode_".concat(e," .catboxChangeLevel1 .catboxCellBg.stable"),{spriteFrames:5,duration:400,framesOrder:[4,5,6,7,8],playRound:!1}),FigureRules.add(".episode_".concat(e," .catboxChangeLevel0 .catboxCellBg.stable"),{spriteFrames:5,duration:400,framesOrder:[8,9,10,11,12],playRound:!1}),FigureRules.add(".episode_".concat(e," .catbox"),{"background-position-x":0,"background-position-y":0,"background-width":160,"background-height":270,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbitFlying.bb14df41f4.png",width:160/180*Config.cellWidth,height:1.5*Config.cellHeight,"margin-left":.1*Config.cellWidth,"margin-top":-20/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decoration_2 .catboxCellBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbit_xlarge.e908293b85.png"}),FigureRules.add(".episode_".concat(e," .decoration_3 .catboxCellBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbit_xlarge.e908293b85.png"}),FigureRules.add(".episode_".concat(e," .catbox.decoration_2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbit_xlarge.e908293b85.png"}),FigureRules.add(".episode_".concat(e," .catbox.decoration_3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_rabbit/rabbit_xlarge.e908293b85.png"})}),CollectParrot.prototype.getCapitalisedBaseName=(Gkc=CollectParrot.prototype.getCapitalisedBaseName,function(e){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_rabbit"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_rabbit"==e})?"Catbox":Gkc.call(this)}),ParrotCell.prototype.animateTakeLife=(Kkc=ParrotCell.prototype.animateTakeLife,function(t){var i=this;if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_rabbit"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_rabbit"==e})){application.playSound(this.getTakeLifeSound());var o=this.life;this.$div.queue(function(e){i.$div.removeClass(i.baseName+"Level"+(o+1)).addClass(i.baseName+"ChangeLevel"+o).find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).delay(500).queue(function(e){i.$div.addClass(i.baseName+"Level"+o).removeClass(i.baseName+"ChangeLevel"+o).find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e(),t()})}else Kkc.call(this,t)}),ParrotCell.prototype.animateRemoval=(Skc=ParrotCell.prototype.animateRemoval,function(t){var i=this;if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_rabbit"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_rabbit"==e})))return Skc.call(this,t);var o=this.life;this.$div.queue(function(e){i.$div.removeClass(i.baseName+"Level"+(o+1)).addClass(i.baseName+"ChangeLevel0").find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).delay(500).queue(function(e){i.$div.addClass(i.baseName+"Level0").find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e(),Skc.call(i,t)})}),featuresAdder.registry("parrot_shoottarget",function(e){FigureRules.add(".episode_".concat(e," .parrotCell.cell"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .parrotCellBg"),{"background-position-y":0,"background-width":71,"background-height":71,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_shoottarget/shootTarget.099bbc6aaf.png",width:71/60*Config.cellWidth,height:71/60*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .parrotLevel1 .parrotCellBg"),{"background-position-x":852}),FigureRules.add(".episode_".concat(e," .parrotLevel1 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotLevel2 .parrotCellBg"),{"background-position-x":426}),FigureRules.add(".episode_".concat(e," .parrotLevel2 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotLevel3 .parrotCellBg"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .parrotLevel3 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotCellCage"),{opacity:0}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel2 .parrotCellBg.stable"),{spriteFrames:7,duration:600,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel1 .parrotCellBg.stable"),{spriteFrames:7,duration:600,framesOrder:[6,7,8,9,10,11,12],playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel0 .parrotCellBg.stable"),{spriteFrames:2,duration:400,framesOrder:[12,16],playRound:!1}),FigureRules.add(".episode_".concat(e," .parrot"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_shoottarget/shootTargetTask.a3019debe7.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:null}),FigureRules.add(".episode_".concat(e," .die_parrot"),{opacity:0}),FigureRules.add(".episode_".concat(e," .die_parrotDoor"),{opacity:0}),FigureRules.add(".episode_".concat(e," .die_parrotLock"),{opacity:0})}),CollectParrot.prototype.getCapitalisedBaseName=(_kc=CollectParrot.prototype.getCapitalisedBaseName,function(e){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_shoottarget"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_shoottarget"==e})?"Giftbox":_kc.call(this)}),ParrotCell.prototype.getCapitalisedBaseName=(dlc=ParrotCell.prototype.getCapitalisedBaseName,function(e){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_shoottarget"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_shoottarget"==e})?"Giftbox":dlc.call(this)}),ParrotCell.prototype.createDiv=(hlc=ParrotCell.prototype.createDiv,function(e){if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_shoottarget"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_shoottarget"==e})){var t=BaseCell.prototype.createDiv.call(this);return this.decorationVariant=RANDOM([1,2,3]),t.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),t.addClass("decoration_"+this.decorationVariant),t}return hlc.call(this)}),ParrotCell.prototype.animateTakeLife=(mlc=ParrotCell.prototype.animateTakeLife,function(e){episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_shoottarget"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_shoottarget"==e})?(application.playSound(this.getTakeLifeSound()),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel"+this.life).delay(500).queue(function(e){this.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()):mlc.call(this,e)}),ParrotCell.prototype.animateRemoval=(rlc=ParrotCell.prototype.animateRemoval,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_shoottarget"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_shoottarget"==e})))return rlc.call(this,t);var i=this;this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel0").queue(function(e){this.addClass(this.baseName+"Level0").find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e(),rlc.call(i,t)}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable")}),featuresAdder.registry("parrot_gift",function(e){FigureRules.add(".episode_".concat(e," .parrotCell.cell"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .parrotCellBg"),{"background-position-y":0,"background-width":71,"background-height":71,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_gift/gift.5500416e33.png",width:71/60*Config.cellWidth,height:71/60*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight-5}),FigureRules.add(".episode_".concat(e," .parrotLevel1 .parrotCellBg"),{"background-position-x":426}),FigureRules.add(".episode_".concat(e," .parrotLevel1 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotLevel2 .parrotCellBg"),{"background-position-x":213}),FigureRules.add(".episode_".concat(e," .parrotLevel2 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotLevel3 .parrotCellBg"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .parrotLevel3 .parrotCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotCellCage"),{opacity:0}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel2 .parrotCellBg.stable"),{spriteFrames:4,duration:300,playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel1 .parrotCellBg.stable"),{spriteFrames:3,duration:300,framesOrder:[4,5,6],playRound:!1}),FigureRules.add(".episode_".concat(e," .parrotChangeLevel0 .parrotCellBg.stable"),{spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!1}),FigureRules.add(".episode_".concat(e," .parrot"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/parrot_gift/giftTask.83b7b841f4.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:null}),FigureRules.add(".episode_".concat(e," .die_parrot"),{opacity:0}),FigureRules.add(".episode_".concat(e," .die_parrotDoor"),{opacity:0}),FigureRules.add(".episode_".concat(e," .die_parrotLock"),{opacity:0})}),CollectParrot.prototype.getCapitalisedBaseName=(ylc=CollectParrot.prototype.getCapitalisedBaseName,function(e){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_gift"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_gift"==e})?"Giftbox":ylc.call(this)}),ParrotCell.prototype.getCapitalisedBaseName=(Clc=ParrotCell.prototype.getCapitalisedBaseName,function(e){return episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_gift"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_gift"==e})?"Giftbox":Clc.call(this)}),ParrotCell.prototype.createDiv=(Glc=ParrotCell.prototype.createDiv,function(e){if(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_gift"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_gift"==e})){var t=BaseCell.prototype.createDiv.call(this);return this.decorationVariant=RANDOM([1,2,3]),t.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),t.addClass("decoration_"+this.decorationVariant),t}return Glc.call(this)}),ParrotCell.prototype.animateTakeLife=(Llc=ParrotCell.prototype.animateTakeLife,function(e){episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_gift"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_gift"==e})?(application.playSound(this.getTakeLifeSound()),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel"+this.life).delay(500).queue(function(e){this.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()):Llc.call(this,e)}),ParrotCell.prototype.animateRemoval=(Qlc=ParrotCell.prototype.animateRemoval,function(t){if(!(episode.isBonusWorld()&&Config.bonusWorld.get("features").find(function(e){return"parrot_gift"==e})||featuresAdder.commonFeatures.find(function(e){return"parrot_gift"==e})))return Qlc.call(this,t);var i=this;this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel0").queue(function(e){this.addClass(this.baseName+"Level0").find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e(),Qlc.call(i,t)}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable")}),featuresAdder.registry("pearl_frozenfish",function(e){FigureRules.add(".episode_".concat(e," .pearlCell.cell"),{"background-image":""}),FigureRules.add(".episode_".concat(e," .pearlCellBg"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fishBg.ea40aee105.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .pearlCellBg.stable"),{spriteVertical:!0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .pearlLevel1.pearlCell .pearlCellBg"),{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .pearlLevel2.pearlCell .pearlCellBg"),{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .pearlLevel3.pearlCell .pearlCellBg"),{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .pearlLevel4.pearlCell .pearlCellBg"),{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .die_pearl"),{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fishBg.ea40aee105.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .pearl"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fish.c534c01178.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .iceExplode"),{width:80/180*Config.cellWidth,height:55/180*Config.cellHeight,"background-width":80,"background-height":55,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/iceExplode.86aa3e7858.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_".concat(e," .iceExplode1.iceExplode"),{frame:0}),FigureRules.add(".episode_".concat(e," .iceExplode2.iceExplode"),{frame:1}),FigureRules.add(".episode_".concat(e," .iceExplode3.iceExplode"),{frame:2})}),figureRulesProcess.additionalBonusScaleImages=(Xlc=figureRulesProcess.additionalBonusScaleImages,function(){Xlc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fish.c534c01178.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fishBg.ea40aee105.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_frozenfish/fishTask.1ccb5ae4b2.png":_Figure.scaleKoef})}),featuresAdder.registry("pearl_comb",function(e){FigureRules.add(".episode_".concat(e," .pearlCellBg"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearlBg.9a64b2de0a.png"}),FigureRules.add(".episode_".concat(e," .pearlCellBg.stable"),{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .die_pearl"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearlBg.9a64b2de0a.png"}),FigureRules.add(".episode_".concat(e," .pearl"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearl.4261fc5710.png"}),FigureRules.add(".episode_".concat(e," .mermaidCell .lifeBlock .taskIco"),{width:20/60*Config.cellWidth,height:20/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearlTask.a1aaa5071c.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(Zlc=figureRulesProcess.additionalBonusScaleImages,function(){Zlc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearlBg.9a64b2de0a.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/pearl_comb/pearl.4261fc5710.png":Config.cellWidth/82})}),featuresAdder.registry("shooter_squirrel",function(e){FigureRules.add(".episode_".concat(e," .shooterCell"),{width:77/60*Config.cellWidth,height:77/60*Config.cellHeight,"background-width":77,"background-height":77,"margin-left":-8/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter_squirrel/squirrel.e48d582171.png","background-position-x":770}),FigureRules.add(".episode_".concat(e," .shooterCell.powerUpHighlight"),{animation:{params:{"margin-top":[-.05*Config.cellHeight,-.1*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .shooterCell.active"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .shooterCell.deactivated"),{"background-position-x":693,spriteFrames:2,duration:200,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.animateShot"),{"background-position-x":385,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.animateRemoval"),{"background-position-x":693,spriteFrames:2,duration:200,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterTask"),{width:25/60*Config.cellWidth,height:.4*Config.cellHeight,"background-width":25,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter_squirrel/nutFlying.8b775d8ab8.png",animation:{params:{"margin-top":[0*Config.cellHeight,35/60*Config.cellHeight],"margin-left":[0*Config.cellWidth,.5*Config.cellWidth]},duration:2e3}})}),featuresAdder.registry("snail_newyearsnail",function(e){FigureRules.add(".episode_".concat(e," .decorator_crabMedusa.special"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/snail_newyearsnail/snail.89dc182ffc.png","margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .move_crabMedusa.special"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/snail_newyearsnail/snail.89dc182ffc.png",startFrame:9,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_".concat(e," .move_crabMedusa.special.delay"),{"background-position-x":0,"background-position-y":0,"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/snail_newyearsnail/snail.89dc182ffc.png",spriteFrames:5,framesOrder:[5,6,7,8,9],duration:250,playRound:!1}),FigureRules.add(".episode_".concat(e," .die_crabMedusa.special"),{"background-width":94,"background-height":90,width:188/180*Config.cellWidth,height:Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/snail_newyearsnail/snail.89dc182ffc.png"}),FigureRules.add(".episode_".concat(e," .crabMedusaMovesBlock .crabMedusaMoves"),{opacity:0})}),featuresAdder.registry("shooter_mailbox",function(e){FigureRules.add(".episode_".concat(e," .shooterCell"),{width:1/60*Config.cellWidth,height:1/60*Config.cellHeight,"background-width":1,"background-height":1,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter_mailbox/emptySpace.d8e3f76e46.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,animation:null,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.active"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.deactivated"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.animateShot"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.animateRemoval"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterBg.stable"),{width:85/80*Config.cellWidth,height:2.25*Config.cellHeight,"background-width":85,"background-height":180,"margin-left":-.025*Config.cellWidth,"margin-top":-1.25*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter_mailbox/mailbox.7dfbf8a7a7.png","background-position-x":0}),FigureRules.add(".episode_".concat(e," .shooterCell.powerUpHighlight"),{animation:{params:{"margin-top":[0*Config.cellHeight,-5/80*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .shooterCell.activated .shooterBg"),{spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.active .shooterBg"),{"background-position-x":0}),FigureRules.add(".episode_".concat(e," .shooterCell.deactivated .shooterBg"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell .shooterBg.animateShot"),{"background-position-x":0,spriteFrames:14,duration:400,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterCell.animateRemoval .shooterBg"),{"background-position-x":0,spriteFrames:0,duration:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .shooterTask"),{width:108/130*Config.cellWidth,height:.6*Config.cellHeight,"background-width":108,"background-height":78,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/shooter_mailbox/mailTask.72a178f086.png",animation:{params:{"margin-top":[-100/130*Config.cellHeight,0*Config.cellHeight],"margin-left":[0*Config.cellWidth,0*Config.cellWidth]},duration:500}})}),featuresAdder.registry("spiderwebfarm2",function(e){FigureRules.add(".episode_".concat(e," .spiderwebFarm"),{"background-width":182,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderwebfarm2/spider.d31ec239f4.png"})}),figureRulesProcess.additionalBonusScaleImages=(cmc=figureRulesProcess.additionalBonusScaleImages,function(){cmc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/spiderwebfarm2/spider.d31ec239f4.png":_Figure.scaleKoef})}),featuresAdder.registry("strongbox_bearsafe",function(e){FigureRules.add(".episode_".concat(e," .strongboxCell .strongboxBg"),{"background-position-y":0,"background-width":249,"background-height":297,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_bearsafe/bearSafe.d4a9133605.png",width:249/180*Config.cellWidth,height:1.65*Config.cellHeight,"margin-left":-.2*Config.cellWidth,"margin-top":-32/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .strongboxCellLoot"),{"background-position-x":0,"background-width":243,"background-height":284,width:1.35*Config.cellWidth,height:284/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_bearsafe/bearSafeCollectItem.9a9540f548.png","margin-left":-35/180*Config.cellWidth,"margin-top":-82/180*Config.cellHeight,scale:.8})}),figureRulesProcess.additionalBonusScaleImages=(emc=figureRulesProcess.additionalBonusScaleImages,function(){emc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_bearsafe/bearSafe.d4a9133605.png":_Figure.scaleKoef})}),featuresAdder.registry("strongbox_catsafe",function(e){FigureRules.add(".episode_".concat(e," .strongboxCell .strongboxBg"),{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_catsafe/catSafe_xlarge.b0350db625.png","margin-left":-.25*Config.cellWidth,"margin-top":-115/180*Config.cellHeight,scale:.85}),FigureRules.add(".episode_".concat(e," .strongboxCell.removeStrongbox .strongboxBg.stable"),{animation:{params:{scale:[.85,1]},duration:500}}),FigureRules.add(".episode_".concat(e," .strongboxCellLoot"),{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_catsafe/catSafeCollectItem.29135bc9b6.png","margin-left":-22/180*Config.cellWidth,"margin-top":-65/180*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(gmc=figureRulesProcess.additionalBonusScaleImages,function(){gmc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_catsafe/catSafe_xlarge.b0350db625.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_catsafe/catSafeCollectItem.29135bc9b6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_catsafe/catSafeTask.0779172630.png":_Figure.scaleKoef})}),featuresAdder.registry("strongbox_candysafe",function(e){FigureRules.add(".episode_".concat(e," .strongboxCell .strongboxBg"),{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_candysafe/candySafe.0172614e06.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .strongboxCell.closed .strongboxBg.stable"),{frame:0}),FigureRules.add(".episode_".concat(e," .strongboxCell.opened .strongboxBg.stable"),{frame:5}),FigureRules.add(".episode_".concat(e," .strongboxCell.animateOpening .strongboxBg.stable"),{spriteFrames:6,duration:700}),FigureRules.add(".episode_".concat(e," .strongboxCell.animateClosing .strongboxBg.stable"),{startFrame:7,spriteFrames:4,duration:500}),FigureRules.add(".episode_".concat(e," .strongboxCell.removeStrongbox .strongboxBg.stable"),{startFrame:10,spriteFrames:10,duration:800}),FigureRules.add(".episode_".concat(e," .strongboxCellLoot"),{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_candysafe/candySafeCollectItem.f70fcb19ea.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(imc=figureRulesProcess.additionalBonusScaleImages,function(){imc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_candysafe/candySafe.0172614e06.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_candysafe/candySafeCollectItem.f70fcb19ea.png":Config.cellWidth/80})}),featuresAdder.registry("strongbox_withgems",function(e){FigureRules.add(".episode_".concat(e," .strongboxCell .strongboxBg"),{"background-position-x":0,"background-width":302,"background-height":402,width:302/180*Config.cellWidth,height:402/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_withgems/strongbox_xlarge.117e5ca401.png","margin-left":-75/180*Config.cellWidth,"margin-top":-175/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .strongboxCellLoot"),{"background-position-x":0,"background-width":232,"background-height":374,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_withgems/strongboxCollectItem.5826397d7b.png","margin-left":-40/180*Config.cellWidth,"margin-top":-110/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .strongboxCell.removeStrongbox .strongboxBg.stable"),{startFrame:10,spriteFrames:10,duration:500})}),figureRulesProcess.additionalBonusScaleImages=(kmc=figureRulesProcess.additionalBonusScaleImages,function(){kmc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_withgems/strongbox_xlarge.117e5ca401.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_withgems/strongboxCollectItem.5826397d7b.png":_Figure.scaleKoef})}),featuresAdder.registry("tortoise_plant",function(e){FigureRules.add(".episode_".concat(e," .turtleCell"),{width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-13/60*Config.cellWidth,"margin-top":-.1*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel3"),{width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel2"),{"background-position-y":132,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel1"),{"background-position-y":264,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png"}),FigureRules.add(".episode_".concat(e," .turtle"),{"background-position-y":264,width:65/60*Config.cellWidth,height:1.1*Config.cellHeight,"background-width":130,"background-height":132,"margin-left":-4/60*Config.cellWidth,"margin-top":-7/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png"}),FigureRules.add(".episode_".concat(e," .turtleCell .blink"),{opacity:0}),FigureRules.add(".episode_".concat(e," .turtleCell .zzz1, ")+".episode_".concat(e," .turtleCell .zzz2"),{opacity:"0"}),FigureAnimations["turtleDowngrade2_"+e]={params:{spriteFrames:6},duration:700},FigureAnimations["turtleUpgrade2_"+e]={params:{spriteFrames:6,framesOrder:[5,4,3,2,1,0]},duration:500}}),figureRulesProcess.additionalBonusScaleImages=(mmc=figureRulesProcess.additionalBonusScaleImages,function(){mmc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_plant/plant.9e407d78dc.png":Config.cellWidth/120})}),featuresAdder.registry("well_fishbasket",function(e){FigureRules.add(".episode_".concat(e," .wellCell"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/basket.0536d9523e.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel1"),{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel2"),{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel3"),{"background-position-x":360,"background-position-y":0,spriteFrames:2,duration:300,playRound:!1}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel4"),{"background-position-x":360,"background-position-y":0,spriteFrames:2,duration:300,playRound:!1}),FigureRules.add(".episode_".concat(e," .color_N"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/waterFish.4635be4ce8.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .color_N.waterAnimated"),{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyWater"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/waterFish.4635be4ce8.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .bugCell .mTask1 .taskIco"),{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/waterFish.4635be4ce8.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(omc=figureRulesProcess.additionalBonusScaleImages,function(){omc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/basket.0536d9523e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/well_fishbasket/waterFish.4635be4ce8.png":_Figure.scaleKoef})}),featuresAdder.registry("well_plant",function(e){FigureRules.add(".episode_".concat(e," .wellCell"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_plant/plant.ed36f5704c.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel1"),{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel2"),{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel3"),{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel4"),{"background-position-x":1620,"background-position-y":0,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .color_N"),{"background-position-x":0,"background-position-y":0,"background-width":176,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_plant/flower.420e1100f1.png",width:176/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .color_N.waterAnimated"),{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyWater"),{"background-position-x":0,"background-position-y":0,"background-width":176,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_plant/flower.420e1100f1.png",width:176/180*Config.cellWidth,height:1*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(qmc=figureRulesProcess.additionalBonusScaleImages,function(){qmc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/well_plant/flower.420e1100f1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/well_plant/plant.ed36f5704c.png":_Figure.scaleKoef})}),featuresAdder.registry("well_paint",function(e){FigureRules.add(".episode_".concat(e," .wellCell"),{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_paint/well.8b94c7a017.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel1"),{"background-position-x":80,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel2"),{"background-position-x":160,"background-position-y":0}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel3"),{"background-position-x":240,"background-position-y":0,spriteFrames:3,duration:500,delay:[1e3,4e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel4"),{"background-position-x":480,"background-position-y":0,spriteFrames:1,duration:300,playRound:!0}),FigureRules.add(".episode_".concat(e," .color_N"),{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_paint/paint.9098a368ac.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .color_N.waterAnimated"),{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyWater"),{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_paint/paint.9098a368ac.png",width:Config.cellWidth,height:Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(smc=figureRulesProcess.additionalBonusScaleImages,function(){smc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{})}),featuresAdder.registry("well_sakura",function(e){FigureRules.add(".episode_".concat(e," .wellCell"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"margin-top":-4/60*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_sakura/sakuraPlant.a39e2afb56.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel1"),{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel2"),{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel3"),{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_".concat(e," .wellCell.wellLevel4"),{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_".concat(e," .color_N"),{"background-position-x":0,"background-position-y":0,"background-width":176,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_sakura/sakuraFlower.e21c0fdf87.png",width:176/180*Config.cellWidth,height:1*Config.cellHeight,"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .color_N.waterAnimated"),{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_".concat(e," .flyWater"),{"background-position-x":0,"background-position-y":0,"background-width":176,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/well_sakura/sakuraFlower.e21c0fdf87.png",width:176/180*Config.cellWidth,height:1*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(umc=figureRulesProcess.additionalBonusScaleImages,function(){umc.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/well_sakura/flower.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/well_sakura/sakuraPlant.a39e2afb56.png":_Figure.scaleKoef})});var ABTesting=Backbone.Model.extend({getGroup:function(){return user.get("ABTestGroup")}});Application.on("beforeRun",function(){new ABTesting}),ABTesting.prototype.initialize=function(){if(user.get("ABTestGroup"))_.indexOf(["FE0EEF20E2379243","589900750367","571030816873","328299842668","540548603126","563830823563","571288881892","569423310809","583643555364","569391927009","577659618741","586040203811","589900750367"],user.get("userId"))};var NewTournament=Backbone.Model.extend({defaults:{enabled:!0,serviceUrl:!1,types:[],prizes:[],prizeSets:[],callServerTimeout:10,maxCheckTimeout:300,prizePlacesCoeff:.05,localStorageKey:"tnmt",state:!1,tournamentType:!1,startTime:0,endTime:0,cooldownTime:0,finished:!1,score:0,singlePassage:!1,upStar:!1,actionCalled:!1,actionLastCall:0,actionLastCallId:null,scoresChecked:!1},initialize:function(){if(_.each(this.get("types"),function(e){e.episodes[0]<=0&&(e.episodes[0]=Config.episodesAvailable+e.episodes[0]),e.episodes[1]<=0&&(e.episodes[1]=Config.episodesAvailable+e.episodes[1])}),this.on("init state finish new",this.set),this.on("change:tournamentType",this.detectScoreType,this),!1===this.get("serviceUrl"))throw new Error("[new tournament] no service url")},detectScoreType:function(){var e=this.get("types"),t=this.get("tournamentType"),i=_.find(e,function(e){return e.typeId==t}),o=i?i.scoreType:void 0;this.set("scoreType",o)},save:function(){setLocalStorage(this.get("localStorageKey"),_.pick(this.toJSON(),this.getStateAttibutes()))},restore:function(){var e=application.getCurrentServerTime(),t=_.pick(getLocalStorage(this.get("localStorageKey"),{endTime:0}),this.getStateAttibutes());t.endTime>e&&this.set(t)},getTournamentType:function(){var t=!user.get("paid")&&(user.get("ban")||3e3<=user.get("coins")),e=this.get("types"),i=user.get("episode"),o=_.find(e,function(e){if(e.scoreType==Config.tournament.scoreType)return!(!t||!e.isSpecial)||e.episodes[0]<=i&&e.episodes[1]>=i});return!!o&&o.typeId},getUserId:function(){return user.tournamentUserId()},getLeftTime:function(){var e=application.getCurrentServerTime();return this.get("endTime")-e},getStateAttibutes:function(){return["state","startTime","endTime","score"]},init:function(){var e=application.USERS[viewerId]||{};this.action("init",{tournamentType:this.getTournamentType(),level:user.getCurrentLevel(),name:user.get("name")||e.first_name,photo:user.get("photo")||e.photo})},inita:function(){var e=application.USERS[viewerId]||{};this.action("inita",{level:user.getCurrentLevel(),name:user.get("name")||e.first_name,photo:user.get("photo")||e.photo})},state:function(){this.action("state",{level:user.getCurrentLevel()})},finish:function(){this.action("finish")},new:function(){this.action("new",{tournamentType:this.getTournamentType(),level:user.getCurrentLevel()})},scores:function(){this.action("scores")},profiles:function(e){e.length&&this.action("profiles",{users:e.join(",")})},addscore:function(e){2==this.get("state")&&this.action("addscore",{level:user.getCurrentLevel(),score:e})},action:function(t,e){var o=_.uniqueId("tournamentActionCall"),i=e||{},a=application.getCurrentServerTime();this.set({actionLastCall:a,actionLastCallId:o}),i.action=t,i.userId=this.getUserId(),i.userTime=a,this.set("actionCalled",!0),$.ajax({url:this.get("serviceUrl"),dataType:"json",type:"POST",timeout:1e3*this.get("callServerTimeout"),data:i,success:_.bind(function(e){this.set("actionCalled",o!==this.get("actionLastCallId")),this.trigger(t,e)},this),error:_.bind(function(e,t,i){this.set("actionCalled",o!==this.get("actionLastCallId"))},this)})}},{NO_TURNAMENT:-1,FEW_PARTICIPANTS:0,PLANNED:1,RUNNING:2,FINISHED:3,RESTART:4}),TournamentUser=Backbone.Model.extend({defaults:{user_id:null,me:!1,needProfileLoad:!0,level:null,score:0,place:0,name:"",photo:"",profile:null},idAttribute:"user_id"}),TournamentScoresboard=Backbone.Collection.extend({model:TournamentUser,modelId:function(e){return e.user_id},reOrderUsers:function(){_.each(this.getScoresList(),function(e,t){var i=t+1;e.set("place",i)})},getScoresList:function(){if(0===this.length)return[];var e=this.find({me:!0}),t=this.without(e);return e&&t.unshift(e),_.sortBy(t,function(e){return 1/parseInt(e.get("score"))})},addscore:function(e,t,i){this.set({user_id:t,level:e,score:i},{add:!1,remove:!1}),this.reOrderUsers()},getUserPlace:function(e){return _.findIndex(this.getScoresList(),this.get(e))+1}}),NewTournamentView=Backbone.View.extend({events:{click:"fullInfo"},fullInfo:function(e){(this.model.get("state")<3||this.model.get("scoresChecked"))&&this.controller.openWindow()},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(e){this.stopTimer(),this.timerInterval=setInterval(_.bind(this.renderTimer,this),1e3),this.renderTimer()},renderTimer:function(){var e=this.model.get("endTime")-application.getCurrentServerTime();e<=0&&(this.stopTimer(),this.$el.removeClass("running").addClass("scoresCheck"));var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timeout").html(formatTime(t,e))},renderPlace:function(){this.$(".tournamentMyPosition").html(this.user.get("place"))},initialize:function(e){this.controller=e.controller,this.user=this.controller.getCurrentUser();var t=$(".invisible .newTournament");this.setElement(t.clone()),this.$el.addClass("tournament"),$("#"+e.page).append(this.$el),this.inited=!1,this.model.on("change:state",this.onStateChange,this),this.onStateChange(),this.model.on("change:scoresChecked",function(){2<this.model.get("state")&&(this.$el.removeClass("scoresCheck").removeClass("finished"),this.model.get("scoresChecked")?this.$el.addClass("finished"):this.$el.addClass("scoresCheck"))},this),"game"==e.page&&application.on("change:page",function(){_.defer(function(){canvas&&canvas.layer&&canvas.layer.addClass("withTournament")})}),this.user.on("change:place",this.renderPlace,this),this.renderPlace()},onStateChange:function(){this.inited||($(".wrapper").addClass("withTournament"),_.defer(function(){canvas&&canvas.layer&&canvas.layer.addClass("withTournament")}),this.inited=!0),this.$el.removeClass("beforeStart").removeClass("running").removeClass("scoresCheck").removeClass("finished"),0===this.model.get("state")&&this.$el.addClass("beforeStart"),1==this.model.get("state")&&this.$el.addClass("beforeStart"),2==this.model.get("state")&&(this.$el.addClass("running"),this.runTimer()),2<this.model.get("state")&&(this.stopTimer(),this.model.get("scoresChecked")?this.$el.addClass("finished"):this.$el.addClass("scoresCheck"))}}),TournamentWindow=TWindow.extend({templateClass:".tournamentWindow_template",onOpen:function(){this.options.havePrize=2<this.model.get("state")&&Boolean(this.options.controller.getPrizeForPlace(this.options.myPlace))&&0<this.options.controller.getMyScore(),this.options.controller.model.get("singlePassage")&&this.$el.addClass("singlePassage"),this.options.controller.model.get("upStar")&&this.$el.addClass("upStar"),this.renderPlayers(),this.runTimer(),this.renderState(),this.needPublic=!messages["tournamentPrize"+this.options.myPlace+"Image"],this.togglePublicCheckbox(),this.listenTo(this.collection,"add change",_.debounce(this.renderPlayers,1e3))},events:{"click .needPublicCheckbox":"togglePublicCheckbox","click .tournamentOver":"doPublication","click .close":"takePrize"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},doPublication:function(){if(this.needPublic&&messages["tournamentPrize"+this.options.myPlace+"Image"]){var e=messages["tournamentPrize"+this.options.myPlace+"Image"],t=RANDOM(messages.tournamentPrizeMessage),i=messages.tournamentPrizeCaption[user.get("gender")];_doPublication(sprintf(t[user.get("gender")],{place:this.options.myPlace}),e,i,void 0,_.bind(this.takePrize,this))}else this.takePrize()},takePrize:function(){2<this.model.get("state")&&this.options.controller.takePrize(),this.options.havePrize&&!this.model.get("finished")?setTimeout(_.bind(this.close,this),300):this.close()},onClose:function(){this.stopTimer()},renderState:function(){this.$el.removeClass("beforeStart").removeClass("running").removeClass("finished"),0===this.model.get("state")&&this.$el.addClass("beforeStart"),1==this.model.get("state")&&this.$el.addClass("beforeStart"),2==this.model.get("state")&&(this.$el.addClass("running"),this.runTimer()),2<this.model.get("state")&&(this.$el.addClass("finished"),this.stopTimer(),this.$el.find(".myTournamentPlace").html(this.options.myPlace),this.options.havePrize?(this.$(".playerPowerupsBlock").removeClass("invisible"),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")})):this.$el.addClass("lose")),2<this.model.get("state")?this.onPublicCheckbox():this.offPublicCheckbox()},renderPlayers:function(){var e=this.collection.getScoresList();this.$(".players").empty(),2<this.model.get("state")&&(e=this.options.controller.filterWinnersAndMe(e));for(var t=0;t<e.length;t++){var i=this.generatePlayer(e[t]);this.$(".players").append(i)}},generatePlayer:function(e){var t=this.$(".invisible .tournamentPlayer").clone();return new TournamentUserView({model:e,controller:this.options.controller,el:t}),t},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(e){this.stopTimer(),this.timerInterval=setInterval(_.bind(this.renderTimer,this),1e3),this.renderTimer()},renderTimer:function(){var e=this.model.getLeftTime();e<=0&&(e=0,2==this.model.get("state")&&_.defer(_.bind(this.close,this)));var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timer").html(formatTime(t,e))}}),TournamentUserView=Backbone.View.extend({initialize:function(e){this.controller=e.controller,this.render()},render:function(){var e=this.model.get("place"),t=this.model.previous("place"),i=this.controller.getPrizeForPlace(e);if(this.$(".name").html(this.model.get("name")),this.$(".stars").html(this.model.get("score")),this.$(".level").html(this.model.get("level")),this.$(".photo").html(makeImg(this.model.get("photo"),Config.tournamentPhotoSize)),this.$(".place").html(e),this.model.get("me")&&(this.$el.addClass("me"),_.defer(_.bind(this.scrollParentToMe,this)),0!==t&&t!==e));if(this.$(".prizes").empty(),this.$(".prizes").attr("title",""),(0<this.model.get("score")||2===this.controller.model.get("state"))&&i){var o=new UserPrizes(i);this.$el.addClass("place"+e),this.$(".prizes").addClass("prizeForPlace"+e),new UserPrizesView({model:o,el:this.$(".prizes")}),messages["newTournamentPrizeForPlace"+e]&&this.$(".prizes").attr("title",messages["newTournamentPrizeForPlace"+e])}},scrollParentToMe:function(){if(0!==this.$el.parent().length){var e=this.$el.offset(),t=this.$el.parent().offset(),i=Math.floor((this.$el.parent().height()-this.$el.height())/2),o=this.$el.parent().scrollTop();(o+=e.top-t.top-i)<0&&(o=0),this.$el.parent().animate({scrollTop:o},300)}}}),NewTournamentController=function(){this.initialize()},cqc,eqc;_.extend(NewTournamentController.prototype,{initScoresEvent:function(){user.on("recievedOrIncreasedStarsOnLevel",this.onAddScore,this)},onAddScore:function(e){var t=user.getCurrentLevel(),i=this.model.getUserId(),o=this.model.get("score")+e;2==this.model.get("state")&&(this.model.set("score",o),this.model.save(),this.model.addscore(o),this.board.addscore(t,i,o))},initialize:function(){this.model=new NewTournament(Config.tournament),this.board=new TournamentScoresboard,this.resetScores(),this.restore(),this.checkState(),(application.tournament=this).model.on("change:state",this.onStateChange,this),this.model.on("scores",function(e){this.board.set(e,{remove:!1}),this.board.reOrderUsers(),this.loadProfiles()},this),this.model.on("profiles",function(e){_.each(e,function(e){e.needProfileLoad=!1}),this.board.set(e,{remove:!1}),this.loadProfiles()},this),this.model.on("addscore",this.model.scores),this.model.on("new",this.resetScores,this),this.mainView=new NewTournamentView({model:this.model,controller:this,page:"main"}),this.gameView=new NewTournamentView({model:this.model,controller:this,page:"game"}),user.on("change:episode",function(){!1!==this.model.getTournamentType()&&this.checkState()},this),this.initScoresEvent()},checkState:function(){var e=_.bind(this.checkState,this),t=this.model.get("callServerTimeout"),i=application.getCurrentServerTime(),o=this.model.get("state");if(this.model.get("actionCalled")&&i-this.model.get("actionLastCall")<this.model.get("callServerTimeout"))return t=i-this.model.get("actionLastCall"),void setTimeout(e,1e3*t);!1!==this.model.getTournamentType()&&(o<1?t=this.model.get("callServerTimeout")/2:this.model.get("startTime")>i?t=this.model.get("startTime")-i:this.model.get("endTime")>i?t=this.model.get("endTime")-i:this.model.get("cooldownTime")>i&&(t=this.model.get("cooldownTime")-i),t>this.model.get("maxCheckTimeout")&&(t=this.model.get("maxCheckTimeout")),!1===o?this.model.init():this.model.state(),2==o&&this.model.getLeftTime()>this.model.get("callServerTimeout")&&this.model.scores(),2<o&&!this.model.get("scoresChecked")&&this.model.scores(),3<o&&this.model.get("finished")&&this.model.new(),setTimeout(e,1e3*t))},onStateChange:function(){0<this.model.get("state")&&this.model.scores(),this.model.get("state")<3&&this.model.get("scoresChecked")&&this.model.set("scoresChecked",!1),2<this.model.get("state")&&this.model.get("finished")&&this.model.set("scoresChecked",!0),2<this.model.get("state")&&!this.model.get("scoresChecked")&&this.model.once("scores",this.checkFinish,this)},checkFinish:function(){this.model.get("state")<3||this.model.get("finished")||this.model.get("scoresChecked")||(this.model.set("scoresChecked",!0),this.openWindow())},takePrize:function(){if(!this.model.get("finished")){var e=this.getMyPlace(),t=this.getPrizeForPlace(e),i=this.getMyScore();if(t&&0<i)new UserPrizes(t).take("tnmtPrizeForPlace"+e),user.trigger("tournamentfinished");this.model.finish()}},getMyPlace:function(){var e=this.model.getUserId();return this.board.getUserPlace(e)},getMyScore:function(e){return this.getCurrentUser().get("score")},loadProfiles:function(){var t=this.getMyPlace(),e=_.sortBy(this.board.where({needProfileLoad:!0}),function(e){return Math.abs(e.get("place")-t)}),i=_.map(e,function(e){return e.get("user_id")});this.model.profiles(i.slice(0,10))},openWindow:function(){this.model.get("scoresChecked")||this.model.scores(),new TournamentWindow({model:this.model,collection:this.board,controller:this,myPlace:this.getMyPlace()})},getPrizeForPlace:function(e){var t=this.model.get("prizePlacesCoeff")||.05,i=Math.floor(this.board.length*t);if(i<3&&(i=3),i>this.model.get("prizes").length&&(i=this.model.get("prizes").length),e<=i)return this.model.get("prizes")[e-1]},filterWinnersAndMe:function(e){return _.filter(e,_.bind(function(e){return e.get("me")||this.getPrizeForPlace(e.get("place"))},this))},resetScores:function(){this.board.set([{user_id:this.model.getUserId(),me:!0,needProfileLoad:!1,level:user.getCurrentLevel(),score:0,place:1,name:user.get("name"),photo:user.get("photo")}]),this.model.set("score",0)},restore:function(){this.model.restore(),2===this.model.get("state")&&this.model.get("score")&&this.model.addscore(this.model.get("score"))},getCurrentUser:function(){return this.board.get(this.model.getUserId())}}),Application.on("ready",function(){Config.tournament.activateEnabled?new ActivateTournamentController:void 0!==Tournament&&new Tournament}),_.defaults(NewTournament.prototype.defaults,{levelRunning:!1,levelCompleteEarlier:!1,levelScore:0}),NewTournament.prototype.initialize=function(){if(_.each(this.get("types"),function(e){e.episodes[0]<=0&&(e.episodes[0]=Config.episodesAvailable+e.episodes[0]),e.episodes[1]<=0&&(e.episodes[1]=Config.episodesAvailable+e.episodes[1])}),this.on("init inita state finish new",this.set),!1===this.get("serviceUrl"))throw new Error("[new tournament] no service url")},NewTournament.prototype.getTournamentType=function(){var t=!user.get("paid")&&(user.get("ban")||3e3<=user.get("coins")),e=this.get("types"),i=user.get("episode"),o=_.find(e,function(e){return!(!t||!e.isSpecial)||e.episodes[0]<=i&&e.episodes[1]>=i});return!!o&&o.typeId},Config.tournament={serviceUrl:"undefined"!=typeof newTournamentHost&&newTournamentHost,callServerTimeout:10,maxCheckTimeout:300,activateEnabled:-1!==["test","odnoklassniki","vkontakte","mailru"].indexOf(network),singlePassage:!1,upStar:!0,points:{multicolor:5,arrow:{vertical:1,horizontal:1,both:3}},types:[{typeId:1,episodes:[3,15]},{typeId:2,episodes:[16,40]},{typeId:3,episodes:[41,80]},{typeId:4,episodes:[81,100]},{typeId:5,episodes:[101,120]},{typeId:6,episodes:[121,140]},{typeId:7,episodes:[141,160]},{typeId:8,episodes:[161,180]},{typeId:9,episodes:[181,200]},{typeId:10,episodes:[201,1e4]}],prizes:[[{type:"coins",amount:1500,cssClass:"coins"}],[{type:"coins",amount:1e3,cssClass:"coins"}],[{type:"coins",amount:700,cssClass:"coins"}],[{type:"powerUp",name:"lightingPowerUp",amount:1,cssClass:"bonusWindowlightingPowerUp"}],[{type:"powerUp",name:"lightingPowerUp",amount:1,cssClass:"bonusWindowlightingPowerUp"}],[{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"bonusWindowshufflePowerUp"}],[{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"bonusWindowshufflePowerUp"}],[{type:"powerUp",name:"shufflePowerUp",amount:1,cssClass:"bonusWindowshufflePowerUp"}],[{type:"powerUp",name:"deleteCellPowerUp",amount:1,cssClass:"bonusWindowdeleteCellPowerUp"}],[{type:"powerUp",name:"deleteCellPowerUp",amount:1,cssClass:"bonusWindowdeleteCellPowerUp"}]]},NewTournamentController.prototype.initScoresEvent=function(){this.releaseScoresEvent(),user.on("createNewGame",this.onCreateNewGame,this),user.on("bonusItemCreated",this.onBonusItemCreated,this)},NewTournamentController.prototype.releaseScoresEvent=function(){user.off("createNewGame",this.onCreateNewGame,this),user.off("bonusItemCreated",this.onBonusItemCreated,this),Game.off("win",this.onGameWin,this),episode.scores.off("add",this.addPoints,this),episode.scores.off("change",this.onChangePoints,this)},NewTournamentController.prototype.onCreateNewGame=function(){user.set("tournamentPoints",0),Game.once("win",this.onGameWin,this),episode.scores.once("add",this.addPoints,this),episode.scores.once("change",this.onChangePoints,this)},NewTournamentController.prototype.onGameWin=function(){"bonus"==application.level.num&&this.addPoints()},NewTournamentController.prototype.onBonusItemCreated=function(e){var t=0;e instanceof ArrowCell&&e.dir?t=Config.tournament.points.arrow[e.dir]:e instanceof MultiColorCell&&(t=Config.tournament.points.multicolor),t&&e.$div&&2==this.model.get("state")&&(user.set("tournamentPoints",user.get("tournamentPoints")+t),user.showTournamentPoints(e.$div,t))},NewTournamentController.prototype.onChangePoints=function(e){0<e.get("stars")-e.previous("stars")&&this.addPoints()},NewTournamentController.prototype.initModel=function(){this.model=new NewTournament(Config.tournament)},NewTournamentController.prototype.initLog=function(){var e=function e(){var t=application.tournament.model,i=t.get("state"),o=application.getCurrentServerTime(),a=t.get("startTime")-o;switch(a<=0&&(a=5),i){case 0:console.log("[newTournament]     .    "+formatTime("%H:%i:%s",a)),setTimeout(e,1e3*a);break;case 1:console.log("[newTournament]    "+formatTime("%H:%i:%s",a));break;case 2:console.log("[newTournament]  .   "+formatTime("%H:%i:%s",t.get("endTime")-o));break;case 3:console.log("[newTournament]  .   "+formatTime("%H:%i:%s",t.get("cooldownTime")-o));break;case 4:console.log("[newTournament]  ")}};this.model.on("change:state",e),e()},NewTournamentController.prototype.initialize=function(){this.initModel(),this.board=new TournamentScoresboard,this.resetScores(),this.restore(),this.checkState(),(application.tournament=this).model.on("change:state",this.onStateChange,this),this.model.on("scores",function(e){this.board.set(e,{remove:!1}),this.board.reOrderUsers(),this.loadProfiles()},this),this.model.on("profiles",function(e){_.each(e,function(e){e.needProfileLoad=!1}),this.board.set(e,{remove:!1}),this.loadProfiles()},this),this.model.on("addscore",this.model.scores),this.model.on("new",this.resetScores,this),user.on("change:episode",function(){!1!==this.model.getTournamentType()&&this.checkState()},this),this.initView(),this.initScoresEvent()},NewTournamentController.prototype.releaseView=function(){this.mainView&&(this.mainView.stopTimer(),this.mainView.remove()),this.gameView&&(this.gameView.stopTimer(),this.gameView.remove())},NewTournamentController.prototype.initView=function(){this.releaseView(),this.mainView=new NewTournamentView({model:this.model,controller:this,page:"main"}),this.gameView=new NewTournamentView({model:this.model,controller:this,page:"game"})},NewTournamentController.prototype.openWindow=function(){for(var e=!1,t=application.windows.views,i=0;i<t.length;i++)if(window instanceof TournamentWindow){e=!0;break}e||new TournamentWindow({model:this.model,collection:this.board,controller:this,myPlace:this.getMyPlace()})},User.prototype.showTournamentPoints=function(e,t){var i=!(!application.tournament||!application.tournament.model)&&application.tournament.model;if(i&&i.get("state")==NewTournament.RUNNING&&user.get("tournamentPoints")){var o=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(o),o.alignTo(e);var a={opacity:0,dy:-Config.cellHeight/1.5};o.addClass("tournamentPoints").addClass("points"+t).ourAnimate(a,1500,"linear",function(){o.remove()})}},TournamentUserView.prototype.render=(TournamentUserView.prototype.render,function(){var e=this.model.get("place"),t=this.controller.getPrizeForPlace(e);if(this.$(".name").html(this.model.get("name")),this.$(".stars").html(this.model.get("score")),this.$(".level").html(this.model.get("level")),this.$(".photo").html(makeImg(this.model.get("photo"),Config.tournamentPhotoSize)),this.$(".place").html(e),this.model.get("me")&&(this.$el.addClass("me"),_.defer(_.bind(this.scrollParentToMe,this))),this.$(".prizes").empty(),this.$(".prizes").attr("title",""),0<this.model.get("score")&&t||this.controller.model.get("state")<3){var i=new UserPrizes(t);this.$el.addClass("place"+e),this.$(".prizes").addClass("prizeForPlace"+e),new UserPrizesView({model:i,el:this.$(".prizes")}),messages["newTournamentPrizeForPlace"+e]&&this.$(".prizes").attr("title",messages["newTournamentPrizeForPlace"+e])}}),OutOfMovesWindow.prototype.onOpen=(cqc=OutOfMovesWindow.prototype.onOpen,function(){cqc.call(this)}),StatisticAfterWindow.prototype.onOpen=(eqc=StatisticAfterWindow.prototype.onOpen,function(){eqc.call(this)});var ActivateTournament=NewTournament.extend({defaults:function(){return _.extend(NewTournament.prototype.defaults,{state:void 0,fromRunningToFinished:!1,fromRestartToActivate:!1,activateScore:0,activateSuccessScore:30,activateDuration:3600,activateCooldown:28800})},getStateAttibutes:function(){return["activateDuration","activateCooldown","activateScore","state","startTime","endTime","score"]},restore:function(){var e=_.pick(getLocalStorage(this.get("localStorageKey"),{endTime:0}),this.getStateAttibutes());this.set(e)},finishActivation:function(){this.set("levelScore",0),this.set("startTime",0),this.set("endTime",0),this.set("state",ActivateTournament.ACTIVATE_FINISHED),this.save()},runActivation:function(e){var t=application.getCurrentServerTime();this.set("finished",!1),this.set("fromRunningToFinished",!1),this.set("fromRestartToActivate",!1),this.set("activateScore",0),this.set("score",0),this.set("levelScore",0),this.set("startTime",t),this.set("endTime",e||t+this.get("activateDuration")),this.set("state",ActivateTournament.ACTIVATE_RUNNING),this.save()},runActivationCooldown:function(){var e=application.getCurrentServerTime();this.set("finished",!1),this.set("fromRunningToFinished",!1),this.set("fromRestartToActivate",!1),this.set("activateScore",0),this.set("score",0),this.set("levelScore",0),this.set("startTime",e),this.set("endTime",e+this.get("activateCooldown")),this.set("state",ActivateTournament.ACTIVATE_COOLDOWN),this.save()},stopActivation:function(){this.set("score",0),this.save()}},{ACTIVATE_RUNNING:-2,ACTIVATE_FINISHED:-3,ACTIVATE_COOLDOWN:-4}),ActivateTournamentWindow=TWindow.extend({templateClass:".newTournamentActivationWindow_template",events:{"click .close":"close","click .playBtn":"activate"},onOpen:function(){var n=application.tournament;if(n&&n.model.get("activateEnabled")){var e=function(e,t){var i=n.model.get("state"),o=episode.scores.findWhere({level:e}),a=!!o&&(o&&3<=o.get("stars"));i==ActivateTournament.ACTIVATE_RUNNING?(this.$(".rockets").html(this.options.model.get("activateSuccessScore")-this.options.model.get("activateScore")),!a&&t?this.$(".playBtn").text(messages.playGame):this.$(".playBtn").text(messages.ForceButtonTexts.Okay),n.model.on("change:state",function(){var e=application.tournament.model.get("state");e==ActivateTournament.ACTIVATE_RUNNING&&e==ActivateTournament.ACTIVATE_FINISHED||this.close()},this)):(this.$(".rockets").html("0"),!a&&t?this.$(".playBtn").text(messages.playGame):this.$(".playBtn").text(messages.ForceButtonTexts.Okay),n.model.on("change:state",function(){var e=application.tournament.model.get("state");e==ActivateTournament.FINISHED&&e==ActivateTournament.RESTART||this.close()},this))};n.model.get("singlePassage")&&this.$el.addClass("singlePassage"),n.model.get("upStar")&&this.$el.addClass("upStar");var t=user.get("level"),i=!0;episode.isBonusWorld()?(t>episode.levelsInEpisode()&&(i=!1),t>Config.bonusWorld.getCurrentLevel()&&(i=!1),Config.bonusWorld.levelCheckAvailable&&(Config.bonusWorld.levelCheckAvailable(t,e.bind(this,t)),i=!1)):(t>episode.levelsInEpisode()&&(i=!1),(episode.get("num")>user.get("episode")||episode.get("num")==user.get("episode")&&t>user.get("level"))&&(i=!1)),e.call(this,t,i)}this.runTimer()},onClose:function(){this.stopTimer()},activate:function(){if(this.close(),"main"==application.get("page")){var e=function(e){var t=episode.scores.findWhere({level:e});!!t&&(t&&3<=t.get("stars"))||gameView.start(e)},t=user.get("level");if(episode.isBonusWorld()){if(t>episode.levelsInEpisode())return!1;if(t>Config.bonusWorld.getCurrentLevel())return!1;if(Config.bonusWorld.levelCheckAvailable)return Config.bonusWorld.levelCheckAvailable(t,e.bind(this,t)),!1}else{if(t>episode.levelsInEpisode())return!1;if(episode.get("num")>user.get("episode")||episode.get("num")==user.get("episode")&&t>user.get("level"))return!1}e.call(this,t)}},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(e){this.stopTimer(),this.timerInterval=setInterval(_.bind(this.renderTimer,this),1e3),this.renderTimer()},renderTimer:function(){var e=this.model.getLeftTime();e<=0&&(e=0,2==this.model.get("state")&&_.defer(_.bind(this.close,this)));var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timer").html(formatTime(t,e))}}),ActivateTournamentHelpWindow=TWindow.extend({templateClass:".tournamentWindow_template",events:{"click .close":"close","click .playBtn":"activate"},onOpen:function(){this.$el.removeClass("beforeStart").removeClass("running").removeClass("finished"),this.$el.addClass("beforeStart"),this.options.controller.model.get("singlePassage")&&this.$el.addClass("singlePassage"),this.options.controller.model.get("upStar")&&this.$el.addClass("upStar"),this.runTimer()},onClose:function(){this.stopTimer(),this.trigger("close")},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(e){this.stopTimer(),this.timerInterval=setInterval(_.bind(this.renderTimer,this),1e3),this.renderTimer()},renderTimer:function(){var e=this.model.getLeftTime();e<=0&&(e=0,2==this.model.get("state")&&_.defer(_.bind(this.close,this)));var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timer").html(formatTime(t,e))}}),ActivateTournamentPrizeWindow=TWindow.extend({templateClass:".newTournamentActivationPrizeWindow_template",events:{"click .close":"close","click .oneAltBtn":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$(".amount").html(application.tournament.model.get("activateSuccessScore"))}}),ActivateTournamentView=NewTournamentView.extend({initialize:function(e){NewTournamentView.prototype.initialize.call(this,e),this.model.on("change:score",this.onScoreChange,this),this.model.on("change:levelScore",this.onLevelScoreChange,this),this.model.on("change:levelCompleteEarlier",this.onStateChange,this),this.model.on("change:levelRunning",this.onStateChange,this),this.model.on("change:fromRunningToFinished",this.onFromRunningToFinishedChange,this),this.model.on("change:scoresChecked",this.onStateChange,this),application.on("change:page",function(e,t){this.onLevelScoreChange(),this.onStateChange()}.bind(this)),this.onLevelScoreChange(),this.onStateChange()},fullInfo:function(e){this.model.get("state")==ActivateTournament.ACTIVATE_RUNNING?this.controller.openActivateWindow():this.controller.openWindow()},renderTimer:function(){var e=this.model.get("endTime")-application.getCurrentServerTime();e<=0&&this.stopTimer();var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timeout").html(formatTime(t,e))},renderActivationTime:function(){var e=this.model.get("endTime")-application.getCurrentServerTime();e<=0&&this.stopTimer();var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timeout").html(formatTime(t,e))},renderPlace:function(){this.model.get("state")>=ActivateTournament.RUNNING&&"main"==application.get("page")&&NewTournamentView.prototype.renderPlace.call(this)},onLevelScoreChange:function(){"game"==application.get("page")&&this.$(".tournamentMyPosition").text(this.model.get("levelScore"))},onScoreChange:function(){this.model.get("state")>=ActivateTournament.ACTIVATE_RUNNING&&this.model.get("state")<ActivateTournament.RUNNING&&this.$(".tournamentMyPosition").text(this.model.get("activateScore"))},onFromRunningToFinishedChange:function(){this.model.get("state")===ActivateTournament.RUNNING&&this.model.getLeftTime()<=0&&this.onStateChange()},onStateChange:function(){this.inited||($(".wrapper").addClass("withTournament"),_.defer(function(){canvas&&canvas.layer&&canvas.layer.addClass("withTournament")}),this.inited=!0),this.$el.removeClass("beforeStart").removeClass("running").removeClass("activate").removeClass("scoresCheck").removeClass("finished").removeClass("candy").removeClass("search"),this.$el.addClass("invisible");var e=this.model.get("state");e!=ActivateTournament.ACTIVATE_RUNNING||this.model.get("levelCompleteEarlier")?e==ActivateTournament.NO_TURNAMENT||e==ActivateTournament.PLANNED||e==ActivateTournament.FEW_PARTICIPANTS?this.model.get("levelCompleteEarlier")||(this.stopTimer(),this.$el.removeClass("invisible"),this.$el.addClass("running"),"main"==application.get("page")&&this.$el.addClass("search"),this.onScoreChange(),this.onLevelScoreChange()):e==ActivateTournament.RUNNING&&!this.model.get("levelCompleteEarlier")&&0<this.model.getLeftTime()?(this.stopTimer(),this.$el.removeClass("invisible"),this.$el.addClass("running"),"main"==application.get("page")&&(this.$el.addClass("activate"),this.runTimer()),this.onScoreChange(),this.onLevelScoreChange()):e>ActivateTournament.FINISHED&&!this.model.get("levelCompleteEarlier")&&!this.model.get("scoresChecked")&&(this.stopTimer(),this.$el.removeClass("invisible"),this.model.get("scoresChecked")?this.$el.addClass("finished"):this.$el.addClass("scoresCheck")):(this.$el.removeClass("invisible"),this.$el.addClass("candy"),this.$el.addClass("running"),"main"==application.get("page")&&this.$el.addClass("activate"),this.runTimer(this.renderActivationTime),this.onScoreChange(),this.onLevelScoreChange()),this.renderPlace()}}),ActivateTournamentController=function(){this.initialize()},fsc,usc,vsc,ysc,zsc,Gsc,Psc;ActivateTournamentController.prototype=Object.create(NewTournamentController.prototype),ActivateTournamentController.prototype.constructor=ActivateTournamentController,ActivateTournamentController.prototype.initLog=function(){this.model.on("change:state",function e(){var t=application.tournament.model,i=t.get("state"),o=application.getCurrentServerTime(),a=t.get("startTime")-o;switch(a<=0&&(a=5),i){case ActivateTournament.ACTIVATE_RUNNING:console.log("[ActivateTournament]    .   "+formatTime("%H:%i:%s",t.get("endTime")-o));break;case ActivateTournament.ACTIVATE_COOLDOWN:console.log("[ActivateTournament]    .   "+formatTime("%H:%i:%s",t.get("endTime")-o));break;case ActivateTournament.NO_TURNAMENT:console.log("[ActivateTournament]   ");break;case ActivateTournament.FEW_PARTICIPANTS:console.log("[ActivateTournament]     .    "+formatTime("%H:%i:%s",a)),setTimeout(e,1e3*a);break;case ActivateTournament.PLANNED:console.log("[ActivateTournament]    "+formatTime("%H:%i:%s",a));break;case ActivateTournament.RUNNING:console.log("[ActivateTournament]  .   "+formatTime("%H:%i:%s",t.get("endTime")-o));break;case ActivateTournament.FINISHED:console.log("[ActivateTournament]  .   "+formatTime("%H:%i:%s",t.get("cooldownTime")-o));break;case ActivateTournament.RESTART:console.log("[ActivateTournament]  ")}})},ActivateTournamentController.prototype.initModel=function(){this.model=new ActivateTournament(Config.tournament)},ActivateTournamentController.prototype.initView=function(){this.releaseView(),this.mainView=new ActivateTournamentView({model:this.model,controller:this,page:"main"}),this.gameView=new ActivateTournamentView({model:this.model,controller:this,page:"game"})},ActivateTournamentController.prototype.initScoresEvent=function(){this.releaseScoresEvent(),user.on("createNewGame",this.onCreateNewGame,this)},ActivateTournamentController.prototype.releaseScoresEvent=function(){user.off("createNewGame",this.onCreateNewGame,this)},ActivateTournamentController.prototype.onCreateNewGame=function(){if(episode.isEpisodeOrFreeEpisode()&&"bonus"!=application.level.num)if(this.model.get("state")>=ActivateTournament.ACTIVATE_RUNNING&&this.model.get("state")<=ActivateTournament.RUNNING){var e=episode.scores.findWhere({level:application.level.num}),t=!1,i=0;e&&(i=e.get("stars"),this.model.get("singlePassage")&&0<e.get("score")?t=!0:3<=i&&(t=!0)),t||user.on("bonusItemCreated",this.onBonusItemCreated,this),application.once("game_win",this.onGameSuccess,this),application.once("game_fail",this.onGameFailed,this),this.model.set("oldStar",i),this.model.set("levelScore",0),this.model.set("levelCompleteEarlier",t),this.model.set("levelRunning",!0),this.model.set("levelSuccessOrFail",!1)}else application.once("game_win",this.onGameFailed,this),application.once("game_fail",this.onGameFailed,this),this.model.set("levelScore",0),this.model.set("levelCompleteEarlier",!1),this.model.set("levelRunning",!0),this.model.set("levelSuccessOrFail",!1);else this.model.set("levelScore",0),this.model.set("levelCompleteEarlier",!0),this.model.set("levelRunning",!0),this.model.set("levelSuccessOrFail",!1)},ActivateTournamentController.prototype.onBonusItemCreated=function(e){var t=0;e instanceof ArrowCell&&e.dir?t=Config.tournament.points.arrow[e.dir]:e instanceof MultiColorCell&&(t=Config.tournament.points.multicolor),this.model.get("state")>=ActivateTournament.ACTIVATE_RUNNING&&this.model.get("state")<=ActivateTournament.RUNNING&&(this.model.set("levelScore",this.model.get("levelScore")+t),user.showTournamentPoints(e.$div,t))},ActivateTournamentController.prototype.onGameSuccess=function(){if(!this.model.get("levelSuccessOrFail")){if(user.off("bonusItemCreated",this.onBonusItemCreated,this),this.model.get("upStar")){var e=episode.scores.findWhere({level:application.level.num});this.model.get("oldStar")>=e.get("stars")&&this.model.set("levelCompleteEarlier",!0)}if(!this.model.get("levelCompleteEarlier")){var t=[ActivateTournament.ACTIVATE_RUNNING,ActivateTournament.NO_TURNAMENT,ActivateTournament.PLANNED,ActivateTournament.FEW_PARTICIPANTS],i=this.model.get("state"),o=this.model.get("levelScore");-1<t.indexOf(i)?(this.model.set("activateScore",this.model.get("activateScore")+o),this.model.save()):this.onAddScore(o)}application.waitPageAndRun("main",function(){this.model.set("levelScore",0),this.model.set("levelRunning",!1),this.model.set("levelCompleteEarlier",!1),this.checkFinishActivation(),this.checkState()}.bind(this)),this.model.set("levelSuccessOrFail",!0)}},ActivateTournamentController.prototype.onGameFailed=function(){this.model.get("levelSuccessOrFail")||(user.off("bonusItemCreated",this.onBonusItemCreated,this),application.waitPageAndRun("main",function(){this.model.set("levelScore",0),this.model.set("levelRunning",!1),this.model.set("levelCompleteEarlier",!1)}.bind(this)),this.model.set("levelSuccessOrFail",!0))},ActivateTournamentController.prototype.sendActivateScore=function(){var e=this.model.get("activateScore");this.model.set("activateScore",0),this.model.save(),this.onAddScore(e)},ActivateTournamentController.prototype.takePrizeForActivate=function(){goods.goodBuyed("unlimitedLifes",.5),new ActivateTournamentPrizeWindow},ActivateTournamentController.prototype.checkFinishActivation=function(){return this.model.get("state")==ActivateTournament.ACTIVATE_RUNNING&&this.model.get("activateScore")>=this.model.get("activateSuccessScore")&&(this.model.finishActivation(),this.takePrizeForActivate(),this.checkState(),!0)},ActivateTournamentController.prototype.checkState=function(){var e=_.bind(this.checkState,this),t=this.model.get("callServerTimeout"),i=this.model.get("callServerTimeout")/2,o=application.getCurrentServerTime(),a=this.model.get("state");if(this.model.get("actionCalled")&&o-this.model.get("actionLastCall")<this.model.get("callServerTimeout"))return t=o-this.model.get("actionLastCall"),void setTimeout(e,1e3*t);t=i,!1!==this.model.getTournamentType()&&(void 0===a?this.model.inita():a===ActivateTournament.ACTIVATE_RUNNING?"main"===application.get("page")&&(this.checkFinishActivation()?this.checkState():!1===this.model.get("levelRunning")&&this.model.get("endTime")<=o&&(this.model.runActivationCooldown(),t=this.model.get("endTime")-o)):a===ActivateTournament.ACTIVATE_FINISHED?(this.model.set("state",ActivateTournament.NO_TURNAMENT),this.model.save(),this.model.new()):a===ActivateTournament.ACTIVATE_COOLDOWN?!1===this.model.get("levelRunning")&&this.model.get("endTime")<=o&&(this.model.runActivation(),this.openActivateWindow(),t=this.model.get("endTime")-o):a===ActivateTournament.FEW_PARTICIPANTS?this.model.state():a===ActivateTournament.RUNNING?(0<this.model.get("activateScore")&&this.sendActivateScore(),this.model.getLeftTime()>this.model.get("callServerTimeout")?this.model.scores():this.model.getLeftTime()<=0&&(this.model.get("levelRunning")?this.model.get("fromRunningToFinished")||(this.model.set("fromRunningToFinished",!0),application.waitPageAndRun("main",function(){this.model.set("fromRunningToFinished",!1),this.model.state()}.bind(this))):this.model.state())):a>=ActivateTournament.FINISHED&&!this.model.get("scoresChecked")?this.model.scores():a>=ActivateTournament.RESTART&&this.model.get("finished")?this.model.get("levelRunning")?this.model.get("fromRestartToActivate")||(this.model.set("fromRestartToActivate",!0),application.waitPageAndRun("main",function(){this.model.set("fromRestartToActivate",!1),this.model.runActivation(),this.openActivateWindow()}.bind(this))):(this.model.runActivation(),this.openActivateWindow()):this.model.state(),a===ActivateTournament.FEW_PARTICIPANTS?t=this.model.get("callServerTimeout")/2:this.model.get("startTime")>o?t=this.model.get("startTime")-o:this.model.get("endTime")>o?t=this.model.get("endTime")-o:this.model.get("cooldownTime")>o&&(t=this.model.get("cooldownTime")-o),t>this.model.get("maxCheckTimeout")&&(t=this.model.get("maxCheckTimeout")),setTimeout(e,1e3*t))},ActivateTournamentController.prototype.checkFinish=function(){this.model.get("state")<=NewTournament.RUNNING||this.model.get("finished")||this.model.get("scoresChecked")||this.model.get("levelRunning")||(0<this.model.get("activateScore")&&this.board.addscore(user.getCurrentLevel(),this.model.getUserId(),this.model.get("activateScore")),this.model.set("scoresChecked",!0),this.openWindow())},ActivateTournamentController.prototype.onStateChange=(NewTournamentController.prototype.onStateChange,function(){var e=this.model.get("state");e===ActivateTournament.ACTIVATE_RUNNING&&("main"===application.get("page")?this.checkState():application.waitPageAndRun("main",function(){this.checkState()}.bind(this))),e>=ActivateTournament.PLANNED&&this.model.scores(),e<=ActivateTournament.RUNNING&&this.model.get("scoresChecked")&&this.model.set("scoresChecked",!1),e>=ActivateTournament.FINISHED&&this.model.get("finished")&&this.model.set("scoresChecked",!0),e>=ActivateTournament.FINISHED&&!this.model.get("scoresChecked")&&this.model.once("scores",this.checkFinish,this),e===ActivateTournament.ACTIVATE_FINISHED&&(this.model.set("state",ActivateTournament.NO_TURNAMENT),this.model.save(),this.model.new()),e===ActivateTournament.FEW_PARTICIPANTS&&this.model.state(),e===ActivateTournament.RUNNING?(0<this.model.get("activateScore")&&this.sendActivateScore(),this.model.getLeftTime()>this.model.get("callServerTimeout")?this.model.scores():this.model.getLeftTime()<=0&&this.model.state()):e>=ActivateTournament.FINISHED&&!this.model.get("scoresChecked")?this.model.scores():e>=ActivateTournament.RESTART&&this.model.get("finished")&&(this.model.get("levelRunning")?this.model.get("fromRestartToActivate")||(this.model.set("fromRestartToActivate",!0),application.waitPageAndRun("main",function(){this.model.set("fromRestartToActivate",!1),this.model.runActivation(),this.openActivateWindow(),this.checkState()}.bind(this))):(this.model.runActivation(),this.openActivateWindow(),this.checkState()))}),ActivateTournamentController.prototype.openActivateWindow=function(){for(var e=!1,t=application.windows.views,i=0;i<t.length;i++)if(window instanceof ActivateTournamentWindow){e=!0;break}e||new ActivateTournamentWindow({model:this.model,collection:this.board,controller:this,myPlace:this.getMyPlace()})},ActivateTournamentController.prototype.getPrizeForPlace=function(e){var t=this.model.get("prizePlacesCoeff")||.05,i=Math.floor(this.board.length*t);if(i<10&&(i=10),i>this.model.get("prizes").length&&(i=this.model.get("prizes").length),e<=i)return this.model.get("prizes")[e-1]},ActivateTournamentController.prototype.getMyScore=function(){var e=this.getCurrentUser();return e?e.get("score"):0},User.prototype.showTournamentPoints=function(e,t){var i=!(!application.tournament||!application.tournament.model)&&application.tournament.model;if(i){var o=i.get("state");if(-1<[ActivateTournament.ACTIVATE_RUNNING,ActivateTournament.ACTIVATE_FINISHED,ActivateTournament.NO_TURNAMENT,ActivateTournament.PLANNED,ActivateTournament.FEW_PARTICIPANTS,ActivateTournament.RUNNING].indexOf(o)&&!i.get("levelCompleteEarlier")){var a=FigureView.createByTemplate(".invisible .emptyTemplate");_Figure.blockedAnimations.append(a),a.alignTo(e);var n={opacity:0,dy:-Config.cellHeight/1.5};a.addClass("tournamentPoints").addClass("points"+t).ourAnimate(n,1500,"linear",function(){a.remove()})}}},OutOfMovesWindow.prototype.onOpen=(fsc=OutOfMovesWindow.prototype.onOpen,function(){if(fsc.call(this),application.tournament&&application.tournament.model){var e=application.tournament;if(e.model.get("activateEnabled")){var t=e.model.get("state"),i=e.model.get("levelRunning"),o=e.model.get("levelScore");-1<[ActivateTournament.ACTIVATE_RUNNING,ActivateTournament.ACTIVATE_FINISHED,ActivateTournament.NO_TURNAMENT,ActivateTournament.PLANNED,ActivateTournament.FEW_PARTICIPANTS,ActivateTournament.RUNNING].indexOf(t)&&i&&0<o&&(this.$el.removeClass("outOfMovesSpecialPrize").removeClass(Config.outOfMovesPrize),this.$el.addClass("tournamentRunning"),setTimeout(function(){this.$el.find(".tournamentPoints").html(e.model.get("levelScore"))}.bind(this),200))}}}),OutOfMovesWindow.prototype.onBuyMoves=(OutOfMovesWindow.prototype.onBuyMoves,function(e,t){if(Game.set({moves:new ObscureNumber(e),fullRunning:!0,buyedMoves:Game.get("buyedMoves")+t}),Game.trigger("addMoves"),application.playSound("buyMoves"),episode.isEpisodeOrFreeEpisode()&&Config.outOfMovesPrize&&2==Game.get("buyedMoves"))if("starInField"==Config.outOfMovesPrize)gameView.processStarInField(!0);else{var i=!0;if(application.tournament&&application.tournament.model){var o=application.tournament;if(o.model.get("activateEnabled")){var a=o.model.get("state"),n=o.model.get("levelRunning"),r=o.model.get("levelScore");-1<[ActivateTournament.ACTIVATE_RUNNING,ActivateTournament.ACTIVATE_FINISHED,ActivateTournament.NO_TURNAMENT,ActivateTournament.PLANNED,ActivateTournament.FEW_PARTICIPANTS,ActivateTournament.RUNNING].indexOf(a)&&n&&0<r&&(i=!1)}}i&&(user.setPowerUpAmount(Config.outOfMovesPrize,user.getPowerUpAmount(Config.outOfMovesPrize)+1,!0),user.set({powerUps:user.calcPowerUps()}))}}),StatisticAfterWindow.prototype.onOpen=(usc=StatisticAfterWindow.prototype.onOpen,vsc=function(){if(usc.call(this),application.tournament&&application.tournament.model){var e=application.tournament;e.model.get("activateEnabled")&&(e.model.get("state")!=ActivateTournament.ACTIVATE_RUNNING&&e.model.get("state")!=ActivateTournament.ACTIVATE_FINISHED||e.model.get("levelScore")+e.model.get("activateScore")>=e.model.get("activateSuccessScore")&&this.$(".nextLevelStatistic").on("click",function(){application.set("page","main")}.bind(this)),e.model.get("state")==ActivateTournament.RUNNING&&e.model.getLeftTime()<=0&&this.$(".nextLevelStatistic").on("click",function(){application.set("page","main")}.bind(this)))}},vsc.base=usc,vsc),AreYouSureExitWindow.prototype.onOpen=(ysc=AreYouSureExitWindow.prototype.onOpen,zsc=function(){if(ysc.call(this),application.tournament&&application.tournament.model){var e=application.tournament;if(e.model.get("activateEnabled")){var t=e.model.get("levelRunning"),i=e.model.get("levelScore"),o=e.model.get("state");-1<[ActivateTournament.ACTIVATE_RUNNING,ActivateTournament.NO_TURNAMENT,ActivateTournament.PLANNED,ActivateTournament.FEW_PARTICIPANTS,ActivateTournament.RUNNING].indexOf(o)&&t&&0<i&&(this.$el.addClass("tournamentRunning"),this.$(".amount").text(i))}}},zsc.base=ysc,zsc),TournamentWindow.prototype.renderState=(Gsc=TournamentWindow.prototype.renderState,function(){if(Gsc.call(this),this.$el.removeClass("lose"),this.$el.removeClass("win"),this.model.get("state"==ActivateTournament.NO_TURNAMENT||this.model.get("state")==ActivateTournament.PLANNED||this.model.get("state")==ActivateTournament.FEW_PARTICIPANTS))this.$el.removeClass("beforeStart").removeClass("running").removeClass("finished"),this.$el.addClass("running"),this.runTimer();else if(this.model.get("state")==ActivateTournament.RUNNING)this.$(".helpBtn").on("click",function(){this.close(),new ActivateTournamentHelpWindow({model:this.options.model,collection:this.options.collection,controller:this.options.controller,myPlace:this.options.myPlace}).on("close",function(){new TournamentWindow({model:this.options.model,collection:this.options.collection,controller:this.options.controller,myPlace:this.options.myPlace})}.bind(this))}.bind(this));else if(this.model.get("state")==ActivateTournament.FINISHED||this.model.get("state")==ActivateTournament.RESTART){var e=this.options.controller.getMyPlace(),t=this.options.controller.getPrizeForPlace(e);t&&0<t.length?(this.$el.addClass("win"),this.$el.removeClass("lose"),this.$(".myTournamentPlace").text(e)):(this.$el.addClass("lose"),this.$el.removeClass("win")),this.$(".cornerRightTop").find(".close").css("visibility","hidden"),this.$(".needPublicBlock").css("visibility",10<e?"hidden":"visible")}}),TournamentWindow.prototype.events={"click .needPublicCheckbox":"togglePublicCheckbox","click .tournamentOver":"doPublication","click .close":"close"},TournamentWindow.prototype.doPublication=function(){if(this.needPublic){var e=this.options.controller.getMyPlace(),t=e<=3?messages["tournamentPrize"+e+"Image"]:messages.tournamentPrize4_10Image,i=RANDOM(messages.tournamentPrizeMessage),o=messages.tournamentPrizeCaption[user.get("gender")];_doPublication(sprintf(i[user.get("gender")],{place:e}),t,o,void 0,_.bind(this.takePrize,this))}else this.takePrize()},TournamentWindow.prototype.close=(Psc=TournamentWindow.prototype.close,function(){Psc.call(this),this.trigger("close")});var Gifts=Backbone.Model.extend({defaults:{canSendSelf:!0,canSendNotInApp:!0,available:!1},calcUsersForGifts:function(){var e;e=this.get("canSendNotInApp")?_.clone(allFriendsIds):_.clone(friendsInAppIds),this.get("canSendSelf")&&e.unshift(user.get("userId")),this.set("usersForGifts",e)},addProductListener:function(e,t){void 0===this.buyQueue[prices[e].product]&&(this.buyQueue[prices[e].product]=[]),this.buyQueue[prices[e].product].push({userId:t,transactionId:Math.floor(1e6*Math.random())})},processOrder:function(e,t){if(e.userId==user.get("userId")?(Gifts.receiveGift(t),"sticker"==t.type&&new GiftSendedWindow({gift:t,userId:e.userId,firstPriority:!0})):("odgifts"!=t.buyType&&new GiftSendedWindow({gift:t,userId:e.userId,firstPriority:!0}),callServiceAddInQueue("../../../base/src/services/addgiftmessage.php",{uid:t.uid,friend:e.userId,transactionId:e.transactionId})),"free"==t.buyType){t.buyType="coins";var i=getLocalStorage("freeGifts",{});i[t.id]=!0,setLocalStorage("freeGifts",i)}user.set({actionName:!1,actionEpisode:!1,actionLevel:!1,actionPrice:!1},{notSave:!0}),user.set({actionName:"$g:"+t.id,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:Number(t.price)||0})},processCoinsGift:function(e,t){var i=Gifts.findGiftById(e);this.processOrder({userId:t,transactionId:Math.floor(1e6*Math.random())},i)},initialize:function(){this.buyQueue={};var t=getLocalStorage("freeGifts",{});Gifts.forEach(function(e){"free"==e.buyType&&t[e.id]&&(e.buyType="coins")}),this.calcUsersForGifts(),0<this.get("usersForGifts").length&&(this.listeners={},user.on("buyProduct",function(e){if("gift"==e.type&&this.buyQueue[e.product]&&this.buyQueue[e.product].length){var t=!1;for(var i in prices)if(prices[i].product==e.product){t=i;break}var o=Gifts.findGiftById(t);if(!1!==o){var a=this.buyQueue[e.product].pop();this.processOrder(a,o)}}},this),socialNetwork.on("success_odGiftPayment",function(e){var t=Gifts.findGiftByOdGiftId(e.giftId);if(!1!==t){var i=Math.floor(1e6*Math.random());callServiceAddInQueue("../../../base/src/services/buyodgift.php",{giftId:t.odGiftId,payed:t.odGiftPrice,giftTo:e.userId,transactionId:i}),this.processOrder({userId:e.userId,transactionId:i},t)}},this),this.controls=[],this.giftsView=new GiftsView({model:this}),this.set("available",!0))},findDivId:function(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t].div==e)return t;return!1},getStickerGifts:function(e){var t=0;e==user.get("userId")?t=user.get("gifts"):friends.get(e)&&(t=friends.get(e).get("gifts"));for(var i=[];0<t;){var o=Gifts.findGiftByUid(t%100);if(!1!==o){for(var a=!1,n=0;n<i.length;n++)if(i[n].id==o.id){a=!0;break}a||i.push(o)}t=Math.floor(t/100)}return i},addDiv:function(e,t){!1===this.findDivId(e)&&(this.controls.push({div:e,userId:t}),this.trigger("divAdded",e,t))},refreshUserStrickerGifts:function(){for(var e=0;e<this.controls.length;e++)this.controls[e].userId==user.get("userId")&&this.trigger("renderGifts",this.controls[e].div,this.controls[e].userId)},removeDiv:function(e){var t=this.findDivId(e);if(!1!==t){for(var i=this.controls[t].userId,o=t;o<this.controls.length-1;o++)this.controls[o]=this.controls[o+1];this.trigger("divRemoved",e,i)}}},{findGift:function(e,t){for(var i=0;i<Config.gifts.blocks.length;i++)for(var o=0;o<Config.gifts.blocks[i].gifts.length;o++)if(Config.gifts.blocks[i].gifts[o][e]==t)return Config.gifts.blocks[i].gifts[o];return!1},findGifts:function(e,t){for(var i=[],o=0;o<Config.gifts.blocks.length;o++)for(var a=0;a<Config.gifts.blocks[o].gifts.length;a++)Config.gifts.blocks[o].gifts[a][e]==t&&i.push(Config.gifts.blocks[o].gifts[a]);return i},forEach:function(e){for(var t=0;t<Config.gifts.blocks.length;t++)for(var i=0;i<Config.gifts.blocks[t].gifts.length;i++)e(Config.gifts.blocks[t].gifts[i]);return!1},findGiftById:function(e){return Gifts.findGift("id",e)},findGiftByUid:function(e){return Gifts.findGift("uid",e)},findGiftByOdGiftId:function(e){return Gifts.findGift("odGiftId",e)},receiveGift:function(e){application.playSound("giftReceived"),"sticker"==e.type&&(user.set("gifts",(100*user.get("gifts")+e.uid)%1e6),gifts.refreshUserStrickerGifts()),e.onReceive&&e.onReceive()},giftForUser:function(e,t){"money"==e.buyType&&(gifts.addProductListener(e.id,t),showBuy(prices[e.id])),"odgifts"==e.buyType&&odBuyGift(e.odGiftId,t),"coins"==e.buyType&&(user.get("coins")>=Number(e.price)?user.set({coins:new ObscureNumber(user.get("coins")-Number(e.price))},{validate:!0})&&gifts.processCoinsGift(e.id,t):new NoCoinsWindow({firstPriority:!0})),"free"==e.buyType&&gifts.processCoinsGift(e.id,t)}});Application.on("ready",function(){Gifts.forEach(function(e){e.price=new ObscureNumber(e.price)})});var GiftsView=Backbone.View.extend({sendGiftWindow:function(e){user.get("shopAvailable")?new ShopWindow({selectedUser:e,page:Config.shopGiftTab}):new SendGiftWindow({users:this.model.get("usersForGifts"),selectedUser:e})},renderGifts:function(e,t){e.find(".gifts").remove();for(var i=this.model.getStickerGifts(t),o=$('<div class="gifts"><div class="giftsContent"></div></div>'),a=0;a<i.length;a++){var n=$('<div class="gift"></div>');n.addClass(i[a].id),o.find(".giftsContent").append(n)}o.addClass("amountGifts_"+i.length),e.append(o)},initialize:function(){this.model.on("renderGifts",this.renderGifts,this),this.model.on("divAdded",function(e,t){(0<=this.model.get("usersForGifts").indexOf(t)||void 0===t)&&(e.on("click",_.bind(function(){this.sendGiftWindow(t)},this)),void 0!==t&&(e.on("mouseover",function(){e.addClass("sendGift")}),e.on("mouseout",function(){e.removeClass("sendGift")}))),void 0!==t&&this.renderGifts(e,t)},this),this.model.on("divRemoved",function(e,t){e.off("click"),void 0!==t&&(e.find(".gifts").remove(),e.off("mouseover"),e.off("mouseout"))},this)}});GiftsView.prototype.sendGiftWindow=function(e){user.get("shopAvailable")&&new ShopWindow({selectedUser:e,page:4})};var LevelPrizeProgressBar=Backbone.View.extend({initialize:function(){this.$el.addClass(this.model.get("name")),this.model.on("completeLevel",this.update,this),this.model.on("takeMiddlePrize",this.update,this),this.$el.addClass("active"),this.update()},update:function(){var e=this.$(".mBar"),t=this.model.get("levelsInEpisode"),i=((this.model.getCurrentLevel()-1)/t*100||0).toFixed(3);e.css("width",Math.min(100,i)+"%")}}),SendGiftWindow=TWindow.extend({templateClass:".sendGiftWindow_template",events:{"click .close":"close","click .changeUser":"unsetUserId","click .selectedUserBlock .photo":"unsetUserId","click .closeSelectUser":"clearSelectUserMask","keyup .selectUserMask":"renderSelectUser"},setUserId:function(e){this.userId=e,this.$(".selectedUserBlock .photo").html(socialNetwork.makePhotoById(this.userId,Config.gifts.selectedUserPhotoSize)),this.$(".selectedUserBlock .firstName").html(users[this.userId].first_name),this.$(".selectedUserBlock .lastName").html(users[this.userId].last_name),this.$el.addClass("userSelected")},unsetUserId:function(){this.userId=void 0,this.$el.removeClass("userSelected"),this.renderSelectUser()},clearSelectUserMask:function(){""!==this.$(".selectUserMask").val()&&(this.$(".selectUserMask").val(""),this.renderSelectUser())},sendGift:function(e){void 0!==this.userId?("money"==e.buyType&&(gifts.addProductListener(e.id,this.userId),showBuy(prices[e.id]),this.close()),"odgifts"==e.buyType&&(odBuyGift(e.odGiftId,this.userId),this.close()),"coins"==e.buyType&&(this.close(),user.set({coins:new ObscureNumber(user.get("coins")-Number(e.price))},{validate:!0})?gifts.processCoinsGift(e.id,this.userId):new SendGiftWindow({selectedUser:this.userId,users:this.options.users}))):(application.playSound("giftUserNotSelected"),this.$(".notSelectedUserText").html(messages.gifts.notSelectedUser).clearQueue().stop().css("opacity",1).show().delay(1e3).fadeOut(500))},renderSelectUser:function(){this.$(".selectUserContent").empty();var a=this.$(".selectUserMask").val().toUpperCase(),n=0;_.each(this.options.users,_.bind(function(e){if(!(30<=n&&window.mobile||300<=n)){var t=(users[e].first_name+" "+users[e].last_name).toUpperCase(),i=(users[e].last_name+" "+users[e].first_name).toUpperCase();if(0<=t.indexOf(a)||0<=i.indexOf(a)){n++;var o=$(".invisible.sendGiftWindowTemplate .selectUser").clone();o.find(".photo").html(socialNetwork.makePhotoById(e,Config.gifts.selectUserPhotoSize)),o.find(".firstName").html(users[e].first_name),o.find(".lastName").html(users[e].last_name),o.find(".selectHim").html(messages.gifts.selectHim),o.find(".selectHim").on("click",_.bind(function(){this.setUserId(e)},this)),this.$(".selectUserContent").append(o)}}},this))},selectTab:function(e){this.$(".giftsSubBlock").hide(),this.$(".giftsSubBlock."+e).show(),this.$(".giftsTab.selected").removeClass("selected"),this.$(".giftsTab."+e).addClass("selected")},onOpen:function(){if(this.$(".windowTitle").html(messages.gifts.windowTitle),this.$(".changeUser").html(messages.gifts.changeUser),this.$(".giftFor").html(messages.gifts.giftFor),this.$(".selectUserMask").attr("placeholder",messages.gifts.findUser),Config.gifts.tabVersion&&this.$el.addClass("tabVersion"),void 0!==this.options.selectedUser?this.setUserId(this.options.selectedUser):this.unsetUserId(),this.$(".giftsBlock").empty(),Config.gifts.tabVersion?this.$(".giftsTabs").show().empty():this.$(".giftsTabs").remove(),needCalcOdGiftsPrices=[],_.each(Config.gifts.blocks,_.bind(function(t){var o=$(".invisible.sendGiftWindowTemplate .giftsSubBlock").clone();o.find(".title").html(messages.gifts[t.id]),o.addClass(t.id),o.find(".content").empty();var i,a,n=0,r=!1;_.each(t.gifts,_.bind(function(e,t){var i=$(".invisible.sendGiftWindowTemplate .gift").clone();i.addClass(e.id).addClass("giftNumber_"+t),"money"==e.buyType?(i.find(".price").html(prices[e.id].desc.price),i.find(".name").html(prices[e.id].desc.product)):i.find(".name").html(messages.gifts[e.id]),"coins"==e.buyType&&(i.find(".price").html($(".invisible.sendGiftWindowTemplate .coinsPriceTemplate").html()),i.find(".coinsPrice").html(Number(e.price))),"odgifts"==e.buyType&&(needCalcOdGiftsPrices.push({div:i.find(".price"),giftId:e.odGiftId}),i.find(".price").html(e.odGiftPrice+" ")),i.on("click",_.bind(function(){this.sendGift(e)},this)),"sticker"==e.type&&(i.on("mouseover",_.bind(function(){this.$(".selectedUserBlock").addClass(e.id)},this)),i.on("mouseout",_.bind(function(){this.$(".selectedUserBlock").removeClass(e.id)},this))),o.find(".content").append(i)},this)),this.$(".giftsBlock").append(o),void 0===t.scrollStep&&(t.scrollStep=o.find(".content .gift").width()+parseInt(o.find(".content .gift").css("margin-left"))+parseInt(o.find(".content .gift").css("margin-right")));var e=o.find(".content").width()-o.find(".holder").width();e=Math.floor((e+t.scrollStep/2)/t.scrollStep);var s=function(){a=!(n<=-e),(i=!(0<=n))?o.find(".leftArrow").removeClass("disabled").addClass("enabled"):o.find(".leftArrow").addClass("disabled").removeClass("enabled"),a?o.find(".rightArrow").removeClass("disabled").addClass("enabled"):o.find(".rightArrow").addClass("disabled").removeClass("enabled")};s();var l=!1,d=function e(){if(!l&&!1!==r){if("+"==r){if(!i)return;n++}else{if(!a)return;n--}s(),l=!0,o.find(".content").ourAnimate({left:r+"="+t.scrollStep+"px"},300,"linear",function(){l=!1,e()})}};o.find(".leftArrow").on("mousedown",function(){r="+",d()}),o.find(".rightArrow").on("mousedown",function(){r="-",d()}),o.find(".leftArrow").on("mouseout",function(){r=!1}),o.find(".leftArrow").on("mouseup",function(){r=!1}),o.find(".rightArrow").on("mouseout",function(){r=!1}),o.find(".rightArrow").on("mouseup",function(){r=!1}),Config.gifts.tabVersion&&($tab=$(".invisible.sendGiftWindowTemplate .giftsTab").clone(),$tab.addClass(t.id),$tab.html(messages.gifts[t.id]),$tab.on("click",_.bind(function(){this.selectTab(t.id)},this)),this.$(".giftsTabs").append($tab))},this)),needCalcOdGiftsPrices.length){for(var e=[],t=0;t<needCalcOdGiftsPrices.length;t++)e.push(needCalcOdGiftsPrices[t].giftId);FAPI.Client.call({method:"presents.get",present_ids:e.join(","),fields:"present.price"},function(e,t,i){if("ok"==e)for(var o=0;o<t.presents.length;o++)for(var a=0;a<needCalcOdGiftsPrices.length;a++)if(0<=t.presents[o].present_type_ref.indexOf(needCalcOdGiftsPrices[a].giftId)){var n=Gifts.findGiftByOdGiftId(needCalcOdGiftsPrices[a].giftId);n.odGiftPrice=t.presents[o].price,0<n.odGiftPrice?needCalcOdGiftsPrices[a].div.html(n.odGiftPrice+" "):needCalcOdGiftsPrices[a].div.html("");break}})}Config.gifts.tabVersion&&this.selectTab(Config.gifts.blocks[0].id)}}),GiftSendedWindow=TWindow.extend({templateClass:".giftSendedWindow_template",onOpenSound:"giftSended",onClose:function(){if(user.get("userId")!=this.options.userId){var e=this.options.gift.newYear?"sendedRequestNewYear":"sendedRequest";socialNetwork.sendRequest({type:"giftSended",userIds:this.options.userId,message:sprintf(messages.gifts[e][user.get("gender")],{giftName:this.giftName})})}},onOpen:function(){"money"==this.options.gift.buyType?this.giftName=prices[this.options.gift.id].desc.product:this.giftName=messages.gifts[this.options.gift.id],this.$(".windowTitle").html(messages.gifts.sendedWindowTitle),this.$(".windowText").html(messages.gifts.sendedWindowText),this.$(".gift").addClass(this.options.gift.id),this.$(".giftName").html(this.giftName),this.$(".firstName").html(users[this.options.userId].first_name),this.$(".lastName").html(users[this.options.userId].last_name),this.$(".photo").html(socialNetwork.makePhotoById(this.options.userId,Config.gifts.sendedWindowPhotoSize))}}),gifts;Application.on("ready",function(){if(void 0===Config.gifts.networks||0<=Config.gifts.networks.indexOf(network)){gifts=new Gifts(Config.gifts.params),application.friendsPanelView.friendsOnPanel.on("renderNewElement",function(e,t){void 0!==t&&gifts.addDiv(e.find(".friendCardPhotoBorder"),t)}),application.friendsPanelView.friendsOnPanel.on("removeElement",function(e){gifts.removeDiv(e.find(".friendCardPhotoBorder"))}),friends.on("addMapFriend",function(e,t){gifts.addDiv(e,t)}),friends.on("removeMapFriend",function(e){gifts.removeDiv(e)}),gifts.addDiv($(".userCard"),user.get("userId"));var e=$('<div class="givePriceFriends"></div>');$("#main").append(e),gifts.addDiv($("#main .givePriceFriends")),application.friendsPanelView.friendsOnPanel.update(),application.friendsView.renderFriends(),application.trigger("giftsAvailable")}}),Config.gifts={selectedUserPhotoSize:120,selectUserPhotoSize:40,sendedWindowPhotoSize:120,tabVersion:!0,params:{canSendNotInApp:!1},blocks:[{id:"giftsBlock1",gifts:[{id:"gift_sticker10",uid:16,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker11",uid:17,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker12",uid:18,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker7",uid:13,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker8",uid:14,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker9",uid:15,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker15",uid:21,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker13",uid:19,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker14",uid:20,type:"sticker",price:300,buyType:"coins"},{id:"gift_sticker4",uid:10,type:"sticker",price:300,buyType:"coins",birthday:!0,odGiftId:805194457120,odGiftPrice:35},{id:"gift_sticker5",uid:11,type:"sticker",price:300,birthday:!0,buyType:"coins",odGiftId:805194434336,odGiftPrice:35},{id:"gift_sticker6",uid:12,type:"sticker",price:300,birthday:!0,buyType:"coins",odGiftId:805194409504,odGiftPrice:35},{id:"gift_sticker1",uid:7,price:300,type:"sticker",buyType:"coins",odGiftId:805194581024,odGiftPrice:35},{id:"gift_sticker2",uid:8,price:300,type:"sticker",buyType:"coins",odGiftId:805194559264,odGiftPrice:35},{id:"gift_sticker3",uid:9,price:300,type:"sticker",buyType:"coins",odGiftId:805194493984,odGiftPrice:35}]},{id:"giftsBlock2",gifts:[{id:"gift_unlimitedLifes",uid:1,buyType:"money",onReceive:function(){goods.goodBuyed("unlimitedLifes",72)}},{id:"gift_starInField",uid:2,buyType:"money",onReceive:function(){goods.goodBuyed("starInField",72)}},{id:"gift_addThreeMoves",uid:3,buyType:"money",onReceive:function(){goods.goodBuyed("addThreeMoves",24)}},{id:"gift_threeDeleteCellPowerUps",uid:4,buyType:"money",onReceive:function(){user.setPowerUpAmount("deleteCellPowerUp",user.getPowerUpAmount("deleteCellPowerUp")+3)}},{id:"gift_threeShufflePowerUps",uid:5,buyType:"money",onReceive:function(){user.setPowerUpAmount("shufflePowerUp",user.getPowerUpAmount("shufflePowerUp")+3)}},{id:"gift_threeLightingPowerUps",uid:6,buyType:"money",onReceive:function(){user.setPowerUpAmount("lightingPowerUp",user.getPowerUpAmount("lightingPowerUp")+3)}},{id:"gift_starInFieldDay",uid:30,buyType:"money",onReceive:function(){goods.goodBuyed("starInField",24)}}]}]},(void 0===Config.gifts.networks||0<=Config.gifts.networks.indexOf(network))&&Config.shopProducts.push(_.map(Config.gifts.blocks[0].gifts,function(e){return{name:e.id,giftId:e.id,type:e.buyType,tpl:"giftsProduct"}}));var Tournament=Backbone.Model.extend({sendData:function(e,t){this.socket&&1==this.socket.readyState&&(void 0===t&&(t={}),t.name=e,this.socket.send(JSON.stringify(t)))},runCheckConnect:function(){this.ckTimeout&&clearTimeout(this.ckTimeout),this.ckTimeout=setTimeout(_.bind(function(){this.ckTimeout=!1,this.checkConnect()},this),3e4)},confirm:function(){0==this.get("state")&&(this.set({state:1}),this.connectToServer(!0),user.set({actionName:"tournament_begin",actionEpisode:user.get("episode"),actionLevel:0,actionPrice:0},{validate:!1}))},finished:function(){this.set({state:3});var e=this.getMyPlace();if(e<=3){var t=this.getPlayersInOrder();t=t.slice(0,3),new TournamentPrizeWindow({prize:this.get("prizes")[e-1],leaders:t,myPlace:e})}this.socket&&this.socket.close(1e3,"finished")},connectToServer:function(n){this.socket=new WebSocket(this.get("nodeUrl")),this.socket.onopen=_.bind(function(){var e={photo:user.get("photo"),profile:user.get("profile"),name:user.get("name"),episode:user.get("episode"),level:user.get("level")};this.sendData("i",{userId:user.tournamentUserId(),data:e});var o=!1,a=!1;this.socket.onmessage=_.bind(function(e){if(this.runCheckConnect(),"in"==(e=JSON.parse(e.data)).name&&(a=!0,(o=e.data)&&(this.trigger("admin"),this.sendData("serverStatistics")),n?this.sendData("gt",{confirm:!0}):this.sendData("gt")),a){if("serverStatistics"==e.name&&o&&console.log(e.data),"cn"==e.name&&(this.set({state:0}),this.socket.close(1e3,"confirm")),"ct"==e.name){var t={state:e.data.s+1};if(e.data.t&&(this.set("timeout",0),t.timeout=e.data.t),e.data.p){for(var i=this.starsOrder=0;i<e.data.p.length;i++)e.data.p[i].orderId=i,e.data.p[i].levelsDone=0,e.data.p[i].starsOrder=this.starsOrder,e.data.p[i].stars=0,this.starsOrder++;t.players=e.data.p}if(this.set(t),e.data.c)for(i=0;i<e.data.c.length;i++)this.processChange(e.data.c[i]);this.trigger("renderPlayers")}"a"==e.name&&(this.processChange(e.data),this.trigger("renderPlayers")),"f"==e.name&&this.finished(),"ccon"==e.name&&this.checkConnectionTimeout&&clearTimeout(this.checkConnectionTimeout)}},this),this.socket.onclose=_.bind(function(e){this.socket=void 0,this.ckTimeout&&clearTimeout(this.ckTimeout),"finished"!==e.reason?"confirm"!==e.reason?(this.trigger("disconnect"),"disabled"!==e.reason&&this.connectToServer(!0)):0!=this.get("state")&&this.set({state:0}):3!=this.get("state")&&this.finished()},this)},this),this.socket.onerror=_.bind(function(){this.socket=void 0,this.trigger("disconnect"),setTimeout(_.bind(function(){0==this.get("state")?this.connectToServer():this.connectToServer(!0)},this),3e3)},this)},checkConnect:function(){this.sendData("ccon"),this.checkConnectionTimeout=setTimeout(_.bind(function(){this.checkConnectionTimeout=!1,this.socket&&(this.socket=void 0,this.trigger("disconnect"),this.connectToServer(!0))},this),3e3)},getStats:function(){this.sendData("serverStatistics")},getPlayerByUserId:function(e){for(var t=this.get("players"),i=0;i<t.length;i++)if(t[i].userId==e)return e==user.tournamentUserId()&&(t[i].level=user.get("level"),t[i].episode=user.get("episode")),t[i];return!1},getPlayersInOrder:function(){var e=this.get("players");return e.sort(function(e,t){return e.stars!=t.stars?t.stars-e.stars:e.starsOrder-t.starsOrder}),e},getMyPlace:function(){return this.getPlayerIdPlace(user.tournamentUserId())},getPlayerIdPlace:function(e){for(var t=this.getPlayersInOrder(),i=0;i<t.length;i++)if(t[i].userId==e)return i+1;return t.length},getMyOrderId:function(){for(var e=this.get("players"),t=0;t<e.length;t++)if(e[t].userId==user.tournamentUserId())return e[t].orderId},processChange:function(e){for(var t=e%1e3,i=(e=Math.floor(e/1e3))%1e3,o=(e=Math.floor(e/1e3))%1e3,a=Math.floor(e/1e3),n=this.get("players"),r=0;r<n.length;r++)if(n[r].orderId==t)return n[r].stars+=a,n[r].levelsDone++,n[r].level=i,n[r].episode=o,n[r].starsOrder=this.starsOrder,void this.starsOrder++},encodeChange:function(e,t,i,o){return 1e9*e+1e6*t+1e3*i+o},initialize:function(){if(Config.tournaments&&"undefined"!=typeof tournamentHost&&"undefined"!=typeof WebSocket){"object"==("undefined"==typeof tournamentHost?"undefined":_typeof(tournamentHost))&&(tournamentHost=tournamentHost[user.get("userId")%tournamentHost.length]);for(var e=0;e<Config.tournaments.length;e++)if(0<=Config.tournaments[e].networks.indexOf(network)){for(var t=0;t<Config.tournaments[e].servers.length;t++)if(user.get("episode")>=Config.tournaments[e].servers[t].episodes[0]&&user.get("episode")<=Config.tournaments[e].servers[t].episodes[1]){this.set({nodeUrl:tournamentHost+":"+Config.tournaments[e].servers[t].nodePort,prizes:Config.tournaments[e].prizes});new TournamentView({model:this,page:"main"}),new TournamentView({model:this,page:"game"});return this.connectToServer(),void user.on("recievedOrIncreasedStarsOnLevel",function(e){2==this.get("state")&&this.sendData("a",{data:this.encodeChange(e,user.get("episode"),user.get("level"),this.getMyOrderId())})},this)}return}}}}),TournamentView=Backbone.View.extend({events:{click:"fullInfo","click .tournamentPlayer":"playerProfile","click .confirmButton":"confirm","click .stats":"getStats"},confirm:function(){return this.model.confirm(),!1},playerProfile:function(e){var t=this.model.getPlayerByUserId($(e.currentTarget).data("userId"));return!1!==t&&new TournamentProfileWindow({player:t,tournament:this.model}),!1},getStats:function(){return this.model.getStats(),!1},renderBasicInfo:function(){if(2<=this.model.get("state"))for(var e=this.model.getPlayersInOrder(),t=0;t<e.length;t++)if(t<3||e[t].userId==user.tournamentUserId()){var i=this.generatePlayer(e[t],t+1);this.$(".basicInfoBlock .players").append(i)}},renderFullInfo:function(){if(2<=this.model.get("state"))for(var e=this.model.getPlayersInOrder(),t=0;t<e.length;t++){var i=this.generatePlayer(e[t],t+1);this.$(".fullInfoBlock .players").append(i)}},renderMyPosition:function(){2<=this.model.get("state")?this.$(".tournamentMyPosition").text(this.model.getMyPlace()):this.$(".tournamentMyPosition").empty()},renderInfo:function(){this.$(".fullInfoBlock .players").empty(),this.$(".basicInfoBlock .players").empty(),this.renderMyPosition(),this.$el.hasClass("fullInfo")?this.renderFullInfo():this.renderBasicInfo()},fullInfo:function(e){this.$el.hasClass("fullInfoAnimation")||(this.$el.addClass("fullInfoAnimation"),setTimeout(_.bind(function(){this.$el.hasClass("fullInfoAnimation")&&this.$el.removeClass("fullInfoAnimation")},this),500),this.$el.hasClass("fullInfo")?this.$el.removeClass("fullInfo"):this.$el.addClass("fullInfo"),this.renderInfo())},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(i){this.stopTimer();var o=(new Date).getTime(),e=_.bind(function(){var e=i-((new Date).getTime()-o);e<-3e3&&("main"==this.options.page&&this.model.checkConnect(),this.stopTimer()),e<0&&(e=0);var t=Config.tournamentTimerFormat||"%H:%i:%s";Config.tournament.activateEnabled||(t="%i:%s"),this.$(".timeout").html(formatTime(t,Math.floor(e/1e3)))},this);this.timerInterval=setInterval(e,1e3),e()},generatePlayer:function(e,t){var i=$(".invisible .tournamentPlayer").clone();return i.find(".name").html(e.name),i.find(".stars").html(e.stars),i.find(".photo").html(makeImg(e.photo,Config.tournamentPhotoSize)),i.find(".place").html(t),t<=3&&i.addClass("place"+t),e.userId==user.tournamentUserId()&&i.addClass("me"),i.find(".prize").addClass("prizeForPlace"+t),messages["tournamentPrizeForPlace"+t]&&i.find(".prize").attr("title",messages["tournamentPrizeForPlace"+t]),i.data("userId",e.userId),i},runHideTimeout:function(){setTimeout(_.bind(function(){this.$el.hasClass("fullInfo")?this.runHideTimeout():(this.$el.fadeOut(300,function(){$(".wrapper").removeClass("withTournament"),canvas&&canvas.layer&&canvas.layer.removeClass("withTournament")}),this.inited=!1,"main"==this.options.page&&setTimeout(_.bind(function(){this.model.connectToServer(!0)},this),6e4))},this),6e4)},initialize:function(e){this.options=e,this.setElement($(".invisible .tournament").clone()),$("#"+this.options.page).append(this.$el),this.inited=!1,this.model.on("admin",function(){this.$el.append($("<div class='stats'>stats</div>"))},this),this.model.on("disconnect",function(){this.stopTimer(),$(".wrapper").removeClass("withTournament"),canvas&&canvas.layer&&canvas.layer.removeClass("withTournament"),this.$el.hide(),this.inited=!1},this),this.model.on("renderPlayers",function(){this.renderInfo()},this),this.model.on("change:state",function(){this.inited||(this.$el.show().css("opacity",1),$(".wrapper").addClass("withTournament"),_.defer(function(){canvas&&canvas.layer&&canvas.layer.addClass("withTournament")}),this.inited=!0),this.$el.removeClass("confirm").removeClass("beforeStart").removeClass("running").removeClass("finished"),0===this.model.get("state")&&(this.$(".stats").remove(),this.$el.addClass("confirm")),1==this.model.get("state")&&this.$el.addClass("beforeStart"),2==this.model.get("state")&&this.$el.addClass("running"),3==this.model.get("state")&&(this.$el.addClass("finished"),this.$(".stats").remove(),this.stopTimer(),this.runHideTimeout())},this),"game"==e.page&&application.on("change:page",function(){_.defer(function(){canvas&&canvas.layer&&canvas.layer.addClass("withTournament")})}),this.model.on("change:timeout",function(){this.model.get("timeout")&&this.runTimer(this.model.get("timeout"))},this)}}),TournamentPrizeWindow=TWindow.extend({templateClass:".tournamentPrizeWindow_template",onOpenSound:"tournamentPrizeWindow",events:{"click .needPublicCheckbox":"togglePublicCheckbox","click .takePrize":"takePrize"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},takePrize:function(){if(this.needPublic){var e=messages["tournamentPrize"+this.options.myPlace+"Image"],t=RANDOM(messages.tournamentPrizeMessage),i=messages.tournamentPrizeCaption[user.get("gender")];_doPublication(sprintf(t[user.get("gender")],{place:this.options.myPlace}),e,i,void 0,_.bind(function(){this.close()},this))}else this.close()},onClose:function(){user.trigger("tournamentfinished");var t=user.get("coins");_.each(this.options.prize,_.bind(function(e){"coins"==e.type&&(t=new ObscureNumber(t.get()+e.amount)),"powerUp"==e.type&&user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0)},this)),user.set({powerUps:user.calcPowerUps(),coins:t})},onOpen:function(){this.onPublicCheckbox(),this.$(".myPlace").html(this.options.myPlace),this.$el.addClass("episode_"+episode.get("num")),this.$(".prizes").empty(),_.each(this.options.prize,_.bind(function(e){var t=this.$(".invisible .tournamentWindowOnePrize").clone();t.find(".amount").html(e.amount),t.addClass(e.cssClass),this.$(".prizes").append(t)},this));for(var e=0;e<this.options.leaders.length;e++){var t=this.$(".player"+(e+1)),i=this.options.leaders[e],o=Config.basePhotoSize;Config.tournamentPrizeWindowPhotoSize&&(o=Config.tournamentPrizeWindowPhotoSize),t.find(".photo").html(makeImg(i.photo,o)),t.find(".name").html(i.name),t.find(".stars").html(i.stars)}setTimeout(_.bind(function(){this.$(".player"+this.options.myPlace).addClass("animation")},this),1500),TWindow.prototype.onOpen.call(this)}}),TournamentProfileWindow=TWindow.extend({templateClass:".tournamentProfileWindow_template",onOpen:function(){var e=this.options.player,t=Config.basePhotoSize;Config.tournamentProfileWindowPhotoSize&&(t=Config.tournamentProfileWindowPhotoSize),this.$(".photo").html(makeImg(e.photo,t)),this.$(".name").html(e.name);var i=(e.episode-1)*Config.levelsInEpisode+e.level;this.$(".level").html(i);var o=e.userId.substr(0,2);"od"!=o&&"te"!=o||(o="odnoklassniki"),"vk"==o&&(o="vkontakte"),"ma"==o&&(o="mailru"),this.$(".infoItem1Value1").html(e.levelsDone),this.$(".infoItem1Value2").html(e.stars),this.$(".infoItem1Value3").html(this.options.tournament.getPlayerIdPlace(e.userId)),this.$(".link").addClass(o),this.$(".link").attr("href",e.profile),TWindow.prototype.onOpen.call(this)}}),Tournament=Backbone.Model.extend({initialize:function(){if(Config.tournaments&&"undefined"!=typeof tournamentHost&&"undefined"!=typeof WebSocket){"object"==("undefined"==typeof tournamentHost?"undefined":_typeof(tournamentHost))&&(tournamentHost=tournamentHost[user.get("userId")%tournamentHost.length]),application.tournament=this,$(".tournamentStr").addClass("tournamentMyPosition"),$(".tournamentMyPosition").show();for(var e=0;e<Config.tournaments.length;e++)if(0<=Config.tournaments[e].networks.indexOf(network)){for(var t=0;t<Config.tournaments[e].servers.length;t++)if(user.get("episode")>=Config.tournaments[e].servers[t].episodes[0]&&user.get("episode")<=Config.tournaments[e].servers[t].episodes[1]){this.set({nodeUrl:tournamentHost+":"+Config.tournaments[e].servers[t].nodePort,prizes:Config.tournaments[e].prizes});new TournamentView({model:this,page:"main"}),new TournamentView({model:this,page:"game"});return this.connectToServer(),void user.on("recievedOrIncreasedStarsOnLevel",function(e){2==this.get("state")&&this.sendData("a",{data:this.encodeChange(e,user.get("episode"),user.get("level"),this.getMyOrderId())})},this)}return}}},sendData:function(e,t){this.socket&&(void 0===t&&(t={}),t.name=e,this.socket.send(JSON.stringify(t)))},runCheckConnect:function(){this.ckTimeout&&clearTimeout(this.ckTimeout),this.ckTimeout=setTimeout(_.bind(function(){this.ckTimeout=!1,this.checkConnect()},this),3e4)},confirm:function(){0==this.get("state")&&(this.set({state:1}),this.connectToServer(!0),user.set({actionName:"tournament_begin",actionEpisode:user.get("episode"),actionLevel:0,actionPrice:0},{validate:!1}))},finished:function(){this.set({state:3});var e=this.getMyPlace();if(e<=3){var t=this.getPlayersInOrder();t=t.slice(0,3),new TournamentPrizeWindow({prize:this.get("prizes")[e-1],leaders:t,myPlace:e})}this.socket&&this.socket.emit("disconnect","finished")},connectToServer:function(r){this.socket=io(this.get("nodeUrl")),this.socket.on("connect",_.bind(function(){var e={photo:user.get("photo"),profile:user.get("profile"),name:user.get("name"),episode:user.get("episode"),level:user.get("level")};this.sendData("i",{userId:user.tournamentUserId(),data:e});var a=!1,n=!1;this.socket.on("message",_.bind(function(e){if(this.runCheckConnect(),"in"===e.name&&(n=!0,(a=e.data)&&(this.trigger("admin"),this.sendData("serverStatistics")),r?this.sendData("gt",{confirm:!0}):this.sendData("gt")),n){if("serverStatistics"===e.name&&a&&console.log(e.data),"cn"===e.name&&(this.set({state:0}),this.socket.emit("disconnect","confirm")),"ct"===e.name){this.needConnect=!1;var t={state:e.data.s+1};(new Date).getTime(),e.data.t;if(e.data.t&&(this.set("timeout",0),t.timeout=e.data.t),e.data.p){for(var i=this.starsOrder=0;i<e.data.p.length;i++)e.data.p[i].orderId=i,e.data.p[i].levelsDone=0,e.data.p[i].starsOrder=this.starsOrder,e.data.p[i].stars=0,this.starsOrder++;t.players=e.data.p}if(this.set(t),e.data.c)for(var o=this.userStars=0;o<e.data.c.length;o++)this.processChange(e.data.c[o]);this.trigger("renderPlayers")}"a"===e.name&&(this.processChange(e.data),this.trigger("renderPlayers")),"f"===e.name&&this.finished(),"ccon"===e.name&&this.checkConnectionTimeout&&clearTimeout(this.checkConnectionTimeout)}},this)),this.socket.on("disconnect",_.bind(function(e){return this.socket=void 0,this.ckTimeout&&clearTimeout(this.ckTimeout),"finished"===e?(3!==this.get("state")&&this.finished(),void(this.customDisconnect=!0)):"confirm"===e?(0!==this.get("state")&&this.set({state:0}),void(this.customDisconnect=!0)):(this.customDisconnect?this.customDisconnect=!1:this.trigger("disconnect"),void("io server disconnect"!==e&&this.connectToServer(!0)))},this))},this)),this.socket.on("error",_.bind(function(){this.socket=void 0,setTimeout(_.bind(function(){0===this.get("state")?this.connectToServer():this.connectToServer(!0)},this),3e3)},this))},checkConnect:function(){this.sendData("ccon"),this.checkConnectionTimeout=setTimeout(_.bind(function(){this.checkConnectionTimeout=!1,this.socket&&(this.socket=void 0,this.trigger("disconnect"),this.connectToServer(!0))},this),3e3)},getStats:function(){this.sendData("serverStatistics")},getPlayerByUserId:function(e){for(var t=this.get("players"),i=0;i<t.length;i++)if(t[i].userId==e)return e==user.tournamentUserId()&&(t[i].level=user.get("level"),t[i].episode=user.get("episode")),t[i];return!1},getPlayersInOrder:function(){var e=this.get("players");return e.sort(function(e,t){return e.stars!=t.stars?t.stars-e.stars:e.starsOrder-t.starsOrder}),e},getMyPlace:function(){return this.getPlayerIdPlace(user.tournamentUserId())},getPlayerIdPlace:function(e){for(var t=this.getPlayersInOrder(),i=0;i<t.length;i++)if(t[i].userId==e)return i+1;return t.length},getMyOrderId:function(){for(var e=this.get("players"),t=0;t<e.length;t++)if(e[t].userId==user.tournamentUserId())return e[t].orderId},processChange:function(e){for(var t=e%1e3,i=(e=Math.floor(e/1e3))%1e3,o=(e=Math.floor(e/1e3))%1e3,a=Math.floor(e/1e3),n=this.get("players"),r=0;r<n.length;r++)if(n[r].orderId==t)return n[r].stars+=a,n[r].levelsDone++,n[r].level=i,n[r].episode=o,n[r].starsOrder=this.starsOrder,void this.starsOrder++},encodeChange:function(e,t,i,o){return 1e9*e+1e6*t+1e3*i+o}}),RewardAD=Backbone.Model.extend({defaults:{enable:!0,numberOfViewsPerDay:200,onlyForNotPaid:!1,notPaidTimeout:0,minLevel:0,oncePerSession:!1,oncePerDay:!1,showed:!1,tag:"",subtag:"",viewsDate:"",viewsCount:0,lastShow:null,cooldown:0},checkAdBlock:function(){if(window.mobile)return!1;var e=$('<div id="showAd">').css({width:1,height:1}).appendTo($(".wrapper")),t=!e.is(":visible");return e.remove(),t},cleanViews:function(){this.set("viewsDate",""),this.set("viewsCount",0),setLocalStorage("adsViewsDate_"+this.get("tag"),this.get("viewsDate")),setLocalStorage("adsViewsCount_"+this.get("tag"),this.get("viewsCount"))},checkBaseAvailable:function(){if(!this.get("enable"))return!1;if(this.set("viewsDate",getLocalStorage("adsViewsDate_"+this.get("tag"),"")),this.set("viewsCount",getLocalStorage("adsViewsCount_"+this.get("tag"),0)),this.get("onlyForNotPaid")&&user.get("paid"))return!1;if(this.get("minLevel")&&user.getCurrentLevel()<this.get("minLevel"))return!1;if(this.get("notPaidTimeout")&&user.get("paid")){var e=!1;if(user.get("lastPayDate")&&(e=application.getCurrentServerTime()-new Date(user.get("lastPayDate")).getTime()/1e3<this.get("notPaidTimeout")),e)return!1}return(!this.get("oncePerSession")||!this.get("showed"))&&((!this.get("oncePerDay")||!this.isShowedToday())&&(!(this.getTodayShowCount()>=this.get("numberOfViewsPerDay"))&&(!(0<this.getCooldown())&&!this.checkAdBlock())))},getCooldown:function(){return this.get("lastShow")&&this.get("cooldown")?Math.max(0,this.get("cooldown")-(application.getCurrentServerTime()-Math.round(this.get("lastShow").getTime()/1e3))):0},checkAvailable:function(){return Boolean(!RewardAD.adShowNow&&this.checkBaseAvailable()&&Config.adsProvider&&Config.adsProvider.isAdReady())},isShowedToday:function(){var e=this.getLastShowedTime();return application.getCurrentServerTime()-e<86400},getLastShowedTime:function(){return getLocalStorage("lastShowedTime_"+this.get("tag"),0)},saveShowedTime:function(){setLocalStorage("lastShowedTime_"+this.get("tag"),application.getCurrentServerTime());var e=this.get("viewsDate"),t=(new Date).toISOString().slice(0,10);t!=e?this.set({viewsDate:t,viewsCount:1}):this.set({viewsDate:t,viewsCount:this.get("viewsCount")+1}),setLocalStorage("adsViewsDate_"+this.get("tag"),this.get("viewsDate")),setLocalStorage("adsViewsCount_"+this.get("tag"),this.get("viewsCount"))},getTodayShowCount:function(){return(new Date).toISOString().slice(0,10)!=this.get("viewsDate")?0:this.get("viewsCount")},showAd:function(t,i,o){var a=this,n=_.now();if(this.checkAvailable()){RewardAD.adShowNow=!0;var e=Config.adsProvider.adsKey?"#"+Config.adsProvider.adsKey:"";user.set({actionName:"adBegin_"+a.get("tag")+a.get("subtag")+e,actionEpisode:user.get("episode"),actionLevel:0,actionPrice:0},{validate:!1}),Config.adsProvider.showAd(_.bind(function(){if(this.set("showed",!0),RewardAD.adShowNow=!1,_.now()-n<5e3||a.getTodayShowCount()>a.get("numberOfViewsPerDay"))i&&i.call(o);else{var e=Config.adsProvider.adsKey?"#"+Config.adsProvider.adsKey:"";this.saveShowedTime(),user.set({actionName:"adFinish_"+a.get("tag")+a.get("subtag")+e,actionEpisode:user.get("episode"),actionLevel:0,actionPrice:0},{validate:!1}),this.set("lastShow",new Date(1e3*application.getCurrentServerTime())),service("../../../gems/site/service/updaterewardadshow.php",{name:this.get("tag")}),t&&t.call(o),window.mobile&&orientationChange(),this.trigger("show",this),application.trigger("rewardad",this)}},this),_.bind(function(){RewardAD.adShowNow=!1,i&&i.call(o)},this))}else i&&i.call(o)}},{adShowNow:!1,selectProvider:function(){if(Config.adsProvider=null,_.isArray(Config.adsProviderList)&&!(user.getCurrentLevel()<30))for(var e=0;e<Config.adsProviderList.length;e++){var t=Config.adsProviderList[e];if(t.checkAvailable())return Config.adsProvider=t,void Config.adsProvider.prepareNextAd()}}});Application.on("ready",function(){RewardAD.selectProvider(),user.get("rewardAdData")&&user.get("rewardAdData").forEach(function(e){_.invoke(Config.adsRewards.where({tag:e.name}),"set","lastShow",e.lastShow?new Date(e.lastShow):null)})});var LifeStreetRewardAD=Backbone.Model.extend({adsKey:"l",isAdReady:function(){return Boolean(window.lsmVideoAd)},checkAvailable:function(){return!window.mobile&&"facebook"==network&&"ru"!=locale&&"function"==typeof LSM_Slot},prepareNextAd:function(){window.lsmVideoAd||window.lsmVideoAd||"function"!=typeof LSM_Slot||LSM_Slot({adkey:lifeStreetAds[lifeStreetAdId].key,slot:lifeStreetAds[lifeStreetAdId].slot,ad_size:"650x520",_render_div_id:"lsm_video_ads",_ad_type:"vast_banner",_preload:"wait",_onload:function(e){"error"!==e.state()&&(window.lsmVideoAd=e)},_onaction:function(e,t){"get_reward"==t&&_.isFunction(window.lsmVideoAdSuccess)&&window.lsmVideoAdSuccess()}})},showAd:function(e,t){var i=this;if(t=t||_.noop,e=e||_.noop,!window.lsmVideoAd)return t(),void this.prepareNextAd();var o=$("#windowShadow").clone().appendTo(".wrapper").show(),a=$('<div id="lsm_video_ads"></div>'),n=parseInt($(".wrapper").css("width")),r=parseInt($(".wrapper").css("height")),s=!1;a.css({position:"absolute",left:Math.floor((n-window.lsmVideoAd.getAdWidth())/2)+"px",top:Math.floor((r-window.lsmVideoAd.getAdHeight())/2)+"px","background-color":"black","z-index":100}),$(".wrapper").append(a),window.lsmVideoAdSuccess=function(){s&&clearInterval(s),e(),a.remove(),o.remove(),setTimeout(function(){i.prepareNextAd()},18e4)},window.lsmVideoAd.show(),s=setInterval(function(){a.is(":visible")||(clearInterval(s),t(),a.remove(),o.remove(),setTimeout(function(){i.prepareNextAd()},18e4))},100),window.lsmVideoAd=!1}}),TestAD=Backbone.Model.extend({_prepared:!1,adsKey:"t",isAdReady:function(){return Boolean(this._prepared)},checkAvailable:function(){return"test"===network},prepareNextAd:function(){this._prepared=!0},showAd:function(e,t){if(t=t||_.noop,e=e||_.noop,this._prepared){this._prepared=!1;var i=this;confirm("ads watched")?(setTimeout(function(){i.prepareNextAd()},1e4),e()):(setTimeout(function(){i.prepareNextAd()},1e4),t())}else t()}}),OkWebRewardAD=Backbone.Model.extend({_prepared:!1,adsKey:"ow",isAdReady:function(){return Boolean(this._prepared)},checkAvailable:function(){return"odnoklassniki"==network&&!window.mobile},prepareNextAd:function(){if(!this._prepared){var e=this;e.timeId&&clearTimeout(e.timeId),e.timeId=setTimeout(function(){e._prepared=!1,e.prepareNextAd()},12e4),this.subscribeToEvents(),FAPI.invokeUIMethod("prepareMidroll")}},showAd:function(e,t){var i=this;application.get("view").isFullScreen()&&application.get("view").exitFullScreen(),setTimeout(function(){i.subscribeToEvents(),i._showSuccessHandler=e,i._showErrorHandler=t,i._prepared=!1,i._startTime=Date.now(),FAPI.invokeUIMethod("showMidroll")},200)},subscribeToEvents:function(){this._initiated||(this._initiated=!0,socialNetwork.on("success_prepareMidroll",this.onPrepareMidroll,this),socialNetwork.on("success_showMidroll",this.onShowMidroll,this),socialNetwork.on("error_showMidroll",this.onErrorShowMidroll,this))},onPrepareMidroll:function(){this._prepared=!0},onErrorShowMidroll:function(){this._showErrorHandler&&this._showErrorHandler(),this._showSuccessHandler=null,this._showErrorHandler=null},onShowMidroll:function(){if(this._showSuccessHandler){var e=this;4e3<Date.now()-this._startTime?(this._showSuccessHandler(),this._showSuccessHandler=null,this._showErrorHandler=null,setTimeout(function(){e.prepareNextAd()},18e4)):(this._showErrorHandler&&this._showErrorHandler(),this._showSuccessHandler=null,this._showErrorHandler=null)}}}),VkWebRewardAD=Backbone.Model.extend({_prepared:!1,adsKey:"v",isAdReady:function(){return Boolean(this._prepared)},checkAvailable:function(){return"vkontakte"===network&&!window.mobile&&("undefined"!=typeof admanInit||(this._disabled=!0,!1))},prepareNextAd:function(){var t=this;t._disabled||admanInit({user_id:window.viewerId,app_id:window.appId,type:"rewarded",params:{preview:void 0}},function(e){t._prepared=!0,t._adman=e,0},function(){t._disabled=!0,(t._prepared=!1)&&console.log("[VkWebRewardAD] adman has no ads")})},showAd:function(e,t){var i=this;if(!i._prepared||!i._adman)return i._prepared=void 0,i._adman=void 0,void t();i._adman.onStarted(function(){"undefined"!=typeof admanStat&&admanStat(window.appId,window.viewerId)}),i._adman.onCompleted(function(){i._adman=void 0,e(),setTimeout(function(){i.prepareNextAd()},18e4)}),i._adman.onError(function(){i._adman=void 0,t()}),i._prepared=!1,i._adman.start("preroll")}}),VkBridgRewardAD=Backbone.Model.extend({_prepared:!1,adsKey:"v",isAdReady:function(){return this._prepared},checkAvailable:function(){return"vkontakte"===network&&!window.mobile&&("undefined"!=typeof vkBridge&&vkBridge.supports("VKWebAppShowNativeAds"))},prepareNextAd:function(){var t=this;this._prepared=!1,vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"reward"}).then(function(e){t._prepared=e.result})},showAd:function(t,i){var o=this;application.get("view").isFullScreen()&&application.get("view").exitFullScreen(),vkBridge.send("VKWebAppShowNativeAds",{ad_format:"reward"}).then(function(e){e.result?t():i(),setTimeout(function(){o.prepareNextAd()},18e4)}).catch(function(e){console.error("[vk] VkBridgeAdvertProvider show "+JSON.stringify(e)),i()})}}),minLevelFactor=1;(-1!==["test","odnoklassniki","vkontakte","mailru"].indexOf(network)||"undefined"!=typeof phonegapNetwork&&-1!==["test","odnoklassniki","vkontakte","mailru"].indexOf(phonegapNetwork))&&(minLevelFactor=2),Config.adsProviderList=[new TestAD,new VkBridgRewardAD,new OkWebRewardAD,new LifeStreetRewardAD],Config.adsRewards=new Backbone.Collection,Config.adsRewards.add(new RewardAD({id:"rewardAdForMoves",minLevel:36*minLevelFactor,notPaidTimeout:15552e3,tag:"moves"})),Config.adsRewards.add(new RewardAD({id:"rewardAdForBombs",minLevel:34*minLevelFactor,notPaidTimeout:15552e3,tag:"bombs"})),Config.livesForAd=1,Config.adsRewards.add(new RewardAD({id:"rewardAdForLives",minLevel:32*minLevelFactor,notPaidTimeout:15552e3,oncePerSession:!0,tag:"lives"})),Config.adsRewards.add(new RewardAD({id:"rewardAdMsg",minLevel:37*minLevelFactor,notPaidTimeout:15552e3,numberOfViewsPerDay:5,prize:30,tag:"msg"})),Config.adsRewards.add(new RewardAD({id:"rewardAdArtifactPart",tag:"artifactPart",cooldown:43200})),Config.adsRewards.add(new RewardAD({id:"rewardAdArtifactPart2",tag:"artifactPart2",cooldown:43200})),Config.adsRewards.add(new RewardAD({id:"basketArtefact",tag:"basketArtefact",cooldown:43200})),Config.adsRewards.add(new RewardAD({id:"diceAdventureArtifactPartsFree",tag:"diceAdventureArtifactPartsFree",cooldown:43200})),"test"!==network&&"odnoklassniki"!==network||Config.adsRewards.add(new RewardAD({id:"rewardAdForRum",minLevel:120,notPaidTimeout:15552e3,oncePerSession:!0,tag:"rum"})),Config.adsRewards.each(function(e){Config[e.get("id")]=e});var SimpleCrossPromo=Backbone.Model.extend({defaults:{id:"none",enabled:!1,minLevel:0,requiredDeviceType:void 0,requiredGender:void 0,targetLink:void 0,mobileTargetLink:void 0,fullLink:!1,randomCss:void 0,today:"0000-00-00",link:"#",available:!1},initialize:function(e){var t;this.set("today",(new Date).toJSON().slice(0,10)),(t=window.mobile?e.mobileTargetLink&&e.mobileTargetLink[network]:e.targetLink&&e.targetLink[network])&&(this.set("link",t),this.set("available",this.checkAvailable()))},checkAvailable:function(){return!!this.get("enabled")&&(!(this.get("minLevel")&&user.getRealLevel()<this.get("minLevel"))&&((void 0===this.get("requiredDeviceType")||window.deviceType===this.get("requiredDeviceType"))&&((void 0===this.get("requiredGender")||user.get("gender")===this.get("requiredGender"))&&(!!this.get("link")&&(!(user.get("paid")&&!this.get("includePaid"))&&getLocalStorage("lastShowCrossPromo_"+this.get("id"))!==this.get("today"))))))},run:function(){setLocalStorage("lastShowCrossPromo_"+this.get("id"),this.get("today")),new SimpleCrossPromoWindow({model:this}),user.set({actionName:"crosspromo_"+this.get("id"),actionEpisode:user.get("episode"),actionLevel:0,actionPrice:0},{validate:!1})}}),SimpleCrossPromos=Backbone.Collection.extend({model:SimpleCrossPromo});Application.on("ready",function(){if(!Config.simpleCrossPromo)return!1;var e=new SimpleCrossPromos(Config.simpleCrossPromo).find({available:!0});e&&application.on("main",function(){setTimeout(function(){application.windows.runAfterCloseAllWindows(function(){e.checkAvailable()&&"main"==application.get("page")&&(Boolean(Game&&Game._isWin)&&e.run())},300)})})});var SimpleCrossPromoWindow=TWindow.extend({templateClass:".simpleCrossPromoWindow_template",events:_.extend({"click .closeAndPlay":"closeAndPlay"},TWindow.prototype.events),onOpen:function(){user.set({actionName:"crossPromoShow",actionEpisode:episode.get("num"),actionLevel:0,actionPrice:0}),this.$el.addClass(this.model.get("id")),this.model.get("fullLink")&&this.$(".shadow").addClass("closeAndPlay"),this.model.get("randomCss")&&this.$el.addClass(RANDOM(this.model.get("randomCss"))),this.$(".windowTitle").html(messages.crossPromoWindowTitle[this.model.get("id")])},closeAndPlay:function(){"phonegap"===network?parent.postMessage({name:"openUrl",url:this.model.get("link")},"*"):window.open(this.model.get("link"),"_blank"),user.set({actionName:"crossPromoPlay",actionEpisode:episode.get("num"),actionLevel:0,actionPrice:0}),this.close()}});Application.on("ready",function(){var a=!1;function i(t){if("thz"!==t.type&&"offer"!==t.type){var e="facebook"===network?100*t.priceCurrency.USD:t.price,i=Application.lastQuickProduct==t.product,o={actionName:"$product: "+t.product+(i?"q":""),actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:e,paid:1};if(user.get("paid")||setTimeout(function(){user.set({actionName:"firstProduct: "+t.product,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:e})},1e3),"coinsWithGift"!==t.type&&"coins"!==t.type||(o.coins=new ObscureNumber(user.get("coins")+t.amount)),"gachaSpin"===t.type&&(o.spins=(user.get("spins")||0)+1),user.set(o),"good"===t.type&&goods.goodBuyed(t.goodName,t.workHours,!0),"punish"===t.type){if("game"!=application.get("page"))throw new Error("punish not in game");new PunishNowWindow}if("battlePass"===t.type&&t.world){var a=_.find(Config.bonusWorlds,function(e){return e.get("name")===t.world});a&&a.battlePass.boughtBattlePass()}if("bonusLevelTime"===t.type){if("game"!=application.get("page"))throw new Error("bonusLevelTime not in game");user.trigger("buyBonusLevelTime")}if("bonusLevelRefresh"===t.type&&user.trigger("buyBonusLevelRefresh"),"addMoves"===t.type){if("game"!=application.get("page"))throw new Error("addMoves not in game");user.trigger("buyAddMoves")}if("piggybank"===t.type&&PiggybankController.onPayment(t),"bundle"===t.type)for(var n=0;n<t.items.length;n++){var r=t.items[n],s=r.world;switch(s&&_.isString(s)&&(s=application.getWorldByName(s)),r.type){case"powerUp":user.setPowerUpAmount(r.name,user.getPowerUpAmount(r.name)+r.amount);break;case"good":goods.goodBuyed(r.name,r.amount);break;case"coins":user.set("coins",new ObscureNumber(user.get("coins")+r.amount));break;case"gachaSpin":user.set("spins",user.get("spins")+r.amount);break;case"prolong":var l=_slicedToArray(Config.bonusWorlds.map(function(e){return e.cmp("prolongate")}).filter(function(e){return e&&prices[e.getOffer().get("productId")]===t}),1)[0];l&&l.prolongate();break;case"PrizePointsProduct":var d=s.getComponent(PrizeController);d&&d.addPoints(r.amount);break;case"TicketsProduct":var c=s.getComponent(r.componentId);c&&c.addTickets(r.amount);break;case"ContinuityStageProduct":var g=s.getComponent("continuity");g&&g.giveReward(r.stage)}}user.trigger("buyProduct",t)}else{var u=t.product;u=u.substr(u.indexOf("_")+1),user.trigger("completeOffer",u)}}function t(){var e=0,t=[200,1e3,1e3,3e3,5e3,1e4,2e4,3e4,45e3,6e4],i=function(){t.length<=e||(setTimeout(o,t[e]),e++)};function o(){a||(a=!0,callService("../../../levelbase/src/services/loadpayqueue.php",function(e){0<e.length?n(e):i(),a=!1},fail))}i()}function n(e){_.each(e,function(e){var t=getProductById(e.productId);if(!t)throw new Error("Unknown product "+e.productId);user.processedPays.push(e.transactionId),i(t)})}socialNetwork.on("cancel_payment",function(){(function(){if(!application.toast)return;var e=messages.cancelPayToast;application.toast.showMessage({message:e,className:"buyCanceled"})})(),user.trigger("buyCancel")}),socialNetwork.on("success_payment",function(e){e.queue?t():i(e)}),socialNetwork.on("try_payment",function(e){e.queue&&t()}),user.on("buyProduct",function(e){!function(e){if(!application.toast)return;var t=_.template(messages.purchaseToast)({name:e.desc.product,amount:e.amount,type:e.type});application.toast.showMessage({message:t,className:"buyCompleted"})}(e)}),setTimeout(function(){n(application.AUTHORIZATION_DATA.payqueue)},100)}),FigureView.cacheTemplates=function(){FigureView.createByTemplate(".invisible .emptyTemplate"),FigureView.createByTemplate(".invisible .emptyTemplate",["disabledWrapper"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["fireFlowerDie"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_W"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_P"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_Y"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_B"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_R"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_G"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_N"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_0"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_U"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeMulticolorCell"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeArrowCell"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","collectTaskElem"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeBossCell"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","healthBoss"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","damageBoss"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","damageBossTask"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","barCellRemove"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["taskAmount"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["crabMouseCollect"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_R"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_G"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_B"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_Y"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_P"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frogfuelCell1","frogfuelCell_W"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece1","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece2","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece3","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece4","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece5","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide_remove_animatePiece6","decorator_hide_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece1","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece2","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece3","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece4","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece5","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece6","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece7","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece8","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide2_remove_animatePiece9","decorator_hide2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide3_remove_animatePiece1","decorator_hide3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide3_remove_animatePiece2","decorator_hide3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide3_remove_animatePiece3","decorator_hide3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide3_remove_animatePiece4","decorator_hide3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide4_remove_animatePiece1","decorator_hide4_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide4_remove_animatePiece2","decorator_hide4_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide4_remove_animatePiece3","decorator_hide4_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide4_remove_animatePiece4","decorator_hide4_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece1","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece2","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece3","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece4","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece5","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece6","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece7","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece8","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_hide5_remove_animatePiece9","decorator_hide5_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_remove_animatePiece1","decorator_blocked_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_remove_animatePiece2","decorator_blocked_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_remove_animatePiece3","decorator_blocked_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_remove_animatePiece4","decorator_blocked_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked2_remove_animatePiece1","decorator_blocked2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked2_remove_animatePiece2","decorator_blocked2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked2_remove_animatePiece3","decorator_blocked2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked2_remove_animatePiece4","decorator_blocked2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked3_remove_animatePiece1","decorator_blocked3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked3_remove_animatePiece2","decorator_blocked3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked3_remove_animatePiece3","decorator_blocked3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked3_remove_animatePiece4","decorator_blocked3_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_alt_remove_animatePiece1","decorator_blocked_alt_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_alt_remove_animatePiece2","decorator_blocked_alt_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_alt_remove_animatePiece3","decorator_blocked_alt_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_blocked_alt_remove_animatePiece4","decorator_blocked_alt_remove_animatePiece"]),FigureView.createByTemplate(".invisible .decorator_chocolate"),FigureView.createByTemplate(".invisible .chocolateAnnihilation"),FigureView.createByTemplate(".invisible .decorator_crab"),FigureView.createByTemplate(".invisible .moveCrab"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_crab"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_hunter"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCrabCell"]),FigureView.createByTemplate(".invisible .decorator_crab2"),FigureView.createByTemplate(".invisible .decorator_eel"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crab2_remove_animatePiece1","decorator_crab2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crab2_remove_animatePiece2","decorator_crab2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crab2_remove_animatePiece3","decorator_crab2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crab2_remove_animatePiece4","decorator_crab2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .decorator_crabIce"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce_remove_animatePiece1","decorator_crabIce_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce_remove_animatePiece2","decorator_crabIce_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce_remove_animatePiece3","decorator_crabIce_remove_animatePiece"]),FigureView.createByTemplate(".invisible .decorator_crabIce2"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce2_remove_animatePiece1","decorator_crabIce2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce2_remove_animatePiece2","decorator_crabIce2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabIce2_remove_animatePiece3","decorator_crabIce2_remove_animatePiece"]),FigureView.createByTemplate(".invisible .decorator_spiderweb"),FigureView.createByTemplate(".invisible .decorator_crabBomb"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabBomb_remove_animatePiece1","decorator_crabBomb_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabBomb_remove_animatePiece2","decorator_crabBomb_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_crabBomb_remove_animatePiece3","decorator_crabBomb_remove_animatePiece"]),FigureView.createByTemplate(".invisible .decorator_spiderweb"),FigureView.createByTemplate(".invisible .spiderwebAnnihilation"),FigureView.createByTemplate(".invisible .sharkCell",["color_none"]),FigureView.createByTemplate(".invisible .decorator_changecolor"),FigureView.createByTemplate(".invisible .pizzaCell",["color_none"]),FigureView.createByTemplate(".invisible .pizzaHead"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["diePizza"]),FigureView.createByTemplate(".invisible .diePizza"),FigureView.createByTemplate(".invisible .tornadoCell",["color_none"]),FigureView.createByTemplate(".invisible .flyTornado"),FigureView.createByTemplate(".invisible .defaultCell",["color_none"]),FigureView.createByTemplate(".invisible .bombCell",["color_W"]),FigureView.createByTemplate(".invisible .bombCell",["color_P"]),FigureView.createByTemplate(".invisible .bombCell",["color_Y"]),FigureView.createByTemplate(".invisible .bombCell",["color_B"]),FigureView.createByTemplate(".invisible .bombCell",["color_R"]),FigureView.createByTemplate(".invisible .bombCell",["color_G"]),FigureView.createByTemplate(".invisible .bombCell",["color_N"]),FigureView.createByTemplate(".invisible .bombExplode"),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeBombCell"]),FigureView.createByTemplate(".invisible .crabFarmCell",["color_none"]),FigureView.createByTemplate(".invisible .crabFarmCreateCrab"),FigureView.createByTemplate(".invisible .pearlCell",["color_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_pearl"]),FigureView.createByTemplate(".invisible .pumpkinCell"),FigureView.createByTemplate(".invisible .attribute_key"),FigureView.createByTemplate(".invisible .attribute_coin"),FigureView.createByTemplate(".invisible .skatCell",["color_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_skat"]),FigureView.createByTemplate(".invisible .wellCell",["color_none"]),FigureView.createByTemplate(".invisible .ghostCell",["color_none"]),FigureView.createByTemplate(".invisible .walrusHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .walrusBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .walrusFly"),FigureView.createByTemplate(".invisible .alligatorHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .alligatorBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .alligatorFly"),FigureView.createByTemplate(".invisible .snakeHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .snakeBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .snakeFly"),FigureView.createByTemplate(".invisible .crabMouseFarmCell",["color_none"]),FigureView.createByTemplate(".invisible .crabMouseFarmCreateCrabMouse"),FigureView.createByTemplate(".invisible .mouseFarmCellCreateItem"),FigureView.createByTemplate(".invisible .decorator_crabMouse"),FigureView.createByTemplate(".invisible .decorator_crabMouse",["stable"]),FigureView.createByTemplate(".invisible .decorator_greedypirate"),FigureView.createByTemplate(".invisible .decorator_hunter"),FigureView.createByTemplate(".invisible .gravitycoreCell"),FigureView.createByTemplate(".invisible .bigChestHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .bigChestBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .coinChestHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .coinChestBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .genrymorganHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .genrymorganBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .genrymorganFly"),FigureView.createByTemplate(".invisible .genrymorganLeftHand"),FigureView.createByTemplate(".invisible .genrymorganRightHand"),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_shirt_mark",["attribute_color_G"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_pants_mark",["attribute_color_G"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_hat_mark",["attribute_color_G"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_boots_mark",["attribute_color_G"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_crystal",["attribute_color_G"]),FigureView.createByTemplate(".invisible .parrotCell",["color_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_parrotDoor"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_parrotLock"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_parrot"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["specialItemRemove"]),FigureView.createByTemplate(".invisible .decorator_monkey"),FigureView.createByTemplate(".invisible .palmHeadCell",["color_none"]),FigureView.createByTemplate(".invisible .palmBodyCell",["color_none"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_falling",["attribute_color_G"]),FigureView.createByTemplate(".invisible .decorator_crabMedusa"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_crabMedusa"]),FigureView.createByTemplate(".invisible .turtleCell",["color_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_turtle"]),FigureView.createByTemplate(".invisible .flowerCell",["color_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["dieFlower"]),FigureView.createByTemplate(".invisible .dieFlower"),FigureView.createByTemplate(".invisible .flowerHead"),FigureView.createByTemplate(".invisible .fishBallCell",["color_none"]),FigureView.createByTemplate(".invisible .fishBallCell",["create"]),FigureView.createByTemplate(".invisible .chestCell",["color_none"]),FigureView.createByTemplate(".invisible .defaultCell"),FigureView.createByTemplate(".invisible .bulbCell",["color_none"]),FigureView.createByTemplate(".invisible .medusaCell"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["medusaDie"]),FigureView.createByTemplate(".invisible .defaultCell",["maelstorm","leftDirection"]),FigureView.createByTemplate(".invisible .defaultCell",["maelstorm","rightDirection"]),FigureView.createByTemplate(".invisible .defaultCell",["stream","stream_up"]),FigureView.createByTemplate(".invisible .defaultCell",["stream","stream_down"]),FigureView.createByTemplate(".invisible .defaultCell",["stream","stream_left"]),FigureView.createByTemplate(".invisible .defaultCell",["stream","stream_right"]),FigureView.createByTemplate(".invisible .defaultCell",["frozen","frozen_amonite1"]),FigureView.createByTemplate(".invisible .defaultCell",["frozen","frozen_amonite2"]),FigureView.createByTemplate(".invisible .defaultCell",["frozen","frozen_amonite3"]),FigureView.createByTemplate(".invisible .defaultCell",["frozen","frozenegg"]),FigureView.createByTemplate(".invisible .defaultCell",["sail"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_W"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_P"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_Y"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_B"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_R"]),FigureView.createByTemplate(".invisible .magnetoCell",["color_G"]),FigureView.createByTemplate(".invisible .arrow"),FigureView.createByTemplate(".invisible .hammerTemplate"),FigureView.createByTemplate(".invisible .vortexTemplate"),FigureView.createByTemplate(".invisible .multicolorCell",["color_none"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_W"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_P"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_Y"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_B"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_R"]),FigureView.createByTemplate(".invisible .attribute_key",["attribute_color_G"]),FigureView.createByTemplate(".invisible .cellBgTemplate",["cellBg_0"]),FigureView.createByTemplate(".invisible .cellBgTemplate",["cellBg_1"]),FigureView.createByTemplate(".invisible .floorLevel",["floorLevel1"]),FigureView.createByTemplate(".invisible .floorLevel",["floorLevel2"]),FigureView.createByTemplate(".invisible .floorLevel",["floorLevel3"]),FigureView.createByTemplate(".invisible .defaultCell",["color_P"]),FigureView.createByTemplate(".invisible .defaultCell",["color_B"]),FigureView.createByTemplate(".invisible .defaultCell",["color_Y"]),FigureView.createByTemplate(".invisible .defaultCell",["color_W"]),FigureView.createByTemplate(".invisible .defaultCell",["color_G"]),FigureView.createByTemplate(".invisible .defaultCell",["color_R"]),FigureView.createByTemplate(".invisible .defaultCell",["color_N"]),FigureView.createByTemplate(".invisible .defaultCell",["color_0"]),FigureView.createByTemplate(".invisible .defaultCell",["color_U"]),FigureView.createByTemplate(".invisible .defaultCell",["color_1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_2"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_R"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_G"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_B"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_Y"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_P"]),FigureView.createByTemplate(".invisible .caviarCell",["caviarCell3","caviarCell_W"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast1","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast2","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast3","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast4","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast5","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast6","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast7","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast8","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["iceBlast9","iceBlast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast1","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast2","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast3","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast4","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast5","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast6","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast7","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast8","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice1Blast9","ice1Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast1","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast2","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast3","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast4","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast5","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast6","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast7","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast8","ice2Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice2Blast9","ice2Blast"]),FigureView.createByTemplate(".invisible .emptyTemplate",["floorLevelAnimation2"]),FigureView.createByTemplate(".invisible .emptyTemplate",["floorLevelAnimation3"]),FigureView.createByTemplate(".invisible .emptyTemplate",["newyear2018floorLevelAnimation"]),FigureView.createByTemplate(".invisible .emptyTemplate",["attribute","attribute_coin"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_G"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_B"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_W"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_R"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_Y"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_P"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_N"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_0"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_U"]),FigureView.createByTemplate(".invisible .decorator_hide"),FigureView.createByTemplate(".invisible .decorator_hide2"),FigureView.createByTemplate(".invisible .decorator_hide3"),FigureView.createByTemplate(".invisible .decorator_hide4"),FigureView.createByTemplate(".invisible .decorator_hide5"),FigureView.createByTemplate(".invisible .decorator_blocked"),FigureView.createByTemplate(".invisible .decorator_blocked2"),FigureView.createByTemplate(".invisible .decorator_blocked3"),FigureView.createByTemplate(".invisible .decorator_blocked_alt"),FigureView.createByTemplate(".invisible .arrow",["dir_horizontal"]),FigureView.createByTemplate(".invisible .arrow",["dir_vertical"]),FigureView.createByTemplate(".invisible .arrow",["dir_both"]),FigureView.createByTemplate(".invisible .selectedTemplate"),FigureView.createByTemplate(".invisible .smallFire"),FigureView.createByTemplate(".invisible .lightning"),FigureView.createByTemplate(".invisible .fallingStar"),FigureView.createByTemplate(".invisible .powerUpHighlightTemplate"),FigureView.createByTemplate(".invisible .emptyTemplate",["disabledHolder"]),FigureView.createByTemplate(".invisible .emptyTemplate",["disabledCellHolder"]),FigureView.createByTemplate(".invisible .forceFieldDisabled"),FigureView.createByTemplate(".invisible .forceFieldDisabledArrow",["fieldDisabledCell"]),FigureView.createByTemplate(".invisible .forceFieldDisabledArrow"),FigureView.createByTemplate(".invisible .fishCell",["color_none"]),FigureView.createByTemplate(".invisible .gameProgress"),FigureView.createByTemplate(".invisible .decorator_stickyChain"),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_stickyChain_remove_animatePiece1","decorator_stickyChain_remove_animatePiece"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["decorator_stickyChain_remove_animatePiece2","decorator_stickyChain_remove_animatePiece"]),FigureView.createByTemplate(".invisible .cursorTemplate",["powerUpCursor","cursorHammer"]),FigureView.createByTemplate(".invisible .cursorTemplate",["powerUpCursor","cursorLighting"]),FigureView.createByTemplate(".invisible .cursorTemplate",["powerUpCursor","cursorDeleteRowPowerUp"]),FigureView.createByTemplate(".gull"),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_R"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_G"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_B"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_Y"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_P"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_W"]),FigureView.createByTemplate(".invisible .popUpColorCell",["popUpColor_B","life1"]),FigureView.createByTemplate(".invisible .popUpColorExplode"),FigureView.createByTemplate(".invisible .decorator_fishnet"),FigureView.createByTemplate(".invisible .decorator_fishnet",["stable"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_none"]),FigureView.createByTemplate(".invisible .punishCannon"),FigureView.createByTemplate(".invisible .punishCannonExplosion"),FigureView.createByTemplate(".invisible .emptyTemplate",["magicWandLighting"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["groundExplode1","groundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["groundExplode2","groundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["groundExplode3","groundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["groundExplode4","groundExplode"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","coralRemove"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["coralBg"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","blackholeRemove"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["blackholeBg"]),FigureView.createByTemplate(".invisible .shooterCell",["shooter","monkey"]),FigureView.createByTemplate(".invisible .frogCell",["frog"]),FigureView.createByTemplate(".invisible .frogfuelCell",["frog"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","fireFlowerCellRemove"]),FigureView.createByTemplate(".invisible .fireFlowerFireballExplosion"),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","fireFlower"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","twinklesAllActivated"]),FigureView.createByTemplate(".invisible .emptyTemplate",["floorLevelAnimation1"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","twinkle"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodeCell_none"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_catbox"]),FigureView.createByTemplate(".invisible .defaultCell",["frozenegg","frozen_frozenegg"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["icebergExplode1","icebergExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["icebergExplode2","icebergExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["icebergExplode3","icebergExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["icebergExplode4","icebergExplode"]),FigureView.createByTemplate(".invisible .explosion",["cell_explode_color_"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part1"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part2"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part3"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part4"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part5"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part6"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part7"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part8"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part9"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part10"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part11"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part12"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part13"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part14"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part15"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part16"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part17"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part18"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part19"]),FigureView.createByTemplate(".invisible .artifactPartCell",["part20"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["parrotExplode1","parrotExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["parrotExplode2","parrotExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["parrotExplode3","parrotExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["parrotExplode4","parrotExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["die_parrotShard"]),FigureView.createByTemplate(".invisible .decorator_crab",["stable"]),FigureView.createByTemplate(".invisible .emptyTemplate",["attribute","attribute_falling"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["muffinRackBg"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["gravityGroundExplode1","gravityGroundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["gravityGroundExplode2","gravityGroundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["gravityGroundExplode3","gravityGroundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["gravityGroundExplode4","gravityGroundExplode"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice3Blast1","ice3Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice3Blast2","ice3Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice3Blast3","ice3Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice3Blast4","ice3Blast"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["ice3Blast5","ice3Blast"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","explodePastureCell"]),FigureView.createByTemplate(".invisible .defaultCell",["color_R","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_W","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_P","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_G","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_Y","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_B","life1"]),FigureView.createByTemplate(".invisible .multicolorCell",["color_none","life1"]),FigureView.createByTemplate(".invisible .defaultCell",["color_0","life1"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["cork"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["lockFlying1","chestLock"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["lockFlying2","chestLock"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["lockFlying3","chestLock"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["lockFlying4","chestLock"]),FigureView.createByTemplate(".invisible .fallDownPieceTemplate",["lockFlying5","chestLock"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","removeSeagull"]),FigureView.createByTemplate(".invisible .fortExplode"),FigureView.createByTemplate(".invisible .glowwormCell",["color_none"]),FigureView.createByTemplate(".invisible .emptyTemplate",["secondAttribute","secondAttribute_prizePointMark"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","vaseBoxTakeLife"]),FigureView.createByTemplate(".invisible .emptyTextTemplate",["fieldPoints","vaseBoxOpen"])},Application.on("ready",function(){setTimeout(function(){if(window.performance&&window.performance.now&&Config.statistics){var e=user.get("firstTime")||!Config.statistics.throttle||Math.random()<Config.statistics.throttle;if(Config.statistics.loadTime&&e){var t=window.performance.now(),i=window.beginJSFiles[0].split("/")[2];void 0===i&&(i="not cdn"),setTimeout(function(){callServiceAddInQueue("../../../levelbase/src/services/loadstat.php",{loadTime:t,cdn:i,os:application.system.os,browser:application.system.browser,version:application.system.version,firstTime:user.get("firstTime")?1:0})},5e3)}}},0)}),Application.on("ready",function(){var e,t,i,o=!1;function a(){document[e]?o||("game"===application.get("page")&&canvas&&!canvas.pausing&&canvas.pause(),soundManager.pause(),o=!0,i&&clearInterval(i),i=setInterval(a,1e3)):o&&!application.windows.anyWindowOpen()&&("game"===application.get("page")&&canvas&&canvas.pausing&&canvas.resume(),soundManager.resume(),canvas&&canvas.pausing||(o=!1,i&&clearInterval(i),i=void 0))}void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document.addEventListener(t,a,!1)});var TimeAction=Backbone.Model.extend({defaults:{name:"action",network:null,product:"",begin:!1,end:!1,duration:86400,maxOffersAmount:1,purchaseCount:0,maxLoops:0,episode:1,level:12,forNotPaid:!1,active:!1,paid:void 0,beginTime:null,bought:!1},idAttribute:"name",initialize:function(){this.listenTo(user,"buyProduct",this.onBuyProduct)},render:function(){this.buttonView||(this.buttonView=new TimerActionView({model:this,el:$(".invisible .timeAction").clone().appendTo("#timeActions")})),this.buttonView.render()},getTimer:function(){return Math.max(0,this.get("beginTime")+this.get("duration")-application.getCurrentServerTime())},onBuyProduct:function(t){prices[this.get("product")]==t&&(this.set("bought",!0),this.set("purchaseCount",this.get("purchaseCount")+1),callService("../../../levelbase/src/services/complatetimeaction.php",_.bind(function(e){new AnimatedPrizesWindow({prizes:new UserPrizes(t.items),notGive:!0,world:"deferredPrizes",message:!1}),this.isActive()&&this.open()},this),function(){},{action:this.get("name")})),this.set("active",this.isActive())},checkActionTime:function(){if(!this.get("bought")){var e=this.get("begin");return e&&this.get("beginTime")+this.get("duration")<e.getTime()/1e3?this.restart():Promise.resolve()}},isInDaysRange:function(){if(!this.get("begin")&&!this.get("end"))return!0;var e=new Date(this.get("begin")||0).getTime()/1e3,t=new Date(this.get("end")||0).getTime()/1e3;return!(e&&application.getCurrentServerTime()<e)&&!(t&&application.getCurrentServerTime()>t)},isAvailability:function(){if(this.get("network")){if("phonegap"===network&&-1===this.get("network").indexOf(phonegapNetwork))return!1;if("wizq"===network&&-1===this.get("network").indexOf(wizqnetwork))return!1;if(-1===["phonegap","wizq"].indexOf(network)&&-1===this.get("network").indexOf(network))return!1}if(user.get("episode")<this.get("episode")||user.get("episode")==this.get("episode")&&user.get("level")<this.get("level"))return!1;if(!this.isInDaysRange())return!1;if(void 0!==this.get("paid")){if(this.get("paid")!==user.get("paid"))return!1;if(this.get("daysFromPay")&&user.get("lastPayDate"))if(application.getCurrentServerTime()-new Date(user.get("lastPayDate")).getTime()/1e3<86400*this.get("daysFromPay"))return!1}return!0},init:function(){var e=this;this.isAvailability()&&this.loadFromServer(!0).then(function(){return e.checkActionTime()}).then(_.bind(function(){this.get("active")||this.isFinished()||this.run()},this))},restart:function(){return service("../../../levelbase/src/services/gettimeaction.php",{action:this.get("name"),restart:!0,activate:!0}).then(_.bind(function(e){setLocalStorage(this.getShowActionStorageKey(),!1),this.set("beginTime",e.time),this.set("purchaseCount",0),e.first&&this.set("first",e.first)},this)).then(_.bind(function(){return this.run()},this))},run:function(){this.set("active",this.isActive()),this.render(),setTimeout(_.bind(this.finish,this),1e3*this.getTimer()),this.isActive()&&(setLocalStorage(this.getShowActionStorageKey(),!0),this.get("first")||this.tryOpen())},tryOpen:function(){this.anyCost()?this.open():setTimeout(_.bind(this.tryOpen,this),1e3)},anyCost:function(){return _.any(_.pluck(prices,"price"),function(e){return 0<e})},finish:function(){this.set("active",this.isActive())},getShowActionStorageKey:function(){return this.get("name")+"Showed"},isActive:function(){if(this.get("forNotPaid")&&(!getLocalStorage(this.getShowActionStorageKey(),!1)&&0===this.get("purchaseCount")&&user.get("paid")))return!1;return 0<this.getTimer()&&0<this.getOfferCount()},isFinished:function(){return this.get("beginTime")+this.get("duration")<application.getCurrentServerTime()},getOfferCount:function(){return Math.max(0,this.get("maxOffersAmount")-this.get("purchaseCount"))},loadFromServer:function(e){return service("../../../levelbase/src/services/gettimeaction.php",{action:this.get("name"),activate:!!e}).then(_.bind(function(e){this.set("bought",e.bought),this.set("beginTime",e.time),this.set("purchaseCount",e.purchaseCount),e.first&&(this.set("first",e.first),setLocalStorage(this.getShowActionStorageKey(),!1))},this))},buy:function(){var e=prices[this.get("product")];e&&showBuy(e)},canShowNow:function(){return!application.windows.anyWindowOpen()&&(!application.get("waitWindowLoading")&&"main"===application.get("page"))},waitQueue:function(){var t=this;return this.canShowNow()?Promise.resolve():new Promise(function(e){t.listenTo(application,"change:page, windowsClosed",function(){t.canShowNow()&&(t.stopListening(application),e())})})},open:function(){var e=this;this.waitQueue().then(function(){episode.isBonusWorld()&&!episode.isFreeEpisode()||new TimeActionWindow({model:e,firstPriority:!0})})}}),TimerActionView=Backbone.View.extend({events:{"click .target":"open","touchend .target":"open"},initialize:function(){this.$el.addClass(this.model.get("name")),this.model.get("css")&&this.$el.addClass(this.model.get("css")),this.render(),this.listenTo(this.model,"change:active",this.render),this.listenTo(episode,"change:num",this.render)},render:function(){this.$el.toggleClass("active",this.model.isActive()),$("#mainAppWrapper,#container").toggleClass(this.model.get("name")+"Available",this.model.isActive()),this.renderTimer()},renderTimer:function(){if(this.model.isActive()){var e=this.model.getTimer();clearTimeout(this.timer);var t="";86400<e?t=formatTime("%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1],e):3600<e?(t=formatPeriod(Math.ceil(e/60)),this.timer=setTimeout(_.bind(this.renderTimer,this),1e4)):(t=formatTime("%i:%s",e),this.timer=setTimeout(_.bind(this.renderTimer,this),1e3)),this.$(".timer").html(t)}},open:function(){this.model.open()}}),TimeActionWindow=TWindow.extend({templateClass:".timeActionWindow_template",events:{"click .close":"close","touchend .close":"close","click .buyBtn":"buy","touchend .buyBtn":"buy"},renderTimer:function(){if(!this.closed){clearTimeout(this.timer);var e=this.model.getTimer(),t="";86400<e?t=formatTime("%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1],e):3600<e?(t=formatPeriod(Math.ceil(e/60),!0),this.timer=setTimeout(_.bind(this.renderTimer,this),1e4)):(t=formatTime("%i:%s",e),this.timer=setTimeout(_.bind(this.renderTimer,this),1e3)),this.$(".timer").html(t),this.model.isActive()?setTimeout(_.bind(this.renderTimer,this),1e3):this.close()}},onOpen:function(){var o=this.model.get("windowOptions");setTimeout(_.bind(this.renderTimer,this),100),this.$el.addClass(this.model.get("name")),this.model.get("css")&&this.$el.addClass(this.model.get("css"));var a=$(".invisible .timeActionItem"),n=this.$(".items"),e=new Shop.Offer({productId:this.model.get("product")});if(this.$(".title").html(o?messages[o.title]:messages.timeActionTitle),o){var t=o.oldPriceText||"timeActionOldPriceText";this.$(".infoText").html(messages[t]);var i=o.timerText||"addCoinsTimerLast";this.$(".timerText").html(messages[i])}var r=e.getProducts();if(1<this.model.get("maxOffersAmount")){var s=o?o.packAmountText:"addCoinsTimerLast";this.$(".packAmountText").html(messages[s]),this.$(".packAmount").html(this.model.getOfferCount())}r.forEach(function(e){var t=a.clone().appendTo(n),i=o?o.amountPrefix:"";t.addClass(e.getName()),"good"===e.getType()?t.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):t.find(".amount").html(i+e.getDisplayAmount())},this),this.$(".price").html(e.getDisplayPrice()),e.getOldPrice()&&(this.$el.addClass("hasOldPrice"),this.$(".oldPrice").html(e.getOldDisplayPrice()))},buy:function(){this.model.buy(),this.close()}});Application.on("ready",function(){if(application.timeActions=new Backbone.Collection,Config.timeActions)for(var e=Config.timeActions,t=0;t<e.length;t++){var i=new TimeAction(e[t]);application.timeActions.add(i),i.init()}});var AllowedProps={Figure:["cache","width","height","background-width","background-height","background-image","background-position-x","background-position-y","margin-left","margin-top","scale-x","scale-y","scale","x","y","rotate","opacity","left","background-color","backgroundXOffset","backgroundYOffset"]};AllowedProps.TextFigure=_.union(AllowedProps.Figure,["cache","color","textAlign","font","text-left","text-top","strokeStyle","lineWidth"]),console.debug=console.debug||console.log||_.noop;var applyDebugFigure=function(){};Application.on("ready",applyDebugFigure);var QuickPurchase=Backbone.View.extend({events:{"click .product":"buy","click .close":"close"},render:function(){this.$(".products").empty(),this.$el.appendTo(".frameContainer"),this.collection.forEach(this.renderItem,this)},renderItem:function(e){var t=$(".invisible .quickPurchaseProduct").clone().data("model",e).addClass(e.get("type")).appendTo(this.$(".products"));switch(t.find(".price").html(e.get("desc").price),e.get("type")){case"coins":t.find(".amount").html(e.get("amount"));break;case"good":t.addClass(e.get("goodName")).find(".amount").html(formatPeriod(60*e.get("workHours"),!0));break;default:throw new Error('Not defined type "'+e.get("type")+'" product in QuickPurchase')}},buy:function(e){showBuy($(e.currentTarget).data("model").attributes)},close:function(){this.remove()}});Application.once("ready",function(){if(Config.quickPurchase&&-1!=Config.quickPurchase.networks.indexOf(network)){var e=_.map(Config.quickPurchase.products,function(e){return _.isArray(e)&&(e=RANDOM(e)),prices[e]});new QuickPurchase({el:$(".invisible .QuickPurchase").clone(),collection:new Backbone.Collection(e)}).render()}});var CoinsPromoWindow=TWindow.extend({templateClass:".coinspromo_template",events:_.extend({"click .buy":"buy"},TWindow.prototype.events),onOpen:function(){this.$(".price").html(this.options.product.desc.price)},buy:function(){this.close(),showBuy(this.options.product)}},{init:function(t){user.once("buyProduct",function(e){-1==t.indexOf(e.product)||getLocalStorage("coinsPromo")||(setLocalStorage("coinsPromo",!0),new CoinsPromoWindow({product:prices.coins_promo}))})}}),WDc,_Dc;Application.on("ready",function(){if(Config.coinsPromo){if(Config.coinsPromo.networks&&-1==Config.coinsPromo.networks.indexOf(network))return;if(Config.coinsPromo.episode&&Config.coinsPromo.episode>user.get("episode"))return;CoinsPromoWindow.init(Config.coinsPromo.products)}}),FailedWindow.prototype.onOpen=(WDc=FailedWindow.prototype.onOpen,function(){var o=this.$(".tasks");return gameView.tasksView.tasks.each(function(e){var t=$(".invisible .task."+e.get("cssClass"));0===t.length&&(t=$(".invisible .task.noClass"));var i=t.clone().addClass(e.get("cssClass")).removeClass("noClass");i.find(".taskNeedAmount").text(Math.max(e.get("beginAmount"),e.get("amount"),1*e.get("amount")+e.get("collectedAmount"))),i.find(".taskAmount").text(e.get("amount")),i.find(".taskCollectAmount").text(e.get("collectedAmount")),i.find(".taskName").text(e.get("name")),e.get("completed")&&i.addClass("complete"),e.get("cellClass")===BossCell&&i.addClass(application.level.bossName+"Task"),o.append(i)},this),WDc.call(this)}),FailedWindow.prototype.play=(_Dc=FailedWindow.prototype.play,function(){return user.skipLevelForceOnce=!0,_Dc.call(this)});var GDPRWindow=TWindow.extend({templateClass:".gdprWindow_template",events:{"click .close":"close"},onClose:function(){TWindow.prototype.onClose.call(this),setLocalStorage("gdpr",1)}});Application.on("ready",function(){("facebook"===network||"undefined"!=typeof deviceType&&2===deviceType)&&(getLocalStorage("gdpr")||new GDPRWindow)});var AchievmentsWindow=TWindow.extend({templateClass:".achievmentswindow_template",events:_.extend({"click .buyBtn":"levelUp","click .myAchievmentsArrowLeft":"prevPage","touchend .myAchievmentsArrowLeft":"prevPage","click .myAchievmentsArrowRight":"nextPage","touchend .myAchievmentsArrowRight":"nextPage"},TWindow.prototype.events),prevPage:function(){var e=$(".achievmentsWrapper").height(),t=$(".achievments"),i=(t.height(),parseInt(t.css("top"))+e);return-i<0&&(i=0),t.css("top",i+"px"),this.updateButton(),!1},nextPage:function(){var e=$(".achievmentsWrapper").height(),t=$(".achievments"),i=t.height(),o=parseInt(t.css("top"))||0;return 20-i<(o-=e)&&t.css("top",o+"px"),this.updateButton(),!1},updateButton:function(){var e=$(".achievmentsWrapper").height(),t=$(".achievments"),i=t.height(),o=parseInt(t.css("top"))||0;this.$(".myAchievmentsArrowLeft").toggleClass("disabled",!o),this.$(".myAchievmentsArrowRight").toggleClass("disabled",o-e<=20-i)},levelUp:function(e){var t=$(e.currentTarget).parents(".achievment").data("model");t.get("loading")||(new AchievmentsWindow({collection:this.collection,firstPriority:!0}),new AchievementDoneWindow({model:t,firstPriority:!0}),this.close())},onOpen:function(){this.page=0,this.render(),this.listenTo(this.collection,"change",this.onChange)},render:function(){var i=this.$(".invisible .achievment"),o=this.$(".achievments");o.empty();var a=0,n=0;this.collection.each(function(e){if(e.get("isAvailable")){var t=i.clone().data("model",e).addClass("achievment-"+e.get("id")).addClass(e.get("type")).addClass(e.get("name")).appendTo(o);this.renderItem(t,e),n+=e.get("levels").length,a+=e.get("level")}},this),this.$(".totalStars .starsAmount .current").html(a),this.$(".totalStars .starsAmount .total").html(n),this.updateButton()},renderItem:function(i,e){var t=messages.achievments[e.get("name")],o=this.$(".invisible .achievment-prize"),a=i.find(".prizes").empty();_.each(t,function(e,t){i.find("."+t).html(e)}),i.toggleClass("available",e.get("isAvailable")),i.toggleClass("levelUp",e.get("levelUp")),_.range(e.get("levels").length).forEach(function(e){i.removeClass("level"+e)}),i.addClass("level"+e.get("level")),i.find(".total").html(e.getTotal());var n=e.isComplete()?e.getTotal():e.getProgress();i.find(".progress").html(n);var r=n/e.getTotal()*100;100<r&&(r=100),i.toggleClass("halfDone",50<=r),i.find(".progressLine").css("width",r+"%"),e.isComplete()?i.addClass("complete"):_.each(e.getPrizes(),function(e){var t=o.clone().appendTo(a);t.addClass(e.cssClass),t.find(".amount").html(e.amount||"")})},onChange:function(e){this.renderItem(this.$(".achievment-"+e.get("id")),e)}}),AchievementDoneWindow=TWindow.extend({templateClass:".achievmentOpenedWindow_template",onOpenSound:"championwindow",events:_.extend({"click .achievmentOpenedPublic":"close","click .needPublicCheckbox":"togglePublicCheckbox"},TWindow.prototype.events),offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox(),this.rememberCheckboxState()},onClose:function(){this.model.levelUp(_.bind(function(){var e=this.model.get("level"),t=this.model.get("levels"),i=this.model.get("name");this.needPublic&&user.defaultPublication(i+"AchievementDone"+e+"Publication");var o=user.get("coins");_.each(t[e-1].prize,_.bind(function(e){"coins"==e.type&&(o=new ObscureNumber(o.get()+e.amount)),"powerUp"==e.type&&user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0),"good"==e.type&&goods.goodBuyed(e.name,e.amount),"gift"==e.type&&void 0!==Gifts&&Gifts.receiveGift(Gifts.findGiftById(e.giftId))},this)),user.set({powerUps:user.calcPowerUps(),coins:o})},this))},onOpen:function(){this.applyCheckboxState();var e=this.model.get("level")+1,t=this.model.get("levels");this.$el.addClass("achievment-"+this.model.get("id")).addClass(this.model.get("type")).addClass(this.model.get("name")).addClass("level"+e);var i=messages.achievments[this.model.get("name")];_.each(i,function(e,t){this.$("."+t).html(e)},this);var o=this.$(".invisible .achievment-prize"),a=this.$(".prizes").empty();_.each(t[e-1].prize,function(e){var t=o.clone().appendTo(a);t.addClass(e.cssClass),t.find(".amount").html(e.amount||"")})}}),Achievement=Backbone.Model.extend({defaults:{progress:0,level:0,userLevel:0,resetProgress:!1,levelUp:!1,gameObject:!1,listenObject:null,mobile:!0,networks:void 0,eventName:null},isAvailable:function(){if(window.mobile&&!1===this.get("mobile"))return!1;if(this.get("networks")){if("phonegap"===network&&-1===this.get("networks").indexOf(phonegapNetwork))return!1;if("wizq"===network&&-1===this.get("networks").indexOf(wizqnetwork))return!1;if(-1===["phonegap","wizq"].indexOf(network)&&-1===this.get("networks").indexOf(network))return!1}return!(this.get("userLevel")>user.getRealLevel())},checkAvailable:function(){return this.set("isAvailable",this.isAvailable()),this.get("isAvailable")},initialize:function(e){this.checkAvailable()},process:function(e,t,i){this.checkAvailable()&&this.onProcess(e,t,i)},onProcess:function(e){},onAfterInit:function(){this.get("gameObject")?user.on("createNewGame",function(e,t){this.listenTo(Game,this.get("eventName"),this.process)},this):this.listenTo(this.get("listenObject"),this.get("eventName"),this.process)},setProgress:function(e){this.set("loading",!0),callService("../../../gems/site/achievements/services/setprogress.php",_.bind(function(e){this.set({progress:1*e.progress,loading:!1}),this.checkLevel()},this),function(){},{progress:e,achievementId:this.get("id")})},getTotal:function(){var e=this.get("levels"),t=this.get("level");return t>=e.length&&(t=e.length-1),e[t].value},getProgress:function(){return this.get("progress")},getPrizes:function(){return this.get("levels")[this.get("level")].prize},checkLevel:function(){return this.set("levelUp",!this.isComplete()&&this.isUpLevel()),this.get("levelUp")},isUpLevel:function(){return this.getTotal()<=this.get("progress")},isComplete:function(){return this.get("level")>=this.get("levels").length},levelUp:function(t){this.checkLevel()?(this.set("loading",!0),callService("../../../gems/site/achievements/services/levelup.php",_.bind(function(e){this.set({progress:1*e.progress,level:1*e.level}),this.set("levelUp",!1),this.set("loading",!1),this.checkLevel(),this.isComplete()&&this.trigger("complete"),t&&t()},this),function(){},{level:this.get("level")+1,achievementId:this.get("id"),progress:this.get("resetProgress")?0:this.get("progress")-this.getTotal()})):t()}}),AchievementCollection=Backbone.Collection.extend({defaults:{loaded:!1},load:function(t,e){callService("../../../gems/site/achievements/services/achievements.php",_.bind(function(e){_.each(e,function(e){var t=this.get(e.achievementId);t&&(t.set({progress:1*e.progress,level:1*e.level},{silent:!0}),t.checkLevel())},this),t(),this.loaded=!0,this.trigger("load")},this),e)}}),achievements=achievements||{};achievements.AchievementMaxValue=Achievement.extend({initialize:function(e){this.set("eventName","change:"+this.get("field")),Achievement.prototype.initialize.call(this,e)},onAfterInit:function(){var e=this.get("listenObject"),t=1*e.get(this.get("field"));this.onProcess(e,t),Achievement.prototype.onAfterInit.call(this)},onProcess:function(e,t){var i=1*t;i>this.get("progress")&&this.setProgress(i)}}),achievements.AchievementCount=Achievement.extend({initialize:function(e){this.count=0,this.time=null,Achievement.prototype.initialize.call(this,e)},onProcess:function(){var e=this;++e.count,e.time&&clearTimeout(e.time),e.time=setTimeout(function(){e.setProgress(e.get("progress")+e.count),e.count=0,e.time=null},1e3)}}),achievements.AchievementCountInSession=achievements.AchievementCount.extend({onProcess:function(){this.set("progress",this.get("progress")+1),this.getTotal()===this.get("progress")&&this.setProgress(this.get("progress"))}}),achievements.AchievementEndlessGame=achievements.AchievementCountInSession.extend({onAfterInit:function(){achievements.AchievementCountInSession.prototype.onAfterInit.call(this),user.on("createNewGame",function(e,t){"bonus"!=application.level.num&&this.listenToOnce(Game,"fail",this.resetProgress)},this)},resetProgress:function(){this.get("progress")<this.getTotal()&&this.set("progress",0)}}),achievements.AchievementFriend=Achievement.extend({onAfterInit:function(){this.checkAvailable()&&this.checkLevel()},checkLevel:function(){return this.get("progress")<friends.length&&this.setProgress(friends.length),Achievement.prototype.checkLevel.call(this)}}),achievements.AchievementUsePowerUp=achievements.AchievementCount.extend({onAfterInit:function(){this.listenTo(user,"usedPowerUp",this.process)},onProcess:function(e){e.id==this.get("powerUp")&&achievements.AchievementCount.prototype.onProcess.call(this)}}),achievements.AchievementcompleteBonusLevel=Achievement.extend({onAfterInit:function(){episode.bonusLevel&&this.onInitListenBonusLevel(),this.listenTo(episode,"episodeLoaded",this.onInitListenBonusLevel)},onInitListenBonusLevel:function(){this.bonusLevel&&this.stopListening(this.bonusLevel),this.bonusLevel=episode.bonusLevel,this.listenTo(this.bonusLevel,"change:finished",this.process)},onProcess:function(e,t){t&&this.setProgress(this.get("progress")+1)}}),achievements.AchievementcompleteBonusWorld=achievements.AchievementCount.extend({onAfterInit:function(){episode.scores.on("add",function(){episode.isBonusWorld()&&episode.scores.length==episode.levelsInEpisode()&&application.once("change:page",this.process,this)},this)}}),achievements.AchievementKeyCount=Achievement.extend({onAfterInit:function(){user.on("createNewGame",function(e,t){this.count=0,this.listenTo(Game,"removedAttribute_key",this.process),this.listenTo(Game,"win",this.complateGame)},this)},onProcess:function(){++this.count},complateGame:function(){this.checkAvailable()&&this.setProgress(this.get("progress")+this.count)}}),achievements.AchievementSendLifes=Achievement.extend({onProcess:function(e){0<e.length&&this.setProgress(this.get("progress")+e.length)}}),achievements.AchievementEverydayGame=Achievement.extend({initialize:function(e){Achievement.prototype.initialize.call(this,e)},onProcess:function(){}}),Config.achievements=function(){return[{id:1,type:"AchievementMaxValue",name:"maxCoins",listenObject:user,field:"coins",userLevel:0,levels:[{value:5e3,prize:[{type:"coins",amount:100,cssClass:"coins"}]},{value:15e3,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:3e4,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:2,type:"AchievementEndlessGame",name:"endlessGame",listenObject:user,eventName:"change:level",resetProgress:!0,userLevel:21,levels:[{value:10,prize:[{type:"coins",amount:100,cssClass:"coins"}]},{value:15,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:20,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:3,type:"AchievementEverydayGame",name:"everydayGame",userLevel:0,levels:[{value:10,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:20,prize:[{type:"coins",amount:400,cssClass:"coins"}]},{value:40,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:4,listenObject:friends,eventName:"change:canCollectCoins",type:"AchievementCount",name:"friend",userLevel:0,levels:[{value:30,prize:[{type:"coins",amount:100,cssClass:"coins"}]},{value:150,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:500,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:5,type:"AchievementKeyCount",name:"collectKey",userLevel:0,levels:[{value:150,prize:[{type:"coins",amount:100,cssClass:"coins"}]},{value:500,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:1e3,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:6,type:"AchievementSendLifes",name:"sendlifes",listenObject:user,eventName:"sendlifes",userLevel:0,levels:[{value:30,prize:[{type:"coins",amount:100,cssClass:"coins"}]},{value:150,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:500,prize:[{type:"coins",amount:500,cssClass:"coins"}]}]},{id:7,type:"AchievementUsePowerUp",name:"thunderer",powerUp:"lightingPowerUp",userLevel:15,levels:[{value:10,prize:[{type:"coins",amount:200,cssClass:"coins"}]},{value:30,prize:[{type:"coins",amount:400,cssClass:"coins"}]},{value:60,prize:[{type:"coins",amount:600,cssClass:"coins"}]}]},{id:8,type:"AchievementcompleteBonusLevel",name:"fastgame",userLevel:15,levels:[{value:12,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:25,prize:[{type:"coins",amount:500,cssClass:"coins"}]},{value:50,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]},{id:9,type:"AchievementcompleteBonusWorld",name:"completebonusworld",userLevel:22,levels:[{value:2,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:5,prize:[{type:"coins",amount:500,cssClass:"coins"}]},{value:8,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]},{id:10,type:"AchievementCount",name:"gachaCount",listenObject:user,eventName:"gachaProcess",userLevel:22,levels:[{value:10,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:20,prize:[{type:"coins",amount:500,cssClass:"coins"}]},{value:35,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]},{id:11,type:"AchievementCount",name:"tournamentfinished",listenObject:user,eventName:"tournamentfinished",userLevel:42,mobile:!1,networks:["facebook","vkontakte","odnoklassniki","mailru"],levels:[{value:5,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:15,prize:[{type:"coins",amount:500,cssClass:"coins"}]},{value:40,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]},{id:12,type:"AchievementCount",name:"removeBossWalrus",gameObject:!0,eventName:"removeBosswalrus",userLevel:1120,levels:[{value:10,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:30,prize:[{type:"coins",amount:500,cssClass:"coins"}]},{value:60,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]},{id:13,type:"AchievementCount",name:"everydayquestcompleted",listenObject:user,eventName:"everydayquestcompleted",mobile:!0,userLevel:21,levels:[{value:3,prize:[{type:"coins",amount:300,cssClass:"coins"}]},{value:5,prize:[{type:"coins",amount:700,cssClass:"coins"}]},{value:10,prize:[{type:"coins",amount:1e3,cssClass:"coins"}]}]}]},Application.on("ready",function(){var e=_.result(Config,"achievements");if(e){var r=new AchievementCollection(e.map(function(e){if(achievements[e.type])return new achievements[e.type](e);console.error("not find achievement "+e.type)})),t=function(e,t){if($(".myAchievmentsBtn").toggleClass("levelUp",t||void 0!==r.findWhere({levelUp:!0})),t)if(application.toast){var i=messages.achievments[e.get("name")];application.toast.showMessage({withoutWait:!0,message:messages.achievmentsToastLevelUp+i.title,className:"achievementLevelUp "+e.get("name")+" "+e.get("type")})}else{if(application.windows.views.length)for(var o=0;o<application.windows.views.length;o++)if(application.windows.views[o]instanceof AchievmentsWindow)return;new AchievementDoneWindow({model:e})}};r.load(function(){!function(){var a={},n={maxCoins:[3e3,4e3,5e3,7e3,8e3,1e4,15e3,3e4]},e=["WithoutLoseSeriaAchievement","PowerUpsMasterAchievement","GachaWinAchievement","maxCoins"];"wizq"!==network&&"spmobage"!==network||(e=["WithoutLoseSeriaAchievement","PowerUpsMasterAchievement","maxCoins"]);for(var t=user.get("achievements"),i=0;i<e.length;i++){var o=e[i];a[o]=t%10,t=Math.floor(t/10)}r.each(function(e){if(n[e.get("name")]&&a[e.get("name")]){for(var t=n[e.get("name")][a[e.get("name")]],i=e.get("levels"),o=(e.get("level"),0);o<i.length&&!(i[o].value>t);++o);e.get("level")<o&&(e.set("level",o),e.set("progress",0),callService("../../../gems/site/achievements/services/levelup.php",_.bind(function(e){},this),function(){},{level:e.get("level"),achievementId:e.get("id"),progress:e.get("progress")}))}})}(),r.each(function(e){e.onAfterInit(),!e.get("isAvailable")&&application.toast&&e.once("change:isAvailable",function(e){var t=messages.achievments[e.get("name")];application.toast&&application.toast.showMessage({message:messages.achievmentsToastAvailable+t.title,className:"achievementAvailable "+e.get("name")+" "+e.get("type")})}),$(".myAchievmentsBtn").toggleClass("levelUp",void 0!==r.findWhere({levelUp:!0})),e.on("change:levelUp",t)})}),$("body").on("click touchend",".myAchievmentsBtn",function(){new AchievmentsWindow({collection:r})}),application.achievments=r}});var Registry=function(){function e(){_classCallCheck(this,e),this._items={}}return _createClass(e,[{key:"add",value:function(e,t){this._items[e]=t}},{key:"get",value:function(e){return this._items[e]}},{key:"has",value:function(e){return!!this._items[e]}},{key:"create",value:function(e){if(this._items[e]){for(var t=arguments.length,i=new Array(1<t?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return _construct(this._items[e],i)}cc.error("Not code cell "+e)}},{key:"init",value:function(){}}]),e}(),SpineConfig={};function Animation(){}function SpineAnimation(e){this._options=_.extend({removeAfterComplete:!0,removeDelay:!1,desktopOnly:!0},e),this._spinePromise=this._createSpineWidget()}function CssAnimation(e){this._options=e,this._$div=$(this._options.div)}function AnimationManager(){}SpineConfig.support=!0,SpineConfig.spineStorageSelector="#spine-storage",SpineConfig.atlases={bookOfLove:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.atlas",piratka:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Piratka.68800ddbee.atlas",persik:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Persik.27c3bbd0b6.atlas"},SpineConfig.keyframes={openBookOfLove:{loop:!1,animation:"closed_book_appear",duration:5e3},changePageBookOfLove:{loop:!1,animation:"change_page",duration:5e3}},Animation.prototype.play=function(){return $.Deferred().resolve().promise()},SpineAnimation.prototype=Object.create(Animation.prototype),SpineAnimation.prototype.constructor=SpineAnimation,SpineAnimation.prototype._createSpineWidget=function(){var t=$.Deferred();if(!this._options.desktopOnly||!window.mobile)try{var e=new spine.SpineWidget($(this._options.div).get(0),{x:this._options.x,y:this._options.y,addX:this._options.addX,addY:this._options.addY,scale:this._options.scale,loop:this._options.loop||!1,fitToCanvas:this._options.fitToCanvas,alpha:!0,premultipliedAlpha:!0,backgroundColor:"#00000000",atlas:this._options.spine.replace(".json",".atlas"),json:this._options.spine,animation:this._options.animation,error:function(){t.resolve()},success:function(){e.pause(),t.resolve(e)}})}catch(e){console.log(e),console.warn("Spine not support"),t.resolve()}else t.resolve();return t.promise()},SpineAnimation.prototype.play=function(){var t=$.Deferred(),i=this._options.removeAfterComplete?$(this._options.div).get(0):null,o=this._options.removeDelay;return this._spinePromise.done(function(e){e?(e.state.addListener({complete:function(){t.resolve(),i&&(o?setTimeout(function(){i.innerHTML=""},o):i.innerHTML="")}}),e.play()):t.resolve()}),t.promise()},CssAnimation.prototype=Object.create(Animation.prototype),CssAnimation.prototype.constructor=CssAnimation,CssAnimation.prototype.play=function(){var e=$.Deferred();return this._options.removeClass&&this._$div.removeClass(this._options.removeClass),this._options.className&&this._$div.addClass(this._options.className),setTimeout(function(){e.resolve()},this._options.duration||0),e.promise()},AnimationManager.createInstance=function(){return new AnimationManager},AnimationManager.prototype._createAnimation=function(e){var t=new Animation;switch(e.type){case"spine":t=new SpineAnimation(e);break;case"css":t=new CssAnimation(e);break;default:console.warn("Unknown animation type: "+e.type)}return t},AnimationManager.prototype.play=function(e){return this._createAnimation(e).play()},AnimationManager.prototype.playAll=function(e){var i=$.Deferred().resolve().promise();return e instanceof Array&&e.forEach(function(e){var t=this._createAnimation(e);i=i.then(_.bind(t.play,t))},this),i};var BonusWorldComponent=Backbone.Model.extend({world:null,defaults:{active:!1,networks:null,beginDate:null,endDate:null},constructor:function(e,t){this.world=t,Backbone.Model.call(this,e)},initialize:function(e){var o=this;Backbone.Model.prototype.initialize.call(this,e),this.listenToOnce(this.world,"configure",function(e,t,i){o.checkAvailability()&&Promise.resolve().then(function(){return o.init(i,t)}).then(function(){o.set("active",!0)})})},getEventName:function(){return this.world.get("name")},checkAvailability:function(){var e=application.getCurrentServerTime()||Date.now()/1e3;return(!this.get("networks")||-1!==this.get("networks").indexOf(network))&&(!(this.get("beginDate")&&this.get("beginDate").getTime()/1e3>e)&&!(this.get("endDate")&&this.get("endDate").getTime()/1e3<e))},setNotify:function(){this.set("notify",!0),setLocalStorage("".concat(this.getEventName(),"_").concat(this.get("id"),"Notify"),!0)},clearNotify:function(){this.set("notify",!1),removeLocalStorage("".concat(this.getEventName(),"_").concat(this.get("id"),"Notify"))},init:function(){return Promise.resolve()},reset:function(){return Promise.resolve()},open:function(){return Promise.resolve()},preload:function(){return Promise.resolve()},preloadFromServer:function(){return Promise.resolve()},load:function(){return Promise.resolve()},loadFromServer:function(){return Promise.resolve()},afterLoadFromServer:function(){return Promise.resolve()},loadBonusWorldData:function(e){return Promise.resolve()}}),ButtonWorldView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){this._enabled=!0}},{key:"events",value:function(){return{click:"onClick",touchstart:"onClick"}}},{key:"onClick",value:function(e){var t=this;!this._process&&this._enabled&&(this._process=!0,this.$el.addClass("process"),Promise.resolve().then(function(){return t.onAction(e)}).catch(function(e){console.error(e)}).then(function(){t._process=!1,t.$el.removeClass("process")}))}},{key:"onAction",value:function(){return Promise.resolve()}},{key:"Enabled",get:function(){return this._enabled||!0},set:function(e){this._enabled=e,this.$el.toggleClass("disabled",!e)}}]),i}(),BaseWorldView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"_ensureElement",value:function(){this._views=[],_get(_getPrototypeOf(i.prototype),"_ensureElement",this).call(this)}},{key:"events",value:function(){return{"click .mExitBtn":"onExit"}}},{key:"resources",value:function(){return[]}},{key:"initialize",value:function(e,t){var i=this;this.ln=t,this.$el.addClass(this.model.get("name")),this.model.controllers.forEach(function(e){i.$el.addClass("cmp-"+e.get("id"))}),this.model.on("enter",this.onEnter,this),this.model.hasComponent(ForgeComponent)&&this.addView(ForgeInButtonView,{el:$(".worldTemplates .btnSimple").clone(),model:this.model.getComponent(ForgeComponent)},"ui"),this.model.hasComponent("partsShop")&&this.addView(PartShopButtonView,{el:$(".worldTemplates .btnSimple").clone(),model:this.model.cmp("partsShop")},"ui"),this.model.hasComponent("sale")&&this.addView(ActionWorldButtonView,{el:$(".mainTemplates .timeButton").clone().addClass("saleBtn"),model:this.model.getComponent("sale")},"ui")}},{key:"onEnter",value:function(){this.model.on("takePrize",this.onTakePrize,this)}},{key:"onExit",value:function(){this.model.off("takePrize",this.onTakePrize,this),this.model.exit()}},{key:"addView",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"content",o=new e(t,this.ln);return o.$el.appendTo(this.$(".".concat(i))),this._views.push(o),o}},{key:"render",value:function(){this._views.forEach(function(e){e.render()})}},{key:"onTakePrize",value:function(t){return new Promise(function(e){new AnimatedPrizesWindow({prizes:t.getUserPrizes(),notGive:!0,onClose:e})})}}]),i}(),BaseIngredient=Backbone.Model.extend({defaults:{amount:1,currentAmount:0},isReady:function(){return this.get("amount")<=this.get("currentAmount")},getKey:function(){throw new Error("   Ingredient.getKey")},take:function(){throw new Error("   Ingredient.take")},showInfo:function(){}}),IngredientPart=BaseIngredient.extend({initialize:function(){var i=this;BaseIngredient.prototype.initialize.call(this),this.set("currentAmount",this.get("part").get("amount")),this.get("part").on("change:amount",function(e,t){return i.set("currentAmount",t)})},getKey:function(){return"part".concat(this.get("part").get("id"))},take:function(){this.get("part").setAmount(this.get("part").getAmount()-this.get("amount"))},showInfo:function(){var t=new Artifacts.PartWindow({model:this.get("part"),urgent:!0,lootBoxEnable:!1});t.once("openAskPart",function(){var e=this;t.close(),socialNetwork.haveAccessToFriends()?this._showFriendWindow(this.get("part")):new FriendPermissionWindow({onClose:function(){socialNetwork.haveAccessToFriends()&&e._showFriendWindow(e.get("part"))}})},this),t.once("openBuyPart",function(){t.close(),this._showPartShopWindow()},this)},_showFriendWindow:function(t){var i=new SelectFriendWindow({selectOneFriend:!0,urgent:!0,userIds:[]});if(friendsInAppIds&&friendsInAppIds.length){i.on("select",function(e){this.get("component").askArtifactPart(t,e)},this);var o=new Artifacts.UserArtifactPartCollection({prefix:this.get("component").get("prefix"),userIds:friendsInAppIds,part:t});o.on("reset",function(){var e=o.filterUserAskArtifactPart(o.getUserIdsWithPart());i.setShowTextNoFriends(0===e.length),i.setUserIds(e)},this),o.fetch()}else i.setShowTextNoFriends(!0),i.setUserIds([])},_showPartShopWindow:function(){var e=Config.bonusWorld.getComponent(PartShopComponent),t=Config.bonusWorld.getComponent(ForgeComponent);t&&t.trigger("closeForge"),e&&e.showShop()}}),IngredientTickets=BaseIngredient.extend({defaults:_.defaults({},BaseIngredient.prototype.defaults),initialize:function(){var i=this;BaseIngredient.prototype.initialize.call(this),this.set("currentAmount",this.get("component").getTickets()),this.get("component").on("change:tickets",function(e,t){return i.set("currentAmount",e.getTickets())})},getKey:function(){return this.get("component").get("id")},take:function(){return this.get("component").charge(this.get("amount"))},getIcon:function(){return"/".concat(this.get("component").get("id"),".png")},showInfo:function(){new Artifacts.TicketsWindow({model:this.get("component"),urgent:!0})}}),ForgeRecipe=Backbone.Model.extend({defaults:{active:!1,amount:0,group:1},constructor:function(e){this._ingredients=new Backbone.Collection(e.ingredients.map(function(e){return ingredientsFactory.create(e.type,e)})),delete e.ingredients,this._prizes=new Backbone.Collection(e.prizes.map(function(e){return Prize.create(e)})),delete e.prizes,Backbone.Model.call(this,e),this.listenTo(this._ingredients,"change",this.onCheckActive)},getIngredients:function(){return this._ingredients},onCheckActive:function(){this.set("active",this.canCraft())},canCraft:function(){var e,t=_createForOfIteratorHelper(this._ingredients.models);try{for(t.s();!(e=t.n()).done;){if(!e.value.isReady())return!1}}catch(e){t.e(e)}finally{t.f()}return!0},getPrizes:function(){return this._prizes},craft:function(){return Promise.all(this._ingredients.map(function(e){return e.take()}))}}),IngredientView=Backbone.View.extend({events:{click:"onShowInfoIngredient"},initialize:function(e){this.$el.addClass("ingredient-"+this.model.getKey()),this.onUpdateAmount(),this.listenTo(this.model,"change",this.onUpdateAmount)},onUpdateAmount:function(){this.$(".mAmount").html('<span class="currentAmount">'.concat(this.model.get("currentAmount").toString(),'</span><span class="splitter">/</span><span class="amount">').concat(this.model.get("amount").toString(),"</span>")),this.model.get("currentAmount")<this.model.get("amount")&&this.$el.toggleClass("empty")},onShowInfoIngredient:function(e){this.model.showInfo()}}),ForgeRewardView=Backbone.View.extend({initialize:function(e){this.$el.addClass(this.model.get("type")),this._userPrize=new UserPrizesView({model:this.model.get("products"),el:this.$(".mPrizes")}),this.onChackActive(),this.listenTo(this.model,"change:active",this.onChackActive)},onChackActive:function(){this.$el.toggleClass("active",this.model.get("active"))},remove:function(){Backbone.View.prototype.remove.call(this),this._userPrize.remove(),this._userPrize=null}}),RecipeView=Backbone.View.extend({events:{"click .mCraftBtn":"onClickCraft"},initialize:function(t){var i=this;this.window=t.window,this.forge=t.forge,this.$el.addClass("recipe"+this.model.get("id")),this.$(".mTitle").html(messages[t.prefix+"RecipeNames"][this.model.get("id")]),this.$el.find(".mCraftBtn").html('<span class="text">'.concat(messages[t.prefix+"Forge"].craft,"</span>"));var e=this.model.getIngredients();this._ingredients=e.map(function(e){return new IngredientView({model:e,el:t.tplIngredient.clone().appendTo(i.$(".mIngredients"))})}),this._rewards=this.model.getPrizes().map(function(e){return new ForgeRewardView({model:e,el:t.tplReward.clone().appendTo(i.$(".mRewards"))})});var o=this.$el.find(".mReward.BattlePassPrize");o.find(".mPrizes").append('<div class="battlePassChestText"></div>'),o.find(".battlePassChestText").html(messages[Config.bonusWorld.name+"CollectionRewardBattlePassDescription"]),this.listenTo(this.model,"change",this.onCheckCanCraft),this.onCheckCanCraft()},remove:function(){Backbone.View.prototype.remove.call(this),this._ingredients.forEach(function(e){return e.remove()}),this._ingredients=null,this._rewards.forEach(function(e){return e.remove()}),this._rewards=null},onCheckCanCraft:function(){this.$el.toggleClass("canCraft",this.model.canCraft())},onClickCraft:function(){this.model.canCraft()&&(this.window.close(),this.forge.craft(this.model))}}),ForgeWindow=TWindow.extend({templateClass:".forgeWindow_template",events:{"click .close":"close","click .questionMark":"onOpenPointsInfo"},onOpen:function(){var i=this;TWindow.prototype.onOpen.call(this);var e=this.$(".title"),t="";messages[this.model.world.get("name")+"Forge"]&&messages[this.model.world.get("name")+"Forge"].title&&(t=messages[this.model.world.get("name")+"Forge"].title),e.html(t);var o=this.$(".templates .mRecipe"),a=this.$(".templates .mIngredient"),n=this.$(".templates .mReward"),r=this.model.world.get("name");this._recipes=this.model.getRecipes().map(function(e){return new RecipeView({el:o.clone().appendTo(i.$(".mRecipes")),model:e,window:i,forge:i.model,tplIngredient:a,tplReward:n,prefix:r})});var s=this.model.getRecipes().map(function(e){return e.getIngredients().find(function(e){return e instanceof IngredientTickets})}).filter(function(e){return!!e});0<s.length&&(this.$(".mTicketAmount").html(s[0].get("currentAmount")),this.listenTo(s[0],"change:currentAmount",function(e,t){i.$(".mTicketAmount").html(e.get("currentAmount"))})),this.model.world.hasComponent(PrizeController)&&(this._progress=new PrizeControllerOuterProgressBar({el:this.$(".progressBarWrapper"),model:this.model.world.getComponent(PrizeController)})),this.ticketsInfoButton=new TriesInfoButton({el:$("#rewardChain .freePlate"),model:this.model});var l=this.model.world.getComponent(PrizeController);if(l){var d=$("#prizeControllerTemplates .prizeInfoBox").clone(),c=this.$(".prizesInfoContainer");c.addClass(this.model.world.get("name")),d.appendTo(c),d.addClass(this.model.world.get("name")),this.prizeInfo=new PrizeInfoView({el:d,model:l})}this.listenTo(this.model,"closeForge",this.close)},onClose:function(){TWindow.prototype.onClose.call(this),this._recipes.forEach(function(e){return e.remove()}),this._recipes=null},onOpenPointsInfo:function(){new WorldInfo({urgent:!0,world:this.model.world})},closeAnimation:function(e){this.$el.removeClass("visible").addClass("hidden"),e()}}),ForgeRecipeCraftedWindow=TWindow.extend({templateClass:".forgeRecipeCraftedWindow_template",onOpen:function(){TWindow.prototype.onOpen.call(this),this.publicBlock=new PublicationBlock({el:this.$(".needPublicBlock")}),this.$el.addClass("recipe"+this.model.get("id")),this.$(".mTitle").html(messages[Config.bonusWorld.getName()+"CollectionPrizeTitle"][this.model.get("id")]),this.$(".mDescription").html(messages[Config.bonusWorld.getName()+"CollectionPrizeMainText"][this.model.get("id")]),new UserPrizesView({el:this.$(".mPrizes"),model:UserPrizes.sum(this.options.prizes.filter(function(e){return e.get("active")}).map(function(e){return e.get("products").toArray()}))})},onClose:function(){if(this.publicBlock.isNeedPublic()){var e=Config.bonusWorld.getName()+"Recipe"+this.model.get("id")+"Publication";user.defaultPublication(e)}},remove:function(){TWindow.prototype.remove.call(this),this.publicBlock.remove(),this.publicBlock=null}}),ForgeButtonView=Backbone.View.extend({events:{click:"open"},initialize:function(){var e="";messages[this.model.world.get("name")+"Forge"]&&messages[this.model.world.get("name")+"Forge"].enterButton&&(e=messages[this.model.world.get("name")+"Forge"].enterButton),this.$(".mTitle").html(e),this.listenTo(this.model,"change:active change:notify",this.update),this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active")),this.$el.toggleClass("notify",this.model.get("notify"))},open:function(){this.model.showForge()}}),ForgeInButtonView=function(e){_inherits(i,ButtonWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){ButtonWorldView.prototype.initialize.call(this,e,t),this.$el.addClass("forgeInButton"),this.$(".label").html(t.print("forge.enterButton")),this.update(),this.listenTo(this.model,"change:active")}},{key:"update",value:function(){this.$el.toggleClass("active",this.model.get("active"))}},{key:"onAction",value:function(){return this.model.showForge()}}]),i}(),PartShopChancesWindow=TWindow.extend({templateClass:".chancesDisclosureWindow_template",events:{click:"close"},onOpen:function(){var t=this;TWindow.prototype.onOpen.call(this);var i=Config.bonusWorld.name;this.$(".mTitle").html(messages.PartsShopDropChanceInfo),this.options.item.parts instanceof Array?this.options.item.parts.forEach(function(e){t.$(".chancesWrapper").find("."+e.type).addClass("active"),t.$(".chancesWrapper").find("."+e.type).find(".chanceName").html(messages[i+"ArtifactPartsMaterial"][e.type]),t.$(".chancesWrapper").find("."+e.type).find(".chanceNumber").html(Math.round(100*e.chance)+"%")}):(this.$(".chancesWrapper").find(".trash").addClass("active"),this.$(".chancesWrapper").find(".trash").find(".chanceName").html(messages[i+"ArtifactPartsMaterial"].normal),this.$(".chancesWrapper").find(".trash").find(".chanceNumber").html("5%"))}}),PartShopWindow=TWindow.extend({templateClass:".partShopWindow_template",events:{"click .mBuyBtn":"_buy","click .close":"close","click .chancesBtn":"showChances"},onOpen:function(){var e=this;TWindow.prototype.onOpen.call(this);var i=Config.bonusWorld.ln;this.$(".mTitle").html(i.print("artifactPartShopTitle"));var o=this.$(".mOffers"),a=this.$(".invisible .mOffer");this.options.shop.get("items").forEach(function(e){if(!e.rewardAd||Config.adsProvider){var t=a.clone();t.find(".mBuyBtn").data("id",e.id),t.find(".chancesBtn").data("id",e.id),t.addClass("item"+e.id),t.find(".mOfferTitle").html(i.print("box"+e.id)),t.find(".mDescription").html(i.print("partsShopOffer"+e.id)),t.find(".mPrice").html(e.coins),t.appendTo(o)}}),this.updateTimer(),this.timer=setInterval(function(){return e.updateTimer()},1e3)},_buy:function(e){var t=this.options.shop.buyPart($(e.currentTarget).data("id"));t&&this.trigger("buyPart",t),this.close()},onClose:function(){clearInterval(this.timer)},closeAnimation:function(e){this.$el.removeClass("visible").addClass("hidden"),e()},showChances:function(e){var t=this.options.shop.getItemById($(e.currentTarget).data("id"));new PartShopChancesWindow({urgent:!0,shop:this.options.shop,item:t})},updateTimer:function(){var i=this;this.options.shop.get("items").forEach(function(e){if(e.rewardAd){var t=i.$(".mOffers .mOffer.item"+e.id);t.toggleClass("available",e.rewardAd.checkAvailable()),t.toggleClass("hasTimer",0<e.rewardAd.getCooldown()),t.find(".mTimer").html(formatDuration(e.rewardAd.getCooldown()))}})}}),PartShopButton=Backbone.View.extend({events:{click:"open"},initialize:function(){this.$(".mTitle").html(messages[this.model.world.get("name")+"ArtifactPartShopTitle"]),this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active"))},open:function(){this.model.showShop()}}),PartShopButtonView=function(e){_inherits(i,ButtonWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){ButtonWorldView.prototype.initialize.call(this,e,t),this.$el.addClass("partShopButton"),this.$(".mLabel").html(t.print("artifactPartShopTitle")),this.update(),this.listenTo(this.model,"change:active")}},{key:"update",value:function(){this.$el.toggleClass("active",this.model.get("active"))}},{key:"onAction",value:function(){return this.model.showShop()}}]),i}(),ContinuityPrizeWindow=TWindow.extend({templateClass:".continuityPrizeWindow_template",onOpen:function(){var e=this;this.$el.addClass("continuityStage"+this.options.stage),setTimeout(function(){return e.close()},1e3)}}),ContinuityBreakWindow=TWindow.extend({templateClass:".continuityBreakWindow_template",onOpen:function(){var e=this;this.$el.addClass("continuityStage"+this.options.stage),setTimeout(function(){return e.close()},500)}}),ContinuityProgressButton=Backbone.View.extend({events:{click:"openWindow"},openWindow:function(){this.model.showProgressWindow()}}),ContinuityProgressWindow=TWindow.extend({templateClass:".continuityProgressWindow_template",events:{"click .close":"close","click .okButton":"close"},onOpen:function(){var e=this.options.world,t=this.options.cmp.getStage()||1,i=this.options.cmp.get("maxStage");this.$el.find(".title").html(messages[e.get("name")+"IngredientBasketTitle"]),this.$el.find(".description .text").html(messages[e.get("name")+"IngredientBasketDescription"]),this.$el.find(".okButton").html(messages[e.get("name")+"IngredientBasketButton"]);for(var o=this.$el.find(".templates .progressItem"),a=this.$el.find(".windowContent .items"),n=i;0<n;n--){var r=o.clone();a.append(r),r.addClass("item"+n),r.toggleClass("active",n==Math.min(t,3)),r.find(".description").html(messages[e.get("name")+"IngredientBasketLevelInfo"]["level"+n])}var s=Math.min(100,100*(t-1)/(i-1));this.$el.find(".mBar").css("width",s+"%")}}),BonusWorldContinuityComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"continuity",showCogentWindowOnFail:!0,maxStage:3},BonusWorldComponent.prototype.defaults),constructor:function(e,t){this._prizes=e.prizes,this._specialPrizes=e.specialPrizes,delete e.prizes,delete e.specialPrizes,void 0===e.prefix&&(e.prefix=t.get("name")),BonusWorldComponent.call(this,e,t)},init:function(){var e=this;return Promise.resolve().then(function(){e.world.on("winLevel",e.afterWinLevel,e),e.world.on("failLevel",e.afterFailLevel,e),e.world.on("change:continuityStage",e.updateButton,e),application.on("beforeGameStart",e.onBeforeGameStart,e),e.updateButton()})},onBeforeGameStart:function(e){episode.get("num")===this.world.get("name")&&(this.game&&(this.disableGameListeners(),this.game=null),this.game=e,this.game.on("refuseBuyMoves",this.onRefuseBuyMoves,this),application.on("windowShow",this.onShowWindow,this))},disableGameListeners:function(){this.game.off("refuseBuyMoves",this.onRefuseBuyMoves,this),application.off("windowShow",this.onShowWindow,this)},onShowWindow:function(e){"outOfMovesWindow"===e.$el.attr("id")&&this.onOutOfMoves(e),"areYouSureExit"===e.$el.attr("id")&&this.onExitWinodw(e)},onOutOfMoves:function(e){(e=e.$el).find(".specialContent").append('<div class="continuityStage stage'.concat(this.getDisplayLoseStage(),'"></div>'))},onExitWinodw:function(e){(e=e.$el).find(".specialContent").append('<div class="continuityStage stage'.concat(this.getDisplayLoseStage(),'"></div>'))},onRefuseBuyMoves:function(e){this.get("showCogentWindowOnFail")&&(e&&(e.exitGameOnCancel=!1),new ContinuityCogentWindow({stage:this.getDisplayLoseStage(),component:this}))},afterWinLevel:function(){var e=this,t=Number(this.getStage()),i=Math.min(t+1,this.get("maxStage"));return Promise.resolve().then(function(){if(i<=e.get("maxStage"))return e.world.set("continuityStage",i),e.save()}).then(function(){return e.giveReward(i,!0)})},afterFailLevel:function(){var t=this;return new Promise(function(e){new ContinuityBreakWindow({stage:t.getDisplayLoseStage(),onClose:function(){return e()}})}).then(function(){return t.world.set("continuityStage",0),t.save()})},getStage:function(){return this.world.get("continuityStage")},save:function(){return this.world.saveSelectedOptions(["continuityStage"])},giveReward:function(a){var n=this,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e){var t,i;r&&(i=n._specialPrizes.find(function(e){return e.rule()}));var o=null;(t=i||n.getPrizeForStage(a))&&((o=t.prize.getPrize()).take(),new ContinuityPrizeWindow({cmp:n,stage:a})),e(o)}).then(function(e){e&&new AnimatedPrizesWindow({prizes:e.get("products"),notGive:!0})})},getPrizeForStage:function(t){var i=this;return this._prizes.find(function(e){return e.stage===Math.min(t,i.get("maxStage"))})},showProgressWindow:function(){new ContinuityProgressWindow({cmp:this,world:this.world})},updateButton:function(){for(var e=Math.min(this.getStage()||1,this.get("maxStage")),t=this.world.view.$el.find(".continuityButton"),i=1;i<=this.get("maxStage");i++)t.removeClass("stage"+i);t.addClass("stage"+e)},getDisplayLoseStage:function(){return Math.min(0===this.getStage()?1:this.getStage()+1,this.get("maxStage"))}}),RecipeGroupWindow=TWindow.extend({templateClass:".recipeGroupWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world,t=this.options.recipe;this.$el.find(".windowSmallTitle").html(messages[e.get("name")+"CollectionGroupPrizeMainTitle"][t.get("group")]),this.$el.find(".icon").addClass("recipeGroup"+this.options.recipe.get("group")),this.publicBlock=new PublicationBlock({el:this.$(".needPublicBlock")}),new UserPrizesView({model:this.options.prize,el:this.$(".prizes"),isGroup:!0})},onClose:function(){this.publicBlock.isNeedPublic()&&user.defaultPublication(Config.bonusWorld.name+"Recipe"+this.options.group.id+"Publication"),TWindow.prototype.onClose.call(this)}}),RecipeGroupComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"recipeGroup",prefix:""}),constructor:function(e,t){this._forge=e.forge,this._groups=e.groups,this._recipes=this._forge.getRecipes(),delete e.groups,delete e.forge,void 0===e.prefix&&(e.prefix=t.get("name")),BonusWorldComponent.call(this,e,t)},init:function(){var e=this;return Promise.resolve().then(function(){return e.loadFromServer()}).then(function(){e.listenTo(e._forge,"itemCrafted",e.onRecipeCraft)})},getPrefix:function(){return this.get("prefix")},getGroups:function(){return this._groups},getForge:function(){return this._forge},onRecipeCraft:function(t){var i=this;return Promise.resolve().then(function(){if(i.isGroupComplete(t))return Promise.resolve().then(function(){return i.world.emit("beforeGiveRecipeGroupPrize",i,t)}).then(function(){return i.world.emit("beforeGiveRecipeGroupPrize".concat(t.get("group")),i,t)}).then(function(){return i.showGroupWindow(t)}).then(function(){return i.givePrize(t)}).then(function(){return i.world.emit("afterGiveRecipeGroupPrize",i,t)}).then(function(){return i.world.emit("afterGiveRecipeGroupPrize".concat(t.get("group")),i,t)})}).then(function(){var e=t.get("amount")||0;return t.set("amount",e+1),i.saveRecipe(t)})},isGroupComplete:function(t){var i=t.get("group"),o=this._groups.find(function(e){return e.id===i}),e=o.recipes.find(function(e){return e.id===t.get("id")}).amount||1,a=this._forge.getGroups()[i].filter(function(e){return e!==t}).every(function(t){var e=o.recipes.find(function(e){return e.id===t.get("id")}).amount||1;return t.get("amount")>=e});return t.get("amount")+1===e&&a},givePrize:function(i){var o=this;return new Promise(function(e){var t=o.getGroupByRecipe(i);new AnimatedPrizesWindow({prizes:UserPrizes.sum(t.prizes.map(function(e){return UserPrizes.convertFromCocos(e)})),world:o.world.get("name"),onClose:function(){return e()}})})},getGroupByRecipe:function(t){return this._groups.find(function(e){return e.id===t.get("group")})},loadFromServer:function(){var t=this;return service("../../../gems/site/service/artifacts/loadGroups.php",{prefix:this.get("prefix")}).then(function(e){var i=e.recipes;t._recipes.forEach(function(t){var e=i.find(function(e){return e.recipe===t.get("id")});e&&t.set("amount",e.amount)})})},showGroupWindow:function(i){var o=this;return new Promise(function(e){var t=o.getGroupByRecipe(i);new RecipeGroupWindow({world:o.world,recipe:i,group:t,prize:UserPrizes.sum(t.prizes.map(function(e){return UserPrizes.convertFromCocos(e)})),onClose:function(){return e()}})})},saveRecipe:function(e){return service("../../../gems/site/service/artifacts/saveGroups.php",{prefix:this.get("prefix"),data:JSON.stringify({id:e.get("id"),amount:e.get("amount")})})}}),SimpleForgeComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"forge",showPrizeWindow:!1},BonusWorldComponent.prototype.defaults),constructor:function(e,i){this._recipes=new Backbone.Collection(e.recipes.map(function(t){return t.prizes.forEach(function(e){e.name=i.get("name")+".recipe"+t.id,e.world=i}),t}),{model:ForgeRecipe}),delete e.recipes,BonusWorldComponent.call(this,e,i)},init:function(){var o=this;return this._recipes.forEach(function(i){o.listenTo(i.getIngredients(),"change:currentAmount",function(e,t){e.previous("currentAmount")<t&&o.setNotify()}),o.listenTo(i,"change:active",function(e,t){t&&o.trigger("recipeReady",o,i)})}),BonusWorldComponent.prototype.init.call(this)},getRecipes:function(){return this._recipes},getGroups:function(){return this._recipes.groupBy("group")},getRecipesByGroup:function(e){return this.getGroups()[e]},craft:function(e){var t=this;if(e.canCraft()){var i=e.getPrizes();return Promise.resolve().then(function(){return e.craft()}).then(function(){return t.emit("takePrize",t,i)}).then(function(){t.get("showPrizeWindow")&&new ForgeRecipeCraftedWindow({urgent:!0,model:e,prizes:i}),new AnimatedPrizesWindow({prizes:UserPrizes.sum(i.filter(function(e){return e.get("active")}).map(function(e){return e.get("products").toArray()})),worldName:t.world.get("name")})}).then(function(){return t.world.emit("takePrizes",i)}).then(function(){return t.emit("itemCrafted",e)}).then(function(){return t.emit("itemCrafted"+e.get("id"),e)})}return Promise.resolve()}}),ForgeComponent=SimpleForgeComponent.extend({defaults:{id:"forge",showPrizeWindow:!1},showForge:function(){this.clearNotify(),new ForgeWindow({model:this})}}),ingredientsFactory=new Registry(!1);ingredientsFactory.add("IngredientPart",IngredientPart),ingredientsFactory.add("IngredientTickets",IngredientTickets);var TypeActivateAbility={Passive:"passive",Active:"active"},Ability=Backbone.Model.extend({defaults:{active:!1},init:function(){},serialize:function(){return{}},parse:function(e){},loadData:function(e){},saveData:function(e){},activate:function(){},getType:function(){throw new Error('You must implement this method "getType"')}}),ActiveAbility=Ability.extend({defaults:_.defaults({charged:!1,enabled:!0,cooldown:0,updateTime:0},Ability.prototype.defaults),constructor:function(e){var t=this;e.cooldown=util.duration(e.cooldown||0),this.timer=new Timer,Ability.call(this,e),this.listenTo(this.timer,"tick",function(){t.set("charged",t.isCharged())})},init:function(){},activate:function(){this.restart()},serialize:function(){return{updateTime:this.get("updateTime")}},parse:function(e){if(e){var t=e.updateTime||0;this.set("updateTime",t),this.timer.setFinishTime(t+this.get("cooldown"))}},loadData:function(e){this.set("updateTime",e.updateTime||0,{fromServer:!0}),e.updateTime?this.timer.setFinishTime(e.updateTime+this.get("cooldown")):this.restart()},saveData:function(e){e.updateTime=this.get("updateTime")||null},apply:function(){return Promise.resolve()},take:function(){var e=this;return this.get("active")&&this.get("enabled")&&this.isCharged()?Promise.resolve().then(function(){return e.apply()}).then(function(){return e.restart()}).then(function(){return e.trigger("take",e)}).catch(function(e){console.warn("[ActiveAbility]",e)}):Promise.reject()},isCharged:function(){return this.timer.get("timeToFinish")&&0===this.timer.getTimer()},setCooldown:function(e){this.set("cooldown",util.duration(e||0)),this.timer.start(this.get("cooldown"))},restart:function(){this.set("updateTime",Math.round(application.getCurrentServerTime())),this.timer.start(this.get("cooldown"))},getType:function(){return TypeActivateAbility.Active}}),PassiveAbility=Ability.extend({getType:function(){return TypeActivateAbility.Passive}}),PrizeAbility=ActiveAbility.extend({initialize:function(e){this.prize=new Prize(e),ActiveAbility.prototype.initialize.call(this,e)},apply:function(){return this.prize.take()}}),RandomPrizeAbility=ActiveAbility.extend({apply:function(){var e=this,t=this.get("prize").getPrize();return Promise.resolve().then(function(){if(e.get("world"))return new AnimatedPrizesWindow({prizes:t.getUserPrizes(),worldName:e.get("world").get("name"),notGive:!0}),e.get("world").emit("takePrize",t)}).then(function(){return t.take()})}}),abilitiesFactory=new Registry;abilitiesFactory.add("PrizeAbility",PrizeAbility),abilitiesFactory.add("RandomPrizeAbility",RandomPrizeAbility);var Trinket=Backbone.Model.extend({defaults:{amount:0,slotId:null,ability:null},addAmount:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=this.get("amount")+e;t<0&&(t=0),this.set("amount",t)},getAmount:function(){return this.get("amount")},getAbility:function(){return this.get("ability")},isEnabled:function(){return 0<this.get("slotId")&&0<this.get("amount")},serialize:function(){return{id:this.get("id"),amount:this.get("amount"),slotId:this.get("slotId"),ability:this.get("ability")?this.get("ability").serialize():null}},parse:function(e){this.set(_.pick(e,"amount","slotId")),this.get("ability")&&e.ability&&this.get("ability").parse(e.ability)},setSlotId:function(e){this.set({slotId:e||null,active:Boolean(e)})},onInsertToSlot:function(e){this.getAbility()&&this.getAbility().activate(),this.setSlotId(e.get("id"))},onEjectFromSlot:function(e){this.get("slotId")&&(console.assert(e.get("id")===this.get("slotId"),"     ".concat(e.get("id"))),this.set("slotId",null))}}),TrinketComponent=BonusWorldComponent.extend({defaults:{id:"trinkets"},constructor:function(e,t){this._trinkets=new Backbone.Collection(e.trinkets.map(function(e){return e.ability&&(e.ability=abilitiesFactory.create(e.ability.type,e.ability)),new Trinket(e)})),delete e.trinkets,void 0===e.prefix&&(e.prefix=t.get("name")),BonusWorldComponent.call(this,e,t)},init:function(){var a=this;return Promise.resolve().then(function(){return a.loadFromServer()}).then(function(){return a.listenTo(a._trinkets,"change",a.onChangeTrinkets),Promise.all(a._trinkets.filter(function(e){return e.get("ability")}).map(function(e){return e.get("ability").init()})).then(function(){a._trinkets.forEach(function(o){o.get("ability")&&o.listenTo(o.get("ability"),"change:updateTime",function(e,t,i){a.onChangeTrinkets(o,i)})})})})},getTrinkets:function(){return this._trinkets},getTrinketById:function(e){return this._trinkets.get(e)},bindStorage:function(){return this.world.storage.bind(this.get("id"),this)},serialize:function(){var e=this._trinkets.map(function(e){return e.serialize()});return JSON.stringify(e)},parse:function(e){if(e){var t,i=_createForOfIteratorHelper(JSON.parse(e));try{for(i.s();!(t=i.n()).done;){var o=t.value,a=this._trinkets.get(o.id);a&&a.parse(o)}}catch(e){i.e(e)}finally{i.f()}}},loadFromServer:function(){var e=this;return service("../../../gems/site/service/trinkets/load.php",{prefix:this.get("prefix")}).then(function(i){e._trinkets.forEach(function(e){var t=_.findWhere(i,{id:e.get("id")});e.set({amount:t?1:0,slotId:t&&t.slotId||null},{fromServer:!0}),e.get("ability")&&(e.get("ability").loadData(t||{}),e.get("ability").set("active",e.isEnabled()))})}).catch(function(e){console.error(e)})},saveTrinket:function(e){var t=this;return Promise.resolve(e).then(function(e){return e.map(function(e){var t={id:e.get("id"),slotId:e.get("slotId"),amount:e.get("amount")};return e.get("ability")&&0<e.get("amount")&&e.get("ability").saveData(t),t})}).then(function(e){if(0<e.length)return service("../../../gems/site/service/trinkets/save.php",{prefix:t.get("prefix"),trinkets:e})})},onChangeTrinkets:util.bundle(function(i,e){i.forEach(function(e){e.get("ability")&&e.get("ability").set("active",e.isEnabled())});var t=e.map(function(e,t){return e.fromServer?null:i[t]}).filter(function(e){return!!e});this.saveTrinket(t)}),ingredient:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return{type:"IngredientTrinket",trinket:this._trinkets.get(e),amount:t}}}),BaseInserter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(e){this._slot=e}},{key:"getSlot",value:function(){return this._slot}}]),e}(),TrinketInsert=function(e){_inherits(o,BaseInserter);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this))._trinkets=e,t._trinkets.getTrinkets().on("change:slotId",t.onChangeTrinkets,_assertThisInitialized(t)),t}return _createClass(o,[{key:"init",value:function(e){_get(_getPrototypeOf(o.prototype),"init",this).call(this,e)}},{key:"getTrinkets",value:function(){return this._trinkets.getTrinkets()}},{key:"onChangeTrinkets",value:function(){var e=this.getTrinkets().findWhere({slotId:this.getSlot().get("id")});this.getSlot().set("subject",e||null)}}]),o}(),TrinketAutoInsert=function(e){_inherits(a,TrinketInsert);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e))._ids=t,i.getTrinkets().on("change:amount",util.bundle(i.onChangeAmount),_assertThisInitialized(i)),i}return _createClass(a,[{key:"onChangeAmount",value:function(e,t,i){var o=this,a=this._ids.map(function(e){return o._trinkets.getTrinketById(e)}).filter(function(e){return 0<e.get("amount")}).pop();a&&this.getSlot().getSubject()!==a&&this.getSlot().insert(a)}}]),a}(),FairSlot=Backbone.Model.extend({defaults:{inserter:null,subject:null},init:function(e){var t=this;return this._fair=e,Promise.resolve().then(function(){t.get("inserter")&&t.get("inserter").init(t)})},getSubject:function(){return this.get("subject")},insert:function(e){this.eject(),e.onInsertToSlot(this),this.set("subject",e)},eject:function(){this.get("subject")&&this.get("subject").onEjectFromSlot(this)},isEmpty:function(){return null===this.get("subject")}}),FairComponent=BonusWorldComponent.extend({defaults:{id:"fair"},constructor:function(e,t){this._slots=new Backbone.Collection(e.slots,{model:FairSlot}),delete e.slots,BonusWorldComponent.call(this,e,t)},init:function(){var t=this;return Promise.all(this._slots.map(function(e){return e.init(t)}))},getSlots:function(){return this._slots}}),GitSlotViewModel=Backbone.Model.extend({defaults:{active:!1,charged:!1},constructor:function(e){Backbone.Model.call(this,{}),this.slot=e,this.initEvents()},initEvents:function(){this.listenTo(this.slot,"change:subject",this.onUpdateSubject),this.onUpdateSubject()},initAbilityEvents:function(e){var t=this;this._ability&&this.stopListening(this._ability),this._ability=e,this._ability&&this.listenTo(e,"change:charged",function(){t.set("charged",t._ability.isCharged())})},getId:function(){return this.slot.get("id")},onUpdateSubject:function(){var e=this.slot.getSubject();if(e){var t=e.getAbility();this.set({active:!0,charged:t.isCharged()}),this.initAbilityEvents(t)}else this.set({active:!1,charged:!1}),this.initAbilityEvents(null)},getSubject:function(){return this.slot.getSubject()},getAbility:function(){var e=this.getSubject();return e?e.getAbility():null},getTimer:function(){var e=this.getAbility();return e?e.timer.getTimer():0},take:function(){var t=this,e=this.getAbility();if(e)return e.take().then(function(){var e=t.getSubject();t.slot.eject(),e.addAmount(-1)})}}),GiftTrinketsSlotView=Backbone.View.extend({events:{click:"onClick"},initialize:function(e){this.timer=new TimerView({el:this.$(".mTimer"),model:this.model}),this.update(),this.$el.addClass("TrinketsSlot"+this.model.getId()),this.listenTo(this.model,"change:active",this.update),this.listenTo(this.model,"change:charged",this.update)},update:function(){var e=this;setTimeout(function(){e.$el.toggleClass("active",e.model.get("active"))},2e3),this.$el.toggleClass("charged",this.model.get("charged"))},onClick:function(){this.model.get("charged")?this.model.take():this.animateTip()},animateTip:function(){var e=this,t=this.$(".tip");t.addClass("animateTip");var i=Config.bonusWorld.get("name");t.html(this.model.get("active")?messages.ForceTexts[i+"Force2"]:messages.ForceTexts[i+"Force1"]),setTimeout(function(){e.$(".tip").removeClass("animateTip")},3e3)}}),GiftTrinketsView=Backbone.View.extend({initialize:function(t){var i=this;this.slots=new Backbone.Collection(this.model.getSlots().map(function(e){return new GitSlotViewModel(e)})),this.slots=this.slots.map(function(e){return new GiftTrinketsSlotView({el:t.itemTpl.clone().appendTo(i.$el),model:e})})}}),ConvertType={to:"to",from:"from"},BaseConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"to",value:function(e){return e}},{key:"from",value:function(e){return e}}]),e}(),SimpleConverter=function(e){_inherits(i,BaseConverter);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i)}(),BooleanConverter=function(e){_inherits(i,BaseConverter);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"to",value:function(e){return Number(e)}},{key:"from",value:function(e){return Boolean(Number(e))}}]),i}(),DateConverter=function(e){_inherits(i,BaseConverter);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"to",value:function(e){return formatDateForDB(e)}},{key:"from",value:function(e){return null!=e?new Date(e):null}}]),i}(),WorldDataComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e,t))._models={},i._deferOnChangeBindModel=util.bundle(i.onChangeBindModel,_assertThisInitialized(i)),i}return _createClass(a,[{key:"init",value:function(){}},{key:"convert",value:function(e,t,i,o){var a={};for(var n in t){var r=e.get(n);if(void 0!==r){var s=o===ConvertType.from?i[n]:i[t[n]];a[t[n]]=s[o](r)}}return a}},{key:"bind",value:function(e){this.unbind(e);for(var t={},i={},o={},a=arguments.length,n=new Array(1<a?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];for(var s=0,l=n;s<l.length;s++){var d=l[s];d.dataName?(t[d.dataName]=d.name,i[d.name]=d.dataName):(t[d.name]=d.name,i[d.name]=d.name),o[d.name]=d.converter||new SimpleConverter}e.set(this.convert(this,t,o,ConvertType.from));for(var c=0,g=n;c<g.length;c++){var u=g[c];this.listenTo(e,"change:".concat(u.name),this._deferOnChangeBindModel)}this._models[e.cid]={model:e,fieldsToModel:t,fieldsToData:i,converters:o}}},{key:"unbind",value:function(e){this._models[e.cid]&&this.stopListening(e)}},{key:"onChangeBindModel",value:function(e,t,o){var a=this,i=_.unzip([e,t,o]).filter(function(e){var t=_slicedToArray(e,3),i=(t[0],t[1],t[2]);return!(o&&i.sender===a)});if(0<i.length){var n=_.groupBy(i,function(e){return e[0].cid}),r={};for(var s in n)if(this._models[s]){var l=this._models[s],d=l.model,c=l.fieldsToData,g=l.converters;_.extend(r,this.convert(d,c,g,ConvertType.to))}_.isEmpty(r)||(this.set(r),this.update(r))}}},{key:"preloadFromServer",value:function(e){return this.loadData(e)}},{key:"loadFromServer",value:function(e){return this.loadData(e)}},{key:"loadData",value:function(){var r=this;return service("../../../gems/site/service/world/getdata.php",{worldName:this.world.get("name")}).then(function(t){for(var e in r.set(t,{fromServer:!0}),r._models){var i=r._models[e],o=i.model,a=i.fieldsToModel,n=i.converters;o.set(r.convert(r,a,n,ConvertType.from),{sender:r})}return Promise.all(r.world.controllers.map(function(e){return e.loadBonusWorldData(t)})).then(r.world.emit("loadData",t))})}},{key:"update",value:function(e){return service("../../../gems/site/service/world/setdata.php",{worldName:this.world.get("name"),data:e})}}]),a}();WorldDataComponent.prototype.defaults=_.defaults({id:"data"},BonusWorldComponent.prototype.defaults);var AdvertComponent=BonusWorldComponent.extend({defaults:{id:"advert",timeAfterStart:0},initialize:function(e){Backbone.Model.prototype.initialize.call(this,e),this.listenToOnce(this.world,"configure",this.setDontShowAd)},setDontShowAd:function(){var e=this;if(this.world.get("durationDays")){var t=(this.world.get("finishTime")||application.getCurrentServerTime()+24*this.world.get("durationDays")*60*60)-24*(this.world.get("durationDays")+this.world.get("prolongTimes"))*60*60+this.get("timeAfterStart")-application.getCurrentServerTime();0<t&&(this.world.set("dontShowAd",!0),setTimeout(function(){return e.world.set("dontShowAd",!1)},1e3*t))}}}),MovesOrder={straight:"straight",rest:"rest"},BaseDropperChanceStrategy=function(){function t(e){_classCallCheck(this,t),this._dropper=e.dropper,this._opts=e,this.movesOrder=e.dropper.get("movesOrder")||MovesOrder.straight}return _createClass(t,[{key:"calculateChance",value:function(){return 1}},{key:"getMove",value:function(){switch(this.movesOrder){case MovesOrder.straight:return this._dropper.game.getMoveId();case MovesOrder.rest:return this._dropper.game.getMoves();default:return null}}},{key:"onStartGame",value:function(){}}]),t}(),ByAccumulatedMoveChanceStrategy=function(e){_inherits(i,BaseDropperChanceStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"calculateChance",value:function(){var t=this._dropper.game.getMoves(),e=this._dropper.get("chances"),i=this._dropper.get("chance"),o=Object.keys(e).filter(function(e){return Number(e)>=t}).sort(function(e){return Number(e)})[0];return o?e[o]:i}}]),i}(),OnExactMoveChanceStrategy=function(e){_inherits(i,BaseDropperChanceStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"calculateChance",value:function(){var e=this.getMove(),t=this._dropper.get("chances");return t[e]?t[e]:0}}]),i}(),OnRandomMoveChanceStrategy=function(e){_inherits(i,BaseDropperChanceStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"calculateChance",value:function(){var e=this.getMove();return this.move===e?100:0}},{key:"onStartGame",value:function(e){_get(_getPrototypeOf(i.prototype),"onStartGame",this).call(this),this.move=_.random(this._dropper.get("minMove"),Math.round(e.getMoves()/2))}}]),i}(),BaseDropperPartGenerator=function(){function t(e){_classCallCheck(this,t),this._dropper=e.dropper,this._opts=e}return _createClass(t,[{key:"generatePart",value:function(){return null}}]),t}(),MaterialDropperPartGenerator=function(e){_inherits(i,BaseDropperPartGenerator);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"generatePart",value:function(){var t=util.randomizedObjectKey(this._dropper.get("materials"));return RANDOM(this._dropper.get("parts").filter(function(e){return e.get("material")===t}))}}]),i}(),SimpleDropperPartGenerator=function(e){_inherits(o,BaseDropperPartGenerator);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this,e))._part=t._dropper.get("part"),t}return _createClass(o,[{key:"generatePart",value:function(){return this._part}}]),o}(),UniqueDropperPartGenerator=function(e){_inherits(i,BaseDropperPartGenerator);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"generatePart",value:function(){var e=this._dropper.get("world").cmp("parts").getParts().filter(function(e){return e.get("amount")<=0});return e[Math.floor(Math.random()*e.length)]}}]),i}(),DroppersAgency=BonusWorldComponent.extend({defaults:{id:"droppers"},initialize:function(e){var t=this;BonusWorldComponent.prototype.initialize.call(this,e),this.droppers=new Backbone.Collection,e&&e.droppers&&e.droppers.forEach(function(e){return t.addDropper(e)})},init:function(e,t){var i=this;return Promise.resolve().then(function(){application.on("beforeGameStart",i.onStartGame,i)})},addDropper:function(e){this.droppers.add(e)},onStartGame:function(t){if(episode.get("num")===this.world.get("name"))return Promise.all(this.droppers.map(function(e){return Promise.resolve().then(function(){return e.onStartGame(t)})}))}}),BoxDropper=Backbone.Model.extend({defaults:{oncePerLevel:!0,onReplay:!1,markKey:"box",rule:function(){return!0},chanceStrategyCls:ByAccumulatedMoveChanceStrategy,dropperPartGeneratorCls:MaterialDropperPartGenerator},initialize:function(e){var t=this.get("chanceStrategyCls");this.chanceStrategy=new t({dropper:this});var i=this.get("dropperPartGeneratorCls");this.dropperPartGenerator=new i({dropper:this})},onStartGame:function(e){this.game=e,this.game.on("validMove",this._onChangeMove,this),this.game.on("initCellForFallDown",this._checkCell,this),!this.get("rule")()||this.get("world").isReplay()&&!this.get("onReplay")?this.set("active",!1):(this.set("active",!0),this.chanceStrategy.onStartGame(e))},_onChangeMove:function(e){if(this.get("active")){var t=this.chanceStrategy.calculateChance();t&&_.random(0,100)<=t&&(this.get("oncePerLevel")&&this.set("active",!1),this._generateCell())}},_generateCell:function(){var t=this;this.game.fallDownSpecialCells.unshift({offset:0,cellClass:BoxCell,afterCreate:function(e){e.part=t.dropperPartGenerator.generatePart()}})},_checkCell:function(e){e instanceof BoxCell&&!e.part&&(e.part=this.dropperPartGenerator.generatePart())}}),ActionWorldButtonView=Backbone.View.extend({events:{click:"open"},initialize:function(){this.listenTo(this.model,"change:active",this.update),this.timer=new TimerView({el:this.$(".mTimeWrapper"),model:this.model}),this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active"))},open:function(){this.model.show()}}),ActionWorldWindow=TWindow.extend({templateClass:".actionWorldWindow_template",events:{"click .close":"close","click .buy":"buy"},onOpen:function(){this.$el.find(".oneAltBtn.buy").html(prices[this.model.get("offerId")].desc.price),TWindow.prototype.onOpen.call(this);this.options.world.get("name");this.$(".mTitle").html(messages.profitSaleWindow.title),this.timer=new TimerView({el:this.$(".mTimer"),model:this.options.timer});var e=this.options.offer.getProducts();e&&new UserPrizesView({isGroup:!0,el:this.$(".mPrizes"),model:e})},remove:function(){TWindow.prototype.remove.call(this),this.timer.remove()},buy:function(){this.close(),this.model.buy()}}),ActionWorldComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){var t=this;return this.listenTo(this.world,"enter",this.open),Promise.resolve().then(function(){return _get(_getPrototypeOf(i.prototype),"init",t).call(t)}).then(function(){return t.checkActive()}).then(function(e){return t.set("active",e)}).then(function(){t.get("worldEvents").forEach(function(e){t.world.on(e,t.checkActive,t)}),application.on("change:page",t.checkActive,t)})}},{key:"checkActive",value:function(){var a=this;return Promise.resolve().then(function(){var e=a.getOffer().getLastPayDate(),t=new Date(1e3*application.getCurrentServerTime()),i=new Date(a.world.getFinishTime()),o=DateUtil.addDays(i,-a.get("daysAgo"));return!(t<o)&&(!(e&&o<e)&&(!(a.world.getCurrentLevel()<a.get("minLevel"))&&(!a.buyed&&a.get("rules")())))}).then(function(e){return a.set("active",e),e})}},{key:"open",value:function(){var e=this;return Promise.resolve().then(function(){return e.checkActive()}).then(function(){e.checkTime()&&e.get("active")&&e.show()})}},{key:"getOffer",value:function(){return application.cmp(ApplicationOffersComponent).getOfferById(this.get("offerId"))}},{key:"createButton",value:function(){return this.world.views.create(this.get("viewBtnId"),{model:this})}},{key:"show",value:function(){setLocalStorage(this._getStorageKey(),Date.now());var e=this.getOffer();new ActionWorldWindow({world:this.world,model:this,timer:this,offer:e})}},{key:"buy",value:function(){var t=this,i=this.getOffer();return i.buy().then(function(){return t.get("worldEvents").forEach(function(e){t.world.off(e,t.checkActive,t)}),application.off("change:page",t.checkActive,t),t.buyed=!0,t.set("active",!1)}).then(function(){return new Promise(function(e){new AnimatedPrizesWindow({prizes:i.getProducts(),worldName:t.world.get("name"),onClose:e,notGive:!0})})})}},{key:"getTimer",value:function(){return this.world.getTimer()}},{key:"checkTime",value:function(){var e=getLocalStorage(this._getStorageKey(),0);return 864e5<Date.now()-e}},{key:"_getStorageKey",value:function(){return"bw_".concat(this.world.getName(),"_").concat(this.world.get("version"),"_").concat(this.get("id"),"_timeShown")}},{key:"reset",value:function(){setLocalStorage(this._getStorageKey(),0)}}]),i}();ActionWorldComponent.prototype.defaults=_.defaults({id:"sale",active:!1,offerId:"saleWorld",daysAgo:3,minLevel:4,viewBtnId:"ActionBtnWorldView",viewWindowId:"ActionWorldWindowView",stackButtonsOrder:200,worldEvents:[],rules:rules.Rule(function(){return!0})},BonusWorldComponent.prototype.defaults);var ReturnWorldWindow=TWindow.extend({templateClass:".returnWorldWindow_template",events:{"click .close":"close","click .open":"onComplete"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.get("name");if(this.$el.addClass(e),this.$(".mTitle").html(messages.returnWindow.title),this.$(".mDescription").html(messages.returnWindow.text),this.$(".mOpen").html(messages.returnWindow.button),this.timer=new TimerView({el:this.$(".mTimer"),model:this.options.timer}),this.options.prize){this.$el.addClass("withPrize");var t=this.options.prize.getProducts();new UserPrizesView({isGroup:!0,el:this.$(".mPrizes"),model:t})}},onComplete:function(){this.close(),this.options.onComplete()}}),ReturnWorldComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e,t){var i=this;return this.set("needShow",!Boolean(e&&parseInt(e.returnShowed))),Promise.resolve().then(function(){return new Promise(function(e){var t=i.world.getComponent("prizes");t?t.once("loaded",e):e()})}).then(function(){i.needShow()&&i.show()})}},{key:"needShow",value:function(){if(!this.get("needShow"))return!1;var e=new Date(1e3*application.getCurrentServerTime()),t=new Date(1e3*this.world.bonusWorldFinishTime),i=DateUtil.addDays(t,-this.get("daysAgo"));if(!this.world.bonusWorldFinishTime)return!1;if(e<i)return!1;if(this.world.getCurrentLevel()<this.get("minLevel"))return!1;var o=this.world.getComponent("prizes");return!o||!o.isFinal()}},{key:"show",value:function(){var e=this,t=this.getPrize();BonusWorldForce.prototype.waitForceTime.call().then(function(){return delay(1e3)}).then(function(){application.get("forceOpenNow")||"main"!==application.get("page")||(application.set("forceOpenNow",!0),new ReturnWorldWindow({world:e.world,timer:e,prize:t,onClose:function(){t&&t.take(),e.world.set("returnShowed",!0),e.world.saveSelectedOptions("returnShowed"),setTimeout(function(){application.set("forceOpenNow",!1)},300)},onComplete:function(){application.windows.closeAll(),e.onComplete()}}))})}},{key:"getTimer",value:function(){return this.world.getTimer()}},{key:"onComplete",value:function(){this.world.open()}},{key:"getPrize",value:function(){return new Prize({name:this.world.get("name")+".return",products:[{type:"GoodProduct",goodId:this.world.get("unlimitedName"),addTime:"30m",world:this.world}]})}}]),i}();ReturnWorldComponent.prototype.defaults=_.defaults({daysAgo:3,minLevel:1},BonusWorldComponent.prototype.defaults);var GroupReturnWorldComponent=function(e){_inherits(o,ReturnWorldComponent);var t=_createSuper(o);function o(){return _classCallCheck(this,o),t.apply(this,arguments)}return _createClass(o,[{key:"init",value:function(e,t){var i=this;return this.groupComponent=this.world.getComponent("group"),delay(500).then(function(){i.worldToOpen=i._findWorldToOpen()}).then(function(){return _get(_getPrototypeOf(o.prototype),"init",i).call(i,e,t)})}},{key:"_findWorldToOpen",value:function(){var t=this,e=this.groupComponent.getMainBonusWorld();if(e.get("finished"))return e;var i=this.groupComponent.getActiveWorld();return i||this.groupComponent.getBonusWorlds().find(function(e){return t._canProlongateWorld(e)})}},{key:"_canProlongateWorld",value:function(e){return e.get("allowProlong")&&!e.get("finished")&&e.isExpired()}},{key:"needShow",value:function(){if(!this.get("needShow"))return!1;if(!this.worldToOpen)return!1;var e=new Date(1e3*application.getCurrentServerTime()),t=this.world.get("endDate"),i=DateUtil.addDays(t,-this.get("daysAgo"));return!!t&&!(e<i)}},{key:"onComplete",value:function(){this.worldToOpen.open()}},{key:"getPrize",value:function(){return this.worldToOpen.get("finished")?null:new Prize({name:this.worldToOpen.get("name")+".return",products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m",world:this.worldToOpen}]})}},{key:"show",value:function(){this.worldToOpen.isExpired()?(this.worldToOpen.cmp("prolongate").show(),this.world.set("returnShowed",!0),this.world.saveSelectedOptions("returnShowed")):_get(_getPrototypeOf(o.prototype),"show",this).call(this)}},{key:"getTimer",value:function(){return this.worldToOpen.getTimer()||this.worldToOpen.get("endDate").getTime()/1e3-application.getCurrentServerTime()}}]),o}(),GroupComponent=BonusWorldComponent.extend({defaults:{id:"group",name:null,main:!1,order:0},getBonusWorlds:function(){var i=this;return Config.bonusWorlds.filter(function(e){return e.hasComponent(i.get("id"))&&e.getComponent(i.get("id")).get("name")==i.get("name")}).sort(function(e,t){return e.getComponent(i.get("id")).get("order")-t.getComponent(i.get("id")).get("order")})},getOtherBonusWorlds:function(){var t=this;return this.getBonusWorlds().filter(function(e){return e!=t.world})},getMainBonusWorld:function(){return this.getBonusWorlds().find(function(e){return e.getComponent("group").get("main")})},getFirstBonusWorld:function(){return this.getBonusWorlds().find(function(e){return e.getComponent("group").isFirst()})},isAvailabilityEnter:function(){return!!this.isFirst()||!!this.getFirstBonusWorld().bonusWorldFinishTime&&(!this.get("main")||_.all(this.getOtherBonusWorlds(),function(e){return e.getComponent("group").isCompleted()}))},isCompleted:function(){return this.world.get("finished")},isFirst:function(){return 1==this.get("order")},getActiveWorld:function(){var t=this;return this.getBonusWorlds().find(function(e){return t._canOpenWorld(e)})},_canOpenWorld:function(e){return e.get("active")&&!e.get("finished")&&!e.isExpired()&&e.isAvailableByComponents()&&e.isAvailableByBeginDate()}}),RunWorldComponent=BonusWorldComponent.extend({defaults:{id:"runWorld"},initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.world.once("enter",this.onEnter,this)},init:function(){this.needShow()&&this.show()},onEnter:function(){setLocalStorage(this._getStorageKey()+"_Entered",!0)},needShow:function(){return this.checkTime()&&!getLocalStorage(this._getStorageKey()+"_Entered",!1)&&this.world.isAvailableByBeginDate()&&this.world.isAvailableByComponents()&&!this.world.isExpired()},checkTime:function(){var e=getLocalStorage(this._getStorageKey()+"_Shown",0);return 0===e||864e5<Date.now()-e},_getStorageKey:function(){return"".concat(this.world.get("name"),"_").concat(this.world.get("version"),"_").concat(this.get("id"))},show:function(){var e=this;BonusWorldForce.prototype.waitForceTime.call().then(function(){return delay(1e3)}).then(function(){application.get("forceOpenNow")||"main"!=application.get("page")||(application.set("forceOpenNow",!0),application.windows.runAfterCloseAll().then(function(){e.world.bonusWorldFinishTime||e.world.startBonusWorld(),new RunBonusWorldWindow({bonusworld:e.world,onOpen:function(){setLocalStorage(e._getStorageKey()+"_Shown",Date.now())},onClose:function(){setTimeout(_.bind(function(){application.set("forceOpenNow",!1)},e),300)}})}))})},reset:function(){return setLocalStorage(this._getStorageKey()+"_Shown",null),setLocalStorage(this._getStorageKey()+"_Entered",null),BonusWorldComponent.prototype.reset.call()}}),ProxyComponent=BonusWorldComponent.extend({defaults:{component:null},constructor:function(e,t){if(BonusWorldComponent.call(this,e,t),!e.component)throw new Error("      ");this.component=e.component,this.set("id",this.component.get("id"))}}),ProxyPartsComponent=ProxyComponent.extend({getParts:function(){return this.component.getParts()},getPartById:function(e){return this.component.getPartById(e)},ingredient:function(e,t){return this.component.ingredient(e,t)},askArtifactPart:function(e,t,i){this.component.askArtifactPart(e,t,i)},sendArtifactPart:function(e,t){this.component.sendArtifactPart(e,t)},receiveArtifactPart:function(e,t){return this.component.receiveArtifactPart(e,t)},cancelAskedArtifactPart:function(e){return this.component.cancelAskedArtifactPart(e)},getPrefix:function(){return this.component.getPrefix()}}),RulsRunLevelComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"defaults",value:function(){return _.defaults({id:"rulsRunLevel"},BonusWorldComponent.prototype.defaults)}},{key:"init",value:function(){var e=this;return _get(_getPrototypeOf(i.prototype),"init",this).call(this).then(function(){e._checkCanRuleLevel(),e.listenTo(e.world,"change:progress",e._checkCanRuleLevel,e),e.world.hasComponent("prizes")&&e.listenTo(e.world.cmp("prizes"),"change:progress",e._checkCanRuleLevel,e),e.world.hasComponent("task")&&e.listenTo(e.world.cmp("task").getTasks(),"change:complete",e._checkCanRuleLevel,e)})}},{key:"_checkCanRuleLevel",value:function(){this.set("canRunLevel",this.isCanRunLevel())}},{key:"isOutOfMainLevels",value:function(){return this.world.get("progress")>this.world.get("levelsInEpisode")}},{key:"isCanRunLevel",value:function(){if(!this.isOutOfMainLevels())return!0;if(this.world.hasComponent("randomLevel")){if(this.world.hasComponent("prizes")&&!this.world.cmp("prizes").isFinal())return!0;if(this.world.hasComponent("task")){var e=this.world.cmp("task");if(e.getDebtAmount()>e.goldSource.get())return!0}}return!1}}]),i}(),ProlongateWorldButtonView=Backbone.View.extend({events:{"click .touchArea":"open"},initialize:function(){this.listenTo(this.model,"change:active",this.update),this.timer=new TimerView({el:this.$(".mTimeWrapper"),model:this.model}),this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active"))},open:function(){this.model.show()}}),ProlongateWorldComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){var t=this;return this.timer=new Timer,Promise.resolve().then(function(){return _get(_getPrototypeOf(i.prototype),"init",t).call(t)}).then(function(){return t.checkActive()}).then(function(e){e&&t.get("showWindowAfterInit")&&t.open()}).then(function(){t.get("worldEvents").forEach(function(e){t.world.on(e,t.checkActive,t)}),application.on("change:page",t.checkActive,t)})}},{key:"checkActive",value:function(){var i=this;return Promise.resolve().then(function(){i.getOffer();var e=application.getCurrentServerTime(),t=i.world.bonusWorldFinishTime;return!!t&&(i.actionFinishTime=t+i.world.get("prolongAvailableDuration"),!i.world.get("finished")&&(!(e<t)&&(!!i.world.get("allowProlong")&&(!(e>=i.actionFinishTime)&&i.get("rules")()))))}).then(function(e){return e&&(!i.btn&&i.get("createButton")&&(i.btn=i.createButton()),i.timer.start(i.actionFinishTime-application.getCurrentServerTime()),i.timer.once("finish",i.onTimeout,i)),i.set("active",e),e})}},{key:"onTimeout",value:function(){this.world.set("active",!1),this.world.set("allowProlong",!1),this.checkActive()}},{key:"open",value:function(){this.show()}},{key:"getOffer",value:function(){var e=application.cmp(ApplicationOffersComponent).getOfferById(this.world.get("extensionOfBonusWorldTimeOfferId"));return e||(e=this.createCoinsOffer()),e}},{key:"createCoinsOffer",value:function(){return new Offer({id:"bonusworldtime",coins:500,products:[{type:"prolong",amount:24,world:this.world}]})}},{key:"createButton",value:function(){var e=$("#map .prolongateButtonsContainer");return new ProlongateWorldButtonView({el:$(".mainTemplates .timeButton").clone().addClass("prolongateBtn").addClass(this.world.get("name")).appendTo(e),model:this})}},{key:"prolongate",value:function(){this.world.prolongate()}},{key:"show",value:function(){new BonusWorldTimeoutWindow({world:this.world,offer:this.getOffer(),prize:this.get("prizeForProlong")?this.get("prizeForProlong")():null})}},{key:"getTimer",value:function(){return this.timer.getTimer()}}]),i}();ProlongateWorldComponent.prototype.defaults=_.defaults({id:"prolongate",active:!0,stackButtonsOrder:200,worldEvents:["change:timeout"],rules:rules.Rule(function(){return!0}),createButton:!0,showWindowAfterInit:!0},BonusWorldComponent.prototype.defaults);var BaseSelectStrategy=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"select",value:function(e){throw new Error("Not implemented")}}]),e}(),RandomWeighedStrategy=function(e){_inherits(i,BaseSelectStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"select",value:function(e){var t=e.map(function(e){return e.get("chance")});return e[util.randomChance(t)]}}]),i}(),PrizePoolsComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){var e=this;return this.world.cmp("data").bind(this,{name:"givenPrizes"}),_get(_getPrototypeOf(i.prototype),"init",this).call(this).then(function(){return Promise.all(e.get("prizePools").map(function(e){return e.init()}))})}},{key:"reset",value:function(){return this.set("givenPrizes",""),this.get("prizePools").forEach(function(e){e.updatePrizes()}),BonusWorldComponent.prototype.reset.call(this)}}]),i}();PrizePoolsComponent.prototype.defaults=_.defaults({id:"prizePools",givenPrizes:""},BonusWorldComponent.prototype.defaults);var PrizePool=function(e){_inherits(a,Backbone.Model);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,t)).world=e,i.prizes=t.prizes.map(function(e){return new Prize(_.extend(e,{name:i.world.get("name")+".prizePool"+e.id}))}),i._selectPrizeStrategy=t.selectPrizeStrategy,i}return _createClass(a,[{key:"init",value:function(){var e=this;return this.prizePoolsComponent=this.world.cmp("prizePools"),Promise.resolve().then(function(){e.updatePrizes()})}},{key:"givePrize",value:function(e){if(this.isEmpty())throw new Error("     .");var t=e?this.getPrizeById(e):this.selectPrize();if(!t)throw new Error("  ");t.set("given",!0),this.prizePoolsComponent.set("givenPrizes",(this.prizePoolsComponent.get("givenPrizes").length?this.prizePoolsComponent.get("givenPrizes")+",":"")+t.get("id").toString()),new AnimatedPrizesWindow({prizes:t.getProducts()})}},{key:"selectPrize",value:function(){return this._selectPrizeStrategy.select(this.getPrizes())}},{key:"isEmpty",value:function(){return 0===this.getPrizes().length}},{key:"updatePrizes",value:function(){var t=this.prizePoolsComponent.get("givenPrizes").split(",");this.prizes.forEach(function(e){e.set("given",-1!==t.indexOf(e.get("id").toString()))})}},{key:"getPrizeById",value:function(t){return this.prizes.find(function(e){return e.get("id")==t})}},{key:"getPrizes",value:function(){return this.prizes.filter(function(e){return!e.get("given")})}}]),a}(),BaseProgressPrizeCounter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(e){this._component=e}},{key:"destroy",value:function(){}}]),e}(),ProgressPrizeComponent=function(e){_inherits(n,BonusWorldComponent);var a=_createSuper(n);function n(e,t){var i;_classCallCheck(this,n),(i=a.call(this,_.defaults({progress:0,maxProgress:0},e),t))._counter=e.counter||new BaseProgressPrizeCounter;var o=i.get("maxProgress");return e.prizes=e.prizes.map(function(e){return e.world=i.world,e.name=i.world.get("name")+".rewardPrize"+e.progress,o<e.progress&&(o=e.progress),e}).sort(function(e,t){return e.progress-t.progress}),i.set("maxProgress",o),i._prizes=new Backbone.Collection(e.prizes,{model:Prize}),i}return _createClass(n,[{key:"init",value:function(e){var t=this;return Promise.resolve().then(function(){return _get(_getPrototypeOf(n.prototype),"init",t).call(t,e)}).then(function(){return t._counter.init(t)})}},{key:"setProgress",value:function(e){return this.set("progress",e),this.emit("update",this,this.get("progress"))}},{key:"getMaxProgress",value:function(){return this.get("maxProgress")}},{key:"addProgress",value:function(e){var i=this,t=this.get("progress"),o=Math.min(t+e,this.getMaxProgress());return this._prizes.filter(function(e){return e.get("progress")>t&&e.get("progress")<=o}).reduce(function(e,t){return e.then(function(e){return i.set("progress",t.get("progress")),i.emit("progress",i,i.get("progress"),t).then(function(){new AnimatedPrizesWindow({prizes:t.getProducts()})})})},Promise.resolve({})).then(function(){if(i.get("progress")!==o)return i.set("progress",o),i.emit("progress",i,i.get("progress"))})}},{key:"destroy",value:function(){this._counter.destroy()}},{key:"getPrizes",value:function(){return this._prizes}},{key:"getPrizeByProgress",value:function(t){return this._prizes.find(function(e){return e.get("progress")===t})}}]),n}(),ProgressPrizeProgressBarView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:progress",this.update),this.listenTo(this.model.world,"enter",this.update)},update:function(){var e=this.$(".progressBarLine"),t=100*this.model.get("progress")/this.model.get("maxProgress");e.css("width",t+"%");var i=this.model.getPrizes();this.prizes||this.createPrizes(i);for(var o=0;o<i.length;o++)this.prizes[o].toggleClass("opened",this.model.get("progress")>=i.at(o).get("progress"))},createPrizes:function(e){this.prizes=[];for(var t=1;t<=e.length;t++){var i=e.at(t-1),o=$('<div class="prize"><div class="chest"></div><div class="prizeBlock"></div></div>').appendTo(this.$el.find(".prizes"));this.prizes.push(o),new UserPrizesView({el:o.find(".prizeBlock"),model:i.getProducts(),isGroup:!0}),o.addClass("prize".concat(t)),o.css("left",100*i.get("progress")/this.model.get("maxProgress")+"%")}}}),TaskProgressPrizeCounter=function(e){_inherits(o,BaseProgressPrizeCounter);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this))._taskComponent=e,t}return _createClass(o,[{key:"init",value:function(e){var t=this;_get(_getPrototypeOf(o.prototype),"init",this).call(this,e),this._component.world.on("enter",function(){t._component.setProgress(t.countProgress())}),this._taskComponent.on("afterCompleteTask",this.onCompleteTask,this)}},{key:"countProgress",value:function(){return this._taskComponent.getTasks().filter(function(e){return e.get("complete")}).length}},{key:"destroy",value:function(){_get(_getPrototypeOf(o.prototype),"destroy",this).call(this),this._taskComponent.off("afterCompleteTask",this.onCompleteTask,this)}},{key:"onCompleteTask",value:function(){this._component.addProgress(1)}}]),o}(),Stage=function(e){_inherits(n,Backbone.Model);var a=_createSuper(n);function n(e,t,i){var o;return _classCallCheck(this,n),(o=a.call(this,e)).number=i,o.offers=e.offerIds.map(function(e){return t.getOfferById(e)}),o.prizePool=e.prizePool,o}return _createClass(n,[{key:"init",value:function(){this.set("completed",this.completed())}},{key:"completed",value:function(){var t=!0;return this.offers.forEach(function(e){e.isSoldOut()||(t=!1)}),t}}]),n}(),ChestsAndKeysComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(i,e){var t;return _classCallCheck(this,a),(t=o.call(this,i,e)).stages=i.stages.map(function(e,t){return new Stage(e,i.offers,t+1)}),t.offersComponent=i.offers,t.offersComponent.on("offersInited",t.initStages,_assertThisInitialized(t)),t.world.on("offerBought",t.onOfferBought,_assertThisInitialized(t)),t.world.on("enter",t.onEnter,_assertThisInitialized(t)),t.initSpecialPrizes(i.specialPrizes),t}return _createClass(a,[{key:"init",value:function(){return this.world.cmp("data").bind(this,{name:"stage"}),_get(_getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"initStages",value:function(){this.stages.forEach(function(e){return e.init()})}},{key:"initSpecialPrizes",value:function(e){var i=this;e.forEach(function(t){var e=i.offersComponent.offers.find(function(e){return e.get("id")==t.offerId});e&&e.products.at(0).set("prizeId",t.prizeId)})}},{key:"getStage",value:function(e){return this.stages[e||this.getStageNumber()-1]}},{key:"getStageNumber",value:function(){return this.get("stage")}},{key:"onOfferBought",value:function(e){var t=this,i=this.getStage();i.completed()&&!this.isFinalStage(i)?this.set("stage",i.number+1):this.trigger("completed"),Promise.resolve().then(function(){return t.emit("chestOpened",e)}).then(function(){if(i.completed()&&!i.get("completed"))return i.set("completed",!0),t.stageCompleted(i)})}},{key:"stageCompleted",value:function(t){var e=this;return Promise.resolve().then(function(){return e.emit("beforeStage".concat(t.number,"Completed"))}).then(function(){if(t.get("finalPrize")){var e=new Prize({products:t.get("finalPrize").get("products")});e.take(),new ChestsAndKeysCompleteWindow({world:Config.bonusWorld,prizes:e.getProducts(),stage:t})}}).then(function(){return e.emit("stage".concat(t.number,"Completed"))}).then(function(){return e.emit("stageCompleted")}).then(function(){return e.emit("afterStage".concat(t.number,"Completed"))}).then(function(){if(!e.isFinalStage(t))return e.emit("newStage",t.number+1);e.set("completed",!0)})}},{key:"completed",value:function(){return this.getStage().completed()&&this.isFinalStage(this.getStage())}},{key:"getTotalKeys",value:function(){return this.offersComponent.offers.reduce(function(e,t){return e+Number(t.get("price"))},0)}},{key:"getRestKeys",value:function(){return this.offersComponent.offers.filter(function(e){return!e.isSoldOut()}).reduce(function(e,t){return e+Number(t.get("price"))},0)}},{key:"getChests",value:function(){return this.offersComponent.offers}},{key:"onEnter",value:function(){this.checkStages(),this.set("completed",this.completed())}},{key:"isFinalStage",value:function(e){return e.number===this.stages.length}},{key:"reset",value:function(){return this.set("stage",1),this.initStages(),BonusWorldComponent.prototype.reset.call(this)}},{key:"checkStages",value:function(){var t=this,i=1;this.stages.forEach(function(e){e.completed()&&e.number>=i&&(i=Math.min(e.number+1,t.stages.length))}),this.get("stage")!=i&&this.set("stage",i)}}]),a}();ChestsAndKeysComponent.prototype.defaults=_.defaults({id:"chestsAndKeys",stage:1},BonusWorldComponent.prototype.defaults);var ChestsAndKeysView=Backbone.View.extend({events:{"click .mBuyBtn":"buyOffer"},initialize:function(e){this.world=e.world,this.model.on("newStage",this.onNewStage,this),this.model.on("change:completed",this.updateTickets,this),this.world.on("beforeOpen",this.onNewStage,this)},render:function(){new ChestsAndKeysProgressBar({model:this.model,el:$('<div class="progressBar"><div class="progressBarLineWrapper"><div class="progressBarLine"></div></div></div>').appendTo(this.$el),world:this.world}),new ChestsAndKeysStageView({model:this.model.getStage(),el:$('<div class="stage"></div>').appendTo(this.$el),component:this.model,world:this.world}),this.updateTickets()},buyOffer:function(e){var t=this,i=this.model.offersComponent.getOfferById($(e.target).data("offerId"));i&&i.canBuy().then(function(e){e&&t.model.offersComponent.buy(i)})},onNewStage:function(){this.$(">.stage").remove(),new ChestsAndKeysStageView({model:this.model.getStage(),el:$('<div class="stage"></div>').appendTo(this.$el),component:this.model,world:this.world})},updateTickets:function(){$(".".concat(this.world.getName()," .tickets")).toggleClass("hidden",this.model.completed())}}),ChestsAndKeysProgressBar=Backbone.View.extend({initialize:function(e){this.world=e.world;var i=$('<div class="stages"></div>').appendTo(this.$el);this.model.stages.forEach(function(e){var t=$('<div class="stage"></div>');i.append(t),t.addClass("stage"+e.number)}),this.updateStages(),this.update(),this.model.on("stageCompleted",this.updateStages,this),this.model.on("chestOpened",this.update,this),this.world.on("enter",this.updateStages,this),this.world.on("enter",this.update,this)},updateStages:function(){var t=this;this.model.stages.forEach(function(e){t.$(".stage"+e.number).toggleClass("completed",e.completed())})},update:function(){var e=this.$(".progressBarLine"),t=this.calcProgressBarPercent();e.css("width",t+"%")},calcProgressBarPercent:function(){var a=0,n=this.model.stages.length;return this.model.stages.forEach(function(e){var t=e.offers,i=t.length,o=t.filter(function(e){return e.isSoldOut()}).length;a+=100*o/i/n}),a}}),ChestsAndKeysStageView=Backbone.View.extend({initialize:function(e){this.component=e.component,this.world=e.world,this.render(),this.$el.addClass("stage"+this.model.number),this.component.on("chestOpened",this.updatePrizes,this),this.world.on("enter",this.updatePrizes,this)},render:function(){$('<div class="prizeContainer"><div class="prizes"></div></div>').appendTo(this.$el),$('<div class="chests"></div>').appendTo(this.$el),this.renderPrizes(),this.renderChests(),this.updatePrizes()},renderPrizes:function(){var i=this;this.model.prizePool.prizes.forEach(function(e){var t="prize"+e.get("id");new UserPrizesView({model:new UserPrizes(e.getProducts()),el:$('<div class="'.concat(t,'"></div>')).appendTo(i.$(".prizes"))})})},renderChests:function(){var t=this.$(".chests");this.model.offers.forEach(function(e){new OfferDeskComponentView({model:e,el:$(".mainTemplates .bonusWorldOffer").clone()}).$el.appendTo(t)})},updatePrizes:function(){var t=this;this.model.prizePool.prizes.forEach(function(e){t.$(".prize"+e.get("id")).toggleClass("given",e.get("given"))})}}),ChestsAndKeysCompleteWindow=TWindow.extend({templateClass:".chestsAndKeysCompleteWindow_template",events:{"click .continue":"close"},prepareWindow:function(){this.$(".windowTitle").html(messages[this.options.world.get("name")+"RoomPassedWindowTitle"]),this.$el.find(".mainText").html(messages[this.options.world.get("name")+"RoomPassedWindowText"][this.options.stage.number]),this.$el.find(".prizesText").html(messages.bonusWorldLevelPrizeText),this.$el.find(".prizeGet").html(messages.bonusWorldLevelPrizeContinue),this.$(".chest").addClass("stage"+this.options.stage.number)},createPrizes:function(){this.$el.addClass("prize"),new UserPrizesView({model:this.options.prizes,el:this.$(".prizes")})},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.addClass("episode_"+Config.bonusWorld.get("name")),this.prepareWindow(),this.createPrizes()},onClose:function(){TWindow.prototype.onClose.call(this)}}),Dice=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:6,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Random;_classCallCheck(this,i),this._randomizer=t,this._sides=e}return _createClass(i,[{key:"roll",value:function(){return this._randomizer.randomIntRange(1,this._sides)}}]),i}(),SpecialDice=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;_classCallCheck(this,t),this._result=e}return _createClass(t,[{key:"roll",value:function(){return this._result}}]),t}();function DiceCreate(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Random,r=[];return e.split(" ").forEach(function(e){for(var t=_slicedToArray(e.split("d"),2),i=t[0],o=t[1],a=0;a<i;++a)r.push(new Dice(parseInt(o),n))}),r}var DiceRollerComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){return this._specialDices=this.get("specialDices").slice(),_get(_getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"getOffer",value:function(){return this.get("offer")}},{key:"buy",value:function(){if(this.get("offer"))return this.get("offer").buy();throw new Error("Not finde offer")}},{key:"roll",value:function(){var t=this;return Promise.resolve().then(function(){if(t.get("rollStock")<=0)return t.buy()}).then(function(){if(0<t.get("rollStock"))return t.set("rollStock",t.get("rollStock")-1),t.getDices().map(function(e){return e.roll()});throw new Error("Dont have rollStock")}).then(function(e){return console.log("[DiceRoll] roll ",e),t.emit("roll",t,e).then(function(){return t.emit("afterRoll",t,e)}).then(function(){return e}).then(function(){return t.trigger("rollActionsEnded",t,e)})}).catch(function(){t.trigger("failedBuyRollStock")})}},{key:"getDices",value:function(){return this.get("specialDices")&&0<this._specialDices.length&&this.world.get("firstStart")?this._specialDices.shift():this.get("dices")}},{key:"reset",value:function(){this._specialDices=this.get("specialDices").slice()}}]),i}();DiceRollerComponent.prototype.defaults=_.defaults({id:"diceRoller",rollStock:0,offer:null,dices:[new Dice(6)]},BonusWorldComponent.prototype.defaults);var BaseParticipantBehaviorStrategy=function(e){_inherits(o,Backbone.Model);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this,e))._users=[],t}return _createClass(o,[{key:"init",value:function(e){this.world=e}},{key:"registry",value:function(e){this._users.push(e)}},{key:"beforeRoll",value:function(){this.set("updated",!1)}},{key:"firstRoll",value:function(){}},{key:"ticketRoll",value:function(e){}},{key:"timeoutRoll",value:function(e){}}]),o}();BaseParticipantBehaviorStrategy.prototype.defaults=_.defaults({id:"behaviorStrategy"},Backbone.Model.prototype.defaults);var BotRollStrategy=function(e){_inherits(i,BaseParticipantBehaviorStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"firstRoll",value:function(){var o=this;this._users.forEach(function(e){var t=o.get("firstDice"),i=o.get("firstDiceAmount");i instanceof Array&&(i=randomizer.randomIntRange(i[0],i[1])),o.diceRoller(e,t,i)})}},{key:"diceRoller",value:function(e,t,i){for(var o=0,a=0;a<i;++a)o=t.reduce(function(e,t){return t.roll()+e},o);0<o&&(e.addProgress(o),this.set("updated",!0))}},{key:"ticketRoll",value:function(t){var i=this;this._users.forEach(function(e){return i.ticketRollByUser(e,t)})}},{key:"ticketRollByUser",value:function(e,t){var i=e.Progress-this.world.cmp("diceAdventure").CurrentUser.Progress,o=this.get("ticketRollOptions").sort(function(e,t){return e.rolls-t.rolls}).find(function(e){return i<e.diff});o&&this.diceRoller(e,o.dices,t)}},{key:"timeoutRoll",value:function(e){var i=this,t=util.duration(this.get("timeout")),o=Math.round(e/t);if(t<=e){var a=this.get("timeRollOptions").sort(function(e,t){return e.rolls-t.rolls}).find(function(e){return o<=e.rolls});a&&this._users.forEach(function(e){var t=o;void 0!==a.rollsFrom&&(t=randomizer.randomIntRange(a.rollsFrom,o)),i.diceRoller(e,a.dices,t)})}}}]),i}();BotRollStrategy.prototype.defaults=_.defaults({firstDice:[],firstDiceAmount:0,ticketRollOptions:[],timeout:"8h",timeRollOptions:[]},BaseParticipantBehaviorStrategy.prototype.defaults);var DiceRollStrategy=function(e){_inherits(i,BaseParticipantBehaviorStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){_get(_getPrototypeOf(i.prototype),"init",this).call(this,e),this.listenTo(this.get("roller"),"afterRoll",this.onRoll)}},{key:"onRoll",value:function(e,t){var i=t.reduce(function(e,t){return e+t});return Promise.all(this._users.map(function(e){return e.addProgress(i)}))}}]),i}(),PassiveStrategy=function(e){_inherits(i,BaseParticipantBehaviorStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i)}(),DiceAdventureItem=function(e){_inherits(i,Backbone.Model);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onStep",value:function(e){return Promise.resolve()}},{key:"onLeave",value:function(e){return Promise.resolve()}},{key:"Prize",get:function(){var e=this.get("prize");return e instanceof Array&&(e=e.filter(function(e){return!e.get("available")||e.get("available")()})[0]),e}}]),i}(),DiceAdventureUser=function(e){_inherits(o,Backbone.Model);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this,e))._userInfo=new UserInfo({firstName:"",lastName:""}),t}return _createClass(o,[{key:"init",value:function(e){this.get("strategy")&&this.get("strategy").registry(this)}},{key:"UserInfo",get:function(){return this._userInfo}},{key:"Progress",get:function(){return this.get("progress")},set:function(e){this.set("progress",e)}},{key:"addProgress",value:function(e){var t=this,i=this.Progress;return this.Progress=i+e,Promise.resolve().then(function(){return t.emit("beforeAddProgress",t,e,i)}).then(function(){return t.emit("addProgress",t,e,i)}).then(function(){return t.emit("afterAddProgress",t,e,i)})}}]),o}();DiceAdventureUser.prototype.defaults=_.defaults({progress:0,profileId:0,strategy:null,place:0},Backbone.Model.prototype.defaults);var DiceAdventureBot=function(e){_inherits(i,DiceAdventureUser);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i)}(),DiceAdventureCurrentUser=function(e){_inherits(i,DiceAdventureUser);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){_get(_getPrototypeOf(i.prototype),"init",this).call(this,e),this._userInfo.set("firstName",user.get("name")),this._userInfo.set("lastName",""),this._userInfo.set("photoUrl",user.get("photo"))}}]),i}(),DiceAdventureComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e,t))._items=new Backbone.Collection(e.items.map(function(e,t){return e.num=t+1,e}),{model:DiceAdventureItem}),i._users=new Backbone.Collection(e.users.map(function(e,t){return e.place=t+1,1===e.id?new DiceAdventureCurrentUser(e):new DiceAdventureBot(e)})),i._users.comparator=function(e,t){return t.get("progress")-e.get("progress")},i}return _createClass(a,[{key:"init",value:function(){var t=this;return this.world.cmp("data").bind(this.CurrentUser,{name:"progress"}),Promise.all(this._users.map(function(e){return e.init(t.world)})).then(function(){t.listenTo(t.CurrentUser,"addProgress",t.onChangeProggressCurrontUser),t.listenTo(t._users,"change:progress",util.bundle(t.onChangeBotProgress))}).then(function(){return t.loadBotData()}).then(function(){return delay(100)})}},{key:"loadBotData",value:function(){var a=this;return service("../../../gems/site/service/diceAdventure/bots/load.php",{worldName:this.world.getName()}).then(function(e){var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.id=Number(o.id),o.profileId=Number(o.profileId),o.progress=Number(o.progress),a._users.get(o.id).set(o)}}catch(e){i.e(e)}finally{i.f()}})}},{key:"open",value:function(){var i=this,o=this.get("userInfos"),a=_.shuffle(_.difference(this.get("userInfos").map(function(e){return e.id}),this._users.map(function(e){return e.profileId}))),n=!1;return this._users.forEach(function(t){if(t instanceof DiceAdventureBot&&(t.get("profileId")||(t.set("profileId",a.pop()),n=!0),t.get("profileId"))){var e=o.find(function(e){return e.id==t.get("profileId")});e&&t.UserInfo.set(_.assign(e,{photoUrl:"".concat(i.get("botStaticUrl"),"/").concat(e.id,".jpg")}))}}),n&&this.save(this._users.filter(function(e){return e instanceof DiceAdventureBot})),Promise.resolve()}},{key:"onChangeBotProgress",value:function(e){this.save(e),this._users.sort(),this._users.forEach(function(e,t){e.set("place",t+1)})}},{key:"save",value:function(e){var t=e.filter(function(e){return e instanceof DiceAdventureBot}).map(function(e){return e.pick("id","progress","profileId")});return t.length?service("../../../gems/site/service/diceAdventure/bots/update.php",{worldName:this.world.getName(),bots:t}):Promise.resolve()}},{key:"onChangeProggressCurrontUser",value:function(e,t,i){var o=this,a=this.getItemFromProgress(i),n=this.getItemFromProgress(e.Progress);return Promise.resolve().then(function(){return o.emit("leave",o,a)}).then(function(){return a.onLeave()}).then(function(){return o.emit("step",o,n)}).then(function(){return n.onStep(e)}).then(function(){if(n.Prize)return n.Prize.prepare().then(function(t){return o.emit("takePrize",t,o,n).then(function(){return new Promise(function(e){new AnimatedPrizesWindow({prizes:t.getProducts(),onClose:e})})})})})}},{key:"CurrentUser",get:function(){return this._users.get(1)}},{key:"Items",get:function(){return this._items}},{key:"Users",get:function(){return this._users}},{key:"getItemFromProgress",value:function(e){return this._items.at(e%this._items.length)}},{key:"reset",value:function(){this.Users.forEach(function(e){e.set("progress",0),e.set("profileId",0)})}}]),a}();DiceAdventureComponent.prototype.defaults=_.defaults({id:"diceAdventure",dicePointsByStep:15,botStaticUrl:"https://static.tapclap.com/static/gems/bots"},BonusWorldComponent.prototype.defaults);var BotTicketsCollector=function(){function i(e,t){_classCallCheck(this,i),this._collector=e,this._ticketId=t}return _createClass(i,[{key:"init",value:function(e,t){this._owner=t,this._collector.on("prizeCollected",this.onPrizeCollector,this)}},{key:"onPrizeCollector",value:function(e){var t=e.findWhere({type:"TicketsProduct",componentId:this._ticketId});t&&this._owner.set("botTickets",this._owner.get("botTickets")+t.get("amount"))}}]),i}(),DiceAdventureParticipantsBehavior=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e,t))._behaviors=new Backbone.Collection(e.behaviors),i._collector=e.collector,i}return _createClass(a,[{key:"init",value:function(){var t=this;return this.world.cmp("data").bind(this,{name:"botTickets"},{name:"lastBotUpdate"}),this.listenTo(this.world,"afterLoad",this.onLoad),Promise.all(this._behaviors.map(function(e){return e.init(t.world)})).then(function(){return t._collector.init(t.world,t)})}},{key:"behavior",value:function(e){return this._behaviors.get(e)}},{key:"onLoad",value:function(){return this.showDiffInfo(this.roll())}},{key:"showDiffInfo",value:function(e){var t=this,o=this.world.cmp("diceAdventure").Users.map(function(e){return{id:e.get("id"),progress:e.get("progress")}});return o.sort(function(e,t){return t.progress-e.progress}),o.forEach(function(e,t){e.place=t+1}),e.then(function(){var e=t.world.cmp("diceAdventure").Users.map(function(e){return{id:e.get("id"),progress:e.get("progress"),strategy:e.get("strategy")}});e.sort(function(e,t){return t.progress-e.progress}),e.forEach(function(t,e){var i=o.find(function(e){return e.id===t.id});t.place=e+1,i.place!==t.place&&(i.place<t.place?t.place+=" "+(i.place-t.place):t.place+=" "+(i.place-t.place)),i.progress!==t.progress&&(i.progress<t.progress?t.progress+=" "+(t.progress-i.progress):t.progress+=" "+(t.progress-i.progress)),t.group=t.strategy.get("id"),delete t.strategy}),console.table(e)})}},{key:"roll",value:function(){var t=this,i=!1,o=this.get("botTickets");return Promise.resolve().then(function(){return t.beforeRoll()}).then(function(){if(0===t.get("lastBotUpdate"))return i=!0,t.firstRoll()}).then(function(){if(t.get("lastBotUpdate")){var e=application.getCurrentServerTime()-t.get("lastBotUpdate");return t.timeoutRoll(e)}}).then(function(){var e=Math.round(o/t.get("price"));if(0<e)return i=!0,o=0,t.ticketRoll(e)}).then(function(){(i||t._behaviors.findWhere({updated:!0}))&&(t.set({botTickets:o,lastBotUpdate:application.getCurrentServerTime()}),t.set("updated",!0))}).catch(function(e){console.error(e)})}},{key:"beforeRoll",value:function(){return this.set("updated",!1),Promise.all(this._behaviors.map(function(e){return e.beforeRoll()}))}},{key:"firstRoll",value:function(){return Promise.all(this._behaviors.map(function(e){return e.firstRoll()}))}},{key:"ticketRoll",value:function(t){return Promise.all(this._behaviors.map(function(e){return e.ticketRoll(t)}))}},{key:"timeoutRoll",value:function(t){return Promise.all(this._behaviors.map(function(e){return e.timeoutRoll(t)}))}}]),a}();DiceAdventureParticipantsBehavior.prototype.defaults=_.defaults({id:"behaviorStrategy",price:20,botTickets:0,lastBotUpdate:0},BonusWorldComponent.prototype.defaults);var LeaderBoardComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){this.listenTo(this.world,"finish",this.onFinish),this.world.cmp("data").bind(this,{name:"started",converter:new BooleanConverter})}},{key:"onFinish",value:function(){var e=this;if(!this.get("started"))return Promise.resolve();var t=this.get("currentUser").get("place"),i=_.findWhere(this.get("prizes"),{place:t});return i||(i=this.get("consolationPrize")),i=new Prize(_.assign({name:this.world.getName()+".place"+t},i)),Promise.resolve().then(function(){return e.emit("takePlace"+t,e)}).then(function(){if(3<t)return e.emit("lose",e)}).then(function(){new LeaderBoardPrizeWindow({world:e.world,place:t,prize:i}),new AnimatedPrizesWindow({prizes:i.get("products"),worldName:e.world.get("name"),notGive:!0})}).then(function(){return i.take()})}},{key:"getTimer",value:function(){return this.world.cmp("timer").getTimer()}},{key:"openLeaderBoard",value:function(){new LeaderBoardWindow({model:this},this.world.ln)}},{key:"reset",value:function(){this.set("started",!1)}}]),i}();LeaderBoardComponent.prototype.defaults=_.defaults({id:"leaderBoard",users:null,started:!1},BonusWorldComponent.prototype.defaults);var DiceAdventureUserView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(){this.$el.addClass("user").addClass("user"+this.model.get("id"))}},{key:"alignTo",value:function(e){this.$el.alignTo(e.$el)}}]),i}(),DiceAdventurePointView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(){this.$el.addClass("point").addClass("point"+this.model.get("num")).addClass("type-"+this.model.get("type"))}}]),i}(),DiceAdventureView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(){this._users=[],this._points=[]}},{key:"render",value:function(){var i=this;this._points=this.model.Items.map(function(e){var t=new DiceAdventurePointView({model:e});return t.$el.appendTo(i.$el),t}),this.createUser(this.model.CurrentUser),this.listenTo(this.model.world,"enter",this.onEnter),this.listenTo(this.model.CurrentUser,"beforeAddProgress",this.onAddProgressCurrentUser)}},{key:"onEnter",value:function(){this.updatePosition(this.model.CurrentUser,this.getPointPosition(this.model.CurrentUser.Progress))}},{key:"createUser",value:function(e){var t=new DiceAdventureUserView({model:e});t.$el.appendTo(this.$el),this._users[e.cid]=t}},{key:"getViewByUser",value:function(e){return this._users[e.cid]}},{key:"getPointPosition",value:function(e){return this._points[e%this._points.length]}},{key:"updatePosition",value:function(e,t){var i=this.getViewByUser(e);i&&i.alignTo(t)}},{key:"onAddProgressCurrentUser",value:function(e,t,i){return util.animateToPromise(this.animateMoveUser,this,e,i,t)}},{key:"animateMoveUser",value:function(t,e,n,i){var r=this,s=this.getViewByUser(e);if(s){for(var o=function(){var i=r.getPointPosition(n+l).$el,o=r.getPointPosition(n+l-1).$el,a=r.getPointPosition(n+l+1).$el;s.$el.queue(function(e){var t=o.position().left>i.position().left;s.$el.toggleClass("left",t).addClass("jumping"),e()}).ourAnimate({target:i},300,"easeInOutQuad").queue(function(e){s.$el.removeClass("jumping"),e()}).queue(function(e){var t=a.position().top>i.position().top?10:12;r.animateDicePoint(i.position(),t),e()})},l=1;l<i;++l)o();var a=this.getPointPosition(n+i).$el;s.$el.queue(function(e){s.$el.addClass("finalJump"),e()}).ourAnimate({target:a},400,"easeInOutQuad").queue(function(e){s.$el.removeClass("finalJump"),r.animateDicePoints(a.position(),i),e(),t()})}else next()}},{key:"animateDicePoint",value:function(e,t){var i=$(".invisible .dicePoint").clone();i.find(".price").html(this.model.get("dicePointsByStep")),this.$el.append(i),i.css("top",e.top),i.css("left",e.left),i.css("z-index",t),setTimeout(function(){i.remove()},1e3)}},{key:"animateDicePoints",value:function(e,t){var i=$(".invisible .dicePointsContainer").clone();this.$el.append(i),i.css("top",e.top),i.css("left",e.left);for(var o=0;o<Math.min(t,9);o++){var a=$('<div class="dicePointPiece"></div>');i.find(".dicePoints").append(a)}i.find(".totalPrice").html("+"+this.model.get("dicePointsByStep")*t),setTimeout(function(){i.remove()},1e3)}}]),i}();DiceAdventureView.prototype.className="diceAdventureBoard";var DiceRollButtonView=function(e){_inherits(i,ButtonWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){ButtonWorldView.prototype.initialize.call(this,e,t),this.$el.addClass("diceRollButton"),this.$(".mLabel").html(t.print("DiceAdventure.DiceRollButton.text")),this.$(".mPrice").html(this.model.getOffer().getTextPrice())}},{key:"onAction",value:function(){return this.model.roll()}}]),i}(),DiceRollView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){this._delay=e&&e.delay||1e4,this.listenTo(this.model,"roll",this.onRoll)}},{key:"onRoll",value:function(e,i){var o=this;return Promise.resolve().then(function(){o.$el.addClass("process");var t=o.$(".mItems").empty();return $("<div/>").addClass("diceAll").html(i.reduce(function(e,t){return e+t})).appendTo(t),i.forEach(function(e){$("<div/>").addClass("dice dice"+e).appendTo(t)}),delay(o._delay)}).then(function(){o.$el.removeClass("process")})}}]),i}(),DiceAdventureInfoView=function(e){_inherits(i,Backbone.View);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){this.ln=t,this.update(),this.listenTo(this.model,"change:progress",this.update)}},{key:"update",value:function(){this.$(".mDescription1").html(this.ln.print("DiceAdventure.Info.text1",this.model.getNextPrize().get("cicle"))),this.$(".mDescription2").html(this.ln.print("DiceAdventure.Info.text2",this.model.get("progress"))),this.$(".mPrize").removeClass("prizes1").removeClass("prizes2").removeClass("prizes3").removeClass("prizes4").empty(),this._prize=new UserPrizesView({el:this.$(".mPrize"),model:this.model.getNextPrize().getUserPrizes(),isGroup:!0})}}]),i}(),LeaderBoardButtonView=function(e){_inherits(i,ButtonWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){ButtonWorldView.prototype.initialize.call(this,e,t),this.timer=new TimerView({el:this.$(".mTimer"),model:this.model.getTimer()}),this.listenTo(this.model.get("currentUser"),"change:place",this.update),this.update()}},{key:"update",value:function(){this.$(".mPlace").html(this.model.get("currentUser").get("place"))}},{key:"onAction",value:function(){return this.model.openLeaderBoard()}}]),i}(),LeaderBoardWindow=function(e){_inherits(i,TWindow);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onOpen",value:function(){_get(_getPrototypeOf(i.prototype),"onOpen",this).call(this),this.timer=new TimerView({el:this.$(".mTimer"),model:this.model.getTimer()}),this.$(".mTitle").html(this.model.world.ln.print("DiceAdventure.LeaderBoard.title")),this.update()}},{key:"update",value:function(){var o=this,a=this.$(".mItems"),n=this.$(".invisible .item");a.empty(),this.model.get("users").forEach(function(t){var e=n.clone().appendTo(a);e.find(".mName").html(t.UserInfo.get("lastName")+" "+t.UserInfo.get("firstName")),e.find(".mPlace").html(t.get("place")),e.find(".mScores").html(t.get("progress")*o.model.world.getComponent("diceAdventure").get("dicePointsByStep")),e.find(".mAvatar").html(t.UserInfo.getAvatar(50)),1==t.get("id")&&e.addClass("thePlayer");var i=o.model.get("prizes").find(function(e){return e.place===t.get("place")});i&&(e.find(".mPlace").html('<div class="mPrize"></div>'),new UserPrizesView({el:e.find(".mPlace .mPrize"),model:new UserPrizes(UserPrizes.convertFromCocos(i)),isGroup:!0}))})}}]),i}();LeaderBoardWindow.prototype.templateClass=".leaderBoardWindow_template";var LeaderBoardPrizeWindow=function(e){_inherits(i,TWindow);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"offPublicCheckbox",value:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")}},{key:"onPublicCheckbox",value:function(){this.options.publicationOff||(this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn"))}},{key:"togglePublicCheckbox",value:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()}},{key:"backToMainWorld",value:function(){if(this.needPublic){var e=this.getPublicationId(this.options.place);user.defaultPublication(this.options.world.get("name")+e)}this.close()}},{key:"getPublicationId",value:function(e){switch(e){case 1:return"EndTournamentFirstPlacePublication";case 2:return"EndTournamentSecondPlacePublication";case 3:return"EndTournamentThirdPlacePublication";default:return"EndTournamentAnotherPlacePublication"}}},{key:"getTournamentText",value:function(e){switch(e){case 1:return"firstPlace";case 2:return"secondPlace";case 3:return"thirdPlace";default:return"anotherPlace"}}},{key:"onOpen",value:function(){this.options.publicationOff?(this.offPublicCheckbox(),this.$el.addClass("publicationOff")):this.onPublicCheckbox(),this.prize=this.options.prize,this.$(".windowTitle").html(messages[this.options.world.get("name")+"EndTournamentTitle"]),this.$(".endText").html(messages[this.options.world.get("name")+"EndTournamentText"][this.getTournamentText(this.options.place)]),this.$(".oneWindowBtn.backToMainWorld").html(messages.collect),this.$el.addClass(this.options.world.get("name")),new UserPrizesView({model:this.prize.get("products"),el:this.$(".prizes"),isGroup:!0}),this.prize&&application.playSound("giftReceived"),TWindow.prototype.onOpen.call(this)}}]),i}();LeaderBoardPrizeWindow.prototype.templateClass=".leaderBoardPrizeWindow_template",LeaderBoardPrizeWindow.prototype.events={"click .needPublicCheckbox":"togglePublicCheckbox","touchend .needPublicCheckbox":"togglePublicCheckbox","click .backToMainWorld":"backToMainWorld","touchend .backToMainWorld":"backToMainWorld"};var DiceAdventureBots={ru:[{id:1,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:2,gender:"female",firstName:"",lastName:" ",photoUrl:null},{id:3,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:4,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:5,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:6,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:7,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:8,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:9,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:10,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:11,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:12,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:13,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:14,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:15,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:16,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:17,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:18,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:19,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:20,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:21,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:22,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:23,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:24,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:25,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:26,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:27,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:28,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:29,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:30,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:31,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:32,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:33,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:34,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:35,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:36,gender:"female",firstName:" ()",lastName:"",photoUrl:null},{id:37,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:38,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:39,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:40,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:41,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:42,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:43,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:44,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:45,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:46,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:47,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:48,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:49,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:50,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:51,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:52,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:53,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:54,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:55,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:56,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:57,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:58,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:59,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:60,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:61,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:62,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:63,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:64,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:65,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:66,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:67,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:68,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:69,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:70,gender:"female",firstName:"",lastName:"",photoUrl:null}],en:[{id:1,gender:"female",firstName:"Emily",lastName:"Johnson",photoUrl:null},{id:2,gender:"female",firstName:"Hazel",lastName:"Morgan ",photoUrl:null},{id:3,gender:"male",firstName:"Benjamin",lastName:"Smith",photoUrl:null},{id:4,gender:"male",firstName:"Ethan",lastName:"Johnson",photoUrl:null},{id:5,gender:"male",firstName:"Liam",lastName:"Davis",photoUrl:null},{id:6,gender:"male",firstName:"Samuel",lastName:"Jones",photoUrl:null},{id:7,gender:"female",firstName:"Olivia",lastName:"Smith",photoUrl:null},{id:8,gender:"female",firstName:"Brooklyn",lastName:"Rivera",photoUrl:null},{id:9,gender:"male",firstName:"Noah",lastName:"Clark'",photoUrl:null},{id:10,gender:"male",firstName:"William",lastName:"Anderson",photoUrl:null},{id:11,gender:"male",firstName:"James",lastName:"Wilson",photoUrl:null},{id:12,gender:"female",firstName:"Goldberg",lastName:"Tina",photoUrl:null},{id:13,gender:"female",firstName:"Ava",lastName:"Davis",photoUrl:null},{id:14,gender:"male",firstName:"Aleksandr",lastName:"Fork",photoUrl:null},{id:15,gender:"female",firstName:"Sophia",lastName:"Brown",photoUrl:null},{id:16,gender:"female",firstName:"Savannah",lastName:"Murphy",photoUrl:null},{id:17,gender:"female",firstName:"Mia",lastName:"Miller",photoUrl:null},{id:18,gender:"male",firstName:"Michael",lastName:"Taylor",photoUrl:null},{id:19,gender:"female",firstName:"Isabella",lastName:"Liza",photoUrl:null},{id:20,gender:"female",firstName:"Stella",lastName:"Bailey",photoUrl:null},{id:21,gender:"male",firstName:"Matthew",lastName:"Brown",photoUrl:null},{id:22,gender:"male",firstName:"Joseph",lastName:"Martinez",photoUrl:null},{id:23,gender:"female",firstName:"Tulueva",lastName:"Taylor",photoUrl:null},{id:24,gender:"male",firstName:"Daniel",lastName:"Faris",photoUrl:null},{id:25,gender:"male",firstName:"Farkua",lastName:"Vilas",photoUrl:null},{id:26,gender:"male",firstName:"Kabites",lastName:"Dabis",photoUrl:null},{id:27,gender:"female",firstName:"Charlotte",lastName:"Anderson",photoUrl:null},{id:28,gender:"female",firstName:"Addison",lastName:"Jenkins",photoUrl:null},{id:29,gender:"female",firstName:"Amelia",lastName:"Martinez",photoUrl:null},{id:30,gender:"male",firstName:"",lastName:"Zhomkom",photoUrl:null},{id:31,gender:"male",firstName:"John",lastName:"Harris",photoUrl:null},{id:32,gender:"female",firstName:"",lastName:"Kotya",photoUrl:null},{id:33,gender:"male",firstName:"Alexander",lastName:"Martin",photoUrl:null},{id:34,gender:"male",firstName:"Owen",lastName:"Medichi",photoUrl:null},{id:35,gender:"female",firstName:"Harper",lastName:"Wilson",photoUrl:null},{id:36,gender:"female",firstName:"Lillian",lastName:"Brooks",photoUrl:null},{id:37,gender:"male",firstName:"Jacob",lastName:"Moore",photoUrl:null},{id:38,gender:"male",firstName:"Andrew",lastName:"Hill",photoUrl:null},{id:39,gender:"male",firstName:"Aiden",lastName:"Mitchell",photoUrl:null},{id:40,gender:"male",firstName:"Jonathan",lastName:"Cooper",photoUrl:null},{id:41,gender:"female",firstName:"Evelyn",lastName:"Thompson'",photoUrl:null},{id:42,gender:"female",firstName:"Hannah",lastName:"Cooper",photoUrl:null},{id:43,gender:"male",firstName:"Smit",lastName:"Dzhek",photoUrl:null},{id:44,gender:"male",firstName:"Dylan",lastName:"Morris",photoUrl:null},{id:45,gender:"female",firstName:"Abigail",lastName:"Thomas",photoUrl:null},{id:46,gender:"male",firstName:"Jackson",lastName:"Rogers",photoUrl:null},{id:47,gender:"female",firstName:"Elizabeth",lastName:"Clark",photoUrl:null},{id:48,gender:"female",firstName:"Eleanor",lastName:"Hill",photoUrl:null},{id:49,gender:"female",firstName:"Sofia",lastName:"Lewis",photoUrl:null},{id:50,gender:"female",firstName:"Nora",lastName:"Reed",photoUrl:null},{id:51,gender:"female",firstName:"Avery",lastName:"Walker",photoUrl:null},{id:52,gender:"male",firstName:"Isaac",lastName:"Reed",photoUrl:null},{id:53,gender:"female",firstName:"Ella",lastName:"Hall",photoUrl:null},{id:54,gender:"female",firstName:"Zoey",lastName:"Adams",photoUrl:null},{id:55,gender:"female",firstName:"Scarlett",lastName:"White",photoUrl:null},{id:56,gender:"female",firstName:"Riley",lastName:"Turner",photoUrl:null},{id:57,gender:"female",firstName:"Grace",lastName:"Harris",photoUrl:null},{id:58,gender:"female",firstName:"Layla",lastName:"Mitchell",photoUrl:null},{id:59,gender:"female",firstName:"Victoria",lastName:"Young",photoUrl:null},{id:60,gender:"male",firstName:"Dik",lastName:"Collins",photoUrl:null},{id:61,gender:"female",firstName:"Madison",lastName:"King",photoUrl:null},{id:62,gender:"female",firstName:"Penelope",lastName:"Green",photoUrl:null},{id:63,gender:"male",firstName:"Aaron",lastName:"Price",photoUrl:null},{id:64,gender:"female",firstName:"Chan",lastName:"Li",photoUrl:null},{id:65,gender:"female",firstName:"Chatzi",lastName:"Chun",photoUrl:null},{id:66,gender:"male",firstName:"Chun",lastName:"Nandi",photoUrl:null},{id:67,gender:"male",firstName:"Caden",lastName:"Foster",photoUrl:null},{id:68,gender:"male",firstName:"Josiah",lastName:"Brooks",photoUrl:null},{id:69,gender:"male",firstName:"Levi",lastName:"Foster",photoUrl:null},{id:70,gender:"female",firstName:"",lastName:"Mopsik",photoUrl:null}],jp:[{id:1,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:2,gender:"female",firstName:"",lastName:" ",photoUrl:null},{id:3,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:4,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:5,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:6,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:7,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:8,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:9,gender:"male",firstName:"Noah",lastName:"Clark'",photoUrl:null},{id:10,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:11,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:12,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:13,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:14,gender:"male",firstName:"Aleksandr",lastName:"",photoUrl:null},{id:15,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:16,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:17,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:18,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:19,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:20,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:21,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:22,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:23,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:24,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:25,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:26,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:27,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:28,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:29,gender:"female",firstName:"Amelia",lastName:"Martinez",photoUrl:null},{id:30,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:31,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:32,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:33,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:34,gender:"male",firstName:"Owen",lastName:"Medichi",photoUrl:null},{id:35,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:36,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:37,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:38,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:39,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:40,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:41,gender:"female",firstName:"",lastName:"'",photoUrl:null},{id:42,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:43,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:44,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:45,gender:"female",firstName:"Abigail",lastName:"Thomas",photoUrl:null},{id:46,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:47,gender:"female",firstName:"Elizabeth",lastName:"Clark",photoUrl:null},{id:48,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:49,gender:"female",firstName:"Sofia",lastName:"Lewis",photoUrl:null},{id:50,gender:"female",firstName:"Nora",lastName:"Reed",photoUrl:null},{id:51,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:52,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:53,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:54,gender:"female",firstName:"Zoey",lastName:"Adams",photoUrl:null},{id:55,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:56,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:57,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:58,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:59,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:60,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:61,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:62,gender:"female",firstName:"",lastName:"",photoUrl:null},{id:63,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:64,gender:"female",firstName:"Chan",lastName:"Li",photoUrl:null},{id:65,gender:"female",firstName:"Chatzi",lastName:"Chun",photoUrl:null},{id:66,gender:"male",firstName:"Chun",lastName:"Nandi",photoUrl:null},{id:67,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:68,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:69,gender:"male",firstName:"",lastName:"",photoUrl:null},{id:70,gender:"female",firstName:"",lastName:"Mopsik",photoUrl:null}],lv:[{id:1,gender:"female",firstName:"Laura",lastName:"Ozola",photoUrl:null},{id:2,gender:"female",firstName:"Anna",lastName:"Berzina ",photoUrl:null},{id:3,gender:"male",firstName:"Jnis",lastName:"Brzi",photoUrl:null},{id:4,gender:"male",firstName:"Jnis",lastName:"Liepi",photoUrl:null},{id:5,gender:"male",firstName:"Pteris",lastName:"Kalni",photoUrl:null},{id:6,gender:"male",firstName:"Juris",lastName:"Ozoli",photoUrl:null},{id:7,gender:"female",firstName:"Lga",lastName:"Jansone",photoUrl:null},{id:8,gender:"female",firstName:"Elna",lastName:"Krause",photoUrl:null},{id:9,gender:"male",firstName:"Noah",lastName:"Clark'",photoUrl:null},{id:10,gender:"male",firstName:"Andris",lastName:"boli",photoUrl:null},{id:11,gender:"male",firstName:"Guntis",lastName:"Egltis",photoUrl:null},{id:12,gender:"female",firstName:"Inese",lastName:"Brzia",photoUrl:null},{id:13,gender:"female",firstName:"Kristne",lastName:"Silia",photoUrl:null},{id:14,gender:"male",firstName:"Aleksandr",lastName:"",photoUrl:null},{id:15,gender:"female",firstName:"Agnese",lastName:"Mikelsone",photoUrl:null},{id:16,gender:"female",firstName:"Mra",lastName:"Kalja",photoUrl:null},{id:17,gender:"female",firstName:"Laima",lastName:"",photoUrl:null},{id:18,gender:"male",firstName:"Mris",lastName:"Priedtis",photoUrl:null},{id:19,gender:"female",firstName:"Baiba",lastName:"Krklia",photoUrl:null},{id:20,gender:"female",firstName:"Dace",lastName:"Lapia",photoUrl:null},{id:21,gender:"male",firstName:"Artis",lastName:"Lazdi",photoUrl:null},{id:22,gender:"male",firstName:"Jnis",lastName:"Zari",photoUrl:null},{id:23,gender:"female",firstName:"Ieva",lastName:"Grietia",photoUrl:null},{id:24,gender:"male",firstName:"Krlis",lastName:"Lapi",photoUrl:null},{id:25,gender:"male",firstName:"Edgars",lastName:"Mei",photoUrl:null},{id:26,gender:"male",firstName:"Roberts",lastName:"Drzi",photoUrl:null},{id:27,gender:"female",firstName:"Santa",lastName:"Abolina",photoUrl:null},{id:28,gender:"female",firstName:"Aija",lastName:"Liepa",photoUrl:null},{id:29,gender:"female",firstName:"Ilze",lastName:"Svte",photoUrl:null},{id:30,gender:"male",firstName:"Krijnis",lastName:"Rieksti",photoUrl:null},{id:31,gender:"male",firstName:"Jnis",lastName:"Rudzi",photoUrl:null},{id:32,gender:"female",firstName:"Anda",lastName:"",photoUrl:null},{id:33,gender:"male",firstName:"Valdis",lastName:"Krmi",photoUrl:null},{id:34,gender:"male",firstName:"Vilnis",lastName:"Kalni",photoUrl:null},{id:35,gender:"female",firstName:"Elza",lastName:"",photoUrl:null},{id:36,gender:"female",firstName:"Maija",lastName:"Dzrve",photoUrl:null},{id:37,gender:"male",firstName:"Aigars",lastName:"",photoUrl:null},{id:38,gender:"male",firstName:"Raimonds",lastName:"",photoUrl:null},{id:39,gender:"male",firstName:"Imants",lastName:"Pce",photoUrl:null},{id:40,gender:"male",firstName:"Mrti",lastName:"Zviedris",photoUrl:null},{id:41,gender:"female",firstName:"Zane",lastName:"Vvere",photoUrl:null},{id:42,gender:"female",firstName:"Inga",lastName:"Zviedre",photoUrl:null},{id:43,gender:"male",firstName:"Jnis",lastName:"Ezeri",photoUrl:null},{id:44,gender:"male",firstName:"Dainis",lastName:"Grvi",photoUrl:null},{id:45,gender:"female",firstName:"Daina",lastName:"Indriksone",photoUrl:null},{id:46,gender:"male",firstName:"Mrti",lastName:"Feldmanis",photoUrl:null},{id:47,gender:"female",firstName:"Aina",lastName:"Celma",photoUrl:null},{id:48,gender:"female",firstName:"Baibena",lastName:"Brzia",photoUrl:null},{id:49,gender:"female",firstName:"Sofia",lastName:"Lewis",photoUrl:null},{id:50,gender:"female",firstName:"Nora",lastName:"Reed",photoUrl:null},{id:51,gender:"female",firstName:"Luze",lastName:"Vilcne",photoUrl:null},{id:52,gender:"male",firstName:"Aivars",lastName:"Muinieks",photoUrl:null},{id:53,gender:"female",firstName:"Evija",lastName:"Jurka",photoUrl:null},{id:54,gender:"female",firstName:"Zoey",lastName:"Adams",photoUrl:null},{id:55,gender:"female",firstName:"Aiga",lastName:"Robeniece",photoUrl:null},{id:56,gender:"female",firstName:"Lva",lastName:"Plakane",photoUrl:null},{id:57,gender:"female",firstName:"Marija",lastName:"Melngaile",photoUrl:null},{id:58,gender:"female",firstName:"Zinta",lastName:"Saulite",photoUrl:null},{id:59,gender:"female",firstName:"Ilona",lastName:"Krastia",photoUrl:null},{id:60,gender:"male",firstName:"Antons",lastName:"ni",photoUrl:null},{id:61,gender:"female",firstName:"Agate",lastName:"Zle",photoUrl:null},{id:62,gender:"female",firstName:"Anete",lastName:"Lasmane",photoUrl:null},{id:63,gender:"male",firstName:"Armands",lastName:"Vtols",photoUrl:null},{id:64,gender:"female",firstName:"Chan",lastName:"Li",photoUrl:null},{id:65,gender:"female",firstName:"Chatzi",lastName:"Chun",photoUrl:null},{id:66,gender:"male",firstName:"Chun",lastName:"Nandi",photoUrl:null},{id:67,gender:"male",firstName:"Jnis",lastName:"Seakovs",photoUrl:null},{id:68,gender:"male",firstName:"Mris",lastName:"Birkmanis",photoUrl:null},{id:69,gender:"male",firstName:"Uldis",lastName:"Saultis",photoUrl:null},{id:70,gender:"female",firstName:"",lastName:"Mopsik",photoUrl:null}]},BaseCiclePrizeAcounter=function(e){_inherits(i,Backbone.Model);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){return this._prizeComponent=e,Promise.resolve()}},{key:"PrizeComponent",get:function(){return this._prizeComponent}}]),i}(),DiceAdventureCirclesAcounter=function(e){_inherits(a,BaseCiclePrizeAcounter);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,t))._diceAdventure=e,i}return _createClass(a,[{key:"init",value:function(e){var t=this;return _get(_getPrototypeOf(a.prototype),"init",this).call(this,e).then(function(){t.PrizeComponent.setProgress(Math.floor(t._diceAdventure.CurrentUser.Progress/t._diceAdventure.Items.length)),t.listenTo(t._diceAdventure.CurrentUser,"afterAddProgress",t.onAddProgress)})}},{key:"onAddProgress",value:function(){for(var e=this,t=Math.floor(this._diceAdventure.CurrentUser.Progress/this._diceAdventure.Items.length)-this.PrizeComponent.getProgress(),i=Promise.resolve(),o=0;o<t;++o)i=i.then(function(){return e.PrizeComponent.addProgress()});return i}}]),a}(),CiclePrizeComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e,t))._prizes=new Backbone.Collection(e.prizes,{model:Prize,comparator:function(e,t){return e.get("cicle")-t.get("cicle")}}),i._prizes.sort(),i._endlessPrize=e.endlessPrize,i.on("change:progress",i.updateEndlessPrize,_assertThisInitialized(i)),i}return _createClass(a,[{key:"init",value:function(){var e=this;return Promise.resolve().then(function(){return e.get("acounter").init(e)})}},{key:"findPrizeByProgress",value:function(t){return this._prizes.find(function(e){return e.isActive()&&t===e.get("cicle")})}},{key:"getNextPrize",value:function(){var t=this.get("progress");return this._prizes.find(function(e){return e.isActive()&&t<e.get("cicle")})}},{key:"getProgress",value:function(){return this.get("progress")}},{key:"setProgress",value:function(e){this.set("progress",e)}},{key:"addProgress",value:function(){var e=this;this.set("progress",this.get("progress")+1);var t=this.findPrizeByProgress(this.get("progress"));return t?Promise.resolve().then(function(){return e.emit("beforeTakePrize",e,t)}).then(function(){return e.world.emit("takePrize",t)}).then(function(){return t.take()}).then(function(){return e.emit("takePrize",e,t)}):Promise.resolve()}},{key:"updateEndlessPrize",value:function(){var e=this._endlessPrize.calcCicle(this.get("progress")+1);this._endlessPrizeInstance&&this._endlessPrizeInstance.get("cicle")===e||(this._endlessPrizeInstance=new Prize({cicle:e,name:this.world.get("name")+".cicle"+e,products:this._endlessPrize.products}),this._prizes.push(this._endlessPrizeInstance))}},{key:"reset",value:function(){return this.set("progress",0),_get(_getPrototypeOf(a.prototype),"reset",this).call(this)}}]),a}();CiclePrizeComponent.prototype.defaults=_.defaults({id:"ciclePrize",acounter:new BaseCiclePrizeAcounter,prizes:null,progress:0},BonusWorldComponent.prototype.defaults);var Artifacts=Artifacts||{};Artifacts.Model="undefined"==typeof Model?Backbone.Model:Model,Artifacts.Collection="undefined"==typeof Model?Backbone.Collection:Collection;var PartMaterial={NONE:"none",TRASH:"trash",NORMAL:"normal",RARE:"rare",LEGEND:"legend"},PartMaterialWeight={none:0,trash:10,normal:20,rare:30,legend:40};Artifacts.Ability=Artifacts.Model.extend({apply:function(){console.warn("Ability not implemented")},getType:function(){return""},getMeasureText:function(){return""}}),Artifacts.Artifact=Artifacts.Model.extend({defaults:{id:0,type:"",slotId:null,updateTime:0,group:0,available:!1,hideAssembled:!1,parts:[],slot:null,passive:!1,cooldown:0,ability:null,relative:null,arrangePartsByQuality:!1},initialize:function(){this.setPrize(this.get("prize")),this.getParts().forEach(function(e){e.on("change",function(){this.trigger("change change:part",this,e)},this)},this)},getPrize:function(){return this._prize},setPrize:function(e){e?this._prize?this._prize.set(e):this._prize=new UserPrizes(e):this._prize=null},toJSON:function(){return{artifactId:this.id,slotId:this.get("slotId"),updateTime:this.get("updateTime")}},isChanged:function(){for(var e=["slotId","updateTime","available"],t=0;t<e.length;t++)if(this.hasChanged(e[t]))return!0;return!1},reset:function(){this.changed={}},getGroup:function(){return this.get("group")},getParts:function(){return this.get("parts")},getSlot:function(){return this.get("slot")},getAbility:function(){return this.get("ability")},isAvailable:function(){return this.get("available")},isAssembled:function(){return this.get("available")},getCollectedParts:function(){return this.getParts().filter(function(e){return 0<e.get("amount")})},setAvailable:function(e){this.set("available",e)},canAssembled:function(){if(!this.isAvailable())for(var e=this.getParts(),t=0;t<e.length;t++)if(0===e[t].getAmount())return!1;return!0},assemble:function(){return!!this.canAssembled()&&(this.getParts().forEach(function(e){e.setAmount(e.getAmount()-1)}),this.setAvailable(!0),this.trigger("assemble",this),!0)},isPassive:function(){return this.get("passive")},getType:function(){return this.get("type")},setUpdateTime:function(e){this.set("updateTime",Math.max(e,0))},resetUpdateTime:function(){this.set("updateTime",application.getCurrentServerTime())},getCooldown:function(){return Math.max(Math.floor(this.get("updateTime")+this.get("cooldown")-application.getCurrentServerTime()),0)},getCooldownFormatString:function(){var e=function(e){return("0"+e).slice(-2)},t=this.getCooldown();return e(Math.floor(t/3600))+":"+e(Math.floor(t%3600/60))+":"+e(t%60)},canApplyAbility:function(){return 0===this.getCooldown()},applyAbility:function(){var e=this.get("ability");e&&this.canApplyAbility()&&(e.apply(),this.isPassive()||this.resetUpdateTime())},getSortedByQualityParts:function(){return this.getParts().sort(function(e,t){return PartMaterialWeight[e.get("material")]>PartMaterialWeight[t.get("material")]?1:PartMaterialWeight[e.get("material")]<PartMaterialWeight[t.get("material")]?-1:0})}}),Artifacts.Part=Artifacts.Model.extend({defaults:{id:0,chance:0,amount:0,canBeSold:!0,share:!0,startAmount:null},toJSON:function(){return{partId:this.id,amount:this.getAmount()}},isChanged:function(){return this.hasChanged("amount")},reset:function(){this.changed={}},canShare:function(){return!!this.get("share")},getChance:function(){return this.get("chance")},getAmount:function(){return this.get("amount")},setAmount:function(e){this.set("amount",Math.max(e,0))},addAmount:function(e){this.setAmount(this.getAmount()+e)}}),Artifacts.Slot=Artifacts.Model.extend({defaults:{id:0,group:0,artifact:null,conditionAvailable:null,conditionText:"",minLevel:0,autoSet:!1,artifacts:[]},initialize:function(){this.setArtifact(this.get("artifact"))},getGroup:function(){return this.get("group")},canSetArtifact:function(e){return!(!e||!this.isAvailable()||this.getGroup()!==e.getGroup()||this===e.getSlot())&&(!e.get("id")||-1!==this.get("artifacts").indexOf(e.get("id")))},setArtifact:function(e,t){var i=this.get("artifact");if(i){if(i===e)return;i.set({slotId:null,slot:null}),i.off("change",null,this)}e&&(e.get("slot")&&e.get("slot").set("artifact",null),e.set({slotId:this.id,slot:this}),e.on("change",function(){this.trigger("change change:artifact",this,e)},this),t||e.resetUpdateTime()),this.set("artifact",e)},getArtifact:function(){return this.get("artifact")},isAvailable:function(){return Config.bonusWorld.getCurrentLevel()>this.get("minLevel")},getPossibleArtifacts:function(){return this.get("artifacts")}}),Artifacts.GoodAbility=Artifacts.Ability.extend({apply:function(){goods.goodBuyed(this.get("name"),this.get("amount"))},getType:function(){return this.get("name")},getMeasureText:function(){return"1 "+messages.timeShort[1]}}),Artifacts.CoinsAbility=Artifacts.Ability.extend({apply:function(){user.set("coins",new ObscureNumber(user.get("coins").get()+this.get("coins")))},getType:function(){return"coins"},getMeasureText:function(){return this.get("coins")}}),Artifacts.LifeAbility=Artifacts.Ability.extend({apply:function(){user.set("lives",Math.min(user.get("lives")+1,Config.maxLives))},getType:function(){return"life"},getMeasureText:function(){return"1"}}),Artifacts.ScoreAbility=Artifacts.Ability.extend({apply:function(){Game instanceof Object&&Game.setScoreCoefficient(Game.getScoreCoefficient()+this.get("coefficient"))},getType:function(){return"score"},getMeasureText:function(){return 100*this.get("coefficient")+"%"}}),Artifacts.WorldLifeAbility=Artifacts.Ability.extend({apply:function(){if(episode.isBonusWorld()&&Config.bonusWorld.hasOwnLives()){var e=Config.bonusWorld.get("livesInstance");e&&e.addLifeRequest()}},getType:function(){return"worldlife"},getMeasureText:function(){return"1"}}),Artifacts.EmptyAbility=Artifacts.Ability.extend({apply:function(){},getType:function(){return"emptyAbility"},getMeasureText:function(){return""}}),Artifacts.PartShopModel=Artifacts.Model.extend({getPartsByItem:function(e){var t=e.parts.map(function(e){return e.type});return this.get("parts").filter(function(e){return-1!==t.indexOf(e.get("material"))})},getItemById:function(e){return _.findWhere(this.get("items"),{id:e})},buyByCoins:function(e){if(e.coins&&!user.set({coins:new ObscureNumber(user.get("coins").get()-e.coins),actionName:"Buy artifacts part "+e.id,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:e.coins},{validate:!0}))throw new Error("failed buy")},showAd:function(i){return i.rewardAd?new Promise(function(e,t){i.rewardAd.showAd(e,t)}):Promise.resolve()},buyPart:function(e){var t=this,i=_.findWhere(this.get("items"),{id:e});return console.assert(i,"Not find item "+e),Promise.resolve().then(function(){return t.buyByCoins(i)}).then(function(){return t.showAd(i)}).then(function(){return i.dropType.dropPart(t,i)}).then(function(e){if(e&&e.length)return t.emit("buyPart",e).then(function(){return Promise.resolve(e)})}).catch(function(e){return e&&console.error(e),null})}}),Artifacts.PartShopByQuantity={name:"DropByQuantity",dropPart:function(e,t){for(var i=[];i.length<t.parts;){var o=RANDOM(e.get("parts"));-1===i.indexOf(o)&&i.push(o)}return i}},Artifacts.PartShopByParts={name:"DropByParts",dropPart:function(t,e){for(var i=[],o=e.quantity||1;i.length<o;){var a=RANDOM(e.parts);-1===i.indexOf(a)&&i.push(a)}return i.map(function(e){return _.findWhere(t.get("parts"),{id:e})})}},Artifacts.PartShopByMaterial={name:"DropByMaterial",getPartOne:function(e,t){var i=(parseInt(localStorage.getItem(e.get("prefix")+"_artifactPartBox"+t.id))||0)+1,o=0,a=_.find(t.parts,function(e){return e.box&&-1!==e.box.indexOf(i)});if(!a)for(var n=Math.random()*t.parts.reduce(function(e,t){return e+t.chance},0),r=0;r<t.parts.length&&!(n<=(o+=(a=t.parts[r]).chance));r++);localStorage.setItem(e.get("prefix")+"_artifactPartBox"+t.id,i.toString());var s=RANDOM(e.get("parts").filter(function(e){return e.get("material")===a.type}));return console.assert("Not find part material "+a.type),s},dropPart:function(e,t){for(var i=t.amount||1,o=[],a=0;a<i;++a)o.push(this.getPartOne(e,t));return o}},Artifacts.MultiplePartShopByMaterial={name:"MultipleDropByMaterial",dropPart:function(i,o){for(var a=this,n=[],e=function(){var t=a._getRandomMaterial(o.parts),e=RANDOM(i.get("parts").filter(function(e){return!t||e.get("material")===t}));-1===n.indexOf(e)&&n.push(e)};n.length<o.count;)e();return n},_getRandomMaterial:function(e){if(!e)return null;for(var t,i=0,o=Math.random()*e.reduce(function(e,t){return e+t.chance},0),a=0;a<e.length&&!(o<=(i+=(t=e[a]).chance));a++);return t.type}},Artifacts.DropByContinuityComponent={name:"DropByContinuityComponent",dropPart:function(e,t){var i=Config.bonusWorlds.getByName(e.get("prefix")).cmp("continuity");if(!i)throw new Error("Not fount conitnuity component");i.giveReward(t.stage)}},Artifacts.UserArtifactPartCollection=Backbone.Collection.extend({model:Backbone.Model,initialize:function(e){this.options=e},getUserIdsWithPart:function(){return this.filter(function(e){return 0<parseInt(e.get("amount"))}).map(function(e){return e.get("userId")})},filterUserAskArtifactPart:function(e){var t=application.getCurrentServerTime();return e.filter(function(e){return void 0===window.artifactPartAskedTime[e]||window.artifactPartAskedTime[e]+3600<t})},fetch:function(){var t=this;this.options.part&&callService("../../../gems/site/service/artifacts/load-user-artifact-part.php",function(e){t.reset(e)},function(e){console.error(e)},{prefix:this.options.prefix,partId:this.options.part.id,userIds:this.options.userIds.slice(0,300).join(",")})}}),Artifacts.SlotFactory=function(e){this._artifacts=e},Artifacts.SlotFactory.prototype.create=function(e){return new Artifacts.Slot(_.extend({},e,{artifact:_.findWhere(this._artifacts,{id:e.artifactId})}))},Artifacts.SlotFactory.prototype.createAll=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.create(e[i]));return t},Artifacts.PartFactory=function(){},Artifacts.PartFactory.prototype.create=function(e){return new Artifacts.Part(e)},Artifacts.PartFactory.prototype.createAll=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.create(e[i]));return t},Artifacts.BasePartGeneratingModel=Artifacts.Model.extend({getPart:function(){console.error("You are calling for a base class method. Override it!")}}),Artifacts.PartRandomizer=Artifacts.BasePartGeneratingModel.extend({getPart:function(){for(var e=this.get("workshop").getParts(),t=Math.random()*e.reduce(function(e,t){return e+t.getChance()},0),i=0,o=0;o<e.length;o++){var a=e[o];if(t<=(i+=a.getChance()))return a}}}),Artifacts.BasePartInjector=Artifacts.Model.extend({defaults:{generatingModel:Artifacts.PartRandomizer,featureToPreloadResource:null,rule:function(){return!0}},init:function(e){var t=this.get("generatingModel");this.workshop=e,this.partGenerator=new t({workshop:e}),application.on("beforeGameStart",this._onBeforeStartGame,this)},isCollected:function(){return!!this.get("part")},isCreated:function(){return!!this._created},isAvailable:function(){return this.get("rule")()},setCollected:function(e){this.set("part",e),this.$coinMenuBlock.toggleClass("active",this.isCollected()),this.$coinMenuBlock.toggleClass("part"+e.get("id"),this.isCollected())},setCreated:function(e){this._created=e},reset:function(){this.set("part",null),this._created=null},getPart:function(){return this.get("part")},getCreatedPart:function(){return this._created},animateThrowPart:function(e,t){var i=FigureView.createByTemplate(".invisible .artifactPartCell",["part"+t.get("id")||1]);_Figure.blockedAnimations.append(i),i.alignTo(e.$div),i.ourAnimate({scale:1.2},3*Game.get("speed")).ourAnimate({target:this.$coinMenuBlock,scale:.75},6*Game.get("speed"),void 0,_.bind(function(){this.setCollected(t)},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,_.bind(function(){i.remove(),this.workshop.get("controller").trigger("partAnimated",t)},this))},_onShowWindow:function(e){this.workshop.get("controller").isValidWorld(episode.get("num"))&&(e.$el.toggleClass("artifactCollected",this.isCollected()),e.$el.toggleClass("artifactCreated",this.isCreated()),e.$el.toggleClass("specialItemCreated",this.isCreated()),this.getPart()&&e.$el.addClass("part"+this.getPart().get("id")),this.isCreated()&&e.$el.addClass("part"+this.getCreatedPart().get("id")))},_onEndGame:function(){this.$coinMenuBlock&&this.$coinMenuBlock.remove(),this.game.off(null,null,this),application.off("windowShow",this._onShowWindow,this)}}),Artifacts.WeighedPartGeneration=Artifacts.BasePartGeneratingModel.extend({defaults:{weightAssembled:1,weightStarted:2,weightFresh:4},getPart:function(){return this._isFirstAssembled()?this._getWeightedPart():this._getFirstRandomPart()},_getFirstRandomPart:function(){var e=this.get("workshop").artifacts.at(0).getParts().filter(function(e){return 0===e.get("amount")});return RANDOM(e)},_isFirstAssembled:function(){var e=this.get("workshop").artifacts.at(0);return e.isAssembled()||e.getParts().length===e.getCollectedParts().length},_getWeightedPart:function(){var o=[];return this.get("workshop").getArtifacts().forEach(function(e){var i=this.get("weightStarted");e.isAssembled()&&(i=this.get("weightAssembled")),0===e.getCollectedParts().length&&(i=this.get("weightFresh")),e.getParts().forEach(function(e){for(var t=0;t<i;++t)o.push(e)})},this),RANDOM(o)}}),Artifacts.UniquePartGeneration=Artifacts.BasePartGeneratingModel.extend({getPart:function(){var e=this.workshop.getParts().filter(function(e){return e.get("amount")<=0});return RANDOM(e)}}),Artifacts.PartDropper=Artifacts.BasePartInjector.extend({defaults:_.defaults({chances:{15:10,7:20},movesOrder:"rest",chanceForLevel:100,chanceStrategyCls:OnExactMoveChanceStrategy,minMove:3},Artifacts.BasePartInjector.prototype.defaults),initialize:function(e){Artifacts.BasePartInjector.prototype.initialize(e);var t=this.get("chanceStrategyCls");this.chanceStrategy=new t({dropper:this})},_onBeforeStartGame:function(e){var t=this;this.game=e,this.game.off(null,null,this);var i=application.level.startParams;if(application.off("windowShow",this._onShowWindow,this),this.$coinMenuBlock&&this.$coinMenuBlock.remove(),application.on("windowShow",this._onShowWindow,this),episode.get("num")===this.workshop.get("prefix")){if(this.reset(),i.noArtifactPart)return;if(_.random(0,100)>this.get("chanceForLevel"))return;if(this.chanceStrategy.onStartGame(e),application.on("change:page",function(){"game"!==application.get("page")&&(application.off("change:page",null,t),t._onEndGame())},this),this.game.each(function(e){this.canCollect(e)&&this.setCreated(this.workshop.parts.get(e.partId))},this),!this.isCollected()&&application.level.num>=this.workshop.get("controller").get("artifactWorkshopMinLevel")){this.$coinMenuBlock=$(".invisible .specialworldCoinMenuBlock").clone();var o=window.mobile?"#game":"#menu";this.$coinMenuBlock.appendTo(o).show(),this.$coinMenuBlock.addClass("onLevel"+application.level.num.toString()),this.game.on("validMove",this._onChangeMove,this)}this.game.on("removedItem",this._onRemoveItem,this)}},_onChangeMove:function(){if(this.isAvailable()&&!this.isCreated()&&this._canPutPartInGame()){var e=this.partGenerator.getPart();e&&this._putPartInGame(e)}},_canPutPartInGame:function(){var e=this.chanceStrategy.calculateChance();return e&&_.random(0,100)<=e},_putPartInGame:function(e){this.setCreated(e),this.game.fallDownSpecialCells.unshift({offset:0,cellClass:ArtifactPartCell,type:e.get("id")})},_onRemoveItem:function(e){if(this.canCollect(e)){var t=this.workshop.parts.get(e.partId);this.setCollected(t),this.workshop.get("controller").trigger("partAnimated",t)}},canCollect:function(e){return e instanceof ArtifactPartCell}}),Artifacts.PartDroppperLite=Artifacts.PartDropper.extend({_onBeforeStartGame:function(e){var t=this;this.game=e,this.game.off(null,null,this);var i=application.level.startParams;if(application.off("windowShow",this._onShowWindow,this),application.on("windowShow",this._onShowWindow,this),episode.get("num")===this.workshop.get("prefix")){if(i.noArtifactPart)return void this.reset();i.replayBonusLevel||this.reset(),application.on("change:page",function(){"game"!==application.get("page")&&(application.off("change:page",null,t),t._onEndGame())},this),this.game.each(function(e){this.canCollect(e)&&this.setCreated(this.workshop.parts.get(e.partId))},this),this.isCollected()||application.level.num>=this.workshop.get("controller").get("artifactWorkshopMinLevel")&&this.game.on("validMove",this._onChangeMove,this),this.game.on("removedItem",this._onRemoveItem,this)}},animateThrowPart:function(e,t){var i=this;setTimeout(function(){i.setCollected(t),i.workshop.get("controller").trigger("partAnimated",t)},11*Game.get("speed"))},setCollected:function(e){this.set("part",e)},_onEndGame:function(){this.$coinMenuBlock&&this.$coinMenuBlock.remove(),this.game.off(null,null,this),application.off("windowShow",this._onShowWindow,this)}}),Artifacts.BoxPartDroppper=Artifacts.PartDropper.extend({defaults:_.defaults({featureToPreloadResource:BoxCell},Artifacts.PartDropper.prototype.defaults),_onBeforeStartGame:function(e){Artifacts.PartDropper.prototype._onBeforeStartGame.call(this,e),Config.bonusWorld===this.workshop.get("controller").world&&this.game.on("initCellForFallDown",this._checkCell,this)},_onRemoveItem:function(e){e.part=this.workshop.parts.get(e.partId),Artifacts.PartDropper.prototype._onRemoveItem.call(this,e)},_putPartInGame:function(e){this.setCreated(e),this.game.fallDownSpecialCells.unshift({offset:0,cellClass:BoxCell,type:e.get("id"),partId:e.get("id")})},canCollect:function(e){return e instanceof BoxCell},_checkCell:function(e){e instanceof BoxCell&&!e.part&&(e.part=this.partGenerator.getPart(),e.partId=e.part.get("id"))}}),Artifacts.PartSpitter=Artifacts.BasePartInjector.extend({defaults:_.defaults({perLevelChance:.7,lowerMovesThreshold:3,activationMove:0,generatingModel:Artifacts.WeighedPartGeneration},Artifacts.BasePartInjector.prototype.defaults),init:function(e){Artifacts.BasePartInjector.prototype.init.call(this,e)},_isOnLevel:function(){var e=this.workshop.get("controller").get("artifactWorkshopMinLevel");return application.level.num===e||Math.random()<=this.get("perLevelChance")},_onBeforeStartGame:function(e){this.game=e,this.reset(),this.game.off(null,null,this),application.off("windowShow",this._onShowWindow,this),application.on("windowShow",this._onShowWindow,this);var t=this.workshop.get("controller").get("artifactWorkshopMinLevel");if(this.workshop.get("controller").isValidWorld(episode.get("num"))&&(application.level.num>=t||Config.bonusWorld.isSatellite())){this.game.on("win fail",this._onEndGame,this),this.$coinMenuBlock=$(".invisible .specialworldCoinMenuBlock").clone();var i=window.mobile?"#game":"#menu";this.$coinMenuBlock.appendTo(i).show(),this.$coinMenuBlock.addClass("onLevel"+application.level.num.toString()),this.game.on("validMove",this._onChangeMove,this),this._isOnLevel()&&(this._calcActivationMove(),this.game.on("validMove",this._onChangeMove,this))}},_onChangeMove:function(e){if(this._isActivationMove()&&!this.isCreated()){var t=this.partGenerator.getPart();t&&(this.game.trigger("partSpitted",t),this.setCreated(t),this.animateThrowPart(e.second,t))}},_calcActivationMove:function(){if(application.level.num!=this.workshop.get("controller").get("artifactWorkshopMinLevel")||Config.bonusWorld.isSatellite()){var e=this.game.get("moves").get()/2;this.set("activationMove",getRandomInt(this.get("lowerMovesThreshold"),e))}else this.set("activationMove",this.game.get("moves")-3)},_isActivationMove:function(){return this.get("activationMove")===this.game.get("moves").get()}}),Artifacts.PartDroopperByMaterial=Artifacts.PartDropper.extend({_onChangeMove:function(){var e=Game.get("moves").get(),t=this.get("chances")[e];if(t&&!this.isCreated()&&_.random(0,100)<=t){var i=randomizedObjectKey(this.get("perMoveChance")[e]);"legend"===i&&(i="legendary");var o=RANDOM(this.workshop.getParts().filter(function(e){return e.get("material")===i}));o&&this._putPartInGame(o)}}}),Artifacts.ArtifactFactory=function(e){this._parts=e},Artifacts.ArtifactFactory.prototype._createAbility=function(e){return e&&e.type instanceof Function?new e.type(e):null},Artifacts.ArtifactFactory.prototype.create=function(t){return new Artifacts.Artifact(_.extend({},t,{ability:this._createAbility(t.ability),parts:this._parts.filter(function(e){return t.parts&&-1!==t.parts.indexOf(e.id)})}))},Artifacts.ArtifactFactory.prototype.createAll=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.create(e[i]));return t},Artifacts.ArtifactWorkshop=Artifacts.Model.extend({defaults:{parts:[],artifacts:[],slots:[],isAddPart:!1,partSource:new Artifacts.PartRandomizer,showAll:!1,scrollable:!1},initialize:function(){this.parts=new Artifacts.Collection,this.artifacts=new Artifacts.Collection,this.slots=new Artifacts.Collection;var e=this.get("config")||{},t=(new Artifacts.PartFactory).createAll(e.parts),i=new Artifacts.ArtifactFactory(t).createAll(e.artifacts),o=new Artifacts.SlotFactory(i).createAll(e.slots);this.parts.set(t),this.artifacts.set(i),this.slots.set(o),this.set("showAll",e.showAll),this.artifacts.forEach(function(e){e.get("relative")&&this._initRelative(e)},this),this.slots.forEach(function(t){t.get("autoSet")&&this.artifacts.on("assemble",function(e){t.getArtifact()||!t.canSetArtifact(e)||e.getSlot()||(t.setArtifact(e),this.save())},this)},this)},_loadData:function(t){var i=this,o=!1,a=this.getArtifacts(),n=this.getParts(),r=this.getSlots(),s=r.every(function(e){return e.get("autoSet")});callService("../../../gems/site/service/artifacts/load-artifact-workshop.php",function(e){e&&(s&&(o=!0),e.artifacts instanceof Array&&e.artifacts.forEach(function(e){var t,i=_.findWhere(a,{id:e.artifactId});i&&(i.setAvailable(!0),s||(t=e.slotId?_.findWhere(r,{id:e.slotId}):_.find(r,function(e){return e.get("autoSet")&&-1!==e.get("artifacts").indexOf(i.id)}))&&(t.getArtifact()&&(o=!0),t.setArtifact(i)),i.setUpdateTime(e.updateTime),i.reset())}),e.parts instanceof Array&&e.parts.forEach(function(e){var t=_.findWhere(n,{id:e.partId});t&&(t.setAmount(e.amount),t.reset())})),t&&t(),o&&i._rearrangeArtifacts()},function(e){console.error(e)},{prefix:this.get("prefix")})},_saveData:function(){var t=[],i=[];this.getArtifacts().forEach(function(e){e.isChanged()&&(e.reset(),t.push(e.toJSON()))}),this.getParts().forEach(function(e){e.isChanged()&&(e.reset(),i.push(e.toJSON()))}),(t.length||i.length)&&callServiceAddInQueue("../../../gems/site/service/artifacts/save-artifact-workshop.php",{prefix:this.get("prefix"),data:JSON.stringify({artifacts:t,parts:i})})},_messageArtifactPart:function(e,t,i){callServiceAddInQueue("../../../gems/site/service/artifacts/message-artifact-part.php",{prefix:this.get("prefix"),messageType:e,userIds:i.join(","),partId:t.id})},_removeMessageArtifactPart:function(e,t){callServiceAddInQueue("../../../gems/site/service/artifacts/remove-message-artifact-part.php",{prefix:this.get("prefix"),messageType:e,partId:t.id})},filterUserAskArtifactPart:function(e){var t=application.getCurrentServerTime();return e.filter(function(e){return void 0===window.artifactPartAskedTime[e]||window.artifactPartAskedTime[e]+3600<t})},askArtifactPart:function(e,t,i){var o=this;socialNetwork.sendRequest({userIds:t,message:messages[this.get("prefix")+"ArtifactPartAskText"]||messages.artifactPartAskText,success:function(){o._messageArtifactPart("askedArtifactPart",e,t),t.forEach(function(e){window.artifactPartAskedTime[e]=application.getCurrentServerTime()}),setLocalStorage("artifactPartAskedTime",window.artifactPartAskedTime),i instanceof Function&&i(t)}})},sendArtifactPart:function(e,t){e.getAmount()>=t.length&&(e.setAmount(e.getAmount()-t.length),this.save(),this._messageArtifactPart("sentArtifactPart",e,t),this._removeMessageArtifactPart("askedArtifactPart",e),socialNetwork.sendRequest({userIds:t,message:messages[this.get("prefix")+"ArtifactPartSendText"]||messages.artifactPartSendText}))},receiveArtifactPart:function(e,t){var i=_.findWhere(this.getParts(),{id:parseInt(e)});return!!i&&(i.setAmount(i.getAmount()+t.length),this.save(),this._removeMessageArtifactPart("sentArtifactPart",i),!0)},cancelAskedArtifactPart:function(e){var t=_.findWhere(this.getParts(),{id:parseInt(e)});return!!t&&(this._removeMessageArtifactPart("askedArtifactPart",t),!0)},init:function(){this.get("partSource").init(this)},hasCanAssembleArtifacts:function(){for(var e=0;e<this.artifacts.length;e++)if(this.isCanAssemble(this.artifacts.at(e)))return!0;return!1},getCanAssembledArtifacts:function(){var t=this;return this.artifacts.filter(function(e){return t.isCanAssemble(e)})},isCanAssemble:function(t){if(t.canAssembled()){if(t.get("relative")){var e=this.artifacts.filter(function(e){return-1!==t.get("relative").indexOf(e.get("id"))});return!Boolean(e.find(function(e){return!e.isAvailable()}))&&!t.isAvailable()}return!0}return!1},_tryAssemble:function(e){this.isCanAssemble(e)&&(e.assemble(),this.save(),this.trigger("relateAssembled",e))},_initRelative:function(t){this.artifacts.on("assemble",function(e){-1!==t.get("relative").indexOf(e.get("id"))&&this._tryAssemble(t)},this)},_rearrangeArtifacts:function(){var e=this.getArtifacts(),i=this.getSlots();e.forEach(function(t){var e=_.find(i,function(e){return-1!==e.get("artifacts").indexOf(t.id)});e&&t.isAssembled()&&e.setArtifact(t,!0)}),this.save()},load:function(e){this.init(),window.artifactPartAskedTime=getLocalStorage("artifactPartAskedTime",{}),this._loadData(e)},save:function(){this._saveData()},getParts:function(){return this.parts.toArray()},getArtifacts:function(){return this.artifacts.toArray()},getSlots:function(){return this.slots.toArray()},receivePart:function(){var e=this.get("partSource").getPart();return!e&&this.get("isAddPart")&&this.get("partSource").isCreated()&&(e=this.parts.get(this.get("partSource").getCreatedPart().get("id")),application.trigger("notOpenedBoxCollect",e)),e&&(this.get("isAddPart")&&e.setAmount(e.getAmount()+1),this.trigger("receivePart",e),this.get("partSource").reset()),e},receiveExactPart:function(e){var t=_.findWhere(this.getParts(),{id:e});return t&&(t.setAmount(t.getAmount()+1),this.trigger("receivePart",t)),t},onApplyArtefact:function(){var e=this.get("controller");e&&e.onApplyArtefact()},applyPassiveArtifactAbilities:function(){var i=[];return this.getSlots().forEach(function(e){var t=e.getArtifact();t&&t.isPassive()&&(t.applyAbility(),i.push(t))}),i}}),Artifacts.SlotView=Backbone.View.extend({events:{click:"_onClickBySlot","click .toyImage":"_onClickByImage","click .collectButton":"_onClickByCollectButton"},_onClickBySlot:function(){if(this.model.isAvailable())return this._onClickByImage(),!1},_onClickByImage:function(){return this.trigger("select",this.model),!1},_onClickByCollectButton:function(e){this.model.getArtifact()&&(this.trigger("collect",this.model),e.stopPropagation())},initialize:function(){this.model.on("change",this.render,this)},_getLabel:function(e){return messages[e]||""},renderTimer:function(){var e=this.model.getArtifact();e&&0!==e.getCooldown()?(this.$el.addClass("timer"),this.$el.find(".timer").text(e.getCooldownFormatString())):this.render()},render:function(){if(this.$el.removeClass().addClass("button button"+this.model.get("id")),this.model.get("fixed")&&this.$el.addClass("fixed"),1===this.model.getPossibleArtifacts().length&&this.$el.find(".toyImage").addClass("toy"+this.model.getPossibleArtifacts()[0]+"disabled"),this.model.isAvailable()){var e=this.model.getArtifact();e&&(this.$el.addClass("active"),this.$el.find(".toyImage").removeClass().addClass("toyImage toy"+e.id),e.isPassive()||(e.canApplyAbility()?(this.$el.addClass("collect"),this.$el.find(".collectButton").removeClass().addClass("collectButton "+e.getAbility().getType()).text(this._getLabel(Config.bonusWorld.name+"ArtifactCollect"))):(this.$el.addClass("timer"),this.$el.find(".timer").text(e.getCooldownFormatString()),e.once("update:cooldown",this.render,this))))}else this.$el.find(".text").text(this.model.get("minLevel")+" "+this._getLabel("levelLabel")),this.$el.addClass("lock");return this}}),Artifacts.SlotAssembleIndicatorView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change",this.update)},update:function(){this.$el.toggleClass("active",this.model.some(function(e){return e.canAssembled()&&!e.isAssembled()}))}}),Artifacts.ArtifactWorkshopView=Backbone.View.extend({events:{"click .exit":"_onClickExit"},_onCollect:function(e){var t=e.getArtifact();t&&t.applyAbility(),this.model.onApplyArtefact(),this.model.save()},initialize:function(){var o=this.$el.find(".tree");if(this._slotViews=this.model.getSlots().map(function(t){var e=this.model.getArtifacts().filter(function(e){return-1!==t.getPossibleArtifacts().indexOf(e.get("id"))}),i=new Artifacts.SlotView({el:$($(".artifactSlot_template").html()).appendTo(o),model:t});return i.indicator=new Artifacts.SlotAssembleIndicatorView({el:i.$el.find(".indicator"),model:new Backbone.Collection(e)}),i.indicator.update(),i.on("select",this._showCollectionWindow,this),i.on("collect",this._onCollect,this),i},this),this.model.on("relateAssembled",this._animateRelateAssembled,this),this.model.get("scrollable")){var e=_slicedToArray(this.model.getArtifacts().filter(function(e){return"finish"===e.get("type")}),1)[0],t=this.model.get("anchorEl")?this.$(this.model.get("anchorEl")):this.$(".button"+e.get("id"));this.mapController=BigMapControllerFactory.create({el:this.$el,bgEl:this.$(".treeBlock"),mainEl:t,keyIntervalTime:15})}this.render(),setInterval(_.bind(this._onUpdateTimer,this),1e3)},_onUpdateTimer:function(){this._slotViews.forEach(function(e){var t=e.model.getArtifact();t&&!t.isPassive()&&t.trigger("update:cooldown",t.getCooldown())},this)},_onClickExit:function(){this.trigger("exit",this)},show:function(){if(this.$el.addClass("active"),this.mapController){var e=_slicedToArray(this.model.getArtifacts().filter(function(e){return"finish"===e.get("type")}),1)[0],t=this.model.get("anchorEl")?this.$(this.model.get("anchorEl")):this.$(".button"+e.get("id"));this.mapController.scrollTo(t,!0)}application.set("page","artifacts"),this.trigger("show",this)},hide:function(){"artifacts"===application.get("page")&&(application.set("page","main"),this.$el.removeClass("active"),this.trigger("hide",this))},render:function(){return this._slotViews.forEach(function(e){e.render()}),this},_animateRelateAssembled:function(e){setTimeout(function(){e.getPrize()&&(e.getPrize().take("artifactprize"),new Artifacts.ArtifactAssemblePrizeWindow({prize:e.getPrize(),model:e,firstPriority:!0}))},2100)},_showPartWindow:function(t,i,e){if(!application.windows.isSameOpen(Artifacts.PartWindow)){var o=!0,a=new Artifacts.PartWindow(_.extend({model:i,onClose:_.bind(function(){o&&this._showCollectionWindow(t)},this)},e));a.once("openBuyPart",function(){o=!1,a.close(),this._showPartShopWindow(t,i)},this),a.once("openAskPart",function(){var e=this;o=!1,a.close(),socialNetwork.haveAccessToFriends()?this._showFriendWindow(t,i):new FriendPermissionWindow({onClose:function(){socialNetwork.haveAccessToFriends()&&e._showFriendWindow(t,i)}})},this)}},_showArtifactWindow:function(e,t){if(!application.windows.isSameOpen(Artifacts.ArtifactWindow))new Artifacts.ArtifactWindow({model:e,onClose:_.bind(function(){t&&this._showCollectionWindow(t)},this)})},_showPartShopWindow:function(e,t){var i=this.model.get("controller").world.getComponent("partsShop");i?i.showShop():this._showCollectionWindow(e,"shop")},_showFriendWindow:function(e,t){var i=new SelectFriendWindow({selectOneFriend:!0,userIds:[],onClose:_.bind(this._showCollectionWindow,this,e)});if(friendsInAppIds&&friendsInAppIds.length){i.on("select",function(e){this.model.askArtifactPart(t,e)},this);var o=new Artifacts.UserArtifactPartCollection({prefix:this.model.get("prefix"),userIds:friendsInAppIds,part:t});o.on("reset",function(){var e=this.model.filterUserAskArtifactPart(o.getUserIdsWithPart());i.setShowTextNoFriends(0===e.length),i.setUserIds(e)},this),o.fetch()}else i.setShowTextNoFriends(!0),i.setUserIds([])},_showCollectionWindow:function(o,e){var t=this;if(o.get("fixed")){var i=this.model.artifacts.get(o.get("artifacts")[0]);i&&!i.isAssembled()&&this._showArtifactWindow(i)}else{var a=this.model.getParts().filter(function(e){return e.get("canBeSold")}),n=new Artifacts.ArtifactCollectionWindow({prefix:this.model.get("prefix"),slot:o,tab:e,shopModel:new Artifacts.PartShopModel(_.extend({parts:a,prefix:this.model.get("prefix")},this.model.get("controller").get("artifactPartsShop"))),artifacts:this.model.getArtifacts().filter(function(e){return t._showArtifact(e,o)})});n.on("assemble",function(e){!e.isAvailable()&&e.canAssembled()&&(e.assemble(),e.getPrize()&&(n.close(),e.getPrize().take("artifactprize"),new Artifacts.ArtifactAssemblePrizeWindow({prize:e.getPrize(),model:e}),new AnimatedPrizesWindow({prizes:e.getPrize(),notGive:!0}),this._showCollectionWindow(o)),this.model.save())},this),n.once("buyPart",function(e){var t="",i=[];e.forEach(function(e){e.setAmount(e.getAmount()+1),t=t+" artifact-part"+e.get("id"),i.push(" artifact-part"+e.get("id"))}),this.model.save(),new LootBoxWindow({classes:"artifact-part "+t,partClasses:i}),this._showCollectionWindow(o),n.close()},this),n.on("openArtifact",function(e){this._showArtifactWindow(e,o),n.close()},this),n.on("selectArtifact",function(t){o.canSetArtifact(t)||(o=this.model.slots.find(function(e){return-1!==e.get("artifacts").indexOf(t.id)},this)),t.isAvailable()&&(o.setArtifact(t),n.close()),this.model.save()},this),n.on("selectPart",function(e){n.close(),this._showPartWindow(o,e)},this),this.model.get("controller").trigger("openArtifactCollectionWindow")}},_showArtifact:function(e,t){return!(!this.model.get("showAll")&&!t.canSetArtifact(e))&&((!e.get("hideAssembled")||!e.isAssembled())&&"finish"!==e.get("type"))}}),Artifacts.ArtifactWorkshopButtonView=Backbone.View.extend({events:{click:"_onClickWorkshopButton"},initialize:function(){this.$(".artifactWorkshopButtonTitle").html(messages[this.model.get("prefix")+"ArtifactWorkshop"])},showAvailableNewArtifactPart:function(){this.$el.addClass("availableNewArtifactPart")},hideAvailableNewArtifactPart:function(){this.$el.removeClass("availableNewArtifactPart")},_onClickWorkshopButton:function(){this.trigger("click",this)},show:function(){this.$el.addClass("active")},hide:function(){this.$el.removeClass("active")}}),Artifacts.ArtifactCollectionItemView=Backbone.View.extend({events:{"click .oneAltBtn":"_onClickByActionButton","click .artifactPart":"_onClickByPart","click .mOpenArtifact":"_onOpenArtifact"},initialize:function(e){this.options=e,this._partViews=[],this._$partItemTemplate=this.$el.find(".artifactPartsBlock .artifactPart"),this.listenTo(this.model,{change:this.render}),this.render()},_animateAssemble:function(t){var a=this.$el.find(".craftedArtifactBlock");if(window.mobile)a.find(".icon").removeClass("notAvailable"),t();else{var i=this,n=this._partViews.map(function(e){return e.find(".icon").clone().appendTo(e).css("zIndex",10)}),r=a.offset();a.queue(function(e){var o=_.after(n.length,e);i.undelegateEvents(),n.forEach(function(e,t){var i=e.offset();e.ourAnimate({target:a},1.5*Math.abs(i.left-r.left),"linear",function(){this.remove(),o()})})}).queue(function(e){$(this).addClass("craftAnimation"),e()}).delay(500).queue(function(e){$(this).find(".icon").removeClass("notAvailable"),e()}).delay(1e3).queue(function(e){$(this).removeClass("craftAnimation"),setTimeout(function(){i.delegateEvents(i.events)},300),t(),e()})}},_onOpenArtifact:function(){this.trigger("openArtifact",this.model)},_onClickByActionButton:function(){this.model.isAvailable()?this.trigger("selectArtifact",this.model):this.model.canAssembled()&&!this._assembling&&(this._assembling=!0,this._animateAssemble(_.bind(function(){this._assembling=!1,this.trigger("assemble",this.model)},this)))},_onClickByAddButton:function(e){this.trigger("selectPart",_.findWhere(this.model.getParts(),{id:$(e.currentTarget).data("id")}))},_onClickByPart:function(e){this.trigger("selectPart",_.findWhere(this.model.getParts(),{id:$(e.currentTarget).data("id")}))},_getLabel:function(e){return messages[e]||""},_getBonusDescription:function(){return messages[Config.bonusWorld.name+"ArtifactItem"]&&messages[Config.bonusWorld.name+"ArtifactItem"][this.model.id-1]||""},_getMeasureText:function(){var e=this.model.get("ability");return e?e.getMeasureText():""},_getAbilityType:function(){var e=this.model.get("ability");return e?e.getType():""},render:function(){this.$el.addClass("artifact"+this.model.id),this.$(".mOpenArtifact").data("artifact",this.model.get("id")),this.model.isAvailable()||this.$el.find(".craftedArtifactBlock .icon").addClass("notAvailable"),this.model.isAssembled()&&this.$el.find(".craftedArtifactBlock .oneAltBtn").addClass("mIsAssembled"),this.model.get("type")&&this.$el.addClass(this.model.get("type")),this.$el.find(".mArtifactName").html(messages[Config.bonusWorld.name+"ArtifactNames"][this.model.get("id")]),this.$el.find(".info").html(this._getBonusDescription()),this.$el.find(".info .bonusAmount").html(this._getMeasureText()),this.$el.find(".info .bonusType").addClass(this._getAbilityType());var i=this.$el.find(".artifactPartsBlock").empty();this.model.getPrize()&&new UserPrizesView({model:this.model.getPrize(),el:this.$(".mPrizes").empty()}),this._partViews=[];var e=this.model.getParts();this.model.get("arrangePartsByQuality")&&(e=this.model.getSortedByQualityParts()),e.forEach(function(e){var t=this._$partItemTemplate.clone();t.addClass("artifactPart"+e.id).data("id",e.id),t.find(".add").data("id",e.id),t.find(".amount").text(e.getAmount()),t.toggleClass("inStock",0<e.getAmount()),t.toggleClass("canShare",e.canShare()),t.appendTo(i),this._partViews.push(t)},this);var t=this.$el.find(".oneAltBtn").text(this._getLabel(Config.bonusWorld.name+"ArtifactCollect")).removeClass("disabled");this.model.isAvailable()&&this.options.slot.canSetArtifact(this.model)?t.text(this._getLabel(Config.bonusWorld.name+"ArtifactPut")):this.model.canAssembled()||t.addClass("disabled")}}),Artifacts.ArtifactCollectionWindow=TWindow.extend({templateClass:".artifactCollectionWindow_template",events:_.defaults({"click .mTabs .tabItem":"onSelectTab","click .mBuyBtn":"_buy"},TWindow.prototype.events),onOpen:function(e){var t=this;TWindow.prototype.onOpen.call(this),this.$(".mWindowTitle").html(messages[Config.bonusWorld.name+"ArtifactWorkshop"]),this.$(".mDescription").html(messages[Config.bonusWorld.name+"ArtifactWorkshopDescription"]),this.renderArtifacts(),this.$el.toggleClass("lootBoxEnable")&&this.renderShop(),this.selectTab(this.options.tab||"artifacts"),this.timer=setInterval(function(){return t.updateTimer()},1e3)},onClose:function(){clearInterval(this.timer)},updateTimer:function(){var i=this;this.options.shopModel.get("items").forEach(function(e){if(e.rewardAd){var t=i.$(".mOffers .mOffer"+e.id);t.toggleClass("available",e.rewardAd.checkAvailable()),t.toggleClass("hasTimer",0<e.rewardAd.getCooldown()),t.find(".mTimer").html(formatDuration(e.rewardAd.getCooldown()))}})},remove:function(){TWindow.prototype.remove.call(this),this._itemViews.forEach(function(e){e.remove()}),this._itemViews=null},renderArtifacts:function(){this.createTab("artifacts");var i=this.$(".artifactsContainer");this.options.artifacts.length<1&&(this.$el.addClass("noAvailableArtifacts"),this.$(".textBlock .text").html(messages[this.options.prefix+"NoAvailableArtifacts"])),this._itemViews=this.options.artifacts.map(function(e){var t=new Artifacts.ArtifactCollectionItemView({el:$($(".artifactCollectionItem_template").html()).appendTo(i),slot:this.options.slot,model:e});return e.isAvailable()&&t.$el.addClass("assembled"),t.on("all",function(){this.trigger.apply(this,arguments)},this),t},this)},renderShop:function(){this.createTab("shop");var r=this.$(".mOffers"),s=this.$(".invisible .mOffer"),l=this.$(".mOfferPart");this.options.shopModel.get("items").forEach(function(e){var t=s.clone();t.addClass(e.dropType.name),t.addClass("mOffer"+e.id),t.find(".mBuyBtn").data("id",e.id),t.addClass("item"+e.id),t.find(".mPrice").html(e.coins),t.find(".mTitle").html(messages[Config.bonusWorld.name+"Box"+e.id]),t.appendTo(r);var i=t.find(".mParts");if(e.dropType===Artifacts.PartShopByMaterial){var o=_.groupBy(this.options.shopModel.getPartsByItem(e),function(e){return e.get("material")});for(var a in o){var n=$("<div>").addClass("material-"+a).appendTo(i);o[a].forEach(function(e){l.clone().addClass("part"+e.get("id")).appendTo(n)},this)}}messages[Config.bonusWorld.name+"PartsShopOffer"+e.id]&&t.find(".mDescription").html(messages[Config.bonusWorld.name+"PartsShopOffer"+e.id])},this)},createTab:function(e){var t=this.$(".invisible .tabItem").clone().appendTo(".mTabs");t.data("tab",e),t.addClass("tab-"+e),t.find(".title").html(messages[Config.bonusWorld.name+"ArtifactTabs"][e])},selectTab:function(e){this._selectTabName&&this.$el.removeClass("select-"+this._selectTabName),this.$(".mTabs .tabItem").removeClass("active"),this._selectTabName=e,this.$(".mTabs").find(".tab-"+this._selectTabName).addClass("active"),this.$el.addClass("select-"+this._selectTabName)},onSelectTab:function(e){this.selectTab($(e.currentTarget).data("tab"))},_buy:function(e){var t=this;this.options.shopModel.buyPart($(e.currentTarget).data("id")).then(function(e){e&&e.length&&t.trigger("buyPart",e)})}}),Artifacts.PartWindow=TWindow.extend({templateClass:".artifactPartWindow_template",events:{"click .mBuy":"_buy","click .mAsk":"_ask","click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.model.get("material");this.$el.addClass("material-"+(e||"normal")).addClass("part"+this.model.get("id")).toggleClass("inInventory",0<this.model.getAmount()).toggleClass("lootBoxEnable",!1!==this.options.lootBoxEnable).toggleClass("canShare",0==this.model.getAmount()&&this.model.canShare()),this.options.bought&&this.$el.addClass("bought"),this.$(".mTitle").html(Config.bonusWorld.ln.print("artifactParts.".concat(this.model.get("id")))),this.$(".mAmount").html(this.model.getAmount()),this.$(".mBuy").html(Config.bonusWorld.ln.print("artifactPartsBuy")),e&&this.$(".mMaterial").html(Config.bonusWorld.ln.print("artifactPartsMaterial."+(e||"normal"))),this.$(".mDescription").html(Config.bonusWorld.ln.print("artifactPartsDescription"))},_buy:function(){this.trigger("openBuyPart",this.model)},_ask:function(){this.trigger("openAskPart",this.model)}}),Artifacts.TicketsWindow=TWindow.extend({templateClass:".artifactTicketsWindow_template",events:{"click .close":"close","click .okButton":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$(".mTitle").html(messages[Config.bonusWorld.name+"ArtifactTicketsTitle"]),this.$(".mDescription").html(messages[Config.bonusWorld.name+"ArtifactTicketsDescription"])}}),Artifacts.PartShopWindow=TWindow.extend({templateClass:".artifactPartShopWindow_template",events:{"click .mBuyBtn":"_buy","click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$(".mTitle").html(messages[Config.bonusWorld.name+"ArtifactPartShopTitle"]);var i=this.$(".mOffers"),o=this.$(".invisible .mOffer");this.model.get("items").forEach(function(e){var t=o.clone();t.find(".mBuyBtn").data("id",e.id),t.addClass("item"+e.id),t.find(".mPrice").html(e.coins),t.appendTo(i)},this)},_buy:function(e){var t=this.model.buyPart($(e.currentTarget).data("id"));t&&this.trigger("buyPart",t),this.close()}}),Artifacts.ArtifactAssemblePrizeWindow=TWindow.extend({templateClass:".artifactAssemblePrizeWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.publicBlock=new PublicationBlock({el:this.$(".needPublicBlock")}),this.$el.addClass("artifact"+this.model.get("id")),this.$(".mTitle").html(messages[Config.bonusWorld.name+"ArtifactNames"][this.model.get("id")]);var e=messages[Config.bonusWorld.name+"ArtifactItem"];e&&this.$(".mDescription").html(e[this.model.get("id")-1]),this.userPrizeBlock=new UserPrizesView({model:this.options.prize,el:this.$(".prizes")})},onClose:function(){if(this.publicBlock.isNeedPublic()){var e=Config.bonusWorld.name+"ArtifactTakePrizePublication";messages[Config.bonusWorld.name+"Artifact"+this.model.get("id")+"TakePrizePublicationMessage"]&&(e=Config.bonusWorld.name+"Artifact"+this.model.get("id")+"TakePrizePublication"),user.defaultPublication(e)}},remove:function(){TWindow.prototype.remove.call(this),this.publicBlock.remove(),this.publicBlock=null,this.userPrizeBlock.remove(),this.userPrizeBlock=null}}),Artifacts.ArtifactWindow=TWindow.extend({templateClass:".artifactWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.addClass("artifact"+this.model.get("id")).toggleClass("assembled",this.model.isAvailable()),this.$(".mTitle").html(messages[Config.bonusWorld.name+"ArtifactNames"][this.model.get("id")]),messages[Config.bonusWorld.name+"ArtifactItem"]&&this.$(".mDescription").html(messages[Config.bonusWorld.name+"ArtifactItem"][this.model.get("id")-1]),this.model.isAvailable()||this.$el.find(".mPrizesText").html(messages.potentialReward),this.model.getPrize()&&new UserPrizesView({model:this.model.getPrize(),el:this.$(".mPrizes"),isGroup:!0})}});var PartsComponent=BonusWorldComponent.extend({defaults:{id:"parts",prefix:"",active:!0,canExchange:!0},constructor:function(e,t){this._parts=new Backbone.Collection(e.parts,{model:Artifacts.Part}),delete e.parts,void 0===e.prefix&&(e.prefix=t.get("name")),BonusWorldComponent.call(this,e,t)},init:function(){var i=this;return Promise.resolve().then(function(){return i.loadFromServer()}).then(function(){i.listenTo(i._parts,"change:amount",i.onChangeAmount),i.get("canExchange")&&application.on("beforeLoadMessage",function(e,t){i.get("active")&&(t.artifacts||(t.artifacts=[]),t.artifacts.push(i.get("prefix")))})})},getParts:function(){return this._parts},getPartById:function(e){return this._parts.get(e)},onChangeAmount:function(e,t,i){i.fromServer||this.saveParts([e])},loadFromServer:function(){var i=this;return service("../../../gems/site/service/artifacts/loadParts.php",{prefix:this.get("prefix")}).then(function(e){var t=e.parts;i._parts.set(t.map(function(e){return{id:e.partId,amount:e.amount}}),{fromServer:!0,add:!1,merge:!0,remove:!1})})},saveParts:function(e){return 0<e.length?service("../../../gems/site/service/artifacts/saveParts.php",{prefix:this.get("prefix"),data:JSON.stringify({parts:e.map(function(e){return{partId:e.get("id"),amount:e.get("amount")}})})}):Promise.resolve()},ingredient:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return{type:"IngredientPart",part:this._parts.get(e),component:this,amount:t}},ingredients:function(){for(var t=this,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return i.map(function(e){return t.ingredient(e)})},_messageArtifactPart:function(e,t,i){callServiceAddInQueue("../../../gems/site/service/artifacts/message-artifact-part.php",{prefix:this.get("prefix"),messageType:e,userIds:i.join(","),partId:t.id})},_removeMessageArtifactPart:function(e,t){callServiceAddInQueue("../../../gems/site/service/artifacts/remove-message-artifact-part.php",{prefix:this.get("prefix"),messageType:e,partId:t.id})},askArtifactPart:function(e,t,i){var o=this;socialNetwork.sendRequest({userIds:t,message:messages[this.get("prefix")+"ArtifactPartAskText"]||messages.artifactPartAskText,success:function(){o._messageArtifactPart("askedArtifactPart",e,t),t.forEach(function(e){window.artifactPartAskedTime[e]=application.getCurrentServerTime()}),setLocalStorage("artifactPartAskedTime",window.artifactPartAskedTime),i instanceof Function&&i(t)}})},sendArtifactPart:function(e,t){e.getAmount()>=t.length&&(e.setAmount(e.getAmount()-t.length),this._messageArtifactPart("sentArtifactPart",e,t),this._removeMessageArtifactPart("askedArtifactPart",e),socialNetwork.sendRequest({userIds:t,message:messages[this.get("prefix")+"ArtifactPartSendText"]||messages.artifactPartSendText}))},receiveArtifactPart:function(e,t){var i=this.getParts().get(e);return!!i&&(i.setAmount(i.getAmount()+t.length),this._removeMessageArtifactPart("sentArtifactPart",i),!0)},cancelAskedArtifactPart:function(e){var t=this.getParts().get(e);return!!t&&(this._removeMessageArtifactPart("askedArtifactPart",t),!0)},getPrefix:function(){return this.get("prefix")}}),ProgressByLastScoreComponent=BonusWorldComponent.extend({defaults:{id:"progressByLastScore"},initialize:function(){BonusWorldComponent.prototype.initialize.call(this),this.listenTo(this.world,"completeLevel",this.updateWorldProgress),this.listenToOnce(this.world,"enter",this.updateWorldProgress),this.listenToOnce(this.world,"configure",this.onConfigure)},onConfigure:function(e,t){var i=this;this.world.get("helpWindow")&&this.loadProgress().then(function(e){return i.world.set("progress",e)})},loadProgress:function(){var e=this;return new Promise(function(i){callServiceOrLocalStorage("../../../levelbase/src/services/loadmyepisodescores.php",function(e){var t=1;e&&e.scores&&(t=Math.max.apply(Math,_toConsumableArray(e.scores.map(function(e){return e.level})))),i(t)},{episode:e.world.get("name"),checkBonusLevel:!1,levelsInEpisode:e.world.get("levelsInEpisode")},"myr_"+e.world.get("name"),{scores:[],bonusLevelFinished:0})})},updateWorldProgress:function(){this.world.set("progress",this.getCurrentLevel())},getCurrentLevel:function(){if(this.world.get("name")==episode.get("num")){var e=_.map(episode.scores.pluck("level"),function(e){return parseInt(e)});return e.push(0),_.max(e)+1}return this.world.get("progress")},absoluteLevelNumber:function(e){return 1*e}}),ProgressSimpleIncrementComponent=BonusWorldComponent.extend({defaults:{id:"progressSimpleIncrement"},initialize:function(){BonusWorldComponent.prototype.initialize.call(this),this.listenTo(this.world,"enter",this.onEnter),this.listenTo(this.world,"completeLevel",this.onCompleteLevel)},onEnter:function(){if(this.world.get("includeLevels")){var e=Math.max.apply(Math,_toConsumableArray(episode.scores.map(function(e){return e.get("level")})));this.world.get("progress")<=e&&(this.world.set("progress",e+1),this.world.saveSelectedOptions(["progress"]))}},onCompleteLevel:function(){this.world.set("progress",this.world.get("progress")+1),this.world.saveSelectedOptions(["progress"])},getCurrentLevel:function(){return this.world.get("progress")},absoluteLevelNumber:function(e){return this.world.get("progress")}}),PartShopComponent=BonusWorldComponent.extend({defaults:{id:"partsShop"},constructor:function(e,t){BonusWorldComponent.call(this,e,t),this._partsSource=null,t.hasComponent(ArtifactController)&&(this._partsSource=t.getComponent(ArtifactController).getArtifactWorkshop()),t.hasComponent("parts")&&(this._partsSource=t.getComponent("parts")),this._shop=this.createShop(),this._shop.on("buyPart",this.onBuyPart,this)},showShop:function(){this._window=new PartShopWindow({shop:this._shop})},closeShop:function(){this._window.close(),this._window=null},onBuyPart:function(e){var t=this,i="",o=[];e.forEach(function(e){e.addAmount(1),i=i+" artifact-part"+e.get("id"),o.push(" artifact-part"+e.get("id"))}),this._partsSource&&this._partsSource instanceof Artifacts.ArtifactWorkshop&&this._partsSource.save(),this.closeShop(),new LootBoxWindow({classes:"artifact-part "+i,partClasses:o,onCLose:function(){return t.showShop()}})},createShop:function(){if(this._partsSource){var e=this._partsSource.getParts().filter(function(e){return e.get("canBeSold")});return new Artifacts.PartShopModel({parts:e,prefix:this.world.get("name"),items:this.get("items")})}}}),BonusWorldAddLivesWindow=TWindow.extend({templateClass:".bonusWorldAddLivesWindow_template",events:{"click #bonusWorldAddLivesBuy":"refill","click .close":"close"},onOpen:function(){var e=this.options.world.get("livesInstance"),t=e.get("lives"),i=e.get("maxLives"),o=Number(e.get("refillPrice"));0<t&&this.$("#bonusWorldAddLivesBuy").addClass("disabled"),this.$(".mTitle").html(messages[this.options.world.get("name")+"AddLivesTitle"]),this.$(".maxLife").html(i),this.$(".addLifeIcoTextAmount").html(i),this.$("#bonusWorldAddLivesPrice").html(o),e.on("change:lives",this.renderCurrentLife,this),e.on("change:timeToNextLife",this.renderTimeToNextLife,this),this.renderCurrentLife(),this.renderTimeToNextLife(),TWindow.prototype.onOpen.call(this)},onClose:function(){var e=this.options.world.get("livesInstance");e.off("change:lives",this.renderCurrentLife,this),e.off("change:timeToNextLife",this.renderTimeToNextLife,this)},refill:function(){var e=this.options.world.get("livesInstance");0===e.get("lives")&&this.areEnoughCoinsToBuyLives()?(this.close(),application.playSound("buyLives"),e.refillLives()):0!==e.get("lives")||this.areEnoughCoinsToBuyLives()||(this.close(),new NoCoinsWindow)},areEnoughCoinsToBuyLives:function(){var e=this.options.world.get("livesInstance").get("refillPrice");return user.get("coins")+0>=e},renderCurrentLife:function(){var e=this.options.world.get("livesInstance");this.$(".currentLife").html(e.get("lives"))},renderTimeToNextLife:function(){var e=this.options.world.get("livesInstance"),t=e.get("lives"),i=e.get("maxLives"),o=e.get("timeToNextLife");t<i?this.$(".addLivesTimer").show().html(formatTime("%i:%s",o)):this.$(".addLivesTimer").hide()}}),BonusWorldFinishedWindow=TWindow.extend({templateClass:".bonusWorldFinishedWindow_template",onOpenSound:!1,events:{"click .needPublicCheckbox":"togglePublicCheckbox","touchend .needPublicCheckbox":"togglePublicCheckbox","click .backToMainWorld":"backToMainWorld","touchend .backToMainWorld":"backToMainWorld"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.options.publicationOff||(this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn"))},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},backToMainWorld:function(){if(Config.bonusWorld.onBonusWorldBackToMainWorld&&Config.bonusWorld.onBonusWorldBackToMainWorld(),this.needPublic){var e=this.options.publicationId||"BonusWorldDonePublication";user.defaultPublication(Config.bonusWorld.get("name")+e,function(){Config.bonusWorld.onPublish&&Config.bonusWorld.onPublish()})}this.close()},takePrize:function(){user.get("coins");new UserPrizes(this.prize).take(episode.get("num")+"WorldDone"),Config.bonusWorld.onBonusWorldTakePrize&&Config.bonusWorld.onBonusWorldTakePrize()},onClose:function(){Config.bonusWorld.onCloseFinishWindow&&Config.bonusWorld.onCloseFinishWindow(),this.options.showAnimatedPrizesWindow&&this.prize&&new AnimatedPrizesWindow({prizes:new UserPrizes(this.prize),worldName:Config.bonusWorld.name,notGive:!0}),TWindow.prototype.onClose.call(this)},onOpen:function(){this.options.publicationOff?(this.offPublicCheckbox(),this.$el.addClass("publicationOff")):this.onPublicCheckbox(),this.prize=this.options.prize;this.options.groupPrize;this.options.lastLevelFinishWindow?(this.$(".windowTitle").html(messages[Config.bonusWorld.get("name")+"LastLevelBonusWorldTitle"]),this.$(".endText").html(messages[Config.bonusWorld.get("name")+"LastLevelBonusWorldText"]),this.$el.addClass("lastLevel")):(this.$(".windowTitle").html(messages[Config.bonusWorld.get("name")+"EndBonusWorldTitle"]),this.$(".endText").html(messages[Config.bonusWorld.get("name")+"EndBonusWorldText"])),this.prize?this.$(".oneWindowBtn.backToMainWorld").html(messages[Config.bonusWorld.get("name")+"EndBonusWorldBtn"]||messages.collect):this.$(".oneWindowBtn.backToMainWorld").html(messages[Config.bonusWorld.get("name")+"EndBonusWorldBtn"]||messages.okay),this.$el.addClass("episode_"+Config.bonusWorld.get("name")),messages[Config.bonusWorld.get("name")+"BonusWorldFinishedBtn"]&&this.$(".backToMainWorld").html(messages[Config.bonusWorld.get("name")+"BonusWorldFinishedBtn"]),this.$(".prizes").empty(),this.prize&&new UserPrizesView({model:new UserPrizes(this.prize),el:this.$(".prizes"),isGroup:!0}),this.prize&&application.playSound("giftReceived"),TWindow.prototype.onOpen.call(this),this.options.noTakePrize||this.takePrize()}}),BonusWorldFinalPrizeWindow=TWindow.extend({templateClass:".bonusWorldFinalPrizeWindow_template",onOpenSound:!1,events:{"click .needPublicCheckbox":"togglePublicCheckbox","touchend .needPublicCheckbox":"togglePublicCheckbox","click .exit":"complete","touchend .exit":"complete"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onOpen:function(){this.prize=this.options.prize,this.bonusWorld=this.options.world,this.onPublicCheckbox(),this.$(".windowTitle").html(messages[this.bonusWorld.get("name")+"FinalPrizeTitle"]),this.$(".bonusWorldFinalPrizeText .text").html(messages[this.bonusWorld.get("name")+"FinalPrizeText"]),this.$prizes=new UserPrizesView({model:this.prize,el:this.$(".prizes")}),TWindow.prototype.onOpen.call(this)},complete:function(){this.needPublic&&user.defaultPublication(Config.bonusWorld.name+"BonusWorldDonePublication"),this.close()},onClose:function(){var t=this;return this.bonusWorld.set("offerChestTaken",!0),new Promise(function(e){new AnimatedPrizesWindow({prizes:t.prize,worldName:t.bonusWorld.get("name"),onClose:e})}).then(function(){t.bonusWorld.onBonusWorldTakePrize(),t.bonusWorld.exit()})}}),BonusWorldHelpWindow=TWindow.extend({templateClass:".bonusWorldHelpWindow_template",events:{"click .start":"close","click .no":"close","click .yes":"giveHelp"},giveHelp:function(){this.close(),this.options.world.open(),this.options.prize.take("v help give")},onOpen:function(){this.$el.addClass(this.options.world.get("name")),this.$(".mTitle").html(messages[this.options.world.get("name")+"ReturnTitle"]),this.$(".mText").html(messages[this.options.world.get("name")+"ReturnText"]),this.$prize=new UserPrizesView({el:this.$(".mPrize"),model:this.options.prize})}}),BonusWorldHandyWindow=TWindow.extend({templateClass:".bonusWorldHandyWindow_template",events:{click:"close","click .close":"close"},onOpen:function(){var e=this;TWindow.prototype.onOpen.call(this),this.options.picture&&this.$el.addClass(this.options.picture),this.options.addSelector&&this.$el.addClass(this.options.addSelector()),this.options.title&&this.$(".mTitle").html(this.options.title),this.options.text&&this.$(".mText").html(this.options.text),this.options.auxText&&this.$(".mAuxText").html(this.options.auxText),this.options.closeTimeout&&setTimeout(function(){return e.close()},this.options.closeTimeout);var t=this.options.otherElements;if(t)for(var i=0;i<t.length;i++){var o=$('<div class="'+t[i].selector+'"></div>');o.html(t[i].content),this.$el.append(o)}}}),BonusWorldNotAvailableWindow=TWindow.extend({templateClass:".bonusWorldNotAvailableWindow_template",events:{"click .close":"close","click .closeAndPlay":"close"},onOpen:function(){var e=this.options.bonusWorld;TWindow.prototype.onOpen.call(this),this.$el.find(".bonusWorldMinLevel").html(e.get("minRealLevelToEnter")),this.$el.addClass("episode_"+e.get("name"))}}),StarChestClosedWindow=TWindow.extend({templateClass:".bonusWorldLevelPrizeWindow_template",events:{"click .continue":"close"},prepareWindow:function(){var e=this.options.world.getComponent(StarChestController),t=Math.min(e.getCurrStars(),this.options.chest.get("stars")).toString(),i=this.options.chest.get("stars");this.$el.addClass("StarChestClosedWindow").addClass("StarChest"+this.options.chest.get("id")).addClass("episode_"+Config.bonusWorld.name),this.$(".windowTitle").html(messages[this.options.world.get("name")+"StarChestClosedWindowTitle"]),this.$(".mainText").html(messages[this.options.world.get("name")+"StarChestClosedWindowText"]+t+"/"+i+"<span class='starIco'></span>"),this.$(".needPublicBlock").addClass("invite"),this.$(".oneWindowBtn.continue.prizeGet").addClass("invite"),this.$(".oneWindowBtn.continue").html(getLocaleText("okay"))},createPrizes:function(){this.$el.addClass("prize"),new UserPrizesView({model:this.options.chest.get("prize"),el:this.$(".prizes")})},onOpen:function(){TWindow.prototype.onOpen.call(this),this.prepareWindow(),this.createPrizes()}}),StarChestOpenWindow=TWindow.extend({templateClass:".bonusWorldLevelPrizeWindow_template",events:{"click .needPublicCheckbox":"togglePublicCheckbox","click .continue":"close"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},prepareWindow:function(){this.$el.addClass("StarChestOpenWindow").addClass("StarChest"+this.options.chest.get("id")).addClass("episode_"+Config.bonusWorld.name),this.$(".characterBlock").addClass("open"),this.$(".oneWindowBtn.continue").addClass("invite"),this.$(".oneWindowBtn.continue.prizeGet").removeClass("invite"),this.$(".windowTitle").html(messages[this.options.world.get("name")+"StarChestOpenWindowTitle"]),this.$(".mainText").html(messages[this.options.world.get("name")+"StarChestOpenWindowText"]),this.onPublicCheckbox()},createPrizes:function(){this.$el.addClass("prize"),new UserPrizesView({model:this.options.chest.get("prize"),el:this.$(".prizes"),isGroup:this.options.chest.get("isGroup")})},onOpen:function(){TWindow.prototype.onOpen.call(this),this.prepareWindow(),this.createPrizes()},onClose:function(){TWindow.prototype.onClose.call(this),this.doPublication()},doPublication:function(){this.needPublic&&user.defaultPublication(Config.bonusWorld.name+this.options.chest.get("publicationId")+"Publication")}}),BonusWorldTimeoutWindow=TWindow.extend({templateClass:".bonusWorldTimeoutWindow_template",events:{"click .close":"close","click .buyTime":"buyTime"},buyTime:function(){var e=this,t=this.options.offer,i=this.options.world||Config.bonusWorld;application.windows.closeAll(),t.buy().then(function(){e.options.prize&&e.options.prize.take(),i.open()}),this.close()},onOpen:function(){var e=this.options.world||Config.bonusWorld,t=this.options.offer;this.$(".windowSmallTitle").text(messages[e.get("name")+"NewBonusWorldName"]),t.get("coins")?this.$(".buyTime .price").text(t.get("coins")):this.$(".buyTime .price").text(prices[t.get("productId")].desc.price),this.$el.addClass("episode_"+e.get("name")),this.$(".buyTime").toggleClass("hidden",!e.get("allowProlong")),this.$(".timeoutText").toggleClass("hidden",!e.get("allowProlong")),this.$(".cantProlongText").toggleClass("hidden",e.get("allowProlong")),this.options.prize&&(this.$el.addClass("withPrize"),new UserPrizesView({el:this.$(".mPrizes"),model:new UserPrizes(this.options.prize.getUserPrizes())})),this.options.prize||(this.$el.addClass("withPrize"),new UserPrizesView({el:this.$(".mPrizes"),model:new UserPrizes(t.getProducts())}))}}),BonusWorldLevelPrizeWindow=TWindow.extend({templateClass:".bonusWorldLevelPrizeWindow_template",events:{"click .needPublicCheckbox":"togglePublicCheckbox","click .continue":"close"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onOpen:function(){if(TWindow.prototype.onOpen.apply(this,arguments),this.$el.addClass("level"+this.options.level).addClass("episode_"+Config.bonusWorld.name).toggleClass("finishing",Boolean(this.options.finishing)),this.$(".windowTitle").html(getLocaleText(Config.bonusWorld.name+"LevelPrizeTitle",this.options.level)),this.$(".mainText").html(getLocaleText(Config.bonusWorld.name+"LevelPrizeMainText",this.options.level)),this.onPublicCheckbox(),this.options.prize){this.$el.addClass("prize");var e=_.isArray(this.options.prize)?this.options.prize:[this.options.prize];new UserPrizesView({model:new UserPrizes(e),el:this.$(".prizes"),isGroup:!0,dontClearContainer:!0})}},onClose:function(){this.options.prize&&new UserPrizes(_.isArray(this.options.prize)?this.options.prize:[this.options.prize]).take("levelPrize"+this.options.level,this.options.world.get("name"),this.options.level);this.doPublication(),this.options.finishing&&this.options.prize&&episodeView.gotoBonusWorld(),TWindow.prototype.onClose.call(this)},doPublication:function(){this.needPublic&&user.defaultPublication(Config.bonusWorld.name+"BonusWorldPrizeOnLevel"+this.options.level+"Publication")}}),Yld,Zld;BonusWorldLevelPrizeWindow.prototype.togglePublicCheckbox=(Yld=BonusWorldLevelPrizeWindow.prototype.togglePublicCheckbox,function(){Yld.call(this),this.rememberCheckboxState()}),BonusWorldLevelPrizeWindow.prototype.onOpen=(Zld=BonusWorldLevelPrizeWindow.prototype.onOpen,function(){Zld.call(this),this.applyCheckboxState(),this.$el.find(".powerUp").removeClass("powerUp")});var BonusWorldLives=Backbone.Model.extend({defaults:{lives:5,maxLives:5,lifeRestoreTime:1800,livesLastRestored:0,worldName:"",timeToNextLife:-1,refillPrice:300,cssSufix:"BonusWorld",_$livesBlock:null},configure:function(e){var t=$("#livesBlock"+this.get("cssSufix"));t.addClass("hasOwnLives"),this.set(_.extend({},e,{_$livesBlock:t})),this.get("world").isMaster()&&$("#livesBlockBonusWorld").on("click.bonusworldlives touchend.bonusworldlives",this.openAddLivesWindow.bind(this)),this.get("world").on("enter",this.onEnter,this),this.get("world").on("exit",this.onExit,this)},onEnter:function(){this.set("active",!0),this.handleTimeInterval()},onExit:function(){this.set("active",!1)},destroy:function(e){this.get("_$livesBlock").removeClass("shown"),this.trigger("destroy",this,this.collection,e),$("#livesBlockBonusWorld").off(".bonusworldlives")},sendLives:function(){var e=Library.clamp(this.get("lives"),0,this.get("maxLives"));callServiceAddInQueue("../../../levelbase/src/services/setbonusworldlives.php",{worldName:this.get("worldName"),lives:e,livesLastRestored:this.get("livesLastRestored")})},addLifeRequest:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=this.get("lives")+e;t<=this.get("maxLives")&&(this.set({lives:t}),this.sendLives(t))},removeLifeRequest:function(){var e=this.get("lives");0<=e&&(this.get("lives")===this.get("maxLives")&&this.set("livesLastRestored",-1),this.set({lives:e}),this.sendLives(e))},refillLives:function(){var e=Math.abs(Number(this.get("refillPrice"))),t=user.get("coins")-e;if(isFinite(e)&&0<=t){var i={worldName:this.get("worldName"),lives:this.get("maxLives"),livesLastRestored:this.get("livesLastRestored")};user.set({coins:new ObscureNumber(t),actionName:"refill lifes of bonus world",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:e},{validate:!0}),callServiceAddInQueue("../../../levelbase/src/services/setbonusworldlives.php",i),this.set(i)}},handleTimeInterval:function(){var e,t=this.get("lives"),i=this.get("maxLives"),o=this.get("lifeRestoreTime"),a=this.get("livesLastRestored");t<i?(0<a?e=a+o-application.getCurrentServerTime():(e=o,a=application.getCurrentServerTime()),this.set("timeToNextLife",e),e<=0&&(a+=o,i<=(t=this.get("lives")+1)&&(t=i,a=-1),this.get("lives")===t&&this.get("livesLastRestored")===a||(this.set({lives:t,livesLastRestored:a}),this.sendLives()))):this.set("timeToNextLife",-1);this.get("active")&&this.renderLives()},openAddLivesWindow:function(){this.get("active")&&new BonusWorldAddLivesWindow({world:this.get("world")})},renderLives:function(){var e=this.get("lives"),t=this.get("maxLives"),i=this.get("cssSufix"),o=this.get("_$livesBlock"),a=$("#addLivesTimerBlock"+i);if((Game&&Game.get("isPlaying")&&"bonus"!==application.level.num||user.get("showOneMoreLive"))&&e++,o.find(".lifeProgress").css("width",100*e/t+"%"),o.find(".lifesBlockIco").html(e),$("#addLifesBuy"+i).addClass("disabled"),e<t){var n=this.get("timeToNextLife");0<=n?$("#addLivesTimer"+i).html(formatTime("%i:%s",n)):$("#addLivesTimer"+i).html(""),a.removeClass("fullLivesTimer"),o.addClass("timerOn")}else a.addClass("fullLivesTimer"),$("#addLivesTimer"+i).html(messages.fullLivesTimer),o.removeClass("timerOn")}}),PrizeMarksDropper=BonusWorldComponent.extend({defaults:{id:"prizeMarksDropper",markKey:"prizePointMark",defaultMarkLimit:100,chance:25,validatorGame:function(e,t){return episode.isBonusWorld()&&episode.get("num")===e.get("name")}},init:function(){var e=this;return Promise.resolve().then(function(){application.on("beforeGameStart",e.onBeforeGameStart,e)})},onBeforeGameStart:function(e){this.get("validatorGame")(this.world,e)&&this.world.isAvailability()&&(this.game&&(this.disableListeners(),this.game=null),this.game=e,this._created=0,this._limit=0,this.game.on("initCellForFallDown",this.createPrizeMark,this),this.game.on("start",this.onStartGame,this),this.game.on("fail",this.onFailGame,this),this.game.on("win",this.onWinGame,this))},createPrizeMark:function(e){var t=_.random(0,100)<=this.get("chance");this._created>=this._limit||t&&(this._created++,e.secondAttribute=this.get("markKey"))},onStartGame:function(){var e=application.level.prizePointMarksLimit;this._created+=this.getCountInField(),this._limit=e&&0<e?e:this.get("defaultMarkLimit")},onWinGame:function(){this.disableListeners()},onFailGame:function(){this.disableListeners()},disableListeners:function(){this.game.off("initCellForFallDown",this.createPrizeMark,this),this.game.off("start",this.onStartGame,this),this.game.off("fail",this.onFailGame,this),this.game.off("win",this.onWinGame,this)},getCountInField:function(){var t=this,i=0;return this.game.each(function(e){e.secondAttribute&&e.secondAttribute===t.get("markKey")&&i++}),i},isActive:function(){}}),GameCollectable=Backbone.Model.extend({defaults:{type:"",amount:0,content:null}}),CollectablesBagView=Backbone.View.extend({initialize:function(){var t=this;this.container=this.model.game.collectablesContainer,this.$el.addClass(this.model.world.get("name")),this.listenTo(this.container,"add",this.onAddItem),this.listenTo(this.container,"remove",this.onRemoveItem),this.listenTo(this.container,"change",this.onUpdateItem),this.container.forEach(function(e){return t.onAddItem(e)}),this.updateBag()},onAddItem:function(e){var t=e.get("collector").createCollectableView(e);t.attr("id",e.cid),t.addClass(e.get("type")),t.find(".amount").html(e.get("amount")),this.$el.append(t),this.updateBag()},onRemoveItem:function(e){this.$el.find("#"+e.cid).remove(),this.updateBag()},onUpdateItem:function(e){this.$el.find("#"+e.cid).find(".amount").html(e.get("amount")),this.updateBag()},updateBag:function(){for(var e=0;e<this.container.length;++e)this.$el.removeClass("collected"+e),this.$el.removeClass("collectedTypes"+e);var t=_.unique(this.container.pluck("type")).length;this.$el.toggleClass("empty",this.container.length<=0),this.$el.addClass("collected"+this.container.length),this.$el.addClass("collectedTypes"+t),$(".specialworldCoinMenuBlock").toggleClass("empty",this.container.length<=0)}}),BaseInGameCollector=Backbone.Model.extend({defaults:{collectableType:"default",collectionEvent:"removedItem",collectAfterComplete:!0},initialize:function(e){this.world=e.world,this.setOptions(e)},setOptions:function(e){this._options=_.assign({},this._options,e)},getOption:function(e){return this._options[e]},canCollect:function(e){return this.get("collectAfterComplete")||!this.game.tasks.isComplate()},activate:function(e){if(this.game=e,this.get("modifiers")){var t=this.get("modifiers").find(function(e){return-1!==(e.levelsFromAbout?episode.get("about").modifierLevels:e.levels).indexOf(application.level.num)});t?this.setOptions(t):this.setOptions(this.attributes)}this.listenTo(this.game,this.get("collectionEvent"),this.onCollectionEvent)},onCollectionEvent:function(e){this.canCollect(e)&&(this.addCollectable(e),this.animateCollect(this.game.animate(),e.$div))},getCollectedElement:function(e){var t=this;return this.game.collectablesContainer.find(function(e){return e.get("type")===t.get("collectableType")})},addCollectable:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this.getCollectedElement(e);t?t.set("amount",t.get("amount")+1):this.game.collectablesContainer.add(new GameCollectable({type:this.get("collectableType"),collector:this,amount:1,world:this.world,content:e}))},deactivate:function(){this.stopListening()},onStartGame:function(){},makeProduct:function(e){},onFailGame:function(){},onShowWindow:function(e){var t=this,i=e.$(".collectablesBlock"),o=this.game&&this.game.collectablesContainer&&this.game.collectablesContainer.filter(function(e){return e.get("type")===t.get("collectableType")});0<o.length&&e.$el.addClass(this.get("collectableType")+"Collected"),o.forEach(function(e){t.createCollectableView(e).appendTo(i)})},createCollectableView:function(e){var t=$(".invisible .collectablesContainer .gameCollectable").clone();return t.addClass(""+e.get("type")),t.find(".amount").html(e.get("amount")),t},isAvailable:function(e){return!0},getCollectedAmount:function(){var t=this,i=0;return this.game.collectablesContainer.filter(function(e){return e.get("type")===t.get("collectableType")}).forEach(function(e){i+=e.get("amount")}),i},animateCollect:function(e,t){var i=t.clone(),o=$(".specialworldCoinMenuBlock");_Figure.blockedAnimations.append(i),i.alignTo(t),i.ourAnimate({scale:1,target:o},600,"linear",function(){i.remove(),e()})}}),ArtifactPartsCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"artifactPart"},BaseInGameCollector.prototype.defaults),isAvailable:function(e){return!!Config.bonusWorld.getComponent(ArtifactController)||!!episode.get("episodeCollection")&&application.level.num==Config.bonusWorld.getCurrentLevel()},canCollect:function(e){return e instanceof ArtifactPartCell},createCollectableView:function(e){var t=BaseInGameCollector.prototype.createCollectableView.call(this,e);return t.addClass("partId"+e.get("content").partId),t}}),SpittedArtifactPartsCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"artifactPart",collectionEvent:"partSpitted"},BaseInGameCollector.prototype.defaults),isAvailable:function(e){return!!Config.bonusWorld.getComponent(ArtifactController)||!!episode.get("episodeCollection")&&application.level.num==Config.bonusWorld.getCurrentLevel()},createCollectableView:function(e){var t=BaseInGameCollector.prototype.createCollectableView.call(this,e);return t.addClass("part"+e.get("content").get("id")),t},animateCollect:function(e,t){e()}}),PrizePointsCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"prizePoints",collectionEvent:"removedSecondAttribute_prizePointMark",pointsPrize:{products:[{type:"PrizePointsProduct",amount:1}]}},BaseInGameCollector.prototype.defaults),isAvailable:function(){return!!this.world.getComponent(PrizeController)},onCollectionEvent:function(e){if(this.canCollect(e)){var t=new UserPrizes(UserPrizes.convertFromCocos(this.get("pointsPrize")));this.addCollectable(t),this.animateCollect(this.game.animate(),e.$div.$secondAttr)}},onShowWindow:function(e){BaseInGameCollector.prototype.onShowWindow.call(this,e),e.$el.toggleClass("prizePointsCollected",0<this.getCollectedAmount())},makeProduct:function(e){return{type:"PrizePointsProduct",amount:e.get("amount"),world:this.world.get("name")}}}),InstantPartsCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"part",collectionEvent:"validMove",activationMove:1,perMoveChance:100,onReplay:!1,materials:{normal:.56,rare:.32,legend:.12},rules:[function(){return!0}],parts:[]},BaseInGameCollector.prototype.defaults),activate:function(e){BaseInGameCollector.prototype.activate.call(this,e),this._collected={}},setOptions:function(e){BaseInGameCollector.prototype.setOptions.call(this,_.pick(e,"activationMove","perMoveChance","materials","minLevel","maxLevel"))},isAvailable:function(e){return this.get("rules").every(function(e){return e()})&&(this.get("onReplay")||this.world.getCurrentLevel()===application.level.num)&&this.world.getCurrentLevel()>=this.getOption("minLevel")&&(this.world.getCurrentLevel()<=this.getOption("maxLevel")||!this.getOption("maxLevel"))},canCollect:function(e){var t=_.random(0,100)<=this.getOption("perMoveChance"),i=this._collected[this.game.getMoveId().toString()];return this.getOption("activationMove")<=this.game.getMoveId()&&!i&&t&&e instanceof Cell},getCollectedElement:function(t){var i=this;return this.game.collectablesContainer.find(function(e){return e.get("type")===i.get("collectableType")&&e.get("content").get("id")===t.get("id")})},addCollectable:function(e){var t=this._generatePart();if(t){this._collected[this.game.getMoveId().toString()]=t,BaseInGameCollector.prototype.addCollectable.call(this,t);var i=FigureView.createByTemplate(".invisible .artifactPartCell",["part"+t.get("id")]);_Figure.blockedAnimations.append(i),i.alignTo(e.$div),this.animateCollect(this.game.endTurnAnimate(),i),i.remove()}else console.error("   ")},animateCollect:function(e,t){var i=t.clone(),o=$(".specialworldCoinMenuBlock");_Figure.blockedAnimations.append(i),i.alignTo(t),application.playSound("collectPart"),i.ourAnimate({scale:1.5},600,"linear").ourAnimate({target:o},600,"easeInCubic",function(){i.remove(),e()})},makeProduct:function(e){return{type:"ExactArtifactPartProduct",world:this.world.get("name"),partId:e.get("content").id,amount:e.get("amount")}},_animateReceiveRandomArtifactPart:function(n,e,r){var s=this.world.view.$el.find(".mForgeBtn.forgeButton");if(s){setTimeout(function(){var e=window.mobile?$(".artifactPartStartPoint").get(0).getBoundingClientRect():$(".artifactPartStartPoint").position(),t=s.position(),i=$("<div></div>").addClass("animationArtifactPart artifactPart"+n.get("content").get("id")).css({top:e.top,left:e.left,"z-index":5}).appendTo("#blockedAnimations"),o=s[0].getBoundingClientRect(),a=i[0].getBoundingClientRect();t.top+=(o.height-a.height)/2,t.left+=(o.width-a.width)/2,i.animate({top:t.top,left:t.left},{duration:r,easing:"easeOutQuad",done:function(){i.remove(),Config.bonusWorld.trigger("artifactAnimationFinished")}})},e)}},_generatePart:function(){var t=randomizedObjectKey(this.getOption("materials"));return RANDOM(this.get("parts").filter(function(e){return e.get("material")===t}))},createCollectableView:function(e){var t=BaseInGameCollector.prototype.createCollectableView.call(this,e);return t.addClass("part"+e.get("content").get("id")),t},onCollectionEvent:function(e){this.canCollect(e.first)&&this.addCollectable(e.first)}}),ForceInstantPartsCollector=InstantPartsCollector.extend({_generatePart:function(){if(!this.game._generatedFirstPart){this.game._generatedFirstPart=!0;var t=this.get("forceMaterial");return RANDOM(this.get("parts").filter(function(e){return e.get("material")===t}))}return InstantPartsCollector.prototype._generatePart.call(this)},canCollect:function(e){return this.game._generatedFirstPart?InstantPartsCollector.prototype.canCollect.call(this,e):this.get("forceMoveId")<=this.game.getMoveId()&&(e instanceof Cell||e instanceof MultiColorCell)}}),TicketsCollector=BaseInGameCollector.extend({defaults:_.defaults({componentId:"tickets",collectableType:"prizePoints",collectionEvent:"removedSecondAttribute_prizePointMark"},BaseInGameCollector.prototype.defaults),isAvailable:function(e){return!!this.world.getComponent(TicketsComponent)},onCollectionEvent:function(e){this.canCollect(e)&&(this.addCollectable({}),this.animateCollect(this.game.animate(),e.$div.$secondAttr))},onShowWindow:function(e){BaseInGameCollector.prototype.onShowWindow.call(this,e),e.$el.toggleClass("prizePointsCollected",0<this.getCollectedAmount())},makeProduct:function(e){return{type:"TicketsProduct",amount:e.get("amount"),componentId:this.get("componentId"),world:this.world}}}),ColorCellCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"prizePoints",types:[Cell,ArrowCell],collectAfterComplete:!1},BaseInGameCollector.prototype.defaults),canCollect:function(e){return e.color===this.get("color")&&util.classOfAny(e,this.get("types"))&&BaseInGameCollector.prototype.canCollect.call(this,e)},makeProduct:function(e){return{type:"PrizePointsProduct",amount:e.get("amount"),world:this.world.get("name")}}}),BoxPartCollector=BaseInGameCollector.extend({defaults:_.defaults({collectableType:"part",rule:function(){return!0},defaultPart:null},BaseInGameCollector.prototype.defaults),activate:function(e){BaseInGameCollector.prototype.activate.call(this,e),this.get("collectNotOpened")&&application.on("notOpenedBoxCollect",this.onCollectNotOpened,this)},canCollect:function(e){return e instanceof BoxCell},getCollectedElement:function(t){var i=this;return this.game.collectablesContainer.find(function(e){return e.get("type")===i.get("collectableType")&&e.get("content").get("id")===t.get("id")})},addCollectable:function(e){var t=e.part||this.get("defaultPart");if(t){BaseInGameCollector.prototype.addCollectable.call(this,t);var i=FigureView.createByTemplate(".invisible .artifactPartCell",["part"+t.get("id")]);_Figure.blockedAnimations.append(i),i.alignTo(e.$div),this.animateCollect(this.game.endTurnAnimate(),i),i.remove()}else console.error("   ")},onCollectNotOpened:function(e){BaseInGameCollector.prototype.addCollectable.call(this,e),application.off("notOpenedBoxCollect",this.onCollectNotOpened,this)},animateCollect:function(e,t){var i=this,o=t.clone(),a=$(".specialworldCoinMenuBlock");_Figure.blockedAnimations.append(o),o.alignTo(t),application.playSound("collectPart"),o.ourAnimate({scale:1.5},600,"linear").ourAnimate({target:a},600,"easeInCubic",function(){i.game.emit("partSpit",i),o.remove(),e()})},makeProduct:function(e){return{type:"ExactArtifactPartProduct",world:this.world.get("name"),partId:e.get("content").id,amount:e.get("amount")}},createCollectableView:function(e){var t=BaseInGameCollector.prototype.createCollectableView.call(this,e);return t.addClass("part"+e.get("content").get("id")),t},onCollectionEvent:function(e){this.canCollect(e)&&this.addCollectable(e)},isAvailable:function(e){return this.get("rule")()}}),ForceBoxPartCollector=BoxPartCollector.extend({onStartGame:function(){BoxPartCollector.prototype.onStartGame.call(this),this.game.once("partSpit",this._applyInGameForce,this)},_applyInGameForce:function(){new ForceView({type:[{targetLevel:2,buttonText:"Okay",cssClass:"forgeItem",highlightedElements:["CollectablesBagView"]}],step:1})}}),EpisodeCollectionArtifactBoxPartCollector=BoxPartCollector.extend({defaults:_.defaults({collectableType:"artifactPart"},BoxPartCollector.prototype.defaults),createCollectableView:function(e){var t=BaseInGameCollector.prototype.createCollectableView.call(this,e);return t.addClass("partId"+e.get("content").get("id")),t},makeProduct:function(e){return{type:"episodeCollectionPart",world:this.world.get("name"),partId:e.get("content").get("id"),amount:e.get("amount")}}}),CollectorsAgency=BonusWorldComponent.extend({defaults:{id:"collectors",canCollectorsCogentWindow:!0,validatorGame:function(e){return episode.isBonusWorld()&&episode.get("num")===e.get("name")}},initialize:function(e){var t=this;this.game=null,this.collectors=new Backbone.Collection,e&&e.collectors&&e.collectors.forEach(function(e){return t.addCollector(e)}),BonusWorldComponent.prototype.initialize.call(this,e)},init:function(e,t){var i=this;return Promise.resolve().then(function(){application.on("beforeGameStart",i.onBeforeGameStart,i)})},onBeforeGameStart:function(e){var t=this;episode.get("num")!==this.world.get("name")&&(episode.isBonusWorld()&&!Config.bonusWorld.get("isFreeEpisode")||this.world!==application.getExternalWorld())||this.game&&(this.disableGameListeners(),this.game=null),this.get("validatorGame")(this.world,e)&&(this.view&&(this.view.remove(),this.view=null),this.game=e,this.view=new CollectablesBagView({el:$(".invisible .collectablesContainer .collectablesContainerBlock").clone(),model:this}),this._activatedCollectors=[],this.collectors.forEach(function(e){e.isAvailable(t.game)&&(e.activate(t.game),t._activatedCollectors.push(e))}),this.collectors.some(function(e){return e.isAvailable(t.game)})&&($("#menu .specialworldCoinMenuBlock").addClass("active"),this.view.$el.appendTo($("#menu .specialworldCoinMenuBlock"))),this.game.on("start",this.onStartGame,this),this.game.on("fail",this.onFailGame,this),application.on("game_win",this.onWinGame,this),application.on("windowShow",this.onShowWindow,this))},addCollector:function(e){this.collectors.add(e)},add:function(e,t){this.collectors.add(new e(_.assign({world:this.world},t)))},getActiveCollected:function(){return this._activatedCollectors},onStartGame:function(t){return Promise.all(this._activatedCollectors.map(function(e){return Promise.resolve().then(function(){return e.onStartGame(t)})}))},onFailGame:function(t){var i=this;return Promise.all(this._activatedCollectors.map(function(e){return Promise.resolve().then(function(){return e.onFailGame(t)}).then(function(){return e.deactivate()}).then(function(){return i.disableGameListeners()})}))},onWinGame:function(i){var o=this;return Promise.resolve().then(function(){var e=i.collectablesContainer.map(function(e){return e.get("collector").makeProduct(e)}).filter(function(e){return Boolean(e)}),t=new Prize({name:o.world.get("name")+".collectInGame",products:e});o.trigger("prizeCollected",t),t.take()}).then(function(){return Promise.all(o._activatedCollectors.map(function(e){return e.deactivate()}))}).then(function(){return o.disableGameListeners()})},disableGameListeners:function(){$("#menu .specialworldCoinMenuBlock").removeClass("active"),this.game.off("start",this.onStartGame,this),this.game.off("fail",this.onFailGame,this),this.view&&(this.view.remove(),this.view=null),application.off("game_win",this.onWinGame,this),application.off("windowShow",this.onShowWindow,this)},getCollectableByType:function(t){return this.game.collectablesContainer.find(function(e){return e.get("type")===t})},hasAnythingCollected:function(){return this.game&&0<this.game.collectablesContainer.length},onShowWindow:function(t){return Promise.all(this._activatedCollectors.map(function(e){return Promise.resolve().then(function(){return e.onShowWindow(t)})}))}}),BonusWorld=Backbone.Model.extend({defaults:{name:"bonusworld",viewId:BonusWorldView,version:1,levelsInEpisode:10,durationDays:3,includeLevels:!0,networks:void 0,production:!0,uids:void 0,episode:1,level:1,minEpisodeToEnter:2,minLevelToEnter:2,listIndex:0,force:!0,intro:!1,group:"common",satelliteNames:[],closeForNew:!1,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],helpWindow:!1,replayLevel:0,unlimitedName:"unlimitedBonusWorldLives",extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",allowPaid:!0,displayExpired:!1,allowProlong:!0,showProgress:!1,showTimer:!1,prolongMaxTimes:void 0,prolongDuration:86400,prolongAvailableDuration:null,allowAfterWin:!1,backToFirstLevelAfterFail:!1,backToFirstLevelSound:!1,lastLevelBlocked:!1,lastLevelStarsNeeded:0,withFriends:!1,changeoverDate:null,timeBeforeChange:86400,prizes:[],hasBattlePass:!1,withOwnGacha:!1,finished:!1,timeout:!1,allowAfterWinAndTimeout:!1,actionQueue:new ActionQueue,prolongTimes:0,lastLevelOpen:!1,sounds:{},timeToNextLife:-1,livesInstance:null,suggestPlayForLife:!1,active:!1,notify:!1,location:1,finalLocation:0,progress:1,levelsOrder:[],daysBeforeClose:3,showFinalForce:!1,alwaysCancelNext:!0,progressComponent:ProgressByLastScoreComponent,showStatistics:!1,noArtifactPartOnReplay:!0,skipLevelPublication:!0,playOnlyCurrentLevel:!1,dontShowAd:!1,useUserPrizesView:!0,chestsInProgressBar:!1,continuityStage:0,features:null},preload:function(e){var t=this;return this.emit("preload").then(function(){return Promise.all(t._components.map(function(e){if(e.preload)return e.preload()}))}).then(e)},preloadEpisode:function(e,t){return this.emit("preloadEpisode",e).then(t)},initialize:function(){var i=this;this.objectClasses={},this._components=new Backbone.Collection,this._converters={},this.set("features",[]),this.name=this.get("name"),this.levelsInEpisode=this.get("levelsInEpisode"),this.backToFirstLevelAfterFail=this.get("backToFirstLevelAfterFail"),this.backToFirstLevelSound=this.get("backToFirstLevelSound");var e=this.get("livesInstance");e&&(this.livesController=this.addComponent(BonusWorldLivesController,{world:this,livesModel:e})),this.set("minRealLevelToEnter",(this.get("minEpisodeToEnter")-1)*Config.levelsInEpisode+this.get("minLevelToEnter")),this.handle=_.once(this.handle),_.each(this.get("sounds"),function(e,t){Config.sounds[t+"_"+this.name]=e},this),this.on("change:prolongTimes",function(e,t){setLocalStorage(e.get("name")+"ProlongTimes",t),e.get("prolongMaxTimes")&&t>=this.get("prolongMaxTimes")&&this.set("allowProlong",!1)}),this.get("prizes").forEach(function(e){e.prize.forEach(function(e){e.world=i.get("name")})}),this.addComponent(this.get("progressComponent")),this.storage={getItem:function(e){return getLocalStorage("".concat(i.get("name"),":").concat(e))},setItem:function(e,t){setLocalStorage("".concat(i.get("name"),":").concat(e),t)}},this.addComponent(RulsRunLevelComponent)},absoluteLevelNumber:function(e){var t=this.getComponent(this.get("progressComponent"));return t?t.absoluteLevelNumber(e):e},getGameClasses:function(){return[]},save:function(){return Promise.resolve()},setupBattlePassCssClass:function(){$("#livesBlockBonusWorld").toggleClass("hasBattlePass",this.get("hasBattlePass"))},addComponent:function(e,t){var i=new e(t,this);return this._components.add(i),i},getComponent:function(t){return"string"==typeof t?this._components.get(t):this._components.find(function(e){return e instanceof t})},cmp:function(e){return this.getComponent(e)},hasComponent:function(e){return!!this.getComponent(e)},getComponents:function(){return this._components},configure:function(e,t){var i=this;if(!this.configured){this.configured=!0,this.ln=application.ln.createSub(this.get("name"));var o=_.bind(function(){"main"===application.get("page")&&(episode.get("num")===this.name?this.onEpisode():this.needShowHelpWindow()&&this.showHelpWindow())},this);this.get("helpWindow")&&application.on("gameStart",function(){episode.isBonusWorld()||i.set("gameCountForHelpWindow",(i.get("gameCountForHelpWindow")||0)+1)}),application.on("change:page",o),episode.on("change:num",o),user.on("buyProduct",this.onBuyBattlePass,this),this.prepareNotifies();var a=this.get("livesInstance");if(a&&a.configure($.extend({},{world:this,worldName:this.get("name")},this.pick("lifeRestoreTime","lives","livesLastRestored","maxLives","timeToNextLife","refillPrice"))),!e&&this.hasOwnLives()&&this.get("unlimitedName")&&this.resetUnlimitedLivesGood(),this.setupBattlePassCssClass(),!e&&this.get("force")&&this.isAvailableByBeginDate()&&this.showEnterForce(),!e&&this.hasComponent(StoryController)&&this.listenToOnce(this.getComponent(StoryController),"configured",function(){return i.emit("firstStart")}),!this.view){var n=this.get("viewId");this.view=new n({model:this}),this.view.$el.appendTo("#map"),this.view.$el.addClass(this.get("name")+"_content")}return this.isAvailableByBeginDate()||this.runBonusWorldOpenTimer(),this._components.invoke("loadBonusWorldData",t),this.emit("configure",this,e,t)}},onBuyBattlePass:function(e){if("battlePass"===e.type&&e.world===this.get("name")){var t=this.get("livesConfig"),i=this.get("livesInstance");i&&t&&(i.set({livesLastRestored:application.getCurrentServerTime(),lifeRestoreTime:t.lifeRestoreTimeWithBattlePass,lives:t.maxLivesWithBattlePass,maxLives:t.maxLivesWithBattlePass,refillPrice:t.refillPriceWithBattlePass}),i.sendLives())}},onEnterBonusWorld:function(){this.get("showFinalForce")&&1<this.get("progress")&&new SpecialWorldFinalForceWindow,this.bonusWorldFinishTime||this.startBonusWorld(),this.set("visited",!0),this.trigger("beforeEnter",this),this.handle(),this.get("lastLevelBlocked")&&this.renderStars(),$(".wrapper").addClass("bonusworld_"+this.get("name")),this.trigger("enter",this)},onExit:function(){$(".wrapper").removeClass("bonusworld_"+this.get("name")),this.trigger("exit",this)},exit:function(){if(this.isSatellite()){var e=this.get("masterWorld");return Config.bonusWorld=e,void episodeView.changeEpisode(e.name,function(){e.episodeChanged()})}this.leaveBonusWorld&&this.leaveBonusWorld(),episodeView.goHome()},open:function(){var t=this;return this.emit("beforeLoad").then(function(){return new Promise(function(e){t.onEnterCheckFunction(function(){Config.bonusWorld=t,episodeView.changeEpisode(t.name,function(){t.episodeChanged(),e()})})})})},renderStars:function(){episode.scores.once("reset",this.checkStars,this),this.$stars=$(".invisible .bonusWorldLastLevelStarsBlock").clone().appendTo(episodeView.$el).on("click touchend",_.bind(function(e){e.stopPropagation(),e.preventDefault(),this.onStarsClick()},this)),this.$stars.find(".requiredStars").html(this.get("lastLevelStarsNeeded")),application.on("change:subPage",function(e,t){"menuMain"===t&&this.leaveBonusWorld()},this)},onStarsClick:function(){new BonusWorldLastLevelWindow({opened:this.get("lastLevelOpen")})},leaveBonusWorld:function(){this.get("lastLevelBlocked")&&this.$stars.remove(),$(".wrapper").removeClass("bonusworld_"+this.get("name"))},handle:function(){var t;this.get("withFriends")&&(StatisticAfterWindow.prototype.playNextLevel=(t=StatisticAfterWindow.prototype.playNextLevel,function(){var e=this.options.level+1;episode.isBonusWorld()&&e===Config.bonusWorld.get("levelsInEpisode")?(this.needPublic&&this.share(),this.close()):t.call(this)}))},resetUnlimitedLivesGood:function(){var e=goods.find({name:this.get("unlimitedName")});e&&e.set("workHours",-1).save()},onBonusWorldTakePrize:function(){this.get("allowAfterWin")||this.set("active",!1),this.set("finished",!0),callServiceAddInQueue("../../../levelbase/src/services/setbonusworldfinished.php",{worldName:this.get("name")})},onCompleteBonusWorld:function(){this.stopListening(),this.get("finishWindowInStories")||new BonusWorldFinishedWindow(_.find(this.get("prizes"),{type:"finalPrize"}))},runBonusWorldTimer:function(){this.updateBonusWorldInterval||(this.updateBonusWorldInterval=setInterval(_.bind(this.updateBonusWorldTimer,this),500)),this.updateBonusWorldTimer()},updateBonusWorldTimer:function(){if("game"!==application.get("page")){this.get("durationDays")||(this.get("endDate")?this.bonusWorldFinishTime=this.get("endDate").getTime()/1e3:this.bonusWorldFinishTime=application.getCurrentServerTime()+31622400);var e=this.bonusWorldFinishTime-application.getCurrentServerTime();e<=0||this.get("finished")&&!this.get("allowAfterWin")?(!this.get("allowProlong")||this.get("closeForNew")?this.set("active",!1):this.get("allowAfterWin")?this.get("allowAfterWinAndTimeout")?this.set("timeout",!this.get("finished")):this.set("timeout",!0):this.set("timeout",!this.get("finished")),clearInterval(this.updateBonusWorldInterval),this.updateBonusWorldInterval=null,this.set("timer",0)):this.set("timer",e)}},runBonusWorldOpenTimer:function(){this.updateBonusWorldOpenInterval||(this.updateBonusWorldOpenInterval=setInterval(_.bind(this.updateBonusWorldOpenTimer,this),500)),this.updateBonusWorldOpenTimer()},updateBonusWorldOpenTimer:function(){var e=this.get("beginDate").getTime()/1e3-application.getCurrentServerTime();e<=0?(clearInterval(this.updateBonusWorldOpenInterval),this.updateBonusWorldOpenInterval=null,this.set("openTimer",0)):this.set("openTimer",e)},isOpenedForUser:function(){var e=!0;if(this.get("production")&&(e=this.get("production")),this.get("withFriends")&&"phonegap"==network&&e&&(e="phonegap"!=phonegapNetwork),(user.get("episode")<this.get("episode")||user.get("episode")==this.get("episode")&&user.get("level")<this.get("level"))&&(e=!1),void 0!==this.get("networks")&&e&&(e="phonegap"===network?-1!==this.get("networks").indexOf(phonegapNetwork):"wizq"===network?-1!==this.get("networks").indexOf(wizqnetwork):-1!==this.get("networks").indexOf(network)),this.get("finished")&&!this.get("allowAfterWin")&&(e=!1),this.get("finished")&&this.get("timeout")&&(e=!1),void 0!==this.get("uids")&&e&&(e=-1!==this.get("uids").indexOf(viewerId)),void 0!==this.get("gender")&&this.get("gender")!=user.get("gender")&&(e=!1),void 0!==this.get("age")){var t=calcAge(users[user.get("userId")].bthdate);(!t||t<this.get("age")[0]||t>this.get("age")[1])&&(e=!1)}return void 0!==this.get("country")&&users[user.get("userId")].country!=this.get("country")&&(e=!1),e},isOutdated:function(){return this.get("endDate")&&this.get("endDate").getTime()/1e3-application.getCurrentServerTime()<0},isExpired:function(){return this.getTimeLeft()<=0},hasTimer:function(){return!(!this.get("showFinalForce")||!this.get("endDate"))||!(!this.get("durationDays")&&!this.get("endDate"))&&0<this.get("timer")},isStarted:function(){return 0<this.getFinishTime()},onStartBonusWorldLevel:function(e){this.set("takeMiddlePrize",e===this.getCurrentLevel());var t=this.get("livesInstance");if(t){this.checkUnlimitedLives()||t.removeLifeRequest();var i={actionName:"start game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0};user.set(i)}this.trigger("startGame",this,e,this.get("progress")===e)},onShowStatisticWindow:function(e,t){this.trigger("showStatisticWindow",this,e,this.get("progress")===e,t)},checkUnlimitedLives:function(){return goods.checkProduct(this.get("unlimitedName"))},playCurrentLevel:function(){var e=this,t=this.getCurrentLevel();return this.emit("beforePlayLevel"+t).then(function(){episode.playLevel(t,{showStatistics:e.get("showStatistics")})})},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this,o=this.get("progress")===e,a=this.get("takeMiddlePrize")&&_.find(this.get("prizes"),{level:e,type:"middlePrize"}),n=this.cmp("story").get("stories").any(function(e){return e.get("once")==="beforeTakeLevelPrize".concat(i.get("progress"))||e.get("once")==="onFinishLevel".concat(i.get("progress"))||e.get("on")==="beforeTakeLevelPrize".concat(i.get("progress"))||e.get("on")==="onFinishLevel".concat(i.get("progress"))});(a||n)&&Game.cancelNext(),this.trigger("completeLevel",this,e,o),this.trigger("onCompleteLevel",this,e,t,o),this.trigger("onCompleteLevel"+e,this,e,t,o),application.trigger("completeBonusWorldLevel"),this.save()},onCompleteBonusWorldLevel:function(e,t){var i=this.get("progress")===e;e===this.getCurrentLevel()-1&&this.get("takeMiddlePrize")&&this.takeMiddlePrizes(e),this.get("lastLevelBlocked")&&this.checkStars(),this.trigger("onFinishLevel"+e,this,e,t,i),this.trigger("onAfterFinishLevel",this,e,t,i),this.renderChests(),this.renderPrizeBlock()},onFailBonusWorldLevel:function(){var e=this.get("livesInstance"),t=this.checkUnlimitedLives();e&&!t&&e.get("lives")===e.get("maxLives")-1&&(e.set("livesLastRestored",application.getCurrentServerTime()),e.sendLives()),this.trigger("failLevel",this),this.trigger("failLevel"+this.getCurrentLevel(),this)},onWinBonusWorldLevel:function(e){var t=this.get("livesInstance");t&&t.addLifeRequest(),this.trigger("winLevel",this,e),this.trigger("winLevel"+e,this,e)},hasMiddlePrizeOnLevel:function(e){return!!_.find(this.get("prizes"),{level:e,type:"middlePrize"})},hasOwnLives:function(){return Boolean(this.get("livesInstance"))},takeMiddlePrizes:function(t){var i=this,o=_.find(this.get("prizes"),{level:t,type:"middlePrize"});if(o){var a=o.smallPrize;return(o=_.isArray(o.prize)?o.prize:[o.prize]).forEach(function(e){return e.world=i.get("name")}),Promise.resolve().then(function(){return i.emit("beforeTakeLevelPrize",i,o)}).then(function(){return i.emit("beforeTakeLevelPrize"+t,i,o)}).then(function(){return new Promise(function(e){setTimeout(function(){a||new BonusWorldLevelPrizeWindow({world:i,level:t,prize:o,finished:t===i.get("levelsInEpisode")}),new AnimatedPrizesWindow({prizes:new UserPrizes(o),worldName:i.get("name"),onClose:e,notGive:!a})},10)})}).then(function(){return i.emit("takeMiddlePrize",i,o)}).then(function(){return i.emit("takeMiddlePrize"+t,i,o)})}},checkAvailability:function(n){this.isClosingSoon()&&this.onClosingSoon(),this.set("prolongTimes",getLocalStorage(this.get("name")+"ProlongTimes")||0),this.get("endDate")&&this.get("endDate").getTime()/1e3<application.getCurrentServerTime()?n(!1):callService("../../../levelbase/src/services/getbonusworlddata.php",_.bind(function(e){for(var t in e)this._converters[t]&&(e[t]=this._converters[t].getter(e[t]));this.set(e);var i=e.finished,o=e.finishTime,a=o-application.getCurrentServerTime();if(this.get("durationDays")?this.get("endDate")&&(-1===i?a=(o=this.get("endDate").getTime()/1e3)-application.getCurrentServerTime():(o=Math.min(this.get("endDate").getTime()/1e3,o),a=Math.min(o-application.getCurrentServerTime(),a))):a=this.get("endDate")?this.get("endDate").getTime()/1e3-application.getCurrentServerTime():application.getCurrentServerTime()+31622400,-1!==i)if(o)this.get("prolongAvailableDuration")&&this.get("prolongAvailableDuration")+o<application.getCurrentServerTime()&&this.set("allowProlong",!1),0<a?(this.bonusWorldFinishTime=o,this.runBonusWorldTimer(),this.configure(!0,e),n(!0)):!this.get("closeForNew")&&this.get("allowProlong")||this.get("displayExpired")?(this.bonusWorldFinishTime=o,this.set("timeout",!0),this.configure(!0,e),n(!0)):n(!1);else{if(this.get("closeForNew"))return void n(!1);this.configure(!1,e),n(!0)}else 0<a||this.get("endDate")&&0<this.get("endDate").getTime()/1e3-application.getCurrentServerTime()?(this.bonusWorldFinishTime=o,this.runBonusWorldTimer(),this.set("finished",!0),this.get("allowAfterWin")&&this.configure(!0,e),n(this.get("allowAfterWin"))):this.get("closeForNew")||!this.get("allowProlong")?n(!1):(-1===i&&this.get("allowAfterWin")&&this.get("allowAfterWinAndTimeout")?(this.bonusWorldFinishTime=o,this.set("timeout",!1)):(this.bonusWorldFinishTime=o,this.set("timeout",!0)),this.configure(!0,e),n(!0))},this),function(){n(!1)},{worldName:this.get("name"),bonusWorldVersion:this.get("version")})},isAvailability:function(){return!!this.isAvailableByBeginDate()&&!!application.isAvailability(this.get("availability"))},isAvailableByBeginDate:function(){if(this.get("beginDate")){var e=application.getCurrentServerTime()||Date.now()/1e3;return this.get("beginDate").getTime()/1e3<e}return!0},isAvailableByComponents:function(){return!this._components.any(function(e){return!!e.isAvailabilityEnter&&!e.isAvailabilityEnter()})},onEnterCheckFunction:function(e){this.get("timeout")?this.showTimeoutWindow():!this.bonusWorldFinishTime&&this.get("closeForNew")||this.isAvailableByBeginDate()&&this.isAvailableByComponents()&&(user.getRealLevel()<(this.get("minEpisodeToEnter")-1)*Config.levelsInEpisode+this.get("minLevelToEnter")?new BonusWorldNotAvailableWindow({bonusWorld:this}):e())},showTimeoutWindow:function(){var e=this.getComponent("prolongate");e&&e.show()},checkColor:function(e){return"W"===e},getProlongPrice:function(){return 500},hasLives:function(){if(this.checkUnlimitedLives())return!0;var e=this.get("livesInstance");return!!e&&Boolean(e.get("lives"))},prolongate:function(){var i=this;return this.get("prolongMaxTimes")&&this.set("prolongTimes",this.get("prolongTimes")+1),new Promise(function(e,t){i.setFinishTime(i.get("prolongDuration"),e)})},setFinishTime:function(e,t){this.bonusWorldFinishTime=application.getCurrentServerTime()+e,this.runBonusWorldTimer(),0<this.bonusWorldFinishTime&&this.set("timeout",!1),callService("../../../levelbase/src/services/setbonusworldfinishtime.php",function(){t&&t()},_.noop,{finishTime:this.bonusWorldFinishTime,worldName:this.get("name"),bonusWorldVersion:this.get("version")})},episodeChanged:function(){episode.get("num")!==this.get("name")||0!==episode.scores.length||this.get("withoutInnerWindow")||Config.bonusWorld.withoutInnerWindow||window.mobile||this.openNewEpisodeWindow(),this.get("withFriends")&&this.loadFriendsData()},openNewEpisodeWindow:function(){new NewEpisodeWindow},onEpisode:_.noop,onAvailableCheckComplete:_.noop,loadFriendsData:function(){for(var o=this.get("name"),t=_.after(this.get("levelsInEpisode"),function(){application.friendsView.renderFriends()}),e=function(i){return function(e){new Results(e).each(function(e){var t=friends.find({id:e.get("id")});t&&(t.get("bonusWorldLevel")<i||t.get("bonusWorldName")!==o)&&t.set({bonusWorldName:o,bonusWorldLevel:i})}),t()}},i=1;i<=this.get("levelsInEpisode");i++){var a=e(i<this.get("levelsInEpisode")?i+1:i);application.levelResultsCache.get(o+"_"+i,a)}},levelCheckAvailable:function(e,t){if(this.get("playOnlyCurrentLevel")&&this.get("progress")!==e)return!1;if(this.get("withFriends")){if(this.levelLaunchStarted)return!1;if(e==this.get("levelsInEpisode")){if(friends.where({bonusWorldLevel:e}).length<3)return new BonusWorldMoreFriendsWindow({bonusWorld:this.get("name")}),!1;var i=$("<div>").addClass("allButtonsBlock");i.width($(".wrapper").width()),i.height($(".wrapper").height()),i.css({position:"absolute","z-index":9e3}),i.appendTo($(".wrapper")),$("#main").addClass("toLastLevel"),this.levelLaunchStarted=!0;var o=this;return _.delay(function(){i.remove(),t(e),o.levelLaunchStarted=!1,_.delay(function(){$("#main").removeClass("toLastLevel")},3e3)},this.get("lastLevelUnlockDuration")),!0}}return this.get("lastLevelBlocked")&&e===this.get("levelsInEpisode")&&!this.get("lastLevelOpen")?(new BonusWorldLastLevelWindow,!1):e<=this.getCurrentLevel()&&e<=this.get("levelsInEpisode")&&(t(e),!0)},getFriendsOnLastLevel:function(){return _.pluck(_.pluck(_.take(friends.where({bonusWorldLevel:Config.bonusWorld.get("levelsInEpisode")}),3),"attributes"),"id")},checkStars:function(){var e=_.reduce(episode.scores.pluck("stars"),function(e,t){return e+t},0),t=this.get("levelsInEpisode");this.set("lastLevelOpen",e>=this.get("lastLevelStarsNeeded")),this.$stars.find(".actualStars").html(e),this.get("lastLevelOpen")&&!this.previous("lastLevelOpen")&&("main"==application.get("page")?new BonusWorldLastLevelWindow({opened:!0,action:_.bind(this.levelCheckAvailable,this,t,_.bind(gameView.start,gameView))}):application.once("change:page",_.bind(function(){new BonusWorldLastLevelWindow({opened:!0,action:_.bind(this.levelCheckAvailable,this,t,_.bind(gameView.start,gameView))})},this))),episodeView.$el.toggleClass("lastLevelOpen",this.get("lastLevelOpen"))},isFinished:function(){return this.getCurrentLevel()==episode.levelsInEpisode()},isSatellite:function(){return!!this.get("masterWorld")},isMaster:function(){return!this.get("masterWorld")},getCurrentLevel:function(){var e=this.getComponent(this.get("progressComponent"));return e?e.getCurrentLevel():0},isReplay:function(){return application.level.num!=this.getCurrentLevel()},showHelpWindow:function(){setCookie(this.get("name")+"showedHelpWindow",1,new Date((new Date).getTime()+216e5).toUTCString()),new BonusWorldHelpWindow({world:this,prize:new UserPrizes(this.get("helpWindowPrize"))})},prepareNotifies:function(){this._components.on("change:notify",_.bind(this.checkAllNotifies,this)),this.listenTo(user,"change:level",this.checkAllNotifies),this.checkAllNotifies()},checkAllNotifies:function(){var e=!1;if(user.getRealLevel()<this.get("minRealLevelToEnter")||this.isFinished())this.set("notify",e);else{for(var t=0;t<this._components.length;t++){var i=this._components.at(t);if(i&&i.get("notify")){e=!0;break}}!this.bonusWorldFinishTime&&user.getRealLevel()>=this.get("minRealLevelToEnter")&&(e=!0),this.set("notify",e)}},needShowHelpWindow:function(){return!!this.get("helpWindow")&&(!!this.get("active")&&(!this.isOnFinalLocation()&&(user.getCurrentLevel()<42?void 0:!(this.get("progress")>this.get("levelsInEpisode")&&!this.isMaster()&&!this.getComponent(RandomLevelComponent))&&(!(this.get("progress")<=5)&&(!this.get("visited")&&(!this.get("finished")&&(5<=this.get("gameCountForHelpWindow")&&(!this.checkUnlimitedLives()&&!getCookie(this.get("name")+this.get("version")+"showedHelpWindow")))))))))},runRandomLevel:function(){var e=this,t=this.getComponent(RandomLevelComponent).getLevel();return this.emit("beforePlayLevel"+t).then(function(){user.skipLevelForceOnce=!0,episode.launchLevel(t,{showStatistics:!1,replayBonusLevel:!0,noArtifactPart:e.get("noArtifactPartOnReplay")})})},startNextLevel:function(){this.get("actionQueue").canAction()&&!this.get("actionQueue").isActive(StoryForceElement)&&this.questController||(this.get("progress")<=this.get("levelsInEpisode")?this.playCurrentLevel():this.runRandomLevel())},addConverter:function(e,t,i){this._converters[e]={setter:t,getter:i}},getRandomWorldLevelNum:function(){return _.random(1,Math.min(this.getCurrentLevel(),this.get("levelsInEpisode")))},saveSelectedOptions:function(e){var t=this.pick(e);for(var i in t)this._converters[i]&&(t[i]=this._converters[i].setter(t[i]));return _.isEmpty(t)?Promise.resolve():service("../../../levelbase/src/services/updateselectedworlddata.php",{worldName:this.get("name"),selectedOptions:JSON.stringify(t)})},isIntegrationEvent:function(){return"vkontakte"==network},reset:function(){var e=this;return Promise.resolve().then(function(){return service(controls.actions.servicePath,{method:"resetBonusWorld",bonusWorld:e.get("name")})}).then(function(){return Promise.all(e._components.map(function(e){return e.reset?e.reset():Promise.resolve()}))}).then(function(){setLocalStorage(e.get("name")+"BonusWorldForceShown",!1),setLocalStorage(e.get("name")+"ProlongTimes",0),setLocalStorage(e.get("name")+"_timeoutShown",0)})},isClosingSoon:function(){return this.get("endDate")&&new Date(1e3*application.getCurrentServerTime())>DateUtil.addDays(this.get("endDate"),-this.get("daysBeforeClose"))||!1},getPageName:function(){return"main"},getName:function(){return this.get("name")},waitPage:function(e){return application.waitPageAndEpisode(e,this.get("name"))},getTimer:function(){return this.getTimeLeft()},getFinishTime:function(){return 1e3*this.bonusWorldFinishTime},isOnFinalLocation:function(){return this.get("location").toString()===this.get("finalLocation").toString()},canShowInfo:function(){return!(this.getCurrentLevel()>this.get("levelsInEpisode")&&!this.hasComponent(RandomLevelComponent))},showEnterForce:function(){this.trigger("beforeShowForce",this),window.mobile?user.getRealLevel()>=this.get("minRealLevelToEnter")&&"menuMain"===application.get("subPage")&&new BonusWorldForceWindow({world:this}):this.get("intro")?user.getRealLevel()>=this.get("minRealLevelToEnter")&&new BonusWorldForceWindow({world:this}):new BonusWorldForce({world:this})},getArtifactPartsPrefix:function(){return this.hasComponent("parts")?this.cmp("parts").getPrefix():this.get("name")},onClosingSoon:function(){this.set("closeForNew",!0)},startBonusWorld:function(){this.bonusWorldFinishTime=application.getCurrentServerTime()+24*this.get("durationDays")*60*60,this.get("endTime")&&(this.bonusWorldFinishTime=Math.min(this.get("endTime").getTime()/1e3,this.bonusWorldFinishTime)),callService("../../../levelbase/src/services/setbonusworldfinishtime.php",_.noop,_.noop,{finishTime:this.bonusWorldFinishTime,worldName:this.get("name"),bonusWorldVersion:this.get("version")}),this.runBonusWorldTimer()}}),Svd;BonusWorld.prototype.getTimeLeft=function(){return this.bonusWorldFinishTime-application.getCurrentServerTime()},BonusWorld.prototype.renderChests=function(){var e=_.findWhere(this.get("prizes"),{type:"finalPrize"}),t=(this.get("prizes")||[]).filter(function(e){return"middlePrize"===e.type}),i=$(".invisible .bonusWorldChest"),o=this.get("chestsInProgressBar")?$("#map .mPrizeControllerOuterProgressBar .bonusWorldPrizes"):$("#map .scrolledBlock .bonusWorldPrizes"),a=$(".mainTemplates .clouds").clone();if(o.empty(),t)for(var n=0;n<t.length;n++){var r=t[n],s=i.clone();s.addClass("bonusWorldPrize"),s.addClass("prize"+(n+1)),s.addClass("level"+r.level),s.addClass("prizes"+r.prize.length),o.append(s)}if(e){var l=i.clone();l.addClass("bonusWorldPrize"),l.addClass("prizeFinal"),l.addClass("level"+e.level),l.addClass("prizes"+e.prize.length),o.append(l)}o.append(a),this.trigger("updateClouds")},BonusWorld.prototype.renderPrizeBlock=function(){$("#map .bonusWorldPrizeBlock.final").html("");var e=_.findWhere(this.get("prizes"),{type:"finalPrize"}),t=(this.get("prizes")||[]).filter(function(e){return"middlePrize"===e.type}),n=this;if(t&&t.forEach(function(e){var t=$("#map .bonusWorldPrize.level"+e.level),i=t.find(".bonusWorldPrizeBlock");i.empty();var o=messages[n.get("name")+"LevelPrizeHint"];if(e.level&&o){var a=$('<div class="prizeHint"></div>');a.html(o.replace("%(level)s",e.level)),i.append(a)}new UserPrizesView({el:i,model:new UserPrizes(e.prize),isGroup:!0,elementClassName:"bonusWorldPrize",dontClearContainer:!0}),setTimeout(function(){t.toggleClass("opened",e.level<n.getCurrentLevel())},1)}),e){var i=$("#map .bonusWorldPrize.prizeFinal"),o=i.find(".bonusWorldPrizeBlock");o.empty();var a=messages[n.get("name")+"LevelPrizeHint"];if(e.level&&a){var r=$('<div class="prizeHint"></div>');r.html(a.replace("%(level)s",e.level)),o.append(r)}new UserPrizesView({el:o,model:new UserPrizes(e.prize),isGroup:!0,elementClassName:"bonusWorldPrize",dontClearContainer:!0}),setTimeout(function(){i.toggleClass("opened",n.getCurrentLevel()>n.get("levelsInEpisode"))},1)}},BonusWorld.prototype.onEnterBonusWorld=(Svd=BonusWorld.prototype.onEnterBonusWorld,function(){this.renderChests(),this.renderPrizeBlock(),Svd.call(this)});var BonusWorldForce=BaseForce.extend({defaults:{view:BonusWorldForceView,needPage:"main",world:"",name:"",addCssClass:"forceBlackout",addZIndex:!0,additionalHeight:10,eventFunctionActivator:function(){user.on("bonusWorldAvailable",this.startEvent,this)}},initialize:function(e){e.world&&this.set("name",e.world.get("name")+"WorldForce"),BaseForce.prototype.initialize.call(this,e)},needShow:function(){return getLocalStorage(this.get("world").get("name")+"BonusWorldForceShown")!==this.get("world").get("version")},done:function(){setLocalStorage(this.get("world").get("name")+"BonusWorldForceShown",this.get("world").get("version")),application.trigger("shownForces",this)},getEl:function(){return $("#bonusworldListButton")},waitForceTime:function(){return application.get("waitWindowLoading")?new Promise(function(e){application.once("change:waitWindowLoading",function(){e()})}):Promise.resolve()},eventFunction:function(){this.get("eventFunctionActivator").call(this)},startEvent:function(e,t){var i=this;this.waitForceTime().then(function(){t&&!1!==t&&e.getCurrentLevel()>=i.get("world").get("minRealLevelToEnter")&&setTimeout(_.bind(function(){this.trigger("event")},i),1e3)})}}),fwd,gwd;figureRulesProcess.valentinesdayBonusWorldClasses=function(){FigureRules.add(".episode_ValentinesDay .cell.color_R",{"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/ValentinesDay/heartRed.png","background-position-x":0}),FigureRules.add(".episode_ValentinesDay .fish.fishcellBg",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/ValentinesDay/fish.png"}),FigureRules.add(".episode_ValentinesDay .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/ValentinesDay/flower1.png"}),FigureRules.add(".episode_ValentinesDay .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/ValentinesDay/flower2.png"}),FigureRules.add(".episode_ValentinesDay .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/ValentinesDay/flower3.png"}),FigureRules.add(".episode_ValentinesDay .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/ValentinesDay/flower4.png"})},figureRulesProcess.additionalBonusClasses=(fwd=figureRulesProcess.additionalBonusClasses,function(){fwd.call(this),figureRulesProcess.valentinesdayBonusWorldClasses()}),BonusWorld.prototype.defaults.version=1,BonusWorld.prototype.checkAvailability=(gwd=BonusWorld.prototype.checkAvailability,function(e){return"phonegap"===network&&this.networks&&-1===this.networks.indexOf(phonegapNetwork)?e(!1):void 0===this.get("production")||this.get("production")?void gwd.call(this,e):e(!1)}),Config.bonusWorlds=[],Config.bonusWorlds.getByName=function(t){return _.find(this,function(e){return e.get("name")===t})};var StoryController=BonusWorldComponent.extend({defaults:_.defaults({id:"story",name:"",init:!1,needShowComicButton:!1,hasActivatedStory:!1},BonusWorldComponent.prototype.defaults),initialize:function(e){var t=this;this.actionQueue=e.actionQueue;var i=0;this.set("stories",new Backbone.Collection(e.stories.map(function(e){return e.id||(e.id=++i),e.owner||(e.owner=t.world),e.world=t.world,t.createStory(e)}))),this.listenToOnce(this.world,"configure",this.init),this._activatedStoryCount=0},pushToQueue:function(e){var t=this;return Game&&Game.cancelNext(),this._increaseActivatedStories(),this.actionQueue.push(e,e.get("priority")||ActionQueue.Priority.normal).then(function(){t._decreaseActivatedStories()})},init:function(e,t){var i=this;return Promise.resolve().then(function(){i.get("stories").each(function(e){e.init()}),i.listenTo(i.get("stories"),"wakeup",i.pushToQueue),i.listenTo(i.get("stories"),"change:status",_.debounce(i._save.bind(i),100)),i.trigger("configured")})},createStory:function(e){var t=new e.type(e,{controller:this});return e.once?t.activator=new OnceEventActivatorStoryElement({noRetry:t.get("noRetry"),story:t,world:this.world,page:e.page||this.world.getPageName(),event:e.once,owner:e.owner||this.world}):e.on&&(t.activator=new EventActivatorStoryElement({story:t,noRetry:t.get("noRetry"),world:this.world,page:e.page||this.world.getPageName(),event:e.on,owner:e.owner||this.world})),t},preload:function(){var e=this.get("name"),i=this.get("stories");return service("../../../gems/site/service/stories/loadstories.php",{prefix:e}).then(function(e){e&&e.forEach(function(e){var t=i.get(e.storyId);t&&t.set("status",parseInt(e.status))})})},_save:function(){var e=this.get("name"),t=this.get("stories").filter(function(e){return e.get("status")!==StoryStatus.pending&&e.hasChanged("status")}).map(function(e){return delete e.changed.status,{storyId:e.get("id"),status:e.get("status")}});callServiceAddInQueue("../../../gems/site/service/stories/savestories.php",{prefix:e,data:JSON.stringify(t)})},destroy:function(){this.stopListening(),this.off(),this.get("stories").invoke("destroy"),this.get("stories").reset(),this.attributes={}},showComic:function(){new ComicWindow({model:this})},_increaseActivatedStories:function(){++this._activatedStoryCount,this.set("hasActivatedStory",this.hasActivatedStory())},_decreaseActivatedStories:function(){--this._activatedStoryCount,this.set("hasActivatedStory",this.hasActivatedStory())},hasActivatedStory:function(){return 0<this._activatedStoryCount},getStoryById:function(e){return this.get("stories").find({id:e})},reset:function(){var e=this;return BonusWorldComponent.prototype.reset.call(this).then(function(){return Promise.all(e.get("stories").map(function(e){return e.reset()}))})}}),StoryStatus={pending:0,activated:1,complete:2},BaseStoryElement=Backbone.Model.extend({defaults:{status:null,delay:0,delayAfter:0},initialize:function(e,t){this.set("status",t.status||StoryStatus.pending),this.set("controller",t.controller)},destroy:function(){this.activator&&this.activator.destroy(),this.stopListening(),this.off(),this.attributes={}},isAvailable:function(){return!(this.has("isAvailable")&&!this.get("isAvailable").apply(this,arguments))},init:function(){return this.activator?this.activator.init():Promise.resolve()},run:function(){var e=this;return $("#container,#mainAppWrapper").addClass("runningStory"),Promise.resolve().then(function(){return delay(e.get("delay"))}).then(function(){return e.onActivate()}).then(function(){return delay(e.get("delayAfter"))}).then(function(){$("#container,#mainAppWrapper").removeClass("runningStory")})},activate:function(){return this.emit("wakeup",this)},onActivate:function(){return this.get("soundId")&&application.playSound(this.get("soundId")),Promise.resolve()},reset:function(){this.set("status",StoryStatus.pending),this.activator&&this.activator.reset()}}),EventActivatorStoryElement=Backbone.Model.extend({init:function(){this.listenTo(this.get("owner"),this.get("event"),this._onEventHandler)},destroy:function(){this.stopListening(),this.off(),this.get("story").activator=null,this.attributes={}},_onEventHandler:function(){var e=[].slice.call(arguments);if(this.get("story").isAvailable.apply(this.get("story"),e))return this.activate(e)},activate:function(){var t=this;return Game&&Game.cancelNext(),new Promise(function(e){application.waitPage(t.get("page")).then(function(){t.get("story").activate().then(e)})})},reset:function(){this.stopListening(this.get("owner")),this.listenTo(this.get("owner"),this.get("event"),this._onEventHandler)}}),OnceEventActivatorStoryElement=EventActivatorStoryElement.extend({defaults:{noRetry:!1},initialize:function(){EventActivatorStoryElement.prototype.initialize.call(this),this.get("story").set("status",StoryStatus.pending)},init:function(){switch(this.get("story").get("status")){case StoryStatus.pending:return EventActivatorStoryElement.prototype.init.call(this);case StoryStatus.activated:if(this.get("noRetry"))return Promise.resolve();this.listenTo(this.get("world"),"enter",this.activate);default:return Promise.resolve()}},_onEventHandler:function(){var e=[].slice.call(arguments);if(this.get("story").isAvailable.apply(this.get("story"),e)){if(this.stopListening(this.get("owner"),this.get("event"),this._onEventHandler),this._activated)return;this._activated=!0}return EventActivatorStoryElement.prototype._onEventHandler.apply(this,arguments)},activate:function(){var e=this;return this.get("story").set("status",StoryStatus.activated),EventActivatorStoryElement.prototype.activate.call(this).then(function(){e.get("story").set("status",StoryStatus.complete),e.destroy()})},reset:function(){EventActivatorStoryElement.prototype.reset.call(this),this._activated=!1,this.stopListening(this.get("world"),"enter",this.activate)}}),BaseEventStoryElement=BaseStoryElement.extend({defaults:_.defaults({delay:0,delayAfter:750,noRetry:!1,updateAlways:!1},BaseStoryElement.prototype.defaults),init:function(){BaseStoryElement.prototype.init.call(this),this.get("updateAlways")&&this.get("owner").on("enter",this.updateState,this),this.updateState()},updateState:function(){}}),BaseStoryWindowElement=BaseEventStoryElement.extend({defaults:_.defaults({window:null,params:null},BaseEventStoryElement.prototype.defaults),getParams:function(){return this.get("params")||{}},onActivate:function(){var a=this;return BaseEventStoryElement.prototype.onActivate.call(this).then(function(){return new Promise(function(e,t){try{var i=a.get("window"),o={onClose:e,owner:a.get("owner")};a.has("params")&&_.assign(o,a.get("params")),new i(o)}catch(e){console.error(e),t(e)}})})}}),StoryWindowElement=BaseStoryWindowElement.extend({}),ComicWindow=TWindow.extend({templateClass:".comicWindow_template",events:{"click .close":"close"}}),ComicButtonView=Backbone.View.extend({events:{click:"open"},initialize:function(){this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active"))},open:function(){this.model.showComic()}}),StoryTalkWindow=TWindow.extend({templateClass:".specialWorldTalkWindow_template",events:{},onOpenSound:!1,onOpen:function(){var o=this;TWindow.prototype.onOpen.call(this),this._shownSpines=[],this._skipBind=this.skip.bind(this),$("body").on("mouseup touchend",this._skipBind),this.options.selector?this.$el.addClass(this.options.selector):episode&&this.$el.addClass("episode_"+episode.get("num")),this.$el.addClass("group"+this.options.id),$("#map").addClass("group"+this.options.id),this.options.dialog.reduce(function(e,t,i){return e.then(function(){return o.showTalk(t,i)})},Promise.resolve()).catch(function(e){console.error(e)}).then(function(){return o.close()})},onClose:function(){TWindow.prototype.onClose.call(this),$("body").off("mouseup touchend",this._skipBind),$("#map").removeClass("group"+this.options.id),application.playSound("falldown");var e,t=_createForOfIteratorHelper(this._shownSpines);try{for(t.s();!(e=t.n()).done;){removeSpine(e.value)}}catch(e){t.e(e)}finally{t.f()}},skip:function(){this._skip&&this._skip()},showTalk:function(e,t){var a,l=this,n=this.options.characters||messages[this.options.owner.get("name")+"Characters"],i=[this.$(".mCharactersLeft"),this.$(".mCharactersRight")],o=e.indexOf(":"),r=e.substr(0,o),s=e.substr(o+1),d=-1!==r.indexOf(">"),c=-1!==r.indexOf("<");d||c?a=r.split(d?">":"<").map(function(e){return e.split(",")}):(d=!0,a=[r.split(",")||r,[]]),i.forEach(function(e,t){var s=e.find(".character");s.removeClass().addClass("character").addClass(a[t].join(" ")),s.find(".name").html(n[a[t][0]]||""),s.removeClass("numOfCharacters1 numOfCharacters2 numOfCharacters3"),s.addClass("numOfCharacters"+a[t].length);for(var i=a[t].length+1;i<3;i++){var o=s.find(0<i?".image"+i:".image");l.clearDisabledSpine(o)}a[t].forEach(function(e,t){var i=l.getSpineData(e),o=e;if((l.options.owner.world||l.options.owner).get("hasBattlePass")){var a=l.getSpineData(e+"battlepass");a&&(i=a,o=e+"battlepass")}var n=0===t?"image":"image"+(t+1),r=s.find("."+n);r.removeClass().addClass(n),r.addClass(e),l.clearDisabledSpine(r,o),i?l.renderSpine(r,i,o):r.addClass("sprite")})}),this.$(".mCharactersLeft").toggleClass("active",d),this.$(".mCharactersRight").toggleClass("active",c);var g=this.options.owner;return g&&g.get("sounds")&&(this.soundId=d?g.get("sounds")[a[0][0]]:g.get("sounds")[a[1][0]],soundManager.hasSound(this.soundId)&&application.playSound(this.soundId)),this.$el.addClass("id"+t),$("#map").addClass("group"+this.options.id).addClass("id"+t),this.animateText(s).then(function(){return new Promise(function(e){l._skip=e})}).then(function(){l.$el.removeClass("id"+t),$("#map").removeClass("id"+t)})},animateText:function(e){var i=this;this.$(".content").html("");var o="",a=40;return this._skip=function(){a=1},e.split("").reduce(function(e,t){return e.then(function(){return o+=t,i.$(".content").html(o),delay(a)})},Promise.resolve())},getSpineData:function(t){return this.options.spines?this.options.spines.find(function(e){return-1!==e.characters.map(function(e){return e.name}).indexOf(t)}):null},clearDisabledSpine:function(t,e){var i=this._shownSpines.find(function(e){return e.canvas===t.find(".spine").get(0)});if(i){var o=e&&this.getSpineData(e);o&&o.characters.find(function(e){return e.name===i.character})||(removeSpine(i),this._shownSpines.splice(this._shownSpines.indexOf(i),1))}},runSpine:function(t){var i=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(t&&t.skeleton&&t.state){var o=t.characterProps;if(!e&&(clearTimeout(t.repeatTimeOut),t.state.clearTracks(),t.skeleton.setToSetupPose(),o.otherTracks)){var a,n=_createForOfIteratorHelper(o.otherTracks);try{for(n.s();!(a=n.n()).done;){var r=a.value;t.state.setAnimation(r.index,r.name,r.repeat||!1)}}catch(e){n.e(e)}finally{n.f()}}if(o.skin&&t.skeleton.setSkinByName(o.skin),o.idle){var s=0;if(e?(s=t.state.tracks[0].animationEnd||0,t.state.addAnimation(0,o.idle,!0,s)):t.state.setAnimation(0,o.idle,!0),o.randomRepeat){var l=o.randomRepeat.range;t.repeatTimeOut=setTimeout(function(){var e=[].concat(o.randomRepeat.action);t.state.addAnimation(0,e[Math.floor(Math.random()*e.length)],!1,0),i.runSpine(t,!0)},1e3*(l[0]+Math.random()*(l[1]-l[0])+s))}}}},renderSpine:function(t,i,o){var e=this._shownSpines.find(function(e){return e.canvas===t.find(".spine").get(0)}),a=i.characters.find(function(e){return e.name===o});if(e)e.character=o,e.characterProps=a,this.runSpine(e),t.addClass("spine");else{var n=i.img,r=this;(e=new spine.SpineWidget(t.get(0),{x:i.offset.x,y:i.offset.y,addX:void 0,addY:void 0,scale:i.scale,loop:!1,fitToCanvas:!1,alpha:!0,premultipliedAlpha:!1,backgroundColor:"#00000000",atlas:i.atlas,json:i.json,atlasPages:[n.substring(n.lastIndexOf("/")+1)],textureFileName:n.substring(n.lastIndexOf("/")+1),animation:a.idle,skin:a.skin,error:function(e){console.log("[SPINE_DIALOG]      "+o+"  !",e),t.removeClass("spine").addClass("sprite")},success:function(e){r.runSpine(e),t.addClass("spine"),i.reflect&&(e.skeleton.flipX=!0)}})).canvas.classList.add("spine",o),e.character=o,e.characterProps=a,this._shownSpines.push(e)}}}),StoryTalkElement=BaseStoryWindowElement.extend({defaults:_.defaults({window:StoryTalkWindow},BaseStoryWindowElement.prototype.defaults),onActivate:function(){var i,o=this.get("owner"),a=this.get("world"),n=_.isArray(this.get("talkKey"))?RANDOM(this.get("talkKey")):this.get("talkKey"),e=a.get("name")+"Talk"+n,r=this.get("window"),s=this.get("line")||0,l=this.get("urgent"),d=this.get("selector");return messages[e+"battlePass"]&&a.get("hasBattlePass")&&(e+="battlePass"),this.get("postfix")&&a.get(this.get("postfix"))&&messages[e+a.get(this.get("postfix"))]&&(e+=a.get(this.get("postfix"))),i=messages[e],BaseStoryElement.prototype.onActivate.call(this).then(function(){return new Promise(function(e,t){try{new r({urgent:l,onClose:e,dialog:i,owner:o,characters:messages[a.get("name")+"Characters"],spines:a.get("spines"),id:n||0,line:s,selector:d})}catch(e){console.error(e),t(e)}})})}}),StoryDailyTalkElement=StoryTalkElement.extend({run:function(){var e=this;return StoryTalkElement.prototype.run.call(this).then(function(){setLocalStorage("talk"+e.get("id")+"shown",Date.now())})},isAvailable:function(){return 1<this.get("owner").getCurrentLevel()&&this.get("owner").getCurrentLevel()<this.get("owner").levelsInEpisode&&this.checkTime()},onActivate:function(){if(this.get("random")){var n,r=this,e=this.get("owner").get("name")+"Talk"+this.get("id");return messages[e+"battlePass"]&&this.owner.get("hasBattlePass")&&(e+="battlePass"),n=messages[e],new Promise(function(e,t){var i=r.get("window"),o=r.get("id")||0,a=r.get("line")||0;new i({onClose:e,dialog:RANDOM(n),owner:r.get("owner"),id:o,line:a})})}return StoryTalkElement.prototype.onActivate.call(this)},checkTime:function(){var e=getLocalStorage("talk"+this.get("id")+"shown",0);return 0===e||864e5<Date.now()-e}}),StoryForceElement=BaseEventStoryElement.extend({defaults:_.defaults({view:null,page:"main",inWorld:!0,window:null,noRetry:!0,buttonEl:null},BaseEventStoryElement.prototype.defaults),isAvailable:function(){var e=!window.mobile;return this.has("isAvailable")&&_.isFunction(this.get("isAvailable"))&&(e=this.get("isAvailable").apply(this,arguments)),e},onActivate:function(){var t=this,i=this;return Promise.resolve().then(function(){return t.get("inWorld")?application.waitPageAndEpisode(t.get("page"),t.get("controller").world.get("name")):application.waitPage(t.get("page"))}).then(function(){if(i.get("window"))return application.windows.waitWindow(i.get("window"))}).then(function(){if(t.get("init"))return Promise.resolve().then(function(){return t.get("init")()}).then(function(e){t.set(e)})}).then(function(){if(i.get("scrollTo")){var e=i.get("scrollTo");if(_.isFunction(e)&&(e=e(this)),_.isString(e)&&(e=$(e)),e&&e.length)return i._scrollTo(e)}}).then(function(){return i.showForce()})},showForce:function(){var a=this;return BaseStoryElement.prototype.onActivate.call(this).then(function(){return $("#container,#mainAppWrapper").removeClass("runningStory"),new Promise(function(t){var i=a.getEl();!function e(){if(!(i&&i.length&&i.is(":visible")))return setTimeout(e,100);t()}()})}).then(function(){return new Promise(function(e,t){try{var i=a.get("view");i||(i=a.get("window")?SpecialWorldForceView:BaseForceView);var o=a.getEl();if(!(o&&o.length&&o.is(":visible")))return void e();a.done=e,new i({el:o,model:a,scrollEl:a.get("scrollEl"),buttonEl:a.get("buttonEl"),highlightedElements:a.getHighlightedElements(),needPage:a.get("page")})}catch(e){console.error(e),t(e)}})})},getEl:function(){return _.isFunction(this.get("el"))?this.get("el")(this):$(this.get("el"))},getHighlightedElements:function(){return this.get("highlightedElements")||[]},done:function(){},_scrollTo:function(e){var t=this.get("scroller");return t?t.scrollTo(e):Promise.resolve().then(function(){return delay(100)}).then(function(){return episodeView.mapController.scrollTo(e)}).then(function(){return delay(600)})},onAfterOpen:function(){this.get("onAfterOpen")&&this.get("onAfterOpen")()}}),StoryAnimationElement=BaseEventStoryElement.extend({defaults:_.defaults({el:"#map"},BaseEventStoryElement.prototype.defaults),updateState:function(){this.get("status")===StoryStatus.complete&&(this._addPersistentClass(this.get("elements")),this._persistentClean(this.get("elements")))},onActivate:function(){var t=this;return application.waitPage("main").then(function(){if(t.get("scrollTo")){var e=t.get("scrollTo");if(_.isFunction(e)&&(e=e(t)),_.isString(e)&&(e=$(e)),e&&e.length)return t._scrollTo(e)}}).then(function(){return t.showAnimation()})},showAnimation:function(){var i=this,e=this.get("elements");return Promise.all(e.map(function(t){return delay(t.delay).then(function(e){$("#container,#mainAppWrapper").toggleClass("animating",!0),t.soundId&&application.playSound(t.soundId),t.flashClass&&i._addClass(t.el,t.flashClass),t.className&&i._addClass(t.el,t.className),t.persistentClass&&i._addClass(t.el,t.persistentClass),t.cleanClass&&i._cleanClass(t.el,t.cleanClass),t.persistentClean&&i._cleanClass(t.el,t.persistentClean)}).then(function(){return delay(t.duration)}).then(function(){t.flashClass&&i._cleanClass(t.el,t.flashClass)}).then(function(e,t){try{$("#container,#mainAppWrapper").toggleClass("animating",!1)}catch(e){console.error(e),t(e)}})}))},_addClass:function(e,t){$(this.get("el")).find(e).addClass(t)},_addPersistentClass:function(e){e.forEach(function(e){e.persistentClass&&this._addClass(e.el,e.persistentClass)},this)},_persistentClean:function(e){var t=this;e.forEach(function(e){e.persistentClean&&t._cleanClass(e.el,e.persistentClean)})},_cleanClass:function(e,t){$(this.get("el")).find(e).removeClass(t)},_scrollTo:function(e){setTimeout(function(){episodeView.mapController.scrollTo(e)},100)}}),IAd,KAd;spine.SpineWidget.prototype.load=(IAd=spine.SpineWidget.prototype.load,function(){try{IAd.call(this)}catch(e){this.config.error&&this.config.error(e)}}),spine.SpineWidget.prototype.render=(KAd=spine.SpineWidget.prototype.render,function(){try{KAd.call(this)}catch(e){this.config.error&&this.config.error(e)}});var StorySpineAnimationElement=BaseEventStoryElement.extend({defaults:_.defaults({x:0,y:0,addX:void 0,addY:void 0,scale:1,loop:!1,fitToCanvas:!1,spine:null,animation:null,removeDelay:null,timeout:1e4,el:null},BaseEventStoryElement.prototype.defaults),initSpine:function(){if(!this.promise){var i=this;this.promise=new Promise(function(e,t){try{i.reject=t,i.spine=new spine.SpineWidget($(i.get("el")).get(0),{x:i.get("x"),y:i.get("y"),addX:i.get("addX"),addY:i.get("addY"),scale:i.get("scale"),loop:i.get("loop"),fitToCanvas:i.get("fitToCanvas"),alpha:!0,premultipliedAlpha:!0,backgroundColor:"#00000000",atlas:i.get("spine").replace(".json",".atlas"),json:i.get("spine"),animation:i.get("animation"),error:function(e){i.reject&&i.reject(e)},success:function(){i.spine.pause(),e(i.spine)}})}catch(e){t(e)}})}return this.promise},onActivate:function(){var i,o=this;return this.initSpine().then(function(){return new Promise(function(e,t){o.reject=t;try{i=setTimeout(function(){t(new Error("Spine timeout animation"))},o.get("timeout")),o.spine.state.addListener({complete:e}),o.spine.play()}catch(e){t(e)}})}).catch(function(e){console.log(e),console.warn("Spine not support")}).then(function(){if(i&&clearTimeout(i),o.get("removeDelay"))return delay(o.get("removeDelay"));resolve()}).then(function(){$(o.get("el")).empty(),o.promise=null,o.spine=null})}}),StoryCallbackElement=BaseEventStoryElement.extend({onActivate:function(){var e=this;return Promise.resolve().then(function(){return BaseStoryElement.prototype.onActivate.call(e)}).then(function(){return e.get("callback")()})}}),StoryDailyWindowElement=BaseStoryWindowElement.extend({run:function(){var e=this;return BaseStoryWindowElement.prototype.run.call(this).then(function(){setLocalStorage("window"+e.get("id")+"shown",Date.now())})},isAvailable:function(){return BaseStoryWindowElement.prototype.isAvailable.call(this)&&this.get("owner").getCurrentLevel()<this.get("owner").levelsInEpisode&&this.checkTime()},checkTime:function(){var e=getLocalStorage("window"+this.get("id")+"shown",0);return 0===e||864e5<Date.now()-e}}),StoryGroup=BaseEventStoryElement.extend({defaults:_.defaults({stories:[]},BaseEventStoryElement.prototype.defaults),initialize:function(e,t){BaseEventStoryElement.prototype.initialize.call(this,e,_.defaults(e,t)),this.set("stories",e.stories.map(this.createStory,this))},destroy:function(){this.get("stories").forEach(function(e){return e.destroy()}),BaseEventStoryElement.prototype.destroy.call(this)},onActivate:function(){var e=this;return BaseEventStoryElement.prototype.onActivate.call(this).then(function(){return e.get("stories").reduce(function(e,t){return e.then(function(){return t.isAvailable()?t.run():Promise.resolve()})},Promise.resolve())})},createStory:function(e){return new e.type(e,_.defaults(e,{controller:this.get("controller"),world:this.get("world")}))}}),BaseCause=Backbone.Model.extend({init:function(e){this.component=e,this.world=e.world},deactivate:function(){},restart:function(){this.set("activated",!1)},onCause:function(){var e=this;return this.get("activated")?Promise.resolve():(this.set("activated",!0),this.emit("changeover",this).then(function(){return e.world.emit(e.get("id")+"Cause",e.world)}))}}),CompletePrizesCause=BaseCause.extend({defaults:{id:"completePrize"},init:function(e){BaseCause.prototype.init.call(this,e),this.world.on("allPrizesCollected",this.onCause,this)},deactivate:function(){BaseCause.prototype.deactivate.call(this),this.world.off("allPrizesCollected",this.onCause,this)}}),ActivationCondition=Backbone.Model.extend({init:function(e){var t=this;this.world=e.world,this.prizeController=e.world.getComponent(PrizeController),this.check()?this.trigger("change"):(this.world.on("change:location",function(){return t.trigger("change")}),this.prizeController.on("change:progress",function(){return t.trigger("change")}))},check:function(){return this.world.get("location")>=this.get("minLocation")||this.prizeController.getProgress()>=this.get("minProgress")},deactivate:function(){var e=this;this.world.off("change:location",function(){return e.trigger("change")}),this.prizeController.off("change:progress",function(){return e.trigger("change")})}}),TimeoutCause=BaseCause.extend({defaults:{id:"timeout"},init:function(e){BaseCause.prototype.init.call(this,e),this.checkTimeout();var t,i=_createForOfIteratorHelper(this.get("conditions"));try{for(i.s();!(t=i.n()).done;){var o=t.value;o.on("change",this.checkActivate,this),o.init(this)}}catch(e){i.e(e)}finally{i.f()}},isActivate:function(){var e,t=_createForOfIteratorHelper(this.get("conditions"));try{for(t.s();!(e=t.n()).done;){if(!e.value.check())return!1}}catch(e){t.e(e)}finally{t.f()}return!0},checkActivate:function(){this.isActivate()&&(this.isActive()?this.startTimeout():this.activate())},isActive:function(){return this.world.get("changeoverDate")},activate:function(){this.setTimer(this.get("time"))},deactivate:function(){BaseCause.prototype.deactivate.call(this),this.interval&&clearInterval(this.interval);var e,t=_createForOfIteratorHelper(this.get("conditions"));try{for(t.s();!(e=t.n()).done;){var i=e.value;i.deactivate(),i.off("change",this.checkActivate,this)}}catch(e){t.e(e)}finally{t.f()}},checkTimeout:function(){0<this.getTimer()?this.startTimeout():this.world.get("changeoverDate")&&this.onCause()},startTimeout:function(){var e=this,t=this.getTimer();clearTimeout(this.timeout),0<t&&(this.timeout=setTimeout(function(){return e.checkTimeout()},1e3*t+1))},setTimer:function(e){var t=application.getCurrentServerTime();this.world.set("changeoverDate",new Date(1e3*(t+duration(e)))),this.world.saveSelectedOptions(["changeoverDate"]),this.startTimeout()},getTimer:function(){if(!this.world.get("changeoverDate"))return 0;var e=application.getCurrentServerTime(),t=Math.round(this.world.get("changeoverDate").getTime()/1e3);return Math.max(0,t-e)},restart:function(){BaseCause.prototype.restart.call(this),this.isActivate()?this.activate():this.stop()},stop:function(){this.world.set("changeoverDate",null),this.world.saveSelectedOptions(["changeoverDate"]),clearTimeout(this.timeout)},onCause:function(){var e=this;return this.get("activated")?Promise.resolve():(this.set("activated",!0),this.world.waitPage("main").then(function(){return e.world.emit(e.get("id")+"Cause",e.world)}).then(function(){return e.emit("changeover",e)}))}}),ForgeRecipeCompleteCause=BaseCause.extend({defaults:_.defaults({targetNum:5,current:0,forge:null,ignoredItems:[]},BaseCause.prototype.defaults),init:function(e){BaseCause.prototype.init.call(this,e),console.assert(this.get("forge"),"Please pass the component to listen to"),this.set("current",parseInt(localStorage.getItem(this._getStorageKey()))||0),this.get("forge").on("itemCrafted",this.onItemCrafted,this)},onItemCrafted:function(e){this.isValidItem(e)&&(this.updateCurrent(),this.check())},isValidItem:function(e){return!this.get("ignoredItems").includes(e.get("id"))},check:function(){this.get("current")%this.get("targetNum")==0&&this.onCause()},updateCurrent:function(){var e=this.get("current")+1;this.set("current",e),localStorage.setItem(this._getStorageKey(),e)},deactivate:function(){BaseCause.prototype.deactivate.call(this),this.get("forge").off("itemCrafted",this.onItemCrafted,this)},_getStorageKey:function(){return this.world.get("name")+"_"+this.world.get("version")+"_assembled_collections"}}),EventCause=BaseCause.extend({defaults:{owner:null,event:""},init:function(e){BaseCause.prototype.init.call(this,e),this.get("owner")||this.set("owner",this.world),this.get("owner").on(this.get("event"),this.onCause,this)},deactivate:function(){BaseCause.prototype.deactivate.call(this),this.get("owner").off(this.get("event"),this.onCause,this)}}),CompleteLevelCause=BaseCause.extend({defaults:_.defaults({targetNum:20},BaseCause.prototype.defaults),init:function(e){BaseCause.prototype.init.call(this,e),this.world.on("completeLevel",this.onCompleteLevel,this)},destroy:function(){BaseCause.prototype.destroy.call(this),this.world.off("completeLevel",this.onCompleteLevel,this)},onCompleteLevel:function(e,t){t%this.get("targetNum")==0&&this.onCause()}}),BaseEffect=Backbone.Model.extend({defaults:{subject:null},run:function(){return Promise.resolve()}}),ChangeLocationEffect=BaseEffect.extend({run:function(){var e=this,i=this.get("world"),o=this.get("world").get("location"),a=RANDOM(this.get("locations").filter(function(e){return e.condition()&&e.num!=o}));return BaseEffect.prototype.run.call(this).then(function(){return i.emit("beforeChangeLocation",e,o,a.num)}).then(function(){return i.emit("exitLocation"+o,e)}).then(function(){for(var e=$(".wrapper"),t=1;t<=10;++t)e.removeClass(i.get("name")+"_screen"+t);e.addClass(i.get("name")+"_screen"+a.num),i.set("location",a.num),i.saveSelectedOptions(["location"]),console.log("[ChangeoverComponent]  change location from ",o," to ",i.get("location"))}).then(function(){return i.emit("changeLocation",e,o,a.num)}).then(function(){return i.emit("enterLocation"+a.num,e)}).then(function(){return i.emit("afterChangeLocation",e,o,a.num)})}}),ResetPrizesEffect=BaseEffect.extend({run:function(){var e=this;return BaseEffect.prototype.run.call(this).then(function(){e.get("subject").reset()})}}),TicketsProductTakePrizeView=Backbone.View.extend({initialize:function(e){this.options=e;for(var t=$(".mainTemplates .slotMachineTakePrizeViewPrize"),i=[],o=this.options.product.get("amount")<600?9:13,a=0;a<o;a++)i.push(t.clone());this.render(i)},render:function(e){var t=this,i=this.options.product;this.options.el.addClass("ticketAnimation"),this.options.el.addClass(i.get("componentId")),e.forEach(function(e){e.addClass(i.get("cssClass")).addClass(i.get("componentId")).addClass(i.get("type")).addClass(i.get("name")),t.options.el.find(".prizes.tickets").append(e)})}}),ProductTakePrizeView=Backbone.View.extend({initialize:function(e){this.options=e;var t=$(".mainTemplates .slotMachineTakePrizeViewPrize");this.setElement(t.clone()),this.render()},render:function(){var e=this.options.product;if("PartProduct"===e.get("type"))for(var t=0;t<e.get("amount");t++){var i=this.$el.clone();i.addClass(e.get("cssClass")).addClass(e.get("componentId")).addClass(e.get("type")).addClass(e.get("name")),this.options.el.find(".prizes.products").append(i)}else this.$el.addClass(e.get("cssClass")).addClass(e.get("componentId")).addClass(e.get("type")).addClass(e.get("name")),"GiftAbilityProduct"===e.get("type")&&this.$el.addClass("target_".concat(this.getGiftAbilityTargetId())),this.options.el.find(".prizes.products").append(this.$el)},getGiftAbilityTargetId:function(){for(var e=this.options.model.cmp("trinkets").getTrinkets().toArray(),t=0;t<e.length;++t)if(null!==e[t].getAbility().get("active")&&!0!==e[t].get("ability").get("active"))return t+1;return null}}),SlotMachineTakePrizeView=Backbone.View.extend({initialize:function(e){this.options=e,this.setElement(this.options.el),this.render(this.$el)},render:function(){var e;this.$el.addClass("prizes"+this.options.products.length);var t=this.model.cmp("slotMachine").getMachine().getLastCombination().map(function(e){return"slot-"+e.getName()});(e=this.$el).addClass.apply(e,_toConsumableArray(t)),this.$el.addClass("total"+this.options.products.reduce(function(e,t){return e+t.get("amount")},0))},renderBg:function(){this.$el.find(".prizeBackground").removeClass("invisible").addClass("visible")},takePrize:function(){var t=this,e=this.options.products.filter(function(e){return"TicketsProduct"!==e.get("type")}),i=this.options.products.filter(function(e){return"TicketsProduct"===e.get("type")});0!==i.length&&i.map(function(e){new TicketsProductTakePrizeView({product:e,el:t.$el,model:t.options.model})}),0!==e.length&&this.renderBg(),e.map(function(e){new ProductTakePrizeView({product:e,el:t.$el,model:t.options.model})}),setTimeout(function(){t.$el.remove()},2e3)}}),SimpleForce=BaseForce.extend({defaults:_.defaults({view:BaseForceView,needPage:"main",name:"simpleForce",blockTargetBeforeShow:!1,canClose:function(){return!0}},BaseForce.prototype.defaults),getEl:function(){return _.isFunction(this.get("el"))?this.get("el")(this):$(this.get("el"))},eventFunction:function(){},needShow:function(){return!0},canClose:function(){return this.get("canClose")()},onAfterOpen:function(){this.get("onAfterOpen")&&this.get("onAfterOpen")()},close:function(){this.trigger("close",this)},show:function(){var t=this;return new Promise(function(e){t.done=function(){t.get("done")&&t.get("done")(),e()},t.trigger("event")})}}),BaseSlotCombination=Backbone.Model.extend({defaults:{prize:null},process:function(e){return Promise.resolve([])},getPrizeCreater:function(){return this.get("prize")},getId:function(){return this.get("id")}}),ByAmountCombination=BaseSlotCombination.extend({defaults:_.defaults({slotName:"test",targetAmount:0},BaseSlotCombination.prototype.defaults),process:function(e){var t=this,i=[],o=0;return e.forEach(function(e){e.getName()===t.get("slotName")&&(++o,i.push(e))}),o===this.get("targetAmount")?(this.markSlots(i),i):[]},markSlots:function(e){e.forEach(function(e){return e.setSelected(!0)})}}),Slot=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"test",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,i),this._name=e,this._chanceModifier=t,this._selected=!1}return _createClass(i,[{key:"getWeight",value:function(){return this._chanceModifier}},{key:"getChance",value:function(){return this._chanceModifier}},{key:"getName",value:function(){return this._name}},{key:"isSelected",value:function(){return this._selected}},{key:"setSelected",value:function(e){this._selected=e}}]),i}(),BaseSequenceStrategy=function(){function e(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(e){this._machine=e}},{key:"generateSequence",value:function(){}},{key:"getSlots",value:function(){return this._machine.getSlots()}},{key:"getLength",value:function(){return this._machine.getLines()}}]),e}(),BySlotChanceSequenceSorted=function(e){_inherits(o,BaseSequenceStrategy);var i=_createSuper(o);function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(e=i.call(this))._exeptionSlots=t.exeptionSlots||[],e}return _createClass(o,[{key:"generateSequence",value:function(){for(var t=this,e=this.getSlots(),i=[],o=this.getLength(),a=0;a<o;++a){a===o-1&&-1!==this._exeptionSlots.indexOf(i[0].getName())&&-1!==this._exeptionSlots.indexOf(i[1].getName())&&(e=this.getSlots().filter(function(e){return-1===t._exeptionSlots.indexOf(e.getName())}),i[0]===i[1]&&(e=[RANDOM(e)]).push(i[0]));var n=e[util.randomChance(e.map(function(e){return e.getChance()}))];n.position=i.length,i.push(n)}return this.sortSequence(i)}},{key:"sortSequence",value:function(e){var i={};return e.forEach(function(e){var t=e.getName();i[t]=i[t]?i[t]+1:1}),e.sort(function(e,t){return i[t.getName()]-i[e.getName()]})}}]),o}(),WeighedSequenceStrategy=function(e){_inherits(i,BaseSequenceStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"generateSequence",value:function(){var i=[],e=[];for(this.getSlots().forEach(function(e){for(var t=0;t<e.getWeight();++t)i.push(e)});e.length<this.getLength();){RANDOM(i).position=e.length,e.push(RANDOM(i))}return e}}]),i}(),PremadeSequenceStrategy=function(e){_inherits(o,BaseSequenceStrategy);var i=_createSuper(o);function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(e=i.call(this))._premadeSequence=t.premadeSequence,e}return _createClass(o,[{key:"generateSequence",value:function(){var i=this;return this._premadeSequence.map(function(t,e){return i.getSlots().find(function(e){return e.getName()===t})})}}]),o}(),LengthRundomSequenceStrategy=function(e){_inherits(o,BaseSequenceStrategy);var i=_createSuper(o);function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(e=i.call(this))._varians=t.variants,e}return _createClass(o,[{key:"generateSequence",value:function(){for(var t=this,e=[],i=this._varians[util.randomChance(this._varians.map(function(e){return e.chance}))],o=util.randomizedObjectKey(i.slots),a=0;a<i.length;++a)e.push(o);for(var n=this.getLength();e.length<n;){var r=util.randomizedObjectKey(i.slots);-1===e.indexOf(r)&&e.push(r)}return e.map(function(e){return t._machine.getSlotByName(e)})}}]),o}(),SlotMachine=Backbone.Model.extend({defaults:{lineLength:3,slots:[],combinations:[],offers:[],bet:0,sequenceStrategy:null,processing:!1},initialize:function(e){this.setSequenceMaker(this.get("sequenceStrategy")),this._lastCombination=this._sequenceMaker.generateSequence()},setSequenceMaker:function(e){this._sequenceMaker=e,this._sequenceMaker.init(this)},charge:function(){return this.getSlotOffer().buy()},canSpin:function(){return this.getSlotOffer().canBuy()},findCombinations:function(t){for(var e=this.get("combinations"),i=[],o=0;o<e.length&&0!==t.length;++o){var a=e[o],n=a.process(t);0<n.length&&(i.push(a),n.forEach(function(e){return t.splice(t.indexOf(e),1)}))}return i},activateCombinations:function(e){var t=this;return Promise.all(e.map(function(e){return e.activate(t)}))},isProcessed:function(){return this.get("processing")},spin:function(){var t=this;return this.set("processing",!0),Promise.resolve().then(function(){return t.cleanSelection()}).then(function(){return t.findValidSequence()}).then(function(e){return Promise.resolve().then(function(){return t.charge()}).then(function(){return t.emit("spinSequence",e.sequence)}).then(function(){return t.processCombinations(e.combination)})}).catch(function(e){console.error(e)}).then(function(){t.set("processing",!1)})},cleanSelection:function(){this.getSlots().forEach(function(e){return e.setSelected(!1)})},findValidSequence:function(){for(var e=0,t=!0,i=this._sequenceMaker.generateSequence(),o=i.slice();t&&e<1e3;){var a=this.findCombinations(o);if(0<a.length)return t=!1,this._lastCombination=i,Promise.resolve({sequence:i,combination:a});o=(i=this._sequenceMaker.generateSequence()).slice(),++e}return Promise.reject("No valid combinations were found")},processCombinations:function(e){var a=this;if(e.length<=0)return Promise.resolve();var n=[];return e.forEach(function(e){for(var t,i=[],o=0;o<a.getMultiply();++o)i.push(e.getPrizeCreater().getPrize());(t=Prize.sum.apply(Prize,i)).set("name","slotMachine.combination".concat(e.getId(),".X").concat(a.getBet())),n.push(t)}),this.emit("takePrizes",n).then(function(){return _.invoke(n,"take")})},getSlots:function(){return this.get("slots")},getLines:function(){return this.get("lineLength")},getMultiply:function(){return this.getSlotOffer().getMultiply()},getSlotByName:function(t){return this.getSlots().find(function(e){return e.getName()===t})},increaseBet:function(){var e=this.get("bet")+1;e>=this.get("offers").length?this.resetBet():this.set("bet",e)},resetBet:function(){this.set("bet",0)},setBet:function(e){this.set("bet",e)},getBet:function(){return this.get("bet")},getSlotOffer:function(){return this.get("offers")[this.get("bet")]},getLastCombination:function(){return this._lastCombination},buildSequenceMaker:function(e,t){this.setSequenceMaker(new e(t))},setDefaultSequenceMaker:function(){this.setSequenceMaker(this.get("sequenceStrategy"))},calcChance:function(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e4,o=console.log;console.log=function(){};var a={};this.get("combinations").forEach(function(e){a[e.get("id")]=0});for(var t=Promise.resolve(),n=0;n<i;++n)t=t.then(function(){return e.findValidSequence()}).then(function(e){e.combination.forEach(function(e){++a[e.get("id")]})});return t.then(function(){console.log=o;var e={};for(var t in a)e[t]=(a[t]/i*100).toFixed(2);return e})}}),SlotMachineComponent=BonusWorldComponent.extend({defaults:{id:"slotMachine"},constructor:function(e,t){var i=this;BonusWorldComponent.call(this,e,t);var o=e.offers.map(function(e){return new SlotMachineOffer(e)}),a=e.combinations.map(function(e){return i.createCombination(e)});this._machine=new SlotMachine({slots:e.slots,combinations:a,offers:o,sequenceStrategy:this.get("sequenceStrategy"),prefix:t.get("name")})},createCombination:function(e){var t=e.type;return e.prize instanceof SimplePrizeCreater||(e.prize.products||(e.prize={products:e.prize}),e.prize=new SimplePrizeCreater(e.prize)),e.prize.world||(e.prize.world=this.world),e.prize.name||(e.prize.name="".concat(this.world.get("name"),".sequence").concat(e.id)),new t(e)},getMachine:function(){return this._machine},spin:function(){var t=this;return this._machine.isProcessed()?Promise.reject(new Error("processed")):this._machine.canSpin().then(function(e){if(!e)return t.world.emit("spinDeclined",t).then(function(){t.world.canShowInfo()&&new WorldInfo({world:t.world})})}).then(function(){return t.emit("spin")}).then(function(){return t._machine.spin()}).then(function(){return t.emit("afterSpin")})},applyForce:function(t){var i=this;return this._machine.buildSequenceMaker(PremadeSequenceStrategy,{premadeSequence:t.premadeSequence}),Promise.resolve().then(function(){return Promise.all([new Promise(function(e){if(i._machine.isProcessed())return e();new SimpleForce({el:t.el,name:t.name,done:e}).show()}),new Promise(function(e){return i.once("afterSpin",e)})])}).then(function(){i._machine.setDefaultSequenceMaker()}).catch(function(e){i._machine.setDefaultSequenceMaker(),console.error(e)})}}),ReelView=Backbone.View.extend({initialize:function(e){this.index=e.index,this.slots={},this.render()},render:function(){for(var e=this.model.getSlots(),t=e.length+2+1,i=this.$(".slotsContainer"),o=this.$(".offsetWrapper"),a=t;0<a;--a){var n=$(".invisible .slotUnit"),r=e[a-2];a===t&&(r=e[1]),a===t-1&&(r=e[0]),1===a&&(r=e[e.length-1]);var s=n.clone();s.addClass(this.model.get("prefix")).addClass(r.getName()),s.css("bottom",90*(t-a)),s.appendTo(i),this.slots[r.getName()]=s}this.$el.css("height",90*(t-2-1)),o.css("height",90*(t-2-1)),this.updateSlot()},animateSpin:function(l,e,t){var d=this;return new Promise(function(o){var a=1e5*t,n=e+d.getSlotOffset(l),r=performance.now(),s=0;d.offHighlight();!function e(){if(s+=performance.now()-r,a<=s)return d.setSlot(l),o(),void application.playSound("slotMachineStop");var t=Library.easingFunctions.easeOutCubic(s/a),i=n*t;d.setOffset(i),requestAnimationFrame(e)}()})},getSlotOffset:function(e){var t=this.model.getSlots();return 1-t.indexOf(e)/t.length},updateSlot:function(){var e=this.model.getLastCombination();this.setSlot(e[this.index])},setSlot:function(e){this.setOffset(this.getSlotOffset(e))},setOffset:function(e){e-=Math.floor(e),this.$(".offsetWrapper").css("top",100*e+"%")},setHighlight:function(e){e.isSelected()&&this.$(".slotUnit."+e.getName()).addClass("shine")},offHighlight:function(){for(var e in this.slots)this.$(".slotUnit."+e).removeClass("shine")}}),BaseSlotMachineView=Backbone.View.extend({events:{"click .spinBtn":"spin","click .betBtn":"increaseBet"},initialize:function(){this.$reelContainer=this.$(".reelsStencil"),this._machine=this.model.getMachine(),this.reels=[],this.renderReels(),this.updateBetBtn(),this.listenTo(this._machine,"spinSequence",this.animateReel),this.listenTo(this._machine,"change:processing",this.updateByProcessing)},renderReels:function(){for(var e=$(".invisible.slotMachineTemplate .slotReel"),t=0;t<this._machine.get("lineLength");++t){var i=e.clone();i.addClass("slotReel"),i.addClass("reel"+(t+1)),i.appendTo(this.$reelContainer),this.reels.push(new ReelView({el:i,model:this._machine,index:t}))}},updateByProcessing:function(e,t){this.$(".spinBtn").css("pointer-events",t?"none":"auto")},spin:function(){return this.model.spin()},animateReel:function(i){var e=this;return $("#container").addClass("spinAnimation"),application.playSound("slotMachineStart"),application.playSound("slotMachineSpin"),Promise.all(this.reels.map(function(e,t){return e.animateSpin(i[t],4*(t+1),.7*(t+1))})).then(function(){return e.setHighlight(i)}).then(function(){return $("#container").removeClass("spinAnimation"),application.playSound("slotMachinePrize"),Promise.resolve()})},setHighlight:function(i){var t=this;return new Promise(function(e){t.reels.forEach(function(e,t){return e.setHighlight(i[t])}),setTimeout(e,500)})},updateReels:function(){var a=this;this._machine.getLastCombination().forEach(function(e,t){var i="reel"+(t+1),o=a.$reelContainer.find("."+i);o.removeClass().addClass(i),o.addClass("slotReel"),o.addClass(e.getName())})},updateSpinBtn:function(){this.$(".spinBtn").find(".mPrice").html(this._machine.getSlotOffer().get("price"))},updateBetBtn:function(){var e=this._machine.getSlotOffer();this.$(".betBtn .mText").html(sprintf(messages[this._machine.get("prefix")+"SlotMachine"].betButton,{mul:e.getMultiply()}))},increaseBet:function(){this._machine.increaseBet(),this.updateBetBtn(),this.updateSpinBtn()}}),BonusWorldSlotMachineView=BaseSlotMachineView.extend({initialize:function(){BaseSlotMachineView.prototype.initialize.call(this),this.listenTo(this.model.world,"enter",this.onEnter)},onEnter:function(){this.updateReels(),this.updateSpinBtn()}}),BaseSuguestActivator=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(e){this._suguest=e}},{key:"destroy",value:function(){}}]),e}(),BaseSuguestion=function(){function t(e){_classCallCheck(this,t),this.world=e}return _createClass(t,[{key:"isAvailable",value:function(){return!0}},{key:"container",get:function(){return $(".bonusWorldUI.".concat(this.world.getName()))}},{key:"createArrow",value:function(){return $('<div class="suguestionArrowContent"><div class="arrow"></div></div>')}},{key:"activate",value:function(){this._arrow||(this._arrow=this.createArrow(),this.container.append(this._arrow)),this.align(this._arrow)}},{key:"deactivate",value:function(){this._arrow&&(this._arrow.remove(),this._arrow=null)}},{key:"align",value:function(e){}}]),t}(),TimeSugestActivator=function(e){_inherits(o,BaseSuguestActivator);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this))._time=e.time,t._page=e.page,t._world=e.world,t}return _createClass(o,[{key:"init",value:function(e){_get(_getPrototypeOf(o.prototype),"init",this).call(this,e),application.on("change:page",this.checkActivated,this),application.on("windowOpened windowsClosed",this.checkActivated,this),this._world.on("enter",this.checkActivated,this),this._world.on("exit",this.checkActivated,this)}},{key:"destroy",value:function(){application.off("change:page",this.checkActivated,this),application.off("windowOpened windowsClosed",this.checkActivated,this),this._world.off("enter",this.checkActivated,this),this._world.off("exit",this.checkActivated,this)}},{key:"isAcativated",value:function(){return Boolean(this._suguest.isActivate()||this._timeout)}},{key:"isAvilable",value:function(){if(application.get("page")===this._page&&!application.windows.anyWindowOpen()&&episode.isBonusWorld()&&Config.bonusWorld===this._world){var e=this._world.cmp("story");return!e||!e.hasActivatedStory()}return!1}},{key:"checkActivated",value:function(){this.isAvilable()?this.isAcativated()||this.reset():this.onDeactivate()}},{key:"onDeactivate",value:function(){this._suguest.deactivate(),this._timeout&&(clearTimeout(this._timeout),this._timeout=null)}},{key:"onActivate",value:function(){this._timeout=null,this.isAvilable()&&this._suguest.activate()}},{key:"reset",value:function(){var e=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){return e.onActivate()},1e3*util.duration(this._time))}}]),o}(),NodeSuguestion=function(e){_inherits(a,BaseSuguestion);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e))._node=t,i}return _createClass(a,[{key:"isAvailable",value:function(){return this.node}},{key:"node",get:function(){return _get2(this._node)}},{key:"align",value:function(e){var t=this.node.$el.position();e.css({left:t.left,top:t.top})}}]),a}(),InvestigationTaskSuguestion=function(e){_inherits(a,NodeSuguestion);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e))._component=t.component,i}return _createClass(a,[{key:"isAvailable",value:function(){var e=this.getTask();if(e){var t=this._component.view.getViewByTask(e);if(t)return this._node=t,this._task=e,!0}return this._node=null,this._task=null,!1}},{key:"getTask",value:function(){return this._component.getCanBuyTasks().sort(function(e,t){return e.get("price")-t.get("price")})[0]}},{key:"container",get:function(){return this._component.view.$container}},{key:"align",value:function(e){var t=this.node.$el.position(),i=this.node.$el.find(".icon").position();e.css({left:t.left+i.left,top:t.top+i.top}),this._component.view.scrollToTask(this._task)}}]),a}(),Suguest=function(){function t(e){_classCallCheck(this,t),this._activator=e.activator,this._container=e.container,this._suguestions=e.suguestions}return _createClass(t,[{key:"init",value:function(){return this._activator.init(this)}},{key:"destroy",value:function(){this._activator.destroy()}},{key:"setContainer",value:function(e){this._container=e}},{key:"isActivate",value:function(){return!!this._active}},{key:"activate",value:function(){var e,t=_createForOfIteratorHelper(this._suguestions);try{for(t.s();!(e=t.n()).done;){var i=e.value;if(i.isAvailable())return i.activate(),void(this._active=i)}}catch(e){t.e(e)}finally{t.f()}}},{key:"deactivate",value:function(){this._active&&(this._active.deactivate(),this._active=null)}}]),t}(),SuguestComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),i=o.call(this,e,t),e.activator||(e.activator=new TimeSugestActivator({world:t,page:t.getPageName(),time:"8s"})),i._suguest=new Suguest(e),i}return _createClass(a,[{key:"init",value:function(){var e=this;return Promise.resolve().then(function(){return e._suguest.init()})}},{key:"destroy",value:function(){this._suguest.destroy()}}]),a}();SuguestComponent.prototype.defaults=_.defaults({id:"suguest"},BonusWorldComponent.prototype.defaults);var BigMapSocialController=BigMapController.extend({initialize:function(e){BigMapController.prototype.initialize.call(this,e),this.KEY_SPEED_UP=e.keySpeedUp||7,this.KEY_INTERVAL_TIME=e.keyIntervalTime||20,this.SCALE_DIFF_VALUE=e.scaleDiff||.05,this.INERTIA_DISTANCE_COEFF=.3,this.MIN_SPEED_FOR_INERTIA=2,this.canMove=!1,this.wasMoveAction=!1,this.startPointX=0,this.timeEnd=0,this.timeStart=0,this.scaleDelta=0,this.subscribeEvents()},subscribeEvents:function(){this.scrollEnabled=!0,this.$el.on("mousedown",this,this.onMouseDown),$("body").on("keydown",this,this.onKeyDown),this.$el.on("mousemove ",this,this.onMouseMove),this.$el.on("mouseup mouseleave",this,this.onMouseUpMouseLeave),this.crossBrowserWheel()},removeEventsSubscription:function(){this.scrollEnabled=!1,this.$el.off("mousedown",this.onMouseDown),$("body").off("keydown",this.onKeyDown),this.$el.off("mousemove ",this.onMouseMove),this.$el.off("mouseup mouseleave",this.onMouseUpMouseLeave),this.disableCrossBrowserWheel()},onMouseDown:function(e){var t=e.data;e.preventDefault(),t.mouseDownHandler(e)},onKeyDown:function(e){e.data.keydownHandler(e)},onMouseMove:function(e){var t=e.data;e.preventDefault(),t.mouseMoveHandler(e)},onMouseUpMouseLeave:function(e){e.data.mouseUpHandler()},focusMainElement:function(e){this.wasMoveAction=!0;return BigMapController.prototype.focusMainElement.call(this,e,1)},focusElement:function(e,t){this.wasMoveAction=!0;return BigMapController.prototype.focusElement.call(this,e,t,1)},crossBrowserWheel:function(){"onwheel"in window?this.onWheel("wheel"):"onmousewheel"in window?this.onWheel("mousewheel"):this.onWheel("MozMousePixelScroll")},disableCrossBrowserWheel:function(){"onwheel"in window?this.offWheel("wheel"):"onmousewheel"in window?this.offWheel("mousewheel"):this.offWheel("MozMousePixelScroll")},onWheel:function(e){var t=this;this.wheelAction=function(e){e.preventDefault(),t.mouseWheelHandler(e)},this.$el[0].addEventListener(e,this.wheelAction)},offWheel:function(e){this.wheelAction&&this.$el[0].removeEventListener(e,this.wheelAction)},mouseWheelHandler:function(e){var t=this.getMouseWheelDelta(e);this.changeScale(t)},getMouseWheelDelta:function(e){var t=e.deltaY||e.detail||e.wheelDelta;return(t=-Math.max(-1,Math.min(1,t)))*this.SCALE_DIFF_VALUE},getCurrentZoommCoord:function(e){if(this.scaleDelta!==e||this.wasMoveAction){var t=this.findCenterOfPage();this.currentZoom=this.findBGCoord(t.x,t.y)}},addInertia:function(){if(!this.isInertiaActive)return!1;var e=this.INERTIA_DISTANCE_COEFF*Math.min(this.$el.width(),this.$el.height()),t=this.MIN_SPEED_FOR_INERTIA/this.scale;(Math.abs(this.velocityX)>t||Math.abs(this.velocityY)>t)&&(this.translateX+=this.velocityX*e,this.translateY+=this.velocityY*e,this.restrictTransition(),this.bgImage.css({transition:"transform "+this.INERTIA_TRANSFORM_TIME+"s ease"}),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)))},changeScale:function(e){this.turnOffTransition(),this.getCurrentZoommCoord(e),this.scale+=e,this.restrictScale();var t=this.findCenterOfPage();this.centering(this.currentZoom,t),this.scaleDelta=e,this.wasMoveAction=!1},mouseUpHandler:function(){this.timeEnd=Date.now();var e=this.timeEnd-this.timeStart;this.canMove=!1,!e||0===this.distX&&0===this.distY||(this.findOutVelocity(e),this.addInertia(),this.skipDist(),this.updateDeltaPos())},mouseDownHandler:function(e){var t=this.getCoord(e);this.timeStart=Date.now(),this.canMove=!0,this.startPointX=t.x,this.startPointY=t.y,this.turnOffTransition()},mouseMoveHandler:function(e){if(this.canMove){this.wasMoveAction=!0;var t=this.getCoord(e),i=this.startPointX-t.x,o=this.startPointY-t.y;this.moveBG(i,o)}},getCoord:function(e){return{x:e.pageX-this.$el.offset().left,y:e.pageY-this.$el.offset().top}},findOutVelocity:function(e){this.velocityX=-this.distX/e,this.velocityY=-this.distY/e},moveBG:function(e,t){this.translateX=this.dx-e,this.translateY=this.dy-t,this.distX=this.dx-this.translateX,this.distY=this.dy-this.translateY,this.restrictTransition(),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale)),this.trigger("transition",this)},skipDist:function(){this.distX=0,this.distY=0},keydownHandler:function(e){var t=e.which,i=-1<_.indexOf([38,40,37,39],t);if(!!i&&"INPUT"!==e.target.tagName&&e.preventDefault(),!this.isBtnPressed&&i){this.isBtnPressed=!0;var o=setInterval(_.bind(function(){this.keydown(t)},this),this.KEY_INTERVAL_TIME);$("body").one("keyup",_.bind(function(){this.isBtnPressed=!1,clearTimeout(o)},this))}},keydown:function(e){switch(e){case 38:this.top();break;case 40:this.bottom();break;case 37:this.left();break;case 39:this.right()}this.moveBgByControls()},top:function(){this.translateY+=this.KEY_SPEED_UP},bottom:function(){this.translateY-=this.KEY_SPEED_UP},left:function(){this.translateX+=this.KEY_SPEED_UP},right:function(){this.translateX-=this.KEY_SPEED_UP},isTop:function(){return this.translateY<0},isBottom:function(){var e=this.$el.height()-this.bgImage.height()+this.bgImage.height()*(1-this.scale);return!(Math.abs(this.translateY)>=Math.abs(e))},isLeft:function(){return this.translateX<0},isRight:function(){var e=this.$el.width()-this.bgImage.width()+this.bgImage.width()*(1-this.scale);return!(Math.abs(this.translateX)>=Math.abs(e))},restrictTransition:function(){0<this.translateX&&(this.translateX=0),0<this.translateY&&(this.translateY=0);var e=this.$el.width()-this.bgImage.width()+this.bgImage.width()*(1-this.scale);Math.abs(this.translateX)>Math.abs(e)&&(this.translateX=e);var t=this.$el.height()-this.bgImage.height()+this.bgImage.height()*(1-this.scale);Math.abs(this.translateY)>Math.abs(t)&&(this.translateY=t)},moveBgByControls:function(){this.turnOffTransition(),this.restrictTransition(),this.updateDeltaPos(),this.bgImage.css(generateTransform(this.translateX,this.translateY,0,this.scale))}}),BigMapControllerView=Backbone.View.extend({events:{"mousedown .up":"up","mousedown .down":"down","mousedown .left":"left","mousedown .right":"right","touchbegin .up":"up","touchbegin .down":"down","touchbegin .left":"left","touchbegin .right":"right","click .main":"main",mouseup:"stopScroll",touchend:"stopScroll",mouseleave:"stopScroll"},initialize:function(){this.model.on("transition",this.checkControls,this),this.checkControls()},up:function(){this.scroll("top")},down:function(){this.scroll("bottom")},left:function(){this.scroll("left")},right:function(){this.scroll("right")},main:function(){this.model.focusMainElement()},scroll:function(e){this.timeoutId&&clearTimeout(this.timeoutId);this.timeoutId=setInterval(this._scrolling.bind(this),20,e)},stopScroll:function(){this.timeoutId&&clearTimeout(this.timeoutId)},checkControls:function(){this.$(".left").toggleClass("disabled",!this.model.isLeft()),this.$(".right").toggleClass("disabled",!this.model.isRight()),this.$(".top").toggleClass("disabled",!this.model.isTop()),this.$(".bottom").toggleClass("disabled",!this.model.isBottom())},_scrolling:function(e){this.checkControls(),this.model[e](),this.model.moveBgByControls()}}),ArtifactController=BonusWorldComponent.extend({defaults:{world:null,artifactWorkshop:null,autoRender:!0,dropOnReplayLevel:!1,notify:!1},initialize:function(){var i=this.get("world");(i.artifactController=this).get("artifactWorkshop").config.artifacts.forEach(function(e){e.prize&&e.prize.products&&(e.prize=UserPrizes.convertFromCocos(e.prize)),e.prize&&0<e.prize.length&&e.prize.forEach(function(e){e.world||(e.world=i.get("name"))}),e.ability||(e.ability={type:Artifacts.EmptyAbility})}),this._artifactWorkshop=new Artifacts.ArtifactWorkshop(_.extend({prefix:i.get("name"),controller:this},this.get("artifactWorkshop"))),this.initGameListening(),this.get("autoRender")&&(i.once("enter",this._initArtifactsView,this),i.on("enter",this._toggleArtifactWorkshopButton,this)),i.on("preload",this._onPreload,this),this.once("partAnimated",this.onPartAnimated,this),i.on("configure",function(){application.on("beforeLoadMessage",function(e,t){i.get("active")&&(t.artifacts||(t.artifacts=[]),t.artifacts.push(i.get("name")))})})},initGameListening:function(){var e=this.get("world");e.on("createNewGame",this._applyPassiveArtifactAbilities,this),e.on("completeLevel",this._receiveRandomArtifactPart,this)},getSlots:function(){return this._artifactWorkshop.slots},onChangePage:function(e,t){"main"===t&&this.checkNotify()},onPartAnimated:function(e){if(application.level.num==this.get("artifactWorkshopMinLevel")&&!Config.bonusWorld.isSatellite()){var t=episode.get("about").artifactForce;t&&new ForceView({type:t,step:1})}},onApplyArtefact:function(){this.runInterval()},onIntervalUpdate:function(){0===this.getMinCoolDownTime()&&(this.stopInterval(),this.onFinishCoolDown())},onFinishCoolDown:function(){this.checkNotify()},_onPreload:function(){var e=this;application.on("change:page",_.bind(this.onChangePage,this));var t=this.getArtifactWorkshop();return new Promise(function(e){t.load(e)}).then(function(){return e.runInterval()})},_applyPassiveArtifactAbilities:function(){$("#game .gameProgress .indicators .indicator").removeClass("active"),$("#game").addClass("indicators"),this.getArtifactWorkshop().applyPassiveArtifactAbilities().forEach(function(e){var t=e.get("cssClass");$("#game .gameProgress .indicators").find(t).addClass("active")})},_receiveRandomArtifactPart:function(e){var t=e.getCurrentLevel()-1,i=this.get("artifactWorkshopMinLevel"),o=this.get("artifactWorkshopMinStars")||0,a=episode.scores.last(),n=this.getArtifactWorkshop(),r=null;(a&&a.get("level")===t||this.get("dropOnReplayLevel"))&&(t===i||e.isSatellite()?(n.getParts().forEach(function(e){e.get("startAmount")&&e.setAmount(e.get("startAmount"))}),r=n.receivePart(),n.save()):i<t&&a.get("stars")>=o&&(r=n.receivePart()));r&&(n.save(),Game&&Game.cancelNext()),(t===this.get("artifactWorkshopMinLevel")||e.isSatellite())&&this.trigger("activate",this),this._toggleArtifactWorkshopButton(),this.trigger("specialWorldReceiveArtifactPart",r,this);var s=this._artifactWorkshop.artifacts.findWhere(function(e){return e.canAssembled()&&!e.isAssembled()&&"finish"!=e.get("type")});s&&this.trigger("canCollectArtifact",this,s)},findSlotByArtifact:function(t){return this._artifactWorkshop.slots.findWhere(function(e){return e.canSetArtifact(t)})},_animateReceiveRandomArtifactPart:function(r,e,s){var l=this;if(l._artifactWorkshopButtonView){setTimeout(function(){var e=l._artifactWorkshopButtonView.$el,t=window.mobile?$(".artifactPartStartPoint").get(0).getBoundingClientRect():$(".artifactPartStartPoint").position(),i=e.position(),o=$("<div></div>").addClass("animationArtifactPart artifactPart"+r.id).css({top:t.top,left:t.left,"z-index":5}).appendTo("#blockedAnimations"),a=e[0].getBoundingClientRect(),n=o[0].getBoundingClientRect();i.top+=(a.height-n.height)/2,i.left+=(a.width-n.width)/2,o.animate({top:i.top,left:i.left},{duration:s,easing:"easeOutQuad",done:function(){o.remove(),Config.bonusWorld.trigger("artifactAnimationFinished")}})},e)}},getArtifactWorkshop:function(){return this._artifactWorkshop},isValidWorld:function(e){return e===this.get("world").get("name")},checkNotify:function(){var e=!1;getLocalStorage(this.getAvailableNewArtifactPartKey(),!1)&&(e=!0);for(var t=this.getArtifactWorkshop().artifacts,i=0;i<t.length;i++){var o=t.at(i),a=o.get("cooldown");if(o.isAvailable()&&a&&0==o.getCooldown()){e=!0;break}}this.set("notify",e),this._artifactWorkshopButtonView&&(e?this._artifactWorkshopButtonView.showAvailableNewArtifactPart():this._artifactWorkshopButtonView.hideAvailableNewArtifactPart())},runInterval:function(){this.updateTimerInterval||(this.updateTimerInterval=setInterval(_.bind(this.onIntervalUpdate,this),1e3))},stopInterval:function(){this.updateTimerInterval&&(clearInterval(this.updateTimerInterval),this.updateTimerInterval=!1)},getMinCoolDownTime:function(){var e=this.getArtifactWorkshop().getArtifacts().filter(function(e){return e.isAvailable()});if(0===e.length)return 0;for(var t=e[0].getCooldown(),i=0;i<e.length;i++){var o=e[i].getCooldown();o<t&&(t=o)}return t},_initArtifactsView:function(){var e=this.getArtifactWorkshop(),t=this.createWorkShopView();t.$el.appendTo($("#artifacts")),t.hide(),user.on("createNewGame",function(){t.hide()},this),t.on("exit",function(){t.hide(),this.checkNotify()},this),t.on("show",function(){$(".wrapper").addClass("artifactPage")},this),t.on("hide",function(){$(".wrapper").removeClass("artifactPage")},this);var i=$(".invisible.artifactWorkshopTemplate").find(".artifactWorkshopButton").clone().addClass(this.get("world").get("name"));i.appendTo(this.get("container")),this._artifactWorkshopButtonView=new Artifacts.ArtifactWorkshopButtonView({model:e,el:i}),this._artifactWorkshopButtonView.show(),this._artifactWorkshopButtonView.on("click",function(){setLocalStorage(this.getAvailableNewArtifactPartKey(),!1),this.checkNotify(),t.show(),this.trigger("openWorkshop",this)},this),e.on("receivePart",function(){setLocalStorage(this.getAvailableNewArtifactPartKey(),!0),this.checkNotify()},this),this.checkNotify()},getAvailableNewArtifactPartKey:function(){return this.get("world").get("name")+"availableNewArtifactPart"},createWorkShopView:function(){var e=this.getArtifactWorkshop(),t=$(".invisible.artifactWorkshopTemplate").find(".artifactWorkshop").clone().addClass(this.get("world").get("name"));return new Artifacts.ArtifactWorkshopView({model:e,el:t})},_toggleArtifactWorkshopButton:function(){this._artifactWorkshopButtonView&&(this.get("world").getCurrentLevel()<=this.get("artifactWorkshopMinLevel")?this._artifactWorkshopButtonView.hide():this._artifactWorkshopButtonView.show())}}),MultipleWorldsArtifactController=ArtifactController.extend({defaults:_.defaults({targetWorlds:[]},ArtifactController.prototype.defaults),initGameListening:function(){var t=this;this.get("targetWorlds").forEach(function(e){e.on("createNewGame",t._applyPassiveArtifactAbilities,t),e.on("completeLevel",t._receiveRandomArtifactPart,t)})},isValidWorld:function(e){return-1!==this.get("targetWorlds").map(function(e){return e.get("name")}).indexOf(e)}}),BaseTask=Backbone.Model.extend({defaults:{completed:!1},init:function(e){var t=this;return this.component=e,Promise.resolve().then(function(){return t.checkCompleted()})},checkCompleted:function(){this.set("completed",this.isCompleted())},isCompleted:function(){return!1}}),AssemblyArtifactsTask=BaseTask.extend({defaults:_.defaults({artifacts:[]},BaseTask.prototype.defaults),init:function(e){var t=this;return BaseTask.prototype.init.call(this,e).then(function(){var e=t.getArtifactComponent();e&&t.listenTo(e.getArtifactWorkshop().artifacts,"change:available",t.checkCompleted)})},getArtifactComponent:function(){return this.component&&this.component.world.getComponent(ArtifactController)},isCompleted:function(){var e=this.getArtifactComponent();if(e){for(var t=e.getArtifactWorkshop().artifacts,i=this.get("artifacts"),o=0;o<i.length;++o){var a=t.get(i[o]);if(!a||!a.isAssembled())return!1}return!0}return!1}}),CompletedLevelTask=BaseTask.extend({defaults:_.defaults({level:null},BaseTask.prototype.defaults),init:function(e){var t=this;return BaseTask.prototype.init.call(this,e).then(function(){t.listenTo(t.component.world,"change:progress",t.checkCompleted)})},isCompleted:function(){return this.component&&this.component.world.get("progress")>this.get("level")}}),InsertArtifactsTask=BaseTask.extend({defaults:_.defaults({amount:3},BaseTask.prototype.defaults),init:function(e){var t=this;return BaseTask.prototype.init.call(this,e).then(function(){var e=t.getArtifactComponent();e&&t.listenTo(e.getArtifactWorkshop().getSlots(),"change:artifact",t.checkCompleted)})},getArtifactComponent:function(){return this.component&&this.component.world.getComponent(ArtifactController)},isCompleted:function(){var e=this.getArtifactComponent();return!!e&&e.getArtifactWorkshop().getSlots().filter(function(e){return e.getArtifact()}).length>=this.get("amount")}}),MiniTasksItem=Backbone.Model.extend({defaults:{taked:!1,task:null},init:function(t){var e=this;return this.prize=new UserPrizes(UserPrizes.convertFromCocos(_.defaults(this.get("prize"),{name:t.getEventName()+".minitask.item"+this.get("id")})).map(function(e){return e.world=t.getEventName(),e})),this.get("task")||console.error("     ".concat(this.get("id"))),this.get("task").init(t).then(function(){e.listenTo(e.get("task"),"change:completed",function(){e.trigger("change")})})},getPrize:function(){return this.prize},isTaked:function(){return this.get("taked")},isCompleted:function(){return this.get("task").isCompleted()}}),MiniTasksComponent=BonusWorldComponent.extend({defaults:{id:"minitasks",active:!1},constructor:function(e,t){BonusWorldComponent.call(this,e,t),this.items=new Backbone.Collection(e.items,{model:MiniTasksItem}),this.items.comparator=function(e){return e.get("taked")?1:e.get("taked")?0:-1}},init:function(){return this.listenTo(this.items,"change:taked",this._updateItemsOrder),this.loadFromServer()},loadFromServer:function(){var t=this;return service("../../../gems/site/service/minitasks/loaddata.php",{eventName:this.getEventName()}).then(function(i){return t.items.forEach(function(e){var t=_.findWhere(i,{itemId:e.get("id").toString()});e.set("taked",t&&t.taked||!1)}),Promise.all(t.items.map(function(e){return e.init(t)}))}).catch(function(e){t.set("active",!1),console.error(e)})},takePrize:function(e){if(e.isCompleted()&&!e.isTaked())return service("../../../gems/site/service/minitasks/takeprize.php",{eventName:this.getEventName(),itemId:e.get("id")}).then(function(){e.getPrize().take(),e.set("taked",!0)}).catch(function(e){console.error(e)})},getCompletedTasks:function(){return this.items.filter(function(e){return e.isCompleted()&&!e.isTaked()})},hasCompletedTask:function(){return this.get("active")&&this.items.any(function(e){return e.isCompleted()&&!e.isTaked()})},showTaskItems:function(){this._updateItemsOrder(),new MiniTaskWindow({model:this,items:this.items})},_updateItemsOrder:function(){this.items.sort()}}),MiniTaskWindow=TWindow.extend({templateClass:".miniTaskWindow_template",events:{"click .close":"close","click .mTakePrizeBtn":"takePrize"},onOpen:function(){var i=this;this.listenTo(this.model.items,"change",this.updateItem),this.$(".windowTitle").html(messages[this.model.getEventName()+"MiniTasksWindow"].title);var o=this.$(".mItems"),a=this.$(".invisible .mItem");this.model.items.forEach(function(e){var t=a.clone();t.addClass("item"+e.get("id")).toggleClass("isCompleted",e.isCompleted()).toggleClass("isTaked",e.isTaked()),new UserPrizesView({el:t.find(".mPrizes"),model:e.getPrize()}),t.find(".mTakePrizeBtn").data("itemId",e.get("id")),t.find(".mText").html(messages[i.model.getEventName()+"MiniTasksTexts"][e.get("id")-1]),o.append(t)}),setTimeout(function(){var e=i.model.getCompletedTasks();if(0<e.length){var t=i.$(".mItems .item"+e[0].get("id")).offset();t&&i.$(".mItems").animate({scrollTop:t.top},300)}},100)},updateItem:function(e){this.$(".mItems .item"+e.get("id")).toggleClass("isCompleted",e.isCompleted()).toggleClass("isTaked",e.isTaked())},takePrize:function(e){var t=this.model.items.get($(e.target).data("itemId"));t&&(this.close(),this.model.takePrize(t))}}),MiniTaskButtonView=Backbone.View.extend({events:{click:"open"},initialize:function(){this.listenTo(this.model,"change",this.update),this.listenTo(this.model.items,"change",this.update),this.update()},update:function(){this.$el.toggleClass("active",this.model.get("active")),this.$el.toggleClass("hasCompletedTask",this.model.hasCompletedTask())},open:function(){this.model.showTaskItems()}}),Yacht=Backbone.Model.extend({idAttribute:"userId",defaults:{number:0,avatarUrl:null,userId:null,teamId:null,hasBattlePass:!1,level:0,date:null},reset:function(){this.set({number:0,avatarUrl:null,userId:null,teamId:null,hasBattlePass:!1,level:0,date:null})}}),Regatta=Backbone.Model.extend({defaults:{active:!1,startLevel:15,amountYachts:5,amountPoints:0,timerUpdate:1e4,name:""},initialize:function(){this.listenToOnce(this.get("world"),"configure",this.configure),this.listenTo(this.get("world"),"exit",this.onExitWorld),this.listenTo(this.get("world"),"enter",this.onEnterWorld),this.listenTo(this.get("world"),"completeLevel",this.onCompleteLevel),this.set("amountPoints",this.get("world").get("levelsInEpisode")),this.yachtMoveQueue=new ActionQueue},configure:function(){this.yachts=new Backbone.Collection;for(var e=2;e<=this.get("amountYachts");++e)this.yachts.add(new Yacht({number:e}));return this.stages=new Backbone.Collection(this.get("stages").map(function(e){return e.places.some(function(e){return e.prize.products})&&e.places.forEach(function(e){e.prizes=UserPrizes.convertFromCocos(e.prize),delete e.prize}),new RegattaStage(e)})),this.player=new Yacht({number:1,level:0,userId:user.get("userId"),avatarUrl:user.get("bigPhoto")}),this.yachts.add(this.player),this.listenTo(this.get("world"),"change:hasBattlePass",this.onChangeBattlePass),this.loadData()},exit:function(){this.get("world").exit()},onExitWorld:function(){this.set("active",!1)},updatePlaces:function(){for(var e=this.yachts.toArray().sort(function(e,t){return t.get("level")==e.get("level")?e.get("date")>t.get("date")?1:e.get("date")<t.get("date")?-1:0:t.get("level")-e.get("level")}),t=0;t<e.length;++t)e[t].set("place",t+1)},updateStages:function(){var o=this;this.stages.each(function(t){var i=o.yachts.filter(function(e){return e.get("level")>t.get("level")});t.prizes.each(function(e){e.set("opened",i.length>=e.get("place")),e.set("lost",!e.get("opened")&&e.get("level")<o.player.get("level"))})})},onChangeBattlePass:function(){this.player.set("hasBattlePass",this.get("world").get("hasBattlePass"))},onCompleteLevel:function(e,t){var r=this;return this.saveToServer(t+1).then(function(e){return r.updateData(e.users)}).then(function(){var a=r.stages.findWhere({level:t}),n=r.player.get("place");return r.yachtMoveQueue.push({run:function(){var e=this,o=null;return a&&(o=a.prizes.findWhere({place:n})||a.prizes.findWhere({place:"consolation"})),r.get("world").emit("regattaLevelUp",r,t+1).then(function(){return application.waitPage("main")}).then(function(){return application.windows.runAfterCloseAll()}).then(function(){return $("#container,#mainAppWrapper").addClass("yachtMoving"),r.emit("yachtMove",r,r.player,t+1)}).then(function(){if(a)return r.get("world").emit("regattaLineCross",r,a,n).then(function(){return r.get("world").emit("regattaLineCrossLevel"+a.get("level"),r)}).then(function(){return r.get("world").emit("regattaLineCrossLevel"+a.get("level")+"Place"+n,r)}).then(function(){return o?r.get("world").emit("regattaLineCrossLevel"+a.get("level")+"Prize",r):r.get("world").emit("regattaLineCrossLevel"+a.get("level")+"NotPrize",r)}).then(function(){return r.get("world").emit("afterRegattaLineCrossedAtLevel"+a.get("level"),r)})}).then(function(){return $("#container,#mainAppWrapper").removeClass("yachtMoving"),r.get("world").emit("regattaAfterPlayerMove",r)}).then(function(){if(a)return r.get("world").emit("regattaStage",r,a,n).then(function(){return new Promise(function(e){if(o){o.set("opened",!0);var t,i=_createForOfIteratorHelper(a.prizes.filter(function(e){return!e.get("opened")}));try{for(i.s();!(t=i.n()).done;){t.value.set("lost",!0)}}catch(e){i.e(e)}finally{i.f()}new RegattaTakePrizeWindow({regatta:r,prizes:o.get("prizes"),place:n,onClose:e})}else e()})})}).then(function(){if(a)return r.get("world").emit("regattaAfterPrizeWindowShowed"+a.get("level"),r)}).then(function(){return r.get("world").emit("regattaAfterMoveFromLevel"+t)}).then(function(){return r.get("world").emit("regattaAfterMove",e.level)})}})})},onEnterWorld:function(){this.view||(this.view=new RegattaView({model:this,el:$("#regattaTemplates .regatta").clone().appendTo("#main")}));var t=this;return this.loadData().then(function(){if(t.player.get("level")!==t.get("world").getCurrentLevel())return t.player.set("level",t.get("world").getCurrentLevel()),t.saveToServer(t.get("world").getCurrentLevel()).then(function(e){return t.updateData(e.users)})}).then(function(){t.trigger("enter",this),t.set("active",!0),setTimeout(t.loadData.bind(t),t.get("timerUpdate"))})},getName:function(){return this.get("world").get("name")},playLevel:function(){return this.get("world").playCurrentLevel()},loadData:function(){var t=this;return this.loadFromServer().then(function(e){return t.updateData(e.users)}).then(function(){t._timeUpdate&&(clearTimeout(t._timeUpdate),t._timeUpdate=null),t.get("active")&&(t._timeUpdate=setTimeout(t.loadData.bind(t),t.get("timerUpdate")))})},updateData:function(e){var i=this,o=e.concat([]);i.yachts.each(function(e){if(e.get("userId")){for(var t=0;t<o.length&&o[t].userId!=e.get("userId");++t);o[t]?(e.set({userId:o[t].userId,teamId:o[t].teamId,level:parseInt(o[t].level,10),avatarUrl:o[t].avatarUrl,date:o[t].date,hasBattlePass:1==o[t].hasBattlePass}),o.splice(t,1)):e!==i.player&&e.reset()}}),o.forEach(function(e){var t=i.yachts.findWhere({userId:null});t&&t.set(e)}),i.updatePlaces(),i.updateStages()},loadFromServer:function(){var i=this.get("name");return new Promise(function(e,t){callService("../../../gems/site/service/regatta/loaddata.php",e,t,{eventName:i})})},saveToServer:function(i){var o=this.get("name"),a=user.get("bigPhoto");return new Promise(function(e,t){callService("../../../gems/site/service/regatta/savedata.php",e,t,{eventName:o,avatarUrl:a,level:i})})}}),RegattaStage=Backbone.Model.extend({idAttribute:"level",defaults:{level:0,places:[]},initialize:function(){this.prizes=new Backbone.Collection(this.get("places").map(function(e){return e.prizes=new UserPrizes(e.prizes),e.opened=!1,e.level=this.get("level"),e},this))}});$.fn.alignToExt=function(){$("#main").addClass("regattaAlignTo"),this.alignTo.apply(this,arguments),$("#main").removeClass("regattaAlignTo")},$.fn.ourAnimateExt=function(){$("#main").addClass("regattaAlignTo"),this.ourAnimate.apply(this,arguments),$("#main").removeClass("regattaAlignTo")};var RegattaView=Backbone.View.extend({events:{"click .startCurrentLevel":"onPlayLevel","click .mExitWorldBtn":"onExit"},initialize:function(){var t;this.$el.addClass("regatta-"+this.model.getName()),this.listenTo(this.model,"enter",this.onEnter),this.listenTo(this.model,"yachtMove",this.onYachtMove),this.listenTo(this.model.player,"change:level",this.updateLevel),this.listenTo(this.model.yachts,"change:level",this.onUpdateLevelYacht),this.listenTo(this.model.get("world"),"rewardChainBeforeTakePrize",this.onRewardChainBeforeTakePrize),this.listenTo(this.model.get("world"),"rewardChainAfterTakePrize",this.onRewardChainAfterTakePrize),this.renderStages(),this.renderPoints(),this.renderPlayers(),this.mapController=BigMapControllerFactory.create({el:this.$(".scrollWrapper"),bgEl:this.$(".map"),mainEl:this.$(".player1"),keyIntervalTime:15}),this.mapController.findMainElementCoord=(t=this.mapController.findMainElementCoord,function(){$("#main").addClass("regattaAlignTo");var e=t.apply(this,arguments);return $("#main").removeClass("regattaAlignTo"),e}),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.updateBoats()},isShowed:function(){return"main"===application.get("page")&&this.model.get("active")},onPlayLevel:function(){this.model.get("world").get("actionQueue").canAction()&&!this.model.get("world").get("actionQueue").isActive(StoryForceElement)||this.model.playLevel()},onExit:function(){this.model.exit()},updateLevel:function(){this.$(".mLevel").html(this.model.player.get("level"));var t="currentLevel"+this.model.player.get("level");$(".regatta").each(function(){var e=this.className.split(" ").filter(function(e){return!/^currentLevel[0-9]+$/.test(e)});e.push(t),this.className=e.join(" ")})},getViewByYacht:function(e){return _.findWhere(this.yachts,{model:e})},onUpdateLevelYacht:function(e){if(e!==this.model.player){var t=this.getViewByYacht(e);this.isShowed()?e.get("level")&&t.$el.ourAnimateExt({target:this.$(".mPoints .point"+e.get("level"))},1e3,"easeInOutSine"):e.get("level")?t.$el.alignToExt(this.$(".mPoints .point"+e.get("level"))):t.$el.alignToExt(this.$(".mPoints .startPoint"))}},onEnter:function(){this.updateLevel(),this.updateBoats()},updateBoats:function(){this.updatePositionPlayers(),this.mapController.focusMainElement(!0)},renderPoints:function(){for(var e=this.$(".mPoints"),t=1;t<=this.model.get("amountPoints")+1;++t)e.append($('<div class="point"></div>').addClass("point"+t).toggleClass("startPoint",t===this.model.get("startLevel")))},renderPlayers:function(){var o=this.$(".mPlayers"),a=$("#regattaTemplates .yacht");this.yachts=[],this.model.yachts.each(function(e){var t,i=new YachtView({model:e,el:a.clone().appendTo(o)});e.get("level")&&(t=this.$(".mPoints .point"+e.get("level"))),t&&!t.length||(t=this.$(".mPoints .startPoint")),i.$el.alignToExt(t),this.yachts.push(i)},this)},renderStages:function(){var t=$("#regattaTemplates .stagePrizeBox"),i=this.$(".mStagePrizes");this.model.stages.each(function(e){e.prizes.each(function(e){new RegattaPrizeView({model:e,el:t.clone().appendTo(i)})},this)},this)},onYachtMove:function(e,t,i){var o=this.getViewByYacht(t);if(o){var a=this,n=this.$(".mPoints .point"+i);return a.mapController.focusMainElement().then(function(){return new Promise(function(e){o.$el.ourAnimateExt({target:n},1e3,"easeInOutSine",e)})}).then(function(){return a.mapController.focusMainElement()})}},updatePositionPlayers:function(){this.model.yachts.each(function(e){var t=this.getViewByYacht(e);e.get("level")?t.$el.alignToExt(this.$(".mPoints .point"+e.get("level"))):t.$el.alignToExt(this.$(".mPoints .startPoint"))},this)},onRewardChainBeforeTakePrize:function(e,t){var i=this.getViewByYacht(this.model.player),o=$(".rewardChainContainer .level"+t);if(o.length)return new Promise(function(e){i.$el.ourAnimateExt({target:o,ajust:{left:o.width()/2,top:o.height()/2}},1e3,"easeInOutSine",e)})},onRewardChainAfterTakePrize:function(e,t){var i=this.getViewByYacht(this.model.player),o=this.$(".mPoints .point"+t);return new Promise(function(e){i.$el.ourAnimateExt({target:o},1e3,"easeInOutSine",e)})}}),YachtView=Backbone.View.extend({initialize:function(){this.$el.addClass("player"+this.model.get("number")),this.onUpdate(),this.listenTo(this.model,"change",this.onUpdate)},onUpdate:function(){this.$el.toggleClass("noPlayer",!this.model.get("userId")),this.$el.toggleClass("noPhoto",!this.model.get("avatarUrl")),this.$el.toggleClass("hasBattlePass",!!this.model.get("hasBattlePass")),this.$el.removeClass("place"+this.model.previous("place")).addClass("place"+this.model.get("place")),this.$el.removeClass("level"+this.model.previous("level")).addClass("level"+this.model.get("level")),this.$(".mLevel").html(this.model.get("level")),this.$(".mPhoto").attr("src",this.model.get("avatarUrl"))}}),RegattaPrizeView=Backbone.View.extend({events:{click:"showContent"},initialize:function(){this.$el.addClass("level"+this.model.get("level")).addClass("place"+this.model.get("place")),new UserPrizesView({el:this.$(".mPrizes"),model:this.model.get("prizes"),isGroup:!0}),this.update(),this.listenTo(this.model,"change:opened change:lost",this.update)},update:function(){this.$el.toggleClass("opened",this.model.get("opened")),this.$el.toggleClass("lost",Boolean(!this.model.get("opened")&&this.model.get("lost")))},showContent:function(){window.mobile&&new RegattaPrizeContentView({prizes:this.model.get("prizes"),place:this.model.get("place")})}}),RegattaTakePrizeWindow=TWindow.extend({templateClass:".regattaTakePrizeWindow_template",events:{"click .close":"close"},onOpen:function(){this.prize=this.options.prizes,this.regatta=this.options.regatta;var o=this.options.groupPrize;this.place=this.options.place,this.$(".windowTitle").html(messages[Config.bonusWorld.get("name")+"PrizePlaceWindowTitle"]);var e="consolation"==this.place?4:this.place;if(this.$(".text").html(messages[Config.bonusWorld.get("name")+"PrizePlaceWindowText"][e-1]),this.$(".prizes").empty(),this.$el.addClass("place"+this.place),this.prize){var i=this.prize.filter(function(e){return!e.networks||e.networks&&-1!==e.networks.indexOf(network)}),a=0;if(o)for(var t=function(t){var e=i.find(function(e){return"powerUp"===e.type&&e.name===Config.powerUpIdsOrder[t]});if(!e||a&&a!==e.amount)return o=!1,1;a=e.amount},n=0;n<Config.powerUpIdsOrder.length&&!t(n);++n);if(_.each(i,_.bind(function(e){if(!(o&&"powerUp"===e.get("type")||"gift"===e.get("type")&&void 0===Gifts||e.get("network")&&-1===e.get("network").indexOf(network))){var t=this.$(".invisible .bonusWorldOnePrize_"+e.get("cssClass"));0===t.length&&(t=this.$(".invisible .bonusWorldOnePrize"));var i=t.clone();e.get("amount")&&i.find(".amount").html("good"==e.get("type")?formatPeriod(60*e.get("amount"),!0):e.get("amount")),i.addClass(e.get("cssClass")),this.$(".prizes").append(i)}},this)),o){var r=this.$(".invisible .bonusWorldOnePrize");r.addClass("type-powerUp-group"),r.find(".amount").html(a),this.$(".prizes").append(r)}}},onClose:function(){var e=this;new AnimatedPrizesWindow({prizes:new UserPrizes(this.prize),worldName:Config.bonusWorld.name,onClose:function(){TWindow.prototype.onClose.call(e)}})}}),RandomLevelComponent=BonusWorldComponent.extend({defaults:{id:"randomLevel",lowerMargin:1,upperMargin:10,useLevelSet:!1,saveReplayLevel:!1},initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.world.addConverter("levelsOrder",function(e){return(e||[]).join(",")},function(e){return e?e.split(","):[]}),this.get("useLevelSet")&&this.world.set("levelsOrder",[]),this.listenTo(this.world,"completeLevel",this.onCompleteLevel)},init:function(){this.get("useLevelSet")&&this.world.get("levelsOrder")&&this.world.get("levelsOrder").length<=0&&this.createLevelSet()},createLevelSet:function(){for(var e=[],t=this.get("lowerMargin");t<=this.get("upperMargin");++t)e.push(t);this.world.set("levelsOrder",_.shuffle(e)),this.save()},getLevel:function(){var e;return this.world.get("replayLevel")&&0<this.world.get("replayLevel")&&(e=this.world.get("replayLevel")),e||(this.get("useLevelSet")?(this.world.get("levelsOrder").length<=0&&this.createLevelSet(),e=this.world.get("levelsOrder").shift()):e=this.getRandomLevelNum(),this.world.set("replayLevel",e)),this.save(),e},onCompleteLevel:function(){this.world.get("saveReplayLevel")&&this.world.getCurrentLevel()>this.get("lowerMargin")&&(this.world.set("replayLevel",0),this.save())},getLowerMargin:function(){return this.get("lowerMargin")},getRandomLevelNum:function(){return _.random(this.get("lowerMargin"),this.get("upperMargin"))},save:function(){var e=[];this.get("trackProgress")&&e.push("progress"),this.get("useLevelSet")&&e.push("levelsOrder"),this.get("saveReplayLevel")&&e.push("replayLevel"),this.world.saveSelectedOptions(e)}}),RandomEpisodeLevelComponent=BonusWorldComponent.extend({defaults:{id:"randomNoRepeatLevel",beginLevelOffset:1,endLevelOffset:20,updateSeedInterval:100},initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.world.addConverter("randomLevelSeed",function(e){return e||1},function(e){return e}),this.listenToOnce(this.world,"configure",this.configure),this.listenToOnce(this.world,"preloadEpisode",this.loadBonusWorldData),this.listenTo(this.world,"winLevel",this.onCompleteLevel)},loadBonusWorldData:function(e){var i=this;return this.prepare().then(function(){for(var e=i.world.get("progress")%i.get("updateSeedInterval"),t=0;t<=e;t++)i.nextLevelNum()})},onCompleteLevel:function(){this.world.get("progress")%this.get("updateSeedInterval")==0&&(this.resetGenerator(),this.save()),this.nextLevelNum()},prepare:function(){var d=this;this.excludedLevels=[],this.usedLevels=[];var e=parseInt(this.world.get("randomLevelSeed")),t=parseInt(this.world.get("lastEpisode"));return e&&t?(this.seedRandomizer=createSeedRandomizer(e),this.lastEpisode=t):(this.resetGenerator(),this.save()),loadLevelJSON({levelsInfo:"//gems-ok.akamaized.net/gems/gems/lib/levels/levelsInfo.e7c5e5fe6b.json"}).then(function(e){var t=e.levelsInfo.forceLevels;for(var i in t){var o,a=_createForOfIteratorHelper(t[i]);try{for(a.s();!(o=a.n()).done;){var n=o.value,r=d.get("beginLevelOffset"),s=Config.levelsInEpisode*d.lastEpisode-d.get("endLevelOffset"),l=n+Config.levelsInEpisode*(i-1);r<=l&&l<=s&&d.excludedLevels.push(l)}}catch(e){a.e(e)}finally{a.f()}}})},resetGenerator:function(){this.usedLevels=[],this.lastEpisode=Config.episodesAmount,this.world.set("lastEpisode",this.lastEpisode);var e=Math.round(268435456*Math.random());this.world.set("randomLevelSeed",e),this.seedRandomizer=createSeedRandomizer(e)},getCurrentLevelNum:function(){return this.usedLevels[this.usedLevels.length-1]},nextLevelNum:function(){var e=this.get("beginLevelOffset"),t=Config.levelsInEpisode*this.lastEpisode-this.get("endLevelOffset"),i=t-e+1,o=Math.round(this.seedRandomizer()*(t-e))+e;if(this.usedLevels.length+this.excludedLevels.length<i){for(var a=0;a<=i&&(-1!==this.usedLevels.indexOf(o)||-1!==this.excludedLevels.indexOf(o));)o=(o-e+1)%i+e,a++;i<=a&&console.warn("[RandomNoRepeatLevel]   while!"),this.usedLevels.push(o)}else console.warn("[RandomNoRepeatLevel]    !");return o},save:function(){this.world.saveSelectedOptions(["randomLevelSeed","lastEpisode"])}}),ResetProgressComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"resetProgress"},BonusWorldComponent.prototype.defaults),init:function(){application.on("game_fail",this.onFailLevel,this),this.world.on("enter",this.onEnter,this),this.world.on("exit",this.onExit,this),this.livesController=this.world.livesController},onEnter:function(){this.tryReset(),application.on("windowOpened",this.onOpenWindow,this)},onExit:function(){application.off("windowOpened",this.onOpenWindow,this)},onFailLevel:function(){var e=this;application.waitPage("main").then(function(){e.tryReset()})},tryReset:function(){0==this.livesController.getLives()&&this.resetProgress()},resetProgress:function(){var e=this.world.get("livesInstance");e&&e.addLifeRequest(this.world.get("livesInstance").get("maxLives")),this.world.set("progress",1),episode.scores.remove(episode.scores.filter(function(e){return 1<=e.get("level")})),episode.scores.reset(),this.world.save(),this.world.trigger("progressReseted")},onOpenWindow:function(e){if(Game){var t=e.$(".lives");if(t){e.$(".livesContent .description").html(messages[Config.bonusWorld.get("name")+"PersuadeBuyMovesWindow"].text);for(var i=1;i<=this.livesController.getLives()+1;i++){var o=$('<div class="live live'.concat(i,'"></div>'));i<=this.livesController.getLives()?t.append(o):Game.get("isPlaying")&&(t.append(o),o.addClass("currentLive"))}}}}}),WorldInfoButton=Backbone.View.extend({events:{click:"onOpen"},onOpen:function(){new WorldInfo({world:this.model})}}),WorldInfo=TWindow.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.get("name");this.$(".description2").html(messages[e+"HelpWindowDescription1"]||""),this.$(".description3").html(messages[e+"HelpWindowDescription2"]||""),this.$(".description4").html(messages[e+"HelpWindowDescription3"]||""),this.$(".description5").html(messages[e+"HelpWindowDescription4"]||""),this.$(".pressToClose").html(messages[e+"HelpWindowExitButton"]||"");var t=this.options.world.cmp("prizes");t&&new UserPrizesView({isGroup:!0,el:this.$(".mPrizes"),model:t.getFinalPrize().getUserPrizes()})}}),PrizeLevelIntervalComponent=BonusWorldComponent.extend({defaults:{id:"prizeLevelInterval",intervalLevels:20,startIntervalLevel:20,world:null,prizes:[]},initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.listenTo(this.world,"completeLevel",this.onCompleteLevel)},getPoints:function(){return(this.world.get("progress")-1)%this.get("intervalLevels")},getMaxPoints:function(){return this.get("intervalLevels")},onCompleteLevel:function(){var e=this.world.get("progress");this.trigger("changePoints",e),Game&&e>=this.get("startIntervalLevel")&&e%this.get("intervalLevels")==1&&this.takePrize()},takePrize:function(){var e=this.get("prizes"),t=e[Math.floor(Math.random()*e.length)],i=new UserPrizes(t.products);new AnimatedPrizesWindow({prizes:i,world:this.world.get("name")}),Game&&Game.cancelNext()}}),TicketsComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"tickets",name:null,initialAmount:0},BonusWorldComponent.prototype.defaults),constructor:function(e,t){BonusWorldComponent.call(this,_.assign({tickets:new ObscureNumber(0),name:t.get("name")},e),t)},init:function(){this.world.on("start",this.onStart,this)},onStart:function(){this.setTickets(this.get("initialAmount"))},loadBonusWorldData:function(e){this.set({tickets:new ObscureNumber(e&&parseInt(e[this.get("id")])||0)})},addTickets:function(e){this.setTickets(this.getTickets()+e),user.set({actionName:"add tickets "+this.get("id"),actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:e})},setTickets:function(e){this.set("tickets",new ObscureNumber(e)),this.save()},getTickets:function(){return this.get("tickets").get()},charge:function(e){var t=this;return Promise.resolve().then(function(){t.setTickets(t.getTickets()-e)})},getAmount:function(){return Promise.resolve(this.getTickets())},save:function(){return service("../../../gems/site/service/tickets/savedata.php",{eventName:this.get("name"),name:this.get("id"),tickets:this.get("tickets").get()}).catch(function(e){console.error(e)})},ingredient:function(){return{type:"IngredientTickets",component:this,amount:0<arguments.length&&void 0!==arguments[0]?arguments[0]:1}}}),ApplicationTicketsComponent=TicketsComponent.extend({init:function(){TicketsComponent.prototype.init.call(this),$("#main").addClass("tickets-enable"),application.preloader.add(new PreloadTask({name:"loadTickets",parent:"authorization",task:_.bind(function(e){this.load().then(e)},this)})),this.ticketsView=new TicketsView({el:$(".mainTemplates .tickets").clone().appendTo("#main"),model:this}),this.get("addRandomToBonusLevel")&&application.on("initMapBonusLevel",function(e,t){t&&t.prize&&(t.prize=t.prize.filter(function(e){return"tickets"!==e.type}),t.prize.push({type:"tickets",cssClass:"tickets",amount:RANDOM(_.range(this.get("addRandomToBonusLevel")[0],this.get("addRandomToBonusLevel")[1]+1))}))},this),application.on("run",function(){if(new Date("2020/06/03").getTime()/1e3<application.getCurrentServerTime()){var e=getLocalStorage("showedIcketInfo",0);if(e&&application.getCurrentServerTime()-e<172800)return}setLocalStorage("showedIcketInfo",application.getCurrentServerTime()),new TicketInfo({world:this.world})},this)},load:function(){return service("../../../gems/site/service/tickets/loaddata.php",{eventName:this.get("name"),tickets:this.get("tickets").get()}).then(_.bind(function(e){this.set({tickets:new ObscureNumber(e&&e.tickets||0)})},this)).catch(function(e){console.error(e)})}}),TriesReminderWindow=BaseCogentWindow.extend({onOpen:function(){BaseCogentWindow.prototype.onOpen.call(this),$(".numberOfPoints").html(this.options.points)}}),TriesConditionerPresets={levelMatch:{isTryValid:function(e,t){return t===e.world.getCurrentLevel()},canGivePrize:function(e,t){return t===e.world.getCurrentLevel()}},upToLevel:{isTryValid:function(e,t){return t<=e.world.getCurrentLevel()},canGivePrize:function(e,t){return t<=e.world.getCurrentLevel()}},alwaysTrue:{isTryValid:function(e,t){return!0},canGivePrize:function(e,t){return!0}}},TriesComponent=BonusWorldComponent.extend({defaults:_.defaults({id:"tries",conditioner:TriesConditionerPresets.levelMatch,showCogentWindowOnFail:!0,validatorGame:function(e,t){return episode.isBonusWorld()&&episode.get("num")===e.get("name")}},BonusWorldComponent.prototype.defaults),initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e)},init:function(e,t){var i=this;return Promise.resolve().then(function(){application.on("beforeGameStart",i.onBeforeGameStart,i)})},onBeforeGameStart:function(e){this.activated=!1,this.get("validatorGame")(this.world,e)&&this.world.isAvailability()&&this.get("conditioner").isTryValid(this,application.level.num)&&(this._prevPrize=null,this.game=e,this.activated=!0,this.addTries(),this.game.on("fail",this.onFailGame,this),this.game.on("win",this.onCompleteLevel,this),application.on("game_win",this.onWinGame,this),application.on("windowShow",this.onShowWindow,this))},onFailGame:function(e){this.disableGameListeners()},onWinGame:function(e){this.disableGameListeners()},disableGameListeners:function(){this.game.off("fail",this.onFailGame,this),this.game.off("win",this.onCompleteLevel,this),application.off("game_win",this.onWinGame,this),application.off("windowShow",this.onShowWindow,this)},loadBonusWorldData:function(e){this.set({tries:new ObscureNumber(e&&e.tries||0)})},getTries:function(){return this.get("tries").get()},onCompleteLevel:function(){if(this.get("conditioner").canGivePrize(this,application.level.num)){var e=this.getPrize();(this._prevPrize=e)&&(this.trigger("prizeCollected",new Prize({products:e})),e.take(),this.reset())}},getPrevPrize:function(){return this._prevPrize},getPrize:function(){var t=this,i=this.getTries(),e=this.get("variants").sort(function(e,t){return e.tries-t.tries}).filter(function(e){return e.tries>=i});if(0<e.length){var o=e[0].prizes;return e[0].prizes.products&&(o=UserPrizes.convertFromCocos(e[0].prizes)),o.forEach(function(e){e.world=t.world.get("name")}),new UserPrizes(o)}},addTries:function(e){this.set("tries",new ObscureNumber(this.get("tries").get()+(e||1))),this.save()},reset:function(){this.set("tries",new ObscureNumber(0)),this.save()},save:function(){return service("../../../gems/site/service/tries/savedata.php",{eventName:this.world.get("name"),tries:Math.min(255,this.get("tries").get())})},onShowWindow:function(e){if(e instanceof StatisticWindow)this.onShowStatisticWindow(e);else if(this.hasAnythingCollected()){var t,i=this.getPrize().first();if(i){t=i.get("amount")||0;var o=e.$(".collectablesBlock");if(0<t){e.$el.addClass("triesCollected");var a=$(".invisible .collectablesContainer .gameCollectable").clone();a.addClass("triesPrize"),a.find(".amount").html(t),a.appendTo(o)}}}},onShowStatisticWindow:function(e){var t=this.getPrevPrize();if(t){e.$el.addClass("triesCollected");var i=$(".invisible .collectablesContainer .gameCollectable").clone();i.addClass("triesPrize").appendTo(e.$(".collectablesBlock")),i.find(".amount").html(t.first().get("amount"))}},hasAnythingCollected:function(){return this.get("reminderWindowThreshold")&&this.getTries()<this.get("reminderWindowThreshold")&&this.activated}}),TriesInfoButton=Backbone.View.extend({events:{click:"onOpen"},onOpen:function(){new TriesInfo({world:this.model})}}),TriesInfo=TWindow.extend({events:_.defaults({click:"close"},TWindow.prototype.events),templateClass:".ticketsInfoWindow_template",onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.getComponent(PrizeController);this.$(".mTickets").html(e.getPoints());var t=this.options.world.getComponent(TriesComponent);if(t){var i=this.$(".mVariants"),o=this.$(".mTemplates .variant");t.get("variants").forEach(function(e){var t=o.clone().appendTo(i);t.addClass("variant"+e.tries),new UserPrizesView({el:t.find(".mPrizes"),model:new UserPrizes(UserPrizes.convertFromCocos(e.prizes))}),t.find(".mTries").html(e.tries)})}}}),TicketsView=Backbone.View.extend({initialize:function(){this.$el.addClass("tickets-"+this.model.get("id")),this.listenTo(this.model,"change:tickets",this.updateTickets)},updateTickets:function(){this.$(".mTickets").html(this.model.getTickets())}}),TicketInfoButton=Backbone.View.extend({events:{click:"onOpen"},onOpen:function(){new TicketInfo({world:this.model})}}),TicketInfo=TWindow.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.getComponent(TicketsComponent);e&&this.$(".mTickets").html(e.getTickets());var t=this.options.world.getComponent(TriesComponent);if(t){var i=this.$(".mVariants"),o=this.$(".mTemplates .variant");t.get("variants").forEach(function(e){var t=o.clone().appendTo(i);t.addClass("variant"+e.tries),new UserPrizesView({el:t.find(".mPrizes"),model:new UserPrizes(e.prizes.products)}),t.find(".mTries").html(e.tries)})}var a=this.options.world.get("name"),n=this.$(".description1");n.html(messages[a+"TicketLevelTry"]||"");var r=messages[a+"TicketLevelTryF"];r&&n.append('<div class="description1f">'+r+"</div>");var s=messages[a+"TicketLevelTryS"];s&&n.append('<div class="description1s">'+s+"</div>"),this.$(".description2").html(messages[a+"TicketLevelPass"]||""),this.$(".description3").html(messages[a+"TicketResult"]||""),this.$(".description4").html(messages[a+"TicketRewards"]||""),this.$(".ticketsHeader").html(messages[a+"TicketAttempts1"]||""),this.$(".ticketsInfo").html(messages[a+"TicketAttempts2"]||""),this.$(".ticketsInfo2").html(messages[a+"TicketAttempts3"]||""),this.$(".ticketsInfo3").html(messages[a+"TicketAttempts4"]||""),this.options.world.get("withOwnGacha")&&(this.$el.addClass("withGacha"),this.$(".mItem4").addClass("active"),this.$(".mDescription4").addClass("active"),this.$(".mDescription4").html(messages.gachaText)),this.$(".pressToClose").html(messages[a+"TicketExitButton"]||"")}}),BaseTimerComponent=function(e){_inherits(a,BonusWorldComponent);var o=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=o.call(this,e,t))._timer=new Timer,t.timer=i._timer,i._timer.on("finish",i.onTimer,_assertThisInitialized(i)),i._timerStart=new Timer,i._timerStart.on("finish",i.onTimerStart,_assertThisInitialized(i)),i}return _createClass(a,[{key:"getTimer",value:function(){return this._timer}},{key:"isActive",value:function(){return this._timer.isActive()}},{key:"onTimer",value:function(){}},{key:"onTimerStart",value:function(){}}]),a}();BaseTimerComponent.prototype.defaults=_.defaults({id:"timer"},BonusWorldComponent.prototype.defaults);var TimekeeperComponent=function(e){_inherits(i,BaseTimerComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(){var e=this;return Promise.resolve().then(function(){return _get(_getPrototypeOf(i.prototype),"init",e).call(e)}).then(function(){e.world.cmp("data").bind(e,{name:"beginDate",converter:new DateConverter},{name:"finished",converter:new BooleanConverter})}).then(function(){e.listenTo(e.world,"afterInit",e.check)})}},{key:"check",value:function(){var i=this;return Promise.resolve().then(function(){if(i.get("beginDate")&&(i.world.set("firstStart",!1),i.getDuration()<=0&&!i.get("finished")))return i.world.set("active",!1),new Promise(function(e){i.world.isEntered()?i.world.actionQueue.wait().then(function(){return i.world.exit()}).then(function(){return e()}):e()}).then(function(){return i.onFinish()}).then(function(){i.set("finished",!0)})}).then(function(){if(!(0<i.getDuration())){var e=parseInt(application.getCurrentServerTime()-Math.round(i.get("originDate").getTime()/1e3));if(e<0)i._timerStart.setTimer(-e);else{var t=e%util.duration(i.get("cooldown"));if(t<util.duration(i.get("duration")))return Promise.resolve().then(function(){return i.restartWorld(new Date(1e3*application.getCurrentServerTime()-1e3*t))});i._timerStart.setTimer(util.duration(i.get("cooldown"))-t)}}}).then(function(){var e=i.getDuration();0<e&&(i._timer.setTimer(e),i.world.set("active",i.world.isAvailabilityEnter()))})}},{key:"reset",value:function(){this.set({beginDate:null,finished:!1})}},{key:"setBeginDate",value:function(e){this.set("beginDate",e);var t=this.getDuration();0<t&&(this._timer.setTimer(t),this.world.set("active",this.world.isAvailabilityEnter()))}},{key:"restartWorld",value:function(e){var t=this;return Promise.resolve().then(function(){return t.world.reset()}).then(function(){return t.setBeginDate(e),t.onStart()})}},{key:"onStart",value:function(){return this.world.emit("start",this.world,this)}},{key:"onFinish",value:function(){return this._timerStart.setTimer(util.duration(this.get("cooldown"))),this.world.emit("finish",this.world,this)}},{key:"getDuration",value:function(){return this.get("beginDate")?parseInt(util.duration(this.get("duration"))-(application.getCurrentServerTime()-this.get("beginDate").getTime()/1e3)):0}},{key:"onTimer",value:function(){this.check()}},{key:"onTimerStart",value:function(){this.check()}}]),i}();TimekeeperComponent.prototype.defaults=_.defaults({beginDate:null,finished:!1,duration:"5d",originDate:new Date("2022-06-07T00:00:00.002Z"),cooldown:"14d"},BaseTimerComponent.prototype.defaults);var ShootingRangeComponent=BonusWorldComponent.extend({defaults:{id:"shootingRange"},init:function(){var t=this;return this.world.on("onAfterFinishLevel",this.onWinLevel,this),this.levels={},this.load(),this.world.once("preloadEpisode",function(e){e.scores.forEach(function(e){t.levels[e.level]&&0<t.levels[e.level].length||(t.levels[e.level]=[{angle:parseFloat(Math.random().toFixed(2)),stars:e.stars}])})}),BonusWorldComponent.prototype.init.call(this)},onWinLevel:function(e,t,i,o){var a=this,n=episode.scores.findWhere({level:t}).calcStarsInternal(i.get("score"));Promise.resolve().then(function(){return a.shot(t,n)}).then(function(){if(o)return a.openNextTarget(t+1)})},openNextTarget:function(e){return this.emit("openTarget",e)},shot:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.levels[e]||[],o={angle:parseFloat(Math.random().toFixed(2)),stars:t};return i.push(o),this.levels[e]=i,this.save(),this.emit("shot",e,o)},reset:function(){return setLocalStorage(this.world.get("name")+"_"+this.get("id"),""),Promise.resolve()},save:function(){setLocalStorage(this.world.get("name")+"_"+this.get("id"),this.serialize())},load:function(){this.parse(getLocalStorage(this.world.get("name")+"_"+this.get("id"),""))},serialize:function(){var e=_.map(this.levels,function(e,t){return[t,e.map(function(e){return[e.angle,e.stars]})]}).filter(function(e){return 0<e[1].length});return JSON.stringify(e)},parse:function(e){var a=this;e&&(this.levels={},JSON.parse(e).forEach(function(e){var t=_slicedToArray(e,2),i=t[0],o=t[1];a.levels[i]=o.map(function(e){return{angle:e[0],stars:e[1]}})}))}}),ShootingRangeView=Backbone.View.extend({initialize:function(){},onEnter:function(){this.model.on("shot",this.onShot,this),this.model.on("openTarget",this.onOpenTarget,this),application.on("pinsUpdated",this.update,this)},onExit:function(){this.model.off("shot",this.onShot,this),this.model.off("openTarget",this.onOpenTarget,this),this.$(".levels .level .hits").remove(),application.off("pinsUpdated",this.update,this)},update:function(){var i=this;this.$(".levels .level").each(function(e,t){$('<div class="hits"></div>').appendTo(t),i.model.levels[t.dataset.level]&&i.model.levels[t.dataset.level].forEach(function(e){return i.drawHit(t.dataset.level,e)})})},drawHit:function(e,t){var i=7*(3-t.stars),o=(Math.sin(2*Math.PI*t.angle)*i).toFixed(2),a=(Math.cos(2*Math.PI*t.angle)*i).toFixed(2);this.$(".levels #level"+e+" .hits").append('<div class="hit stars'+t.stars+'" style="left:'+o+"px;top:"+a+'px"></div>')},onShot:function(e,t){this.drawHit(e,t)},onOpenTarget:function(e){var i=this;return new Promise(function(t){i.$(".levels #level"+e).addClass("opening").delay(2e3).queue(function(e){$(this).removeClass("opening"),e(),t()})})}}),ChangeoverComponent=BonusWorldComponent.extend({defaults:{id:"changeover",causes:[],effects:[],applyInStories:!1},initialize:function(e){this.set({causes:e.changeoverCauses,effects:e.changeoverEffects,applyInStories:e.applyInStories}),this.world.addConverter("changeoverDate",function(e){return e},function(e){return e?new Date(e):null}),BonusWorldComponent.prototype.initialize.call(this,e)},init:function(){var t=this;this.get("causes").forEach(function(e){t.get("applyInStories")?e.on("changeover",t.onChangeover,t):e.on("changeover",t.applyEffects,t),e.init(t)})},addEffect:function(e){this.get("effects").push(e)},addCause:function(e){this.get("causes").push(e),e.init(this),this.get("applyInStories")?e.on("changeover",this.onChangeover,this):e.on("changeover",this.applyEffects,this)},getCause:function(t){return _.find(this.get("causes"),function(e){return e instanceof t})},restart:function(){return this.set("activated",!1),Promise.all(this.get("causes").map(function(e){return e.restart()}))},applyEffects:function(){var e=this;return this.get("activated")?Promise.resolve():(Game&&Game.cancelNext(),this.set("activated",!0),Promise.resolve().then(function(){return e.world.waitPage("main")}).then(function(){return e.world.emit("changeover")},this.world).then(function(){return e.get("effects").reduce(function(e,t){return e.then(function(){return t.run()})},Promise.resolve())}).then(function(){return e.restart()}).catch(function(e){console.error("[ChangeoverComponent]  ",e)}))},onChangeover:function(){this.trigger("changeover")}}),TakePrizeView=Backbone.View.extend({initialize:function(e){this.options=e,this.setElement(this.options.el)},render:function(){var e=$(".mainTemplates .takePrizeViewPrize").clone(),t=this.options.product;e.addClass(t.get("cssClass")).addClass(t.get("componentId")).addClass(t.get("type")).addClass(t.get("name")),this.options.el.find(".prizes").append(e)},renderTarget:function(){var e=this.options.$target;e.addClass("compress"),setTimeout(function(){e.removeClass("compress")},this.options.duration+500)},takePrize:function(){var t=this;return new Promise(function(e){t.render(),t.options.$target&&t.renderTarget(),setTimeout(function(){t.$el.find(".prizes").html(""),e()},t.options.duration)})}}),ExactArtifactPartProductTakePrizeView=TakePrizeView.extend({initialize:function(e){TakePrizeView.prototype.initialize.call(this,e),this.type="ExactArtifactPartProduct"},render:function(){var i=this;this.options.product.forEach(function(e){var t=$(".mainTemplates .takePrizeViewPrize").clone();t.addClass(e.get("cssClass")).addClass(e.get("componentId")).addClass(e.get("type")).addClass(e.get("name")),i.options.el.find(".prizes").append(t)})}}),PrizePointsProductTakePrizeView=TakePrizeView.extend({initialize:function(e){TakePrizeView.prototype.initialize.call(this,e),this.type="PrizePointsProduct"},render:function(){var e=$(".mainTemplates .takePrizeViewPrize").clone(),t=this.options.product;e.addClass(t.get("cssClass")).addClass(t.get("componentId")).addClass(t.get("type")).addClass(t.get("name"));var i=e.find(".amount");i.removeClass("invisible").addClass("visible"),i.html("x"+this.options.product.get("amount")),this.options.el.find(".prizes").append(e)}}),TicketsPrizeView=TakePrizeView.extend({initialize:function(e){TakePrizeView.prototype.initialize.call(this,e),this.type="TicketsProduct"},render:function(){var e=$(".mainTemplates .takePrizeViewPrize").clone(),t=this.options.product;e.addClass(t.get("cssClass")).addClass(t.get("componentId")).addClass(t.get("type")).addClass(t.get("name"));var i=e.find(".amount");i.removeClass("invisible").addClass("visible"),i.html("x"+this.options.product.get("amount")),this.options.el.find(".prizes").append(e)}}),TakePrizeAnimationWindow=TWindow.extend({templateClass:".takePrizeAnimationWindow_template",onOpen:function(){var a=this;TWindow.prototype.onOpen.call(this);var e=this.prepareProducts(this.options.prize.get("products").toArray()),n=Promise.resolve(),t=this.options.container?this.options.container():this.$el,r=$(".mainTemplates .takePrizeView").clone().appendTo(t);return r.addClass(this.options.world.getName()),e.forEach(function(e){var t=e instanceof Array?e[0].get("type"):e.get("type"),i=a.createTakePrizeView(t,{el:r,model:a.model,product:e,duration:a.options.animationConfig[t].duration,$target:a.options.animationConfig[t].target()}),o=a.options.animationConfig[t].after;n=n.then(function(){return i.takePrize().then(o)})}),n.then(function(){return new Promise(function(e){r.find(".prizeBackground").addClass("hide"),setTimeout(e,500)})}).then(function(){r.remove()}).then(function(){return a.close()})},shadowOpenAnimation:function(){},shadowCloseOpenAnimation:function(){},prepareProducts:function(e){var t=this,i=[],o={};for(var a in e.forEach(function(e){t.options.animationConfig[e.get("type")].combine?(o[e.get("type")]||(o[e.get("type")]=[]),o[e.get("type")].push(e)):i.push(e)}),o)i.push(o[a]);return i},createTakePrizeView:function(e,t){switch(e){case"ExactArtifactPartProduct":return new ExactArtifactPartProductTakePrizeView(t);case"PrizePointsProduct":return new PrizePointsProductTakePrizeView(t);case"TicketsProduct":return new TicketsPrizeView(t);default:return new TakePrizeView(t)}}}),TakePrizeAnimationComponent=BonusWorldComponent.extend({defaults:{id:"takePrizeAnimation",componentsId:["collectors"]},initialize:function(e){var t=this;Backbone.Model.prototype.initialize.call(this,e),this.get("componentsId").forEach(function(e){t.get("world").hasComponent(e)&&t.get("world").getComponent(e).on("prizeCollected",t.onPrizeCollected,t)}),this.get("page")||this.set("page",this.world.getPageName())},onPrizeCollected:function(e){var t=this;this.lastPrize=e,this.needShow(e)&&application.waitPage(this.get("page")).then(function(){t.get("page")===application.get("page")&&e===t.lastPrize&&t.animateTakePrize(e)})},animateTakePrize:function(e){new TakePrizeAnimationWindow({prize:e,animationConfig:this.get("animationConfig"),container:this.get("container"),world:this.world})},needShow:function(e){return e&&0<e.getProducts().length}}),powerupAnimations={arrowDirections:{"-":"Hor","|":"Vert","+":"Both"},animateArrowCell:function(t,e,i,o){t.set("fullRunning",!1);var a=t.animate(),n=this.arrowDirections[i]||"Both",r=e.x<Config.cols/2?1:-1,s=$('<div class="arrowBottle arrowBottle'+n+'"></div>'),l=e.$div.offset(),d=$(".blockedAnimations"),c=d.offset(),g={left:l.left-c.left,top:l.top-c.top},u={left:r<0?0:canvas.width,top:.8*canvas.height},h={left:g.left,top:g.top};s.css({left:u.left+"px",top:u.top+"px",opacity:0});var p={start:{x:u.left,y:u.top,angle:45*r,length:1},end:{x:h.left,y:h.top,angle:-70*r,length:.2}};d.append(s),s.animate({opacity:1},{duration:700*.7,queue:!1}),s.animate({rotate:"360deg"},{duration:700,queue:!1}),s.animate({path:new $.path.bezier(p)},700,"linear",function(){s.addClass("arrowPowerupProcess"),s.delay(400).queue(function(e){s.delay(300).remove(),o(),t.set("fullRunning",!0),a(),e()})})}},PowerupMakerProgressBlockDecorator=Backbone.View.extend({render:function(){var e=this;this.$el.addClass(this.model.get("name"));var t=this.model.get("currentStage"),i=this.model.getMaxStage(),o=$(".mainTemplates .progressBlock").clone();this.$el.append(o),t?this.$(".rightBlock").addClass("hat"+t):this.$(".rightBlock").hide();var a=o.find(".progressBar"),n=a.width();a.width(n*t/i),this.$(".progressLabel").html(t+"/"+i),o.click(function(){e.model.showEventWindow({urgent:!0})})}}),PowerupMakerStartWindowDecorator=PowerupMakerProgressBlockDecorator.extend({render:function(){PowerupMakerProgressBlockDecorator.prototype.render.call(this),this.$el.addClass(this.model.get("name"));var e=this.model.get("currentStage");e&&this.$(".storyteller").addClass("hatPirate"+e)}}),PowerupMakerExitWindowDecorator=Backbone.View.extend({render:function(){this.$el.addClass(this.model.get("name")),this.$("#exitGame").html(messages.outOfMovesExit),this.$("#continueGame").html(messages.ContinueGame);var e=messages[this.model.get("name")];this.$(".windowTitle").html(e.eventTitle),this.$(".bottomText").html(e.loseProgress);var t=this.model.get("lastStage");this.renderPirate(t),this.renderReward(t)},renderPirate:function(e){var t=$('<div class="pirate'+e+'"></div>');this.$(".specialContent").append(t)},renderReward:function(e){var t=$('<div class="chest'+e+'"></div>');this.$(".specialContent").append(t);var i=$('<div class="reward'+e+'"></div>');this.$(".specialContent").append(i)}}),PowerupMakerWindow=TWindow.extend({templateClass:".powerupMakerEventWindow_template",events:{"click .okayBtn":"close","click .close":"close"},render:function(){this.$el.addClass(this.model.get("name"));var e=messages[this.model.get("name")];this.$(".windowTitle").html(e.eventTitle),this.$(".okay").html(e.okay),this.$(".description").html(e.description),this.renderTimer(),this.renderRewardState()},renderTimer:function(){clearTimeout(this.timer),this.timer=setTimeout(_.bind(this.renderTimer,this),1e3),this.$(".timer").html(this.model.getFormattedTimer())},renderRewardState:function(){var e=this.model.get("currentStage");0<e?(this.$(".reward"+e).addClass("opened"),this.$(".pirate").addClass("reward"+e)):this.$(".pirate").addClass("hided")},onOpen:function(){this.render()},onClose:function(){clearTimeout(this.timer)}}),PowerupMakerAvatarDecorator=Backbone.View.extend({clearStage:function(){for(var e=$("#user .userCard"),t=this.model.get("stagePowerupGroups").length,i=1;i<=t;i++)e.removeClass("hatStage"+i);e.removeClass("captainHat")},updateStage:function(){this.clearStage();var e=$("#user .userCard");e.addClass("captainHat");var t=this.model.get("currentStage");t&&e.addClass("hatStage"+t)}}),PowerupMakerButton=Backbone.View.extend({events:{"click .target":"open","touchend .target":"open"},initialize:function(){this.$el.addClass(this.model.get("name")),this.render(),this.listenTo(this.model,"change:active",this.render)},render:function(){this.$el.toggleClass("active",this.model.get("active")),this.renderTimer()},renderTimer:function(){this.model.get("active")&&(clearTimeout(this.timer),this.timer=setTimeout(_.bind(this.renderTimer,this),1e3),this.$(".timer").html(this.model.getFormattedTimer()))},open:function(){this.model.showEventWindow()}}),PowerupGenerator=Backbone.Model.extend({powerupTypes:{arrowBoth:"+",arrowVertical:"|",arrowHorizontal:"-",arrowRandom:["-","|"]},prepare:function(e,t){this.preparePowerups(t),this.listenToOnce(e,"change:fullRunning",_.bind(this.onStartGame,this,e))},preparePowerups:function(e){this.powerupCells=[];var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.type&&o.amount){var a=this.powerupTypes[o.type];if(a)for(var n=o.amount,r=0;r<n;r++)Array.isArray(a)?this.powerupCells.push(a[Math.floor(Math.random()*a.length)]):this.powerupCells.push(a)}}}catch(e){i.e(e)}finally{i.f()}},addPowerupsNow:function(e,t){this.preparePowerups(t),this.createPowerups(e)},onStartGame:function(e){var t=this;this.waitAnimations(e).then(function(){t.createPowerups(e)})},waitAnimations:function(t){var i=this;return new Promise(function(e){i.hasGameAnimations(t)?i.listenTo(t,"change:fullRunning",function(){i.hasGameAnimations(t)||(i.stopListening(t),e())}):e()})},hasGameAnimations:function(e){return e.isAnimationRunning()},createPowerups:function(i){for(var o=this,a=[],e=function(){var t=[];i.each(function(e){e.constructor!==Cell||e.decorator||e.attribute||-1!==a.indexOf(e)||t.push(e)});var e=t[_.random(0,t.length-1)];e&&(a.push(e),o.processChangeCell(i,e,o.powerupCells[n]))},n=0;n<this.powerupCells.length;n++)e()},processChangeCell:function(e,t,i){var o,a=CellsRegistry.getCellType(i);o=a===ArrowCell?new a(t.y,t.x,!1,i,t.color):new a(t.y,t.x,!1,t.color),powerupAnimations.animateArrowCell(e,t,i,function(){e.field[t.y][t.x].remove(),e.addItem(o,!0)})}}),StagePowerupMakerComponent=Backbone.Model.extend({defaults:{name:"powerupMaker",duration:86400,availability:{minLevel:22,weekDays:[1,2,3,4,5]},gameTypes:["move"],currentStage:0,lastStage:0,startTime:0,stagePowerupGroups:[{stage:1,powerups:[{type:"arrowRandom",amount:1}]},{stage:2,powerups:[{type:"arrowRandom",amount:1},{type:"arrowBoth",amount:1}]},{stage:3,powerups:[{type:"arrowRandom",amount:2},{type:"arrowBoth",amount:1}]}],active:!1},initialize:function(){var e=this;Application.once("ready",function(){return e.init()}),application.powerupMaker=this},init:function(){var e=this;this.powerupGenegator=new PowerupGenerator,this.loadFromServer().then(function(){return e.waitAvailable()}).then(function(){return e.prepare()})},prepare:function(){this.getTimer()||this.reset(),this.prepareListeners(),this.showEventWindow(),this.avatarDecorator=new PowerupMakerAvatarDecorator({model:this}),this.avatarDecorator.updateStage(),this.addShield(),this.set("active",!0)},prepareListeners:function(){setTimeout(_.bind(this.disable,this),1e3*this.getTimer()),this.listenTo(application,"beforeGameStart",this.onBeforeStartGame),this.listenTo(application,"change:page",this.onChangePage),this.listenToGameWindows()},listenToGameWindows:function(){var i=this;this.listenTo(application,"windowOpened",function(e){if(e instanceof StartLevelWindow){var t=e.options.episode;!t||t instanceof BonusWorld||i.onShowStartLevelWindow(e)}i.game&&(e instanceof OutOfMovesWindow&&!(e instanceof LoseProgressWarningWindow)&&i.onShowOutOfMovesGameWindow(e),e instanceof StatisticAfterWindow&&i.onShowCompleteWindow(e),e instanceof AreYouSureExitWindow&&i.onShowExitWindow(e))})},runNow:function(){this.stopListening(user,"change:level"),this.reset(),this.prepare()},waitAvailable:function(){var t=this;return this.isAvailable()?Promise.resolve():new Promise(function(e){t.listenTo(user,"change:level",function(){t.isAvailable()&&(e(),t.stopListening(user))})})},isAvailable:function(){var e=this.get("availability");if(0<this.getTimer())return!0;if(user.getRealLevel()<e.minLevel)return!1;var t=new Date(1e3*application.getCurrentServerTime()).getDay();return-1!==e.weekDays.indexOf(t)},reset:function(){this.set({currentStage:0,startTime:application.getCurrentServerTime()}),this.saveToServer()},onChangePage:function(e,t){"main"===t&&(this.game=!1,this.avatarDecorator.updateStage())},onBeforeStartGame:function(e){if(this.isRelevantGame(e)){this.game=e;var t=this.get("currentStage"),i=this.get("stagePowerupGroups").find(function(e){return e.stage===t});i&&this.powerupGenegator.prepare(e,i.powerups),this.set({lastStage:this.get("currentStage"),currentStage:0}),this.saveToServer(),this.listenToOnce(e,"win",this.onWinGame)}else this.game=!1},makePowerups:function(t){if(this.game){var e=this.get("stagePowerupGroups").find(function(e){return e.stage===t});e&&this.powerupGenegator.addPowerupsNow(this.game,e.powerups)}else console.log("     !")},onWinGame:function(){var e=Math.min(this.get("lastStage")+1,this.getMaxStage());this.set({currentStage:e,lastStage:0}),this.saveToServer()},onShowOutOfMovesGameWindow:function(e){var t=this;this.get("lastStage")&&(e.exitGameOnCancel=!1,this.listenToOnce(e,"cancel",function(){t.showLoseStageWindow()}))},onShowCompleteWindow:function(e){new PowerupMakerProgressBlockDecorator({el:e.$el,model:this}).render()},onShowStartLevelWindow:function(e){new PowerupMakerStartWindowDecorator({el:e.$el,model:this}).render()},onShowExitWindow:function(e){this.get("lastStage")&&new PowerupMakerExitWindowDecorator({el:e.$el,model:this}).render()},getTimer:function(){return Math.max(0,this.get("startTime")+this.get("duration")-application.getCurrentServerTime())},getFormattedTimer:function(){var e=Math.floor(this.getTimer()/60),t=[];t.unshift(e%60+messages.timeShort[0]);var i=e=Math.floor(e/60);return 0<i&&t.unshift(i+messages.timeShort[1]),t=t.join(" ")},getMaxStage:function(){return Math.max.apply(this,this.get("stagePowerupGroups").map(function(e){return e.stage}))},isRelevantGame:function(e){return!(!e||episode.isBonusWorld())&&(!episode.scores.at(application.level.num-1)&&-1!==this.get("gameTypes").indexOf(e.get("playType")))},showLoseStageWindow:function(){new LoseProgressWarningWindow({el:"#loseProgressWarningWindow",model:this})},showEventWindow:function(e){new PowerupMakerWindow(_.defaults({model:this},e))},addShield:function(){var e=$(".invisible #powerupMaker").clone().appendTo("#map");new PowerupMakerButton({model:this,el:e})},saveToServer:function(){return service("../../../levelbase/src/services/updatepowerupmakerdata.php",{stage:this.get("currentStage"),time:this.get("startTime")})},loadFromServer:function(){var t=this;return service("../../../levelbase/src/services/loadpowerupmakerdata.php").then(function(e){e&&t.set({currentStage:e.powerupMakerStage,startTime:e.powerupMakerStartTime})})},disable:function(){this.stopListening(),this.set("active",!1),this.avatarDecorator.clearStage()}}),BaseGoldSource=function(e){_inherits(i,Backbone.Events.Emitter);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){this._component=e}},{key:"destroy",value:function(){}},{key:"set",value:function(e){this.trigger("change",this,e),this.trigger("change:gold",this,e)}},{key:"get",value:function(){return 0}},{key:"add",value:function(e){this.set(this.get()+e)}},{key:"writeOff",value:function(e){this.set(this.get()-e)}},{key:"commit",value:function(){this._value=this.get()}},{key:"reject",value:function(){this.set(this._value)}}]),i}(),TicketsGoldSource=function(e){_inherits(o,BaseGoldSource);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this))._ticketsComponent=e,t._ticketsComponent.on("change:tickets",t.onChange,_assertThisInitialized(t)),t}return _createClass(o,[{key:"destroy",value:function(){_get(_getPrototypeOf(o.prototype),"destroy",this).call(this),this._ticketsComponent.off("change:tickets",this.onChange,this)}},{key:"onChange",value:function(){_get(_getPrototypeOf(o.prototype),"set",this).call(this,this._ticketsComponent.getTickets())}},{key:"get",value:function(){return this._ticketsComponent.getTickets()}},{key:"set",value:function(e){this._ticketsComponent.setTickets(e),_get(_getPrototypeOf(o.prototype),"set",this).call(this,e)}}]),o}(),WorldLevelGoldSource=function(e){_inherits(i,BaseGoldSource);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"init",value:function(e){_get(_getPrototypeOf(i.prototype),"init",this).call(this,e),this._component.world.on("completeLevel",this.calcGold,this),this._component.world.on("enter",this.calcGold,this)}},{key:"calcGold",value:function(){var t=this._component.world.getCurrentLevel();this._component.getTasks().each(function(e){e.get("complete")&&(t-=e.get("price"))}),this.set(t<0?0:t)}},{key:"set",value:function(e){this._component.world.set("gold",e),_get(_getPrototypeOf(i.prototype),"set",this).call(this,e)}},{key:"get",value:function(){return this._component.world.get("gold")}},{key:"commit",value:function(){_get(_getPrototypeOf(i.prototype),"commit",this).call(this),this.calcGold()}},{key:"reject",value:function(){_get(_getPrototypeOf(i.prototype),"reject",this).call(this),this.calcGold()}}]),i}(),QuestTask=Backbone.Model.extend({defaults:{complete:!1,active:!1,options:!1,option:null,required:[],addClassOnOption:[],prize:null,total:0,progress:0,interim:!1},complete:function(e){this.set({complete:!0,option:e})},cancel:function(){this.set({complete:!1,option:0})},hasPrize:function(){return!!this.get("prize")},givePrize:function(){var e=this,t=new UserPrizes(UserPrizes.convertFromCocos(this.get("prize")));return application.emit("giveTaskPrize",t,this.get("interim")).then(function(){t.take(e.get("world").get("name")+"_taskPrize"+e.get("id"))})}}),QuestController=BonusWorldComponent.extend({defaults:{id:"task",hasTasksWindow:!1,additionalShowWindowRule:!1,gold:0,goldSource:null},initialize:function(e){this.tasks=new Backbone.Collection(e.tasks,{model:QuestTask}),this.initActiveTask(),this.listenTo(this.world,"enter",this.onEnterWorld),this.listenTo(this.world,"exit",this.onExitWorld),this.listenTo(this.world,"preloadEpisode",this.onLoad),this.listenTo(this.world,"configure",this.onConfigure),this.listenTo(this.world,"completeLevel",this.onCompleteLevel),this.listenTo(this.world,"onAfterFinishLevel",this.onAfterCompleteLevel),this.goldSource=e.goldSource||new WorldLevelGoldSource,delete e.goldSource},createView:function(){return new QuestView({model:this,el:"#map"})},onConfigure:function(){var e=this;return this.view||(this.view=this.createView()),Promise.resolve().then(function(){return e.goldSource.init(e)})},onLoad:function(){var o=this;return Promise.resolve().then(function(){return o.emit("beforeEnter")}).then(function(){return o.loadFromServer()}).then(function(i){o.tasks.forEach(function(e){var t=_.findWhere(i.tasks,{task:e.get("id")});t?(e.set({complete:!0,option:t.item}),e.get("modifier")&&o.world.set(e.get("modifier"),e.get("modifier")+t.item)):e.set({complete:!1,option:0})}),o.initActiveTask(),o.updateProgressTasks()})},onEnterWorld:function(){var e=this;return Promise.resolve().then(function(){return e.emit("enter")})},onExitWorld:function(){var e=this;return Promise.resolve().then(function(){return e.emit("exit")})},onCompleteLevel:function(){var e=this.getNextPrizedTask();e&&e.get("active")&&Game&&this.goldSource.get()>=e.get("price")&&Game.cancelNext()},onAfterCompleteLevel:function(){var t=this,e=this.fetchActiveTask().find(function(e){return e.get("price")<=t.get("gold")}),i=this.get("additionalShowWindowRule"),o=!i||i();this.get("hasTasksWindow")&&e&&4<this.world.getCurrentLevel()&&o&&setTimeout(function(){return application.waitPage("main").then(function(){return new Promise(function(e){new BonusWorldTasksWindow({taskController:t,onOpen:e})})})},1e3)},initActiveTask:function(){this.tasks.forEach(function(e){var t=!0;if(e.get("complete"))t=!1;else for(var i=e.get("required"),o=0;o<i.length;++o)if(!this.tasks.get(i[o]).get("complete")){t=!1;break}e.set("active",t)},this)},fetchActiveTask:function(){return this.tasks.filter(function(e){return e.get("active")})},getActiveTask:function(){var e=this.fetchActiveTask()[0]||null;return e&&this.get("gold")>=e.get("price")?e:null},getById:function(t){return this.tasks.find(function(e){return e.get("id")===t})},selectTaskOption:function(e,t){this.trigger("selectTaskOption",this,e,t),this.trigger("selectTask"+e.get("id")+"Option"+t,this)},completeTask:function(o){if(this._completeProcess)return Promise.resolve();if(this._completeProcess=!0,o.get("price")>this.goldSource.get())return Promise.reject("  gold");var a=this;return a.emit("beforeCompleteTask",this,o).then(function(){return a.emit("beforeCompleteTask"+o.get("id"),this,o)}).then(function(){if(o.get("options"))return new Promise(function(t,i){var e=this;return Promise.resolve().then(function(){return a.emit("beforeTaskOption"+o.get("id"),e,o)}).then(function(){var e=new QuestSelectTaskOptionsWindow({controller:a,task:o,onClose:function(){e.option?t(e.option):i()}});e.on("selectOption",function(e){a.selectTaskOption(o,e)}),e.once("open",function(){e.chooseOption(2)})})})}).then(function(e){return o.complete(e),o.get("modifier")&&a.get("world").set(o.get("modifier"),o.get("modifier")+e),a.goldSource.writeOff(o.get("price")),e}).then(function(e){return a.saveToServer().then(function(){return e})}).then(function(e){return application.playSound("task"),a.emit("afterCompleteTask",a,o,e).then(function(){return a.emit("afterCompleteTask"+o.get("id"))}).then(function(){if(e)return a.emit("afterCompleteTask"+o.get("id")+"Option"+e)}).then(function(){return new Promise(function(e){a.get("hasTasksWindow")?new BonusWorldTasksWindow({taskController:a,onOpen:e}):e()}).then(function(){a.initActiveTask(),o.hasPrize()&&!o.get("hasReservedPrize")&&o.givePrize()}).then(function(){return a.updateProgressTasks(),a.emit("taskProgressUpdated",a).then(function(){return a.emit("taskProgressUpdated"+o.get("id"),a)})})}).then(function(){if(e)return a.emit("afterCompleteTaskWindow"+o.get("id"))}).catch(function(e){throw o.cancel(),this.goldSource.reject(),e})}).catch(function(e){return e&&console.error(e),a.initActiveTask(),a.emit("cancelCompleteTask",a,o).then(function(){return a.emit("cancelCompleteTask"+o.get("id"))})}).then(function(){return a._completeProcess=!1,a.saveToServer()})},playCurrentLevel:function(){return this.world.playCurrentLevel()},getNextPrizedTask:function(){var e=this.getTasksWithPrizes().filter(function(e){return!e.get("complete")&&!e.get("interim")});return e.sort(function(e,t){return e.get("total")-e.get("progress")-(t.get("total")-t.get("progress"))}),e[0]},getPreviousPrizedTask:function(){var e=this.getNextPrizedTask();if(!e)return null;var t=this.getTasksWithPrizes().filter(function(e){return!e.get("interim")});return t[t.indexOf(e)-1]},getNextInterimTasks:function(){var e=this.getNextPrizedTask(),t=this.getPreviousPrizedTask(),i=e?e.get("total"):0,o=t?t.get("total"):0;return this.getTasksWithPrizes().filter(function(e){return e.get("interim")&&e.get("total")>o&&e.get("total")<i})},hasInterimPrizes:function(){return this.getTasksWithPrizes().some(function(e){return!!e.get("interim")})},getTasksWithPrizes:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.tasks.filter(function(e){return e.hasPrize()&&(t||!e.get("interim"))})},findRootTasks:function(){return this.tasks.filter(function(e){return!e.get("required")||0===e.get("required").length})},findTasksByRequired:function(t){return this.tasks.filter(function(e){return-1!==e.get("required").indexOf(t)})},updateProgressTasks:function(){var t=this;this.tasks.forEach(function(e){return t.countTaskProgress(e)})},countTaskProgress:function(e){var i=this,o=0,a=0,n={};!function e(t){n[t.get("id")]||(n[t.get("id")]=!0,o+=t.get("complete")?1:0,++a,t.get("required")&&0<t.get("required").length&&t.get("required").forEach(function(t){return e(i.tasks.find(function(e){return e.get("id")===t}))}))}(e),e.set({total:a,progress:o})},hasIncompleteTasks:function(){return this.tasks.any(function(e){return!e.get("complete")})},getProgressToNextPrize:function(){var e=0,t=this.getNextPrizedTask();if(!t)return e;var i=this.getTasksWithPrizes(!1),o=i[i.indexOf(t)-1],a=o?o.get("total"):0,n=o?o.get("progress"):0,r=t.get("total")-a;return e=(t.get("progress")-n)/r*100},loadFromServer:function(){var i=this.get("name");return new Promise(function(e,t){callService("../../../gems/site/service/quest/loaddata.php",e,t,{eventName:i})})},saveToServer:function(e){var i=this.get("name"),o=this.tasks.filter(function(e){return e.get("complete")}).map(function(e){return{task:e.get("id"),item:e.get("option")}});return new Promise(function(e,t){callService("../../../gems/site/service/quest/savedata.php",e,t,{eventName:i,tasks:JSON.stringify(o)})})},getTasks:function(){return this.tasks},canBuyTask:function(e){return e.get("price")<=this.goldSource.get()},getCanBuyTasks:function(){var t=this;return this.getAvailableTasks().filter(function(e){return t.canBuyTask(e)})},getAvailableTasks:function(){var t=this;return this.getTasks().filter(function(e){return t.isAvailableTask(e)})},isAvailableTask:function(e){if(e.get("complete"))return!1;for(var t=this.getTasks(),i=e.get("required"),o=0;o<i.length;++o)if(!t.get(i[o]).get("complete"))return!1;return!0},getDebtAmount:function(){return this.getTasks().filter(function(e){return!e.get("complete")}).reduce(function(e,t){return e+t.get("price")},0)}}),QuestSelectTaskOptionsWindow=TWindow.extend({templateClass:".questSelectTaskOptionsWindow_template",events:{"click .taskOption":"selectOption","click .taskComplete":"complete","click .taskCancel":"discard"},closeAnimation:function(e){this.$el.hide(),setTimeout(e,0)},openAnimation:function(){this.$el.show()},shadowOpenAnimation:function(){window.mobile?$("#windowShadow").show().show().css("opacity",0):$("#windowShadow").stop().clearQueue().show().css("opacity",0)},onOpen:function(){TWindow.prototype.onOpen.call(this);var e="task"+this.options.task.get("id");this.$el.addClass(e),$("#container,#mainAppWrapper").addClass(e),this.$el.find(".taskComplete ").addClass("disabled"),this.selected=!1},selectOption:function(e){var t=parseInt($(e.currentTarget).attr("data-item"));t&&this.chooseOption(t)},chooseOption:function(e){this.$el.find(".taskComplete ").removeClass("disabled"),this.selected=!0;for(var t=1;t<=3;t++)this.$el.removeClass("option"+t).find(".taskOption"+t).removeClass("selected");this.$el.addClass("option"+e).find(".taskOption"+e).addClass("selected"),this.trigger("selectOption",e),this.option=e},complete:function(){this.selected&&this.close()},discard:function(){this.option=0,this.close()}});function TasksFromGroup(e){var t,i=1;do{var o,a=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.group===i&&(a.push(r.id),r.required=t)}}catch(e){n.e(e)}finally{n.f()}++i,t=a}while(0<t.length);return e}var QuestView=Backbone.View.extend({events:{"click .mStartBtn":"onStartLevel","click .mCompleteTaskBtn":"onCompleteTask"},initialize:function(){if(this.listenTo(this.model,"selectTaskOption",this.onSelectTaskOption),this.listenTo(this.model,"beforeCompleteTask",this.onBeforeCompleteTask),this.listenTo(this.model,"afterCompleteTask",this.onAfterCompleteTask),this.listenTo(this.model,"cancelCompleteTask",this.onCancelCompleteTask),this.listenTo(this.model,"change:gold",this.onUpdateGold),this.listenTo(this.model.world,"change:progress",this.onUpdateProgress),this.listenTo(this.model,"beforeEnter",this.onBeforeEnter),this.listenTo(this.model,"enter",this.onEnter),this.listenTo(this.model,"exit",this.onExit),this.$container=$("#questTemplates .questContainer").clone().appendTo(this.$el.find(".scrolledBlock")),this.$container.addClass(this.model.world.get("name")),this.$ui=$("#questTemplates .questUi").clone().appendTo(this.$el),this.$ui.addClass("questUi_"+this.model.world.get("name")),this.model.get("hasTasksWindow")){var e=$("#questTemplates .mBonusWorldTasksWindowBtn").clone();e.addClass(this.model.world.get("name")),e.appendTo(this.$ui),this.tasksWindowBtn=new TasksWindowButton({el:e,model:this.model})}},onBeforeEnter:function(){this.$ui.css("display","none")},onEnter:function(){this.$ui.css("display",""),this.model.world.on("completeLevel",this.onCompleteLevel,this),this.onUpdateGold(),this.updateTasksWindowBtn()},onExit:function(){this.$ui.css("display","none"),this.model.world.off("completeLevel",this.onCompleteLevel,this)},meteors:function(){var i=this;setInterval(function(){for(var e=0,t=getRandomInt(1,3);e<t;++e)i.meteor()},1500)},meteor:function(){var t=this.$container.find(".task14");setTimeout(function(){var e=$('<div class="meteor"></div>').appendTo(t);e.css({rotate:90,left:getRandomInt(0,$("#map").width()),top:getRandomInt(0,$("#map").height()/3)}).delay(300).ourAnimate({left:"-=1000px",top:"+=1000px"},getRandomInt(500,1500),"linear",function(){e.remove()})},getRandomInt(1e3,1500))},onUpdateGold:function(){this.updateGoldCounter(),this.onUpdateProgress()},onSelectTaskOption:function(e,t,i){this.$container.find(".task"+t.get("id")).addClass("active").removeClass("optionNone option1 option2 option3").addClass("option"+(i||"None")).addClass("tempVisible")},onUpdateProgress:function(){var i=this;this.$ui.find(".mLevel").html(this.model.world.get("progress")),this.model.tasks.forEach(function(e){var t=i.$container.find(".task"+e.get("id"));e.get("complete")?(t.addClass("active").addClass("option"+(e.get("option")||"None")),i.$container.find(e.get("addClassOnOption").join(",")).addClass("otherOption"+(e.get("option")||"None"))):t.removeClass("active").removeClass("optionNone option1 option2 option3").removeClass("tempVisible")});var e=this.model.getActiveTask();e&&this.$ui.find(".mCompleteTaskBtn").removeClass(function(e,t){for(var i=[],o=/task[0-9]+/gm,a=o.exec(t);a;)i.push(a[0]),a=o.exec(t);return i.join(" ")}).addClass("task"+e.get("id")).find(".mDescriptionTask").html(messages[this.model.get("name")+"Task"+e.get("id")]),this.$ui.toggleClass("hasTask",!!e)},onStartLevel:function(){Config.bonusWorld===this.model.world&&(this.model.world.get("actionQueue").canAction()&&!this.model.world.get("actionQueue").isActive(StoryForceElement)||this.model.playCurrentLevel())},onCompleteTask:function(){if(Config.bonusWorld===this.model.world){var e=this.model.getActiveTask();e&&this.model.completeTask(e)}},onCompleteLevel:function(){this.updateTasksWindowBtn()},onBeforeCompleteTask:function(e,t){$("#container,#mainAppWrapper").addClass("talking"),this.$container.find(".task"+t.get("id")).addClass("active")},onAfterCompleteTask:function(e,t,i){this.$container.find(".task"+t.get("id")).addClass("active").addClass("option"+(i||"None")).removeClass("tempVisible"),this.$container.find(t.get("addClassOnOption").join(",")).addClass("otherOption"+(i||"None")),this.onUpdateProgress(),setTimeout(function(){$("#container,#mainAppWrapper").removeClass("talking")},1e3),this.updateGoldCounter(),this.updateTasksWindowBtn()},onCancelCompleteTask:function(e,t){this.$container.find(".task"+t.get("id")).removeClass("active").removeClass("optionNone option1 option2 option3").removeClass("tempVisible");setTimeout(function(){$("#container,#mainAppWrapper").removeClass("talking")},1e3),this.updateTasksWindowBtn()},updateTasksWindowBtn:function(){this.tasksWindowBtn&&(this.tasksWindowBtn.$el.toggleClass("ready",!!this.model.getActiveTask()),this.tasksWindowBtn.$el.toggleClass("hide",!this.model.hasIncompleteTasks()))},updateGoldCounter:function(){this.$(".mQuestGold").html(this.model.get("gold")),this.$(".mQuestGold").toggleClass("hide",!this.model.hasIncompleteTasks())}}),TasksWindowButton=Backbone.View.extend({events:{click:"openWindow"},initialize:function(){this.$el.addClass(this.model.get("name"))},openWindow:function(){new BonusWorldTasksWindow({taskController:this.model})}}),InvestigationInfoWindow=TWindow.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.get("name");this.$(".description1").html(messages[e+"HelpWindowDescription1"]||""),this.$(".description2").html(messages[e+"HelpWindowDescription2"]||""),this.$(".description3").html(messages[e+"HelpWindowDescription3"]||"")}}),InvestigationTaskComponent=function(e){_inherits(i,QuestController);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onConfigure",value:function(){_get(_getPrototypeOf(i.prototype),"onConfigure",this).call(this),this.goldInfoButton=new TaskGoldInfoView({el:$("#questTemplates .taskGoldInfoView").clone().appendTo(this.world.view.$ui),model:this})}},{key:"createView",value:function(){return new InvestigationTaskView({model:this,el:"#map"})}},{key:"onCanBuyAnyTask",value:function(){}},{key:"showForce",value:function(){}},{key:"showInfo",value:function(){new InvestigationInfoWindow({world:this.world,component:this})}},{key:"updateProgressTasks",value:function(){var e=this;return Promise.resolve().then(function(){return _get(_getPrototypeOf(i.prototype),"updateProgressTasks",e).call(e)}).then(function(){return e.checkLoaction()})}},{key:"checkLoaction",value:function(){var e=this,t=this.calcLocation(),i=t.name,o=t.event,a=i,n=this.world.get("location");if(this.world.get("location")!==a)return Promise.resolve().then(function(){return e.emit(o,e)}).then(function(){e.world.set("location",a),e.world.saveSelectedOptions(["location"])}).then(function(){return e.world.emit("beforeChangeLocation",e,n,a)}).then(function(){return e.world.emit("exitLocation"+n,e)}).then(function(){return e.world.emit("changeLocation",e,n,a)}).then(function(){return e.world.emit("enterLocation"+a,e)}).then(function(){return e.world.emit("afterChangeLocation",e,n,a)})}},{key:"calcLocation",value:function(){var e=this.get("locations");if(e){var t,i,o=this.getTasks(),a=_createForOfIteratorHelper(e);try{for(a.s();!(i=a.n()).done;){var n=i.value;if((t=n).required.find(function(e){return!o.get(e).get("complete")}))break}}catch(e){a.e(e)}finally{a.f()}return t}}},{key:"selectTask",value:function(e){var t=this;this.view.scrollToTask(e).then(function(){t.isAvailableTask(e)&&t.canBuyTask(e)?new InvestigationOpenTaskWindow({world:t.world,task:e,component:t}):new InvestigationNotEnoughValueWindow({world:t.world,task:e,component:t})})}}]),i}();InvestigationTaskComponent.prototype.defaults=_.defaults({hasTaskWindow:!1,locations:null},QuestController.prototype.defaults);var InvestigationTaskBaseWindow=TWindow.extend({templateClass:".investigationOpenTaskWindow_template",events:{click:"close","click .button":"onClick"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.task=this.options.task,this.component=this.options.component,this.world=this.options.world,this.setPosition()},onClick:function(){this.close()},setPosition:function(){var e=this.component.view.getTaskButtonPosition(this.task);this.$el.css("left",e.left),this.$el.css("top",e.top)}}),InvestigationNotEnoughValueWindow=InvestigationTaskBaseWindow.extend({onOpen:function(){InvestigationTaskBaseWindow.prototype.onOpen.call(this),this.$(".priceText").html(this.world.ln.print("InvestigationOpenTaskWindow.notEnoughValue",this.task.get("price")-this.component.goldSource.get())),this.$(".text").html(this.world.ln.print("InvestigationOpenTaskWindow.notEnoughValueDescription")),this.$(".button").html(this.world.ln.print("InvestigationOpenTaskWindow.buttonPlay")),this.$el.addClass("notEnough")},onClick:function(){this.close(),this.component.showInfo()}}),InvestigationOpenTaskWindow=InvestigationTaskBaseWindow.extend({onOpen:function(){InvestigationTaskBaseWindow.prototype.onOpen.call(this),this.$(".priceText").html(this.world.ln.print("InvestigationOpenTaskWindow.price",this.task.get("price"))),this.$(".button").html(this.world.ln.print("InvestigationOpenTaskWindow.buttonSearch"))},onClick:function(){this.close(),this.component.completeTask(this.task)}}),SecretView=Backbone.View.extend({events:{click:"onClick"},initialize:function(e){this.component=e.component,this.$el.addClass("task"+this.model.id),this.update()},update:function(){this.$el.removeClass("done").removeClass("active").removeClass("inactive").addClass(this._getState());var e=this.component.goldSource.get();this.$(".counter").html(Math.min(e,this.model.get("price"))+"/"+this.model.get("price"))},_getState:function(){return this.model.get("complete")?"done":this.component.isAvailableTask(this.model)?"active":"inactive"},onClick:function(){this.component.selectTask(this.model)}}),InvestigationTaskView=Backbone.View.extend({initialize:function(){this.$container=$("#questTemplates .investigationTask").clone().appendTo(this.$el.find(".scrolledBlock")),this.createLocations(),this.update(),this.model.world.on("change:location",this.update,this),this.model.on("taskProgressUpdated",this.update,this),this.model.goldSource.on("change:gold",this.update,this),this.model.world.on("enter",this.update,this)},createLocations:function(){var i=this;this.locations={},this.tasks=[];for(var e=function(){var e=i.model.get("locations")[o],t=i.locations[e.name];t||(t=i.createLocation(e)),e.required.map(function(e){return i.model.getTasks().find({id:e})}).forEach(function(e){i.tasks.push(new SecretView({model:e,el:$("#questTemplates .secretView").clone().appendTo(t.find(".tasks")),component:i.model}))})},o=0;o<this.model.get("locations").length;o++)e()},createLocation:function(e){var t=$("#questTemplates > .location").clone().appendTo(this.$container.find(".locations"));return(this.locations[e.name]=t).addClass("locationName"+e.name),t},update:function(){for(var e in this.locations)this.locations[e].toggleClass("active",e.toString()===this.model.world.get("location"));this.clearLocation(),$("#main").addClass("location"+this.model.world.get("location")),this.tasks.forEach(function(e){return e.update()})},getTaskButtonPosition:function(e){var t=this.getViewByTask(e),i=$(".scrolledBlock").position();return{left:t.$el.position().left+t.$(".icon").position().left+i.left,top:t.$el.position().top+t.$(".icon").position().top+i.top}},scrollToTask:function(e){var t=this.getViewByTask(e);return t.$el.position().left+t.$(".icon").position().left+250>episodeView.mapController.$el.width()-episodeView.mapController.dx||t.$el.position().left+t.$(".icon").position().left<-episodeView.mapController.dx?episodeView.mapController.scrollTo(".episode_".concat(this.model.world.getName()," .investigationTask .task").concat(e.id," .icon"),!1):Promise.resolve()},clearLocation:function(){this.model.get("locations").forEach(function(e){$("#main").removeClass("location"+e.name)})},getViewByTask:function(t){return this.tasks.find(function(e){return e.model.id===t.id})}}),TaskGoldInfoView=Backbone.View.extend({initialize:function(){this.model.goldSource.on("change:gold",this.update,this),this.model.world.on("enter",this.update,this)},update:function(){this.$el.html(this.model.goldSource.get())}}),BonusWorldSelectOptionWindow=QuestSelectTaskOptionsWindow.extend({defaultOption:2,onOpen:function(){TWindow.prototype.onOpen.call(this),this.world=this.options.world,this.$el.addClass("task"+this.options.optionId),this.chooseOption(this.defaultOption)},chooseOption:function(e){QuestSelectTaskOptionsWindow.prototype.chooseOption.call(this,e),this.world.set(this.options.optionId,e),this.option=e},discard:function(){this.world.set(this.options.optionId,0),QuestSelectTaskOptionsWindow.prototype.discard.call(this)},complete:function(){QuestSelectTaskOptionsWindow.prototype.complete.call(this),this.world.saveSelectedOptions([this.options.optionId])}}),BonusworldListWindow=TWindow.extend({templateClass:".bonusWorldListWindow_template",events:{"click .playBtm":"start","click .close":"close","mousedown .scrollBlock":"onBeginTouch","mouseup .scrollBlock":"onEndTouch","mouseleave .scrollBlock":"onEndTouch"},initialize:function(e){TWindow.prototype.initialize.call(this),this._scrolling=this.scrolling.bind(this),this.$content=this.$el.find(".content"),this.$scrollBlock=this.$el.find(".scrollBlock")},start:function(e){var t=$(e.currentTarget).attr("data-name")||!1;if(t){var i=_.find(this.model.worlds,function(e){return e.get("name")===t},this);i&&(i.open().catch(function(e){console.warn(e)}),this.close())}},createItems:function(e,i){var o=this,t=this.$(".content"),a=[],n=scrollMargin;if(t.empty(),e&&e.length)for(var r=e.sort(this.sortWorlds),s=0;s<r.length;++s){var l=r[s];l.isSatellite()||l.get("showOpenedOnly")&&!l.isOpenedForUser()||!l.isOpenedForUser()||a.push(this.createWorldItem(l))}if(i&&i.length)for(var d=function(t){if(e.find(function(e){return e.get("name")===i[t]}))return 1;a.push(o.createAnnounceItem(i[t]))},c=0;c<i.length;++c)d(c);for(var g=0;g<a.length;g++)a[g].css({left:n+"px"}),n+=a[g].width(),n+=parseInt(a[g].css("margin")||"0",10);var u=this.getItemsCount()>=minItemsCountForScaling?smallScale:defaultScale;t.scale(u);var h=scrollMargin+n,p=this.$(".scrollBlock").width(),m=h<p?(p-h)/2:0;t.css({width:h+"px",left:m+"px"})},createWorldItem:function(e){var t=$($(".bonusWorldListWindowItem_template").html());t.addClass(e.get("name")),t.find(".playBtm").attr("data-name",e.get("name")),t.find(".title").html(messages[e.get("name")+"NewBonusWorldName"]),t.find(".description").html(e.isIntegrationEvent()&&messages[e.get("name")+"NewBonusWorldTextVK"]||messages[e.get("name")+"NewBonusWorldText"]),t.find(".levelNumber").html(e.get("progress")),t.find(".indicator").toggleClass("hided",e.isStarted()||e.get("closeForNew"));var i=t.find(".availabilityPage"),o=t.find(".noAvailabilityPage"),a=t.find(".noAvailabilityPageByBeginDate"),n=t.find(".noAvailabilityPageByGroup"),r=t.find(".noAvailabilityPageByExpiration");(i.toggleClass("hided",!this.isOpenedWorld(e)),o.toggleClass("hided",!this.isClosedByLevel(e)),a.toggleClass("hided",!this.isClosedByBeginDate(e)),n.toggleClass("hided",!this.isClosedByGroup(e)||this.isClosedByLevel(e)),r.toggleClass("hided",!this.canDisplayExpiredWarning(e)),t.find(".lifeBlock").toggleClass("hided",!this.isOpenedWorld(e)||!e.bonusWorldFinishTime),t.find(".livesAmount").addClass(e.get("name")),t.find(".livesTimer").addClass(e.get("name")),t.find(".openTimerBlock").addClass(e.get("name")),this.isOpenedWorld(e))?t.find(".notify").toggleClass("hided",!e.get("notify")):o.find(".bonusWorldMinLevel").html(e.get("minRealLevelToEnter"));if(this.showTimer(e)){var s=t.find(".timerBlock"),l=e.hasTimer();s.addClass(e.get("name")).toggleClass("hided",!l)}if(e.hasComponent("group")){var d=e.getComponent("group");if(d.get("main")){t.find(".groupBackground").removeClass("hided");var c=t.find(".templates .groupItem"),g=t.find(".noAvailabilityPageByGroup .groupItems");t.addClass("groupMain"),t.addClass("itemsCount"+d.getOtherBonusWorlds().length),d.getOtherBonusWorlds().forEach(function(e){var t=c.clone();t.addClass(e.get("name")),t.toggleClass("completed",e.getComponent("group").isCompleted()),g.append(t)})}else t.addClass("groupSecondary")}return this.$el.find(".content").append(t),t},createAnnounceItem:function(e){var t=$($(".bonusWorldListWindowItem_template").html());t.addClass(e);var i=messages.announceWorlds;return t.find(".title").html(i[e+"_title"]),t.find(".description").html(i[e+"_description"]),t.find(".requirement").html(messages.bonusworldListComingSoon),this.$el.find(".content").append(t),t},onBeginTouch:function(e){this.startScrollingX=e.screenX,this.lastScrollX=parseInt(this.$content.css("left"),10),this.$el.find(".scrollBlock").bind("mousemove",this._scrolling)},onEndTouch:function(e){this.$el.find(".scrollBlock").unbind("mousemove",this._scrolling),this.startScrollingX=!1},getItemsCount:function(){return this.$(".bonusworldItem").length},scrolling:function(e){if(this.startScrollingX){var t=this.getItemsCount()>=minItemsCountForScaling?smallScale:defaultScale,i=e.screenX-this.startScrollingX,o=this.$scrollBlock.width(),a=this.$content.width()*t,n=Math.min(0,Math.max(o-a,this.lastScrollX+i));a<o&&(n=(o-a)/2),this.$content.css({left:n+"px"})}},isOpenedWorld:function(e){return!this.isClosedByLevel(e)&&!this.isClosedByBeginDate(e)&&!this.isClosedByGroup(e)&&!this.canDisplayExpiredWarning(e)&&e.isOpenedForUser()},showTimer:function(e){return this.isOpenedWorld(e)||e.get("alwaysShowTimer")},isClosedByLevel:function(e){return user.getCurrentLevel()<e.get("minRealLevelToEnter")},isClosedByBeginDate:function(e){return!e.isAvailableByBeginDate()},isClosedByGroup:function(e){return e.hasComponent("group")&&!e.getComponent("group").isAvailabilityEnter()},canDisplayExpiredWarning:function(e){return!!e.get("durationDays")&&(!(e.isStarted()||!e.get("closeForNew"))||e.get("displayExpired")&&e.isExpired()&&!e.get("allowProlong")&&!this.isClosedByGroup(e)&&!(e.get("allowAfterWinAndTimeout")&&e.get("finished")))},prepareTimers:function(t){for(var i=this,e=0;e<t.length;e++)this.prepareWorldTimer(t[e]),this.prepareLiveTimer(t[e]),this.prepareOpenTimer(t[e]);this._updateTimeInterval=setInterval(function(){for(var e=0;e<t.length;e++)i.updateWorldTimer(t[e])},1e3)},prepareLiveTimer:function(e){var t=e.livesController;e.livesController&&(t.on("change:livesTimer",this.updateLivesTimer,this),this.updateLivesTimer(t,t.getLivesTimer()))},prepareWorldTimer:function(e){e.isSatellite()||e.get("showOpenedOnly")&&!e.isOpenedForUser()||this.updateWorldTimer(e)},prepareOpenTimer:function(e){e.on("change:openTimer",this.updateOpenTimer,this),this.updateOpenTimer(e,e.get("openTimer"))},updateWorldTimer:function(e){var t=e.getTimer(),i=this.$(".timerBlock."+e.get("name")),o=t||24*e.get("durationDays")*3600;0<o&&(o=this.getFormatedTimer(t)),i.find(".worldTimer").html(o)},updateLivesTimer:function(e,t){var i=e.get("world"),o=this.$(".livesAmount."+i.get("name")),a=this.$(".livesTimer."+i.get("name")),n=t||0;n=0<t?this.getFormatedTimer(t):messages.bonusworldListWindowFullLives,o.html(i.checkUnlimitedLives()?"":e.getLives()),a.html(n)},updateOpenTimer:function(e,t){var i=this.$(".openTimerBlock."+e.get("name")),o=t||24*e.get("durationDays")*3600;0<o&&(o=this.getFormatedTimer(t)),i.find(".openTimer").html(o)},getFormatedTimer:function(e){return e<3600?formatTime("%i:%s",e):formatPeriod(e<86400?Math.round(e/60):60*Math.round(e/60/60))},destroyTimers:function(){clearInterval(this._updateTimeInterval),this._updateTimeInterval=null;for(var e=this.model.worlds,t=0;t<e.length;t++){var i=e[t].livesController;i&&i.off("change:livesTimer",this.updateLivesTimer,this)}},getWorldsList:function(){var t=this,e=this.model.worlds.filter(function(e){return t.isActualWorld(e.hasComponent("group")?e.getComponent("group").getFirstBonusWorld():e)});return e.sort(function(e,t){return e.get("listIndex")-t.get("listIndex")}),e=this.raiseOpenedWorlds(e),e=this.groupWorlds(e)},raiseOpenedWorlds:function(e){for(var t=[],i=0,o=0;o<e.length;o++)this.isOpenedWorld(e[o])?(t.splice(i,0,e[o]),i++):t.push(e[o]);return t},groupWorlds:function(e){for(var o=e.filter(function(e){return!e.hasComponent("group")||e.getComponent("group").get("main")}),a=o.filter(function(e){return e.hasComponent("group")}),t=function(t){var i=o.indexOf(a[t])+1;e.filter(function(e){return e.hasComponent("group")&&!e.getComponent("group").get("main")&&e.getComponent("group").get("name")==a[t].getComponent("group").get("name")}).sort(function(e,t){return e.getComponent("group").get("order")-t.getComponent("group").get("order")}).forEach(function(e){o.splice(i++,0,e)})},i=0;i<a.length;i++)t(i);return o},sortWorlds:function(e,t){var i=e.get("version"),o=t.get("version");return 0<e.get("listIndex")&&(i=99999999+e.get("listIndex")),0<t.get("listIndex")&&(o+=99999999),o-i},isActualWorld:function(e){var t=e.get("minEpisodeToCloseForOld");if(e.get("isFreeEpisode"))return!1;if(e.isOutdated())return!1;if(!e.bonusWorldFinishTime){if(t&&user.get("episode")>=t)return!1;if(e.get("closeForNew"))return!1}return!(!e.get("allowAfterWin")&&e.get("finished"))&&!!(e.get("active")||e.get("allowProlong")||e.get("displayExpired"))},updateWindow:function(){this.render()},render:function(){var e=this.getWorldsList(),t=this.model.announceWorlds;this.createItems(e,t),this.prepareTimers(e)},listenToWorlds:function(){for(var e=this.getWorldsList(),t=0;t<e.length;t++)this.listenTo(e[t],"configure",this.updateWindow)},stopListeningToWorlds:function(){for(var e=this.getWorldsList(),t=0;t<e.length;t++)this.stopListening(e[t])},onOpen:function(){this.listenToWorlds(),this.render()},onClose:function(){this.stopListeningToWorlds(),this.destroyTimers()}}),scrollMargin=7,minItemsCountForScaling=4,smallScale=.9,defaultScale=1,BonusWorldTasksWindow=TWindow.extend({templateClass:".bonusWorldTasksWindow_template",name:"bonusWorldTasksWindow",events:{"click .close":"close","click .buyTask":"completeTask"},initialize:function(e){this.taskController=e.taskController,this.hasTasksProgress=0<this.taskController.getTasksWithPrizes().length,this.interims=[],TWindow.prototype.initialize.call(this,e)},completeTask:function(e){var t=parseInt($(e.currentTarget).attr("data-task")),i=this.taskController.getById(t);if(i)return this.close(),this.taskController.completeTask(i)},onOpen:function(){TWindow.prototype.onOpen.call(this),this.render(),this.hasTasksProgress&&(this.taskController.tasks.on("change:active",this.updateTasks,this),this.taskController.on("taskProgressUpdated",this.animateUpdateProgressBar,this),application.on("giveTaskPrize",this.animateGiveTaskPrize,this),this.updateTasksProgressBlock())},onClose:function(){TWindow.prototype.onClose.call(this),application.off("giveTaskPrize",this.animateGiveTaskPrize,this),this.hasTasksProgress&&(this.taskController.tasks.off("change:active",this.updateTasks,this),this.taskController.off("taskProgressUpdated",this.animateUpdateProgressBar,this),application.off("giveTaskPrize",this.animateGiveTaskPrize,this))},animateGiveTaskPrize:function(e,t){var i=this;t&&this.$el.addClass("interim"),this.$el.addClass("chestAnimation"),new UserPrizesView({el:this.$(".mPrizes"),model:e}),setTimeout(function(){i.$el.removeClass("chestAnimation"),i.$el.removeClass("interim"),i.taskController.fetchActiveTask().length<=0?i.close():i.updateTasksProgressBlock()},t?2300:5500)},render:function(){var e=this.$(".progressBlock"),t=this.$(".mGold");this.updateTasks(),t.find(".amount").html(this.taskController.goldSource.get()),e.toggleClass("active",this.hasTasksProgress);var i=this.taskController.getNextPrizedTask();i&&this.renderPrizeBlock(i)},updateTasks:function(){var t=this;this.taskController.fetchActiveTask().forEach(function(e){return t.renderTask(e)})},renderTask:function(e){var t=this.$(".tasksList").find(".task"+e.id);if(t.length<=0){var i=messages[this.taskController.get("name")+"Task"+e.id];(t=$(".invisible .specialWorldTask").clone()).find(".taskDescription").html(i),t.addClass("task"+e.id).find(".taskTitle").html(i),t.find(".amount").html(e.price),t.find(".buyTask").attr("data-task",e.id),t.find(".buyTask").attr("id","buyTask"+e.id),t.find(".priceBlock .price .amount").html(e.get("price")),t.appendTo(this.$el.find(".tasksList"))}t.toggleClass("disabled",this.taskController.goldSource.get()<e.get("price")||e.get("complete")),t.toggleClass("active",e.get("active")),e.changed.complete&&(t.addClass("completed"),setTimeout(function(){t.remove()},1e3)),e.changed.active&&t.addClass("appear")},animateUpdateProgressBar:function(){return this.updateTasksProgressBlock(!0)},updateTasksProgressBlock:function(e){var o=this,a=this.$(".progressBlock"),t=this.$(".progressBlock .progressBarLine"),i=this.$(".progressBlock .progressBarText"),n=this.taskController.hasInterimPrizes(),r=this.taskController.getProgressToNextPrize();e&&(r=r||100);var s=r.toFixed(0);if(this.$(".progressBlock").toggleClass("active",!!this.taskController.getNextPrizedTask()),t.css("width",r+"%"),i.html(s+"%"),this.$(".progressBlock .chest").toggleClass("opened",100==r),n){this.interims.forEach(function(e){return e.remove()});var l=this.taskController.getNextPrizedTask(),d=this.taskController.getPreviousPrizedTask(),c=d?d.get("total"):1,g=this.taskController.getNextInterimTasks(),u=this.$(".invisible .interimChest");g.forEach(function(e){var t=(l.get("total")-c)/(e.get("total")-c),i=u.clone();i.toggleClass("opened",e.get("complete")||100==r),i.css("left",100/t.toFixed(0)+"%"),a.append(i),o.interims.push(i)})}},renderPrizeBlock:function(e){var o=this,t=UserPrizes.convertFromCocos(e.get("prize"));if(t){var i=this.$el.find(".chest .bonusWorldPrizeBlock");i.empty(),_.each(t,function(e){var t=$(".invisible .bonusWorldPrize").clone();t.find(".amount").html(e.amount),-1!==_.indexOf(["addThreeMoves","unlimitedLifes","starInField","unlimitedKeys","unlimitedBonusWorldLives","unlimitedBonusWorldLives2","unlimitedBonusWorldLives3"],e.name)&&e.amount&&t.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),t.addClass(e.cssClass).addClass(e.type).addClass(e.name),i.append(t)})}var a,n=_createForOfIteratorHelper(this.taskController.getNextInterimTasks());try{var r=function(){var e=a.value,t=UserPrizes.convertFromCocos(e.get("prize"));if(t){var i=o.$el.find(".interimChest .bonusWorldPrizeBlock");i.empty(),_.each(t,function(e){var t=$(".invisible.mainTemplates .bonusWorldPrize").clone();t.find(".amount").html(e.amount),-1!==_.indexOf(["addThreeMoves","unlimitedLifes","starInField","unlimitedKeys","unlimitedBonusWorldLives","unlimitedBonusWorldLives2","unlimitedBonusWorldLives3"],e.name)&&e.amount&&t.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),t.addClass(e.cssClass).addClass(e.type).addClass(e.name),i.append(t)})}};for(n.s();!(a=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}}),SelectSatelliteButtonView=Backbone.View.extend({events:{click:"selectBonusWorld"},initialize:function(e){this.world=e.world,this.world.on("completeLevel",this.updateTally,this)},render:function(){this.$(".mSatelliteName").html(this.world.get("name")),this.updateTally(),this.updateLevel()},selectBonusWorld:function(){this.world.open()},updateLevel:function(){var e=this.world.get("progress");this.$(".mSatelliteLevel").html(e)},updateTally:function(){var e=this.world.countTally(),t=this.world.get("maxPoints"),i=this.$(".mTally");i.toggleClass("active",e<t),i.html(e+"/"+t)}}),EpisodeCollection={},Tge,Yge,bhe,che,fhe;EpisodeCollection.Model=Backbone.Model,EpisodeCollection.Collection=Backbone.Collection,EpisodeCollection.View=Backbone.View,EpisodeCollection.Part=Backbone.Model.extend({defaults:{id:0,chance:0,amount:0,price:0},toJSON:function(){return{partId:this.id,amount:this.getAmount()}},getChance:function(){return this.get("chance")},getPrice:function(){return this.get("price")},getAmount:function(){return this.get("amount")},setAmount:function(e){this.set("amount",Math.max(e,0))}}),EpisodeCollection.Slot=EpisodeCollection.Model.extend({defaults:{id:0,element:null,updateTime:0,stageId:null,stage:null,stages:[],timer:0,ready:!1,last:!1},firstStage:null,lastStageId:0,timerId:0,initialize:function(e){this.stages=e.stages,this.firstStage=this.stages[0],this.lastStageId=_.last(this.stages).id,this.on("timer",this._onTimer,this),this.on("change:stageId",function(e,t){this.trigger("changeStage",t),this.set("last",t===this.lastStageId)},this),this.on("remove",function(){this.trigger("changed")},this),this.on("ready",function(){this.set("ready",!0)},this)},getSign:function(){var e=episode.get("episodeCollection").stageName||episode.get("episodeCollection").name,t=this.get("stage"),i="";if(t){var o=e;this.get("ready")?o+=t.ready||"State"+t.index+"ready":o+=t.wait||"State"+t.index+"wait",i=messages[o]||""}return i},getTimer:function(){return this.get("timer")},toJSON:function(){var e=this.getElement();return{slotId:this.id,elementId:e?e.id:0,stageId:e?this.get("stageId"):0,updateTime:e?this.get("updateTime"):0}},updateState:function(e){if("stageId"in e){var t=_.findWhere(this.get("stages"),{id:e.stageId});t&&this._updateStage(t)}"updateTime"in e&&this.set("updateTime",Math.max(e.updateTime,0)),this.set("ready",this.isReadyToUpdate())},_reset:function(){this.set("stageId",0),this.set("stage",null),this.set("updateTime",0),this.set("ready",!1)},_getNextStage:function(){var e=this.get("stageId");return _.findWhere(this.stages,{id:e+1})},activate:function(){if(this.get("updateTime"))this._startTimer();else{var e=this.getElement()&&this.get("stage")&&this.get("stage").id===this.lastStageId;this.set("ready",e)}},_updateStage:function(e){if(!e)return this._reset(),!1;if(this.set("stage",e),this.set("stageId",e.id),e.time){var t=_.now()+1e3*e.time;this.set("updateTime",Math.floor(t/1e3))}else this.set("updateTime",0);return!0},_startTimer:function(){this.set("ready",!1);var t=1e3*this.get("updateTime"),i=_.bind(function(){var e=t-_.now();if(e<0)return this.set("timer",0),void this.trigger("timer");this.set("timer",Math.floor(e/1e3)),this.timerId=setTimeout(i,1e3)},this);i()},_onTimer:function(){var e=this._getNextStage();!e||e.time||!e.instant&&e.id!==this.lastStageId||this._updateStage(e)&&(this.activate(),this.trigger("changed")),this.trigger("ready")},update:function(){if(this.isReadyToUpdate())if(this.get("stageId")!==this.lastStageId){var e=this._getNextStage();this._updateStage(e)&&(this.activate(),this.set("ready",!1),this.trigger("changed"))}else this.finish()},isReadyToUpdate:function(){return!!this.getElement()&&this.get("ready")},setElement:function(e){if(!e)return!1;this.set("element",e),this._updateStage(this.firstStage),this.trigger("add")},getElement:function(){return this.get("element")},isEmpty:function(){return!this.get("element")},clear:function(){this.set("element",null),this._reset(),this.trigger("remove")},finish:function(){this.trigger("beforeRemove"),this.getElement().finish(),this.clear()},stop:function(){clearTimeout(this.timerId)}}),EpisodeCollection.Element=EpisodeCollection.Model.extend({defaults:{id:0,type:"common",prize:[],chance:0,parts:[]},getType:function(){return this.get("type")},getParts:function(){return this.get("parts")},getChance:function(){return this.get("chance")},getPrize:function(){return this.get("prize")},findParts:function(e,t){for(var i=this.getParts(),o=0;o<i.length;o++){for(var a=i[o],n=!1,r=0;r<e.length;r++){var s=e[o];if(s.id===a.id&&s.getAmount()>=a.amount){n=!0,t&&t(a,s);break}}if(!n)return!1}return!0},canAssembledFrom:function(e){return this.findParts(e)},assemble:function(e){var i=[];return!!this.findParts(e,_.bind(function(e,t){i.push({part:t,requiredPart:e})},this))&&(_.each(i,function(e){e.part.setAmount(e.part.getAmount()-e.requiredPart.amount)}),!0)},finish:function(){var t=new UserPrizes;_.each(this.get("prize"),_.bind(function(e){t.add(e)},this)),t.take()}}),EpisodeCollection.Factory=function(){},EpisodeCollection.Factory.prototype.createAll=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.create(e[i]));return t},EpisodeCollection.PartsFactory=function(){},EpisodeCollection.PartsFactory.prototype=Object.create(EpisodeCollection.Factory.prototype),EpisodeCollection.PartsFactory.prototype.constructor=EpisodeCollection.PartsFactory,EpisodeCollection.PartsFactory.prototype.create=function(e){return new EpisodeCollection.Part(e)},EpisodeCollection.ElementsFactory=function(){},EpisodeCollection.ElementsFactory.prototype=Object.create(EpisodeCollection.Factory.prototype),EpisodeCollection.ElementsFactory.prototype.constructor=EpisodeCollection.ElementsFactory,EpisodeCollection.ElementsFactory.prototype.create=function(e){return new EpisodeCollection.Element(e)},EpisodeCollection.SlotsFactory=function(){},EpisodeCollection.SlotsFactory.prototype=Object.create(EpisodeCollection.Factory.prototype),EpisodeCollection.SlotsFactory.prototype.constructor=EpisodeCollection.SlotsFactory,EpisodeCollection.SlotsFactory.prototype.create=function(e){return new EpisodeCollection.Slot(e)},EpisodeCollection.EpisodeCollectionController=EpisodeCollection.Model.extend({defaults:{name:null,collection:null,forceLevel:2,needForces:!0,parts:[],elements:[],slots:[],stages:[],extra:[],ready:!1,runned:!1},wrapperClassName:"withCollection",initialize:function(){this.set({parts:new Artifacts.Collection,elements:new Artifacts.Collection,slots:new Artifacts.Collection,stages:new Artifacts.Collection}),this.partsFactory=new EpisodeCollection.PartsFactory,this.elementsFactory=new EpisodeCollection.ElementsFactory,this.slotsFactory=new EpisodeCollection.SlotsFactory,this.service=EpisodeCollection.EpisodeCollectionService(this.get("name")),this.on("change:name",function(){this.service.setPrefix(this.get("name"))},this),this.button=new EpisodeCollection.EpisodeCollectionButton({model:this}),this.button.on("click",this._onOpen,this),this.on("loaded",this._onLoaded,this),this.on("change:collection",this._onChange,this),application.on("completeBonusWorldLevel",this._onCompleteBonusWorldLevel,this)},getCurrentLevel:function(){var e=_.map(episode.scores.pluck("level"),function(e){return parseInt(e)});return e.push(0),_.max(e)+1},_onChange:function(){this.button.hide(),$(".wrapper").toggleClass(this.wrapperClassName,!!this.get("collection")),this.get("collection")?(this._init(),this._load()):this._reset()},_init:function(){var e=this.get("collection");if(e){this.set("name",e.name),this.set("runned",!1),e.forceLevel&&this.set("forceLevel",e.forceLevel);var t=this.partsFactory.createAll(e.parts);this.get("parts").reset(t);var i=this.elementsFactory.createAll(e.elements);this.get("elements").reset(i);for(var o=_.map(e.stages,function(e,t){return e.index=t,e}),a=[],n=0;n<e.slots;n++){var r=this.slotsFactory.create({id:n+1,stages:o});r.on("ready",this._onReady,this),r.on("changed",this.save,this),a.push(r)}this.get("slots").reset(a),this.set("extra",e.extra),this.set("externalDropper",e.externalDropper)}},_load:function(t){var o=this.getElements(),i=this.getParts(),a=this.getSlots();this.get("name");this.service.get(_.bind(function(e){e&&(e.slots instanceof Array&&e.slots.forEach(_.bind(function(e){if(e.elementId){var t=_.findWhere(a,{id:e.slotId});if(!t)return;var i=_.findWhere(o,{id:e.elementId});if(!i)return;t.setElement(i),t.updateState(e,!0),t.activate()}},this)),e.parts instanceof Array&&e.parts.forEach(function(e){var t=_.findWhere(i,{id:e.partId});t&&t.setAmount(e.amount)})),this.trigger("loaded"),t&&t()},this),function(e){console.error("Error:",e)})},_onLoaded:function(){this.checkReady(),this.getCurrentLevel()>this.get("forceLevel")?(this.set("runned",!0),this.button.show()):this.once("change:runned",function(){this.get("name")&&(this.button.show(),this.showForces())},this),this.save()},showForces:function(){var e=this;application.waitPageAndRun("main",function(){e.get("name")===episode.get("num")?(new EpisodeCollection.EpisodeCollectionForces).run():e.showForces()})},_onCompleteBonusWorldLevel:function(){this.get("collection")&&!this.get("runned")&&application.level.num===this.get("forceLevel")&&(this.set("runned",!0),Game&&Game.cancelNext())},_onOpen:function(){this.button.hide(),this.window=new EpisodeCollection.EpisodeCollectionWindow({model:this}),this.window.on("clickOnPart",this._onClickOnPart,this),this.window.on("clickOnSlot",this._onClickOnSlot,this),this.window.on("ready",this._onReady,this),this.window.on("close",function(){this.checkReady(),this.button.show()},this)},_reset:function(){this.set("name",null),this.get("parts").reset(),this.get("elements").reset(),this.get("slots").each(function(e){e.stop()}),this.get("slots").reset(),this.get("stages").reset()},addItem:function(e,t){if(this.get("collection")&&e){var i=_.findWhere(this.getParts(),{id:e});i&&i.setAmount(i.getAmount()+(t||1)),this.checkReady(),this.save()}},fillSlot:function(e){var t=this.getParts(),i=this.selectElement(t);return i&&i.assemble(t)?(e.setElement(i),e.activate(),void this.save()):this.suggestBuy()},getElementByChance:function(e){var i=[],o=0;_.each(e,function(e){var t=e.getChance();o+=t,i.push({chance:o,element:e})}),i.sort(function(e,t){return t.chance-e.chance});for(var t,a=Math.random()*o,n=0;n<i.length&&!(i[n].chance<a);n++)t=i[n].element;return t},hasAvailableElements:function(){var t=this.getParts();return _.some(this.getElements(),function(e){return e.canAssembledFrom(t)})},selectElement:function(t){t=t||this.getParts();var e=_.filter(this.getElements(),function(e){return e.canAssembledFrom(t)});return!!e.length&&this.getElementByChance(e)},_onClickOnPart:function(e){e.getAmount()||this.suggestBuy(e)},_onClickOnSlot:function(e){e.isEmpty()?this.fillSlot(e):e.update(e)},checkReady:function(){_.some(this.getSlots(),function(e){return e.isEmpty()})&&this.hasAvailableElements()?this.set("ready",!0):_.some(this.getSlots(),function(e){return e.isReadyToUpdate()})?this.set("ready",!0):this.set("ready",!1)},_onReady:function(){this.set("ready",!0)},save:function(){var e=this.getSlots().map(function(e){return e.toJSON()}),t=this.getParts().map(function(e){return e.toJSON()});this.service.save({slots:e,parts:t})},getParts:function(){return this.get("parts").toArray()},getElements:function(){return this.get("elements").toArray()},getSlots:function(){return this.get("slots").toArray()},suggestBuy:function(e){var t;if(e){if(0<e.getAmount())return;t=[e]}else if(!(t=_.filter(this.getParts(),function(e){return e.getAmount()<=0})).length)return;this.window.hide();var i=new EpisodeCollection.EpisodeCollectionShopWindow({parts:t,onTop:!0});i.on("buyPart",function(e){this.addItem(e.id)},this),i.on("close",function(){this.window.show()},this)}}),EpisodeCollection.EpisodeCollectionService=function(i){return{save:function(e){callServiceAddInQueue("../../../gems/site/service/episodecollections/saveepisodecollection.php",{prefix:i,data:JSON.stringify(e)})},get:function(e,t){callService("../../../gems/site/service/episodecollections/loadepisodecollection.php",e,t,{prefix:i})},setPrefix:function(e){i=e}}},EpisodeCollection.EpisodeCollectionWindow=TWindow.extend({templateClass:".episodeCollectionWindow_template",slots:[],parts:[],events:{"click .close":"close","click .info":"openList","click .return":"closeList"},onOpen:function(){this.$main=this.$(".main"),this.$list=this.$(".list"),this.$list.hide(),this.initSlots(),this.initParts(),0<this.$(".playerPowerupsBlock").length&&(this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")})),TWindow.prototype.onOpen.call(this)},initSlots:function(){var i=this.$(".slots");i.empty(),this.slots.length=0,this.model.get("slots").each(_.bind(function(e,t){new EpisodeCollection.EpisodeCollectionSlotView({model:e,container:i,index:t}).on("click",function(e){this.trigger("clickOnSlot",e)},this)},this))},initParts:function(){var t=this.$(".parts");t.empty(),this.model.get("parts").each(_.bind(function(e){new EpisodeCollection.EpisodeCollectionPartView({model:e,container:t}).on("click",function(e){this.trigger("clickOnPart",e)},this)},this))},openList:function(){this.$main.hide(),this.renderList(),this.$list.show()},closeList:function(){this.$list.hide(),this.$main.show()},renderList:function(){this.listCreated||(new EpisodeCollection.EpisodeCollectionListView({container:this.$list.find(".collection"),list:this.model.get("elements").toArray()}),this.listCreated=!0)},onClose:function(){this.trigger("close")}}),EpisodeCollection.EpisodeCollectionShopWindow=TWindow.extend({templateClass:".episodeCollectionShopWindow_template",selectors:{buyItem:".invisible .episodeCollectionBuyItem",partContainer:".part",priceContainer:".price",buyButton:".buy",buyText:".buyText",title:".windowSmallTitle"},events:{"click .close":"close"},onOpen:function(){var e=episode.get("episodeCollection").messagename||episode.get("episodeCollection").name,t=e+"ItemWindowTitle",i=e+"ItemWindowText";this.$(this.selectors.title).html(messages[t]);var o=this.$(".items"),a=$(this.selectors.buyItem).clone();this.options.parts.forEach(_.bind(function(e){this.$el.addClass("item"+e.id);var t=a.clone().appendTo(o);new EpisodeCollection.EpisodeCollectionPartView({container:t.find(this.selectors.partContainer),model:e}),t.find(this.selectors.priceContainer).html(e.getPrice()),t.find(this.selectors.buyText).html(messages[i]),t.find(this.selectors.buyButton).on("click touchend",_.bind(function(){this.buyPart(e)},this))},this))},buyPart:function(e){var t=user.get("coins").get(),i=e.id,o=e.get("price");t<o?(this.close(),new AddCoinsWindow({firstPriority:!0})):(user.set("coins",new ObscureNumber(user.get("coins")-Number(o))),user.set({actionName:"buy "+i,actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:o}),this.trigger("buyPart",e),this.close())},close:function(){TWindow.prototype.close.call(this),this.trigger("close")}}),EpisodeCollection.EpisodeCollectionButton=EpisodeCollection.View.extend({el:"#episodeCollectionButton",warningClass:"warning",events:{click:"_onClick"},initialize:function(){this.model.on("change:ready",function(e,t){t?this.addClass(this.warningClass):this.removeClass(this.warningClass)},this)},_onClick:function(){this.trigger("click",this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},addClass:function(e){this.$el.addClass(e)},removeClass:function(e){this.$el.removeClass(e)}}),EpisodeCollection.EpisodeCollectionSlotView=EpisodeCollection.View.extend({selectors:{slot:".invisible .episodeCollectionSlot",elementContainer:".element",timerContainer:".timer",signContainer:".sign"},classes:{empty:"empty",added:"added",updated:"updated",ready:"ready",last:"last",removed:"removed"},attrs:{slotIndex:"data-index",stage:"data-stage",elementInSlotId:"data-element-id",elementInSlotType:"data-element-type"},animationDuration:10,stageClass:null,initialize:function(e){this.$el=$(this.selectors.slot).clone().attr(this.attrs.slotIndex,e.index),this.$elementContainer=this.$(this.selectors.elementContainer),this.$timerContainer=this.$(this.selectors.timerContainer),this.$signContainer=this.$(this.selectors.signContainer),this.$element=new EpisodeCollection.EpisodeCollectionElementView({container:this.$elementContainer}),this.renderElement(),this.renderSlot(),this.$el.appendTo(e.container),this.model.on("change:element",function(){this.renderElement()},this),this.model.on("change:stageId",function(){this._updateStage()},this),this.model.on("change:timer",this._updateTimer,this),this.model.on("change:signId",this._updateSign,this),this.model.on("change:ready",this._onReady,this),this.model.on("change:last",function(e,t){this.$el.toggleClass(this.classes.last,t)},this),this.model.on("add",this._onAdd,this),this.model.on("remove",this._onRemove,this),this.$el.on("click touchend",_.bind(this._onClick,this))},renderElement:function(){var e=this.model.getElement();this.$el.toggleClass(this.classes.empty,!e),this.$el.attr(this.attrs.elementInSlotId,e?e.id:"").attr(this.attrs.elementInSlotType,e?e.getType():""),e?(this.$element.render(e),this._updateTimer()):this._clearTimer(),this._updateSign()},renderSlot:function(){this._updateStage(!0),this.model.get("ready")&&this.$el.addClass(this.classes.ready),this.model.get("last")&&this.$el.addClass(this.classes.last)},_updateStage:function(e){var t=this.model.get("stage");this.$el.attr(this.attrs.stage,t?t.id:0),this.$el.removeClass(this.classes.ready),this.stageClass&&(this.$el.removeClass(this.stageClass),this.stageClass=null),e||t&&t.cssClass&&(this.stageClass=t.cssClass,this.$el.addClass(t.cssClass),setTimeout(_.bind(function(){this.stageClass=null,this.$el.removeClass(t.cssClass)},this),1e3*(t.animationDuration||this.animationDuration))),this._updateSign()},_updateTimer:function(){var e=this.model.getTimer();e=Math.floor(e);var t=Math.floor(e/60),i=Math.floor(t/60),o=t-60*i,a=e-60*t;i<10&&(i="0"+i),o<10&&(o="0"+o),a<10&&(a="0"+a);var n=i+":"+o+":"+a;this.$timerContainer.html(n)},_clearTimer:function(){this.$timerContainer.html("")},_updateSign:function(){this.$signContainer.html(this.model.getSign())},_onAdd:function(){var e=this.model.getElement();this.$el.attr(this.attrs.elementId,e.id),this.$el.addClass(this.classes.added).removeClass(this.classes.removed)},_onReady:function(){var e=this.model.get("ready");this.$el.toggleClass(this.classes.ready,e),this._updateSign(),e&&this.$el.removeClass(this.classes.added),this._clearTimer()},_onRemove:function(){this.$element.onRemove(),this.$el.addClass(this.classes.removed).addClass(this.classes.empty).removeClass(this.classes.last).removeClass(this.classes.ready),this._updateSign()},_onClick:function(){this.trigger("click",this.model)}}),EpisodeCollection.EpisodeCollectionElementView=EpisodeCollection.View.extend({selectors:{element:".invisible .episodeCollectionElement",prizeItem:".invisible .episodeCollectionPrizeItem",prizeContainer:".prizes",prizeItemAmount:".amount",probabilityContainer:".probability .value"},classes:{deleted:"deleted",prizeItem:"prize",prizes:{good:"good",powerUp:"powerUp",coins:"coins"}},attrs:{elementId:"data-id",elementType:"data-type",prizeType:"data-type",prizeName:"data-name"},initialize:function(e){this.$container=e.container,this.$el=$(this.selectors.element).clone(),this.$prizeItem=$(this.selectors.prizeItem).clone(),this.$prizeContainer=this.$(this.selectors.prizeContainer)},render:function(e){this.$el.attr(this.attrs.elementId,e.id).attr(this.attrs.elementType,e.getType()),this.$prizeContainer.empty(),_.each(e.getPrize(),_.bind(function(e){this.renderPrizeItem(e)},this)),this.$el.find(this.selectors.probabilityContainer).html(e.getChance()),this.$el.appendTo(this.$container)},renderPrizeItem:function(e){var t=this.$prizeItem.clone().appendTo(this.$prizeContainer).attr(this.attrs.prizeType,e.type).attr(this.attrs.prizeName,e.name).addClass(this.classes.prizeItem).addClass(this.classes.prizes[e.type]).addClass(e.cssClass),i=e.amount;_.contains(["unlimitedLifes","unlimitedBonusWorldLives3"],e.name)&&(1<=i?i+=" <span>"+this.getWordEnding(i,messages.hours)+"</span>":(i*=60,i+=" <span>"+this.getWordEnding(i,messages.minutes)+"</span>")),t.find(this.selectors.prizeItemAmount).html(i)},getWordEnding:function(e,t){if(1===t.length)return t[0];if(2===t.length)return 1===e?t[0]:t[1];return t[4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]},onRemove:function(){this.$el.addClass(this.classes.deleted),this.$el.remove()}}),EpisodeCollection.EpisodeCollectionPartView=EpisodeCollection.View.extend({selectors:{part:".invisible .episodeCollectionPart",partAmount:".amount"},classes:{empty:"empty"},attrs:{partIndex:"data-index",partId:"data-id"},texts:{emptyPart:"+"},initialize:function(e){this.$el=$(this.selectors.part).clone().attr(this.attrs.partIndex,e.index),this.$amountContainer=this.$(this.selectors.partAmount),this.render(),this.$el.appendTo(e.container),this.model.on("change:amount",this._updateAmount,this),this.$el.on("click touchend",_.bind(this._onClick,this))},render:function(){this.$el.attr(this.attrs.partId,this.model.id),this._updateAmount()},_updateAmount:function(){var e=this.model.getAmount();this.$el.toggleClass(this.classes.empty,!e);var t=0<e?e:this.texts.emptyPart;this.$amountContainer.html(t)},_onClick:function(){this.trigger("click",this.model)}}),EpisodeCollection.EpisodeCollectionListView=EpisodeCollection.View.extend({selectors:{listItem:".invisible .episodeCollectionListItem",elementContainer:".element"},classes:{},attrs:{elementId:"data-id",elementType:"data-type"},initialize:function(e){this.$el=e.container,this.list=e.list,this.$listItem=$(this.selectors.listItem).clone(),this.render()},render:function(){this.$el.empty(),_.each(this.list,_.bind(function(e){this.getListItem(e).appendTo(this.$el)},this))},getListItem:function(e){var t=this.$listItem.clone().attr(this.attrs.elementId,e.id).attr(this.attrs.elementType,e.getType());return new EpisodeCollection.EpisodeCollectionElementView({container:t.find(this.selectors.elementContainer)}).render(e),t}}),EpisodeCollection.EpisodeCollectionDropper=EpisodeCollection.Model.extend({collectedProp:"episodeCollectionItemCollected",createdProp:"specialItemCreated",event:"episodeCollectionItemCollected",inited:!1,defaults:{cellClass:ArtifactPartCell,type:8,offset:0,collection:null,minLevel:3},initialize:function(){this.on("change:collection",this._onChange,this),user.on("createNewGame",this._onCreateGame,this),application.on("game_win",this._onWin,this),application.off("game_fail",this._onFail,this)},_onChange:function(){this.inited=!!this.get("collection")},canStart:function(){return this.inited&&!this.isLevelPassed(application.level.num)},_onCreateGame:function(){if(this.canStart()&&(this._clear(),!this.get("collection").externalDropper)){var e=this.get("collection").level||this.get("minLevel");application.level.num<e||Game.on("validMove",this._onMove,this)}},isLevelPassed:function(t){return episode.scores.some(function(e){return e.get("level")===t})},_onMove:function(){var e=this.get("collection").chances[Game.get("moves").get()];e&&!Game.get(this.createdProp)&&_.random(0,100)<=e&&this.createSpecialItem()},_onWin:function(){user.get(this.collectedProp)&&this.trigger(this.event,user.get(this.collectedProp)),this._clear()},_onFail:function(){this._clear()},_clear:function(){user.set(this.collectedProp,!1),Game.set(this.createdProp,!1)},getRandomItem:function(){if(!this.canStart())return!1;var e=this.get("collection").parts;return e[_.random(0,e.length-1)]},createSpecialItem:function(){Game.set(this.createdProp,!0);var e={offset:this.get("offset"),cellClass:this.get("cellClass"),type:this.get("type")};Game.fallDownSpecialCells.unshift(e)}}),EpisodeCollection.EpisodeCollectionForceView=Backbone.View.extend({events:{click:"close"},selectors:{wrapper:"#main",container:"#container",blocksContainer:".blockedAnimations",force:"#force",text:"#force .forceText",block:".fieldDisabledBaseForce",arrow:".fieldDisabledArrow",levelAnimation:".levelAnimation"},templates:{disabledBlock:'<div class="fieldDisabledBaseForce"><div class="fieldDisabledContent"></div></div>',arrow:'<div class="fieldDisabledArrow"><div class="fieldDisabledArrowContent"></div></div>'},classes:{arrow:function(e){return e+"Arrow"},button:function(e){return e+"Button"},container:"force",text:"text"},props:{blocksContainer:{"z-index":30},hideProps:{"pointer-events":"none"},restoreProps:{"pointer-events":"auto"}},initialize:function(e){this.options=e||{},this.name=this.getName(),this.$blocksContainer=$(this.selectors.blocksContainer),this.wrapperSizes=this.getWrapperSizes(),this.offset=this.getOffset(),this.$elements=[];var t=_.bind(this.setElements,this);if(t(this.$el),_.each(e.highlightedElements,_.bind(function(e){t(e)},this)),this.$element=this.$elements[0],this.canShow()){var i=_.bind(function(){application.set("forceOpenNow",!0),this.open()},this);application.windows.views.length?application.once("windowsClosed",i,this):i()}else setTimeout(_.bind(this.reset,this),0)},getWrapperSizes:function(){var e=$(this.selectors.wrapper);return{width:parseInt(e.width()),height:parseInt(e.height())}},getOffset:function(){var e=this.$blocksContainer.offset();return{left:Math.round(e.left),top:Math.round(e.top)}},setElements:function(e){e.each(_.bind(function(e,t){var i=$(t);this.$elements.push(this.getElementMetrics(i))},this))},getElementMetrics:function(e){if(e&&e.length){var t=parseInt(e.outerWidth()),i=parseInt(e.outerHeight()),o=e.offset(),a=Math.round(o.left);a-=this.offset.left;var n=Math.round(o.top);return{top:n-=this.offset.top,bottom:n+i,left:a,right:a+t,width:t,height:i,el:e}}},getName:function(){return this.model?this.model.get("name"):this.options.name},canShow:function(){return!(!this.$element||!this.$element.el.is(":visible"))&&(!application.get("forceOpenNow")||this.options.ignoreForceOpenNow||this.model&&this.model.get("ignoreForceOpenNow"))},reset:function(){this.stopListening(),this.undelegateEvents()},getDisabledBlock:function(e){var t={width:e.width+"px",height:e.height+"px",left:e.left+"px",top:e.top+"px"};return e["z-index"]&&(t["z-index"]=e["z-index"]),$(this.templates.disabledBlock).css(t)},setDisabledLine:function(e,t,i){var o,a=t-e;if(!i.length)return o=this.getDisabledBlock({top:e,left:0,height:t-e,width:this.wrapperSizes.width}),this.$blocksContainer.append(o),void o.show();i.sort(function(e,t){return e.left-t.left});for(var n=0,r=0;r<=i.length;r++){var s=i[r],l=s?s.left:this.wrapperSizes.width;o=this.getDisabledBlock({top:e,height:a,left:n,width:l-n}),this.$blocksContainer.append(o),o.show(),n=s?s.right:this.wrapperSizes.width}},setDisabledBlocks:function(){this.$blocksContainer.empty();var e=this.$elements;e.sort(function(e,t){return e.top-t.top});for(var t,i,o,a,n,r,s=0,l=[],d=0,c=this.wrapperSizes.height,g=function(e){for(var t=e||c,i=[],o=0;o<l.length;o++)if(l[o]){var a=l[o].bottom;a<t?(t=a,i.length=0,i.push(o)):a===t&&i.push(o)}return{top:t,els:i}};;){d>=e.length&&!l.length&&(t=!0),i=(a=g(o=!!(n=e[d])&&n.top)).top>=o,o=a.top,r=a.els,this.setDisabledLine(s,o,l);for(var u=r.length-1;0<=u;u--)l.splice(r[u],1);if(t)break;s=o,n&&!i||d++,n&&i&&l.push(n)}},getSublayerZIndex:function(){return this.model?this.model.get("addZIndex")?this.model.get("zindex")||-15:0:-15},setSublayers:function(){var o=this.getSublayerZIndex();_.each(this.$elements,_.bind(function(e){var t=e.el.position(),i=this.getDisabledBlock({width:e.width,height:e.height,top:parseFloat(t.top),left:parseFloat(t.left),"z-index":o});i.addClass(this.classes.button(this.name)),e.el.before(i)},this))},showBlocks:function(){$(this.selectors.block).fadeIn(300)},hideBlocks:function(){$(this.selectors.block).fadeOut(300)},removeBlocks:function(){$(this.selectors.block).remove()},setArrow:function(){var e=$(this.templates.arrow);e.addClass(this.classes.arrow(this.name)),e.css({left:this.$element.left+Math.floor(this.$element.width/2)+"px",top:this.$element.top+"px"}),this.$blocksContainer.append(e)},removeArrow:function(){$(this.selectors.arrow).remove()},getTextId:function(){return this.model?this.model.get("textId")?this.model.get("textId"):this.model.get("name"):this.options.name},setForceText:function(){var e=this.getTextId(),t=messages.ForceTexts[e];$(this.selectors.text).html($('<div class="'+this.classes.text+'">').html(t))},hideForce:function(){$(this.selectors.force).hide(),$(this.selectors.levelAnimation).show()},showForce:function(){$(this.selectors.levelAnimation).hide(),$(this.selectors.force).show()},show:function(){this.shown=!0,$(this.selectors.container).addClass(this.classes.container),this.$blocksContainer.css(this.props.blocksContainer),$(this.selectors.force).removeClass().addClass(this.name),this.showBlocks(),setTimeout(_.bind(function(){this.showForce(),this.setArrow(),this.opened=!0},this),300)},hide:function(){this.hideBlocks(),this.hideForce(),this.removeArrow(),$(this.selectors.container).removeClass(this.classes.container),this.$el.css(this.props.hideProps)},restore:function(){this.$el.css(this.props.restoreProps),this.removeBlocks(),this.model&&this.model.done(),this.options.addCssClass&&this.$el.removeClass(this.options.addCssClass)},open:function(){if(application.get("page")!==this.options.needPage)return application.windows.remove(),void this.reset();this.setDisabledBlocks(),this.model&&this.model.get("notNeedDisabledBg")||this.setSublayers(),this.setForceText(),this.show()},close:function(){this.opened&&(this.opened=!1,this.hide(),setTimeout(_.bind(function(){this.restore(),application.windows.remove(),this.reset(),application.set("forceOpenNow",!1)},this),300))}}),EpisodeCollection.EpisodeCollectionForce=BaseForce.extend({defaults:{view:EpisodeCollection.EpisodeCollectionForceView,needPage:"main",addZIndex:!1,notNeedDisabledBg:!1},initialize:function(){this.process()},getEl:function(){return $(this.get("element"))},done:function(){this.get("model").trigger("done")},getHighlightedElements:function(){var e=this.get("highlightedElements");return e&&e.length?_.map(e,function(e){return $(e)}):[]}}),EpisodeCollection.EpisodeCollectionForces=EpisodeCollection.Model.extend({forces:[{name:"episodeCollectionForce1",element:"#episodeCollectionButton"},{name:"episodeCollectionForce2",element:'.episodeCollectionSlot[data-index="0"]',highlightedElements:['.episodeCollectionPart[data-id="1"]'],timeout:600}],current:0,next:function(){if(this.current>=this.forces.length)this.trigger("finish");else{var e=this.forces[this.current];e.textId=this.getTextId(this.current),e.model=this,setTimeout(_.bind(function(){this.force=new EpisodeCollection.EpisodeCollectionForce(e),this.current++},this),e.timeout||0)}},run:function(){window.mobile?this.trigger("finish"):(this.on("done",this.next,this),this.next())},getTextId:function(e){return(episode.get("episodeCollection").forcename||episode.get("episodeCollection").name)+"Force"+e}}),AreYouSureExitWindow.prototype.onOpen=(Tge=AreYouSureExitWindow.prototype.onOpen,function(){if(Tge.call(this),episode.get("episodeCollection")&&user.get("episodeCollectionItemCollected")){this.$el.addClass("specialItemCollected").addClass("specialItem"+user.get("episodeCollectionItemCollected"));var e=episode.get("episodeCollection"),t=messages[e.name+"ItemLevelExitText"],i=messages[e.name+"ItemLevelExitWarning"],o=this.$(".specialContent");t&&o.find(".topText").html(t),i&&o.find(".bottomText").html(i)}}),OutOfMovesWindow.prototype.onOpen=(Yge=OutOfMovesWindow.prototype.onOpen,function(){if(Yge.call(this),episode.get("episodeCollection")&&user.get("episodeCollectionItemCollected")){this.$el.addClass("specialItemCollected").addClass("specialItem"+user.get("episodeCollectionItemCollected"));var e=episode.get("episodeCollection"),t=messages[e.name+"ItemLevelExitText"],i=messages[e.name+"ItemLevelExitWarning"],o=this.$(".specialContent");t&&o.find(".topText").html(t),i&&o.find(".bottomText").html(i)}}),StatisticAfterWindow.prototype.onOpen=(bhe=StatisticAfterWindow.prototype.onOpen,function(){bhe.call(this),episode.get("episodeCollection")&&user.get("episodeCollectionItemCollected")&&this.$el.addClass("specialItemCollected").addClass("specialItem"+user.get("episodeCollectionItemCollected"))}),ArtifactPartCell.prototype.createDiv=(che=ArtifactPartCell.prototype.createDiv,function(){var e=che.call(this);if(episode.get("episodeCollection")){this.collectionPart=!0;var t=episode.episodeCollectionDropper.getRandomItem();t&&t.id&&(this.collectionPartId=t.id),e.find(".artifactPartCellBg").addClass("specialItemRemove")}return e}),ArtifactPartCell.prototype.afterRemove=(fhe=ArtifactPartCell.prototype.afterRemove,function(){if(fhe.call(this),this.collectionPartId){user.set("episodeCollectionItemCollected",this.collectionPartId);var e=$("#menu .specialworldCoinMenuBlock");e.length&&e.addClass("active")}});var DeliciousAdventureRecipeGroupsView=Backbone.View.extend({initialize:function(){this.render()},render:function(){var e,t=this.$el,i=_createForOfIteratorHelper(this.model.getGroups());try{for(i.s();!(e=i.n()).done;){var o=e.value,a=$("<div class=recipe></div>");a.addClass("group".concat(o.id)),a.append($('<div class="title">'+messages[this.model.get("prefix")+"RecipeGroups"][o.id]+"</div>"));var n,r=_createForOfIteratorHelper(this.model.getForge().getRecipesByGroup(o.id));try{for(r.s();!(n=r.n()).done;){var s=n.value;a.append(this.renderRecipe(s))}}catch(e){r.e(e)}finally{r.f()}new DeliciousAdventureGroupPrizeView({model:o,prefix:this.model.get("prefix"),forge:this.model.getForge(),el:$('<div class="prizeBlock"></div>').appendTo(a)}),t.append(a)}}catch(e){i.e(e)}finally{i.f()}},showInfo:function(){console.log("info")},renderRecipe:function(e){var t=$("<div class=recipeBlock></div>");t.addClass("recipe".concat(e.get("id"))),t.append($('<div class="title">'+messages[this.model.get("prefix")+"RecipeNames"][e.get("id")]+"</div>"));var i=$('<div class="ingredientsBlock"></div>');return e.getIngredients().map(function(e){return new DeliciousAdventureIngredientView({model:e,el:$('<div class="ingredient"></div>').appendTo(i)})}),t.append(i),new DeliciousAdventureArtefactView({model:e,prefix:this.model.get("prefix"),forge:this.model.getForge(),el:$('<div class="recipeFinal"></div>').appendTo(t)}),t}}),DeliciousAdventureGroupPrizeView=Backbone.View.extend({initialize:function(e){var i=this;this._forge=e.forge,this._prefix=e.prefix;var t=messages[this._prefix+"RecipeGroups"][this.model.id];this.$el.append($('<div class="title">'+messages[this._prefix+"RecipeGroupsPrize"].replace("%recipeGroup%",t)+"</div>"));var o=new Prize(this.model.prizes[0]),a=$('<div class="reward"><div class="products"></div></div>');a.addClass(o.get("type")),this._userPrize=new UserPrizesView({isGroup:!0,model:o.get("products"),el:a.find(".products")}),this.$el.append(a);var n=$(".invisible .progressBlock.simple").clone();this.$el.append(n);var r=this._forge.getRecipes();this.listenTo(r,"change:amount",function(e,t){e.get("group")===i.model.id&&i.updateProgress()}),this.updateProgress()},updateProgress:function(){var e,t=this._forge.getRecipesByGroup(this.model.id),i=0,o=_createForOfIteratorHelper(t);try{for(o.s();!(e=o.n()).done;){0<e.value.get("amount")&&i++}}catch(e){o.e(e)}finally{o.f()}this.$el.toggleClass("completed",i>=t.length),this.$(".progressBarLine").css({width:"".concat(100*i/t.length,"%")}),this.$(".progressLabel").html("".concat(i,"/").concat(t.length))}}),DeliciousAdventureIngredientView=Backbone.View.extend({events:{click:"onClickShowInfoIngredient"},initialize:function(e){this.$el.addClass("ingredient"+this.model.getKey()),this.$el.append($('<div class="image"></div>'));var t=$('<div class="typeIcon"></div>');t.addClass(this.model.get("part").get("material")),this.$el.append(t);var i=$('<div class="counter"><span>0/0</span></div>');this.$el.append(i),this.onUpdateAmount(),this.listenTo(this.model,"change",this.onUpdateAmount)},onUpdateAmount:function(){this.$(".counter").html('<span class="currentAmount">'.concat(this.model.get("currentAmount").toString(),'</span><span class="splitter">/</span><span class="amount">').concat(this.model.get("amount").toString(),"</span>")),this.$(".counter").toggleClass("full",this.model.get("currentAmount")>=this.model.get("amount"))},onClickShowInfoIngredient:function(e){this.model.showInfo()}}),DeliciousAdventureArtefactView=Backbone.View.extend({events:{"click .assembleBtn":"onClickAssemble"},initialize:function(e){var i=this;this._forge=e.forge,this._prefix=e.prefix,this.$el.append($('<div class="image"></div>')),this.$el.append($('<div class="newShield"></div>')),this.$el.append($('<div class="infoBtn"></div>')),this.$el.append($('<div class="assembleBtn"><span class="text">'+messages[this._prefix+"Forge"].craft+"</span></div>")),this.model.getPrizes().forEach(function(e){var t=$('<div class="reward"><div class="products"></div></div>');t.addClass(e.get("type")),i._userPrize=new UserPrizesView({model:e.get("products"),el:t.find(".products")}),i.$el.append(t)}),this.onUpdateAmounts(),this.listenTo(this.model,"change:active change:amount",this.onUpdateAmounts)},onUpdateAmounts:function(){this.$(".assembleBtn").toggleClass("hidden",!this.model.get("active")),this.$(".newShield").toggleClass("hidden",0<this.model.get("amount"))},onClickAssemble:function(e){this._forge.craft(this.model)}}),DeliciousAdventureView=BonusWorldView.extend({events:_.defaults({"click .prizeControllerOuterProgressBar":"onProgressBarClick"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$el),model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.recipeGroupsView=new DeliciousAdventureRecipeGroupsView({el:$('<div class="recipeGroupsWrapper"></div>').appendTo(this.$el),model:this.model.getComponent(RecipeGroupComponent)});var e=this.model.getComponent(PrizeController);if(e){var t=$("#prizeControllerTemplates .prizeInfoBox").clone(),i=this.$(".prizesInfoContainer");i.addClass(this.model.get("name")),t.appendTo(i),t.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:t,model:e})}this.model.cmp("gifts")&&(this.giftTrinketsView=new GiftTrinketsView({el:$(".mainTemplates .stockings").clone().appendTo(this.$el),itemTpl:$(".mainTemplates .stocking"),model:this.model.cmp("gifts")}))},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),episodeView.mapController&&episodeView.mapController.removeEventsSubscription();for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.prizeControllerProgressbar.update(),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn(),this.updateRandomLevelBtn(),this.updatePrizesFinishedClass(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateStartBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),episodeView.mapController&&episodeView.mapController.subscribeEvents();var e=this.model.getComponent(PrizeController);this.model.off("afterChangeLocation",this.updateStartBtn,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateStartBtn,this),e.off("change:points",this.updatePrizesFinishedClass,this)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()&&e.getPoints()<e.getMaxPointsPossible()),this.$randomBtn.find(".mRandomLevelBtnText").html(t)},updateStartBtn:function(){this.model.getComponent(PrizeController);var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation())},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())},updateProgressBar:function(){this.prizeControllerProgressbar.update()},onProgressBarClick:function(){this.model.openPrizeControllerInfo()},onTakePrizes:function(e){}}),BaseWorld=Backbone.Model.extend({defaults:{view:null,viewTpl:".worldTemplates .world",viewParent:"#templates",version:"",active:!1,enabled:!0,minRealLevelToEnter:22,closeForFinish:!0,showStartWindow:!1,music:"mainmusic",firstStart:!0},constructor:function(e){Backbone.Model.call(this,e),this.timer=new Timer,this.controllers=new Backbone.Collection,this.actionQueue=application.actionQueue,application.on("windowShow",this.onWindowShow,this)},getCurrentLevel:function(){return 1},hasTimer:function(){return this.timer.isActive()},getTimer:function(){return this.timer.getTimer()},getFinishTime:function(){return this.timer.getFinishTime()},isEntered:function(){return this._entered},isStarted:function(){return!0},getName:function(){return this.get("name")},getPageName:function(){return"world-".concat(this.get("name"))},preload:function(){var e=this;return this.ln=application.ln.createSub(this.get("name")),Promise.resolve().then(function(){return e.emit("preload",e)}).then(function(){return Promise.all(e.controllers.map(function(e){return e.preload()}))})},preloadFromServer:function(){var e=this;return Promise.resolve().then(function(){return e.emit("preloadFromServer",e)}).then(function(){return Promise.all(e.controllers.map(function(e){return e.preloadFromServer()}))}).then(function(){return e.emit("afterPreloadFromServer",e)})},load:function(i){var e=this;return Promise.resolve().then(function(){return e.emit("load",e)}).then(function(){return Promise.all(e.controllers.map(function(e){return e.load()}))}).then(function(){return e.loadFromServer()}).then(function(){return e.emit("afterLoad",e)}).then(function(){var e=_.result(i,"resources");if(e&&0<e.length){var t=e.filter(function(e){return-1!==e.indexOf(".png")||-1!==e.indexOf(".jpg")});if(0<t.length)return Promise.all(t.map(function(t){return new Promise(function(e){return application.preloader.preloadImage(t,e)})}))}}).catch(function(e){console.error(e)})},loadFromServer:function(){var e=this;return Promise.resolve().then(function(){return e.emit("loadFromServer",e)}).then(function(){return Promise.all(e.controllers.map(function(e){return e.loadFromServer()}))}).then(function(){return Promise.all(e.controllers.map(function(e){return e.afterLoadFromServer()}))})},isAvailabilityEnter:function(){return!this.get("minRealLevelToEnter")||this.get("minRealLevelToEnter")<=user.getCurrentLevel()},isAvailability:function(){return this.get("production"),!!this.isAvailableByBeginDate()&&!!application.isAvailability(this.get("availability"))},isAvailableByBeginDate:function(){if(this.get("beginDate")){var e=application.getCurrentServerTime()||Date.now()/1e3;return this.get("beginDate").getTime()/1e3<e}return!0},isOpenedForUser:function(){return!!this.get("active")},isOutdated:function(){return!1},isIntegrationEvent:function(){return"vkontakte"==network},addComponent:function(e){var t=new e(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},this);return this.controllers.add(t),t},getComponent:function(t){return"string"==typeof t?this.controllers.get(t):this.controllers.find(function(e){return e instanceof t})},cmp:function(e){return this.getComponent(e)},hasComponent:function(e){return!!this.getComponent(e)},isSatellite:function(){return!1},getComponents:function(){return this.controllers},destroy:function(){return this.off(),this.stopListening(),Promise.all(this.controllers.map(function(e){return e.destroy()}))},init:function(){var e=this;return Promise.all(this.controllers.map(function(e){return e.init()})).then(function(){e.inited=!0}).then(function(){return e.emit("afterInit",e)})},getView:function(){if(!this.view){var e=this.get("view");this.view=new e({model:this,el:$(this.get("viewTpl")).clone().attr("id",this.getPageName()).appendTo(this.get("viewParent"))},this.ln),this.view.render()}return this.view},open:function(){var e=this;if(this.get("active")&&this.get("enabled")&&this.inited){if(application.get("page")===this.getPageName())return Promise.resolve();if(!this.isAvailabilityEnter())return new BonusWorldNotAvailableWindow({bonusWorld:this}),Promise.reject("world not available");var t,i=this.getView(),o=setTimeout(function(){t=new WaitWindow},1e3);return Promise.resolve().then(function(){return e.onBeforeOpen(i)}).then(function(){return e.load(i)}).then(function(){clearTimeout(o),t&&t.close()}).then(function(){return e.onOpen(i)})}return Promise.reject("world not active")},onBeforeOpen:function(e){return(Config.bonusWorld=this).emit("beforeOpen",this,e)},onOpen:function(e){var t=this;return this.showed=!0,application.set("page",this.getPageName()),Promise.resolve().then(function(){return t.emit("beforeEnter",t)}).then(function(){return Promise.all(t.controllers.map(function(e){return e.open()}))}).then(function(){return application.waitPage(t.getPageName())}).then(function(){return t._entered=!0}).then(function(){return t.emit("enter",t)})},exit:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._entered=!1,t||!application.windows.anyWindowOpen()&&Config.bonusWorld===this?Promise.resolve().then(function(){return e.emit("exit")}).then(function(){Config.bonusWorld=Config.freeEpisodeName===episode.get("num")?Config.bonusWorlds.getByName(Config.freeEpisodeName):null,application.windows.closeAll(),application.set("page","main")}):Promise.resolve()},reset:function(){var e=this;return Promise.resolve().then(function(){return service("../../../gems/site/service/world/resetbonusworld.php",{name:e.getName()})}).then(function(){return Promise.all(e.controllers.map(function(e){return e.reset?e.reset():Promise.resolve()}))}).then(function(){setLocalStorage(e.get("name")+"BonusWorldForceShown",!1),setLocalStorage(e.get("name")+"ProlongTimes",0),setLocalStorage(e.get("name")+"_timeoutShown",0)})},getArtifactPartsPrefix:function(){return this.hasComponent("parts")?this.cmp("parts").getPrefix():this.get("name")},onWindowShow:function(e){application.getExternalWorld()!==this||!(e instanceof StatisticWindow||e instanceof OutOfMovesWindow||e instanceof BaseCogentWindow||e instanceof FailedWindow||e instanceof AreYouSureExitWindow)||episode.isBonusWorld()&&!Config.bonusWorld.get("isFreeEpisode")||(e.$el.addClass(this.get("name")),e.$(".bottomText").html(messages[this.get("name")+"ItemLevelExitWarning"]))}}),WorldsComponent=function(e){_inherits(o,BaseApplicationComponent);var i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=i.call(this))._items=new Backbone.Collection(e),t}return _createClass(o,[{key:"load",value:function(e){var i=this;return new Promise(function(t){e.preloader.add(new PreloadTask({name:"worlds",parent:"loadEpisode",task:function(e){Promise.resolve().then(function(){return Promise.all(i._items.map(function(e){return e.preload()}))}).then(function(){return Promise.all(i._items.map(function(e){return e.preloadFromServer()}))}).then(function(){t(),e()})}}))})}},{key:"init",value:function(){return Promise.all(this._items.map(function(e){return e.init()}))}},{key:"getActiveWorlds",value:function(){return this._items.filter(function(e){return e.isAvailability()})}},{key:"getWorlds",value:function(){return this._items}},{key:"getByName",value:function(e){return this._items.findWhere({name:e})}}]),o}();WorldsComponent.prototype.defaults=_.defaults({id:"bonusworld"},BaseApplicationComponent.prototype.defaults);var catchupWindowShowRules={byLevel:function(e,t){for(var i=e.getPrizes(),o=!1,a=0;a<i.length;a++)if(e.getLevel()-2===i[a].get("level")&&!e.hasBattlePass()){o=!0;break}return o},byNextPrizeProgress:function(e,t){return!e.hasBattlePass()},everyThirdPrize:function(e,t){var i=t.getComponent(PrizeController);return!!i&&i.getProgress()%3==0},byPrizeControllerThreshold:function(i){return function(e,t){return t.getComponent(PrizeController).getProgress()>=i}}},BattlePass=Backbone.Model.extend({defaults:{product:"battlePass",hasCatchupWindow:!0,instantPrize:null,catchupWindowRule:catchupWindowShowRules.byLevel},initialize:function(){Application.on("ready",this.setListeners,this);var e=this.findProduct();console.assert(e,"    "+this.getOwner().get("name")+"  "),this.set("product",e),this.set("name",this.getOwner().get("name")),this.get("catchupWindowActivator")||this.set("catchupWindowActivator",new EventSignal("completeLevel",this.getOwner())),this.listenToOnce(this.getOwner(),"configure",this.onConfigure),this.listenTo(this.getOwner(),"enter",this.onEnter),this.listenTo(this.getOwner(),"exit",this.onExit)},onEnter:function(){$("#container, #mainAppWrapper").toggleClass("battlePassActive_"+this.get("name"),this.hasBattlePass()),$("#main .buyBattlePassBtn."+this.getOwner().get("name")).toggleClass("active",!this.hasBattlePass()),this.listenTo(this.get("catchupWindowActivator"),SIGNALEVENT,this.checkCatchupWindow)},onExit:function(){this.stopListening(this.get("catchupWindowActivator"),SIGNALEVENT,this.checkCatchupWindow)},findProduct:function(){for(var e in prices)if("battlePass"===prices[e].type&&prices[e].world===this.getOwner().get("name"))return e},onConfigure:function(e,t){var i=this;$(".mainTemplates .buyBattlePassBtn").clone().addClass(i.getOwner().get("name")).appendTo("#main").on("click touchend",function(){new BuyBattlePassWindow({model:i})}),this.onChangeBattlePass()},onChangeBattlePass:function(){$("#container, #mainAppWrapper").toggleClass("battlePassActive_"+this.getOwner().get("name"),this.hasBattlePass()),$("#main .buyBattlePassBtn").toggleClass("active",!this.hasBattlePass())},setListeners:function(){this.hasBattlePass()||(episode.on("change:num",this.checkWindows,this),this.listenTo(this.getOwner(),"change:hasBattlePass",this.activateBattlePass))},getPrizes:function(){return this.getOwner().rewardChain?this.getOwner().rewardChain.getPrizes().toArray().filter(function(e){return"battlePass"===e.get("type")}):this.getOwner().hasComponent(RewardComponent)?this.getOwner().getComponent(RewardComponent).getPrizes().toArray().filter(function(e){return"battlePass"===e.get("type")}):this.getOwner().hasComponent(PrizeController)?this.getOwner().getComponent(PrizeController).getPrizesArray().filter(function(e){return"battlePass"===e.type}).map(function(e){return new UserPrize(e)}):this.getOwner().get("prizes").filter(function(e){return"battlePass"===e.get("type")})},getOwner:function(){return this.get("world")},getLevel:function(){return this.getOwner().getCurrentLevel()},hasBattlePass:function(){return this.getOwner().get("hasBattlePass")},checkCatchupWindow:function(){var e=this;return this.hasBattlePass()?Promise.resolve():this.get("catchupWindowRule")(this,this.getOwner())?Promise.resolve().then(function(){return e.emit("catchupWindow",e)}).then(function(){e.get("hasCatchupWindow")?new CatchUpBattlePassWindow({model:e}):new BuyBattlePassWindow({model:e})}):void 0},boughtBattlePass:function(){callService("../../../levelbase/src/services/buybattlepass.php",_.bind(function(){var e=this.getOwner(),t=this,i=function(){e.set("hasBattlePass",!0),t.get("instantPrize")&&t.giveInstantPrize(),0<t.getMissedPrizes().length&&(e.hasComponent(RewardComponent)?e.getComponent(RewardComponent).activateMissedPrizes():t.givePrizes()),t.removeListeners()};episode.get("num")==e.get("name")?i():e.open().then(function(){i()})},this),fail,{world:this.getOwner().get("name")})},activateBattlePass:function(){this.hasBattlePass()&&this.onChangeBattlePass()},checkWindows:function(){this.isCorrectWorld()&&!this.hasBattlePass()&&this.checkTime()&&1<this.getLevel()&&(0<this.getMissedPrizes().length?new CatchUpBattlePassWindow({model:this}):new BuyBattlePassWindow({model:this}),setLocalStorage("battlePassWindowShown",Date.now()))},isCorrectWorld:function(){return episode.get("num")===this.getOwner().get("name")},checkTime:function(){var e=getLocalStorage("battlePassWindowShown",0);return 0===e||864e5<Date.now()-e},getMissedPrizes:function(){var e=this.getPrizes(),t=this.getOwner().getComponent(PrizeController),i=this.getOwner().rewardChain&&this.getOwner().rewardChain instanceof AlternativeRewardChain;if(t)e=e.filter(function(e){return e.get("progress")<=t.getProgress()});else if(i){var o=this.getLevel();e=e.filter(function(e){return e.get("level")<=o})}else{var a=this.getLevel();e=e.filter(function(e){return e.get("level")<a})}for(var n=[],r=0;r<e.length;r++)n=n.concat(e[r].get("prize"));return _.map(_.groupBy(n,function(e){return e.type+e.name}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})})},givePrizes:function(){if(0<this.getMissedPrizes().length){var e=new UserPrizes(this.getMissedPrizes());new AnimatedPrizesWindow({prizes:e,worldName:this.getOwner().get("name")})}},buy:function(){var o=this;return new Promise(function(t,e){var i=function e(){user.off("buyProduct",e,o),user.off("buyCancel",e,o),t()};user.on("buyProduct",i,o),user.on("buyCancel",i,o),showBuy(prices[o.get("product")])})},giveInstantPrize:function(){var e=this.getOwner().get("name"),t=new UserPrizes(UserPrizes.convertFromCocos(this.get("instantPrize")));new AnimatedPrizesWindow({prizes:t,worldName:e})},removeListeners:function(){episode.off("change:num",this.checkWindows,this),this.stopListening()}}),BuyBattlePassWindow=TWindow.extend({templateClass:".buyBattlePassWindow_template",events:{"click .close":"closeWithReminder","click .buyBtn":"buy"},onOpen:function(){this.$el.find(".priceBlock .price").html(prices[this.model.get("product")].desc.price);var e=this.model.get("world").get("name");this.$(".title").html(messages[e+"BattlePassTitle"]),this.$(".description").html(messages[e+"BattlePassDescription"]),this.$(".buyBattlePassLifeIncrease").html(messages[e+"BuyBattlePassLifeIncrease"]),this.$(".buyBattlePassLifeRegen").html(messages[e+"BuyBattlePassLifeRegen"]),this.$(".buyBattlePassChests").html(messages[e+"BuyBattlePassChests"]),this.$(".buyBattlePassUniqueItem").html(messages[e+"BuyBattlePassUniqueItem"]),this.$(".buyBattlePassPrize").html(messages[e+"BuyBattlePassPrize"]);var t=messages[e+"BuyBattlePassItems"];if(t)for(var i=0;i<t.length;++i)this.$(".itemsContainer .item".concat(i+1," .text")).html(t[i]);if(this.model.get("instantPrize")){var n=this.$(".instantPrizeContainer"),r=this.$(".invisible .battlePassItem");this.model.get("instantPrize").products.forEach(function(e,t){var i,o=r.clone(),a=e.addTime?formatPeriod(e.addTime/60):'<span class="plus">+</span>'+sprintf(messages.quantity,{amount:e.amount||1});switch(e.type){case"GoodProduct":i=e.goodId;break;case"BoosterProduct":i=e.boosterId;break;case"ExactArtifactProduct":i=e.world+"_"+e.partId;break;default:i=e.type}o.addClass(i),o.find(".amount").html(a),o.appendTo(n)})}},buy:function(){var e=this;return this.model.buy().then(function(){return e.close()})},closeWithReminder:function(){!this.options.noCatchUpWindowAfter&&5<this.model.get("world").getCurrentLevel()&&this.model.getMissedPrizes().length&&new CatchUpBattlePassWindow({model:this.model}),TWindow.prototype.close.call(this)}}),CatchUpBattlePassWindow=TWindow.extend({templateClass:".catchUpBattlePassWindow_template",events:{"click .close":"close","click .buyBtn":"buy"},buy:function(){this.model.buy(),this.close()},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.find(".priceBlock .price").html(prices[this.model.get("product")].desc.price);var e=this.model.get("world").get("name");this.$(".title").html(messages[e+"BattlePassTitle"]),this.$(".description").html(messages[e+"CatchUpBattlePassDescription"]);var t=new UserPrizes(this.model.getMissedPrizes());new UserPrizesView({model:t,el:this.$(".items")})}}),MultiWorldBattlePass=BattlePass.extend({defaults:_.defaults({battlePassCoOwners:[]},BattlePass.prototype.defaults),initialize:function(){BattlePass.prototype.initialize.call(this),this.hasBattlePass()||this.resetListeners()},addCoOwner:function(e){this.get("battlePassCoOwners").push(e),this.resetListeners()},resetListeners:function(){var t=this;this.get("battlePassCoOwners").forEach(function(e){e.on("enter",t.onEnter,t),e.on("completelevel",t.checkLevel,t)})},getMissedPrizes:function(){for(var e=this.getOwner().prizecontroller.getProgress(),t=this.getPrizes(),i=[],o=0;o<t.length;o++)e>=t[o].progress&&(i=i.concat(t[o].prize));return _.map(_.groupBy(i,function(e){return e.type+e.name}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})})},getPrizes:function(){return this.getOwner().prizecontroller.getPrizesArray().filter(function(e){return"battlePass"===e.type})},isCorrectWorld:function(){var t=episode.get("num");return t===this.getOwner().get("name")||this.get("battlePassCoOwners").some(function(e){return e.get("name")===t})},checkLevel:function(e){e+1!==1||this.hasBattlePass()||application.once("main",function(){new CatchUpBattlePassWindow({model:this})},this)},removeListeners:function(){var t=this;BattlePass.prototype.removeListeners.call(this),this.get("battlePassCoOwners").forEach(function(e){e.off("completelevel",t.checkLevel,t)})}}),BasePrizeAccountant=Backbone.Model.extend({levelsPerStage:0,constructor:function(e){Backbone.Model.call(this,e)},getPointsByProgress:function(e){return 0},countProgress:function(e){return 0}}),PrizeProgressAccount=BasePrizeAccountant.extend({constructor:function(e,t){BasePrizeAccountant.call(this,t),this.setProgressOptions(e)},setProgressOptions:function(e){var t=0;this.progresByPoints=[];for(var i=0;i<e.length;++i)t+=e[i],this.progresByPoints[i]=t},getPointsByProgress:function(e){return this.progresByPoints[e-1]},getMaxPointsPossible:function(){return this.progresByPoints[this.progresByPoints.length-1]},getMaxProgress:function(){return this.progresByPoints.length},countProgress:function(e){for(var t=0;t<this.progresByPoints.length&&!(this.progresByPoints[t]>e);++t);return t}}),PrizeControllerOuterProgressBar=Backbone.View.extend({initialize:function(){this.$el.addClass(this.model.get("world").get("name")),this.model.on("change:progress",this.update,this),this.model.on("change:points",this.update,this),this.update()},update:function(){var e=this.$(".mBar"),t=Math.max(0,this.model.getNextProgressPoints()-this.model.getCurrProgressPoints()),i=this.model.getPoints()-this.model.getCurrProgressPoints(),o=(i/t*100||0).toFixed(3);this.$(".mProgress").html(i),this.$(".mProgressGoal").html(t),e.css("width",Math.min(100,o)+"%"),this.$el.toggleClass("active",this.model.getPoints()<this.model.getMaxPointsPossible());var a=this.model.get("world").getComponent(PrizeController),n=a.get("progress").get();a.getPrizesArray().length<=n&&this.$el.hide(),this.$(".progress .label").html(this.model.getProgress()+1)}}),PrizeControllerOuterProgressBarNextAllPts=PrizeControllerOuterProgressBar.extend({update:function(){var e=this.$(".mBar"),t=this.model.getPoints(),i=this.model.getNextProgressPoints(),o=Math.max(0,this.model.getNextProgressPoints()-this.model.getCurrProgressPoints()),a=((this.model.getPoints()-this.model.getCurrProgressPoints())/o*100||0).toFixed(3);this.$(".mProgress").html(t),this.$(".mProgressGoal").html(i),e.css("width",Math.min(100,a)+"%"),this.$el.toggleClass("active",this.model.getPoints()<this.model.getMaxPointsPossible());var n=this.model.get("world").getComponent(PrizeController),r=n.get("progress").get();n.getPrizesArray().length<=r&&this.$el.hide()}}),PrizeControllerOuterAnimatedProgressBar=Backbone.View.extend({initialize:function(){this.$el.addClass(this.model.get("world").get("name")),this.model.on("change:progress",this.update,this),this.model.on("change:points",this.update,this),this.update()},update:function(){var s=this;return new Promise(function(r){application.waitPage("main").then(function(){return delay(1500)}).then(function(){var e=s.$(".mBar"),t=Math.max(0,s.model.getNextProgressPoints()-s.model.getCurrProgressPoints()),i=s.model.getPoints()-s.model.getCurrProgressPoints(),o=(i/t*100||0).toFixed(3);s.$(".mProgress").html(i),s.$(".mProgressGoal").html(t),e[0].style.setProperty("--toWidth",Math.min(100,o)+"%"),e.addClass("animated"),setTimeout(function(){e.css("width",Math.min(100,o)+"%"),e.removeClass("animated"),r()},2e3),s.$el.toggleClass("active",s.model.getPoints()<s.model.getMaxPointsPossible());var a=s.model.get("world").getComponent(PrizeController),n=a.get("progress").get();a.getPrizesArray().length<=n&&s.$el.hide(),s.$(".progress .label").html(s.model.getProgress()+1)})})}}),PrizeLevelIntervalControllerOuterProgressBar=Backbone.View.extend({onClick:function(){this.model.world.showInfo()},initialize:function(){this.$el.addClass(this.model.get("world").get("name")),this.model.on("changePoints",this.update,this),this.update()},update:function(){var e=this.$(".mBar"),t=Math.max(0,this.model.getMaxPoints()),i=this.model.getPoints(),o=(i/t*100||0).toFixed(3);this.$(".mProgress").html(i),this.$(".mProgressGoal").html(t),e.css("width",Math.min(100,o)+"%"),this.$(".progress .label").html(this.model.getPoints())}}),TakePrizeWindow=TWindow.extend({templateClass:".TakePrizeWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.publicBlock=new PublicationBlock({el:this.$(".needPublicBlock")}),this.$el.addClass("takePrize"),this.$el.addClass("level"+this.options.variant),this.$(".mTitle").html(messages[this.options.worldName+"PrizeGivenWindow"].title),this.$(".mDescription").html(messages[this.options.worldName+"PrizeGivenWindow"].text),this.options.prize&&(this.userPrizeBlock=new UserPrizesView({model:this.options.prize,el:this.$(".prizes")}))},onClose:function(){if(this.publicBlock.isNeedPublic()){var e=this.options.worldName+this.options.publicationId;user.defaultPublication(e)}TWindow.prototype.onClose.call(this)},remove:function(){TWindow.prototype.remove.call(this),this.publicBlock.remove(),this.publicBlock=null,this.userPrizeBlock&&this.userPrizeBlock.remove(),this.userPrizeBlock=null}}),PrizeInfoView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change",this.update),this.renderPrizes()},renderPrizes:function(){var t=this;this.model.getNextPrizes().forEach(function(e){"battlePass"===e.type&&t._renderPrizeDescription(e),t._renderPrize(e)})},_renderPrize:function(e){var t=this.$("."+e.type).find(".mPrizes");new UserPrizesView({el:t,model:new UserPrizes(e.prize),isGroup:!0})},_renderPrizeDescription:function(e){var t=this.$(".mAdditionalRewardTitle"),i=this.$(".mAdditionalRewardDescription");t.html(messages[this.model.get("world").get("name")+"AdditionalRewardTitle"]),i.html(messages[this.model.get("world").get("name")+"AdditionalRewardDescription"])},update:function(){this.renderPrizes()}}),PrizeControllerInfoWindow=TWindow.extend({templateClass:".prizeControllerInfoWindow_template",events:_.defaults({"click .mToPrizeRoom":"openPrizeRoom"},TWindow.prototype.events),onOpen:function(){var e=this.options.world;this.$(".mTitle").html(messages[e.get("name")+"SnowInfo"].title),this.$(".collectText").html(messages[e.get("name")+"SnowInfo"].rule),this.$(".description1").html(messages[e.get("name")+"SnowInfo"].description1),this.$(".description2").html(messages[e.get("name")+"SnowInfo"].description2),this.$(".description3").html(messages[e.get("name")+"SnowInfo"].description3),this.$(".moreBetsText").html(messages[e.get("name")+"SnowInfo"].hint),this.$(".mToPrizeRoom .buttonText").html(messages[e.get("name")+"SnowInfo"].button)},openPrizeRoom:function(){this.options.prizeController.view.show(),this.close()}}),StarChest=Backbone.Model.extend({defaults:{stars:0,prize:null,publicationId:"ForChest",opened:!1,taken:!1},constructor:function(e){this.controller=e.controller,e.prize.products?e.prize=new UserPrizes(UserPrizes.convertFromCocos(e.prize)):e.prize=new UserPrizes(e.prize),Backbone.Model.call(this,e)},getCurrentStars:function(){return Math.min(this.controller.getCurrStars(),this.get("stars"))},isOpenable:function(){return this.get("stars")<=this.controller.getCurrStars()&&!this.get("opened")},isOpened:function(){return this.get("stars")<=this.controller.getCurrStars()}}),LevelLimitedStarChest=StarChest.extend({defaults:_.defaults({levelFrom:1,levelTo:1},StarChest.prototype.defaults),_getLevelStars:function(){for(var e=episode.scores.pluck("stars"),t=0,i=this.get("levelFrom")-1;i<this.get("levelTo");i++)t+=e[i]||0;return t},getCurrentStars:function(){return Math.min(this._getLevelStars(),this.get("stars"))},isOpenable:function(){return this.get("stars")<=this._getLevelStars()&&!this.get("opened")},isOpened:function(){return this.get("stars")<=this._getLevelStars()}}),StarChestController=BonusWorldComponent.extend({defaults:_.defaults({id:"starChests",name:"starChests",chests:null},BonusWorldComponent.prototype.defaults),initialize:function(e){var t=this;BonusWorldComponent.prototype.initialize.call(this,e);var i=e.chests.map(function(e){return _.defaults(e,{controller:t})}),o=e.ChestModel||StarChest;this.set("chests",new Backbone.Collection(i,{model:o})),this.listenToOnce(this.world,"configure",this.configure)},configure:function(){this.listenTo(this.world,"enter",this._onEnter),this.listenTo(this.world,"exit",this._onExit)},_tryOpen:function(){var e=_slicedToArray(this.get("chests").filter(function(e){return e.isOpenable()}),1)[0];if(e)return Game&&Game.cancelNext(),this._open(e)},load:function(){var i=this;this.get("chests").forEach(function(e){var t=getLocalStorage(i._getChestName(e),{taken:!1});t.opened=e.isOpened(),e.set(t)})},save:function(e){setLocalStorage(this._getChestName(e),{taken:e.get("taken")})},_onEnter:function(){this.load(),this._checkMissedChests(),this.listenTo(episode.scores,"change:stars add",this._tryOpen),this.listenTo(this.get("chests"),"change:taken",this.save)},_onExit:function(){this.stopListening(episode.scores),this.stopListening(this.get("chests"))},_checkMissedChests:function(){var t=this,e=this.get("chests").filter(function(e){return!!e.get("taken")});0<e.length&&e.forEach(function(e){return t.animateGiveChestPrize(e)})},getNextChest:function(){var t=this;return this.get("chests").find(function(e){return e.get("stars")>t.getCurrStars()})},_getChestName:function(e){return"bw_"+this.world.get("name")+"_"+this.world.get("version")+"_starChest"+e.get("id")},getChest:function(e){return this.get("chests").findWhere({id:e})},animateGiveChestPrize:function(e){new AnimatedPrizesWindow({prizes:e.get("prize"),worldName:this.world.get("name")}),e.set({opened:!0,taken:!1}),this.save(e)},getCurrStars:function(){return episode.scores.reduce(function(e,t){return e+t.get("stars")},0)},hasNotTakenChests:function(){return 0<this.get("chests").filter(function(e){return!!e.get("taken")}).length},_isOpenable:function(e){return e.isOpenable()},isOpened:function(e){return e.isOpened()},_open:function(e){var t=this;e.set("taken",!0),application.waitPage("main").then(function(){return t.world.emit("openedStarChest"+e.get("id"))}).then(function(){return application.windows.runAfterCloseAll()}).then(function(){return t.animateGiveChestPrize(e)})}}),RewardChainViewLite=Backbone.View.extend({el:"",events:{"click .rewardObject":"showRewardContent"},initialize:function(){this.render(),this.model.on("updateLevel",this.update,this),this.model.on("enter",this.update,this),this.model.get("world").on("change:hasBattlePass",this.update,this)},render:function(){var e=this.model.get("prizes"),i=$("#main .rewardChainContainer"),o=$(".invisible .rewardObject"),a=this;e.forEach(function(e){var t=o.clone();t.addClass("level"+e.get("level")).addClass(e.get("type")).data("id",e.cid),t.toggleClass("opened",a.model.isOpened(e)),new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.get("prize"))}),i.append(t)})},update:function(){var t=this;this.model.get("prizes").forEach(function(e){this.$(".rewardObject.level"+e.get("level")).toggleClass("opened",t.model.isOpened(e))},this)},showRewardContent:function(e){var t=this.model.get("prizes").get($(e.currentTarget).data("id"));window.mobile&&!this.model.isOpened(t)&&new RewardChainContentView({prize:t,world:this.model.get("world")})},takePrize:function(e,t){var i=this.model.get("world").get("name");new AnimatedPrizesWindow({prizes:this.model.givePrize(e),worldName:i}),t()}}),RewardChainView=Backbone.View.extend({el:"#rewardChain",events:{"click .backBtn":"back","click .rewardObject":"showRewardContent","click .buyBattlePassBtn":"openBattlePass"},initialize:function(){this.render(),this.renderRewardObjects(),this.renderStoryteller(),this.listenTo(this.model.get("world"),"rewardChainBeforeTakePrize",this.onRewardChainBeforeTakePrize),this.listenTo(this.model.get("world"),"rewardChainAfterTakePrize",this.onRewardChainAfterTakePrize)},render:function(){this.model.get("battlePass")&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.mapController=BigMapControllerFactory.create({el:this.$el,bgEl:this.$(".rewardChainWrapper"),mainEl:this.$(".storyteller"),keyIntervalTime:15})},renderRewardObjects:function(){this.field=this.$el.find(".rewardChainField");var e=this.model.get("prizes"),o=this.$el.find(".rewardChainField"),a=this.$(".invisible .rewardHolder"),n=this.$(".invisible .rewardChainWayPoint"),r=this.$(".invisible .rewardObject"),s=this;_.uniq(e.map(function(e){return e.get("level")})).reverse().forEach(function(e){var t=a.clone();t.removeClass("rewardHolder").addClass("rewardHolder"+e),o.append(t);var i=n.clone();i.addClass("point"+e),t.append(i)}),e.forEach(function(e){var t=r.clone(),i=o.find(".rewardHolder"+e.get("level"));t.addClass("level"+e.get("level")).addClass(e.get("type")).data("id",e.cid),t.toggleClass("opened",s.model.isOpened(e)),new UserPrizesView({el:t.find(".prizes"),isGroup:!0,model:new UserPrizes(e.get("prize"))}),i.append(t)});var t=n.clone().addClass("pointStart");o.append(t)},renderStoryteller:function(){var e;e=this.model.countNormalizedLevel()/5%2==0?"left":"right";var t=this.$(".rewardChainWayPoint.point"+(this.model.countNormalizedLevel()||"Start"));this.$(".storyteller").alignTo(t,{css:!0}),this.$(".storyteller").removeClass("left").removeClass("right"),this.$(".storyteller").addClass("onWayPoint"+this.model.countNormalizedLevel()),this.$(".storyteller").addClass(e),this.mapController.focusMainElement(!0)},showRewardContent:function(e){var t=this.model.get("prizes").get($(e.currentTarget).data("id"));window.mobile&&!this.model.isOpened(t)&&new RewardChainContentView({prize:t})},onRewardChainBeforeTakePrize:function(e,t){var i,o=this.$(".rewardChainWayPoint.point"+t),a=this.$(".storyteller"),n=this,r=a.parent().offset(),s=o.offset(),l=a.offset(),d=$(".backBtn");return i=l.left<s.left?"right":"left",new Promise(function(e){d.hide(),n.$bpButton.toggleClass("active",!1),a.removeClass("left").removeClass("right").removeClass("onWayPoint"+n.model.countNormalizedLevel()).addClass("onWayPoint"+t).addClass("animate").addClass(i).ourAnimateCSS({left:s.left-r.left,top:s.top-r.top},3e3,"linear",e),setTimeout(function(){a.removeClass("animate")},3e3)})},onRewardChainAfterTakePrize:function(e,t){var i=this,o=$(".backBtn");this.$bpButton.toggleClass("active",!0),o.show(),this.model.get("prizes").filter(function(e){return e.get("level")===t}).forEach(function(e){$(".rewardObject.level"+t+"."+e.get("type")).toggleClass("opened",this.model.isOpenable(e,t))},this),setTimeout(function(){i.back()},100)},openBattlePass:function(){new BuyBattlePassWindow({model:this.model.get("battlePass")})},updateRewardChain:function(){this.model.get("prizes").forEach(function(e){this.$el.find(".rewardObject.level"+e.get("level")+"."+e.get("type")).toggleClass("opened",this.model.isOpened(e))},this),this.renderStoryteller()},show:function(){return this.model.emit("showRewardChain",this),application.set("page","rewardChain"),this.$el.addClass("active"),this.$el.addClass(this.model.get("world").get("name")),this.$bpButton.toggleClass("active",!this.model.get("battlePass").hasBattlePass()),$("#main .buyBattlePassBtn").toggleClass("active",!1),$("#main").show(),this.updateRewardChain(),Promise.resolve()},back:function(){this.$el.removeClass("active"),this.$el.removeClass(this.model.get("world").get("name")),application.set("page","main"),$("#main .buyBattlePassBtn").toggleClass("active",!this.model.get("battlePass").hasBattlePass())}}),RewardChain=Backbone.Model.extend({defaults:{world:null,name:"",prizes:[],level:0,battlePass:null,viewClass:RewardChainView,view:null,alternativeProgressBar:!1},initialize:function(e){this.listenToOnce(this.get("world"),"configure",this.configure),this.listenTo(this.get("world"),"enter",this.onEnter),this.listenTo(this.get("world"),"completeLevel",this.onCompleteLevel),this.set("prizes",new Backbone.Collection(e.prizes))},configure:function(){this.updateLevel(),this.get("world").battlePass&&this.set("battlePass",this.get("world").battlePass),this.get("alternativeProgressBar")&&(this.progressBar=new RewardChainProgressBarView({model:this}))},onEnter:function(){if(this.updateLevel(),!this.view){var e=this.get("viewClass");this.view=new e({model:this,el:$(".mainTemplates .rewardChain").clone().appendTo("#main")});var t=this;if(this.get("viewClass")!==RewardChainViewLite){var i=this.view.$(".invisible .rewardChainBtn").clone();$("#map").append(i),$("#map .rewardChainBtn").on("click touchend",function(){Config.bonusWorld===t.get("world")&&t.view.show()}),this.listenToOnce(this.get("world"),"change:HasBattlePass",this.view.updateRewardChain)}else t.view.show()}},updateLevel:function(){this.set("level",this.get("world").get("progress")),this.trigger("updateLevel",this.get("world").get("progress"))},onCompleteLevel:function(e,t){var i=this;return Promise.resolve().then(function(){if(i.canPrizeBeTaken(t))return application.waitPage("main").then(function(){return application.windows.runAfterCloseAll()}).then(function(){return i.view.show()}).then(function(){return i.get("world").emit("rewardChainBeforeTakePrize",i,t)}).then(function(){return i.get("world").emit("rewardChainBeforeTakePrize"+t,i,t)}).then(function(){return i.takePrize(t)}).then(function(){return i.get("world").emit("rewardChainAfterTakePrize",i,t)}).then(function(){return i.get("world").emit("rewardChainAfterTakePrize"+t,i,t)})}).then(function(){return i.updateLevel()})},canPrizeBeTaken:function(t){var i=this,e=this.get("prizes"),o=!1;return e.forEach(function(e){i.isOpenable(e,t)&&(o=!0)}),o},takePrize:function(t,e){var i=this;return new Promise(function(e){new AnimatedPrizesWindow({prizes:i.givePrize(t),worldName:i.get("world").get("name"),onClose:e})})},isOpened:function(e){return e.get("level")<this.get("world").get("progress")&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.get("type"))},isOpenable:function(e,t){return e.get("level")===t&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.get("type"))},givePrize:function(t){var i=this,e=this.get("prizes").filter(function(e){return i.isOpenable(e,t)}).map(function(e){return e.get("prize")}).reduce(function(e,t){return e.concat(t)}),o=new UserPrizes;return _.map(_.groupBy(e,function(e){return e.type+e.name+e.componentId}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})}).map(function(e){o.add(e)}),o},getPrizes:function(){return this.get("prizes")},getNextPrizeLevel:function(){var t=this.get("world").get("progress")-1,e=this.getPrizes();return Math.min(this.get("world").get("levelsInEpisode"),Math.min.apply(Math,e.filter(function(e){return e.get("level")>t}).map(function(e){return e.get("level")})))},getPrizesGroupedByLevel:function(){return this.get("prizes").groupBy(function(e){return e.get("level")})},countNormalizedLevel:function(){return Math.max(0,Math.max.apply(Math,this.get("prizes").filter(function(e){return e.get("level")<this.get("level")},this).map(function(e){return e.get("level")})))}}),AlternativeRewardChain=Backbone.Model.extend({defaults:{world:null,prizes:[],level:0,battlePass:null,viewClass:RewardChainView,view:null,alternativeProgressBar:!1},initialize:function(t){this.listenToOnce(this.get("world"),"configure",this.configure),this.listenTo(this.get("world"),"enter",this.onEnter),this.listenTo(this.get("world"),"completeLevel",this.onCompleteLevel),t.prizes.some(function(e){return e.products})&&(t.prizes=t.prizes.map(function(e){return{type:e.type,level:e.level,prize:UserPrizes.convertFromCocos(e).map(function(e){return e.world||(e.world=t.world.get("name")),e})}})),this.set("prizes",new Backbone.Collection(t.prizes))},configure:function(){this.updateLevel(),this.get("world").get("battlePass")&&this.set("battlePass",this.get("world").get("battlePass"))},onEnter:function(){if(!this.view){var e=this.get("viewClass");this.view=new e({el:".regatta",model:this});var t=this;e!==RewardChainViewLite&&$("#map .rewardChainBtn").on("click touchend",function(){t.view.show()})}this.trigger("enter",this)},updateLevel:function(){this.set("level",this.get("world").getCurrentLevel()),this.trigger("updateLevel",this.get("world").getCurrentLevel())},onCompleteLevel:function(e,t){var i=this;return Promise.resolve().then(function(){if(i.canPrizeBeTaken(t))return application.waitPage("main").then(function(){return application.windows.runAfterCloseAll()}).then(function(){return i.get("world").emit("rewardChainBeforeTakePrize",i,t)}).then(function(){return new Promise(function(e){i.view.takePrize(t,e)})}).then(function(){return i.get("world").emit("rewardChainAfterTakePrize",i,t)})}).then(function(){return i.updateLevel()})},canPrizeBeTaken:function(t){var i=this,e=this.get("prizes"),o=!1;return e.forEach(function(e){i.isOpenable(e,t)&&(o=!0)}),o},isOpened:function(e){return e.get("level")<this.get("world").getCurrentLevel()&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.get("type"))},isOpenable:function(e,t){return e.get("level")===t&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.get("type"))},givePrize:function(t){var i=new UserPrizes,o=this,e=this.get("prizes").filter(function(e){return o.isOpenable(e,t)}).map(function(e){return e.get("prize")}).reduce(function(e,t){return e.concat(t)});return _.map(_.groupBy(e,function(e){return e.name}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})}).map(function(e){i.add(e)}),i},getPrizes:function(){return this.get("prizes")}}),RewardChainContentView=TWindow.extend({templateClass:".bonusWorldRewardChainContentWindow_template",events:{"click .close":"close"},onOpen:function(){var e=this.options.prize,t=this.$el.find(".mWindowTitle"),i=e.type||e.get("type"),o=e.progress||e.get("level"),a=e.prize||e.get("prize");"battlePass"===i?t.html(messages[this.options.world.name+"SpecialChest"]):"finalPrize"===i?t.html(messages[this.options.world.name+"FinalChest"]):this.options.title?t.html(this.options.title):t.html(messages[this.options.world.name+"SimpleChest"]),this.options.points&&(this.$(".mCurrentPoints").html(this.options.points.currentPoints),this.$(".mTotalPoints").html(this.options.points.totalPoints)),this.$el.addClass("level"+o),this.$el.addClass(i),new UserPrizesView({model:new UserPrizes(a),el:this.$(".prizes.mPrizes")})}}),PrizeControllerView=Backbone.View.extend({events:{"click .backBtn":"back","click .buyBattlePassBtn":"openBattlePass",mousedown:"closeClarification","mouseup .rewardObject.battlePass":"showClarification"},onOpenSound:"showwindow",initialize:function(){this.render(),this.listenToOnce(this.model.get("world"),"change:hasBattlePass",this.update),this.update()},render:function(){var e=this,t=_.values(this.model.getPrizesGrouped("progress")),n=this.$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),i=$(".mainTemplates .rewardComponentPage"),o=$(".invisible.mainTemplates .progressBarByLevel"),a=this.$el.find(".freePlate"),s=this.$el.find(".battlepassPlate");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page),this.clarification=null,this.needClarify=!0;var l=i.clone(),d=o.clone();l.addClass(this.model.get("world").get("name")),l.append(d),a.html(messages.forFree),s.html(messages[this.model.get("world").get("name")+"BattlePassTitle"]);var c=$("<div></div>").text(messages[this.model.get("world").get("name")+"RewardChainButton"]).addClass("battlepassActivate").on("click touchend",function(){return $(".buyBattlePassBtn.springworld.active").click()});s.append(c),t.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("progress"+e.progress).addClass(e.type).data("id",e.cid),a){var i=n.clone();i.addClass("progress"+e.progress).addClass("placeholder"),l.append(i)}if("battlePass"===e.type||"finalPrize"===e.type){var o=r.clone();o.addClass("marker"+e.progress),o.html(this.model.accountant.getPointsByProgress(e.progress)),d.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.prize),isGroup:!0}),l.append(t)},this)},this),this.$wrapper.append(l),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:l,mainEl:this.$("#user"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.needClarify=!1,e.closeClarification()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("world").battlePass&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.createButton()},update:function(){this.model.get("prizes").forEach(function(e){var t=this.$(".rewardObject.progress"+e.progress+"."+e.type),i=this.$(".marker"+e.progress),o=this.$(".progress"+e.progress+".placeholder");t.removeClass("current"),i.removeClass("current"),0<o.length&&o.removeClass("current"),this.model.isOpened(e)&&t.addClass("opened"),e.progress===this.model.getProgress()+1&&(i.addClass("current"),t.addClass("current"),0<o.length&&o.addClass("current"))},this),this.$bpButton&&this.$bpButton.toggleClass("active",!this.model.get("world").battlePass.hasBattlePass()),this.updateProgressBar()},activatePrize:function(){return Promise.resolve()},createButton:function(){var e=this,t=this.$(".invisible .rewardChainBtn").clone();t.addClass(this.model.get("world").get("name")),$("#map").append(t),t.on("click touchend",function(){e.show()})},updateProgressBar:function(){var e=this.$el.find(".progressBarByLevel .progressBarLineByLevel"),t=this.model.getProgress(),i=this.model.getCurrProgressPoints()||0,o=this.model.getNextProgressPoints()||0;if(t!==this.model.getMaxProgress()){var a,n=t+1,r=(this.model.getPoints()-i)/(o-i),s=0===t?0:this.$(".marker"+t).position().left;if(0<t)a=s+(this.$(".marker"+n).position().left-s)*r+40;else a=this.model.getPoints()/this.model.accountant.getPointsByProgress(n)*40;e.css("width",a+"px")}else e.css("width","100%")},show:function(){$(".episode_springworld").addClass("rewardChainShown"),this.model.emit("showRewardChain",this),application.set("page","rewardChain"),this.$el.addClass("active"),this.$bpButton.toggleClass("active",!this.model.get("world").battlePass.hasBattlePass()),$("#main .buyBattlePassBtn").toggleClass("active",!1),$("#main").show();var e=$(".rewardComponentMarker.current").length?$(".rewardComponentMarker.current"):$(".rewardComponentMarker.marker"+this.model.getMaxProgress());return this.mapController.scrollTo(e),this.update(),this.onOpenSound&&application.playSound(this.onOpenSound),Promise.resolve()},openBattlePass:function(){new BuyBattlePassWindow({model:this.model.get("world").battlePass})},back:function(){this.$el.removeClass("active"),application.set("page","main"),$(".episode_springworld").removeClass("rewardChainShown"),$("#main .buyBattlePassBtn").toggleClass("active",!this.model.get("world").battlePass.hasBattlePass())},showClarification:function(e){var t=this;if(this.needClarify){this.clarification&&this.closeClarification();var i=this.model.get("world").get("name"),o=$(e.currentTarget),a=$(".invisible .clarificationBubble").clone().addClass(i);o.addClass("clarificationOpen"),a.appendTo(this.$el),a.alignTo(o),a.find(".clarification").html(messages[i+"RewardChainHint"]),this.clarification={$target:o,$clarify:a},this._clarificationTimeOut=setTimeout(function(){return t.closeClarification()},3e3)}else this.needClarify=!0},closeClarification:function(){this.clarification&&(this.clarification.$target.removeClass("clarificationOpen"),this.clarification.$clarify.remove(),this.clarification=null,this._clarificationTimeOut&&clearTimeout(this._clarificationTimeOut))}}),PrizeControllerViewLite=Backbone.View.extend({el:".prizeControllerContainer",events:{"click .prizeBox":"showContent"},initialize:function(){this.renderPrizeObjects(),this.listenTo(this.model.get("world"),"enter",this.update),this.listenTo(this.model.get("world"),"prizeControllerAfterTakePrize",this.update),this.listenTo(this.model,"change:points",this.update),this.listenTo(this.model,"change:progress",this.update),this.listenTo(this.model.get("world"),"resetPrizes",this.onReset),this.update()},update:function(){var o=this;this.model.getPrizesArray().forEach(function(e){var t=o.$el.find(".progress"+e.progress),i=t.find(".mPoints");t.toggleClass("active",e.progress===o.model.getNextProgress()),t.toggleClass("completed",e.progress<o.model.getNextProgress()),t.data("item",e.progress),i.find(".mCurrentPoints").html(o.model.getPointsInGap(e.progress)),i.find(".mTotalPoints").html(o.model.getPointsMaximumInGap(e.progress))})},onReset:function(){var i=this;this.model.getPrizesArray().forEach(function(e){var t=i.$el.find(".progress"+e.progress);t.toggleClass("active",!1),t.toggleClass("completed",!1)})},renderPrizeObjects:function(){var i=this,o=$("#prizeControllerTemplates .prizeBox");this.model.getPrizesArray().forEach(function(e){var t=o.clone();t.addClass("progress"+e.progress),new UserPrizesView({el:t.find("mPrizes"),model:new UserPrizes(e.prize)}),t.appendTo(i.$el)})},showContent:function(e){var t=$(e.currentTarget).data("item");Config.bonusWorld===this.model.get("world")&&(new RewardChainContentView({world:this.model.get("world"),prize:this.model.getPrizeByProgress(t),title:messages[this.model.get("world").get("name")+"PrizeContentWindow"].title,points:{currentPoints:this.model.getPointsInGap(t),totalPoints:this.model.getPointsMaximumInGap(t)}}),this.model.get("world").getComponent(TriesComponent)&&new TicketInfo({world:this.model.get("world")}))},show:function(){return Promise.resolve()}}),PrizeController=Backbone.Model.extend({accountant:null,pointProducers:[],defaults:{id:"prizes",world:"",points:new ObscureNumber(0),viewClass:PrizeControllerView,view:null,oldProgress:new ObscureNumber(0),progress:new ObscureNumber(0),teasePrizes:!1,isOpenPrizePage:!0,isShowTakePrizeWindow:!1,numCollectedPrizes:new ObscureNumber(0),prizes:null,pointEvents:[]},constructor:function(t){this.accountant=t.accountant,this.pointProducers=t.pointProducers,t.prizes.some(function(e){return e.products})&&(t.prizes=t.prizes.map(function(e){return{type:e.type,progress:e.progress,prize:UserPrizes.convertFromCocos(e).map(function(e){return e.world||(e.world=t.world.get("name")),e})}})),this.listenToOnce(t.world,"configure",this.configure),Backbone.Model.call(this,t)},configure:function(){var o=this;if(!this.view&&this.get("viewClass")){var e=this.get("viewClass");this.view=new e({model:this,el:e!=PrizeControllerViewLite?$(".mainTemplates .rewardChain").clone().addClass(this.get("world").get("name")).appendTo("#main"):$(".prizeControllerContainer")}),this.listenToOnce(this.get("world"),"change:HasBattlePass",this.view.updateRewardChain)}this._load().then(function(){if(o.accountant.pointsCheck){var e=o.accountant.pointsCheck(o.pointProducers);if(e>o.getPoints()){var t=o.getProgress(),i=o.accountant.countProgress(e,t);o.set({points:new ObscureNumber(e),progress:new ObscureNumber(i)}),o.recoverPrizes(t,i),o._save()}}o.listenTo(o,"change:points",o.countProgress),o.listenTo(o,"change:progress, change:points",_.debounce(o._save.bind(o),100))})},countProgress:function(){var e=this.getProgress(),t=this.accountant.countProgress(this.getPoints());if(e<t){this.set("oldProgress",new ObscureNumber(e)),this.set("progress",new ObscureNumber(t));var i=this.getPrize();return 0<i.length?(Game&&Game.cancelNext(),this.givePrize(i)):Promise.resolve()}},getPrize:function(){var t=this,i=new UserPrizes,e=this.get("prizes").filter(function(e){return t.isOpenable(e,t.getProgress())}),o=e.map(function(e){return e.prize}).reduce(function(e,t){return e.concat(t)},[]);(i.progress=Math.max.apply(Math,_toConsumableArray(e.map(function(e){return e.progress}))),this._bundlePrizes(o).forEach(function(e){return i.add(e)}),this.get("teasePrizes")&&!this.get("world").get("hasBattlePass"))&&this.getBattlePassPrizes().filter(function(e){return e.progress<=t.getProgress()}).forEach(function(e){e.prize.forEach(function(e){e.tease=!0,i.add(e)})});return i},getFinalPrize:function(){var e=this.getPrizeByProgress(this.getMaxProgress());return Prize.create({products:e.prize})},getPrizeByProgress:function(t){return this.get("prizes").find(function(e){return e.progress===t})},getNextPrizes:function(){var t=this;return this.get("prizes").filter(function(e){return e.progress===t.getNextProgress()})},getPrizesArray:function(){return this.get("prizes")},getPrizesGrouped:function(t){return _.groupBy(this.getPrizesArray(),function(e){return e[t]})},getPoints:function(){return this.get("points").get()},setPoints:function(e){var o=this,a=this.get("points"),n=e;this.set("points",new ObscureNumber(n)),this.get("pointEvents").forEach(function(e){var t=a/o.getMaxPointsPossible()*100,i=n/o.getMaxPointsPossible()*100;t<e&&e<=i&&o.get("world").emit("pointsProgress"+e,o)})},addPoints:function(e){this.setPoints(this.getPoints()+e)},getProgress:function(){return this.get("progress").get()},getOldProgress:function(){return this.get("oldProgress").get()},getNumCollectedPrizes:function(){return this.get("numCollectedPrizes").get()},getNextProgressPoints:function(){return this.accountant.getPointsByProgress(this.getProgress()+1)||0},getNextProgress:function(){return this.get("progress").get()+1},getPointsByProgress:function(e){return this.accountant.getPointsByProgress(e)||0},getPointsInGap:function(e){return Math.max(0,this.getPoints()-this.getPointsByProgress(e-1))},getPointsMaximumInGap:function(e){return this.getPointsByProgress(e)-this.getPointsByProgress(e-1)},getMaxProgress:function(){return this.accountant.getMaxProgress()},getCurrProgressPoints:function(){return this.accountant.getPointsByProgress(this.getProgress())||0},getMaxPointsPossible:function(){return this.accountant.getMaxPointsPossible()},getBattlePassPrizes:function(){return this.getPrizesArray().filter(function(e){return"battlePass"===e.type})},setAccountant:function(e){this.accountant=e},isOpened:function(e){return e.progress<=this.getProgress()&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.type)},isOpenable:function(e){return e.progress>this.getOldProgress()&&e.progress<=this.getProgress()&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.type)},isOpenableInRange:function(e,t,i){return e.progress>=t&&e.progress<=i&&(this.get("world").get("hasBattlePass")||"battlePass"!==e.type)},isFinal:function(){return this.getProgress()===this.getMaxProgress()},givePrize:function(t){var i=this;return Promise.resolve().then(function(){return t.take()}).then(function(){return application.waitPage("main")}).then(function(){return i.get("world").emit("prizeControllerBeforeTakePrize",i,i.getProgress())}).then(function(){return i.get("world").emit("prizeControllerBeforeTakePrize"+i.getProgress(),i,i.getProgress())}).then(function(){return i.get("isOpenPrizePage")&&i.view?application.windows.runAfterCloseAll().then(function(){return i.openPrizeRoom()}):application.waitPage("main")}).then(function(){return i.get("saveCollectedPrizes")?(i.set("numCollectedPrizes",new ObscureNumber(i.getNumCollectedPrizes()+1)),i.get("world").emit("numCollectedPrizes"+i.getNumCollectedPrizes(),i,i.getNumCollectedPrizes())):Promise.resolve()}).then(function(){return i.showTakePrizeWindow(t)}).then(function(){return Promise.resolve().then(function(){return new Promise(function(e){new AnimatedPrizesWindow({prizes:t,worldName:i.get("world").get("name"),onClose:e,notGive:!0})})})}).then(function(){return i.get("world").emit("prizeControllerAfterTakePrize",i,i.getProgress())}).then(function(){return i.get("world").emit("prizeControllerAfterTakePrize"+i.getProgress(),i,i.getProgress())}).then(function(){if(i.isFinished())return i.get("world").emit("allPrizesCollected",i)})},_load:function(){var o=this,e=this.get("world").get("name");return new Promise(function(t,i){callService("../../../gems/site/service/prizes/loadprizesdata.php",function(e){e&&o.set({points:new ObscureNumber(e.points),oldProgress:new ObscureNumber(e.progress),progress:new ObscureNumber(e.progress),numCollectedPrizes:new ObscureNumber(e.numCollectedPrizes)}),o.trigger("loaded"),t()},function(e){console.error(e),i()},{prefix:e})})},recoverPrizes:function(t,i){var o=this,a=new UserPrizes,e=this.get("prizes").filter(function(e){return o.isOpenableInRange(e,t,i)}).map(function(e){return e.prize}).reduce(function(e,t){return e.concat(t)});this._bundlePrizes(e).map(function(e){a.add(e)}),this.givePrize(a)},_bundlePrizes:function(e){return _.map(_.groupBy(e,function(e){return e.type+e.name||e.componentId}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})})},_save:function(){var e=this.get("world").get("name"),t={points:this.getPoints(),progress:this.getProgress()};this.get("saveCollectedPrizes")&&(t.numCollectedPrizes=this.getNumCollectedPrizes()),callServiceAddInQueue("../../../gems/site/service/prizes/saveprizesdata.php",{prefix:e,data:JSON.stringify(t)})},reset:function(){var o=this;return this.get("world").trigger("resetPrizes"),new Promise(function(t,i){callService("../../../gems/site/service/prizes/resetprizesdata.php",function(e){o.set({points:new ObscureNumber(0),progress:new ObscureNumber(0)}),console.log("Successfuly reset the prizes"),t()},function(e){console.error(e),i()},{prefix:o.get("world").get("name")})})},showTakePrizeWindow:function(t){var i=this;return this.get("isShowTakePrizeWindow")?new Promise(function(e){new TakePrizeWindow({publicationId:"PrizeGivenPublication",worldName:i.get("world").get("name"),variant:t.progress,prize:t,onClose:e})}):Promise.resolve()},isFinished:function(){return this.getProgress()===this.getMaxProgress()},openPrizeRoom:function(){return this.view instanceof PrizeControllerViewLite?Promise.resolve():this.view.show()}}),PrizeEventController=BonusWorldComponent.extend({defaults:{context:null,event:"completelevel"},init:function(){var e=this.get("context")||this.world;this.listenTo(e,this.get("event"),this.onEvent)},onEvent:function(){var t=this;new UserPrizes(UserPrizes.convertFromCocos(this.get("prize")).map(function(e){return e.world||(e.world=t.world.get("name")),e})).take()}}),BonusWorldLivesController=Backbone.Model.extend({defaults:{world:null,livesModel:null,livesTimer:0,notify:!1},constructor:function(e,t){this.world=t,this.listenToOnce(this.world,"configure",this.configure),Backbone.Model.call(this,e)},configure:function(){var e=this.get("livesModel");e&&(this.listenTo(e,"change:livesLastRestored",this.runTimer),this.listenTo(this.world,"exit",this.onExitWorld),this.listenTo(application,"change:page",this.onChangePage),"main"===application.get("page")&&this.runTimer())},runTimer:function(){this.updateRestoreInterval||(this.updateRestoreInterval=setInterval(_.bind(this.updateTimer,this),1e3)),this.updateTimer(),this.onStartRestore()},stopTimer:function(){clearInterval(this.updateRestoreInterval),this.updateRestoreInterval=!1,this.onFinishRestore()},updateTimer:function(){var e=this.get("livesModel");if(e.handleTimeInterval(),e){var t=this.getLivesTimer();this.set("livesTimer",t),t<=0&&this.stopTimer()}},onChangePage:function(){var e=application.get("page");"main"===e||"game"===e||"artifacts"===e?this.runTimer():this.stopTimer()},onStartRestore:function(){this.isFullLives()||setLocalStorage(this.getNotifyHidedKey(),!1),this.checkNotify()},onFinishRestore:function(){this.checkNotify()},onExitWorld:function(){this.isFullLives()&&setLocalStorage(this.getNotifyHidedKey(),!0),this.checkNotify()},getLivesTimer:function(){var t=this,e=this.get("livesModel").get("timeToNextLife");if(this.world.checkUnlimitedLives()){var i=goods.find(function(e){return e.get("name")===t.world.get("unlimitedName")});i&&(e=i.get("timeToFinish"))}return Math.max(0,e)},getLives:function(){return this.get("livesModel").get("lives")},getNotifyHidedKey:function(){return this.world.get("name")+"FullLivesNotifyHided"},isFullLives:function(){var e=this.get("livesModel");return e.get("lives")==e.get("maxLives")},checkNotify:function(){this.getLivesTimer()||getLocalStorage(this.getNotifyHidedKey(),!1)?this.set("notify",!1):this.set("notify",!0)}}),RewardChainProgressBarView=Backbone.View.extend({el:".rewardChainProgressBar",initialize:function(){this.listenTo(this.model,"change:level",this.update),this.render()},render:function(){var e=$("#rewardChain .invisible .rewardChainProgressBar").clone();$("#map").append(e),this.update()},update:function(){var t=this.model.get("level")-1,e=this.model.get("prizes"),i=Math.max(0,Math.max.apply(Math,e.filter(function(e){return e.get("level")<=t}).map(function(e){return e.get("level")}))),o=Math.min(this.model.get("world").get("levelsInEpisode"),Math.min.apply(Math,e.filter(function(e){return e.get("level")>t}).map(function(e){return e.get("level")}))),a=100*(t-i)/(o-i).toFixed(2);$(".rewardChainProgressBar .progressBarLine").css("width",Math.min(100,a)+"%"),this.model.get("level")>=this.model.get("world").get("levelsInEpisode")&&$(".rewardChainProgressBar").hide()}}),ProgressBarByLevelView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:level",this.update),this.render()},render:function(){var e=$(".invisible.mainTemplates .progressBarByLevel").clone();this.$el.append(e),this.update()},update:function(){var e=this.model.get("levelsInEpisode")/100*this.model.get("progress");this.$el.find(".progressBarLineByLevel").css("width",Math.min(100,e)+"%")}}),RewardComponentView=Backbone.View.extend({initialize:function(){this.render(),this.listenTo(this.model,"enter",this.update),this.listenTo(this.model,"rewardChainBeforeTakePrize",this.activatePrize),this.listenTo(this.model,"completeLevel",this.update),this.listenToOnce(this.model,"change:hasBattlePass",this.update),this.update()},render:function(){var e=_.values(this.getRewardComponent().getPrizesGroupedByLevel()),n=$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),t=$(".mainTemplates .rewardComponentPage"),i=$(".invisible.mainTemplates .progressBarByLevel");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page);var s=t.clone(),l=i.clone();s.append(l),e.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("level"+e.get("level")).addClass(e.get("type")).data("id",e.cid),a){var i=n.clone();i.addClass("level"+e.get("level")).addClass("placeholder"),s.append(i)}if("battlePass"===e.get("type")||"finalPrize"===e.get("type")){var o=r.clone();o.addClass("marker"+e.get("level")),o.html(e.get("level")),l.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.get("prize"))}),s.append(t)},this)},this),this.$wrapper.append(s),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:s,mainEl:this.$("#user"),keyIntervalTime:15}),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")})},activatePrize:function(e,o){return new Promise(_.bind(function(e){var t;if(this.model.get("hasBattlePass"))t=this.$el.find(".rewardObject.level"+o);else{var i=o<this.model.get("levelsInEpisode")?".middlePrize":".finalPrize";t=this.$el.find(".rewardObject.level"+o+i)}t.addClass("active"),t.one("click",function(){t.removeClass("active").addClass("opened"),e()})},this))},update:function(){this.getRewardComponent().get("prizes").forEach(function(e){var t=this.$(".rewardObject.level"+e.get("level")+"."+e.get("type")),i=this.$(".marker"+e.get("level")),o=this.$(".level"+e.get("level")+".placeholder");t.removeClass("current"),i.removeClass("current"),0<o.length&&o.removeClass("current"),this.getRewardComponent().isOpened(e)&&t.addClass("opened"),e.get("level")===this.getRewardComponent().getNextPrizeLevel()&&(i.addClass("current"),t.addClass("current"),0<o.length&&o.addClass("current"))},this),this.updateProgressBar()},updateProgressBar:function(){var e=this.$el.find(".progressBarByLevel"),t=e.find(".progressBarLineByLevel"),i=e.find(".progressBarLineByLevelLeft"),o=e.find(".progressBarLineByLevelRight"),a=this.page-1,n=this.model.get("progress"),r=Object.keys(this.getRewardComponent().getPrizesGroupedByLevel()).map(function(e){return+e}),s=Math.max.apply(Math,r),l=Math.max(0,Math.min.apply(Math,r.slice(4*a,4*a+4)));if(i.removeClass("active"),o.removeClass("active"),s<=n)return t.css("width","100%"),i.addClass("active"),void o.addClass("active");if(n<=l-5)t.css("width","0%");else{var d=Math.max(0,((n-l)/(s-l)*100).toFixed(2));t.css("width",d+"%"),i.addClass("active"),this.model.get("progress")>s&&o.addClass("active")}},updateControls:function(){},getRewardComponent:function(){return this.model.getComponent(RewardComponent)}}),RewardPrizes={common:1,extra:2,final:4},PrizeTypeToFlag={middlePrize:RewardPrizes.common,starPrize:RewardPrizes.common,battlePass:RewardPrizes.extra,finalPrize:RewardPrizes.final},RewardComponent=BonusWorldComponent.extend({defaults:{prizes:[],level:0,battlePass:null,viewClass:RewardChainView},initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.listenToOnce(this.world,"configure",this.configure),this.listenTo(this.world,"completeLevel",this.onCompleteLevel),e.prizes.forEach(_.bind(function(e){e.prize.forEach(function(e){e.world=this.world.get("name")},this)},this)),this.set("prizes",new Backbone.Collection(e.prizes))},configure:function(){var t=this;this._load().then(function(){var e=t.getPrizes().filter(function(e){return!e.get("taken")}).map(function(e){return e.get("level")});_.uniq(e).forEach(function(e){e<t.world.get("progress")&&t.activatePrize(e)},t)}),this.world.battlePass&&this.set("battlePass",this.world.battlePass)},_load:function(){var e=this.world.get("name"),o=this.getPrizes();return new Promise(function(t,i){callService("../../../gems/site/service/rewardcomponent/getrewards.php",function(e){e&&e.forEach(function(t){o.where({level:parseInt(t.level)}).forEach(function(e){e.get("taken")||e.set("taken",!!(parseInt(t.status)&PrizeTypeToFlag[e.get("type")]))})}),t()},function(e){console.error(e),i()},{prefix:e})})},_save:function(){var e=this.getPrizes(),t=this.world.get("name"),i=_.map(e.groupBy(function(e){return e.get("level")}),function(e,t){return{level:t,status:e.reduce(function(e,t){return e|(t.get("taken")&&PrizeTypeToFlag[t.get("type")]||0)},0)}}).filter(function(e){return e.status});callServiceAddInQueue("../../../gems/site/service/rewardcomponent/setrewards.php",{prefix:t,data:JSON.stringify(i)})},onCompleteLevel:function(e,t){var i=this;return Promise.resolve().then(function(){if(i.canPrizeBeTaken(t))return application.waitPage("main").then(function(){return application.windows.runAfterCloseAll()}).then(function(){return i.activatePrize(t)})})},canPrizeBeTaken:function(t){var i=this,e=this.getPrizes(),o=!1;return e.forEach(function(e){i.isOpenable(e,t)&&(o=!0)}),o},activatePrize:function(e){var t=this;return this.world.emit("rewardChainBeforeTakePrize",this,e).then(function(){return t.world.emit("rewardChainBeforeTakePrize"+e,t,e)}).then(function(){return t.takePrize(e)}).then(function(){return t.world.emit("rewardChainAfterTakePrize",t,e)}).then(function(){return t.world.emit("rewardChainAfterTakePrize"+e,t,e)}).then(function(){t._save()})},takePrize:function(e){var t=this,i=this.givePrize(e);return i.length<=0?Promise.resolve():new Promise(function(e){new AnimatedPrizesWindow({prizes:t.groupPrizes(i),worldName:t.world.get("name"),onClose:e})}).then(function(){i.forEach(function(e){e.set("taken",!0)})})},isOpened:function(e){return e.get("taken")&&(this.world.get("hasBattlePass")||"battlePass"!==e.get("type"))},isOpenable:function(e,t){return e.get("level")===t&&!e.get("taken")&&(this.world.get("hasBattlePass")||"battlePass"!==e.get("type"))},givePrize:function(t){return this.getPrizes().filter(_.bind(function(e){return this.isOpenable(e,t)},this))},giveMissedPrizes:function(t,i){var o=this,a=this.getPrizes().filter(function(e){return e.get("level")<=i&&e.get("type")===t});return a.length<=0?Promise.resolve():new Promise(function(e){new AnimatedPrizesWindow({prizes:o.groupPrizes(a),worldName:o.world.get("name"),onClose:e})}).then(function(){a.forEach(function(e){e.set("taken",!0)}),o._save()})},activateMissedPrizes:function(){var e=this.getPrizes().filter(function(e){return!e.get("taken")}).map(function(e){return e.get("level")});_.uniq(e).forEach(function(e){e<this.world.get("progress")&&this.activatePrize(e)},this)},getNextPrizeLevel:function(){var t=this.world.get("progress")-1,e=this.getPrizes();return Math.min(this.world.get("levelsInEpisode"),Math.min.apply(Math,e.filter(function(e){return e.get("level")>t}).map(function(e){return e.get("level")})))},groupPrizes:function(e){var t=this,i=new UserPrizes,o=e.map(function(e){return e.get("prize")}).reduce(function(e,t){return e.concat(t)},[]);return _.map(_.groupBy(o,function(e){return e.name}),function(e){return _.assign({},e[0],{amount:e.map(function(e){return e.amount}).reduce(function(e,t){return e+t})})}).map(function(e){e.world=t.world.get("name"),i.add(e)}),i},getPrizesGroupedByLevel:function(){return this.get("prizes").groupBy(function(e){return e.get("level")})},getPrizes:function(){return this.get("prizes")}}),GachaComponentWindow=TWindow.extend({templateClass:".gachaWindow_template",initialGachaSize:{w:$(".gachaRound").width(),h:$(".gachaRound").height()},events:{"click .close":"close","click .start":"start"},initialize:function(e){TWindow.prototype.initialize.call(this,e),this.model=e.model,this.listenTo(this.model,"change:spins",this.onChangeSpins)},getSectors:function(){return this.model.getSectors()},close:function(){TWindow.prototype.close.call(this),this.$(".gachaRound").clearQueue().stop(),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),$(".gachaBlock").fadeIn(300)},onOpen:function(){this.currentSector=0,this.currentDeg=0,this.shadow=!1,this.$el.addClass(this.model.world.get("name")),this.$el.addClass("spins"+this.model.getVariant()),this.$(".gachaRound").setAngle("0deg"),this.$(".gachaSectors").empty(),this.$(".gachaBlackout").hide(),this.$(".gachaCharacter").removeClass("gachaCharacterSad gachaCharacterHappy gachaCharacterAnimation"),this.$(".infoBlock").find(".text").html(messages.gachaText),this.renderButton(),this.renderSectors();var e=$(".invisible .gachaTokens").clone();e.addClass(this.model.tokenAdapter.name),e.find(".mGachaTokens").html(this.model.tokenAdapter.get()),this.$el.append(e),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),TWindow.prototype.onOpen.call(this)},onChangeSpins:function(e){this.$el.removeClass("spins"+e.previous("spins")),this.$el.addClass("spins"+e.getVariant())},renderSectors:function(){for(var e=this.$(".gachaSectors").empty(),t=$(".invisible .gachaSector"),i=this.getSectors(),o=0;o<i.length;o++){var a=t.clone();a.addClass("gachaSector"+(o+1)),a.find(".gachaItem").addClass(i[o].cssClass),e.append(a)}},renderButton:function(){this.$(".gachaPrice").addClass("btnPrice_"+this.model.tokenAdapter.name),this.$(".gachaPrice").html(this.model.calcPrice()),this.model.canSpin()||this.$(".start").addClass("disabled"),this.$el.toggleClass("notAvailable",this.model.get("active"))},calcWinSector:function(){return Math.floor(Math.random()*this.getSectors().length)},getPrize:function(){var t=this.getSectors()[this.currentSector];switch(t.type){case"coins":user.set({coins:new ObscureNumber(user.get("coins")+t.amount),actionName:"wingacha"+this.currentSector,actionEpisode:user.get("episode"),actionLevel:user.get("level")});break;case"powerUps":_.each(t.powerUps,_.bind(function(e){user.setPowerUpAmount(e,user.getPowerUpAmount(e)+t.amount,!0)},this)),user.set({powerUps:user.calcPowerUps(),actionName:"wingacha"+this.currentSector,actionEpisode:user.get("episode"),actionLevel:user.get("level")}),application.playSound("gachaWindowPowerUpsPrize");break;case"good":goods.goodBuyed(t.name,t.amount),application.playSound("gachaWindowGoodPrize")}this.renderButton()},start:function(e){if(this.processed)return!1;this.model.canSpin()&&this.process()},updateTokensCounter:function(){this.$(".mGachaTokens").html(this.model.tokenAdapter.get())},process:function(){user.trigger("gachaProcess"),this.again=!0,this.processed=!0,this.$el.addClass("process"),this.$(".start").addClass("disabled"),this.$(".gachaCharacter").removeClass("gachaCharacterSad gachaCharacterHappy").addClass("gachaCharacterAnimation"),this.$(".gachaCenter").removeClass("gachaCenterHappy").addClass("gachaCenterAnimation"),application.playSound("gachaWindowThumbler");var e=_.bind(function(){for(var e=this.calcWinSector(),t=1448,o=this.currentDeg,a=this.getSectors();this.currentSector!=e;)this.currentSector=(this.currentSector+a.length-1)%a.length,t+=360/a.length;var n=this.$(".gachaRound"),r=2*t/(.36-.16),s=.2*r/Math.sqrt(.6),l=0;n.animate({path:new function(){this.css=function(e){var t=0;(e=1-e)<.2?t+=r*e*e/2:(t+=.2*r*.2/2,(e-=.2)<.2?t+=.2*r*e:(t+=.2*r*.2,t+=.2*r*(e-=.2)-2*s*e*Math.sqrt(e)/3));var i=Math.round(t*a.length/360);return i!=l&&(l=i,application.playSound("gachaWindowWhip")),n.setAngle(o+t+"deg"),{}}}},8e3,"linear");var i=_.bind(function(){this.currentDeg+=t-8,this.$(".gachaCharacter").removeClass("gachaCharacterAnimation"),this.$(".gachaCenter").removeClass("gachaCenterAnimation"),this.$(".gachaBlackout").fadeIn(300,_.bind(function(){this.shadow=!0,"fail"!==a[this.currentSector].type?(this.$(".gachaSector"+(this.currentSector+1)).find(".gachaItem").delay(300).ourAnimate({scale:1.5},300,"linear").ourAnimate({scale:1},300,"linear"),this.$(".infoBlock").find(".text").html(this.getPrizeText(this.currentSector)),application.playSound("gachaWindowWin"),this.$(".gachaCharacter").addClass("gachaCharacterHappy"),this.$(".gachaCenter").addClass("gachaCenterHappy")):(this.$(".infoBlock").find(".text").html(messages.gachaFail),application.playSound("gachaWindowLose"),this.$(".gachaCharacter").addClass("gachaCharacterSad")),setTimeout(_.bind(function(){this.getPrize(),this.model.buySpin(),this.updateTokensCounter(),this.renderButton(),this.$el.removeClass("process"),this.shadow&&(this.shadow=!1,this.$(".gachaBlackout").fadeOut(300)),this.$(".start").removeClass("disabled"),this.processed=!1},this),1300)},this))},this);n.ourAnimate({rotate:"-=8deg"},1e3,"easeInOutQuad",i)},this);this.shadow?this.$(".gachaBlackout").fadeOut(300,e):setTimeout(e,300)},getPrizeText:function(e){return messages.gachaComponentPrizes}}),GachaComponentView=Backbone.View.extend({events:{"click .gachaButton":"open"},initialize:function(){this.listenTo(this.model,"enter",this.onEnter),this.listenTo(this.model,"exit",this.onExit),this.listenTo(this.getGachaComponent(),"change:active",this.onChangeActive),this.listenTo(this.model,"completeLevel",this.onCompleteLevel),this.$openBtn=$(".mainTemplates .gachaButton").clone(),this.$openBtn.addClass(this.model.get("name")),this.$el.append(this.$openBtn)},onChangeActive:function(){this.getGachaComponent().get("active")&&(this.$el.toggleClass("gachaIsAvailable",!0),this.$openBtn.toggleClass("active",!0))},getGachaComponent:function(){return this.model.getComponent(GachaComponent)},onEnter:function(){this.$el.toggleClass("gachaIsAvailable",this.getGachaComponent().get("active")),this.$openBtn.toggleClass("active",this.getGachaComponent().get("active")),this.$openBtn.toggleClass("canSpin",this.getGachaComponent().canSpin())},onExit:function(){this.$el.toggleClass("gachaIsAvailable",!1),this.$openBtn.toggleClass("active",!1)},onCompleteLevel:function(){this.$openBtn.toggleClass("canSpin",this.getGachaComponent().canSpin())},open:function(){new GachaComponentWindow({model:this.getGachaComponent()})}}),GachaComponent=BonusWorldComponent.extend({defaults:_.defaults({active:!1,minLevel:2},BonusWorldComponent.prototype.defaults),initialize:function(e){BonusWorldComponent.prototype.initialize.call(this,e),this.tokenAdapter=e.tokenAdapter,this.set({spins:new ObscureNumber(0)}),this.listenToOnce(this.world,"configure",this.configure),this.listenTo(this.world,"onCompleteLevel",this.onCompleteLevel)},configure:function(e,t,i){this.set({spins:new ObscureNumber(i&&i.gachaSpins||0),active:this.world.get("progress")>this.get("minLevel")})},buySpin:function(){this.chargeTokens(this.calcPrice()),this.setSpins(this.getSpins()+1)},chargeTokens:function(e){this.tokenAdapter.set(this.tokenAdapter.get()-e)},calcPrice:function(){return this.getSpins()>=this.get("spinPrice").length?this.get("spinPrice")[this.get("spinPrice").length-1]:this.get("spinPrice")[this.getSpins()]},canSpin:function(){return 0<=this.tokenAdapter.get()-this.calcPrice()},setSpins:function(e){this.set("spins",new ObscureNumber(e)),this.save()},getSpins:function(){return this.get("spins").get()},getSectors:function(){return this.getSpins()>=this.get("prizes").length?this.get("prizes")[this.get("prizes").length-1]:this.get("prizes")[this.getSpins()]},onCompleteLevel:function(e,t){t>=this.get("minLevel")&&!this.get("active")&&this.set("active",!0)},getVariant:function(){var t=this,e=this.get("variants").filter(function(e){return e.spins>=t.getSpins()});return 0<e.length?e[0].spins:this.get("variants")[this.get("variants").length-1].spins},save:function(){return service("../../../gems/site/service/gacha/savedata.php",{eventName:this.world.get("name"),spins:this.getSpins()})}}),BaseLevelsComponent=function(e){_inherits(i,BonusWorldComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"defaults",value:function(){return _.defaults({id:"levels"},BonusWorldComponent.prototype.defaults)}},{key:"startNextLevel",value:function(){throw new Error('You must implement this method "startNextLevel"')}}]),i}(),MainLevelsComponent=function(e){_inherits(i,BaseLevelsComponent);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"defaults",value:function(){return _.defaults({canRunLevel:!0},_.result(BaseLevelsComponent.prototype,"defaults"))}},{key:"init",value:function(){var e=this;return _get(_getPrototypeOf(i.prototype),"init",this).call(this).then(function(){e.listenTo(e.world,"beforeOpen",e.onBeforeOpen)})}},{key:"onBeforeOpen",value:function(){this.setLevel()}},{key:"setLevel",value:function(){var e=application.getFreeEpisode(),t=e?e.get("progress"):user.getCurrentLevel();this.set("progress",t)}},{key:"startNextLevel",value:function(){return this.world.exit(!0).then(function(){return application.startCurrentLevel({showStatistics:!0,showWithoutResult:!0})})}}]),i}(),OffersDeskComponent=BonusWorldComponent.extend({offers:null,defaults:_.defaults({forceOfferId:null,forceByStories:!1},BonusWorldComponent.prototype.defaults),constructor:function(e,t){this.offers=new Backbone.Collection(e.offers.map(function(e){return e.products=UserPrizes.convertFromCocos(e),e}),{model:Offer}),delete e.offers,BonusWorldComponent.call(this,e,t)},init:function(){var e=this;return this.world.once("enter",this.initForce,this),this.load().then(function(){return e.emit("offersInited")})},initForce:function(){if(!this._initedForce&&(this._initedForce=!0,!this.get("forceByStories")&&this.get("forceOfferId"))){var e=this.getOfferById(this.get("forceOfferId"));e&&0===e.get("countPay")&&(e.on("change",this.checkForce,this),this.checkForce())}},checkForce:function(){var t=this;if(this.get("forceOfferId")){var i=this.getOfferById(this.get("forceOfferId"));i&&0===i.get("countPay")&&i.canBuy().then(function(e){e&&(i.off("change",t.checkForce,t),t.trigger("showForce",i))})}},getOfferById:function(e){return this.offers.get(e)},getOffers:function(){return this.offers},buy:function(t){var i=this;if(t)return t.buy().then(function(e){return e?i.addOfferTransaction(t):Promise.resolve(e)}).then(function(e){if(e)return i.get("takePrizeDisabled")||new AnimatedPrizesWindow({prizes:new UserPrizes(t.get("products")),worldName:i.world.get("name"),notGive:!0}),i.world.emit("offerBought",e)})},getBoughtOffersAmount:function(){return this.offers.reduce(function(e,t){return e+t.get("countPay")},0)},getSoldOutOffersAmount:function(){return this.offers.reduce(function(e,t){return e+(t.isSoldOut()?1:0)},0)},getTotalPossiblePurchases:function(){return this.offers.reduce(function(e,t){return e+t.get("supply")},0)},addOfferTransaction:function(e){return service("../../../gems/site/service/offersdesk/savedata.php",{offerId:e.get("id"),eventName:this.world.get("name")})},load:function(){var e=this;return service("../../../gems/site/service/offersdesk/loaddata.php",{eventName:this.world.get("name")}).then(function(i){e.resetOffers(),e.offers.forEach(function(t){var e=_.find(i.offers,function(e){return e.offerId===t.get("id")});e&&t.set("countPay",parseInt(e.count))})})},reset:function(){return this.resetOffers(),BonusWorldComponent.prototype.reset.call(this)},resetOffers:function(){this.offers.forEach(function(e){return e.set("countPay",0)})}}),OfferDeskComponentView=Backbone.View.extend({initialize:function(){this.$el.addClass(this.model.get("id")),this.$(".mBuyBtn").data("offerId",this.model.get("id")),new UserPrizesView({model:new UserPrizes(this.model.get("products")),el:this.$(".mPrizes")}),this.listenTo(this.model,"change",this.onUpdate),this.onUpdate()},onUpdate:function(){var t=this,e=messages.offerSupply||"%amount%";this.$(".offerAmount").html(e.replace("%amount%",this.model.getLimit())),this.$(".price").html(this.model.get("price")),this.$el.toggleClass("isSoldOut",this.model.isSoldOut()),this.model.canBuy().then(function(e){return t.$el.toggleClass("canBuy",e)})}}),OffersDeskComponentView=Backbone.View.extend({events:{"click .mBuyBtn":"buyOffer"},initialize:function(){this.listenTo(this.model.world,"enter",this.onEnter)},onEnter:function(){this.$("bwOffersContainer").empty(),this.renderOffers()},renderOffers:function(){var t=this;this.model.offers.forEach(function(e){new OfferDeskComponentView({model:e,el:$(".mainTemplates .bonusWorldOffer").clone()}).$el.appendTo(t.$(".bwOffersContainer"))})},buyOffer:function(e){var t=this,i=this.model.getOfferById($(e.target).data("offerId"));i&&i.canBuy().then(function(e){e&&t.model.buy(i)})}}),AnimatedPrizesWindow=TWindow.extend({templateClass:".animatedPrizesWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),new UserPrizesView({model:this.options.prizes,el:this.$(".mPrizes")}),this.$el.addClass(this.options.worldName),this.options.message&&this.$el.find(".mMessage").html(messages[this.options.world][this.options.message])},showPrizesAnimation:function(){var l=this;return new Promise(function(e){var t=l.$(".mPrizes").children(),o=$(".blockedAnimations"),a=$("#livesTarget"),n=$("#coinsTarget"),r=$("#ticketsTarget"),s=$("#powerUpTarget");t.each(function(){var e=$(this),t=e.clone().addClass("animatedPrize");o.append(t),t.alignTo(e),t.addClass(l.options.worldName);var i=s;e.hasClass("coins")&&(i=n),e.hasClass("tickets")&&(i=r),e.hasClass("unlimitedLifes")&&(i=a),(e.hasClass("unlimitedBonusWorldLives")||e.hasClass("unlimitedBonusWorldLives2")||e.hasClass("unlimitedBonusWorldLives3")||e.hasClass("unlimitedFirstBonusWorldLives"))&&(i=a),t.ourAnimate({target:i},1e3,"easeOutCubic",function(){this.remove()})}),e()})},onClose:function(){var e=this;return this.showPrizesAnimation().then(function(){TWindow.prototype.onClose.call(e),e.options.notGive||e.options.prizes.take()})}}),PrizeLinkSorryWindow=TWindow.extend({templateClass:".prizeLinkSorryWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.find(".mMessage").html(messages.prizeLink.sorry)}}),TitledAnimatedPrizesWindow=AnimatedPrizesWindow.extend({onOpen:function(){AnimatedPrizesWindow.prototype.onOpen.call(this);var e=this.$(".mTitle"),t=this.$(".mMessage");e.addClass(this.options.title||""),t.addClass(this.options.message||"")}}),SpecialBonusWorld=BonusWorld.extend({initialize:function(){BonusWorld.prototype.initialize.call(this),this._artifactWorkshop=null,this.has("artifactWorkshop")&&(this._artifactWorkshop=new Artifacts.ArtifactWorkshop(_.extend({prefix:this.get("name")},this.get("artifactWorkshop"))),this.on("createNewGame",this._applyPassiveArtifactAbilities,this),this.on("completeLevel",this._receiveRandomArtifactPart,this)),this.on("createNewGame",this._onCreateNewGame,this),this.on("change:level",this._updateTaskAvailable,this),Application.on("ready",function(){this._updateTaskAvailable(),episode.on("change:num",this._updateTaskAvailable,this),user.on("change:specialworldprogress change:specialworldtasks",this._updateTaskAvailable,this)},this)},_updateTaskAvailable:function(){var e=this.getTaskToBuyAvailable();$(".specialworld").toggleClass("tasksAvailable",!!e),e&&$("#buyTask").removeClass(function(e,t){for(var i=[],o=/task[0-9]+/gm,a=o.exec(t);a;)i.push(a[0]),a=o.exec(t);return i.join(" ")}).addClass("task"+e.id).find(".mDescriptionTask").html(messages[this.name+"Task"+e.id])},_applyPassiveArtifactAbilities:function(){$("#game .gameProgress .indicators .indicator").removeClass("active"),$("#game").addClass("indicators"),this.getArtifactWorkshop().applyPassiveArtifactAbilities().forEach(function(e){var t=e.get("cssClass");$("#game .gameProgress .indicators").find(t).addClass("active")})},_receiveRandomArtifactPart:function(e){var t=this.get("artifactWorkshopMinLevel"),i=this.get("artifactWorkshopMinStars")||0,o=episode.scores.last(),a=this.getArtifactWorkshop(),n=null;o&&o.get("level")===e&&(e===t?(a.getParts().forEach(function(e){e.get("startAmount")&&e.setAmount(e.get("startAmount"))}),n=a.receivePart(),a.save()):t<e&&o.get("stars")>=i&&(n=a.receivePart()));n&&(a.save(),application.once("main",function(){episode.get("num")===Config.specialWorld.name&&this._animateReceiveRandomArtifactPart(n,1e3,1e3)},this)),this.trigger("specialWorldReceiveArtifactPart",n)},_animateReceiveRandomArtifactPart:function(r,e,s){var l=this;setTimeout(function(){var e=l._artifactWorkshopButtonView.$el,t=window.mobile?$("#startLevel").get(0).getBoundingClientRect():$("#startLevel").position(),i=e.position(),o=$("<div></div>").addClass("animationArtifactPart artifactPart"+r.id).css({top:t.top,left:t.left,"z-index":5}).appendTo("#map .specialworld"),a=e[0].getBoundingClientRect(),n=o[0].getBoundingClientRect();i.top+=(a.height-n.height)/2,i.left+=(a.width-n.width)/2,o.animate({top:i.top,left:i.left},{duration:s,easing:"easeOutQuad",done:function(){o.remove(),Config.bonusWorld.trigger("artifactAnimationFinished")}})},e)},getArtifactWorkshop:function(){return this._artifactWorkshop},_getMaxScrollX:function(){return-(this._$bg.width()-$(".specialworldTasksContainer").width())},_initScroll:function(){this._$bg=$(".specialworldtasks"),this.get("scrollEnabled")&&this._handleScrollByTouch(),this._bgScrollX=0,this.scrollTo(this._getMaxScrollX()/2,null,!0);var e=this;this._$buttonScrollLeft=$(".scrollButton.left"),this._$buttonScrollLeft.on("click touchend",function(){e.scrollBy(e.get("scrollDistance"))}),this._$buttonScrollRight=$(".scrollButton.right"),this._$buttonScrollRight.on("click touchend",function(){e.scrollBy(-e.get("scrollDistance"))}),this.on("change:scrollEnabled",function(){this._toggleScrollGUI()},this);var t=user.get("specialworldtasks");if(t.length){var i=t[t.length-1];if(i){var o=_.findWhere(Config.specialWorld.tasks,{id:i.id});this.setScrollEnabled(!!o.scrollTo),o&&!Config.bonusWorld.isTasksTalksFinished(i.id)&&o.scrollTo&&this.scrollToElement(o.scrollTo)}}},_toggleScrollGUI:function(){var e=[this._$buttonScrollLeft,this._$buttonScrollRight];this.get("scrollEnabled")?e.forEach(function(e){e.show()}):e.forEach(function(e){e.hide()})},_initArtifacts:function(){var e=this.getArtifactWorkshop();if(e){var t=[$(".specialWorldShopBlock"),$(".bonusWorldBtn"),$(".specialworldgold"),$(".backToMenuMainPage"),this._$buttonScrollLeft,this._$buttonScrollRight];this._artifactWorkshopView=new Artifacts.ArtifactWorkshopView({model:e}),this._artifactWorkshopView.hide(),user.on("createNewGame",function(){this._artifactWorkshopView.hide()},this),this._artifactWorkshopView.on("exit",function(){this._artifactWorkshopView.hide()},this),this._artifactWorkshopView.on("show",function(){$(".wrapper").addClass("artifactPage"),t.forEach(function(e){e.hide()})},this),this._artifactWorkshopView.on("hide",function(){$(".wrapper").removeClass("artifactPage"),t.forEach(function(e){e.css("display","")}),this._toggleScrollGUI()},this);var i="availableNewArtifactPart";this._artifactWorkshopButtonView=new Artifacts.ArtifactWorkshopButtonView,this._artifactWorkshopButtonView.show(),this._artifactWorkshopButtonView.on("click",function(){setLocalStorage(i,!1),this._artifactWorkshopButtonView.hideAvailableNewArtifactPart(),this._artifactWorkshopView.show()},this),e.on("receivePart",function(){setLocalStorage(i,!0),this._artifactWorkshopButtonView.showAvailableNewArtifactPart()},this),getLocalStorage(i,!1)&&this._artifactWorkshopButtonView.showAvailableNewArtifactPart(),this._toggleArtifactWorkshopButton()}else $("#artifactWorkshop").hide()},_toggleArtifactWorkshopButton:function(){this.getCurrentLevel()<=this.get("artifactWorkshopMinLevel")?this._artifactWorkshopButtonView.hide():this._artifactWorkshopButtonView.show()},_handleScrollByTouch:function(){var i=this,o=0,a=function(e){var t=e.pageX||0;return"touchstart"===e.type&&e.originalEvent.touches.length?t=e.originalEvent.touches[0].pageX:"touchend"===e.type&&e.originalEvent.changedTouches.length&&(t=e.originalEvent.changedTouches[0].pageX),t};this._$bg.on("mousedown touchstart",function(e){o=a(e)}),this._$bg.on("mouseup touchend",function(e){var t=a(e)-o;Math.abs(t)>i.get("scrollThreshold")&&i.scrollBy(t)})},setScrollEnabled:function(e){e||this.scrollTo(this._getMaxScrollX()/2,null,!0),this.set("scrollEnabled",e)},scrollTo:function(e,t,i){if(this.get("scrollEnabled")){var o=0;i||(o=this.get("scrollDuration")),this._bgScrollX=Math.min(Math.max(e,this._getMaxScrollX()),0),this._$bg.css({transition:"transform "+o+"ms ease"}),this._$bg.css({transform:"translateX("+this._bgScrollX+"px)"}),t instanceof Function&&setTimeout(t,o)}else t instanceof Function&&t()},scrollBy:function(e,t){this.scrollTo(this._bgScrollX+e,t)},scrollToElement:function(e,t){this.scrollTo(-$(e).position().left-this._getMaxScrollX()/2,t)},episodeChanged:function(){BonusWorld.prototype.episodeChanged.call(this);var e=this;setTimeout(function(){e._initScroll(),e._initArtifacts()},0)},_onCreateNewGame:function(){application.level.startParams.replayBonusLevel||(user.set("specialItemCollected",!1),Game.set("specialItemCreated",!1)),user.get("specialItemCollected")||episode.get("num")==Config.specialWorld.name&&Config.specialWorld.items&&application.level.num>=Config.specialWorld.items.level&&Game.on("validMove",function(){var e=Config.specialWorld.items.chances[Game.get("moves").get()];e&&!Game.get("specialItemCreated")&&_.random(0,100)<=e&&Config.bonusWorld.createSpecialItem()},this)},onFailBonusWorldLevel:function(){BonusWorld.prototype.onFailBonusWorldLevel.call(this),user.set("specialItemCollected",!1),Game.set("specialItemCreated",!1),this.renderProgress()},getEmptyItemField:function(){for(var e=1;e<=Config.specialWorld.items.max;e++)if(!this.getItem(e))return e;return!1},addItem:function(e){this.updateData({item:e})},removeItem:function(e){this.updateData({removedItem:e})},createSpecialItem:function(){Game.set("specialItemCreated",!0);var e={offset:0,cellClass:FishCell,type:10};Game.fallDownSpecialCells.unshift(e)},getItem:function(e){var t=user.get("specialworlditems"),i=_.findWhere(t,{id:e});return i||0},getRandomItem:function(e){e=e||Config.specialWorld.items.collection;var t,i=0;for(t=0;t<e.length;t++)i+=e[t].chance;var o=_.random(1,i);for(t=0,value=0;t<e.length;t++)if(value+=e[t].chance,o<=value)return e[t];return _.findWhere(Config.specialWorld.items.collection,{id:1})},getRandomUniqueItem:function(){var e=!1,t=_.pluck(Config.specialWorld.items.collection,"id"),i=_.difference(t,user.get("specialworlditems"));return i&&i.length&&(e=i[_.random(0,i.length-1)]),_.findWhere(Config.specialWorld.items.collection,{id:e})},renderGold:function(){window.mobile?$("#map").find(".specialworldgold").find(".amount").html(this.getGold()):$("#map .specialworld").find(".specialworldgold").html(this.getGold())},updateData:function(e){var t,i;if(e.force){var o=user.get("specialworldforce")||0;user.set("specialworldforce",o+1)}if(e.talk){var a=user.get("specialworldtalks")||[];-1===_.indexOf(a,e.talk)&&a.push(e.talk),user.set("specialworldtalks",a)}if(void 0!==e.prize&&!1!==e.prize){var n=user.get("specialworldprizes")||[];-1===_.indexOf(n,e.prize)&&n.push(e.prize),user.set("specialworldprizes",n)}var r={worldName:this.get("name"),gold:Config.bonusWorld.getGold(),force:user.get("specialworldforce"),talk:user.get("specialworldtalk"),talks:user.get("specialworldtalks").toString(),prizes:user.get("specialworldprizes").toString()};if(void 0!==e.item&&(e.item=parseInt(e.item),r.item=e.item,(i=this.getItem(e.item))?++i.amount:((t=user.get("specialworlditems")).push({id:e.item,amount:1}),user.set("specialworlditems",t))),void 0!==e.removedItem){e.removedItem=parseInt(e.removedItem),r.removedItem=e.removedItem;var s=this.getItem(e.removedItem);s&&--s.amount}if(void 0!==e.task){e.task=parseInt(e.task);var l=this.getTask(e.task);if(e.option=void 0!==e.option?parseInt(e.option):0,!l||l.option!==e.option){var d=user.get("specialworldtasks");l?l.option=e.option:d.push({id:e.task,option:e.option}),user.set("specialworldtasks",d),r.task=e.task,r.option=e.option}}this._updateTaskAvailable(),callServiceAddInQueue("../../../gems/site/service/specialworldupdate.php",r)},onCompleteBonusWorld:function(e){e?(this.stopListening(),new BonusWorldFinishedWindow(_.find(this.get("prizes"),{type:"finalPrize"}))):this.set("levelsCompleted",!0)},onCompleteBonusWorldLevel:function(e){BonusWorld.prototype.onCompleteBonusWorldLevel.call(this,e),this.renderGold();var t=this;user.get("specialItemCollected")&&(window.mobile?this.addItem(user.get("specialItemCollected")):new SpecialWorldBoxItemWindow({itemId:user.get("specialItemCollected")})),application.once("main",function(){episode.get("num")==Config.specialWorld.name&&(setTimeout(function(){t.showGoldAnimation()},500),this.getArtifactWorkshop()&&this._toggleArtifactWorkshopButton())},this),this.trigger("completeLevel",e)},showGoldAnimation:function(){var e,t;window.mobile?(e=$("#map").find(".specialworldgold"),(t=$(".invisible .specialworldgoldanimate").clone().appendTo($("#map"))).css("top",parseFloat(e.css("top"))-28),t.css("left",parseFloat(e.css("left"))-28)):(e=$("#map .specialworld").find(".specialworldgold"),(t=$(".invisible .specialworldgoldanimate").clone().appendTo($("#map"))).css("top",e.css("top")),t.css("left",e.css("left")));var i=this;setTimeout(function(){t.remove(),window.mobile?$("#map .specialworld").find(".specialworldgold").find("amount").html(Config.bonusWorld.getGold()):i.$gold.html(Config.bonusWorld.getGold()),Config.bonusWorld.trigger("goldAnimationFinished")},1500)},onEnterBonusWorld:function(){this.set("visited",!0),(this.get("closeForNew")||this.get("showFinalForce"))&&1<user.get("specialworldprogress")&&new SpecialWorldFinalForceWindow,this.$html=$(".invisible .specialworld").clone().appendTo($("#map")),this.renderLevels(),this.renderTasks(),episode.scores.once("reset",this.renderProgress,this),episode.scores.on("add",this.renderProgress,this),application.on("change:subPage",function(e,t){"menuMain"===t&&this.leaveBonusWorld()},this),this.listenTo(user,"createNewGame",_.bind(function(){this.trigger("createNewGame")},this)),this.specialLevelMusicOverride=Config.specialLevels.gamemusic,this.overtakenAndChampionWindowsMinLevelOverride=Config.overtakenAndChampionWindowsMinLevel,this.likeWindowAvailableOverride=Config.likeWindowAvailable,Config.specialLevels.gamemusic=!1,Config.likeWindowAvailable=!1,Config.overtakenAndChampionWindowsMinLevel=100,this.get("finished")&&this.set("completed",!0),BonusWorld.prototype.onEnterBonusWorld.call(this),this.trigger("enterBonusWorld",this)},onBonusWorldTakePrize:function(){},getTask:function(e){return _.findWhere(user.get("specialworldtasks"),{id:e})},getTaskTalks:function(t){var i=[];return _.each(Config.specialWorld.talks,function(e){e.task&&e.task==t&&i.push(e.id)},this),i},isTasksTalksFinished:function(e){for(var t=this.getTaskTalks(e),i=0;i<t.length;i++)if(!this.hasTalk(t[i]))return!1;return!0},hasTalk:function(e){return-1!==_.indexOf(user.get("specialworldtalks"),e)},renderTasks:function(){var i,e=user.get("specialworldtasks"),t=user.get("specialworldtalks");_.each(t,function(e){(i=_.findWhere(Config.specialWorld.talks,{id:e}))&&i.onEpisodeRender&&i.onEpisodeRender(),i&&i.task&&$("#map .specialworld").find(".task"+i.task).addClass("talk"+e+"Finished"),Config.specialWorld.addClass(i,"addClassOnComplete",function(e){return!e.once},!0)},this),_.each(e,function(e){var t=this.$html.find(".task"+e.id);$("#map .specialworld").removeClass("hasTask"+e.id),t&&(i=_.findWhere(Config.specialWorld.tasks,{id:e.id}),t.addClass("active").addClass("option"+e.option),$("#map .specialworld").addClass("hasTask"+e.id),Config.bonusWorld.isTasksTalksFinished(e.id)&&(i.onAllTalksFinished&&i.onAllTalksFinished(),$("#map .specialworld").find(".task"+e.id).addClass("allTalksFinished")),i&&i.onEpisodeRender&&i.onEpisodeRender(),Config.specialWorld.addClass(i,"addClassOnComplete",function(e){return!e.once},!0),Config.specialWorld.addOption(i,"addOptionOnComplete"))},this)},getGold:function(){var t=user.get("specialworldprogress"),e=user.get("specialworldtasks");return _.each(e,function(e){(e=_.findWhere(Config.specialWorld.tasks,{id:e.id}))&&(t-=e.price)},this),t},renderProgress:function(){var e=Config.bonusWorld.get("levelsInEpisode");this.$html.find(".specialworldProgress").html(episode.scores.length),this.$html.find(".specialworldProgressGoal").html(e);var t=parseFloat((100*episode.scores.length/Config.bonusWorld.get("levelsInEpisode")).toFixed(2));this.$html.find(".specialworldProgressBarLine").css("width",Math.min(100,t)+"%"),this.$gold=this.$html.find(".specialworldgold"),window.mobile?(this.$gold.find(".amount").html(Config.bonusWorld.getGold()),this.$gold.appendTo("#map")):this.$gold.html(Config.bonusWorld.getGold()),user.set("specialworldprogress",this.getCurrentLevel());for(var i=1;i<=this.get("levelsInEpisode");i++)this.$html.removeClass("level"+i);this.$html.addClass("level"+user.get("specialworldprogress")),_.each(this.get("prizes"),function(e){if(episode.scores.length>=e.level){var t=this.$html.find(".mark-"+e.level);t&&t.hide()}},this),episode.scores.length>=e&&this.set("levelsCompleted",!0)},leaveBonusWorld:function(){$("."+Config.specialWorld.name+"level").remove(),this.$html.remove(),window.mobile&&$("#map").find(".specialworldgold").remove(),Config.specialLevels.gamemusic=this.specialLevelMusicOverride,Config.overtakenAndChampionWindowsMinLevel=this.overtakenAndChampionWindowsMinLevelOverride,Config.likeWindowAvailable=this.likeWindowAvailableOverride,episode.scores.off("add",this.renderProgress,this),this.stopListening(user,"createNewGame"),BonusWorld.prototype.leaveBonusWorld.call(this),this.trigger("leaveBonusWorld")},runBonusWorldTimer:function(){},getTimeLeft:function(){return user.get("specialworldendtime")-application.getCurrentServerTime()},updateBonusWorldTimer:function(){if(this.getTimeLeft()<=0)this.get("finished")||(this.set("finished",!0),callServiceAddInQueue("../../../levelbase/src/services/setbonusworldfinished.php",{worldName:this.get("name")}));else{var e=user.get("specialworldprogress");e&&(e>this.get("levelsInEpisode")?$(".bonusWorldLevelProgress").hide():$(".bonusWorldLevelProgress").text(e))}},renderLevels:function(){for(var e=21;e<=this.get("levelsInEpisode");e++){var t=$(".invisible .level").clone();t.addClass(Config.specialWorld.name+"level"),t.attr("id","level"+e),t.attr("data-level",e),t.find(".levelNum").html(e),$(".levels").append(t),t.find(".levelNum").attr("data-level",e),t.find(".levelNowAnimation").attr("data-level",e),t.find(".animationSprite").attr("data-level",e)}},_openShopWindow:function(){var e=$("#main"),t=$("<div>").css({width:parseInt(e.width())+"px",height:parseInt(e.height())+"px",opacity:0}),i=!1,o=!1,a=!1;application.windows.anyVisibleWindow()||$("#blockedAnimations").css("z-index","").append(t);var n=_.bind(function(){t.detach(),this.off("specialWorldForces artifactAnimationFinished goldAnimationFinished specialWorldReceiveArtifactPart")},this),r=function(){i&&o&&a&&(t.detach(),new SpecialWorldShopWindow)};void 0===SpecialWorldForces?(a=!0,r()):this.once("specialWorldForces",function(e){e?n():a=!0,r()}),this.getArtifactWorkshop()?(this.once("artifactAnimationFinished",function(){o=!0,r()}),this.once("specialWorldReceiveArtifactPart",function(e){e||(this.off("artifactAnimationFinished"),o=!0,r())},this)):(o=!0,r()),this.once("goldAnimationFinished",function(){i=!0,r()})},getTasksAvailable:function(){for(var i=user.get("specialworldtasks"),e=_.max(Config.specialWorld.tasks,function(e){return e.group}).group,t=1;t<=e;t++){var o=_.where(Config.specialWorld.tasks,{group:t}).filter(function(e){return t=e,!_.findWhere(i,{id:t.id});var t});if(0<o.length)return o}return t},getTaskToBuyAvailable:function(){for(var e=this.getTasksAvailable(),t=this.getGold(),i=0;i<e.length;++i)if(e[i].price<=t)return e[i]},buyTask:function(e){var t=messages[this.name+"Task"+e],i=this.getGold(),o=_.findWhere(Config.specialWorld.tasks,{id:e});if(console.assert(t,"    "+e),o&&t&&o.price&&!_.findWhere(user.get("specialworldtasks"),{id:e})&&i>=o.price){var a="string"==typeof o.scrollTo;if(this.setScrollEnabled(a),a&&this.scrollToElement(o.scrollTo),o.initialTalk&&!this.hasTalk(o.initialTalk))SpecialWorldTalks.run(0,o.initialTalk);else o.onComplete&&o.onComplete(),this.addClass(o,"addClassOnComplete"),this.addOption(o,"addOptionOnComplete"),o.options?(o.optionsTalk&&SpecialWorldTalks.run(0,o.optionsTalk),SpecialWorldTalks.openTaskOptions(o)):(this.updateData({task:o.id}),SpecialWorldTalks.run()),this.renderGold(),$("#map .specialworld").find(".task"+o.id).addClass("active"),$("#map .specialworld").find(".specialworldtaskComplete").addClass("task"+o.id),setTimeout(function(){$("#map .specialworld").find(".specialworldtaskComplete").removeClass("task"+o.id)},3e3),window.mobile?$("#topMenu").find(".specialworldgold").html(this.getGold()):$("#map .specialworld").find(".specialworldgold").html(this.getGold()),$("#map .specialworld").addClass("hasTask"+o.id);return o.id==Config.specialWorld.tasks.length?this.set("tasksCompleted",!0):o.group!=SpecialWorldShopWindow.getTasksGroup()&&(user.set("specialWorldNewTasksAvailable",!0),$(".specialWorldShopBlock").addClass("newTasksAvailable")),this._updateTaskAvailable(),!0}},addClass:function(e,t,i,o){if(e&&e[t]instanceof Array){var a=e[t];i instanceof Function&&(a=a.filter(i)),a.forEach(function(e){e.delay&&!o?setTimeout(_.bind(function(){this._addClassItem(e)},this),e.delay):this._addClassItem(e)},this)}},_addClassItem:function(e){var t=$("#map .specialworld").find(e.element);t.addClass(e.className),e.time&&setTimeout(function(){t.removeClass(e.className)},e.time),e.once&&application.once("change:page",function(){t.removeClass(e.className)}),e.soundId&&application.playSound(e.soundId)},removeClass:function(e,t,i){if(e&&e[t]instanceof Array){var o=e[t];i instanceof Function&&(o=o.filter(i));var a=$("#map .specialworld");o.forEach(function(e){a.find(e.element).removeClass(e.className)})}},addOption:function(i,e){if(i&&i[e]instanceof Array){var o=$("#map .specialworld");i[e].forEach(function(e){var t=this.getTask(i.id);t&&o.find(e).addClass("option"+t.option)},this)}}});ApplicationView.prototype.events["click .specialworld .buyTask"]="buySpecialWorldTask",ApplicationView.prototype.buySpecialWorldTask=function(){var e=Config.bonusWorld.getTaskToBuyAvailable();e&&Config.bonusWorld.buyTask(e.id)};var SpecialWorldInfoWindow=TWindow.extend({templateClass:".bonusWorldLevelBlockedWindow_template",events:{"click .close":"close","click .action":"close"},onClose:function(){TWindow.prototype.onClose.call(this),SpecialWorldTalks.disabled=!1,SpecialWorldTalks.run()},onOpen:function(){SpecialWorldTalks.disabled=!0,this.$(".windowTitle").html(messages[Config.specialWorld.name+"InfoWindowTitle"]),this.$(".windowText").html(messages[Config.specialWorld.name+"InfoWindowText"]),this.$el.find(".oneWindowBtn").html(messages[Config.specialWorld.name+"InfoWindowButton"])}}),SpecialWorldFinalForceWindow=TWindow.extend({templateClass:".specialWorldFinalForceWindow_template",events:{"click .close":"close","click .action":"close"},runTimer:function(){var i,e=_.bind(function(){var e=Config.bonusWorld?Config.bonusWorld.getTimeLeft():0;if(e<=0)clearInterval(i);else{var t="";t=e<3600?formatTime("%i:%s",e):formatPeriod(e<86400?Math.round(e/60):60*Math.round(e/60/60)),this.$(".timer").html(t)}},this);i=setInterval(e,1e3),e()},onOpen:function(){this.runTimer()}}),SpecialWorldHelpWindow=TWindow.extend({templateClass:".specialWorldHelpWindow_template",events:{"click .start":"close","click .no":"close","click .yes":"giveHelp"},giveHelp:function(){this.close(),goods.goodBuyed("unlimitedBonusWorldLives",1),episodeView.gotoBonusWorld(Config.specialWorld.object),user.set({actionName:"v help give",actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:0})},onOpen:function(){this.$el.find(".amount").html(formatPeriod(60,!0)),user.set({actionName:"v help show",actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:0})}}),SpecialWorldTaskWindow=TWindow.extend({templateClass:".specialWorldTaskWindow_template",events:{"click .taskOption":"selectOption","click .taskComplete":"complete","click .taskCancel":"discard"},closeAnimation:function(e){this.$el.hide(),setTimeout(e,0)},openAnimation:function(){this.$el.show()},shadowOpenAnimation:function(){window.mobile?$("#windowShadow").show().show().css("opacity",0):$("#windowShadow").stop().clearQueue().show().css("opacity",0)},selectOption:function(e){var t=parseInt($(e.currentTarget).attr("data-item"));t&&this.chooseOption(t)},chooseOption:function(e){for(var t=1;t<=3;t++)this.$el.removeClass("option"+t).find(".taskOption"+t).removeClass("selected"),this.$task.removeClass("option"+t);if(this.$el.addClass("option"+e).find(".taskOption"+e).addClass("selected"),this.$task.addClass("option"+e),this.item=e,this.options.task.scrollTo){var i=this.options.task;setTimeout(function(){Config.bonusWorld.scrollToElement(i.scrollTo)},100)}},complete:function(){Config.bonusWorld.updateData({task:this.task.id,option:this.item}),Config.bonusWorld.renderGold(),$("#map .specialworld").find(".specialworldgold").html(Config.bonusWorld.getGold()),episode.scores.length,Config.bonusWorld.get("levelsInEpisode");this.$task;var e=this.task.id;$("#map .specialworld").find(".specialworldtaskComplete").addClass("task"+e),setTimeout(function(){$("#map .specialworld").find(".specialworldtaskComplete").removeClass("task"+e)},3e3),$("#map .specialworld").addClass("hasTask"+e),this.$task.removeClass("tempVisible"),this.task.onComplete&&this.task.onComplete(),Config.specialWorld.addClass(this.task,"addClassOnComplete"),Config.specialWorld.addOption(this.task,"addOptionOnComplete"),Config.specialWorld.removeClass(this.task,"addClassOnOption"),this.task.group!=SpecialWorldShopWindow.getTasksGroup()&&(user.set("specialWorldNewTasksAvailable",!0),$(".specialworldShopBlock").addClass("newTasksAvailable")),this.isCompleted=!0,this.close()},onOpen:function(){this.options.taskId&&(this.task=_.findWhere(Config.specialWorld.tasks,{id:this.options.taskId})),this.task||(this.task=this.options.task),this.task.onOptionsWindow&&this.task.onOptionsWindow(),Config.specialWorld.addClass(this.task,"addClassOnOption"),this.$el.addClass("task"+this.task.id),this.$task=$("#map .specialworld").find(".task"+this.task.id),this.$task.addClass("active").addClass("tempVisible"),this.chooseOption(2),TWindow.prototype.onOpen.call(this)},discard:function(){for(var e=1;e<=3;e++)this.$task.removeClass("option"+e).removeClass("active").removeClass("tempVisible");this.close()}});ApplicationView.prototype.events["click .specialWorldShopBlock"]="showSpecialWorldShop",ApplicationView.prototype.showSpecialWorldShop=function(){new SpecialWorldShopWindow};var SpecialWorldCollectionPrizeWindow=TWindow.extend({templateClass:".specialWorldCollectionPrizeWindow_template",events:{"click .needPublicCheckbox":"togglePublicCheckbox","click .continue":"close"},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},onOpen:function(){if(TWindow.prototype.onOpen.apply(this,arguments),this.options.prize=Config.specialWorld.getCollectionPrize(this.options.id),this.$el.addClass("category"+this.options.type),this.$el.addClass("collectionPrizeWindow"),this.$(".windowTitle").html(messages[Config.specialWorld.object.name+"CollectionPrizeTitle"]),this.$(".mainText").html(messages[Config.specialWorld.object.name+"YouHaveAllGold"]),this.onPublicCheckbox(),this.options.prize&&this.options.prize.prize){this.$el.addClass("prize");for(var e=_.isArray(this.options.prize.prize)?this.options.prize.prize:[this.options.prize.prize],t=0;t<e.length;t++){var i=e[t],o=this.$el.find(".invisible .bonusWorldLevelPrize").clone().addClass(i.type);i.amount&&o.find(".amount").html("good"==i.type?formatPeriod(60*i.amount,!0):i.amount),"powerUp"===i.type&&o.addClass(i.name),"good"===i.type&&o.addClass(i.cssClass),"gift"===i.type&&(i.giftId||(i.giftId=RANDOM(i.ids)),o.addClass(i.giftId)),"spins"===i.type&&(user.set("spins",user.get("spins")+i.amount),user.set("freeGacha",!0),new GachaWindow({firstPriority:!0})),o.appendTo(this.$(".prizes"))}}},onClose:function(){if(this.options.prize&&this.options.prize.prize){var e,t=_.isArray(this.options.prize.prize)?this.options.prize.prize:[this.options.prize.prize],i=user.get("coins"),o=!1;if(this.options.prize.required)for(e=0;e<this.options.prize.required.length;e++)Config.specialWorld.object.removeItem(this.options.prize.required[e]);for(e=0;e<t.length;e++){var a=t[e];switch(a.type){case"coins":i=new ObscureNumber(i+a.amount),o=!0;break;case"good":goods.goodBuyed(a.name,a.amount,!0);break;case"powerUp":user.setPowerUpAmount(a.name,user.getPowerUpAmount(a.name)+a.amount,!0),o=!0;break;case"gift":window.mobile||Gifts.receiveGift(Gifts.findGiftById(a.giftId))}}o&&user.set({powerUps:user.calcPowerUps(),coins:i}),Config.specialWorld.object.updateData({prize:this.options.type}),user.set({actionName:"getCollection",actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:0})}this.doPublication()},doPublication:function(){this.needPublic&&(this.options.type?user.defaultPublication(Config.specialWorld.object.name+"ItemDonePublication"+this.options.type):user.defaultPublication(Config.specialWorld.object.name+"CollectionDonePublication"))}}),SpecialWorldItemWindow=TWindow.extend({templateClass:".specialWorldItemWindow_template",events:{"click .close":"close","click .action":"buyItem"},buyItem:function(e){var t=this.options.itemId,i=user.get("coins");if(_.findWhere(Config.specialWorld.items.collection,{id:t})){var o=Config.specialWorld.items.price;o<=i?(user.set("coins",new ObscureNumber(user.get("coins")-Number(o))),user.set({actionName:"buy "+t,actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:o}),Config.specialWorld.object.addItem(t),this.close(),new SpecialWorldShopWindow({page:1,itemId:t})):(this.close(),new AddCoinsWindow)}},onOpen:function(){this.$el.addClass("specialWorldItemWindow").addClass("item"+this.options.itemId),this.$(".windowTitle").html(messages[Config.specialWorld.name+"ItemWindowTitle"]),this.$el.find(".itemText").html(messages[Config.specialWorld.name+"ItemWindowText"]),this.$(".price").html(Config.specialWorld.items.price)}}),SpecialWorldBoxWindow=TWindow.extend({templateClass:".specialWorldBoxWindow_template",events:{"click .close":"close"},onOpen:function(){var e=this.options.boxId;this.$el.addClass("box"+e);var t=user.get("coins"),i=(Config.specialWorld.items.collection,_.findWhere(Config.specialWorld.items.boxes,{id:e}));if(i){var o=Config.bonusWorld.getRandomItem(i.items);if(o){this.$el.addClass("toy"+o.id),this.$el.find(".specialBoxItem").addClass("toy"+o.id);var a=i.price;if(a<=t){user.set("coins",new ObscureNumber(user.get("coins")-Number(a))),user.set({actionName:"buy "+e,actionEpisode:episode.getNumForStatistics(),actionLevel:0,actionPrice:a}),Config.specialWorld.object.addItem(o.id);var n=this,r=window.mobile?0:3e3;setTimeout(function(){n.close(),new SpecialWorldShopWindow({page:1,itemId:o.id})},r)}else this.close(),new AddCoinsWindow}}}}),SpecialWorldBoxItemWindow=TWindow.extend({templateClass:".specialWorldBoxWindow_template",events:{"click .close":"close"},onOpen:function(){this.options.boxId;var e=Config.specialWorld.items.collection,t=_.findWhere(e,{id:this.options.itemId});if(t){this.$el.addClass("toy"+t.id),this.$el.find(".specialBoxItem").addClass("toy"+t.id),Config.specialWorld.object.addItem(t.id);var i=this,o=window.mobile?0:3e3;setTimeout(function(){i.close()},o)}else this.close()}}),SpecialWorldShopWindow=TWindow.extend({templateClass:".specialWorldShopWindow_template",name:"specialworldshopwindow",events:{"click .close":"close","click .shopTabItem":"selectTab","click .buyTask":"buyTask","click .specialWorldItem ":"useItem","click .boxBtn ":"buyBox","click .collect":"collectPrize"},takePrize:function(e){var t,i=Config.specialWorld.getCollectionPrize(e),o=_.isArray(i.prize)?i.prize:[i.prize],a=user.get("coins"),n=!1;if(i.required)for(t=0;t<i.required.length;t++)Config.specialWorld.object.removeItem(i.required[t]);for(t=0;t<o.length;t++){var r=o[t];switch(r.type){case"coins":a=new ObscureNumber(a+r.amount),n=!0;break;case"good":goods.goodBuyed(r.name,r.amount,!0);break;case"powerUp":user.setPowerUpAmount(r.name,user.getPowerUpAmount(r.name)+r.amount,!0),n=!0;break;case"spins":user.set("spins",user.get("spins")+r.amount),user.set("freeGacha",!0);break;case"gift":window.mobile||Gifts.receiveGift(Gifts.findGiftById(r.giftId))}}n&&user.set({powerUps:user.calcPowerUps(),coins:a})},collectPrize:function(e){var t=parseInt($(e.currentTarget).attr("data-prize"));this.canCollectPrize(t)&&(this.takePrize(t),this.renderPage(1))},isPrizeCollected:function(e){var t=user.get("specialworldprizes");return t&&-1!==_.indexOf(t,e)},canCollectPrize:function(e){for(var t,i,o=Config.specialWorld.getCollectionPrize(e),a=0;a<o.required.length;a++)if(i=o.required[a],!(t=Config.specialWorld.object.getItem(i))||!t.amount)return!1;return!0},useItem:function(e){if(_.result(Config,"lootBoxEnable"))return this.renderPage(2)},buyBox:function(e){var t=parseInt($(e.currentTarget).attr("data-box"))||1;this.close(),new SpecialWorldBoxWindow({boxId:t})},buyTask:function(e){var t=parseInt($(e.currentTarget).attr("data-task"));t&&Config.specialWorld.object.buyTask(t)&&this.close()},onOpen:function(){this.tabs=Config.specialWorld.items?3:1,this.page=this.options.page?this.options.page:0,this.itemId=!!this.options.itemId&&this.options.itemId,this.renderTabs(),this.renderPage(this.page),TWindow.prototype.onOpen.call(this)},selectTab:function(e){var t=$(e.currentTarget).data("page");if(this.page!==t){var i=_.bind(function(){this.renderPage(t),this.$el.find(".shopList .shopItem").each(function(){$(this).css({opacity:0}).setScale(.5).ourAnimate({scale:1,opacity:1},300,"easeOutBack")})},this),o=this.$(".shopList .shopItem");if(0<o.length){var a=_.after(o.length,i);o.each(function(){$(this).ourAnimate({scale:.5,opacity:0},200,"linear",a)})}else i()}},renderTabs:function(){var e=$(".invisible .specialWorldShopTabItem"),t=this.$(".tabbar");if(1<this.tabs)for(var i=0;i<this.tabs;i++)(_.result(Config,"lootBoxEnable")||2!==i)&&e.clone().appendTo(t).addClass("page"+i).data("page",i).find(".title").html(messages[Config.specialWorld.name+"ShopTabsTitle"][i])},renderPowerUpsBlock:function(e){this.powerUpsAndCoinsWindowBlock||(this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.powerUpsAndCoinsWindowBlock.$el.show())},renderPage:function(e){this.renderPowerUpsBlock(e),this.$(".tabbar .specialWorldShopTabItem").removeClass("selected"),this.$(".tabbar .specialWorldShopTabItem.page"+e).addClass("selected"),1<this.tabs&&this.$el.removeClass("page"+this.page).addClass("page"+e),this.$(".shopList").removeClass("page"+this.page).addClass("page"+e).empty();var t=this.$(".shopListContent");t.empty();var i=$(".invisible .page"+e+"Content").clone();switch(i.appendTo(t),e){case 0:this.renderTasks(i);break;case 1:this.renderItems(i);break;case 1:this.renderBoxes(i)}this.page=e},renderBoxes:function(){},renderTasks:function(o){user.set("specialWorldNewTasksAvailable",!1),$(".specialWorldShopBlock").removeClass("newTasksAvailable");var e=SpecialWorldShopWindow.getTasksGroup();if(e){o.addClass("group"+e);var t=_.where(Config.specialWorld.tasks,{group:e});_.each(t,function(e){var t=messages[Config.specialWorld.name+"Task"+e.id];if(console.assert(t,"    "+Config.specialWorld.name+"Task"+e.id),t){if(e.requiredTask&&!_.findWhere(user.get("specialworldtasks"),{id:e.requiredTask}))return;var i=$(".invisible .specialWorldTask").clone();i.addClass("task"+e.id).find(".taskTitle").html(t),i.find(".taskDescription").html(t),i.find(".amount").html(e.price),_.findWhere(user.get("specialworldtasks"),{id:e.id})?(i.hide(),i.addClass("completed")):Config.specialWorld.object.getGold()>=e.price?(i.find(".buyTask").attr("data-task",e.id),i.find(".buyTask").attr("id","buyTask"+e.id)):i.find(".buyTask").addClass("disabled"),i.appendTo(o.find(".tasks"))}},this)}o.find(".gold .amount").html(Config.specialWorld.object.getGold())},renderItems:function(e){user.get("specialworlditems");var t,i,o,a,n,r,s,l,d=this,c=function(e){return _.bind(function(){e.addClass("justCollected"),e.find(".icon").css("transform","scale(1.3)"),setTimeout(_.bind(function(){e.find(".icon").css("transform","scale(1)")},d),300)},d)},g=Config.specialWorld.items.collection;for(o=0;o<g.length;o++)s=g[o].id,l=g[o].category,i=Config.specialWorld.object.getItem(s),t=$(".invisible .specialWorldItem").clone(),this.itemId&&this.itemId==s&&setTimeout(c(t),1e3),t.attr("id","specialItem"+s),t.addClass("item"+s),t.attr("data-item",s),t.find(".button").attr("data-item",s),t.find(".status").html(i.amount),i&&i.amount&&t.addClass("collected"),t.addClass(g[o].section),t.appendTo(e.find(".block"+l).find(".section."+g[o].section));for(o=0;o<Config.specialWorld.items.prizes.length;o++){n=Config.specialWorld.items.prizes[o];var u=$(".invisible .specialWorldCollectBox").clone();for(this.canCollectPrize(n.id)?(u.addClass("collected"),u.find(".oneAltBtn").attr("data-prize",n.id)):(u.removeClass("collected"),u.find(".oneAltBtn").addClass("disabled")),a=0;a<n.required.length;a++)s=n.required[a],r=_.findWhere(Config.specialWorld.items.collection,{id:s}),i=Config.specialWorld.object.getItem(s),(t=$(".invisible .specialWorldItem").clone()).attr("id","specialItem"+s).addClass("item"+s).attr("data-item",s),i&&i.amount&&t.addClass("collected"),t.find(".amount .current").html(i.amount),t.addClass(r.section),t.appendTo(e.find(".block"+n.id));_.each(n.prize,_.bind(function(e){var t=$(".invisible .specialWorldPrize").clone();t.find(".amount").html(e.amount),-1!==_.indexOf(["addThreeMoves","unlimitedKeys","unlimitedLifes","starInField"],e.name)&&e.amount&&t.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),t.addClass("prize_"+e.cssClass).addClass(e.type).addClass(e.name),t.appendTo(u.find(".prizes"))}),this),u.appendTo(e.find(".block"+n.id))}},renderItemsOld:function(e){user.get("specialworlditems");var t,i,o,a,n,r,s=this,l=function(e){return _.bind(function(){e.addClass("justCollected"),e.find(".icon").css("transform","scale(1.3)"),setTimeout(_.bind(function(){e.find(".icon").css("transform","scale(1)")},s),300)},s)},d=Config.specialWorld.items.collection;for(o=0;o<d.length;o++)n=d[o].id,r=d[o].category,i=Config.specialWorld.object.getItem(n),t=$(".invisible .specialWorldItem").clone(),this.itemId&&this.itemId==n&&setTimeout(l(t),1e3),t.attr("id","specialItem"+n),t.addClass("item"+n),t.attr("data-item",n),t.find(".button").attr("data-item",n),i&&t.addClass("collected"),t.appendTo(e.find(".block"+r));for(o=0;o<Config.specialWorld.items.prizes.length;o++){var c=$(".invisible .specialWorldCollectBox").clone();if(this.canCollectPrize(o)?c.find(".oneAltBtn").attr("data-prize",o):this.isPrizeCollected(o)?(o?c.find(".oneAltBtn").hide():c.find(".oneAltBtn").addClass("disabled"),c.find(".prizesBlock").hide()):c.find(".oneAltBtn").addClass("disabled"),a=_.findWhere(Config.specialWorld.items.prizes,{category:o}),_.each(a.prize,_.bind(function(e){var t=$(".invisible .specialWorldPrize").clone();t.find(".amount").html(e.amount),-1!==_.indexOf(["addThreeMoves","unlimitedKeys","unlimitedLifes","starInField"],e.name)&&e.amount&&t.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),t.addClass("prize_"+e.cssClass).addClass(e.type).addClass(e.name),t.appendTo(c.find(".prizes"))}),this),window.mobile){var g=function(e,t){return function(){var e=$(".specialWorldCollectBox").find(".prizes");"show"==t?e.show():e.hide()}};c.on("touchstart",g(0,"show")),c.on("touchend",g(0,"hide"))}o?c.appendTo(e.find(".block"+o)):c.appendTo(e)}}});SpecialWorldShopWindow.getTasksGroup=function(){for(var t=user.get("specialworldtasks"),e=_.max(Config.specialWorld.tasks,function(e){return e.group}).group,i=function(e){return _.findWhere(t,{id:e.id})},o=1;o<=e;o++){var a=_.where(Config.specialWorld.tasks,{group:o});if(!_.every(a,i))return o}return o};var SpecialWorldForceView=Backbone.View.extend({events:{click:"close"},initialize:function(e){this.options=e||{},this.zindex=this.options.model&&this.options.model.get("zindex")?this.options.model.get("zindex"):-15,(!application.get("forceOpenNow")||this.options.ignoreForceOpenNow||this.model&&this.model.get("ignoreForceOpenNow"))&&this.$el.length&&this.$el.is(":visible")?setTimeout(_.bind(function(){application.set("forceOpenNow",!0),this.open()},this),100):setTimeout(_.bind(function(){this.stopListening(),this.undelegateEvents()},this),0)},open:function(){if(application.get("page")!==this.options.needPage)return application.windows.remove(),this.stopListening(),void this.undelegateEvents();this.shown=!0,$("#container").addClass("force");var e=parseInt($(".wrapper").css("width")),t=parseInt($(".wrapper").css("height")),i=parseInt(this.$el.css("width")),o=parseInt(this.$el.css("height"));if(this.model&&(this.model.get("additionalWidth")&&(i+=this.model.get("additionalWidth")),this.model.get("additionalHeight")&&(o+=this.model.get("additionalHeight"))),this.options.scrollEl){var a=$(this.options.scrollEl);a[0].scrollTo(0,0),a.css({overflow:"hidden"})}var n=this.$el.offset(),r=$(".blockedAnimations").offset();n.left=Math.round(n.left),n.top=Math.round(n.top),r.left=Math.round(r.left),r.top=Math.round(r.top),n.top-=r.top,n.left-=r.left;var s,l,d='<div class="fieldDisabledBaseForce"><div class="fieldDisabledContent"></div></div>',c=$(d);if(c.css({width:e+"px",height:n.top+"px",left:"0px",top:"0px"}),$(".blockedAnimations").append(c),(c=$(d)).css({width:e+"px",height:t-n.top-o+"px",left:"0px",top:n.top+o+"px"}),$(".blockedAnimations").css("z-index","30").append(c),(c=$(d)).css({width:n.left+"px",height:o+"px",left:"0px",top:n.top+"px"}),$(".blockedAnimations").append(c),(c=$(d)).css({width:e-n.left-i+"px",height:o+"px",left:n.left+i+"px",top:n.top+"px"}),$(".blockedAnimations").append(c),this.model?(s=this.model.get("name"),l=this.model.get("textId")?this.model.get("textId"):this.model.get("name")):(s=this.options.name,l=this.options.name),!this.model||!this.model.get("notNeedDisabledBg")){c=$(d);var g=this.$el.position();c.css({width:i+"px",height:o+"px",left:parseInt(g.left)+"px",top:parseInt(g.top)+"px","z-index":this.zindex}),c.addClass(s+"Button"),this.$el.before(c)}$("#force").removeClass().addClass(s);var u=messages.ForceTexts[l];$("#force .forceText").html($("<div class='text'>").html(u)),$(".fieldDisabledBaseForce").fadeIn(300),setTimeout(_.bind(function(){this.opened=!0,$(".levelAnimation").hide(),$("#force").show(),this instanceof SpecialWorldForceWithButtonView||((c=$('<div class="fieldDisabledArrow"><div class="fieldDisabledArrowContent"></div></div>')).addClass(s+"Arrow"),c.css({left:n.left+Math.floor(i/2)+"px",top:n.top+"px"}),$(".blockedAnimations").append(c),!this.model.get("window")||application.windows.anyVisibleWindow()&&application.windows.isOpen(this.model.get("window"))||this.close())},this),300)},close:function(){if(this.opened){if(this.opened=!1,this.options.scrollEl)$(this.options.scrollEl).css({overflow:"auto"});$(".blockedAnimations").empty(),$(".fieldDisabledArrow").remove(),$(".fieldDisabledBaseForce").fadeOut(300),$("#force").hide(),$(".levelAnimation").show(),$("#container").removeClass("force"),this.$el.css("pointer-events","none"),setTimeout(_.bind(function(){this.$el.css("pointer-events","auto"),$(".fieldDisabledBaseForce").remove(),this.stopListening(),this.undelegateEvents(),this.model&&(this.model.done(),this.model.get("addZIndex")&&this.$el.css("z-index",this.currentZIndex),this.model.get("addCssClass")&&this.$el.removeClass(this.model.get("addCssClass"))),this.options.addCssClass&&this.$el.removeClass(this.options.addCssClass),application.set("forceOpenNow",!1)},this),300)}}}),SpecialWorldForceWithButtonView=SpecialWorldForceView.extend({events:{},initialize:function(e){e.customizeView&&(this.customizeView=e.customizeView),this.keydown=_.bind(this.keydown,this),this.closeForce=_.bind(this.closeForce,this),SpecialWorldForceView.prototype.initialize.apply(this,arguments)},open:function(){SpecialWorldForceView.prototype.open.call(this),this.$button=$('<div class="forceButton"></div>'),this.$button.html(messages.ForceButtonTexts.Okay),this.$button.on("click touchend",this.closeForce),$("body").on("keydown",this.keydown),$("#force .forceText").append(this.$button),this.customizeView&&this.customizeView(this)},keydown:function(e){27===e.keyCode&&this.closeForce()},closeForce:function(){return this.$button&&(this.$button.off(),$("body").off("keydown",this.keydown),this.close()),!1}}),SpecialWorldForces={running:!1,forces:[{type:"main",element:"#buyTask",view:BaseForceView,zindex:1,talk:2,level:1},{type:"main",element:"#startLevel",view:BaseForceView,zindex:1,talk:4,level:1},{type:"main",element:"#artifactWorkshopButton",view:BaseForceView,zindex:1,level:3,isAvailable:function(){return Config.bonusWorld.has("artifactWorkshop")}},{type:"main",element:".button.button1",view:SpecialWorldForceView,zindex:-1,level:3,isAvailable:function(){return Config.bonusWorld.has("artifactWorkshop")}},{type:"main",element:".artifact.artifact1 .artifactPartsBlock",view:SpecialWorldForceView,scrollEl:".artifactsContainer",win:Artifacts.ArtifactCollectionWindow,timeout:300,zindex:-1,level:3,isAvailable:function(){return Config.bonusWorld.has("artifactWorkshop")}}],isAvailable:function(e){if(window.mobile)return!1;var t=user.get("specialworldforce")||0,i=SpecialWorldForces.forces[t];return!i||!i.win||application.windows.anyVisibleWindow()&&application.windows.isOpen(i.win)||!application.windows.anyVisibleWindow()||application.windows.isOpen(SpecialWorldShopWindow)?!(t<0||t>=SpecialWorldForces.forces.length)||(Config.bonusWorld.trigger("specialWorldForces",!1),!1):(application.windows.runAfterCloseAllWindows(function(){SpecialWorldForces.run(e)}),!1)},run:function(e){if(SpecialWorldForces.running=!0,SpecialWorldForces.isAvailable(e)){var t=user.get("specialworldforce")||0,i=SpecialWorldForces.forces[t];if(!(!i||i.type&&i.type!=e||i.level&&i.level!=user.get("specialworldprogress")||i.talk&&!Config.specialWorld.object.hasTalk(i.talk)||i.isAvailable&&!i.isAvailable()))return Config.bonusWorld.trigger("specialWorldForces",!0),i.name=Config.specialWorld.name+"Force"+t,i.timeout?void setTimeout(function(){new SpecialWorldForce(i)},i.timeout):void new SpecialWorldForce(i);Config.bonusWorld.trigger("specialWorldForces",!1)}SpecialWorldForces.running=!1}},SpecialWorldForce=BaseForce.extend({defaults:{id:!1,name:!1,view:BaseForceView,needPage:"main"},done:function(){SpecialWorldForces.running=!1,Config.bonusWorld.updateData({force:!0}),SpecialWorldForces.run(this.get("type"))},afterCreateViewOption:function(e){e.scrollEl=this.get("scrollEl"),e.element=this.get("element")},initialize:function(){this.process()},getEl:function(){return $(this.get("element"))}}),SpecialWorldTalks={findAvailableTalkGroup:function(){var e=Config.specialWorld.talks.find(function(e){return!e.event&&this.canShow(e)},this);return!!e&&e.id},canShow:function(e){var t=user.get("specialworldtalks")||[],i=episode.scores.length+1;if(void 0!==e.battlePass&&e.battlePass!==Config.specialWorld.object.get("battlePass"))return!1;if(-1!==_.indexOf(t,e.id))return!1;if(e.level&&i<e.level)return!1;if(e.task&&!_.findWhere(user.get("specialworldtasks"),{id:e.task}))return!1;if(e.taskGroup&&SpecialWorldShopWindow.getTasksGroup()<=e.taskGroup)return!1;if(void 0!==e.option&&_.findWhere(user.get("specialworldtasks"),{id:e.task}).option!=e.option)return!1;return!0},openTaskOptions:function(t,i){var o=new SpecialWorldTaskWindow({task:t});o.once("close",function(e){o.isCompleted&&(t.optionsShown=!0,SpecialWorldTalks.run(i))})},findTalkByEvent:function(e){return _.findWhere(Config.specialWorld.talks,{event:e})},process:function(e,t,i){if(e=e||0,!(t=t||SpecialWorldTalks.findAvailableTalkGroup()))return void 0!==SpecialWorldForces&&SpecialWorldForces.run("main"),void(!Config.specialWorld.object.get("completed")&&Config.specialWorld.object.get("levelsCompleted")&&Config.specialWorld.object.get("tasksCompleted")&&(Config.specialWorld.object.set("completed",!0),Config.specialWorld.object.onCompleteBonusWorld(!0)));var o,a=_.findWhere(Config.specialWorld.talks,{id:t}),n=Config.specialWorld.name+"Talk"+t;if(messages[n+"battlePass"]&&Config.specialWorld.object.get("hasBattlePass")&&(n+="battlePass"),a.task&&(o=_.findWhere(Config.specialWorld.tasks,{id:a.task})),o&&o.options&&(!o.optionsTalk&&0===e||o.optionsTalk===t-1&&0===e)&&!o.optionsShown)this.openTaskOptions(o,e);else{for(var r=$("#map .specialworld"),s=0;s<=e;s++)r.removeClass("id"+s);if(r.removeClass("group"+t),messages[n]&&messages[n][e]){var l=i?"delay"in a?a.delay:1e3:0;if(l){var d=$("#main"),c=$('<div class="lockScreen">').css({position:"absolute",left:0,top:0,width:parseInt(d.width())+"px",height:parseInt(d.height())+"px",opacity:0,"z-index":1e3}).appendTo(d);setTimeout(function(){c.remove(),new SpecialWorldTalkWindow({id:e,group:t,talk:a})},l)}else new SpecialWorldTalkWindow({id:e,group:t,talk:a})}else Config.bonusWorld.updateData({talk:t}),a.task&&r.find(".task"+a.task).addClass("talk"+t+"Finished"),o&&Config.bonusWorld.isTasksTalksFinished(a.task)&&(o.onAllTalksFinished&&o.onAllTalksFinished(),r.find(".task"+a.task).addClass("allTalksFinished")),a.onComplete&&a.onComplete(),Config.specialWorld.addClass(a,"addClassOnComplete"),o&&o.initialTalk&&o.initialTalk==a.id&&new SpecialWorldTaskWindow({task:_.findWhere(Config.specialWorld.tasks,{id:a.task})}),SpecialWorldTalks.run(void 0,void 0,i)}},run:function(e,t,i){SpecialWorldTalks.disabled||("main"==application.get("page")?SpecialWorldTalks.process(e,t,i):application.once("main",function(){SpecialWorldTalks.process(e,t)},this))}},SpecialWorldTalkWindow=TWindow.extend({templateClass:".specialWorldTalkWindow_template",events:{"click .close":"close"},getTalk:function(){return _.findWhere(Config.specialWorld.talks,{id:this.options.group})},closeAnimation:function(e){this.$el.hide(),setTimeout(e,0)},openAnimation:function(){this.$el.show(),$("#windowShadow").show().css("opacity",1)},onClose:function(){this.timer&&clearInterval(this.timer),$("body").off("mouseup touchend",_.bind(this.complete,this));var e=this.getTalk();e&&e.onWindowClose&&e.onWindowClose(this.options.id),SpecialWorldTalks.run(this.options.id+1,this.options.group,!0),TWindow.prototype.onClose.call(this)},animateText:function(){this.timer&&this.text.length!=this.message.length?(this.text=this.message.substr(0,this.text.length+1),this.$el.find(".content").html(this.text)):this.timer&&(clearInterval(this.timer),this.timer=null)},complete:function(){this.timer?(this.text=this.message,this.$el.find(".content").html(this.text),clearInterval(this.timer),this.timer=null):this.isLastMessage?this.close():this.showNextTalk()},open:function(){this.options.talk&&this.options.talk.animationBeforeStart?AnimationManager.createInstance().playAll(this.options.talk.animationBeforeStart).then(_.bind(TWindow.prototype.open,this)):TWindow.prototype.open.call(this)},close:function(){this.options.talk&&this.options.talk.animationAfterComplete?(this.$el.hide(),this._bindComplete&&$("body").off("mouseup touchend",this._bindComplete)):TWindow.prototype.close.call(this)},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.getTalk();e.onMessage&&e.onMessage(this.options.id,this),this._bindComplete=_.bind(this.complete,this),$("body").on("mouseup touchend",this._bindComplete),this.showTalk()},showTalk:function(){this.message="";var e=Config.specialWorld.name+"Talk"+this.options.group,o=messages[Config.specialWorld.name+"Characters"];messages[e+"battlePass"]&&Config.specialWorld.object.get("hasBattlePass")&&(e+="battlePass"),messages[e]&&messages[e][this.options.id]&&(this.message=messages[e][this.options.id],this.isLastMessage=this.options.id===messages[e].length-1);var t="";if(-1!==this.message.indexOf(":")){var i=[this.$(".mCharactersLeft"),this.$(".mCharactersRight")],a=this.message.indexOf(":");t=this.message.substr(0,a),this.message=this.message.substr(a+1);var n,r=-1!==t.indexOf(">"),s=-1!==t.indexOf("<");r||s?n=t.split(r?">":"<"):(r=!0,n=[t,"none"]),i.forEach(function(e,t){var i=e.find(".character");i.hasClass(n[t])||i.removeClass().addClass("character").addClass(n[t]),i.find(".name").html(o[n[t]]||"")}),this.$(".mCharactersLeft").toggleClass("active",r),this.$(".mCharactersRight").toggleClass("active",s)}this.message&&(this.text="",this.timer=setInterval(_.bind(this.animateText,this),100),this.$el.addClass("group"+this.options.group),this.$el.addClass("id"+this.options.id),$("#map .specialworld").addClass("group"+this.options.group).addClass("id"+this.options.id))},showNextTalk:function(){this.$el.removeClass("id"+this.options.id),$("#map .specialworld").removeClass("id"+this.options.id),this.options.id++,this.showTalk()}}),YLe,ZLe;SpecialWorldTaskWindow.prototype.onClose=(YLe=SpecialWorldTaskWindow.prototype.onClose,function(){YLe.call(this),this.trigger("close")}),SpecialWorldShopWindow.prototype.onClose=(ZLe=SpecialWorldShopWindow.prototype.onClose,function(){ZLe.call(this),SpecialWorldTalks.run()}),_.extend(SpecialWorldTalks,Backbone.Events),SpecialWorldTalks.on("all",function(e){var t=this.findTalkByEvent(e);t&&this.canShow(t)&&!this.isShownByEvent&&(this.isShownByEvent=!0,this.process(0,t.id))},SpecialWorldTalks);var PirateBirthdayCooking=BonusWorld.extend({defaults:_.defaults({name:"piratebirthdaycooking",viewId:DeliciousAdventureView,version:20230904,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:16,showTimer:!1,minEpisodeToEnter:1,minLevelToEnter:24,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,finishPrize:{type:"finalPrize",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"24h"}]},livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},noArtifactPartOnReplay:!1,progressComponent:ProgressSimpleIncrementComponent},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";UserPrizes.convertFromCocos(this.get("finishPrize")),this.prizeController=this.addComponent(PrizeController,{world:this,viewClass:PrizeControllerViewLite,pointEvents:[50,75],accountant:new PrizeProgressAccount([30,80,100,150,200,240,100,200,150,100,220,120,100,150,100,250,80,180,150,300]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"ContinuityStageProduct",stage:3}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"60m"}]},{progress:7,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2},{type:"ContinuityStageProduct",stage:3}]},{progress:9,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:10,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2}]},{progress:12,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"ContinuityStageProduct",stage:3}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2},{type:"GoodProduct",goodId:i,addTime:"30m"},{type:"ContinuityStageProduct",stage:3}]},{progress:17,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:18,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:19,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"CoinsProduct",amount:2e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"48h"}]}]}),this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.TRASH},{id:6,material:PartMaterial.TRASH},{id:7,material:PartMaterial.TRASH},{id:8,material:PartMaterial.TRASH},{id:9,material:PartMaterial.TRASH},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.NORMAL},{id:12,material:PartMaterial.NORMAL},{id:13,material:PartMaterial.NORMAL},{id:14,material:PartMaterial.NORMAL},{id:15,material:PartMaterial.NORMAL},{id:16,material:PartMaterial.NORMAL},{id:17,material:PartMaterial.RARE},{id:18,material:PartMaterial.RARE},{id:19,material:PartMaterial.RARE},{id:20,material:PartMaterial.RARE},{id:21,material:PartMaterial.RARE},{id:22,material:PartMaterial.LEGEND},{id:23,material:PartMaterial.LEGEND},{id:24,material:PartMaterial.LEGEND},{id:25,material:PartMaterial.LEGEND}]}),this.addComponent(ForgeComponent,{recipes:[{id:1,group:1,ingredients:[this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(5,3),this.cmp("parts").ingredient(16),this.cmp("parts").ingredient(17)],prizes:[{products:[{type:"PrizePointsProduct",amount:35}]}]},{id:2,group:1,ingredients:[this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(7,2),this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(17,2),this.cmp("parts").ingredient(18,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:3,group:1,ingredients:[this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(19,2),this.cmp("parts").ingredient(20),this.cmp("parts").ingredient(22)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:4,group:2,ingredients:[this.cmp("parts").ingredient(1,4),this.cmp("parts").ingredient(6,4),this.cmp("parts").ingredient(14,1),this.cmp("parts").ingredient(23,1)],prizes:[{products:[{type:"PrizePointsProduct",amount:50}]}]},{id:5,group:2,ingredients:[this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(19,1),this.cmp("parts").ingredient(20,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:6,group:2,ingredients:[this.cmp("parts").ingredient(1,4),this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(23,1)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:7,group:3,ingredients:[this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(12,2),this.cmp("parts").ingredient(15,3),this.cmp("parts").ingredient(16,3),this.cmp("parts").ingredient(19,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:110}]}]},{id:8,group:3,ingredients:[this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(4,2),this.cmp("parts").ingredient(12,3),this.cmp("parts").ingredient(19,3),this.cmp("parts").ingredient(22,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:120}]}]},{id:9,group:3,ingredients:[this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(12,2),this.cmp("parts").ingredient(15,3),this.cmp("parts").ingredient(17,2),this.cmp("parts").ingredient(22)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]},{id:10,group:4,ingredients:[this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(7,4),this.cmp("parts").ingredient(8,3),this.cmp("parts").ingredient(12,2),this.cmp("parts").ingredient(18,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:11,group:4,ingredients:[this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(7,3),this.cmp("parts").ingredient(8,3),this.cmp("parts").ingredient(18,3),this.cmp("parts").ingredient(23)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:12,group:4,ingredients:[this.cmp("parts").ingredient(2,4),this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(7,3),this.cmp("parts").ingredient(22,2),this.cmp("parts").ingredient(23)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:13,group:5,ingredients:[this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(3,4),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(19),this.cmp("parts").ingredient(20,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:14,group:5,ingredients:[this.cmp("parts").ingredient(2,5),this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(16,2),this.cmp("parts").ingredient(23)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:15,group:5,ingredients:[this.cmp("parts").ingredient(1,4),this.cmp("parts").ingredient(15,3),this.cmp("parts").ingredient(16,2),this.cmp("parts").ingredient(23)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:16,group:6,ingredients:[this.cmp("parts").ingredient(8,5),this.cmp("parts").ingredient(11,2),this.cmp("parts").ingredient(13,2),this.cmp("parts").ingredient(24,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:17,group:6,ingredients:[this.cmp("parts").ingredient(10,2),this.cmp("parts").ingredient(11,4),this.cmp("parts").ingredient(13,2),this.cmp("parts").ingredient(21,2),this.cmp("parts").ingredient(25,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:140}]}]},{id:18,group:6,ingredients:[this.cmp("parts").ingredient(10,2),this.cmp("parts").ingredient(11,3),this.cmp("parts").ingredient(21,2),this.cmp("parts").ingredient(24),this.cmp("parts").ingredient(25,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:130}]}]},{id:19,group:7,ingredients:[this.cmp("parts").ingredient(5,3),this.cmp("parts").ingredient(8,2),this.cmp("parts").ingredient(13,2),this.cmp("parts").ingredient(24,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:20,group:7,ingredients:[this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(10,3),this.cmp("parts").ingredient(13,2),this.cmp("parts").ingredient(22,2),this.cmp("parts").ingredient(24)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]},{id:21,group:7,ingredients:[this.cmp("parts").ingredient(5,3),this.cmp("parts").ingredient(10,2),this.cmp("parts").ingredient(13),this.cmp("parts").ingredient(21,3),this.cmp("parts").ingredient(25,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:120}]}]},{id:22,group:8,ingredients:[this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(9,3),this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(15,2),this.cmp("parts").ingredient(20,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:23,group:8,ingredients:[this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(9,4),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(18,2),this.cmp("parts").ingredient(20,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:24,group:8,ingredients:[this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(9,3),this.cmp("parts").ingredient(12,2),this.cmp("parts").ingredient(22,2),this.cmp("parts").ingredient(23,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]}]});var o=[{products:[{type:"PartProduct",partId:1}]},{products:[{type:"PartProduct",partId:2}]},{products:[{type:"PartProduct",partId:3}]},{products:[{type:"PartProduct",partId:4}]},{products:[{type:"PartProduct",partId:5}]},{products:[{type:"PartProduct",partId:6}]},{products:[{type:"PartProduct",partId:7}]},{products:[{type:"PartProduct",partId:8}]},{products:[{type:"PartProduct",partId:9}]}],a=[{products:[{type:"PartProduct",partId:10}]},{products:[{type:"PartProduct",partId:11}]},{products:[{type:"PartProduct",partId:12}]},{products:[{type:"PartProduct",partId:13}]},{products:[{type:"PartProduct",partId:14}]},{products:[{type:"PartProduct",partId:15}]},{products:[{type:"PartProduct",partId:16}]}],n=[{products:[{type:"PartProduct",partId:17}]},{products:[{type:"PartProduct",partId:18}]},{products:[{type:"PartProduct",partId:19}]},{products:[{type:"PartProduct",partId:20}]},{products:[{type:"PartProduct",partId:21}]}];this.addComponent(BonusWorldContinuityComponent,{specialPrizes:[{rule:function(){return 2===t.getCurrentLevel()},prize:new SimplePrizeCreater({name:"first_basket",products:[{type:"PartProduct",partId:1},{type:"PartProduct",partId:2},{type:"PartProduct",partId:4},{type:"PartProduct",partId:6}]})}],prizes:[{stage:1,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a})]})},{stage:2,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:n})]})},{stage:3,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:n}),new RandomPrizeCreater({variants:n}),new RandomPrizeCreater({variants:[{products:[{type:"PartProduct",partId:22}]},{products:[{type:"PartProduct",partId:23}]},{products:[{type:"PartProduct",partId:24}]},{products:[{type:"PartProduct",partId:25}]}]})]})}]}),this.addComponent(RecipeGroupComponent,{forge:this.cmp("forge"),groups:[{id:1,recipes:[{id:1},{id:2},{id:3}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]}]},{id:2,recipes:[{id:4},{id:5},{id:6}],prizes:[{products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]}]},{id:3,recipes:[{id:7},{id:8},{id:9}],prizes:[{products:[{type:"CoinsProduct",amount:300}]}]},{id:4,recipes:[{id:10},{id:11},{id:12}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]}]},{id:5,recipes:[{id:13},{id:14},{id:15}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]}]},{id:6,recipes:[{id:16},{id:17},{id:18}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]}]},{id:7,recipes:[{id:19},{id:20},{id:21}],prizes:[{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}]},{id:8,recipes:[{id:22},{id:23},{id:24}],prizes:[{products:[{type:"CoinsProduct",amount:150},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.piratebirthdaycooking .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.piratebirthdaycooking .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.piratebirthdaycooking .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.piratebirthdaycooking .animationSprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.piratebirthdaycooking",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.piratebirthdaycooking",persistentClass:"hidden"}]},{type:StoryGroup,once:"onCompleteLevel1",noRetry:!0,id:210,stories:[{type:StoryTalkElement,talkKey:5,owner:this},{type:StoryForceElement,el:".piratebirthdaycooking .continuityButton",name:"forgeForce0"},{type:StoryForceElement,el:".piratebirthdaycooking_content .recipeGroupsWrapper",name:"forgeForce1",delayAfter:0},{type:StoryForceElement,el:".piratebirthdaycooking_content .prizeControllerOuterProgressBar",name:"forgeForce3"}]},{id:211,type:StoryForceElement,name:"forgeForce2",once:"recipeReady",owner:this.cmp("forge"),scroller:new Scroller(".recipeGroupsWrapper"),buttonEl:".assembleBtn",init:function(){var e=t.cmp("forge").getRecipes().find(function(e){return e.canCraft()});return{scrollTo:".".concat(t.get("name"),"_content .recipeGroupsWrapper .recipeBlock.recipe").concat(e.get("id")),el:".".concat(t.get("name"),"_content .recipeGroupsWrapper .recipeBlock.recipe").concat(e.get("id"))}}},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize1",talkKey:6},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize2",talkKey:7},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize3",talkKey:8},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize4",talkKey:9},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize5",talkKey:10},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize6",talkKey:11},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize7",talkKey:12},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize8",talkKey:13},{type:StoryTalkElement,on:"pointsProgress50",talkKey:14},{type:StoryTalkElement,on:"pointsProgress75",talkKey:15},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize20",talkKey:16},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize20",params:{noTakePrize:!0,groupPrize:!0,prize:this.prizeController.getPrizeByProgress(this.prizeController.getMaxProgress()).prize},delayAfter:0,id:205},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevelAfterDelay80",params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0,publicationOff:!0},delayAfter:0,id:206},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onCompleteLevelAfterDelay80",delayAfter:0,id:207},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.piratebirthdaycooking .startCurrentLevel",name:"firstLevelForce",id:200}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.DropByContinuityComponent,id:4,rewardAd:Config.adsRewards.get("basketArtefact"),stage:1},{dropType:Artifacts.DropByContinuityComponent,id:3,coins:800,stage:3},{dropType:Artifacts.DropByContinuityComponent,id:2,coins:600,stage:2},{dropType:Artifacts.DropByContinuityComponent,id:1,coins:300,stage:1}]}),this.addComponent(ActionWorldComponent,{worldEvents:["prizeControllerAfterTakePrize"],rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()})}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:60,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ReturnWorldComponent)},episodeChanged:function(){return!0},openPrizeControllerInfo:function(){new WorldInfo({world:this})},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this;BonusWorld.prototype.onCompleteBonusWorldLevelBeforeStatistic.call(this,e,t),application.waitPage("main").then(function(){return delay(500)}).then(function(){return i.trigger("onCompleteLevelAfterDelay"+e,i,e,t)})}}),tMe,xMe,yMe;PearlCell.prototype.animateTakeLife=(tMe=PearlCell.prototype.animateTakeLife,function(e){if("piratebirthdaycooking"!==episode.get("num"))return tMe.call(this,e);if(0<this.life)for(var t=1;t<=3;t++){var i=GameBaseView.createFallDownExplodePiece("iceExplode","iceExplode".concat(t));i.alignTo(this.$div),gameView.fallDownExplodePiece(i)}this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}),figureRulesProcess.piratebirthdaycookingBonusClasses=function(){FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratebirthdaycooking/artifactPart.2f6f17533a.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_piratebirthdaycooking .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("piratebirthdaycooking","attribute_teacup"),featuresAdder.addFeature("piratebirthdaycooking","iceberg_berry"),featuresAdder.addFeature("piratebirthdaycooking","frozenegg_berry"),featuresAdder.addFeature("piratebirthdaycooking","floor_flour"),featuresAdder.addFeature("piratebirthdaycooking","spiderwebfarm2"),featuresAdder.addFeature("piratebirthdaycooking","coinchest_candychest"),featuresAdder.addFeature("piratebirthdaycooking","boy_chef"),featuresAdder.addFeature("piratebirthdaycooking","crabmedusa_snail"),featuresAdder.addFeature("piratebirthdaycooking","caviar_jellybear"),featuresAdder.addFeature("piratebirthdaycooking","pearl_frozenfish"),featuresAdder.addFeature("piratebirthdaycooking","mermaid_oven"),featuresAdder.addFeature("piratebirthdaycooking","bug_cake"),featuresAdder.addFeature("piratebirthdaycooking","ground_sweetdish"),featuresAdder.addFeature("piratebirthdaycooking","chocolate_dough"),featuresAdder.addFeature("piratebirthdaycooking","strongbox_candysafe"),FigureRules.add(".episode_piratebirthdaycooking .fish5.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratebirthdaycooking/dropcell_flour.f2ceda3e0c.png"})},figureRulesProcess.additionalBonusScaleImages=(xMe=figureRulesProcess.additionalBonusScaleImages,function(){xMe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/piratebirthdaycooking/artifactPart.2f6f17533a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratebirthdaycooking/dropcell_flour.f2ceda3e0c.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(yMe=figureRulesProcess.additionalBonusClasses,function(){yMe.call(this),figureRulesProcess.piratebirthdaycookingBonusClasses()});var BeachTreasuresView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this)},onEnter:function(){var e=this;BonusWorldView.prototype.onEnter.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onCompleteLevel:function(){var e=this;BonusWorldView.prototype.onCompleteLevel.call(this),application.waitPage("main").then(function(){setTimeout(function(){return e.scrollToTargetLevel()},500)})},onGameFailed:function(){var e=this;episode.isBonusWorld()&&"beachtreasures"===episode.getEpisodeName()&&"game"===application.get("page")&&application.once("main",function(){setTimeout(function(){return e.scrollToTargetLevel()},1e3)},this)},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1))}}),BeachTreasures=BonusWorld.extend({defaults:_.defaults({name:"beachtreasures",viewId:BeachTreasuresView,version:20230818,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:6,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime3",skipLevelPublication:!0,actionQueue:new ActionQueue,alwaysCancelNext:!1,prizes:[{smallPrize:!0,type:"middlePrize",level:1,prize:[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:2,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:3,prize:[{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1}]},{smallPrize:!0,type:"middlePrize",level:4,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:5,prize:[{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{smallPrize:!0,type:"middlePrize",level:6,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:7,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:8,prize:[{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1}]},{smallPrize:!0,type:"middlePrize",level:9,prize:[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.25}]},{type:"middlePrize",level:10,prize:[{type:"coins",amount:200},{type:"good",name:"starInField",cssClass:"starInField",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:11,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:12,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:13,prize:[{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1}]},{smallPrize:!0,type:"middlePrize",level:14,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:15,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:16,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:17,prize:[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:18,prize:[{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1}]},{smallPrize:!0,type:"middlePrize",level:19,prize:[{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:20,prize:[{type:"coins",amount:300},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{smallPrize:!0,type:"middlePrize",level:21,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:22,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:23,prize:[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:24,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:25,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.25}]},{smallPrize:!0,type:"middlePrize",level:26,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:27,prize:[{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1}]},{smallPrize:!0,type:"middlePrize",level:28,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{smallPrize:!0,type:"middlePrize",level:29,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"coins",amount:500},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:2},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",params:{silent:!0}},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",scrollTo:"#level1",delayBefore:1e3,delayAfter:1e3,id:211,elements:[]},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.beachtreasures .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,once:"winLevel1",talkKey:2},{type:StoryTalkElement,owner:this,once:"winLevel3",talkKey:3},{type:StoryTalkElement,owner:this,once:"winLevel10",talkKey:4},{type:StoryTalkElement,owner:this,once:"winLevel20",talkKey:5},{type:StoryTalkElement,owner:this,once:"winLevel30",talkKey:6},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"takeMiddlePrize30",id:210}]}),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 1<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)}}),PMe,QMe;figureRulesProcess.beachtreasuresBonusClasses=function(){featuresAdder.addFeature("beachtreasures","episodecollectiondroppable"),FigureRules.add(".episode_beachtreasures .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/beachtreasures/special8.25a966c9be.png"}),featuresAdder.addFeature("beachtreasures","dropcell_rustyanchorcell"),featuresAdder.addFeature("beachtreasures","chocolate_seaweed"),featuresAdder.addFeature("beachtreasures","chocolatefarm_chocolatefarmcocos")},figureRulesProcess.additionalBonusClasses=(PMe=figureRulesProcess.additionalBonusClasses,function(){PMe.call(this),figureRulesProcess.beachtreasuresBonusClasses()}),figureRulesProcess.additionalBonusScaleImages=(QMe=figureRulesProcess.additionalBonusScaleImages,function(){QMe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/beachtreasures/special8.25a966c9be.png":_Figure.scaleKoef})});var RoyalTreasuryView=function(e){_inherits(i,BaseWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){_get(_getPrototypeOf(i.prototype),"initialize",this).call(this,e,t),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.tickets=this.model.getComponent("tickets"),this.addView(ChestsAndKeysView,{el:$('<div class="chestsAndKeys"></div>'),model:this.model.getComponent("chestsAndKeys"),world:this.model}),this.addView(WorldInfoButton,{el:$(".mainTemplates .ticketsInfoButton").clone(),model:this.model},"ui"),this.addView(TicketsView,{el:$(".mainTemplates > .tickets").clone(),model:this.model.cmp("tickets")},"ui"),this.addView(StartLevelView,{el:$(".mainTemplates .bonusWorldUI .startCurrentLevel").clone(),model:this.model.cmp("levels"),rules:this.model.cmp("levels")},"ui")}}]),i}(),RoyalTreasury=function(e){_inherits(r,BaseWorld);var n=_createSuper(r);function r(e){var i;_classCallCheck(this,r),(i=n.call(this,e)).addComponent(WorldDataComponent),i.addComponent(MainLevelsComponent),i.ticketComponent=i.addComponent(TicketsComponent,{name:i.get("name")}),i.addComponent(TriesComponent,{conditioner:TriesConditionerPresets.alwaysTrue,showCogentWindowOnFail:!1,reminderWindowThreshold:1/0,validatorGame:function(e,t){return(!episode.isBonusWorld()||Config.bonusWorld.get("isFreeEpisode"))&&t.currentLevel()&&i.get("active")&&i.isAvailability()&&i.isAvailabilityEnter()&&!i.cmp("chestsAndKeys").completed()},variants:[{tries:1,prizes:[{type:"TicketsProduct",amount:3,componentId:"tickets",world:i.world}]},{tries:2,prizes:[{type:"TicketsProduct",amount:2,componentId:"tickets",world:i.world}]},{tries:1/0,prizes:[{type:"TicketsProduct",amount:1,componentId:"tickets",world:i.world}]}]});var t=i.addComponent(PrizePoolsComponent,{prizePools:[new PrizePool(_assertThisInitialized(i),{selectPrizeStrategy:new RandomWeighedStrategy,prizes:[{id:1,chance:0,products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]},{id:2,chance:10,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{id:3,chance:10,products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{id:4,chance:5,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{id:5,chance:5,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{id:6,chance:15,products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]},{id:7,chance:5,products:[{type:"SpinProduct",amount:1}]},{id:8,chance:30,products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{id:9,chance:20,products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]}]}),new PrizePool(_assertThisInitialized(i),{selectPrizeStrategy:new RandomWeighedStrategy,prizes:[{id:10,chance:20,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{id:11,chance:15,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{id:12,chance:20,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]},{id:13,chance:10,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]},{id:14,chance:5,products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{id:15,chance:30,products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]}]}),new PrizePool(_assertThisInitialized(i),{selectPrizeStrategy:new RandomWeighedStrategy,prizes:[{id:16,chance:15,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{id:17,chance:5,products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]},{id:18,chance:35,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{id:19,chance:25,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1}]},{id:20,chance:20,products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]}]})]}).get("prizePools"),o=i.initOffersDeskComponent(t),a=i.addComponent(ChestsAndKeysComponent,{offers:o,stages:[{offerIds:["offer1","offer2","offer3","offer4","offer5","offer6","offer7","offer8","offer9"],prizePool:t[0],finalPrize:new Prize({name:"".concat(i.get("name"),".chest1"),products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]})},{offerIds:["offer10","offer11","offer12","offer13","offer14","offer15"],prizePool:t[1],finalPrize:new Prize({name:"".concat(i.get("name"),".chest2"),products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"2h"}]})},{offerIds:["offer16","offer17","offer18","offer19","offer20"],prizePool:t[2],finalPrize:new Prize({name:"".concat(i.get("name"),".chest3"),products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"}]})}],specialPrizes:[{offerId:"offer1",prizeId:1}]});return i.addComponent(StoryController,{name:i.get("name"),world:_assertThisInitialized(i),actionQueue:i.actionQueue,stories:[{type:StoryCallbackElement,page:"main",on:"start",callback:function(){return i.showEnterForce()},id:1},{type:StoryGroup,id:2,once:"enter",owner:_assertThisInitialized(i),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,delayAfter:0,params:{world:_assertThisInitialized(i)}},{type:StoryTalkElement,owner:_assertThisInitialized(i),talkKey:1},{type:StoryForceElement,owner:i.getComponent(OffersDeskComponent),noRetry:!0,page:i.getPageName(),el:".world.".concat(i.getName()," .offer1 .mBuyBtn"),name:i.get("name")+"Force2",inWorld:!1,isAvailable:function(){return 0===i.getComponent(OffersDeskComponent).getOfferById("offer1").get("countPay")}},{type:StoryForceElement,el:".world.royaltreasury .ui .startCurrentLevel",name:i.get("name")+"Force1",page:i.getPageName(),inWorld:!1}]},{type:StoryTalkElement,owner:a,once:"beforeStage1Completed",talkKey:2,id:3},{type:StoryTalkElement,owner:a,once:"beforeStage2Completed",talkKey:3,id:4},{type:StoryTalkElement,owner:a,once:"beforeStage3Completed",talkKey:4,id:5},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:a,once:"afterStage3Completed",id:200}]}),i.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!a.completed()}),offerId:"saleWorld4",daysAgo:1,minLevel:0}),i.addComponent(TimekeeperComponent,{originDate:i.get("originDate"),duration:i.get("duration"),cooldown:i.get("cooldown")}),i.addComponent(TakePrizeAnimationComponent,{world:_assertThisInitialized(i),page:"main",container:function(){return $("#map")},componentsId:["tries"],animationConfig:{TicketsProduct:{target:function(){return $("#bonusworldListButton")},duration:1500}}}),i}return _createClass(r,[{key:"initOffersDeskComponent",value:function(i){var o=this,a=[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2],e=[0,5,5,5,5,5,5,5,5,10,10,10,10,10,10,16,16,16,16,16].map(function(e,t){return{id:"offer"+(t+1),price:e,supply:1,paymentAdapter:o.getComponent("tickets"),products:[{type:"PrizePoolProduct",prizePool:i[a[t]]}]}});return this.addComponent(OffersDeskComponent,{forceOfferId:"offer1",offers:e,takePrizeDisabled:!0,forceByStories:!0})}},{key:"showEnterForce",value:function(){new BonusWorldForce({world:this,eventFunctionActivator:function(){this.startEvent(user,!0)}})}}]),r}(),vNe;RoyalTreasury.prototype.defaults=_.defaults({name:"royaltreasury",view:RoyalTreasuryView,minRealLevelToEnter:44,availability:{episode:2,level:1},duration:"5d",cooldown:"14d",active:!1},BaseWorld.prototype.defaults),figureRulesProcess.royaltreasuryBonusClasses=function(){featuresAdder.addFeature("royaltreasury","episodecollectiondroppable"),featuresAdder.addFeature("royaltreasury","strongbox_withgems"),featuresAdder.addFeature("royaltreasury","attribute_scarab"),featuresAdder.addFeature("royaltreasury","caviar_armadillo"),featuresAdder.addFeature("royaltreasury","coinchest_simplesnatch"),featuresAdder.addFeature("royaltreasury","frog_cart"),featuresAdder.addFeature("royaltreasury","boy_holidaypirate"),FigureRules.add(".episode_royaltreasury .bugCell .mTask1 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":100,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coinchest_simplesnatch/coinTask.d044fe78a3.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_royaltreasury .bugCell .mTask2 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_armadillo/armadilloTask.6f1f3a6e0a.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight})},figureRulesProcess.additionalBonusClasses=(vNe=figureRulesProcess.additionalBonusClasses,function(){vNe.call(this),figureRulesProcess.royaltreasuryBonusClasses()});var FascinatingHike=BonusWorld.extend({defaults:_.defaults({name:"fascinatinghike",version:20240209,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:12,finishWindowInStories:!0,forceId:!0,openDate:null,showProgress:!1,allowAfterWin:!0,allowPaid:!0,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime3",skipLevelPublication:!0,allowProlong:!0,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:15,prize:[{type:"coins",amount:100},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:22,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"finalPrize",level:30,prize:[{type:"coins",amount:300,cssClass:"coins"},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:2},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest",part:new EpisodeCollection.Part({id:1,price:100,chance:100})})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0},id:1},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:2},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.fascinatinghike .startCurrentLevel",name:this.get("name")+"Force0",id:3},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel10",elements:[{el:".mapAnimationsMiddle .sprite1",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite2",persistentClass:"visible"}],id:4},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite3",persistentClass:"visible"}],id:5},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel30",params:{prize:this.get("prizes")[this.get("prizes").length-1].prize,groupPrize:!0,showAnimatedPrizesWindow:!0},delayAfter:0,id:200}]}),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this})]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0}}),BNe;figureRulesProcess.fascinatinghikeBonusClasses=function(){featuresAdder.addFeature("fascinatinghike","episodecollectiondroppable"),featuresAdder.addFeature("fascinatinghike","fishball_bird")},figureRulesProcess.additionalBonusClasses=(BNe=figureRulesProcess.additionalBonusClasses,function(){BNe.call(this),figureRulesProcess.fascinatinghikeBonusClasses()});var AroundTheWorldView=BonusWorldView.extend({events:_.defaults({"click .scrollButton":"scrollBg"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this),this.configScroller()},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),episodeView.mapController&&episodeView.mapController.removeEventsSubscription(),this.mapController.onEnter(),this.afterLoadPage(),$("#map .scrollButton.left").on("click",this,this.scrollBg),$("#map .scrollButton.right").on("click",this,this.scrollBg)},onExit:function(){this.mapController.onExit(),BonusWorldView.prototype.onExit.call(this),episodeView.mapController&&episodeView.mapController.subscribeEvents(),$("#map .scrollButton.left").off("click",this.scrollBg),$("#map .scrollButton.right").off("click",this.scrollBg)},onCompleteLevel:function(){BonusWorldView.prototype.onCompleteLevel.call(this),this.afterLoadPage()},onFailLevel:function(){BonusWorldView.prototype.onFailLevel.call(this),this.afterLoadPage()},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),this.mapController.scrollTo(t,!1))},configScroller:function(){this.mapController=new LoopedBigMapController({el:$("#map"),bgEl:$(".scrolledBlock"),mainEl:this.$("#user"),keyIntervalTime:15,world:this.model}),this.mapView=new BigMapControllerView({model:this.mapController,el:this.$(".mapController")})},scrollBg:function(e){var t=e.data,i=$(e.target),o=i.data("direction");if(t.mapController&&t.mapController.scrollEnabled){var a=setInterval(_.bind(function(){t.mapController[o](),t.mapController.moveBgByControls()},t),30);i.one("mouseup mouseleave",function(){clearTimeout(a)})}},afterLoadPage:function(){var e=this;application.waitPage("main").then(function(){setTimeout(function(){return e.scrollToTargetLevel()},500)})}}),AroundTheWorld=BonusWorld.extend({defaults:_.defaults({name:"aroundtheworld",viewId:AroundTheWorldView,version:20240417,production:!0,levelsInEpisode:40,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:10,finishWindowInStories:!0,forceId:!0,openDate:null,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",skipLevelPublication:!0,actionQueue:new ActionQueue,alwaysCancelNext:!1,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:10,prize:[{type:"coins",amount:100},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:15,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:20,prize:[{type:"coins",amount:150},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"middlePrize",level:25,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:30,prize:[{type:"coins",amount:200},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:35,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:40,prize:[{type:"coins",amount:300,cssClass:"coins"},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:6}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.prepareStoryController(),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 1<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)},prepareStoryController:function(){this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture1"},once:"beforeEnter"},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.aroundtheworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize5",talkKey:2},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture2"},once:"beforeTakeLevelPrize5"},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture3"},once:"beforeTakeLevelPrize10"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize10",talkKey:3},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize15",talkKey:4},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture4"},once:"beforeTakeLevelPrize15"},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture5"},once:"beforeTakeLevelPrize20"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize20",talkKey:5},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize25",talkKey:6},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture6"},once:"beforeTakeLevelPrize25"},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture7"},once:"beforeTakeLevelPrize30"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize30",talkKey:7},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize35",talkKey:8},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture8"},once:"beforeTakeLevelPrize35"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize35",talkKey:9},{type:StoryTalkElement,owner:this,once:"onCompleteLevel40",talkKey:10},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture9"},once:"onCompleteLevel40"},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel40",params:{prize:this.get("prizes")[this.get("prizes").length-1].prize,groupPrize:!0},delayAfter:0,id:200}]})}}),$Ne,_Ne;figureRulesProcess.aroundtheworldBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=($Ne=figureRulesProcess.additionalBonusClasses,function(){$Ne.call(this),figureRulesProcess.aroundtheworldBonusClasses(),featuresAdder.addFeature("aroundtheworld","episodecollectiondroppable"),featuresAdder.addFeature("aroundtheworld","boy_gentleman"),featuresAdder.addFeature("aroundtheworld","well_plant"),featuresAdder.addFeature("aroundtheworld","frog_steamtrain"),featuresAdder.addFeature("aroundtheworld","floor_sand")}),figureRulesProcess.additionalBonusScaleImages=(_Ne=figureRulesProcess.additionalBonusScaleImages,function(){_Ne.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/aroundtheworld/special8.25a966c9be.png":_Figure.scaleKoef})});var RoyalRegattaView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.lawn=$('<div class="homeLawnBg active"></div>'),this.$el.append(this.lawn),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("regattaAfterPrizeWindowShowed100",this.updateBackground,this),this.renderAnimations()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterRegattaLineCrossedAtLevel100",this.updateBackground,this)},renderAnimations:function(){var e=$(".regatta-royalregatta .scrollWrapper .map"),t=e.find(".animatedDecors");t.get(0)?t.empty():(t=$('<div class="animatedDecors"></div>'),e.append(t));for(var i=[{selector:"candle",amount:11},{selector:"lightSphere",amount:2},{selector:"lightEnterEgypt",amount:1},{selector:"lightEyesBig",amount:2},{selector:"lightEyesEgypt",amount:1},{selector:"lightManyWindows",amount:1},{selector:"lightTwoWindows",amount:1},{selector:"lightTwoWindowsLow",amount:1},{selector:"lightDoor",amount:1},{selector:"flashlightBlue",amount:2},{selector:"lightEyes1",amount:2},{selector:"lightEyes2",amount:2},{selector:"lightEyes3",amount:2},{selector:"castleLight",amount:1},{selector:"lightEnter1",amount:1},{selector:"lightEnter2",amount:1},{selector:"lightEnter3",amount:2},{selector:"lightEnterLeft",amount:1},{selector:"lightWindowsLeft",amount:1},{selector:"lightWindow1",amount:1},{selector:"lightWindow2",amount:1}],o=0;o<i.length;o++)for(var a=0;a<i[o].amount;a++){var n=$('<div class="animationDecor '.concat(i[o].selector," ").concat(i[o].selector).concat(a+1,'"></div>'));t.append(n)}},updateBackground:function(){this.lawn.toggleClass("active",this.model.getCurrentLevel()>this.model.get("levelsInEpisode"))}}),RoyalRegatta=BonusWorld.extend({defaults:_.defaults({name:"royalregatta",viewId:RoyalRegattaView,version:20230313,production:!0,levelsInEpisode:100,durationDays:!1,helpWindow:!0,showFinalForce:!0,endDate:new Date("2023/04/20 00:00"),episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:3,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],livesConfig:{lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300},showTimer:!0,showProgress:!1,sounds:{narrator:!1,pirate1:!1,pirate2:"piratenegative",pirate3:!1,pirate4:"piratepositive",pirate5:"piratenegative",pirate6:"piratepositive",girl1:!1,girl2:"woman",girl3:"piratewomannegative",girl4:!1,grandfather1:"daddypositive",grandfather2:"daddynegative",grandfather3:!1,charon1:!1,charon2:!1,charon3:"kharonangry",charon4:"kharonlaugh",monsters1:"monstersroar",candybeard1:"candybeardpositive",candybeard2:"candybeardnegative",candybeard3:"candybeardpositive"},finishPrize:{progress:100,type:"finalPrize",products:[{type:"coins",amount:500,cssClass:"bonusWindowCoins"},{type:"good",amount:24,name:"unlimitedLifes",cssClass:"unlimitedLifes"},{type:"good",amount:6,name:"addThreeMoves",cssClass:"addThreeMoves"},{type:"good",amount:6,name:"starInField",cssClass:"starInField"}]},unlimitedName:"unlimitedBonusWorldLives2",prizes:[]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,catchupWindowRule:function(){return!1},instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16}]}});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:3,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:6}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:6,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:9}],parts:o.getParts()})]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500}}}),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteCel"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCel"}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:4,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:i}]},{level:9,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:100}]},{level:19,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:24,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteCell"}]},{level:29,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:34,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{level:39,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:44,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:i}]},{level:49,type:"middlePrize",products:[{type:"CoinsProduct",amount:200}]},{level:54,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteRow"}]},{level:59,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:64,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"}]},{level:69,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:74,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:79,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"Shuffle"}]},{level:84,type:"middlePrize",products:[{type:"SpinProduct",amount:2}]},{level:89,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:94,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:99,type:"middlePrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:5,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:10,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:15,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:20,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:25,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:30,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:35,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:40,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:45,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:50,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:55,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:60,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:65,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:70,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:75,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:80,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:85,type:"battlePass",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:90,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:95,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:100,type:"battlePass",products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:7200,goodId:"starInField"}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:2},{type:StoryTalkElement,once:"enter",talkKey:1,id:3},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"enter",delayAfter:2e3,id:5},{type:StoryTalkElement,delay:500,once:"enter",talkKey:2,id:6},{type:StoryTalkElement,once:"onCompleteLevel2",talkKey:3,id:7},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:4,id:8},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:5,id:9},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:6,id:10},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:7,id:11},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:8,id:12},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:9,id:13},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:10,id:14},{type:StoryTalkElement,on:"onFinishLevel3",talkKey:11,id:15},{type:StoryTalkElement,on:"onFinishLevel4",talkKey:12,id:16},{type:StoryTalkElement,on:"onFinishLevel8",talkKey:13,id:17},{type:StoryTalkElement,on:"onFinishLevel9",talkKey:14,id:18},{type:StoryTalkElement,on:"onFinishLevel13",talkKey:15,id:19},{type:StoryTalkElement,on:"onFinishLevel14",talkKey:16,id:20},{type:StoryTalkElement,on:"onFinishLevel15",talkKey:17,id:21},{type:StoryTalkElement,on:"onFinishLevel18",talkKey:18,id:22},{type:StoryTalkElement,on:"onFinishLevel19",talkKey:19,id:23},{type:StoryTalkElement,on:"onFinishLevel23",talkKey:20,id:24},{type:StoryTalkElement,on:"onFinishLevel24",talkKey:21,id:25},{type:StoryTalkElement,on:"onFinishLevel28",talkKey:22,id:26},{type:StoryTalkElement,on:"onFinishLevel29",talkKey:23,id:27},{type:StoryTalkElement,on:"onFinishLevel33",talkKey:24,id:28},{type:StoryTalkElement,on:"onFinishLevel34",talkKey:25,id:29},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place1",talkKey:26,id:30},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place2",talkKey:27,id:31},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place3",talkKey:28,id:32},{type:StoryTalkElement,once:"regattaLineCrossLevel35Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:29,id:33},{type:StoryTalkElement,on:"onFinishLevel38",talkKey:30,id:34},{type:StoryTalkElement,on:"onFinishLevel39",talkKey:31,id:35},{type:StoryTalkElement,on:"onFinishLevel43",talkKey:32,id:36},{type:StoryTalkElement,on:"onFinishLevel44",talkKey:33,id:37},{type:StoryTalkElement,on:"onFinishLevel48",talkKey:34,id:38},{type:StoryTalkElement,on:"onFinishLevel49",talkKey:35,id:39},{type:StoryTalkElement,on:"onFinishLevel53",talkKey:36,id:40},{type:StoryTalkElement,on:"onFinishLevel54",talkKey:37,id:41},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place1",talkKey:38,id:42},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place2",talkKey:39,id:43},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place3",talkKey:40,id:44},{type:StoryTalkElement,once:"regattaLineCrossLevel55Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:41,id:45},{type:StoryTalkElement,on:"onFinishLevel58",talkKey:42,id:46},{type:StoryTalkElement,on:"onFinishLevel59",talkKey:43,id:47},{type:StoryTalkElement,on:"onFinishLevel63",talkKey:44,id:48},{type:StoryTalkElement,on:"onFinishLevel64",talkKey:45,id:49},{type:StoryTalkElement,on:"onFinishLevel68",talkKey:46,id:50},{type:StoryTalkElement,on:"onFinishLevel69",talkKey:47,id:51},{type:StoryTalkElement,on:"onFinishLevel73",talkKey:48,id:52},{type:StoryTalkElement,on:"onFinishLevel74",talkKey:49,id:53},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place1",talkKey:50,id:54},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place2",talkKey:51,id:55},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place3",talkKey:52,id:56},{type:StoryTalkElement,once:"regattaLineCrossLevel75Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:53,id:57},{type:StoryTalkElement,on:"onFinishLevel78",talkKey:54,id:58},{type:StoryTalkElement,on:"onFinishLevel79",talkKey:55,id:59},{type:StoryTalkElement,on:"onFinishLevel83",talkKey:56,id:60},{type:StoryTalkElement,on:"onFinishLevel84",talkKey:57,id:61},{type:StoryTalkElement,on:"onFinishLevel88",talkKey:58,id:62},{type:StoryTalkElement,on:"onFinishLevel89",talkKey:59,id:63},{type:StoryTalkElement,on:"onFinishLevel93",talkKey:60,id:64},{type:StoryTalkElement,on:"onFinishLevel94",talkKey:61,id:65},{type:StoryTalkElement,on:"onFinishLevel98",talkKey:62,id:66},{type:StoryTalkElement,on:"onFinishLevel99",talkKey:63,id:67},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place1",talkKey:64,id:68},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place2",talkKey:65,id:69},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place3",talkKey:66,id:70},{type:StoryTalkElement,once:"regattaLineCrossLevel100Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:67,id:71},{type:StoryTalkElement,once:"regattaAfterPrizeWindowShowed100",talkKey:68,id:73},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0},delayAfter:0,once:"regattaAfterPrizeWindowShowed100",id:74},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".regatta-royalregatta .startCurrentLevel",name:this.get("name")+"FirstLevelForce"},{type:StoryForceElement,on:"onCompleteLevel2",page:"main",delay:200,id:202,el:".royalregatta .mForgeBtn",name:this.get("name")+"ForgeForce"},{type:StoryForceElement,on:"onCompleteLevel2",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"CollectionForce",id:203},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(10<t.getCurrentLevel())&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()))},on:"onAfterFinishLevel",delayAfter:4e3,id:204},{type:BaseStoryWindowElement,window:CatchUpBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(t.getCurrentLevel()<=10)&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()))},on:"onAfterFinishLevel",delayAfter:4e3,id:205}]})}}),LOe,QOe,ROe,SOe;GravityGroundCell.prototype.animateTakeLife=(LOe=GravityGroundCell.prototype.animateTakeLife,function(t){if("royalregatta"!==episode.get("num"))return LOe.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),PastureCell.prototype.playRemovalSound=(QOe=PastureCell.prototype.playRemovalSound,function(){if("royalregatta"!==episode.get("num"))return QOe.call(this)}),figureRulesProcess.royalregattaBonusClasses=function(){FigureRules.add(".episode_royalregatta .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/ice1.c16bad630b.png",width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_royalregatta .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/ice2.8e4fee45a9.png",width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_royalregatta .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":205,"background-height":204,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/ice3.58e7fdf656.png",width:205/180*Config.cellWidth,height:204/180*Config.cellHeight,"margin-left":-12/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_royalregatta .floorLevelAnimation3, .episode_royalregatta .floorLevelAnimation2, .episode_royalregatta .floorLevelAnimation1",{"background-position-x":0,"background-position-y":0,"background-width":219,"background-height":240,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/iceDie.6f58356123.png",width:219/180*Config.cellWidth,height:240/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:6,duration:350}),FigureRules.add(".episode_royalregatta .iceBlast1.iceBlast, .episode_royalregatta .iceBlast2.iceBlast, .episode_royalregatta .iceBlast3.iceBlast, .episode_royalregatta .iceBlast4.iceBlast, .episode_royalregatta .iceBlast5.iceBlast, .episode_royalregatta .iceBlast6.iceBlast",{opacity:0}),FigureRules.add(".episode_royalregatta .attribute_animal",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/sheep_xlarge.8feda7ac9e.png","margin-top":-30}),FigureRules.add(".episode_royalregatta .pastureCell.life2 .attribute_animal",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/sheepDark_xlarge.3f462bce1e.png","margin-top":-30}),FigureRules.add(".episode_royalregatta .attribute_animal.animateCollect",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/sheepFlying.e9de2685ca.png","margin-top":-30}),FigureRules.add(".episode_royalregatta .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/artifactPart.04df586310.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_royalregatta .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_royalregatta .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_royalregatta .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_royalregatta .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_royalregatta .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_royalregatta .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_royalregatta .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_royalregatta .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_royalregatta .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_royalregatta .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_royalregatta .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_royalregatta .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_royalregatta .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_royalregatta .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_royalregatta .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_royalregatta .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_royalregatta .caviarCell .cellStone",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0}),FigureRules.add(".episode_royalregatta .caviarCell_R .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickR.11ea711c9f.png"}),FigureRules.add(".episode_royalregatta .caviarCell_G .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickG.b1fbdf5f3e.png"}),FigureRules.add(".episode_royalregatta .caviarCell_B .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickB.a129da23f5.png"}),FigureRules.add(".episode_royalregatta .caviarCell_Y .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickY.dad13f1ae8.png"}),FigureRules.add(".episode_royalregatta .caviarCell_P .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickP.6c858e6bf7.png"}),FigureRules.add(".episode_royalregatta .caviarCell_W .cellStone",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chickW.826d82d2ae.png"}),FigureRules.add(".episode_royalregatta .fishBallCell",{"background-position-x":0,"background-position-y":0,"background-width":218,"background-height":184,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/bird_large.ca4c3b6830.png","margin-left":-19/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight,width:218/180*Config.cellWidth,height:184/180*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],delay:[2e3,4e3],duration:600,playRound:!0}),FigureRules.add(".episode_royalregatta .fishBallCell.powerUpHighlight",{animation:{params:{"margin-top":[-.05*Config.cellHeight,-24/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_royalregatta .fishBallCell.fishBallAngry",{startFrame:7,spriteFrames:8,duration:600,playRound:!1}),FigureRules.add(".episode_royalregatta .fishBallCell.create",{"background-position-x":0,"background-position-y":0,"background-width":218,"background-height":184,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/bird_large.ca4c3b6830.png","margin-left":-19/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight,width:218/180*Config.cellWidth,height:184/180*Config.cellHeight,spriteFrames:15,duration:800,playRound:!1}),FigureRules.add(".episode_royalregatta .fishBallCell.fishBallDie",{"margin-left":0,"margin-top":0,startFrame:15,spriteFrames:3,duration:500,playRound:!1}),FigureRules.add(".episode_royalregatta .fishBallCell.fishBallFly",{"margin-left":3,startFrame:18,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_royalregatta .fishBallCell .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":51,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlockSoc.f27a59efc8.png",width:170/180*Config.cellWidth,height:51/180*Config.cellHeight,"margin-left":8/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_royalregatta .fishBallCell.fishBallDie .lifeBlock, .episode_royalregatta .fishBallCell.fishBallFly .lifeBlock, .episode_royalregatta .fishBallCell.create .lifeBlock",{opacity:0}),FigureRules.add(".episode_royalregatta .fishBallCell .life",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_royalregatta .fishBallCell .shallow",{width:170/180*Config.cellWidth}),FigureRules.add(".episode_royalregatta.fishBallCell .middle",{width:170/180*Config.cellWidth}),FigureRules.add(".episode_royalregatta.fishBallCell .deep",{width:170/180*Config.cellWidth}),FigureRules.add(".episode_royalregatta .decorator_chocolate.stable",{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_royalregatta .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_royalregatta .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/chocolateDie.f7003a6c8e.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_royalregatta .fortHeadCell .taskIconContainer .taskIco.color_G",{"background-image":"../../../gems/site/img/features/royalregatta/color_G.png"}),FigureRules.add(".episode_royalregatta .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":302,"background-height":402,width:302/180*Config.cellWidth,height:402/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/strongbox_xlarge.117e5ca401.png","margin-left":-75/180*Config.cellWidth,"margin-top":-175/180*Config.cellHeight}),FigureRules.add(".episode_royalregatta .strongboxCellLoot",{"background-position-x":0,"background-width":230,"background-height":329,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/strongboxCollectItem.5826397d7b.png","margin-left":-34/180*Config.cellWidth,"margin-top":-1*Config.cellHeight}),FigureRules.add(".episode_royalregatta .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:10,spriteFrames:10,duration:500}),FigureRules.add(".episode_royalregatta .fish1, .episode_royalregatta .fish2, .episode_royalregatta .fish3, .episode_royalregatta .fish4, .episode_royalregatta .fish5, .episode_royalregatta .fish6",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/ankh.d451b71e36.png"}),FigureRules.add(".episode_royalregatta .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/bugDecor.b3aebdbbb6.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-.25*Config.cellHeight,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem1",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem2",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem3",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem4",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCellLifeBlock .lifeGem5",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_R .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_R.45b425eba3.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_G .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_G.be7eed537d.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_B .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_B.d7226d55e0.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_Y .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_Y.46f8b8512c.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_P .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_P.7064d5f6f2.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_W .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_W.e9eff7a1aa.png"}),FigureRules.add(".episode_royalregatta .barCellLifeBlock.color_s .lifeGem",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusLife_multi.b5ca4b6fd4.png"}),FigureRules.add(".episode_royalregatta .barCell",{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_royalregatta .barCell.Middle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusCenter.291e8195b4.png"}),FigureRules.add(".episode_royalregatta .barCell.TopLeftCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusCorner.229167c43c.png","scale-x":-1}),FigureRules.add(".episode_royalregatta .barCell.TopRightCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusCorner.229167c43c.png"}),FigureRules.add(".episode_royalregatta .barCell.BottomLeftCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusCorner.229167c43c.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_royalregatta .barCell.BottomRightCorner",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusCorner.229167c43c.png","scale-y":-1}),FigureRules.add(".episode_royalregatta .barCell.LeftSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusSide.fda95a0052.png",rotate:-90}),FigureRules.add(".episode_royalregatta .barCell.TopSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusSide.fda95a0052.png"}),FigureRules.add(".episode_royalregatta .barCell.RightSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusSide.fda95a0052.png",rotate:90}),FigureRules.add(".episode_royalregatta .barCell.BottomSide",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusSide.fda95a0052.png","scale-y":-1}),FigureRules.add(".episode_royalregatta .barCell.VerticalTop",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusEdge.7718b839da.png"}),FigureRules.add(".episode_royalregatta .barCell.VerticalMiddle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusMiddle.064015ef92.png"}),FigureRules.add(".episode_royalregatta .barCell.VerticalBottom",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusEdge.7718b839da.png","scale-y":-1}),FigureRules.add(".episode_royalregatta .barCell.HorizontalLeft",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusEdge.7718b839da.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_royalregatta .barCell.HorizontalMiddle",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusMiddle.064015ef92.png",rotate:90}),FigureRules.add(".episode_royalregatta .barCell.HorizontalRight",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/cactusEdge.7718b839da.png",rotate:90})},figureRulesProcess.additionalBonusScaleImages=(ROe=figureRulesProcess.additionalBonusScaleImages,function(){ROe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/artifactPlatform.9da3162586.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/bird_large.ca4c3b6830.png":Config.cellWidth/160,"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/strongbox_xlarge.117e5ca401.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(SOe=figureRulesProcess.additionalBonusClasses,function(){SOe.call(this),figureRulesProcess.royalregattaBonusClasses()});var ValentinesDay2023WorldConfigs={getTakePrizeAnimationComponentConfig:function(e){return{world:e,actionQueue:e.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(e.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return e.view.$el.find(".mForgeBtn")},duration:1500}}}},getForgeConfig:function(e,t){return{showPrizeWindow:!0,recipes:[{id:1,ingredients:[t.ingredient(1),t.ingredient(2),t.ingredient(3),t.ingredient(4)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:900}]}]},{id:2,ingredients:[t.ingredient(5),t.ingredient(6),t.ingredient(7),t.ingredient(8)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[t.ingredient(9),t.ingredient(10),t.ingredient(11),t.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]}]},{id:4,ingredients:[t.ingredient(13),t.ingredient(14),t.ingredient(15),t.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:150},{type:"SpinProduct",amount:1}]}]}]}},getPartShopComponentConfig:function(e){return{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.NORMAL,chance:.9},{type:PartMaterial.RARE,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.NORMAL,chance:.53},{type:PartMaterial.RARE,chance:.3},{type:PartMaterial.LEGEND,chance:.17}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.NORMAL,chance:.53},{type:PartMaterial.RARE,chance:.3},{type:PartMaterial.LEGEND,chance:.17}]}]}},getDropperAgencyComponentConfig:function(e,t){return{droppers:[new BoxDropper({world:e,chance:2,rule:function(){return 1<e.getCurrentLevel()},chances:{5:20,10:8,15:4},materials:{normal:.53,rare:.3,legend:.17},parts:t.getParts()}),new BoxDropper({world:e,rule:function(){return"valentinesday2023world1"!==e.get("name")&&1===e.getCurrentLevel()},chanceStrategyCls:OnExactMoveChanceStrategy,chances:{2:100},materials:{normal:.34,rare:.33,legend:.33},parts:t.getParts()})]}}},ValentinesDay2023World1=BonusWorld.extend({defaults:_.defaults({name:"valentinesday2023world1",version:20230126,production:!0,levelsInEpisode:15,helpWindow:!1,alwaysCancelNext:!1,endDate:new Date("2023/03/07 00:00"),displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,allowAfterWinAndTimeout:!0,minLevelToEnter:4,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:300},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12}]}],chestsInProgressBar:!0},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);Config.bonusWorlds.getByName("valentinesday2023world2"),Config.bonusWorlds.getByName("valentinesday2023world3");this.addComponent(GroupComponent,{name:"valentinesday2023world",main:!1,order:1});var i=this.addComponent(PartsComponent,{prefix:"valentinesday2023world",parts:[{id:1,material:PartMaterial.NORMAL},{id:2,material:PartMaterial.NORMAL},{id:3,material:PartMaterial.RARE},{id:4,material:PartMaterial.LEGEND},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.RARE},{id:8,material:PartMaterial.LEGEND},{id:9,material:PartMaterial.NORMAL},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.NORMAL},{id:14,material:PartMaterial.NORMAL},{id:15,material:PartMaterial.RARE},{id:16,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,ValentinesDay2023WorldConfigs.getForgeConfig(this,i));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this,rule:function(){return 1<t.getCurrentLevel()}}),new ForceBoxPartCollector({world:this,rule:function(){return 1===t.getCurrentLevel()}})]}),this.addComponent(PartShopComponent,ValentinesDay2023WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,ValentinesDay2023WorldConfigs.getDropperAgencyComponentConfig(this,i)),this.addComponent(TakePrizeAnimationComponent,ValentinesDay2023WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.valentinesday2023world1 .animationSprite1",persistentClass:"visible1"}],id:1},{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.valentinesday2023world1 .animationSprite2",persistentClass:"visible1"}],id:3},{type:StoryTalkElement,once:"beforeEnter",talkKey:2,id:4},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.valentinesday2023world1 .animationSprite3",persistentClass:"visible1"}],id:5},{type:StoryTalkElement,once:"beforeEnter",talkKey:3,id:6},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.valentinesday2023world1 .animationSprite4",persistentClass:"visible1"}],id:7},{type:StoryTalkElement,once:"beforeEnter",talkKey:4,id:8},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.valentinesday2023world1",persistentClass:"hidden"}],delayAfter:0,id:9},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,text:messages[this.get("name")+"AfterComicsText"],closeTimeout:2e3},once:"beforeEnter",delayAfter:0,id:10},{type:StoryTalkElement,once:"beforeEnter",talkKey:5,id:11},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase1b"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadein",duration:500}],id:12},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase2"},{el:".scrolledBlock .background2",persistentClass:"valentine1"}],id:13},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:6,id:14},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel5",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase3"},{el:".scrolledBlock .background3",persistentClass:"valentine1"}],id:15},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:7,id:16},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel5",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase3b"},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite5",flashClass:"fadein",duration:500}],id:17},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:8,id:18},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase4"},{el:".scrolledBlock .background4",persistentClass:"valentine1"}],id:19},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:9,id:20},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase4b"},{el:".mapAnimationsMiddle .sprite6",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite7",flashClass:"fadein",duration:500}],id:21},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:10,id:22},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase4c"},{el:".mapAnimationsMiddle .sprite7",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite8",flashClass:"fadein",duration:500}],id:23},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase5"},{el:".scrolledBlock .background5",persistentClass:"valentine1"}],id:24},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:11,id:25},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase5b"},{el:".mapAnimationsMiddle .sprite9",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite10",flashClass:"fadein",duration:500}],id:26},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel15",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase6"},{el:".scrolledBlock .background6",persistentClass:"valentine1"}],id:27},{type:StoryTalkElement,once:"onCompleteLevel15",talkKey:12,id:28},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel15",elements:[{el:".mapAnimationsMiddle",persistentClass:"v1_phase6b"},{el:".mapAnimationsMiddle .sprite11",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite12",flashClass:"fadein",duration:500}],id:29},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:30},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.valentinesday2023world1 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,on:"onCompleteLevel1",id:202,el:".valentinesday2023world1 .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(GroupReturnWorldComponent)},onClosingSoon:function(){BonusWorld.prototype.onClosingSoon.call(this),this.set("prolongMaxTimes",1)}}),qPe;PastureCell.prototype.playRemovalSound=(qPe=PastureCell.prototype.playRemovalSound,function(){if("valentinesday2023world1"!==episode.get("num"))return qPe.call(this)});var ValentinesDay2023World2=BonusWorld.extend({defaults:_.defaults({beginDate:new Date("2023/02/13 17:00:00"),name:"valentinesday2023world2",version:20230126,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,alwaysCancelNext:!1,endDate:new Date("2023/03/07 00:00"),displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,forceId:!0,allowAfterWinAndTimeout:!0,force:!1,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:50},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:450},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:6}]}],chestsInProgressBar:!0},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"valentinesday2023world",main:!1,order:2});var t=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"valentinesday2023world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,ValentinesDay2023WorldConfigs.getForgeConfig(this,t));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,ValentinesDay2023WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,ValentinesDay2023WorldConfigs.getDropperAgencyComponentConfig(this,t)),this.addComponent(TakePrizeAnimationComponent,ValentinesDay2023WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:2,id:3},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase2"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:4},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:3,id:5},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase3"},{el:".mapAnimationsMiddle .sprite6",flashClass:"fadein",duration:500}],id:6},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:4,id:7},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel5",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase4"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite6",flashClass:"fadeout",duration:500}],id:9},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:5,id:10},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase5"},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:11},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:6,id:12},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:7,id:13},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase6"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadeout",duration:500}],id:14},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:8,id:15},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase7"},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:16},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:9,id:17},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase8"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite5",flashClass:"fadein",duration:500}],id:18},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase9"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadein",duration:500},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:500},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:19},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:10,id:20},{type:StoryTalkElement,once:"onCompleteLevel15",talkKey:11,id:21},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel15",elements:[{el:".mapAnimationsMiddle",persistentClass:"v2_phase10"},{el:".scrolledBlock .background2",persistentClass:"valentine2"}],id:22},{type:StoryTalkElement,once:"onCompleteLevel15",talkKey:12,id:23},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:24},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.valentinesday2023world2 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,on:"onCompleteLevel1",id:202,el:".valentinesday2023world2 .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(RunWorldComponent)},onClosingSoon:function(){this.set("prolongMaxTimes",1)}}),yPe;PastureCell.prototype.playRemovalSound=(yPe=PastureCell.prototype.playRemovalSound,function(){if("valentinesday2023world2"!==episode.get("num"))return yPe.call(this)});var ValentinesDay2023World3=BonusWorld.extend({defaults:_.defaults({beginDate:new Date("2023/02/16 17:00:00"),name:"valentinesday2023world3",version:20230126,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,alwaysCancelNext:!1,endDate:new Date("2023/03/07 00:00"),displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,allowAfterWinAndTimeout:!0,forceId:!0,force:!1,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:50},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"finalPrize",level:15,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:6},{type:"spins",name:"spins",cssClass:"spins",amount:2}]}],chestsInProgressBar:!0},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"valentinesday2023world",main:!1,order:3});var t=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"valentinesday2023world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,ValentinesDay2023WorldConfigs.getForgeConfig(this,t));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,ValentinesDay2023WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,ValentinesDay2023WorldConfigs.getDropperAgencyComponentConfig(this,t)),this.addComponent(TakePrizeAnimationComponent,ValentinesDay2023WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,once:"beforeEnter",talkKey:2,id:3},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:3,id:4},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"v3_phase1b"},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadein",duration:500}],id:5},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:4,id:6},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:5,id:7},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel5",elements:[{el:".mapAnimationsMiddle",persistentClass:"v3_phase2"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:8},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:6,id:9},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".scrolledBlock .background2",persistentClass:"valentine3"},{el:".mapAnimationsMiddle",persistentClass:"v3_phase3"},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite5",flashClass:"fadein",duration:500}],id:10},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:7,id:11},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:8,id:12},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v3_phase4"},{el:".mapAnimationsMiddle .sprite5",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite6",flashClass:"fadein",duration:500}],id:13},{type:StoryTalkElement,once:"onCompleteLevel15",talkKey:9,id:14},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel15",elements:[{el:".mapAnimationsMiddle",persistentClass:"v3_phase5"},{el:".mapAnimationsMiddle .sprite6",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite7",flashClass:"fadein",duration:500}],id:15},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:205},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.valentinesday2023world3 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,on:"onCompleteLevel1",id:202,el:".valentinesday2023world3 .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(RunWorldComponent)},onClosingSoon:function(){this.set("prolongMaxTimes",1)}}),GPe;PastureCell.prototype.playRemovalSound=(GPe=PastureCell.prototype.playRemovalSound,function(){if("valentinesday2023world3"!==episode.get("num"))return GPe.call(this)});var ValentinesDay2023World4=BonusWorld.extend({defaults:_.defaults({name:"valentinesday2023world4",version:20230126,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,alwaysCancelNext:!1,endDate:new Date("2023/03/07 00:00"),displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,force:!1,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!0,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:100},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}],chestsInProgressBar:!0},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"valentinesday2023world",main:!0,order:4});var t=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"valentinesday2023world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,ValentinesDay2023WorldConfigs.getForgeConfig(this,t));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,ValentinesDay2023WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,ValentinesDay2023WorldConfigs.getDropperAgencyComponentConfig(this,t)),this.addComponent(TakePrizeAnimationComponent,ValentinesDay2023WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,once:"beforeEnter",talkKey:2,id:3},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:3,id:4},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".scrolledBlock .background2",persistentClass:"valentine4"}],id:5},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:4,id:6},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel5",elements:[{el:".scrolledBlock .background3",persistentClass:"valentine4"},{el:".mapAnimationsMiddle",persistentClass:"v4_phase2"}],id:7},{type:StoryTalkElement,once:"onCompleteLevel5",talkKey:5,id:8},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:6,id:9},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"v4_phase2b"},{el:".mapAnimationsMiddle .sprite1",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadein",duration:500}],id:10},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:7,id:11},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v4_phase2c"},{el:".mapAnimationsMiddle .sprite2",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadein",duration:500}],id:12},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:8,id:13},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"v4_phase2d"},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:14},{type:StoryTalkElement,once:"onCompleteLevel12",talkKey:9,id:15},{type:StoryTalkElement,once:"onCompleteLevel15",talkKey:10,id:16},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel15",elements:[{el:".mapAnimationsMiddle",persistentClass:"v4_phase3"},{el:".mapAnimationsMiddle .sprite3",flashClass:"fadeout",duration:300},{el:".mapAnimationsMiddle .sprite4",flashClass:"fadein",duration:500}],id:17},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:18},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.valentinesday2023world4 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,on:"onCompleteLevel1",id:202,el:".valentinesday2023world4 .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(RunWorldComponent)},onClosingSoon:function(){this.set("prolongMaxTimes",1)}}),OPe,PPe,QPe,RPe,SPe,TPe,UPe,VPe,WPe;PastureCell.prototype.playRemovalSound=(OPe=PastureCell.prototype.playRemovalSound,function(){if("valentinesday2023world4"!==episode.get("num"))return OPe.call(this)}),figureRulesProcess.valentinesday2023world1BonusClasses=function(){FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/valentinesday2023world1/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_valentinesday2023world1 .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_valentinesday2023world1 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world1/dog_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .pastureCell.life2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world1/dogDark_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/dogFlying.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".episode_valentinesday2023world1 .fish5.fishcellBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world1/basket.png","background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .strongboxCell .strongboxBg",{"background-position-y":0,"background-width":196,"background-height":229,"background-image":"../../../gems/site/img/features/valentinesday2023world1/bearSafe.png",width:196/180*Config.cellWidth,height:229/180*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-.3*Config.cellHeight,scale:1.15}),FigureRules.add(".episode_valentinesday2023world1 .strongboxCellLoot",{"background-position-x":0,"background-width":243,"background-height":284,width:1.35*Config.cellWidth,height:284/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/valentinesday2023world1/bearSafeCollectItem.png","margin-left":-35/180*Config.cellWidth,"margin-top":-82/180*Config.cellHeight,scale:.8}),FigureRules.add(".episode_valentinesday2023world1 .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:15,spriteFrames:5,duration:500}),FigureRules.add(".episode_valentinesday2023world1 .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_valentinesday2023world1 .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world1 .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world1 .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world1 .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world1 .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/ring.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/valentinesday2023world1/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world1 .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/valentinesday2023world1/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_valentinesday2023world1 .chestWithKeysHead .chestWithKeyskBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world1/chestWithKeys.png"}),FigureRules.add(".episode_valentinesday2023world1 .chestKeyCell .cellStone",{"background-image":"../../../gems/site/img/features/valentinesday2023world1/chestKeys.png"}),FigureRules.add(".episode_valentinesday2023world1 .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world1 .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world1 .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world1 .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world1 .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":20,"background-height":24,"background-image":"../../../gems/site/img/features/valentinesday2023world1/pannacotta.png",width:55/180*Config.cellWidth,height:65/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin1",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin2",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin3",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin4",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin5",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin.muffin6",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin1.muffinShake, .muffin2.muffinShake, .muffin3.muffinShake",{animation:{params:{"margin-top":[125/180*Config.cellWidth,128/180*Config.cellWidth,125/180*Config.cellWidth,128/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world1 .muffin4.muffinShake, .muffin5.muffinShake, .muffin6.muffinShake",{animation:{params:{"margin-top":[195/180*Config.cellWidth,1.1*Config.cellWidth,195/180*Config.cellWidth,1.1*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world1 .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/pannacottaTask.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .muffin6.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .muffin5.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .muffin4.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .muffin3.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .muffin2.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .muffin1.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world1 .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/valentinesday2023world1/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world1 .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/valentinesday2023world1/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world1/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .currentLife, .episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .divider, .episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_valentinesday2023world1 .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth})},figureRulesProcess.additionalBonusScaleImages=(PPe=figureRulesProcess.additionalBonusScaleImages,function(){PPe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/valentinesday2023world1/basket.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/dog_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/dogDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/dogFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/ringCase.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/heartFlower.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/hitHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world1/cupidonStable.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(QPe=figureRulesProcess.additionalBonusClasses,function(){QPe.call(this),figureRulesProcess.valentinesday2023world1BonusClasses()}),figureRulesProcess.valentinesday2023world2BonusClasses=function(){FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/valentinesday2023world2/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_valentinesday2023world2 .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_valentinesday2023world2 .fish5.fishcellBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world2/basket.png","background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/valentinesday2023world2/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world2 .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/valentinesday2023world2/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":20,"background-height":24,"background-image":"../../../gems/site/img/features/valentinesday2023world2/pannacotta.png",width:55/180*Config.cellWidth,height:65/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin1",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin2",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin3",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin4",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin5",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin.muffin6",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin1.muffinShake, .muffin2.muffinShake, .muffin3.muffinShake",{animation:{params:{"margin-top":[125/180*Config.cellWidth,128/180*Config.cellWidth,125/180*Config.cellWidth,128/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world2 .muffin4.muffinShake, .muffin5.muffinShake, .muffin6.muffinShake",{animation:{params:{"margin-top":[195/180*Config.cellWidth,1.1*Config.cellWidth,195/180*Config.cellWidth,1.1*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world2 .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/pannacottaTask.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .muffin6.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .muffin5.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .muffin4.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .muffin3.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .muffin2.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .muffin1.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world2 .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world2 .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world2 .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world2 .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world2 .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_valentinesday2023world2 .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_valentinesday2023world2 .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world2 .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world2 .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world2 .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world2 .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/ring.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world2/dog_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .pastureCell.life2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world2/dogDark_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/dogFlying.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".episode_valentinesday2023world2 .chestWithKeysHead .chestWithKeyskBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world2/chestWithKeys.png"}),FigureRules.add(".episode_valentinesday2023world2 .chestKeyCell .cellStone",{"background-image":"../../../gems/site/img/features/valentinesday2023world2/chestKeys.png"}),FigureRules.add(".episode_valentinesday2023world2 .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/valentinesday2023world2/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world2 .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/valentinesday2023world2/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world2/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .currentLife, .episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .divider, .episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_valentinesday2023world2 .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth})},figureRulesProcess.additionalBonusScaleImages=(RPe=figureRulesProcess.additionalBonusScaleImages,function(){RPe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/valentinesday2023world2/basket.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/dog_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/dogDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/dogFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/ringCase.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/heartFlower.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/hitHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world2/cupidonStable.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(SPe=figureRulesProcess.additionalBonusClasses,function(){SPe.call(this),figureRulesProcess.valentinesday2023world2BonusClasses()}),figureRulesProcess.valentinesday2023world3BonusClasses=function(){FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/valentinesday2023world3/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_valentinesday2023world3 .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_valentinesday2023world3 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world3/dog_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .pastureCell.life2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world3/dogDark_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/dogFlying.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".episode_valentinesday2023world3 .fish5.fishcellBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world3/basket.png","background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_valentinesday2023world3 .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world3 .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world3 .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world3 .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world3 .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/ring.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/valentinesday2023world3/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world3 .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/valentinesday2023world3/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_valentinesday2023world3 .chestWithKeysHead .chestWithKeyskBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world3/chestWithKeys.png"}),FigureRules.add(".episode_valentinesday2023world3 .chestKeyCell .cellStone",{"background-image":"../../../gems/site/img/features/valentinesday2023world3/chestKeys.png"}),FigureRules.add(".episode_valentinesday2023world3 .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world3 .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world3 .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world3 .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world3 .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":20,"background-height":24,"background-image":"../../../gems/site/img/features/valentinesday2023world3/pannacotta.png",width:55/180*Config.cellWidth,height:65/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin1",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin2",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin3",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin4",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin5",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin.muffin6",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin1.muffinShake, .muffin2.muffinShake, .muffin3.muffinShake",{animation:{params:{"margin-top":[125/180*Config.cellWidth,128/180*Config.cellWidth,125/180*Config.cellWidth,128/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world3 .muffin4.muffinShake, .muffin5.muffinShake, .muffin6.muffinShake",{animation:{params:{"margin-top":[195/180*Config.cellWidth,1.1*Config.cellWidth,195/180*Config.cellWidth,1.1*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world3 .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/pannacottaTask.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .muffin6.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .muffin5.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .muffin4.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .muffin3.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .muffin2.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .muffin1.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world3 .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/valentinesday2023world3/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world3 .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/valentinesday2023world3/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world3/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .currentLife, .episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .divider, .episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_valentinesday2023world3 .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth})},figureRulesProcess.additionalBonusScaleImages=(TPe=figureRulesProcess.additionalBonusScaleImages,function(){TPe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/valentinesday2023world3/basket.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/dog_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/dogDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/dogFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/ringCase.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/heartFlower.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/hitHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world3/cupidonStable.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(UPe=figureRulesProcess.additionalBonusClasses,function(){UPe.call(this),figureRulesProcess.valentinesday2023world3BonusClasses()}),figureRulesProcess.valentinesday2023world4BonusClasses=function(){FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/valentinesday2023world4/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_valentinesday2023world4 .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_valentinesday2023world4 .strongboxCell .strongboxBg",{"background-position-y":0,"background-width":196,"background-height":229,"background-image":"../../../gems/site/img/features/valentinesday2023world4/bearSafe.png",width:196/180*Config.cellWidth,height:229/180*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-.3*Config.cellHeight,scale:1.15}),FigureRules.add(".episode_valentinesday2023world4 .strongboxCellLoot",{"background-position-x":0,"background-width":243,"background-height":284,width:1.35*Config.cellWidth,height:284/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/valentinesday2023world4/bearSafeCollectItem.png","margin-left":-35/180*Config.cellWidth,"margin-top":-82/180*Config.cellHeight,scale:.8}),FigureRules.add(".episode_valentinesday2023world4 .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:15,spriteFrames:5,duration:500}),FigureRules.add(".episode_valentinesday2023world4 .chestWithKeysHead .chestWithKeyskBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world4/chestWithKeys.png"}),FigureRules.add(".episode_valentinesday2023world4 .chestKeyCell .cellStone",{"background-image":"../../../gems/site/img/features/valentinesday2023world4/chestKeys.png"}),FigureRules.add(".episode_valentinesday2023world4 .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world4 .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_valentinesday2023world4 .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world4 .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_valentinesday2023world4 .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_valentinesday2023world4 .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/valentinesday2023world4/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world4 .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/valentinesday2023world4/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .currentLife, .episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .divider, .episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_valentinesday2023world4 .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_valentinesday2023world4 .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_valentinesday2023world4 .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world4 .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world4 .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world4 .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_valentinesday2023world4 .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/ring.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/valentinesday2023world4/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_valentinesday2023world4 .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/valentinesday2023world4/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":20,"background-height":24,"background-image":"../../../gems/site/img/features/valentinesday2023world4/pannacotta.png",width:55/180*Config.cellWidth,height:65/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin1",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin2",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin3",{"margin-top":120/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin4",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin5",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin.muffin6",{"margin-top":190/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin1.muffinShake, .muffin2.muffinShake, .muffin3.muffinShake",{animation:{params:{"margin-top":[125/180*Config.cellWidth,128/180*Config.cellWidth,125/180*Config.cellWidth,128/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth,120/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world4 .muffin4.muffinShake, .muffin5.muffinShake, .muffin6.muffinShake",{animation:{params:{"margin-top":[195/180*Config.cellWidth,1.1*Config.cellWidth,195/180*Config.cellWidth,1.1*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth,190/180*Config.cellWidth]},duration:600,delay:[300,300]}}),FigureRules.add(".episode_valentinesday2023world4 .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/pannacottaTask.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .muffin6.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .muffin5.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .muffin4.flyingMuffin",{animation:{params:{"margin-top":[50,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .muffin3.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[55,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .muffin2.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[30,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .muffin1.flyingMuffin",{animation:{params:{"margin-top":[25,-5],"margin-left":[10,5]},duration:1e3}}),FigureRules.add(".episode_valentinesday2023world4 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world4/dog_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .pastureCell.life2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":255,"background-image":"../../../gems/site/img/features/valentinesday2023world4/dogDark_xlarge.png",width:206/180*Config.cellWidth,height:255/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-52/180*Config.cellHeight}),FigureRules.add(".episode_valentinesday2023world4 .attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/valentinesday2023world4/dogFlying.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".episode_valentinesday2023world4 .fish5.fishcellBg",{"background-image":"../../../gems/site/img/features/valentinesday2023world4/basket.png","background-width":180,"background-height":180,width:1*Config.cellWidth,height:1*Config.cellHeight})},figureRulesProcess.additionalBonusScaleImages=(VPe=figureRulesProcess.additionalBonusScaleImages,function(){VPe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/valentinesday2023world4/bearSafe.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/bearSafeCollectItem.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/heartFlower.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/hitHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/ring.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/ringCase.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/cupidonStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/basket.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/dog_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/dogDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/valentinesday2023world4/dogFlying.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(WPe=figureRulesProcess.additionalBonusClasses,function(){WPe.call(this),figureRulesProcess.valentinesday2023world4BonusClasses()});var Thanksgiving2022worldActionQueue=new ActionQueue,Thanksgivingday2022WorldConfigs={getTakePrizeAnimationComponentConfig:function(e){return{world:e,actionQueue:e.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(e.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return e.view.$el.find(".mForgeBtn")},duration:1500}}}},getForgeConfig:function(e,t){return{showPrizeWindow:!0,recipes:[{id:1,ingredients:[t.ingredient(1),t.ingredient(2),t.ingredient(3),t.ingredient(4)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:2,ingredients:[t.ingredient(5),t.ingredient(6),t.ingredient(7),t.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:3,ingredients:[t.ingredient(9),t.ingredient(10),t.ingredient(11),t.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}]},{id:4,ingredients:[t.ingredient(13),t.ingredient(14),t.ingredient(15),t.ingredient(16)],prizes:[{products:[{type:"SpinProduct",amount:1}]}]}]}},getPartShopComponentConfig:function(e){return{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[{type:PartMaterial.NORMAL,chance:.9},{type:PartMaterial.RARE,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.NORMAL,chance:.53},{type:PartMaterial.RARE,chance:.3},{type:PartMaterial.LEGEND,chance:.17}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.NORMAL,chance:.53},{type:PartMaterial.RARE,chance:.3},{type:PartMaterial.LEGEND,chance:.17}]}]}},getDropperAgencyComponentConfig:function(e,t){return{droppers:[new BoxDropper({world:e,chance:2,rule:function(){return 1<e.getCurrentLevel()},chances:{5:20,10:8,15:4},materials:{normal:.53,rare:.3,legend:.17},parts:t.getParts()}),new BoxDropper({world:e,rule:function(){return"thanksgivingday2022world1"!==e.get("name")&&1===e.getCurrentLevel()},chanceStrategyCls:OnExactMoveChanceStrategy,chances:{2:100},materials:{normal:.53,rare:.3,legend:.17},parts:t.getParts()})]}},getProlongateWorldComponentConfig:function(e){return{createButton:!1,showWindowAfterInit:!1,prizeForProlong:function(){return e.cmp("group").getActiveWorld()?null:new Prize({name:"prolongatePrize"+e.getName(),products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]})}}},forgeStoryIsAvailable:function(e){return!e.cmp("group").getBonusWorlds().map(function(e){return e.cmp("story").getStoryById(202).get("status")===StoryStatus.complete}).reduce(function(e,t){return e||t},!1)}},Thanksgivingday2022World1=BonusWorld.extend({defaults:_.defaults({name:"thanksgivingday2022world1",version:20231103,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,allowAfterWinAndTimeout:!0,minLevelToEnter:4,forceId:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,extensionOfBonusWorldTimeOfferId:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:200},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:6}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"thanksgivingday2022world",main:!1,order:1});var i=this.addComponent(PartsComponent,{prefix:"thanksgivingday2022world",parts:[{id:1,material:PartMaterial.NORMAL},{id:2,material:PartMaterial.NORMAL},{id:3,material:PartMaterial.RARE},{id:4,material:PartMaterial.LEGEND},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.RARE},{id:8,material:PartMaterial.LEGEND},{id:9,material:PartMaterial.NORMAL},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.NORMAL},{id:14,material:PartMaterial.NORMAL},{id:15,material:PartMaterial.RARE},{id:16,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,Thanksgivingday2022WorldConfigs.getForgeConfig(this,i));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this,rule:function(){return 1<t.getCurrentLevel()}}),new ForceBoxPartCollector({world:this,rule:function(){return 1===t.getCurrentLevel()}})]}),this.addComponent(PartShopComponent,Thanksgivingday2022WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,Thanksgivingday2022WorldConfigs.getDropperAgencyComponentConfig(this,i)),this.addComponent(TakePrizeAnimationComponent,Thanksgivingday2022WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.thanksgivingday2022world1 .animationSprite1",persistentClass:"visible1"}],id:1},{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.thanksgivingday2022world1 .animationSprite2",persistentClass:"visible1"}],id:3},{type:StoryTalkElement,once:"beforeEnter",talkKey:2,id:4},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.thanksgivingday2022world1 .animationSprite3",persistentClass:"visible1"}],id:5},{type:StoryTalkElement,once:"beforeEnter",talkKey:3,id:6},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.thanksgivingday2022world1 .animationSprite4",persistentClass:"visible1"}],id:7},{type:StoryTalkElement,once:"beforeEnter",talkKey:4,id:8},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.thanksgivingday2022world1",persistentClass:"hidden"}],delayAfter:0,id:9},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,text:messages[this.get("name")+"AfterComicsText"],closeTimeout:2e3},once:"beforeEnter",delayAfter:0,id:10},{type:StoryTalkElement,once:"beforeEnter",talkKey:5,id:11},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase2"},{el:".scrolledBlock .background2",persistentClass:"tgd1"}],id:12},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:6,id:13},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase3"}],id:14},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:7,id:15},{type:StoryAnimationElement,owner:this,once:"onFinishLevel5",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase4"}],id:16},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:8,id:17},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase5"},{el:".scrolledBlock .background4",persistentClass:"tgd1"}],id:18},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:9,id:19},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase6"},{el:".scrolledBlock .background5",persistentClass:"tgd1"}],id:20},{type:StoryAnimationElement,owner:this,once:"onFinishLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase7"}],id:21},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:10,id:22},{type:StoryAnimationElement,owner:this,once:"onFinishLevel12",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase8"},{el:".scrolledBlock .background6",persistentClass:"tgd1"}],id:23},{type:StoryTalkElement,once:"onFinishLevel15",talkKey:11,id:24},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onFinishLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:25},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.thanksgivingday2022world1 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,once:"onCompleteLevel1",id:202,el:".thanksgivingday2022world1 .mForgeBtn",name:this.get("name")+"Force2",isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}},{type:StoryForceElement,once:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203,isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}}]}),this.addComponent(GroupReturnWorldComponent),this.addComponent(ProlongateWorldComponent,Thanksgivingday2022WorldConfigs.getProlongateWorldComponentConfig(this))},onClosingSoon:function(){this.set("prolongMaxTimes",1)},hasTimer:function(){return!this.get("finished")&&BonusWorld.prototype.hasTimer.call(this)}}),DQe,EQe;figureRulesProcess.thanksgivingday2022world1BonusClasses=function(){FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world1/artifactPart.b42996efda.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_thanksgivingday2022world1 .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("thanksgivingday2022world1","frog_steamtrain"),featuresAdder.addFeature("thanksgivingday2022world1","ground_foodbox"),featuresAdder.addFeature("thanksgivingday2022world1","dropcell_fruitbasket"),featuresAdder.addFeature("thanksgivingday2022world1","chocolate_dough"),featuresAdder.addFeature("thanksgivingday2022world1","snail_newyearsnail"),featuresAdder.addFeature("thanksgivingday2022world1","alligator_oven")},figureRulesProcess.additionalBonusScaleImages=(DQe=figureRulesProcess.additionalBonusScaleImages,function(){DQe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world1/artifactPlatform.9da3162586.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(EQe=figureRulesProcess.additionalBonusClasses,function(){EQe.call(this),figureRulesProcess.thanksgivingday2022world1BonusClasses()});var Thanksgivingday2022World2=BonusWorld.extend({defaults:_.defaults({beginDate:new Date("2023/11/05 19:00:00"),name:"thanksgivingday2022world2",version:20231103,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,forceId:!0,allowAfterWinAndTimeout:!0,force:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,extensionOfBonusWorldTimeOfferId:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:50},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:250},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:6}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"thanksgivingday2022world",main:!1,order:2});var i=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"thanksgivingday2022world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,Thanksgivingday2022WorldConfigs.getForgeConfig(this,i));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,Thanksgivingday2022WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,Thanksgivingday2022WorldConfigs.getDropperAgencyComponentConfig(this,i)),this.addComponent(TakePrizeAnimationComponent,Thanksgivingday2022WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:2,id:3},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".scrolledBlock .background2",persistentClass:"tgd2"}],id:4},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:3,id:5},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:4,id:6},{type:StoryAnimationElement,owner:this,once:"onFinishLevel5",elements:[{el:".scrolledBlock .background3",persistentClass:"tgd2"}],id:7},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:5,id:8},{type:StoryAnimationElement,owner:this,once:"onFinishLevel5",elements:[{el:".scrolledBlock .background3",persistentClass:"tgd2"}],id:9},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:6,id:10},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:7,id:11},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".scrolledBlock .background4",persistentClass:"tgd2"}],id:12},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:8,id:13},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:9,id:14},{type:StoryAnimationElement,owner:this,once:"onFinishLevel12",elements:[{el:".scrolledBlock .background5",persistentClass:"tgd2"}],id:15},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:10,id:16},{type:StoryTalkElement,once:"onFinishLevel15",talkKey:11,id:17},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onFinishLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:18},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.thanksgivingday2022world2 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,once:"onCompleteLevel1",id:202,el:".thanksgivingday2022world2 .mForgeBtn",name:this.get("name")+"Force2",isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}},{type:StoryForceElement,once:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203,isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}}]}),this.addComponent(RunWorldComponent),this.addComponent(ProlongateWorldComponent,Thanksgivingday2022WorldConfigs.getProlongateWorldComponentConfig(this))},onClosingSoon:function(){BonusWorld.prototype.onClosingSoon.call(this),this.set("prolongMaxTimes",1)},hasTimer:function(){return!this.get("finished")&&BonusWorld.prototype.hasTimer.call(this)}}),QQe,RQe;figureRulesProcess.thanksgivingday2022world2BonusClasses=function(){FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world2/artifactPart.b42996efda.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_thanksgivingday2022world2 .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("thanksgivingday2022world2","fishball_mysteryball"),featuresAdder.addFeature("thanksgivingday2022world2","dropcell_fruitbasket"),featuresAdder.addFeature("thanksgivingday2022world2","ground_foodbox"),featuresAdder.addFeature("thanksgivingday2022world2","chocolate_dough"),featuresAdder.addFeature("thanksgivingday2022world2","snail_newyearsnail"),featuresAdder.addFeature("thanksgivingday2022world2","alligator_oven")},figureRulesProcess.additionalBonusScaleImages=(QQe=figureRulesProcess.additionalBonusScaleImages,function(){QQe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world2/artifactPlatform.9da3162586.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(RQe=figureRulesProcess.additionalBonusClasses,function(){RQe.call(this),figureRulesProcess.thanksgivingday2022world2BonusClasses()});var Thanksgivingday2022World3=BonusWorld.extend({defaults:_.defaults({beginDate:new Date("2023/11/07 19:00:00"),name:"thanksgivingday2022world3",version:20231103,production:!0,levelsInEpisode:15,durationDays:3,helpWindow:!1,displayExpired:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,allowAfterWinAndTimeout:!0,forceId:!0,force:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:null,extensionOfBonusWorldTimeOfferId:null,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:50},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:6},{type:"spins",name:"spins",cssClass:"spins",amount:1}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"thanksgivingday2022world",main:!1,order:3});var i=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"thanksgivingday2022world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,Thanksgivingday2022WorldConfigs.getForgeConfig(this,i));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,Thanksgivingday2022WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,Thanksgivingday2022WorldConfigs.getDropperAgencyComponentConfig(this,i)),this.addComponent(TakePrizeAnimationComponent,Thanksgivingday2022WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:2,id:3},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".scrolledBlock .background2",persistentClass:"tgd3"}],id:4},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:3,id:5},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:4,id:6},{type:StoryAnimationElement,owner:this,once:"onFinishLevel5",elements:[{el:".scrolledBlock .background3",persistentClass:"tgd3"},{el:".mapAnimationsMiddle",flashClass:"sandstorm",duration:4e3}],id:7},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:5,id:8},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".scrolledBlock .background4",persistentClass:"tgd3"}],id:9},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:6,id:10},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:7,id:11},{type:StoryAnimationElement,owner:this,once:"onFinishLevel12",elements:[{el:".scrolledBlock .background5",persistentClass:"tgd3"}],id:12},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:8,id:13},{type:StoryTalkElement,once:"onFinishLevel15",talkKey:9,id:14},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onFinishLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:15},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.thanksgivingday2022world3 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,once:"onCompleteLevel1",id:202,el:".thanksgivingday2022world3 .mForgeBtn",name:this.get("name")+"Force2",isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}},{type:StoryForceElement,once:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203,isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}}]}),this.addComponent(RunWorldComponent),this.addComponent(ProlongateWorldComponent,Thanksgivingday2022WorldConfigs.getProlongateWorldComponentConfig(this))},onClosingSoon:function(){this.set("prolongMaxTimes",1)},hasTimer:function(){return!this.get("finished")&&BonusWorld.prototype.hasTimer.call(this)}}),bRe,cRe;figureRulesProcess.thanksgivingday2022world3BonusClasses=function(){FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world3/artifactPart.b42996efda.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_thanksgivingday2022world3 .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("thanksgivingday2022world3","ground_foodbox"),featuresAdder.addFeature("thanksgivingday2022world3","floor_flour"),featuresAdder.addFeature("thanksgivingday2022world3","iceberg_berry"),featuresAdder.addFeature("thanksgivingday2022world3","frozenegg_berry"),featuresAdder.addFeature("thanksgivingday2022world3","strongbox_catsafe"),featuresAdder.addFeature("thanksgivingday2022world3","chocolate_dough"),featuresAdder.addFeature("thanksgivingday2022world3","dropcell_fruitbasket"),featuresAdder.addFeature("thanksgivingday2022world3","snail_newyearsnail"),featuresAdder.addFeature("thanksgivingday2022world3","alligator_oven")},figureRulesProcess.additionalBonusScaleImages=(bRe=figureRulesProcess.additionalBonusScaleImages,function(){bRe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world3/artifactPlatform.9da3162586.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(cRe=figureRulesProcess.additionalBonusClasses,function(){cRe.call(this),figureRulesProcess.thanksgivingday2022world3BonusClasses()});var Thanksgivingday2022World4=BonusWorld.extend({defaults:_.defaults({name:"thanksgivingday2022world4",version:20231103,production:!0,levelsInEpisode:15,durationDays:!1,helpWindow:!1,displayExpired:!0,alwaysShowTimer:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,force:!1,forceId:!0,allowAfterWin:!0,allowPaid:!0,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,showTimer:!0,showProgress:!1,useUserPrizesView:!0,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",level:15,prize:[{type:"coins",amount:400},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(GroupComponent,{name:"thanksgivingday2022world",main:!0});var i=this.addComponent(ProxyPartsComponent,{component:Config.bonusWorlds.find(function(e){return"thanksgivingday2022world1"==e.get("name")}).getComponent("parts")});this.addComponent(ForgeComponent,Thanksgivingday2022WorldConfigs.getForgeConfig(this,i));this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]}),this.addComponent(PartShopComponent,Thanksgivingday2022WorldConfigs.getPartShopComponentConfig(this)),this.addComponent(DroppersAgency,Thanksgivingday2022WorldConfigs.getDropperAgencyComponentConfig(this,i)),this.addComponent(TakePrizeAnimationComponent,Thanksgivingday2022WorldConfigs.getTakePrizeAnimationComponentConfig(this)),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,once:"beforeEnter",talkKey:1,id:2},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",elements:[{el:".scrolledBlock .background2",persistentClass:"tgd4"}],id:3},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:2,id:4},{type:StoryTalkElement,once:"onFinishLevel5",talkKey:3,id:5},{type:StoryAnimationElement,owner:this,once:"onFinishLevel5",elements:[{el:".scrolledBlock .background3",persistentClass:"tgd4"}],id:6},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:4,id:7},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",elements:[{el:".scrolledBlock .background4",persistentClass:"tgd4"}],id:8},{type:StoryTalkElement,once:"onFinishLevel12",talkKey:5,id:9},{type:StoryAnimationElement,owner:this,once:"onFinishLevel15",elements:[{el:".scrolledBlock .background5",persistentClass:"tgd4"}],id:10},{type:StoryTalkElement,once:"onFinishLevel15",talkKey:6,id:11},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onFinishLevel15",params:{groupPrize:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize,showAnimatedPrizesWindow:!0},delayAfter:0,id:12},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.thanksgivingday2022world4 .startCurrentLevel",name:this.get("name")+"Force0",id:200},{type:StoryForceElement,once:"onCompleteLevel1",id:202,el:".thanksgivingday2022world4 .mForgeBtn",name:this.get("name")+"Force2",isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}},{type:StoryForceElement,once:"onCompleteLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203,isAvailable:function(){return Thanksgivingday2022WorldConfigs.forgeStoryIsAvailable(t)}}]}),this.addComponent(RunWorldComponent)},hasTimer:function(){return!0},getTimer:function(){return this.get("endDate")/1e3-application.getCurrentServerTime()},onClosingSoon:function(){}}),pRe,qRe;figureRulesProcess.thanksgivingday2022world4BonusClasses=function(){FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world4/artifactPart.b42996efda.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_thanksgivingday2022world4 .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("thanksgivingday2022world4","ground_foodbox"),featuresAdder.addFeature("thanksgivingday2022world4","dropcell_fruitbasket"),featuresAdder.addFeature("thanksgivingday2022world4","strongbox_catsafe"),featuresAdder.addFeature("thanksgivingday2022world4","floor_flour"),featuresAdder.addFeature("thanksgivingday2022world4","iceberg_berry"),featuresAdder.addFeature("thanksgivingday2022world4","frozenegg_berry"),featuresAdder.addFeature("thanksgivingday2022world4","snail_newyearsnail"),featuresAdder.addFeature("thanksgivingday2022world4","frog_steamtrain"),featuresAdder.addFeature("thanksgivingday2022world4","fishball_mysteryball"),featuresAdder.addFeature("thanksgivingday2022world4","chocolate_dough"),featuresAdder.addFeature("thanksgivingday2022world4","alligator_oven")},figureRulesProcess.additionalBonusScaleImages=(pRe=figureRulesProcess.additionalBonusScaleImages,function(){pRe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/thanksgivingday2022world4/artifactPlatform.9da3162586.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(qRe=figureRulesProcess.additionalBonusClasses,function(){qRe.call(this),figureRulesProcess.thanksgivingday2022world4BonusClasses()});var Birthday2022WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar").clone();e.appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper")),this.prizeControllerProgressbar=new PrizeControllerOuterAnimatedProgressBar({el:e,model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var t=this.model.getComponent(PrizeController);if(t){var i=$("#prizeControllerTemplates .prizeInfoBox").clone(),o=this.$(".prizesInfoContainer");o.addClass(this.model.get("name")),i.appendTo(o),i.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:i,model:t})}this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<2;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn(),this.updateRandomLevelBtn(),this.updatePrizesFinishedClass(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.on("prizeControllerBeforeTakePrize",this.updateProgress,this),this.model.on("change:hasBattlePass",this.updateSpriteSkins,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateStartBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this),this.updateProgressBar(),this.createSpines()},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("afterChangeLocation",this.updateStartBtn,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.off("prizeControllerBeforeTakePrize",this.updateProgress,this),this.model.off("change:hasBattlePass",this.updateSpriteSkins,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateStartBtn,this),e.off("change:points",this.updatePrizesFinishedClass,this)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()&&e.getPoints()<e.getMaxPointsPossible()),this.$randomBtn.find(".mRandomLevelBtnText").html(t)},updateStartBtn:function(){this.model.getComponent(PrizeController);var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode"))},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())},updateProgressBar:function(){this.prizeControllerProgressbar.update()},createSpines:function(){var e=this,t=_.after(2,function(){return e.updateProgress()}),i="//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Piratka.271f831216.png",o="//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Persik.29a8fe90dd.png";this.girl=new spine.SpineWidget($(".mapAnimationsMiddle .spine1").get(0),{x:400,y:100,addX:void 0,addY:void 0,scale:.33,loop:!0,fitToCanvas:!1,alpha:!0,premultipliedAlpha:!1,backgroundColor:"#00000000",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Piratka.68800ddbee.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Piratka.178e627970.json",atlasPages:[i.substring(i.lastIndexOf("/")+1)],textureFileName:i.substring(i.lastIndexOf("/")+1),animation:"Idle",skin:this.model.get("hasBattlePass")?"piratka_cook":"piratka_base",error:function(e){console.log("[birthday2022bonusworld]    Piratka  ")},success:function(){t()}}),this.girl.play(),this.cat=new spine.SpineWidget($(".mapAnimationsMiddle .spine2").get(0),{x:150,y:50,addX:void 0,addY:void 0,scale:.5,loop:!0,fitToCanvas:!1,alpha:!0,premultipliedAlpha:!1,backgroundColor:"#00000000",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Persik.27c3bbd0b6.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebirthday2022world/spine/Persik.d57a9f75be.json",atlasPages:[o.substring(o.lastIndexOf("/")+1)],textureFileName:o.substring(o.lastIndexOf("/")+1),animation:"Idle",skin:this.model.get("hasBattlePass")?"no_watch+hat":"no_watch+no_hat",error:function(e){console.log("[birthday2022bonusworld]    Persik  ")},success:function(){t()}}),this.cat.play()},updateProgress:function(){var e=this.model.get("location"),t=this.getPhaseByProgress();1==e&&(1==t&&(this.girl.setAnimation("Idle"),this.cat.setAnimation("Idle")),2==t&&(this.girl.setAnimation("knead_the_dough"),this.cat.setAnimation("cat_reads+blinking")),3==t&&(this.girl.setAnimation("mixer"),this.model.get("hasBattlePass")?this.cat.skeleton.setSkinByName("watch+hat"):this.cat.skeleton.setSkinByName("watch+no_hat"),this.cat.setAnimation("cat_looks_at_the_clock")),4==t&&(this.girl.setAnimation("Idle"),this.model.get("hasBattlePass")?this.cat.skeleton.setSkinByName("no_watch+hat"):this.cat.skeleton.setSkinByName("no_watch+no_hat"),this.cat.setAnimation("Idle")),$(".mapAnimationsMiddle").removeClass("phase2 phase3 phase4").addClass("phase".concat(t)))},getPhaseByProgress:function(){var e=this.model.getComponent("prizes").getProgress();return 0<=e&&e<3?1:3<=e&&e<8?2:8<=e&&e<13?3:13<=e&&e<18?4:-1},updateSpriteSkins:function(){this.model.get("hasBattlePass")?(this.girl.skeleton.setSkinByName("piratka_cook"),this.cat.skeleton.setSkinByName("no_watch+hat")):(this.girl.skeleton.setSkinByName("piratka_base"),this.cat.skeleton.setSkinByName("no_watch+no_hat"))}}),Birthday2022World=BonusWorld.extend({defaults:_.defaults({name:"birthday2022world",viewId:Birthday2022WorldView,version:20220819,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:23,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[],livesInstance:new BonusWorldLives,livesConfig:{lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300},endDate:new Date("2022/10/07 12:00"),helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",progressComponent:ProgressSimpleIncrementComponent,noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"finalPrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:86400,goodId:GoodTypes.unlimitedKeys},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";UserPrizes.convertFromCocos(this.get("finishPrize")),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()})}),this.addComponent(ReturnWorldComponent),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!1,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,isOpenPrizePage:!1,accountant:new PrizeProgressAccount([50,200,200,300,400,500,400,500,300,400,600,200,300,400,300,400,300,400,500,600,700,500,400,600,500,600,400,500,600,1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:900}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:12,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"SpinProduct",amount:1}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1200}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:250},{type:"SpinProduct",amount:1}]},{progress:22,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:24,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:25,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:26,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:27,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:28,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:29,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:30,type:"finalPrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ColorCellCollector({world:this,color:"Y"}),new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:7,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:12}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:9,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:16}],parts:o.getParts()})]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new EventCause({event:"prizeControllerBeforeTakePrize18"})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:2,condition:function(){return!0}}]})]}),this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16},{type:"PrizePointsProduct",amount:1e3}]}}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),needShowComicButton:!0,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.birthday2022world .animationSprite1",persistentClass:"visible1"}],id:2},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.birthday2022world .animationSprite2",persistentClass:"visible1"}],id:4},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2,id:5},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.birthday2022world .animationSprite3",persistentClass:"visible1"}],id:6},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3,id:7},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.birthday2022world .animationSprite4",persistentClass:"visible1"}],id:8},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4,id:9},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"beforeEnter",delayAfter:4e3,id:204},{type:StoryTalkElement,owner:this,once:"enter",delay:500,talkKey:5,id:10},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.birthday2022world",persistentClass:"disappear"}],id:11},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".bonusWorldAnimations.birthday2022world",persistentClass:"hidden"}],id:100},{type:StoryTalkElement,owner:this,once:"onCompleteLevelAfterDelay2",talkKey:6,id:12},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:7,id:13},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:8,id:14},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:9,id:15},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:10,id:16},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:11,id:17},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:12,id:18},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize3",elements:[{el:".mapAnimationsMiddle",persistentClass:"phase2"}],id:19},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize3",owner:this,talkKey:13,id:20},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize8",elements:[{el:".mapAnimationsMiddle",persistentClean:"phase2",persistentClass:"phase3"}],id:21},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize8",owner:this,talkKey:14,id:22},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize13",elements:[{el:".mapAnimationsMiddle",persistentClean:"phase3",persistentClass:"phase4"}],id:23},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize13",owner:this,talkKey:15,id:24},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize18",elements:[{el:".scrolledBlock .background",className:"fadeOut"},{el:".scrolledBlock .background2",className:"fadeIn"},{el:".scrolledBlock .background2",persistentClass:"phase5"},{el:".mapAnimationsMiddle",persistentClean:"phase4",persistentClass:"phase5"}],id:25},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize18",owner:this,talkKey:16,id:26},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize23",elements:[{el:".scrolledBlock .background2",className:"fadeOut"},{el:".scrolledBlock .background3",className:"fadeIn"},{el:".scrolledBlock .background3",persistentClass:"phase6"},{el:".mapAnimationsMiddle",persistentClean:"phase5",persistentClass:"phase6"}],id:27},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize23",owner:this,talkKey:17,id:28},{type:StoryAnimationElement,once:"prizeControllerBeforeTakePrize28",elements:[{el:".mapAnimationsMiddle",persistentClean:"phase6",persistentClass:"phase7"}],id:29},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize28",owner:this,talkKey:18,id:30},{type:StoryAnimationElement,once:"prizeControllerBeforeTakePrize29",elements:[{el:".mapAnimationsMiddle",persistentClean:"phase7",persistentClass:"phase8"}],id:31},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize29",owner:this,talkKey:19,id:32},{type:StoryAnimationElement,owner:this,once:"prizeControllerBeforeTakePrize30",elements:[{el:".mapAnimationsMiddle .sprite11",className:"fadeOut"}],id:33},{type:StoryTalkElement,once:"prizeControllerBeforeTakePrize30",owner:this,talkKey:20,id:34},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,picture:"photograph"},owner:this,once:"prizeControllerBeforeTakePrize30",id:35},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize30",params:{noTakePrize:!0,groupPrize:!0,prize:this.prizeController.getPrizeByProgress(this.prizeController.getMaxProgress()).prize},delayAfter:0,id:36},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevelAfterDelay80",params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0},delayAfter:0,id:37},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onCompleteLevelAfterDelay80",delayAfter:0,id:38},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.birthday2022world .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,on:"onCompleteLevelAfterDelay2",id:202,el:".birthday2022world .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevelAfterDelay2",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203},{type:StoryForceElement,owner:this,once:"onCompleteLevelAfterDelay1",id:205,el:".bonusWorldUI.birthday2022world .startCurrentLevel",name:this.get("name")+"Force1"}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500},PrizePointsProduct:{target:function(){return t.view.$el.find(".prizeControllerOuterProgressBar .markSmall")},duration:1500,after:function(){return t.view.updateProgressBar()}}}}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]}]})},episodeChanged:function(){return!0},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this;BonusWorld.prototype.onCompleteBonusWorldLevelBeforeStatistic.call(this,e,t),application.waitPage("main").then(function(){return delay(500)}).then(function(){return i.trigger("onCompleteLevelAfterDelay"+e,i,e,t)})}}),uSe,zSe,GSe,JSe,KSe;GravityGroundCell.prototype.animateTakeLife=(uSe=GravityGroundCell.prototype.animateTakeLife,function(t){if("birthday2022world"!==episode.get("num"))return uSe.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),PumpkinCell.prototype.animateTakeLife=(zSe=PumpkinCell.prototype.animateTakeLife,function(e){var t=this;if("birthday2022world"===episode.get("num")){var i=Math.round(this.life/this.maxLife*(46/60*Config.cellWidth));this.$div.find(".lifeBar").set("width",i),this.$div.removeClass("less50PercentLife less25PercentLife"),this.$div.find(".lifeBar").removeClass("less50PercentLife less25PercentLife");var o=50<Math.round(100*t.life/t.maxLife)?"less100PercentLife":Math.round(100*t.life/t.maxLife)<=25?"less25PercentLife":Math.round(100*t.life/t.maxLife)<=50&&"less50PercentLife";o&&(this.$div.addClass(o),this.$div.find(".lifeBar").addClass(o))}return zSe.call(this,e)}),PumpkinCell.prototype.animateRemoval=(GSe=PumpkinCell.prototype.animateRemoval,function(e){return this.$div.find(".lifeBlock").remove(),GSe.call(this,e)}),figureRulesProcess.birthday2022worldBonusClasses=function(){var e;FigureRules.add(".episode_birthday2022world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_birthday2022world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_birthday2022world .cell.color_Y",{"background-image":"../../../gems/site/img/features/birthday2022world/color_Y.png"}),FigureRules.add(".episode_birthday2022world .bomb.color_Y",{"background-image":""}),FigureRules.add(".episode_birthday2022world .sail .taskIconContainer .taskIco.color_Y",{"background-image":"../../../gems/site/img/features/birthday2022world/color_Y.png"}),FigureRules.add(".episode_birthday2022world .fortHeadCell .taskIconContainer .taskIco.color_Y",{"background-image":"../../../gems/site/img/features/birthday2022world/color_Y.png"}),FigureRules.add(".episode_birthday2022world .fortHeadCell .taskIconContainer .taskIco.color_CollectCaviar",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyTask.png","background-height":180,"background-width":180,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".episode_birthday2022world .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":302,"background-height":402,width:302/180*Config.cellWidth,height:402/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/birthday2022world/strongbox_xlarge.png","margin-left":-75/180*Config.cellWidth,"margin-top":-175/180*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .strongboxCellLoot",{"background-position-x":0,"background-width":230,"background-height":329,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/birthday2022world/strongboxCollectItem.png","margin-left":-34/180*Config.cellWidth,"margin-top":-1*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:10,spriteFrames:10,duration:500}),FigureRules.add(".episode_birthday2022world .caviarCell .cellStone",{"background-width":57,"background-height":62,width:.95*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":-2/60*Config.cellWidth}),FigureRules.add(".episode_birthday2022world .caviarCell.caviarCell3 .cellStone",{frame:0}),FigureRules.add(".episode_birthday2022world .caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".episode_birthday2022world .caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".episode_birthday2022world .caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".episode_birthday2022world .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyR.png"}),FigureRules.add(".episode_birthday2022world .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyG.png"}),FigureRules.add(".episode_birthday2022world .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyB.png"}),FigureRules.add(".episode_birthday2022world .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyY.png"}),FigureRules.add(".episode_birthday2022world .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyP.png"}),FigureRules.add(".episode_birthday2022world .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/birthday2022world/jellyW.png"}),FigureRules.add(".episode_birthday2022world .sail .taskIconContainer .taskIco.color_CollectCaviar",{"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/jellyTask.png","background-width":180,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".episode_birthday2022world .decorator_chocolate.stable",{"background-position-x":936,"background-position-y":0,"background-width":104,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2022world/doughAppear.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-22/60*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2022world/doughAppear.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-22/60*Config.cellHeight,spriteFrames:10,duration:800}),FigureRules.add(".episode_birthday2022world .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":103,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2022world/doughDie.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_birthday2022world .coinChestHeadCell",{width:393/180*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-16.5/180*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"../../../gems/site/img/features/birthday2022world/candyChest.png"}),FigureRules.add(".episode_birthday2022world .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_birthday2022world .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_birthday2022world .attribute_coin",{"background-image":"../../../gems/site/img/features/birthday2022world/candy.png"}),FigureRules.add(".episode_birthday2022world .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/birthday2022world/candy.png"}),FigureRules.add(".episode_birthday2022world .decorator_greedypirate",{"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .move_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,lastFrame:2,duration:130,playRound:!1}),FigureRules.add(".episode_birthday2022world .grab_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:7,framesOrder:[3,4,5,6,7,8,9],duration:500,playRound:!1}),FigureRules.add(".episode_birthday2022world .decorator_greedypirate.hasCoins",{"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate2.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".episode_birthday2022world .decorator_greedypirate .coins",{opacity:0,font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#ffffff","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_birthday2022world .sleep_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!0}),FigureRules.add(".episode_birthday2022world .hit_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/birthday2022world/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:2,lastFrame:2,framesOrder:[5,6],duration:250,playRound:!1}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/birthday2022world/berry1.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/birthday2022world/berry2.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/birthday2022world/berry3.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/birthday2022world/berry1.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/birthday2022world/berry2.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbig1",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/birthday2022world/berrybig1.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbig2",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/birthday2022world/berrybig2.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbig3",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/birthday2022world/berrybig3.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigHorizontal1",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigHorizontal.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigHorizontal2",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigHorizontal.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigHorizontal3",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":540,"background-height":361,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigHorizontal.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigVertical1",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigVertical.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigVertical2",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigVertical.png"}),FigureRules.add(".episode_birthday2022world .frozen_frozenegg.variantbigVertical3",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":361,"background-height":540,"background-image":"../../../gems/site/img/features/birthday2022world/berryBigVertical.png"}),FigureRules.add(".episode_birthday2022world .icebergCellBg",{"background-image":"../../../gems/site/img/features/birthday2022world/iceberg.png"}),FigureRules.add(".episode_birthday2022world .icebergExplode",{"background-image":"../../../gems/site/img/features/birthday2022world/icebergDie.png"}),FigureRules.add(".episode_birthday2022world .flyingIceShard",{"background-image":"../../../gems/site/img/features/birthday2022world/icebergShard.png"}),FigureRules.add(".episode_birthday2022world .gravityGroundCell",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,frame:2,"background-image":"../../../gems/site/img/features/birthday2022world/ground.png"}),FigureRules.add(".episode_birthday2022world .gravityGroundCell.gravityGroundLife2",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,frame:1,"background-image":"../../../gems/site/img/features/birthday2022world/ground.png"}),FigureRules.add(".episode_birthday2022world .gravityGroundCell.gravityGroundLife1",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,frame:2,"background-image":"../../../gems/site/img/features/birthday2022world/ground.png"}),FigureRules.add(".episode_birthday2022world .groundLife2.gravityGroundCell",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,frame:1,"background-image":"../../../gems/site/img/features/birthday2022world/ground.png"}),FigureRules.add(".episode_birthday2022world .groundLife3.gravityGroundCell",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,frame:0,"background-image":"../../../gems/site/img/features/birthday2022world/ground.png"}),FigureRules.add(".episode_birthday2022world .groundExplode",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/birthday2022world/groundBreak.png"}),FigureRules.add(".episode_birthday2022world .attribute_ground",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/birthday2022world/groundGems.png",x:0,y:0}),FigureRules.add(".episode_birthday2022world .attribute_ground.attributeColor2",{"background-position-x":180}),FigureRules.add(".episode_birthday2022world .attribute_ground.attributeColor3",{"background-position-x":360}),FigureRules.add(".episode_birthday2022world .attribute_ground.attributeColor4",{"background-position-x":540}),FigureRules.add(".episode_birthday2022world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/groundBreak.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2022world .gravityGroundExplode2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/groundBreak.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2022world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/groundBreak.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2022world .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_birthday2022world .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":180}),FigureRules.add(".episode_birthday2022world .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":360}),FigureRules.add(".episode_birthday2022world .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":540}),FigureRules.add(".episode_birthday2022world .attribute_ground.flying",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/birthday2022world/groundGems.png",scale:.8}),FigureRules.add(".episode_birthday2022world .groundCell.explode",{spriteFrames:1,duration:1,frame:3}),FigureRules.add(".episode_birthday2022world .gravityGroundCell.explode",{spriteFrames:1,duration:1,frame:3}),FigureRules.add(".episode_birthday2022world .bugCell .bugCellBg",{width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,"background-image":"../../../gems/site/img/features/birthday2022world/cakeIdle.png","margin-left":-5/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/birthday2022world/cakeIdle.png",width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,spriteFrames:10,lastFrame:0,duration:700,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_birthday2022world .bugCell .bugCellBg.blink",{animation:null}),FigureRules.add(".episode_birthday2022world .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/birthday2022world/cakeAngry.png",spriteFrames:8,lastFrame:0,duration:500}),FigureRules.add(".episode_birthday2022world .bugCell .bugCellBg.die",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugDie_xlarge.a019589917.png",spriteFrames:8,duration:800}),FigureRules.add(".episode_birthday2022world .bugCell .mTask1 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/jellyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_birthday2022world .bugCell .mTask2 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/berryTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_birthday2022world .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"../../../gems/site/img/features/birthday2022world/flour1.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"../../../gems/site/img/features/birthday2022world/flour2.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":220,"background-height":220,"background-image":"../../../gems/site/img/features/birthday2022world/flour3.png",width:220/180*Config.cellWidth,height:220/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_birthday2022world .floorLevelAnimation3, .episode_birthday2022world .floorLevelAnimation2, .episode_birthday2022world .floorLevelAnimation1",{"background-position-x":0,"background-position-y":0,"background-width":219,"background-height":240,"background-image":"../../../gems/site/img/features/birthday2022world/flourDie.png",width:219/180*Config.cellWidth,height:240/180*Config.cellHeight,"margin-left":-10/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:6,duration:350}),FigureRules.add(".episode_birthday2022world .attribute_key",(_defineProperty(e={width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"margin-left":0,"margin-top":0},"margin-left",0),_defineProperty(e,"margin-top",-.25*Config.cellHeight),_defineProperty(e,"width",Config.cellWidth),_defineProperty(e,"height",Config.cellHeight),_defineProperty(e,"background-image","../../../gems/site/img/features/birthday2022world/candyHalloween2020.png"),e)),FigureRules.add(".episode_birthday2022world .chestCell",{"background-width":180,"background-height":234,width:Config.cellWidth,height:1.3*Config.cellHeight,"margin-top":-.325*Config.cellHeight,"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2022world .chestCell .microStones",{"background-image":""}),FigureRules.add(".episode_birthday2022world .chestColor_R",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_R.png"}),FigureRules.add(".episode_birthday2022world .chestColor_G",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_G.png"}),FigureRules.add(".episode_birthday2022world .chestColor_B",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_B.png"}),FigureRules.add(".episode_birthday2022world .chestColor_P",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_P.png"}),FigureRules.add(".episode_birthday2022world .chestColor_Y",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_Y.png"}),FigureRules.add(".episode_birthday2022world .chestColor_W",{"background-image":"../../../gems/site/img/features/birthday2022world/chest_W.png"}),FigureRules.add(".episode_birthday2022world .chestCell.beforeRemove",{"background-position-x":0,spriteFrames:6,duration:700,playRound:!1}),FigureRules.add(".episode_birthday2022world .chestCell.afterRemove",{"background-position-x":1080,spriteFrames:3,duration:700,playRound:!1}),FigureRules.add(".episode_birthday2022world .chestCell .needToOpen",{"text-left":.5*Config.cellWidth,"text-top":73/60*Config.cellHeight,font:"bold "+16/60*Config.cellWidth+"px/"+20/60*Config.cellWidth+"px Marvin",color:"#ffffff",textAlign:"center"}),FigureRules.add(".episode_birthday2022world .chestCell .needToOpen.twoDigit",{"text-left":.5*Config.cellWidth,"text-top":1.2*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px Marvin",color:"#ffffff",textAlign:"center"}),FigureRules.add(".episode_birthday2022world .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/garment1.png"}),FigureRules.add(".episode_birthday2022world .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/garment2.png"}),FigureRules.add(".episode_birthday2022world .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/garment3.png"}),FigureRules.add(".episode_birthday2022world .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2022world/garment4.png"})},figureRulesProcess.additionalBonusScaleImages=(JSe=figureRulesProcess.additionalBonusScaleImages,function(){JSe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/birthday2022world/color_Y.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/strongbox_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/greedyPirate2.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/candy.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/candyChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/ground.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/groundBreak.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/flour1.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/flour2.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/flour3.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/flourDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/candyHalloween2020.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_R.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_G.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_B.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_P.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_Y.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/chest_W.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/iceberg.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/icebergDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/icebergShard.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2022world/jellyTask.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(KSe=figureRulesProcess.additionalBonusClasses,function(){KSe.call(this),figureRulesProcess.birthday2022worldBonusClasses()});var SimpleSnatchView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this)},onEnter:function(){var e=this;BonusWorldView.prototype.onEnter.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onCompleteLevel:function(){var e=this;BonusWorldView.prototype.onCompleteLevel.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onGameFailed:function(){var e=this;episode.isBonusWorld()&&"simplesnatch"===episode.getEpisodeName()&&"game"===application.get("page")&&application.once("main",function(){setTimeout(function(){return e.scrollToTargetLevel()},1e3)},this)},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1))}}),SimpleSnatch=BonusWorld.extend({defaults:_.defaults({name:"simplesnatch",viewId:SimpleSnatchView,version:20230228,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:14,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,skipLevelPublication:!0,actionQueue:new ActionQueue,alwaysCancelNext:!1,force:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:50},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:14,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:22,prize:[{type:"coins",amount:100},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:30,prize:[{type:"coins",amount:300,cssClass:"coins"},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0,groupPrize:!0}},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite3",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite5",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.simplesnatch .animationSprite1",persistentClass:"shaking"},{el:".bonusWorldAnimations.simplesnatch .animationSprite2",persistentClass:"shaking"},{el:".bonusWorldAnimations.simplesnatch .animationSprite3",persistentClass:"shaking"},{el:".bonusWorldAnimations.simplesnatch .animationSprite4",persistentClass:"shaking"},{el:".bonusWorldAnimations.simplesnatch .animationSprite5",persistentClass:"shaking"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:5},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.simplesnatch",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.simplesnatch",persistentClass:"hidden"}],id:100},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.simplesnatch .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,once:"onCompleteLevel3",talkKey:6},{type:StoryTalkElement,owner:this,once:"onCompleteLevel8",talkKey:7},{type:StoryTalkElement,owner:this,once:"onCompleteLevel14",talkKey:8},{type:StoryTalkElement,owner:this,once:"onCompleteLevel22",talkKey:9},{type:StoryTalkElement,owner:this,once:"onCompleteLevel30",talkKey:10},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel30",id:210,params:{groupPrize:!0,prize:this.get("prizes")[4].prize,showAnimatedPrizesWindow:!0}}]}),this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(AdvertComponent,{timeAfterStart:86400})},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)}}),ZSe,$Se;figureRulesProcess.simplesnatchBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(ZSe=figureRulesProcess.additionalBonusClasses,function(){ZSe.call(this),figureRulesProcess.simplesnatchBonusClasses(),FigureRules.add(".episode_simplesnatch .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/simplesnatch/special8.png"}),FigureRules.add(".episode_simplesnatch .decorator_chocolate.stable",{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/simplesnatch/chocolateAppear.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add(".episode_simplesnatch .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/simplesnatch/chocolateAppear.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_simplesnatch .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/simplesnatch/chocolateDie.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_simplesnatch .coinChestHeadCell",{"background-image":"../../../gems/site/img/features/simplesnatch/coinChest_large.png","background-position-x":0,"background-position-y":0,"background-width":393,"background-height":360,width:393/180*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".episode_simplesnatch .attribute_coin",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/simplesnatch/coin.png",scale:.8}),FigureRules.add(".episode_simplesnatch .attribute_coin_remove",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/simplesnatch/coin.png"}),FigureRules.add(".episode_simplesnatch .fish5.fishcellBg",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/simplesnatch/special2.png"}),FigureRules.add(".episode_simplesnatch .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/simplesnatch/pigmyStable.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:6,framesOrder:[0,1,2,1,2,0],duration:500,playRound:!0,delay:[3e3,2e3]}),FigureRules.add(".episode_simplesnatch .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/simplesnatch/pigmyHit.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:500,playRound:!1}),FigureRules.add(".episode_simplesnatch .alligatorSpecial",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/simplesnatch/pigmyHit.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:800,playRound:!1,animation:{params:{width:[2*Config.cellWidth,.5*Config.cellWidth],height:[2*Config.cellHeight,.5*Config.cellHeight],"margin-left":[0,.75*Config.cellWidth],"margin-top":[0,.75*Config.cellHeight],opacity:[1,0]},duration:800}}),FigureRules.add(".episode_simplesnatch .alligatorLifeBlock",{"margin-top":100/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=($Se=figureRulesProcess.additionalBonusScaleImages,function(){$Se.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/simplesnatch/special8.png":_Figure.scaleKoef,"../../../gems/site/img/features/simplesnatch/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/simplesnatch/chocolateDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/simplesnatch/coin.png":_Figure.scaleKoef,"../../../gems/site/img/features/simplesnatch/coinChest_large.png":_Figure.scaleKoef,"../../../gems/site/img/features/simplesnatch/special2.png":_Figure.scaleKoef})});var FishingJune2022View=BonusWorldView.extend((_BonusWorldView$exten={initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar").clone();e.appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper")),this.prizeControllerProgressbar=new PrizeControllerOuterAnimatedProgressBar({el:e,model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var t=this.model.getComponent(PrizeController);if(t){var i=$("#prizeControllerTemplates .prizeInfoBox").clone(),o=this.$(".prizesInfoContainer");o.addClass(this.model.get("name")),i.appendTo(o),i.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:i,model:t})}this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn(),this.updatePrizesFinishedClass(),e.on("change:points",this.updateStartBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this),this.updateProgressBar()}},_defineProperty(_BonusWorldView$exten,"onEnter",function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.updatePrizesFinishedClass(),e.on("change:points",this.updatePrizesFinishedClass,this),this.updateProgressBar()}),_defineProperty(_BonusWorldView$exten,"onExit",function(){BonusWorldView.prototype.onExit.call(this),this.model.getComponent(PrizeController).off("change:points",this.updatePrizesFinishedClass,this)}),_defineProperty(_BonusWorldView$exten,"updatePrizesFinishedClass",function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())}),_defineProperty(_BonusWorldView$exten,"updateProgressBar",function(){this.prizeControllerProgressbar.update()}),_BonusWorldView$exten)),FishingJune2022=BonusWorld.extend({defaults:_.defaults({name:"fishingjune2022",viewId:FishingJune2022View,version:20220609,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:23,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[],livesInstance:new BonusWorldLives({lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300}),endDate:new Date("2022/07/21 14:00"),helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",progressComponent:ProgressSimpleIncrementComponent,noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()})}),this.addComponent(ReturnWorldComponent),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!1,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,pointEvents:[50,75],accountant:new PrizeProgressAccount([50,200,200,300,400,500,400,500,300,400,600,200,300,400,300,400,300,400,500,600,700,500,400,600,500,600,400,500,600,1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:900}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:12,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"SpinProduct",amount:1}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1200}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:250},{type:"SpinProduct",amount:1}]},{progress:22,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:24,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:25,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:26,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:27,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:28,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:29,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},this.get("finishPrize")]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ColorCellCollector({world:this,color:"G"}),new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.45,normal:.33,rare:.15,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:7,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.45,normal:.33,rare:.15,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:13}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:9,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.45,normal:.33,rare:.15,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:16}],parts:o.getParts()})]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new ForgeRecipeCompleteCause({targetNum:3,forge:this.getComponent(ForgeComponent),ignoredItems:[1]})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:1,condition:function(){return!0}},{num:2,condition:function(){return!0}},{num:3,condition:function(){return!0}}]})]}),this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16},{type:"PrizePointsProduct",amount:1e3}]}}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),needShowComicButton:!0,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.fishingjune2022 .animationSprite1",persistentClass:"visible1"}],id:2},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.fishingjune2022 .animationSprite2",persistentClass:"visible1"}],id:4},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2,id:5},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.fishingjune2022 .animationSprite3",persistentClass:"visible1"}],id:6},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3,id:7},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.fishingjune2022 .animationSprite4",persistentClass:"visible1"}],id:8},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4,id:9},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"beforeEnter",delayAfter:2e3,id:204},{type:StoryTalkElement,owner:this,once:"enter",delay:500,talkKey:5,id:10},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.fishingjune2022",persistentClass:"disappear"}],id:11},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".bonusWorldAnimations.fishingjune2022",persistentClass:"hidden"}],id:100},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",talkKey:6,id:12},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:7,id:13},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:8,id:14},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:9,id:15},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:10,id:16},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:11,id:17},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:12,id:18},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:13,id:19},{type:StoryTalkElement,on:"beforeChangeLocation",talkKey:14,id:20},{type:StoryTalkElement,on:"enterLocation1",talkKey:15,id:21},{type:StoryTalkElement,on:"enterLocation2",talkKey:16,id:22},{type:StoryTalkElement,on:"enterLocation3",talkKey:17,id:23},{type:StoryTalkElement,on:"pointsProgress50",talkKey:18,id:24},{type:StoryTalkElement,on:"pointsProgress75",talkKey:19,id:25},{type:StoryTalkElement,on:"allPrizesCollected",talkKey:20,id:26},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"allPrizesCollected",params:{noTakePrize:!0,groupPrize:!0,prize:this.get("finishPrize").products},delayAfter:0,id:27},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.fishingjune2022 .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,on:"onFinishLevel2",id:201,el:".bonusWorldUI.fishingjune2022 .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,on:"onFinishLevel3",id:202,el:".fishingjune2022 .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onFinishLevel3",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500},PrizePointsProduct:{target:function(){return t.view.$el.find(".prizeControllerOuterProgressBar .markSmall")},duration:1500,after:function(){return t.view.updateProgressBar()}}}}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]}]})},episodeChanged:function(){return!0}}),GTe,LTe,STe,UTe,VTe;GravityGroundCell.prototype.animateTakeLife=(GTe=GravityGroundCell.prototype.animateTakeLife,function(t){if("fishingjune2022"!==episode.get("num"))return GTe.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),PumpkinCell.prototype.animateTakeLife=(LTe=PumpkinCell.prototype.animateTakeLife,function(e){var t=this;if("fishingjune2022"===episode.get("num")){var i=Math.round(this.life/this.maxLife*(46/60*Config.cellWidth));this.$div.find(".lifeBar").set("width",i),this.$div.removeClass("less50PercentLife less25PercentLife"),this.$div.find(".lifeBar").removeClass("less50PercentLife less25PercentLife");var o=50<Math.round(100*t.life/t.maxLife)?"less100PercentLife":Math.round(100*t.life/t.maxLife)<=25?"less25PercentLife":Math.round(100*t.life/t.maxLife)<=50&&"less50PercentLife";o&&(this.$div.addClass(o),this.$div.find(".lifeBar").addClass(o))}return LTe.call(this,e)}),PumpkinCell.prototype.animateRemoval=(STe=PumpkinCell.prototype.animateRemoval,function(e){return this.$div.find(".lifeBlock").remove(),STe.call(this,e)}),figureRulesProcess.fishingjune2022BonusClasses=function(){FigureRules.add(".episode_fishingjune2022 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/artifactPart.3cbf898e41.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_fishingjune2022 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_fishingjune2022 .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/catSafe_xlarge.b0350db625.png","margin-left":-.25*Config.cellWidth,"margin-top":-125/180*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .strongboxCellLoot",{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/catSafeCollectItem.29135bc9b6.png","margin-left":-22/180*Config.cellWidth,"margin-top":-75/180*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .cell.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/color_G.0c8367e738.png"}),FigureRules.add(".episode_fishingjune2022 .bomb.color_G",{"background-image":""}),FigureRules.add(".episode_fishingjune2022 .sail .taskIconContainer .taskIco.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/color_G.0c8367e738.png"}),FigureRules.add(".episode_fishingjune2022 .fortHeadCell .taskIconContainer .taskIco.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/color_G.0c8367e738.png"}),FigureRules.add(".episode_fishingjune2022 .decorator_chocolate.stable",{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/chocolateAppear.e4ace34074.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/chocolateAppear.e4ace34074.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_fishingjune2022 .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/chocolateDie.f7003a6c8e.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_fishingjune2022 .attribute_key",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/attribute_blotchkey.92136decbc.png"}),FigureRules.add(".episode_fishingjune2022 .pumpkinCell",{"background-image":""}),FigureRules.add(".episode_fishingjune2022 .pumpkin",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/jellyfish.827e72b9d9.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_fishingjune2022 .pumpkin.pumpkinShot",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/jellyfish.827e72b9d9.png",spriteFrames:12,duration:800}),FigureRules.add(".episode_fishingjune2022 .pumpkin.pumpkinDamage",{spriteFrames:1,playRound:!1,duration:1}),FigureRules.add(".episode_fishingjune2022 .pumpkinFire",{opacity:0}),FigureRules.add(".episode_fishingjune2022 .pumpkin.pumpkinDie",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/jellyfish.827e72b9d9.png",spriteFrames:1,duration:1,animation:{params:{width:[1*Config.cellWidth,.25*Config.cellWidth],height:[1*Config.cellHeight,.25*Config.cellHeight],"margin-left":[0*Config.cellWidth,20/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,20/60*Config.cellHeight],opacity:[1,0]},duration:500}}),FigureRules.add(".episode_fishingjune2022 .pumpkin .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/lifeBlock.e80b9c4868.png",width:56/60*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":.75*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .pumpkin .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:5/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .pumpkin .pumpkinLife",{opacity:0}),FigureRules.add(".episode_fishingjune2022 .pumpkin .less50PercentLife.lifeBar",{"background-color":"#ffff00"}),FigureRules.add(".episode_fishingjune2022 .pumpkin .less25PercentLife.lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_fishingjune2022 .cannonball",{"background-position-x":0,"background-position-y":0,"background-width":65,"background-height":79,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/inkParticle.974cab3d5a.png",width:65/180*Config.cellWidth,height:79/180*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .cannonball.cannonballExplosion",{opacity:0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottle.d98b88fe30.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.gravityGroundLife2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.gravityGroundLife1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.gravityGroundLife1 .attributeIcon1, .episode_fishingjune2022 .gravityGroundCell.gravityGroundLife1 .attributeIcon2, .episode_fishingjune2022 .gravityGroundCell.gravityGroundLife1 .attributeIcon3, .episode_fishingjune2022 .gravityGroundCell.gravityGroundLife1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .eelDecoratorOnCell .attributeIcon1, .episode_fishingjune2022 .eelDecoratorOnCell .attributeIcon2, .episode_fishingjune2022 .eelDecoratorOnCell .attributeIcon3, .episode_fishingjune2022 .eelDecoratorOnCell .attributeIcon4",{opacity:0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon1,.episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon2,.episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon3,.episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png",frame:1}),FigureRules.add(".episode_fishingjune2022 .groundLife2.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .groundLife1.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .attribute_ground",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapInside.8ceb4c6705.png","margin-left":-4,"margin-top":-3,scale:1}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .attribute_ground.attributeColor1",{"background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell.explode",{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_fishingjune2022 .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundExplode2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleBreak.1a882ad83c.png"}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":180}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":360}),FigureRules.add(".episode_fishingjune2022 .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":540}),FigureRules.add(".episode_fishingjune2022 .cork",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/cork.0383f7ca25.png"}),FigureRules.add(".episode_fishingjune2022 .attribute_ground.flying",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png","background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .attribute_ground.flying.attributeColor1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png","background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .attribute_ground.flying.attributeColor2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png","background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .attribute_ground.flying.attributeColor3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png","background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .attribute_ground.flying.attributeColor4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png","background-position-x":0}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse",{"background-position-y":0,"background-width":181,"background-height":189,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishAnimation.2a371dcba5.png",width:127/180*Config.cellWidth,height:132/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,"scale-x":-1}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse.takeLife",{"background-position-x":543,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_fishingjune2022 .move_crabMouse, .episode_fishingjune2022 .crabMouseCollect",{"scale-x":-1,"background-position-x":1086,"background-position-y":0,"background-width":181,"background-height":189,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishAnimation.2a371dcba5.png",width:127/180*Config.cellWidth,height:132/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,spriteFrames:12,duration:500,playRound:!0}),FigureRules.add(".episode_fishingjune2022 .move_crabMouse.moveRight",{"scale-x":1,"margin-left":.25*Config.cellWidth}),FigureRules.add(".episode_fishingjune2022 .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse .lifeBlock",{"scale-x":-1,"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":-2/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#ff0"}),FigureRules.add(".episode_fishingjune2022 .decorator_crabMouse.lifeLevel1 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_fishingjune2022 .groundCell .decorator",{"margin-left":.1*Config.cellWidth,"margin-top":.1*Config.cellWidth}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":179,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishCoral.f5b69d1be3.png",width:1*Config.cellWidth,height:179/180*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmCellCrabMouse",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishSpawn.f772a0a634.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel0 .crabMouseFarmCellCrabMouse.stable",{"background-image":""}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":540,spriteFrames:1,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":720,spriteFrames:1,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":0,spriteFrames:3,duration:100,delay:[0,0]}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":540,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_fishingjune2022 .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":720,spriteFrames:1,duration:100,delay:[0,0]})},figureRulesProcess.additionalBonusScaleImages=(UTe=figureRulesProcess.additionalBonusScaleImages,function(){UTe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/catSafe_xlarge.b0350db625.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/catSafeCollectItem.29135bc9b6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/color_G.0c8367e738.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/chocolateAppear.e4ace34074.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/chocolateDie.f7003a6c8e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/inkParticle.974cab3d5a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottle.d98b88fe30.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleBreak.1a882ad83c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleCrack.4adafc4371.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/bottleNoCork.664b215e56.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/cork.0383f7ca25.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapFly.8c855bcf06.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/mapInside.8ceb4c6705.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishAnimation.2a371dcba5.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishingjune2022/fishSpawn.f772a0a634.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(VTe=figureRulesProcess.additionalBonusClasses,function(){VTe.call(this),figureRulesProcess.fishingjune2022BonusClasses()});var HappyNewYear2021PrizeControllerView=PrizeControllerView.extend({render:function(){var e=this,t=_.values(this.model.getPrizesGrouped("progress"));new PrizeControllerOuterProgressBar({el:$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$(".mPrizeControllerOuterProgressBarWrapper")),model:this.model});var n=this.$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),i=$(".mainTemplates .rewardComponentPage"),o=$(".invisible.mainTemplates .progressBarByLevel"),a=this.$el.find(".freePlate"),s=this.$el.find(".battlepassPlate");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page),this.clarification=null,this.needClarify=!0;var l=i.clone(),d=o.clone();l.addClass(this.model.get("world").get("name")),l.append(d),a.html(messages.forFree),s.html(messages[this.model.get("world").get("name")+"BattlePassTitle"]),t.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("progress"+e.progress).addClass(e.type).data("id",e.cid),a){var i=n.clone();i.addClass("progress"+e.progress).addClass("placeholder"),l.append(i)}if("battlePass"===e.type||"finalPrize"===e.type){var o=r.clone();o.addClass("marker"+e.progress),o.html(e.progress),d.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.prize),isGroup:!0}),l.append(t)},this)},this),this.$wrapper.append(l),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:l,mainEl:this.$("#user"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.needClarify=!1,e.closeClarification()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("world").battlePass&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.createButton()}}),HappyNewYear2021WorldView=BonusWorldView.extend({events:_.defaults({"click .prizeControllerOuterProgressBar":"onProgressBarClick"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$el),model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var e=this.model.getComponent(PrizeController);if(e){var t=$("#prizeControllerTemplates .prizeInfoBox").clone(),i=this.$(".prizesInfoContainer");i.addClass(this.model.get("name")),t.appendTo(i),t.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:t,model:e})}this.model.cmp("gifts")&&(this.giftTrinketsView=new GiftTrinketsView({el:$(".mainTemplates .stockings").clone().appendTo(this.$el),itemTpl:$(".mainTemplates .stocking"),model:this.model.cmp("gifts")})),this.tokensController=this.model.cmp("spinTickets"),this.forgeTickets=this.model.cmp("craftTickets"),this.model.cmp("slotMachine").getMachine().on("takePrizes",this.onTakePrizes,this)},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.prizeControllerProgressbar.update(),this.updatePrizesFinishedClass(),this.updateTickets(),e.on("change:points",this.updatePrizesFinishedClass,this),this.tokensController.on("change:tickets",this.updateTickets,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.getComponent(PrizeController).off("change:points",this.updatePrizesFinishedClass,this),this.tokensController.off("change:tickets",this.updateTickets,this)},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())},updateTickets:function(){this.tokensController&&(this.$spinTokens=$(".mTokens .amount").html(this.tokensController.getTickets()))},onProgressBarClick:function(){this.model.openPrizeControllerInfo()},onTakePrizes:function(e){var t=Prize.sum.apply(Prize,_toConsumableArray(e));return new SlotMachineTakePrizeView({el:$(".mainTemplates .slotMachineTakePrizeView").clone().appendTo(this.$el),model:this.model,products:t.get("products")}).takePrize()}}),HappyNewYear2021World=BonusWorld.extend({defaults:_.defaults({name:"happynewyear2021world",viewId:HappyNewYear2021WorldView,version:20231122,production:!0,levelsInEpisode:130,durationDays:!1,episode:1,level:10,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:23,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[],livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},noArtifactPartOnReplay:!1,progressComponent:ProgressSimpleIncrementComponent},BonusWorld.prototype.defaults),initialize:function(e){var i=this;BonusWorld.prototype.initialize.call(this,e);var t="unlimitedBonusWorldLives";this.addComponent(TicketsComponent,{id:"spinTickets"}),this.addComponent(TicketsComponent,{id:"craftTickets"}),this.prizeController=this.addComponent(PrizeController,{world:this,viewClass:HappyNewYear2021PrizeControllerView,accountant:new PrizeProgressAccount([5,4,6,8,10,14,20,10,14,18,22,10,16,20,25,10,15,18,25,30,15,24,35]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:t,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"CoinsProduct",amount:100}]},{progress:4,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:7,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{progress:8,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]},{progress:9,type:"middlePrize",products:[{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:10,type:"middlePrize",products:[{type:"CoinsProduct",amount:200}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2}]},{progress:12,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:2}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2}]},{progress:17,type:"middlePrize",products:[{type:"SpinProduct",amount:2}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:150}]},{progress:22,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"}]},{progress:1,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:2,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:3,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:4,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:5,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:t,addTime:"2h"}]},{progress:6,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:7,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:8,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:9,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:10,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:11,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:12,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:13,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:14,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:15,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:t,addTime:"2h"}]},{progress:16,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:17,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:2},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:18,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]},{progress:19,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:20,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:21,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:22,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:23,type:"battlePass",products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1d"}]}]}),this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.NORMAL},{id:2,material:PartMaterial.NORMAL},{id:3,material:PartMaterial.NORMAL},{id:4,material:PartMaterial.NORMAL},{id:5,material:PartMaterial.RARE},{id:6,material:PartMaterial.RARE},{id:7,material:PartMaterial.RARE},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.LEGEND},{id:10,material:PartMaterial.LEGEND},{id:11,material:PartMaterial.LEGEND},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.TRASH},{id:14,material:PartMaterial.TRASH},{id:15,material:PartMaterial.TRASH},{id:16,material:PartMaterial.TRASH}]}),this.addComponent(ForgeComponent,{recipes:[{id:1,ingredients:[this.cmp("parts").ingredient(13,2),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(15,2),this.cmp("parts").ingredient(16,2),this.cmp("craftTickets").ingredient(20)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[this.cmp("parts").ingredient(1),this.cmp("parts").ingredient(2),this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(4),this.cmp("craftTickets").ingredient(25)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"TicketsProduct",componentId:"spinTickets",amount:10}]}]},{id:3,ingredients:[this.cmp("parts").ingredient(2),this.cmp("parts").ingredient(6),this.cmp("parts").ingredient(7),this.cmp("parts").ingredient(8),this.cmp("craftTickets").ingredient(25)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:t,addTime:"15m"}]}]},{id:4,ingredients:[this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(5),this.cmp("parts").ingredient(7),this.cmp("parts").ingredient(12),this.cmp("craftTickets").ingredient(30)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]}]},{id:5,ingredients:[this.cmp("parts").ingredient(4),this.cmp("parts").ingredient(5),this.cmp("parts").ingredient(8),this.cmp("parts").ingredient(9),this.cmp("craftTickets").ingredient(30)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[this.cmp("parts").ingredient(1),this.cmp("parts").ingredient(6),this.cmp("parts").ingredient(10),this.cmp("parts").ingredient(11),this.cmp("craftTickets").ingredient(35)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1},{type:"TicketsProduct",componentId:"spinTickets",amount:20}]}]},{id:7,ingredients:[this.cmp("parts").ingredient(9),this.cmp("parts").ingredient(10),this.cmp("parts").ingredient(11),this.cmp("parts").ingredient(12),this.cmp("craftTickets").ingredient(40)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:t,addTime:"30m"}]}]}]}),this.addComponent(PrizeMarksDropper,{chance:13,defaultMarkLimit:50}),this.addComponent(CollectorsAgency),this.cmp("collectors").add(TicketsCollector,{componentId:"spinTickets"}),this.cmp("collectors").add(ForceInstantPartsCollector,{minLevel:2,maxLevel:2,activationMove:3,perMoveChance:4,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:this.cmp("parts").getParts()}),this.cmp("collectors").add(InstantPartsCollector,{world:this,minLevel:3,activationMove:3,perMoveChance:7,onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levels:[15,20,25,30,35,40,45,50,55,60,65,70,75,80,88,90,95,100,105,110,115,120,125,130],perMoveChance:12}],parts:this.cmp("parts").getParts()}),this.battlePass=new BattlePass({world:this,catchupWindowRule:catchupWindowShowRules.everyThirdPrize,catchupWindowActivator:new EventSignal("change:progress",this.getComponent(PrizeController)),instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedBonusWorldLives},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves},{type:"TicketsProduct",componentId:"spinTickets",amount:100}]}});var o={type:"RandomPrizeAbility",cooldown:"1h",world:this,prize:new RandomPrizeCreater({name:"".concat(this.get("name"),".giftAbility"),world:this,variants:[{chance:.47,variants:[{variants:[{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:10}]},{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:20}]},{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:30}]},{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:40}]}]},{variants:[{products:[{type:"TicketsProduct",componentId:"craftTickets",amount:10}]},{products:[{type:"TicketsProduct",componentId:"craftTickets",amount:15}]},{products:[{type:"TicketsProduct",componentId:"craftTickets",amount:20}]},{products:[{type:"TicketsProduct",componentId:"craftTickets",amount:25}]},{products:[{type:"TicketsProduct",componentId:"craftTickets",amount:30}]}]},{products:[{type:"PrizePointsProduct",amount:2}]}]},{chance:.32,variants:[{products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"15m"}]},{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"15m"}]},{products:[{type:"GoodProduct",goodId:t,addTime:"15m"}]}]},{chance:.16,products:[{type:"CoinsProduct",amount:30}]},{chance:.04,variants:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}]},{chance:.01,products:[{type:"CoinsProduct",amount:200}]}]})};this.addComponent(TrinketComponent,{trinkets:[{id:1,ability:o},{id:2,ability:o},{id:3,ability:o}]}),this.addComponent(FairComponent,{id:"gifts",slots:[{id:1,inserter:new TrinketAutoInsert(this.cmp("trinkets"),[1])},{id:2,inserter:new TrinketAutoInsert(this.cmp("trinkets"),[2])},{id:3,inserter:new TrinketAutoInsert(this.cmp("trinkets"),[3])}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:1},{type:StoryTalkElement,once:"enter",delayAfter:0,talkKey:1,id:2},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},once:"spinDeclined",id:201},{type:StoryGroup,once:"enter",noRetry:!0,id:202,stories:[{type:StoryCallbackElement,callback:function(){var e={name:i.get("name")+"Force0",premadeSequence:["stocking","stocking","stocking"],el:".spinBtn"};return i.cmp("spinTickets").setTickets(100),i.cmp("slotMachine").applyForce(e)}},{type:StoryCallbackElement,callback:function(){var e=i.cmp("trinkets").getTrinketById(1).getAbility();e.setCooldown("8s"),e.set("enabled",!1);var t=new SimpleForce({name:i.get("name")+"Force1",el:".TrinketsSlot1 .stocking-wrapper",canClose:function(){return e.isCharged()}});return e.timer.once("finish",function(){t.close(),e.set("cooldown",util.duration("1h"))}),t.show()}},{type:StoryCallbackElement,callback:function(){var e=i.cmp("trinkets").getTrinketById(1).getAbility();return new SimpleForce({name:i.get("name")+"Force2",el:".TrinketsSlot1 .stocking-wrapper",canClose:function(){return e.get("enabled")},onAfterOpen:function(){e.set("enabled",!0)}}).show()}},{type:StoryCallbackElement,callback:function(){var e={name:i.get("name")+"Force3",premadeSequence:["prizeTicket","spinTicket","gift"],el:".spinBtn"};return i.cmp("slotMachine").applyForce(e)}},{type:StoryCallbackElement,callback:function(){return new SimpleForce({name:i.get("name")+"Force6",el:".happynewyear2021world_content .mPrizeControllerOuterProgressBar"}).show()}}]},{type:StoryForceElement,on:"onCompleteLevel2",id:203,el:".happynewyear2021world .mForgeBtn",name:this.get("name")+"Force4"},{type:StoryForceElement,on:"onCompleteLevel2",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force5",id:204},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel130",delayAfter:0,id:205}]}),this.addComponent(SlotMachineComponent,{sequenceStrategy:new LengthRundomSequenceStrategy({variants:[{chance:45,length:1,slots:{craftTicket:30,craftTicketLarge:25,prizeTicket:20,stocking:10,gift:10,spinTicket:5}},{chance:35,length:2,slots:{craftTicket:22.5,craftTicketLarge:20,prizeTicket:15,stocking:15,gift:15,spinTicket:12.5}},{chance:20,length:3,slots:{craftTicket:25,craftTicketLarge:20,prizeTicket:12,stocking:20,gift:17,spinTicket:6}}]}),slots:[new Slot("stocking"),new Slot("prizeTicket"),new Slot("craftTicket"),new Slot("craftTicketLarge"),new Slot("gift"),new Slot("spinTicket")],combinations:[{id:1,type:ByAmountCombination,slotName:"craftTicket",targetAmount:3,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:6}]},{id:2,type:ByAmountCombination,slotName:"craftTicket",targetAmount:2,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:2}]},{id:3,type:ByAmountCombination,slotName:"craftTicket",targetAmount:1,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:1}]},{id:4,type:ByAmountCombination,slotName:"craftTicketLarge",targetAmount:3,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:18}]},{id:5,type:ByAmountCombination,slotName:"craftTicketLarge",targetAmount:2,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:6}]},{id:6,type:ByAmountCombination,slotName:"craftTicketLarge",targetAmount:1,prize:[{type:"TicketsProduct",componentId:"craftTickets",amount:3}]},{id:7,type:ByAmountCombination,slotName:"prizeTicket",targetAmount:3,prize:new ConditionPrizeCreater({condition:function(){return!i.cmp("prizes").isFinished()},trueVariant:{products:[{type:"PrizePointsProduct",amount:8}]},falseVariant:{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:40}]}})},{id:8,type:ByAmountCombination,slotName:"prizeTicket",targetAmount:2,prize:new ConditionPrizeCreater({condition:function(){return!i.cmp("prizes").isFinished()},trueVariant:{products:[{type:"PrizePointsProduct",amount:4}]},falseVariant:{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:10}]}})},{id:9,type:ByAmountCombination,slotName:"prizeTicket",targetAmount:1,prize:new ConditionPrizeCreater({condition:function(){return!i.cmp("prizes").isFinished()},trueVariant:{products:[{type:"PrizePointsProduct",amount:2}]},falseVariant:{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:5}]}})},{id:10,type:ByAmountCombination,slotName:"spinTicket",targetAmount:3,prize:[{type:"TicketsProduct",componentId:"spinTickets",amount:100}]},{id:11,type:ByAmountCombination,slotName:"stocking",targetAmount:3,prize:new ConditionPrizeCreater({condition:function(){return i.cmp("trinkets").getTrinkets().find(function(e){return 0===e.getAmount()})},trueVariant:{products:[{type:"GiftAbilityProduct"}]},falseVariant:{products:[{type:"TicketsProduct",componentId:"spinTickets",amount:20}]}})},{id:12,type:ByAmountCombination,slotName:"gift",targetAmount:3,prize:new RandomPrizeCreater({variants:[{chance:.56,variants:[{products:[{type:"PartProduct",partId:1}]},{products:[{type:"PartProduct",partId:2}]},{products:[{type:"PartProduct",partId:3}]},{products:[{type:"PartProduct",partId:4}]}]},{chance:.32,variants:[{products:[{type:"PartProduct",partId:5}]},{products:[{type:"PartProduct",partId:6}]},{products:[{type:"PartProduct",partId:7}]},{products:[{type:"PartProduct",partId:8}]}]},{chance:.12,variants:[{products:[{type:"PartProduct",partId:9}]},{products:[{type:"PartProduct",partId:10}]},{products:[{type:"PartProduct",partId:11}]},{products:[{type:"PartProduct",partId:12}]}]}]})}],offers:[{id:"offerX1",price:20,paymentAdapter:this.cmp("spinTickets")},{id:"offerX3",multiply:3,price:60,paymentAdapter:this.cmp("spinTickets")},{id:"offerX5",multiply:5,price:100,paymentAdapter:this.cmp("spinTickets")}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]}]}),this.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!i.cmp("prizes").isFinal()})}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:100,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(i.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return i.view.$el.find(".mForgeBtn")},duration:1500},TicketsProduct:{target:function(){return $(".happynewyear2021worldSlotMachine .tokens.mTokens")},duration:1500}}}),this.addComponent(ReturnWorldComponent)},episodeChanged:function(){return!0},openPrizeControllerInfo:function(){this.prizeController.getNextProgressPoints()?new PrizeControllerInfoWindow({world:this,prizeController:this.prizeController}):this.get("hasBattlePass")||new CatchUpBattlePassWindow({model:this.battlePass})}}),fVe,iVe,oVe,pVe;GravityGroundCell.prototype.createDiv=(fVe=GravityGroundCell.prototype.createDiv,function(e){var t=fVe.call(this);return"happynewyear2021world"===episode.get("num")&&(this.decorationVariant=RANDOM([1,2,3]),t.addClass("decoration_"+this.decorationVariant),t.find(".attribute").addClass("decoration_"+this.decorationVariant)),t}),GravityGroundCell.prototype.animateTakeLife=(iVe=GravityGroundCell.prototype.animateTakeLife,function(i){if("happynewyear2021world"===episode.get("num")){var o=this;application.playSound("groundexplode"),this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(o.life+1)),this.addClass("gravityGroundExplode"),this.addClass("gravityGroundExplodeCell"+(o.life+1)),e()}).delay(400).queue(function(e){this.addClass("gravityGroundLife"+o.life),this.removeClass("gravityGroundExplode"),this.removeClass("gravityGroundExplodeCell"+(o.life+1));var t=this.clone();_Figure.blockedAnimations.append(t),t.alignTo(this),gameView.fallDownExplode(t,4,"gravityGroundExplode"),i(),e()})}else iVe.call(this,i)}),figureRulesProcess.happynewyear2021worldBonusClasses=function(){FigureRules.add(".episode_happynewyear2021world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/happynewyear2021world/artifactPart.c929389295.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_happynewyear2021world .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("happynewyear2021world","attribute_lollipop"),featuresAdder.addFeature("happynewyear2021world","shooter_mailbox"),featuresAdder.addFeature("happynewyear2021world","coinchest_newyear"),featuresAdder.addFeature("happynewyear2021world","frozenegg_gingerbread"),featuresAdder.addFeature("happynewyear2021world","crabmedusa_snail"),featuresAdder.addFeature("happynewyear2021world","boy_snowman"),featuresAdder.addFeature("happynewyear2021world","iceberg_candy"),featuresAdder.addFeature("happynewyear2021world","boy_snowman"),featuresAdder.addFeature("happynewyear2021world","caviar_jellybear"),featuresAdder.addFeature("happynewyear2021world","chocolate_icecube"),featuresAdder.addFeature("happynewyear2021world","floor_winter"),featuresAdder.addFeature("happynewyear2021world","fishball_winter"),featuresAdder.addFeature("happynewyear2021world","strongbox_candysafe"),featuresAdder.addFeature("happynewyear2021world","bar_ice"),featuresAdder.addFeature("happynewyear2021world","pasture_deer"),featuresAdder.addFeature("happynewyear2021world","bomb_snowflake"),featuresAdder.addFeature("happynewyear2021world","tortoise_winter"),featuresAdder.addFeature("happynewyear2021world","eaterstars_winter"),featuresAdder.addFeature("happynewyear2021world","gemstealer_winter"),FigureRules.add(".episode_happynewyear2021world .secondAttribute_prizePointMark",{"background-position-x":0,"background-position-y":0,"background-width":30,"background-height":30,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/happynewyear2021world/ticket.70a13952d6.png",width:.5*Config.cellWidth,height:.5*Config.cellHeight,"margin-top":.5*Config.cellHeight,"margin-left":.5*Config.cellWidth})},FigureRules.additionalBonusScaleImages=(oVe=figureRulesProcess.additionalBonusScaleImages,function(){oVe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/happynewyear2021world/artifactPart.c929389295.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(pVe=figureRulesProcess.additionalBonusClasses,function(){pVe.call(this),figureRulesProcess.happynewyear2021worldBonusClasses()});var SummerFishing=BonusWorld.extend({defaults:_.defaults({name:"SummerFishing",viewId:FishingJune2022View,version:20240503,production:!0,levelsInEpisode:80,durationDays:!1,episode:2,level:4,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:13,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[{type:"finalPrize",level:80,prize:[{type:"coins",amount:300},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:2},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:24}]}],livesInstance:new BonusWorldLives({lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300}),helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],unlimitedName:"unlimitedBonusWorldLives2",progressComponent:ProgressSimpleIncrementComponent,noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()}),offerId:"saleWorld2"}),this.addComponent(ReturnWorldComponent),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!1,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,pointEvents:[50,75],accountant:new PrizeProgressAccount([50,200,200,300,400,500,400,500,300,400,600,200,300,400,300,400,300,400,500,600,700,500,400,600,500,600,400,500,600,1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:900}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:12,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"SpinProduct",amount:1}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1200}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:250},{type:"SpinProduct",amount:1}]},{progress:22,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:24,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:25,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:26,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:27,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:28,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:29,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},this.get("finishPrize")]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"GoodProduct",goodId:i,addTime:1800}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:900}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ColorCellCollector({world:this,color:"G"}),new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:8,onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:14}],parts:o.getParts()})]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new ForgeRecipeCompleteCause({targetNum:3,forge:this.getComponent(ForgeComponent),ignoredItems:[1]})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:1,condition:function(){return!0}},{num:2,condition:function(){return!0}},{num:3,condition:function(){return!0}}]})]}),this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16},{type:"PrizePointsProduct",amount:1e3}]}}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),needShowComicButton:!0,stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.SummerFishing",persistentClass:"visible"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.SummerFishing .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.SummerFishing .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryGroup,delayAfter:0,stories:[{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},delayAfter:2e3,id:6},{type:StoryTalkElement,owner:this,talkKey:3}]},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.SummerFishing",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.SummerFishing",persistentClass:"hidden"}]}]},{type:StoryForceElement,owner:this,once:"enter",id:2,el:".bonusWorldUI.SummerFishing .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,once:"onCompleteLevel2",talkKey:4,id:3},{type:StoryGroup,once:"onCompleteLevel2",stories:[{type:StoryForceElement,el:".SummerFishing .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3"}],id:4},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:5,id:5},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:6,id:6},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:7,id:7},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:8,id:8},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:9,id:9},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:10,id:10},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:11,id:11},{type:StoryTalkElement,on:"beforeChangeLocation",talkKey:12,id:12},{type:StoryTalkElement,on:"enterLocation1",talkKey:13,id:13},{type:StoryTalkElement,on:"enterLocation2",talkKey:14,id:14},{type:StoryTalkElement,on:"enterLocation3",talkKey:15,id:15},{type:StoryTalkElement,on:"pointsProgress50",talkKey:16,id:16},{type:StoryTalkElement,on:"pointsProgress75",talkKey:17,id:17},{type:StoryTalkElement,on:"allPrizesCollected",talkKey:18,id:18},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"allPrizesCollected",params:{noTakePrize:!0,groupPrize:!0,prize:this.get("finishPrize").products},delayAfter:0,id:19},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,lastLevelFinishWindow:!0,publicationOff:!0},owner:this,once:"onCompleteLevel80",id:21},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onCompleteLevel80",delayAfter:0,id:20}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500},PrizePointsProduct:{target:function(){return t.view.$el.find(".prizeControllerOuterProgressBar .markSmall")},duration:1500,after:function(){return t.view.updateProgressBar()}}}}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]}]})},episodeChanged:function(){return!0}}),FVe,KVe,RVe,TVe,UVe;GravityGroundCell.prototype.animateTakeLife=(FVe=GravityGroundCell.prototype.animateTakeLife,function(t){if("SummerFishing"!==episode.get("num"))return FVe.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),PumpkinCell.prototype.animateTakeLife=(KVe=PumpkinCell.prototype.animateTakeLife,function(e){var t=this;if("SummerFishing"===episode.get("num")){var i=Math.round(this.life/this.maxLife*(46/60*Config.cellWidth));this.$div.find(".lifeBar").set("width",i),this.$div.removeClass("less50PercentLife less25PercentLife"),this.$div.find(".lifeBar").removeClass("less50PercentLife less25PercentLife");var o=50<Math.round(100*t.life/t.maxLife)?"less100PercentLife":Math.round(100*t.life/t.maxLife)<=25?"less25PercentLife":Math.round(100*t.life/t.maxLife)<=50&&"less50PercentLife";o&&(this.$div.addClass(o),this.$div.find(".lifeBar").addClass(o))}return KVe.call(this,e)}),PumpkinCell.prototype.animateRemoval=(RVe=PumpkinCell.prototype.animateRemoval,function(e){return this.$div.find(".lifeBlock").remove(),RVe.call(this,e)}),figureRulesProcess.SummerFishingBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(TVe=figureRulesProcess.additionalBonusClasses,function(){TVe.call(this),figureRulesProcess.SummerFishingBonusClasses(),FigureRules.add(".episode_SummerFishing .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/artifactPart.10f01a033e.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_SummerFishing .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("SummerFishing","boy_fisherman"),FigureRules.add(".episode_SummerFishing .cell.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/color_G.0c8367e738.png"}),FigureRules.add(".episode_SummerFishing .bomb.color_G",{"background-image":""}),FigureRules.add(".episode_SummerFishing .sail .taskIconContainer .taskIco.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/color_G.0c8367e738.png"}),FigureRules.add(".episode_SummerFishing .fortHeadCell .taskIconContainer .taskIco.color_G",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/color_G.0c8367e738.png"}),featuresAdder.addFeature("SummerFishing","attribute_blotch"),FigureRules.add(".episode_SummerFishing .decorator_chocolate.stable",{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_SummerFishing .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/chocolateAppear.07005f5864.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-40/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_SummerFishing .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/chocolateDie.f7003a6c8e.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_SummerFishing .pumpkinCell",{"background-image":""}),FigureRules.add(".episode_SummerFishing .pumpkin",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/jellyfish.827e72b9d9.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_SummerFishing .pumpkin.pumpkinShot",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/jellyfish.827e72b9d9.png",spriteFrames:12,duration:800}),FigureRules.add(".episode_SummerFishing .pumpkin.pumpkinDamage",{spriteFrames:1,playRound:!1,duration:1}),FigureRules.add(".episode_SummerFishing .pumpkinFire",{opacity:0}),FigureRules.add(".episode_SummerFishing .pumpkin.pumpkinDie",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/jellyfish.827e72b9d9.png",spriteFrames:1,duration:1,animation:{params:{width:[1*Config.cellWidth,.25*Config.cellWidth],height:[1*Config.cellHeight,.25*Config.cellHeight],"margin-left":[0*Config.cellWidth,20/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,20/60*Config.cellHeight],opacity:[1,0]},duration:500}}),FigureRules.add(".episode_SummerFishing .pumpkinLife",{width:20/60*Config.cellWidth,height:14/60*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.2*Config.cellWidth+"px Tahoma",color:"#6b1200","text-left":43/60*Config.cellWidth,"text-top":67/60*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_SummerFishing .cannonball",{"background-position-x":0,"background-position-y":0,"background-width":65,"background-height":79,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/inkParticle.974cab3d5a.png",width:65/180*Config.cellWidth,height:79/180*Config.cellHeight,"margin-left":25/65*Config.cellWidth,"margin-top":23/79*Config.cellHeight}),FigureRules.add(".episode_SummerFishing .cannonball.cannonballExplosion",{opacity:0}),FigureRules.add(".episode_SummerFishing .pumpkin .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/lifeBlock.e80b9c4868.png",width:56/60*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":.75*Config.cellHeight}),FigureRules.add(".episode_SummerFishing .pumpkin .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:5/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_SummerFishing .pumpkin .pumpkinLife",{opacity:0}),FigureRules.add(".episode_SummerFishing .pumpkin .less50PercentLife.lifeBar",{"background-color":"#ffff00"}),FigureRules.add(".episode_SummerFishing .pumpkin .less25PercentLife.lifeBar",{"background-color":"#f2342c"}),featuresAdder.addFeature("SummerFishing","strongbox_catsafe")}),figureRulesProcess.additionalBonusScaleImages=(UVe=figureRulesProcess.additionalBonusScaleImages,function(){UVe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/SummerFishing/frozenFishBg.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/chocolateAppear.07005f5864.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/color_G.0c8367e738.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/SummerFishing/artifactPart.10f01a033e.png":_Figure.scaleKoef})});var EasterFishingView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar").clone();e.appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper")),this.prizeControllerProgressbar=new PrizeControllerOuterAnimatedProgressBar({el:e,model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var t=this.model.getComponent(PrizeController);if(t){var i=$("#prizeControllerTemplates .prizeInfoBox").clone(),o=this.$(".prizesInfoContainer");o.addClass(this.model.get("name")),i.appendTo(o),i.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:i,model:t})}this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn(),this.updateRandomLevelBtn(),this.updatePrizesFinishedClass(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateStartBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this),this.updateProgressBar()},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("afterChangeLocation",this.updateStartBtn,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateStartBtn,this),e.off("change:points",this.updatePrizesFinishedClass,this)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()&&e.getPoints()<e.getMaxPointsPossible()),this.$randomBtn.find(".mRandomLevelBtnText").html(t)},updateStartBtn:function(){this.model.getComponent(PrizeController);var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode"))},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())},updateProgressBar:function(){this.prizeControllerProgressbar.update()}}),EasterFishing=BonusWorld.extend({defaults:_.defaults({name:"easterfishing",viewId:EasterFishingView,version:20230404,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:23,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[{type:"finalPrize",level:80,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:24},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]}],livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives3",amount:2}],unlimitedName:"unlimitedBonusWorldLives3",progressComponent:ProgressSimpleIncrementComponent,noArtifactPartOnReplay:!1},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives3";this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:70,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ReturnWorldComponent),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!1,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,pointEvents:[50,75],accountant:new PrizeProgressAccount([50,200,200,300,400,500,400,500,300,400,600,200,300,400,300,400,300,400,500,600,700,500,400,600,500,600,400,500,600,1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:900}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:12,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"SpinProduct",amount:1}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1200}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:250},{type:"SpinProduct",amount:1}]},{progress:22,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:24,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:25,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:26,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:27,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:28,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:29,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.RARE},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.LEGEND},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(10)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(8),o.ingredient(12)],prizes:[{products:[{type:"CoinsProduct",amount:40},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(9),o.ingredient(13)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(11),o.ingredient(14)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1200}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ColorCellCollector({world:this,color:"Y"}),new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:4,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.43,normal:.3,rare:.18,legend:.09},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:4,onReplay:!0,materials:{trash:.43,normal:.3,rare:.18,legend:.09},modifiers:[{levels:[13,23,25,28,30,38,40,43,45,50,53,58,63,68,70,74,80],perMoveChance:4}],parts:o.getParts()})]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.88},{type:PartMaterial.NORMAL,chance:.1},{type:PartMaterial.RARE,chance:.02}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]}]});var n=this.addComponent(ChangeoverComponent,{applyInStories:!0,changeoverCauses:[new CompleteLevelCause({targetNum:19})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:1,condition:function(){return!0}},{num:2,condition:function(){return!0}},{num:3,condition:function(){return!0}}]})]});this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),needShowComicButton:!0,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:1},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterfishing .animationSprite1",persistentClass:"visible1"}],id:2},{type:StoryTalkElement,owner:this,once:"enter",talkKey:1,id:3},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterfishing .animationSprite2",persistentClass:"visible1"}],id:4},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterfishing .animationSprite3",persistentClass:"visible1"}],id:5},{type:StoryTalkElement,owner:this,once:"enter",talkKey:2,id:6},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterfishing .animationSprite4",persistentClass:"visible1"}],id:7},{type:StoryTalkElement,owner:this,once:"enter",talkKey:3,id:8},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.easterfishing",persistentClass:"disappear"}],id:9},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".bonusWorldAnimations.easterfishing",persistentClass:"hidden"}],id:10},{type:StoryTalkElement,owner:this,once:"onCompleteLevel2",talkKey:4,id:11},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:5,id:12},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:6,id:13},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:7,id:14},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:8,id:15},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:9,id:16},{type:StoryCallbackElement,owner:n,page:"main",on:"changeover",callback:function(){n.applyEffects()},isAvailable:function(){return!t.getComponent("prizes").isFinal()},id:100,priority:ActionQueue.low},{type:StoryTalkElement,on:"beforeChangeLocation",talkKey:10,id:17,priority:ActionQueue.low},{type:StoryTalkElement,on:"enterLocation1",talkKey:11,id:18,priority:ActionQueue.low},{type:StoryTalkElement,on:"enterLocation2",talkKey:12,id:19,priority:ActionQueue.low},{type:StoryTalkElement,on:"enterLocation3",talkKey:13,id:20,priority:ActionQueue.low},{type:StoryTalkElement,on:"pointsProgress50",talkKey:14,id:21},{type:StoryTalkElement,on:"pointsProgress75",talkKey:15,id:22},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize30",talkKey:16,id:23},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize30",params:{noTakePrize:!0,groupPrize:!0,prize:this.prizeController.getPrizeByProgress(this.prizeController.getMaxProgress()).prize},delayAfter:0,id:24},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,lastLevelFinishWindow:!0,publicationOff:!0},owner:this,once:"onFinishLevel81",id:25},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onFinishLevel81",delayAfter:0,id:26},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.easterfishing .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,on:"onCompleteLevelAfterDelay1",id:201,el:".bonusWorldUI.easterfishing .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,on:"onFinishLevel3",id:202,el:".easterfishing .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onFinishLevel3",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500},PrizePointsProduct:{target:function(){return t.view.$el.find(".prizeControllerOuterProgressBar .markSmall")},duration:1500,after:function(){return t.view.updateProgressBar()}}}})},episodeChanged:function(){return!0},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this;BonusWorld.prototype.onCompleteBonusWorldLevelBeforeStatistic.call(this,e,t),application.waitPage("main").then(function(){return delay(500)}).then(function(){return i.trigger("onCompleteLevelAfterDelay"+e,i,e,t)})}}),LWe,QWe,RWe,WWe,_We,aXe;IcebergCell.prototype.animateRemoval=(LWe=IcebergCell.prototype.animateRemoval,function(t){if("easterfishing"!==episode.get("num"))return LWe.call(this,t);for(var e=0;e<this.body.length;e++)Game.addFloor(this.body[e],2,{noTask:this.isIceInTask()});this.generateTreasure(_.shuffle(this.body).slice(0,this.remainingTreasures)),this.$div.queue(function(e){this.find(".icebergCellBg").addClass("nutTreeDie"),e()}).delay(700).queue(function(e){this.find(".icebergCellBg").removeClass("nutTreeDie"),e(),this.remove(),t()})}),IcebergCell.prototype.startWaterAnimation=(QWe=IcebergCell.prototype.startWaterAnimation,function(){return"easterfishing"===episode.get("num")?void 0:QWe.call(this)}),IcebergCell.prototype.animateTakeLife=(RWe=IcebergCell.prototype.animateTakeLife,function(t){if("easterfishing"!==episode.get("num"))return RWe.call(this,t);var i=this;this.$div.queue(function(e){this.removeClass(i.baseName+"Level"+(i.life+1)),this.find(".icebergCellBg").addClass("animateTakeLife"+(i.life+1)),e()}).delay(500).queue(function(e){this.find(".icebergCellBg").removeClass("animateTakeLife"+(i.life+1)),this.addClass(i.baseName+"Level"+i.life),e(),t()})}),FlamyCell.prototype.animateRemoval=(WWe=FlamyCell.prototype.animateRemoval,function(t){if("easterfishing"!==episode.get("num"))return WWe.call(this,t);this.$div.queue(function(e){this.find(".flamyCellBg").addClass("animateRemoval"),e()}).delay(1500).ourAnimate({opacity:0},400).queue(function(e){this.remove(),e(),t()})}),figureRulesProcess.easterfishingBonusClasses=function(){FigureRules.add(".episode_easterfishing .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/artifactPart.929ad495aa.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_easterfishing .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_easterfishing .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_easterfishing .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_easterfishing .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_easterfishing .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_easterfishing .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_easterfishing .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_easterfishing .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_easterfishing .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_easterfishing .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_easterfishing .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_easterfishing .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_easterfishing .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_easterfishing .artifactPartCell.part14 .part",{frame:13}),featuresAdder.addFeature("easterfishing","well_paint"),featuresAdder.addFeature("easterfishing","caviar_jellybear"),featuresAdder.addFeature("easterfishing","crabmouse_rabbit"),featuresAdder.addFeature("easterfishing","frozenegg_eggs"),featuresAdder.addFeature("easterfishing","iceberg_eggs"),featuresAdder.addFeature("easterfishing","strongbox_candysafe"),featuresAdder.addFeature("easterfishing","coinchest_eggschest"),featuresAdder.addFeature("easterfishing","greedypirate_eggs"),featuresAdder.addFeature("easterfishing","fishball_bird"),featuresAdder.addFeature("easterfishing","dropcell_eggsbasket"),featuresAdder.addFeature("easterfishing","attribute_butterfly"),FigureRules.add(".episode_easterfishing .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass1.9feec914cf.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass2.b1d8f967e9.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass3.562839e61a.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .iceBlast1.iceBlast, .episode_easterfishing .iceBlast2.iceBlast, .episode_easterfishing .iceBlast3.iceBlast, .episode_easterfishing .iceBlast4.iceBlast, .episode_easterfishing .iceBlast5.iceBlast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass1Die.134e3c2065.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .iceBlast2.iceBlast",{"background-position-x":222}),FigureRules.add(".episode_easterfishing .iceBlast3.iceBlast",{"background-position-x":444}),FigureRules.add(".episode_easterfishing .iceBlast4.iceBlast",{"background-position-x":666}),FigureRules.add(".episode_easterfishing .iceBlast5.iceBlast",{"background-position-x":888}),FigureRules.add(".episode_easterfishing .ice1Blast1.ice1Blast, .episode_easterfishing .ice1Blast2.ice1Blast, .episode_easterfishing .ice1Blast3.ice1Blast.episode_easterfishing .ice1Blast4.ice1Blast.episode_easterfishing .ice1Blast5.ice1Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass1Die.134e3c2065.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .ice1Blast2.ice1Blast",{"background-position-x":222}),FigureRules.add(".episode_easterfishing .ice1Blast3.ice1Blast",{"background-position-x":444}),FigureRules.add(".episode_easterfishing .ice1Blast4.ice1Blast",{"background-position-x":666}),FigureRules.add(".episode_easterfishing .ice1Blast5.ice1Blast",{"background-position-x":888}),FigureRules.add(".episode_easterfishing .ice2Blast1.ice2Blast, .episode_easterfishing .ice2Blast2.ice2Blast, .episode_easterfishing .ice2Blast3.ice2Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass2Die.4754f11693.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .ice2Blast2.ice2Blast",{"background-position-x":222}),FigureRules.add(".episode_easterfishing .ice3Blast1.ice3Blast, .episode_easterfishing .ice3Blast2.ice3Blast, .episode_easterfishing .ice3Blast3.ice3Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass3Die.b429305c73.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_easterfishing .ice3Blast2.ice3Blast",{"background-position-x":222}),FigureRules.add(".episode_easterfishing .ice3Blast3.ice3Blast",{"background-position-x":444}),featuresAdder.addFeature("easterfishing","flamy_egg"),FigureRules.add(".episode_easterfishing .cell.color_Y",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/yellowStone.27fb089b87.png"}),FigureRules.add(".episode_easterfishing .bomb.color_Y",{"background-image":""}),FigureRules.add(".episode_easterfishing .bigChestBody .bigChestCell",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/chestStones.0e9d549d92.png"})},figureRulesProcess.additionalBonusScaleImages=(_We=figureRulesProcess.additionalBonusScaleImages,function(){_We.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/easterfishing/well.png":Config.cellWidth/80,"../../../gems/site/img/features/easterfishing/paint.png":Config.cellWidth/80,"../../../gems/site/img/features/easterfishing/rabbit.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass1.9feec914cf.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass2.b1d8f967e9.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass3.562839e61a.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass1Die.134e3c2065.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass2Die.4754f11693.png":Config.cellWidth/80,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/grass3Die.b429305c73.png":Config.cellWidth/80,"../../../gems/site/img/features/easterfishing/eggDamaged_xlarge.png":Config.cellWidth/75,"../../../gems/site/img/features/easterfishing/eggStable.png":Config.cellWidth/75,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterfishing/yellowStone.27fb089b87.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(aXe=figureRulesProcess.additionalBonusClasses,function(){aXe.call(this),figureRulesProcess.easterfishingBonusClasses()});var OpenSeaWorldView=BonusWorldView.extend({events:_.extend({"click .storyButton":"onShowStory"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeLevelIntervalControllerOuterProgressBar({model:this.model.getComponent(PrizeLevelIntervalComponent),el:this.$(".bonusWorldUI.openseaworld")});var e=$(".mainTemplates .mPrizeControllerOuterProgressBar"),t=this.$(".mPrizeControllerOuterProgressBarWrapper");t.addClass("onMain").addClass(this.model.get("name")),t.click(_.bind(this.model.showInfo,this.model)),e.clone().appendTo(t),this.$(".mExitBtn").html("")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.prizeControllerProgressbar.update()},updateStartBtn:function(){this.$ui.find(".mStartBtn").find(".mLevel").html(this.model.getCurrentLevel())}}),OpenSeaWorld=BonusWorld.extend({defaults:_.defaults({name:"openseaworld",version:20220216,production:!0,isFreeEpisode:!0,levelsInEpisode:20,viewId:OpenSeaWorldView,durationDays:!1,includeLevels:!1,episode:1,level:16,showTimer:!1,minEpisodeToEnter:1,minLevelToEnter:34,finishWindowInStories:!0,forceId:!1,force:!1,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,actionQueue:new ActionQueue,withoutInnerWindow:!0,skipLevelPublication:!0,progressComponent:ProgressSimpleIncrementComponent},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.loadedEpisodeNum=null,this.addComponent(RandomEpisodeLevelComponent,{beginLevelOffset:100*Config.levelsInEpisode,endLevelOffset:10*Config.levelsInEpisode}),this.addComponent(PrizeLevelIntervalComponent,{world:this,intervalLevels:20,startIntervalLevel:20,prizes:[{name:"openSeaPrize",products:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{name:"openSeaPrize",products:[{type:"coins",amount:100},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{name:"openSeaPrize",products:[{type:"coins",amount:50},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"spins",amount:1}]},{name:"openSeaPrize",products:[{type:"coins",amount:150},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{name:"openSeaPrize",products:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryCallbackElement,owner:this,delayAfter:0,on:"beforeLoad",callback:function(){if(t.needStartDialog)return t.needStartDialog=!1,t.showStartDialog()},id:1}]})},configure:function(e,t){var i=this;BonusWorld.prototype.configure.call(this,e,t),this.needStartDialog=!this.get("timer")||!user.isAllLevelsCompleted(),this.needEndDialog=user.get("serverTime")-user.get("keyLastUnlocked")<=0,this.once("enter",function(){i.needStartDialog&&i.showStartDialog().then(function(){i.needStartDialog=!1})}),this.once("exit",function(){i.loadedEpisodeNum=null})},showStartDialog:function(){var t=this;return new Promise(function(e){new StoryTalkWindow({onClose:e,dialog:messages[t.get("name")+"StartTalk"],owner:t,characters:messages[t.get("name")+"Characters"],id:"startTalk",selector:"freeEpisode",line:0})})},showEndDialog:function(){var t=this;return new Promise(function(e){new StoryTalkWindow({onClose:e,dialog:messages[t.get("name")+"EndTalk"],owner:t,characters:messages[t.get("name")+"Characters"],id:"endTalk",selector:"freeEpisode",line:0})})},getLevelInfo:function(){var e=this.getComponent(RandomEpisodeLevelComponent).getCurrentLevelNum(),t=Math.ceil(e/Config.levelsInEpisode);return{levelNum:e,episodeNum:t,relativeLevelNum:e-(t-1)*Config.levelsInEpisode}},prepareNextLevel:function(){var o=this,a=this.getLevelInfo();return loadLevelJSON({about:episodesData[a.episodeNum].about,levels:episodesData[a.episodeNum].levels}).then(function(e){for(var t in episode.set({levels:e.levels,about:e.about,episodeCollection:!1}),episode.noScores=!0,e.levels)if(e.levels.hasOwnProperty(t)){var i=e.levels[t];i.cellAttribute=episode.beefUpLevelLayer(i.cellAttribute,"."),i.cellSecondAttribute=episode.beefUpLevelLayer(i.cellSecondAttribute||[[]],"."),i.decorators=episode.beefUpLevelLayer(i.decorators,"."),i.floorAttribute=episode.beefUpLevelLayer(i.floorAttribute,"0"),i.map=episode.beefUpLevelLayer(i.map," ")}return o.loadedEpisodeNum=a.episodeNum,a.relativeLevelNum})},playCurrentLevel:function(t){var e=this,i=this.getLevelInfo();return this.emit("beforePlayLevel"+i.relativeLevelNum).then(function(){return e.prepareNextLevel()}).then(function(e){episode.playLevel(e,t)})},startNextLevel:function(){this.playCurrentLevel()},leaveBonusWorld:function(){BonusWorld.prototype.leaveBonusWorld.call(this),episode.noScores=!1},showInfo:function(){new FreeEpisodeHelpInfo({world:this})},levelCheckAvailable:function(e,t){return t(e),!0}}),QXe;PumpkinCell.prototype.renderLife=(QXe=PumpkinCell.prototype.renderLife,function(){"openseaworld"===episode.get("num")?this.$div.find(".pumpkinLife").html(this.life):QXe.call(this)});var FreeEpisodeHelpInfo=TWindow.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.world.get("name"),t=messages[e+"HelpWindow"];this.$(".description1").html(t.hint1||""),this.$(".description2").html(t.hint2||""),this.$(".title").html(t.title||"")}}),UXe;figureRulesProcess.openseaworldBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(UXe=figureRulesProcess.additionalBonusClasses,function(){UXe.call(this),figureRulesProcess.openseaworldBonusClasses()});var DayOfLove2022WorldPrizeControllerView=PrizeControllerView.extend({render:function(){var e=this,t=_.values(this.model.getPrizesGrouped("progress")),n=this.$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),i=$(".mainTemplates .rewardComponentPage"),o=$(".invisible.mainTemplates .progressBarByLevel"),a=this.$el.find(".freePlate");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page),this.clarification=null,this.needClarify=!0;var s=i.clone(),l=o.clone();s.addClass(this.model.get("world").get("name")),s.append(l),a.html(messages.forFree),$bpPlate.html(messages[this.model.get("world").get("name")+"BattlePassTitle"]),t.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("progress"+e.progress).addClass(e.type).data("id",e.cid),a){var i=n.clone();i.addClass("progress"+e.progress).addClass("placeholder"),s.append(i)}if("battlePass"===e.type||"finalPrize"===e.type){var o=r.clone();o.addClass("marker"+e.progress),o.html(e.progress),l.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.prize),isGroup:!0}),s.append(t)},this)},this),this.$wrapper.append(s),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:s,mainEl:this.$("#user"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.needClarify=!1,e.closeClarification()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("world").battlePass&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.createButton()}}),DayOfLove2022WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:this.$(".mPrizeControllerOuterProgressBar"),model:this.model.getComponent(PrizeController)}),this.rulesBtn=new TicketInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.$randomBtn.find(".mRandomLevelBtnText").html(messages[this.model.get("name")+"LookForBunniesBtn"]);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar"),t=this.$(".mPrizeControllerOuterProgressBarWrapper");t.addClass("onMain").addClass(this.model.get("name"));var i=e.clone().appendTo(t);this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:i,model:this.model.getComponent(PrizeController)})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);var e=this.model.getComponent(PrizeController);if(!this.nextPrizeProgressbar){var t=$(".mainTemplates .mPrizeControllerOuterProgressBar"),i=$(".rewardChainContainer .mPrizeControllerOuterProgressBarWrapper");i.addClass(this.model.get("name"));var o=t.clone().appendTo(i);this.nextPrizeProgressbar=new PrizeControllerOuterProgressBarNextAllPts({el:o,model:this.model.getComponent(PrizeController)})}this.updateScreen(),this.updateRandomLevelBtn(),this.updateTotalCounter(),this.prizeControllerProgressbar.update(),this.nextPrizeProgressbar.update(),this.model.on("onCompleteLevel",this.updateScreen,this),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("onCompleteLevel",this.updateTotalCounter,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateTotalCounter(),this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("onCompleteLevel",this.updateScreen,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("onCompleteLevel",this.updateTotalCounter,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateTotalCounter(),this)},updateScreen:function(){for(var e=this.model.getCurrentLevel(),t=0;t<=this.model.screens;++t)$(".wrapper").removeClass(this.model.get("name")+"_screen"+t);var i=this.model.get("name")+"_screen1";25<e&&e<=this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen2"),e>this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen3"),$(".wrapper").addClass(i)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&e.getPoints()<e.getMaxPointsPossible())},updateTotalCounter:function(){var e=$(".rewardChainBtn."+this.model.get("name")+" .mPointsCounter"),t=this.model.getComponent(PrizeController),i=t.getMaxPointsPossible(),o=t.getPoints();e.toggleClass("complete",i<=o),e.html(Math.min(o,i)+"/"+i),this.prizeControllerProgressbar.update(),this.nextPrizeProgressbar.update()}}),DayOfLove200World=BonusWorld.extend({screens:3,defaults:_.defaults({name:"dayoflove2022world",version:20220202,levelsInEpisode:50,helpWindow:!0,endDate:new Date("2022/04/14 17:00"),viewId:DayOfLove2022WorldView,showFinalForce:!1,durationDays:!1,suggestPlayForLife:!0,lastLevelOpen:!1,production:!0,saveReplayLevel:!0,episode:1,level:13,minEpisodeToEnter:2,minLevelToEnter:4,openDate:null,showProgress:!0,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,skipLevelPublication:!0,withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",closeForNew:!1,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0,prizes:[{type:"finalPrize",level:50,prize:[{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:8},{type:"good",cssClass:"starInField",name:"starInField",amount:8},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:8},{type:"spins",name:"spins",cssClass:"spins",amount:2}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(TriesComponent,{conditioner:TriesConditionerPresets.upToLevel,variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:4}]}},{tries:2,prizes:{products:[{type:"PrizePointsProduct",amount:3}]}},{tries:3,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.addComponent(RandomLevelComponent,{lowerMargin:16,upperMargin:40,useLevelSet:!1,saveReplayLevel:!0}),this.prizeController=this.addComponent(PrizeController,{world:this,viewClass:DayOfLove2022WorldPrizeControllerView,isOpenPrizePage:!1,accountant:new PrizeProgressAccount([12,15,18,25,30,40,60]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:3,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"SpinProduct",amount:1}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:6,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:1,type:"battlePass",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:2,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:3,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:4,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:5,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:6,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:7,type:"battlePass",products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]}]}),this.battlePass=new BattlePass({world:this,catchupWindowRule:catchupWindowShowRules.byNextPrizeProgress,catchupWindowActivator:new EventSignal("change:progress",this.getComponent(PrizeController))}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.dayoflove2022world",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{scrollable:!0,partSource:new Artifacts.PartDropper({chances:{15:30,7:40},generatingModel:Artifacts.WeighedPartGeneration}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:100},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:10800,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:2},{type:"spins",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,params:{silent:!0},owner:this,once:"beforeEnter",id:1},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2,id:3},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"beforeEnter",id:4},{type:StoryTalkElement,owner:this,delay:1e3,once:"enter",talkKey:3,id:5},{type:StoryTalkElement,owner:this,once:"onCompleteLevel5",talkKey:4,id:6},{type:StoryTalkElement,owner:this,once:"onCompleteLevel10",talkKey:5,id:7},{type:StoryTalkElement,owner:this,once:"onCompleteLevel15",talkKey:6,id:8},{type:StoryTalkElement,owner:this,once:"onCompleteLevel20",talkKey:7,id:9},{type:StoryTalkElement,owner:this,once:"onCompleteLevel25",talkKey:8,id:10},{type:StoryTalkElement,owner:this,once:"onCompleteLevel30",talkKey:9,id:11},{type:StoryTalkElement,owner:this,once:"onCompleteLevel35",talkKey:10,id:12},{type:StoryTalkElement,owner:this,once:"onCompleteLevel40",talkKey:11,id:13},{type:StoryTalkElement,owner:this,once:"onCompleteLevel45",talkKey:12,id:14},{type:StoryTalkElement,owner:this,once:"onCompleteLevel50",isAvailable:function(){return t.prizeController.getPoints()<t.prizeController.getMaxPointsPossible()},talkKey:14,id:15},{type:StoryTalkElement,owner:this,once:"onAfterFinishLevel",isAvailable:function(){return t.getCurrentLevel()>t.get("levelsInEpisode")&&t.prizeController.getPoints()>=t.prizeController.getMaxPointsPossible()},talkKey:13,id:16},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize1",talkKey:15,id:17},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize3",talkKey:16,id:18},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize5",talkKey:17,id:19},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize7",talkKey:18,id:20},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel50",params:{prize:this.get("prizes")[0].prize},delayAfter:0,id:21},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.dayoflove2022world .startCurrentLevel",name:"valentine2022worldForce0"},{type:StoryForceElement,owner:this,once:"winLevel1",id:201,el:"#map .rewardChainBtn.dayoflove2022world",name:"valentine2022worldForce7"},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:202,el:".artifactWorkshopButton.dayoflove2022world",name:"valentine2022worldForce1"},{type:StoryForceElement,owner:this.artifactController,page:"artifacts",once:"openWorkshop",id:203,el:".artifactWorkshop.dayoflove2022world .tree .button4",name:"valentine2022worldForce2"},{type:StoryForceElement,owner:this,once:"onAfterFinishLevel",page:"main",isAvailable:function(){return t.artifactController.getArtifactWorkshop().hasCanAssembleArtifacts()},el:".artifactWorkshopButton.dayoflove2022world",name:"valentine2022worldForce5",id:204},{type:StoryForceElement,owner:this,once:"onAfterFinishLevel",page:"artifacts",isAvailable:function(){return t.artifactController.getArtifactWorkshop().hasCanAssembleArtifacts()},el:function(){var e=t.artifactController.getArtifactWorkshop().getCanAssembledArtifacts()[0];return $(".artifactWorkshop.dayoflove2022world .tree .button"+e.get("id"))},name:"valentine2022worldForce6",id:205},{type:StoryCallbackElement,owner:this,page:"main",on:"prizeControllerBeforeTakePrize",callback:function(){t.prizeController.openPrizeRoom()},id:206}]})},configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},getRandomWorldLevelNum:function(){return _.random(16,40)},absoluteLevelNumber:function(e){return e}}),XYe,YYe;figureRulesProcess.dayoflove2022worldBonusClasses=function(){FigureRules.add(".episode_dayoflove2022world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/artifactPlatform.png"}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/dayoflove2022world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_dayoflove2022world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_dayoflove2022world .cell.color_R",{"background-image":"../../../gems/site/img/features/dayoflove2022world/redHeart.png"}),FigureRules.add(".episode_dayoflove2022world .bomb.color_R",{"background-image":""}),FigureRules.add(".episode_dayoflove2022world .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .pearlCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_dayoflove2022world .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_dayoflove2022world .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_dayoflove2022world .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_dayoflove2022world .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/ringCase.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/ring.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":232,"background-height":374,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/dayoflove2022world/strongboxHearts_xlarge.png","margin-left":-34/180*Config.cellWidth,"margin-top":-.9*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .strongboxCellLoot",{"background-position-x":0,"background-width":161,"background-height":141,width:161/180*Config.cellWidth,height:141/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/dayoflove2022world/strongboxHeartsCollectItem.png","margin-left":5/180*Config.cellWidth,"margin-top":.2*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .color_0, .episode_dayoflove2022world .color_1, .episode_dayoflove2022world .color_2",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/rose.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .color_0",{"background-position-x":1440}),FigureRules.add(".episode_dayoflove2022world .color_1",{"background-position-x":0}),FigureRules.add(".episode_dayoflove2022world .collectedcolor_1",{spriteFrames:9,duration:900,framesOrder:[0,1,2,3,4,5,6,7,8]}),FigureRules.add(".episode_dayoflove2022world .color_2",{"background-position-x":1440}),FigureRules.add(".episode_dayoflove2022world .collectedcolor_2",{spriteFrames:4,duration:900,framesOrder:[0,1,2,3]}),FigureRules.add(".episode_dayoflove2022world .coinChestHeadCell",{width:393/180*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-16.5/180*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"../../../gems/site/img/features/dayoflove2022world/heartChest.png"}),FigureRules.add(".episode_dayoflove2022world .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .attribute_coin",{"background-image":"../../../gems/site/img/features/dayoflove2022world/heart.png"}),FigureRules.add(".episode_dayoflove2022world .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/dayoflove2022world/heart.png"}),FigureRules.add(".episode_dayoflove2022world .decorator_greedypirate",{"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .move_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,lastFrame:2,duration:130,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .grab_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:7,framesOrder:[3,4,5,6,7,8,9],duration:500,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .decorator_greedypirate.hasCoins",{"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate2.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".episode_dayoflove2022world .decorator_greedypirate .coins",{opacity:0,font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#ffffff","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_dayoflove2022world .sleep_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!0}),FigureRules.add(".episode_dayoflove2022world .hit_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/dayoflove2022world/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:2,lastFrame:2,framesOrder:[5,6],duration:250,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .chestWithKeysHead .chestWithKeyskBg",{"background-image":"../../../gems/site/img/features/dayoflove2022world/chestWithKeys.png"}),FigureRules.add(".episode_dayoflove2022world .chestKeyCell .cellStone",{"background-image":"../../../gems/site/img/features/dayoflove2022world/chestKeys.png"}),FigureRules.add(".episode_dayoflove2022world .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/dayoflove2022world/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_dayoflove2022world .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/dayoflove2022world/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_dayoflove2022world .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_dayoflove2022world .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_dayoflove2022world .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_dayoflove2022world .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/dayoflove2022world/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_dayoflove2022world .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/dayoflove2022world/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .currentLife, .episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .divider, .episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_dayoflove2022world .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_dayoflove2022world .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/dayoflove2022world/pannacottaCell.png"})},figureRulesProcess.additionalBonusScaleImages=(XYe=figureRulesProcess.additionalBonusScaleImages,function(){XYe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/dayoflove2022world/redHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/ringCase.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/strongboxHearts_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/rose.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/heart.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/heartChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/greedyPirate2.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/cupidonStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/pannacottaCell.png":_Figure.scaleKoef,"../../../gems/site/img/features/dayoflove2022world/strongboxHeartsCollectItem.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(YYe=figureRulesProcess.additionalBonusClasses,function(){YYe.call(this),figureRulesProcess.dayoflove2022worldBonusClasses()});var GroundhogDay=BonusWorld.extend({defaults:_.defaults({name:"groundhogday",version:20230120,levelsInEpisode:20,helpWindow:!1,showFinalForce:!1,durationDays:3,suggestPlayForLife:!0,lastLevelOpen:!0,production:!0,finishWindowInStories:!0,episode:1,level:16,minEpisodeToEnter:1,minLevelToEnter:34,openDate:null,showProgress:!0,forceId:!0,closeForNew:!1,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime3",allowAfterWin:!0,withoutInnerWindow:!0,actionQueue:new ActionQueue,skipLevelPublication:!0,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",cssClass:"starInField",name:"starInField",amount:.5}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",cssClass:"unlimitedLifes",name:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:15,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",level:20,prize:[{type:"coins",name:"coins",cssClass:"coins",amount:300},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:6},{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:2},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest",part:new EpisodeCollection.Part({id:1,price:100,chance:100})})]}),this.prepareStoryController(),this.addComponent(ProlongateWorldComponent)},prepareStoryController:function(){var e=this;this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",id:1},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:2},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize5",talkKey:2,id:3},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize10",talkKey:3,id:4},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize15",talkKey:4,id:5},{type:StoryGroup,id:6,once:"onCompleteLevel20",stories:[{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.groundhogday",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.groundhogday .animationSprite1",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"onCompleteLevel20",talkKey:5},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.groundhogday .animationSprite2",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.groundhogday .animationSprite3",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.groundhogday",persistentClass:"hidden"}]},{type:StoryAnimationElement,owner:this,once:"onCompleteLevel20",elements:[{el:".bonusWorldAnimations.groundhogday",persistentClean:"active"}]}]},{type:StoryTalkElement,owner:this,once:"onCompleteLevel20",talkKey:6,id:7},{type:BaseStoryWindowElement,window:BonusWorldLevelPrizeWindow,owner:this,params:{world:this,level:20,prize:this.get("prizes")[3].prize},once:"onCompleteLevel20",id:204},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel20",params:{},delayAfter:0,id:205},{type:StoryForceElement,isAvailable:function(){return e.getCurrentLevel()<=1},owner:this,delay:200,once:"enter",el:".bonusWorldUI.groundhogday .startCurrentLevel",name:"firstLevelForce",id:206}]})},configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},onCloseFinishWindow:function(){this.exit()}}),iZe,jZe;figureRulesProcess.groundhogdayBonusClasses=function(){},figureRulesProcess.additionalBonusScaleImages=(iZe=figureRulesProcess.additionalBonusScaleImages,function(){iZe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/groundhogday/specialCell.25a966c9be.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickR.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickG.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickB.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickY.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickP.png":_Figure.scaleKoef,"../../../gems/site/img/features/groundhogday/chickW.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(jZe=figureRulesProcess.additionalBonusClasses,function(){jZe.call(this),figureRulesProcess.groundhogdayBonusClasses(),featuresAdder.addFeature("groundhogday","episodecollectiondroppable"),featuresAdder.addFeature("groundhogday","caviar_chick"),featuresAdder.addFeature("groundhogday","dropcell_hamster"),FigureRules.add(".episode_groundhogday .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/groundhogday/groundhogIdle.a24e167f34.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:13,duration:1500,playRound:!0,delay:[2e3,2e3]}),FigureRules.add(".episode_groundhogday .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/groundhogday/groundhogHit.2782269f97.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:13,duration:1500,playRound:!1}),FigureRules.add(".episode_groundhogday .alligatorSpecial",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/groundhogday/groundhogLeave.423a6bcd7b.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:13,duration:1500,playRound:!1,animation:{}}),FigureRules.add(".episode_groundhogday .alligatorLifeBlock",{"margin-top":100/60*Config.cellHeight})});var WinterFishingView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar").clone();e.appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper")),this.prizeControllerProgressbar=new PrizeControllerOuterAnimatedProgressBar({el:e,model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var t=this.model.getComponent(PrizeController);if(t){var i=$("#prizeControllerTemplates .prizeInfoBox").clone(),o=this.$(".prizesInfoContainer");o.addClass(this.model.get("name")),i.appendTo(o),i.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:i,model:t})}},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.updatePrizesFinishedClass(),e.on("change:points",this.updatePrizesFinishedClass,this),this.updateProgressBar()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.getComponent(PrizeController).off("change:points",this.updatePrizesFinishedClass,this)},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())},updateProgressBar:function(){this.prizeControllerProgressbar.update()}}),WinterFishing=BonusWorld.extend({defaults:_.defaults({name:"winterfishing",viewId:WinterFishingView,version:20231226,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:25,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,helpWindow:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[],livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],unlimitedName:"unlimitedBonusWorldLives2",livesConfig:{lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300},progressComponent:ProgressSimpleIncrementComponent,noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"finalPrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",addTime:86400,goodId:GoodTypes.unlimitedKeys},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";UserPrizes.convertFromCocos(this.get("finishPrize")),this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16},{type:"PrizePointsProduct",amount:1e3}]}}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:60,useLevelSet:!0,saveReplayLevel:!0}),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!1,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,pointEvents:[50,75],accountant:new PrizeProgressAccount([50,200,200,300,400,500,400,500,300,400,600,200,300,400,300,400,300,400,500,600,700,500,400,600,500,600,400,500,600,1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:900},{type:"GoodProduct",goodId:i,addTime:900}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:900}]},{progress:7,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:900}]},{progress:9,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2}]},{progress:12,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:900}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:900},{type:"SpinProduct",amount:1}]},{progress:16,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:18,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:900}]},{progress:19,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:900},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:21,type:"middlePrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:22,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{progress:23,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:900},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:24,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:25,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:26,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:27,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:28,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:900}]},{progress:29,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:30,type:"finalPrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:9,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.4,normal:.33,rare:.2,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:6,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.4,normal:.33,rare:.2,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:9}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:8,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.4,normal:.33,rare:.2,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:11}],parts:o.getParts()}),new ColorCellCollector({world:this,color:"G"})]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new CompleteLevelCause({targetNum:20})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:1,condition:function(){return!0}},{num:2,condition:function(){return!0}},{num:3,condition:function(){return!0}}]})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),needShowComicButton:!0,stories:[{type:StoryGroup,id:101,once:"enter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.winterfishing",persistentClass:"visible"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter"},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.winterfishing .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.winterfishing .animationSprite2",persistentClass:"visible1"},{el:".bonusWorldAnimations.winterfishing .animationSprite6",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.winterfishing .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.winterfishing .animationSprite4",persistentClass:"visible1"},{el:".bonusWorldAnimations.winterfishing .animationSprite5",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:4},{type:StoryGroup,stories:[{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"enter",delayAfter:4e3,id:6},{type:StoryTalkElement,owner:this,once:"enter",talkKey:5}]},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.winterfishing",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".bonusWorldAnimations.winterfishing",persistentClass:"hidden"}]}]},{type:StoryTalkElement,owner:this,once:"onCompleteLevel2",talkKey:6,id:12},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:7,id:13},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:8,id:14},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:9,id:15},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:10,id:16},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:11,id:17},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:12,id:18},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:13,id:19},{type:StoryTalkElement,on:"beforeChangeLocation",talkKey:14,id:20},{type:StoryTalkElement,on:"enterLocation1",talkKey:15,id:21},{type:StoryTalkElement,on:"enterLocation2",talkKey:16,id:22},{type:StoryTalkElement,on:"enterLocation3",talkKey:17,id:23},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize15",talkKey:18,id:24},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize23",talkKey:19,id:25},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize30",talkKey:20,id:26},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize30",params:{noTakePrize:!0,groupPrize:!0,prize:this.prizeController.getPrizeByProgress(this.prizeController.getMaxProgress()).prize},delayAfter:0,id:27},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevelAfterDelay80",params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0,publicationOff:!0},delayAfter:0,id:28},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onCompleteLevelAfterDelay80",delayAfter:0,id:29},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.winterfishing .startCurrentLevel",name:this.get("name")+"Force0",priority:ActionQueue.Priority.low},{type:StoryForceElement,owner:this,once:"onCompleteLevelAfterDelay1",id:201,el:".bonusWorldUI.winterfishing .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,on:"onCompleteLevelAfterDelay2",id:202,el:".winterfishing .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevelAfterDelay2",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203}]}),this.addComponent(ReturnWorldComponent),this.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()}),offerId:"saleWorld2"}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.4},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.2},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.4},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.2},{type:PartMaterial.LEGEND,chance:.07}]}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500},PrizePointsProduct:{target:function(){return t.view.$el.find(".prizeControllerOuterProgressBar .markSmall")},duration:1500,after:function(){return t.view.updateProgressBar()}}}})},episodeChanged:function(){return!0},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this;BonusWorld.prototype.onCompleteBonusWorldLevelBeforeStatistic.call(this,e,t),application.waitPage("main").then(function(){return delay(500)}).then(function(){return i.trigger("onCompleteLevelAfterDelay"+e,i,e,t)})}}),SZe,TZe;figureRulesProcess.winterfishingBonusClasses=function(){FigureRules.add(".episode_winterfishing .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/artifactPart.73463a8ff1.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_winterfishing .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_winterfishing .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_winterfishing .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_winterfishing .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_winterfishing .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_winterfishing .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_winterfishing .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_winterfishing .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_winterfishing .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_winterfishing .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_winterfishing .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_winterfishing .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_winterfishing .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_winterfishing .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_winterfishing .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_winterfishing .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("winterfishing","color_fishdrop"),featuresAdder.addFeature("winterfishing","attribute_blotch"),featuresAdder.addFeature("winterfishing","pumpkin_jelly"),featuresAdder.addFeature("winterfishing","floor_winter"),featuresAdder.addFeature("winterfishing","chocolate_seaweed"),featuresAdder.addFeature("winterfishing","dropcell_rustyanchorcell"),featuresAdder.addFeature("winterfishing","strongbox_catsafe"),featuresAdder.addFeature("winterfishing","bug_yeti")},figureRulesProcess.additionalBonusScaleImages=(SZe=figureRulesProcess.additionalBonusScaleImages,function(){SZe.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/pumpkin_jelly/inkParticle.974cab3d5a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fishAnimation.15bea6baa4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fishSpawn.9027c73648.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/garment1.9dd82b0123.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/garment2.f3003a23cb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/garment3.a146e806b0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/garment4.4be1ba0bfb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/ice1.950e2ac2b6.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/ice2.d06b42eefe.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/ice3.3412ba5f0c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fireFlowerExplosion.70956edbf9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fireFlowerFire.31a4797beb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fireFlowerFireball.a9feb0487f.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/fish.3b35d3dbb4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/iceBg.f35adbed22.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/ice.618f26cf62.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/chocolateAppear.07005f5864.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/chocolateDie.f7003a6c8e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/winterfishing/color_G.0c8367e738.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(TZe=figureRulesProcess.additionalBonusClasses,function(){TZe.call(this),figureRulesProcess.winterfishingBonusClasses()});var DeliciousAdventure=BonusWorld.extend({defaults:_.defaults({name:"deliciousadventure",viewId:DeliciousAdventureView,version:20240209,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:16,showTimer:!1,minEpisodeToEnter:1,minLevelToEnter:24,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!1,showFinalForce:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,finishPrize:{type:"finalPrize",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"24h"}]},livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},noArtifactPartOnReplay:!1,progressComponent:ProgressSimpleIncrementComponent},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";UserPrizes.convertFromCocos(this.get("finishPrize")),this.prizeController=this.addComponent(PrizeController,{world:this,viewClass:PrizeControllerViewLite,pointEvents:[50,75],accountant:new PrizeProgressAccount([20,100,60,100,160,240,100,140,100,80,220,120,140,100,100,200,80,100,140,300]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"ContinuityStageProduct",stage:3}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"60m"}]},{progress:7,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{progress:8,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2},{type:"ContinuityStageProduct",stage:3}]},{progress:9,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:10,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:11,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2}]},{progress:12,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"ContinuityStageProduct",stage:3}]},{progress:13,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:15,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:16,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2},{type:"ContinuityStageProduct",stage:3}]},{progress:17,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:18,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:19,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:20,type:"middlePrize",products:[{type:"CoinsProduct",amount:2e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"48h"}]}]}),this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.LEGEND},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.TRASH},{id:15,material:PartMaterial.TRASH},{id:16,material:PartMaterial.NORMAL},{id:17,material:PartMaterial.NORMAL},{id:18,material:PartMaterial.NORMAL},{id:19,material:PartMaterial.NORMAL},{id:20,material:PartMaterial.RARE},{id:21,material:PartMaterial.RARE},{id:22,material:PartMaterial.RARE},{id:23,material:PartMaterial.LEGEND},{id:24,material:PartMaterial.LEGEND},{id:25,material:PartMaterial.LEGEND},{id:26,material:PartMaterial.LEGEND}]}),this.addComponent(ForgeComponent,{recipes:[{id:1,group:1,ingredients:[this.cmp("parts").ingredient(1),this.cmp("parts").ingredient(2),this.cmp("parts").ingredient(4),this.cmp("parts").ingredient(6)],prizes:[{products:[{type:"PrizePointsProduct",amount:30}]}]},{id:2,group:1,ingredients:[this.cmp("parts").ingredient(1),this.cmp("parts").ingredient(2),this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(4,2),this.cmp("parts").ingredient(10,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:3,group:1,ingredients:[this.cmp("parts").ingredient(1),this.cmp("parts").ingredient(2,2),this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(8,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:4,group:1,ingredients:[this.cmp("parts").ingredient(1,2),this.cmp("parts").ingredient(2,2),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(9,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:110}]}]},{id:5,group:2,ingredients:[this.cmp("parts").ingredient(1,3),this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(7,3)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:6,group:2,ingredients:[this.cmp("parts").ingredient(1,2),this.cmp("parts").ingredient(2,2),this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(11,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:7,group:2,ingredients:[this.cmp("parts").ingredient(1,2),this.cmp("parts").ingredient(2,2),this.cmp("parts").ingredient(4,3),this.cmp("parts").ingredient(8,3),this.cmp("parts").ingredient(12)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]},{id:8,group:2,ingredients:[this.cmp("parts").ingredient(1,3),this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(7,2),this.cmp("parts").ingredient(12,2),this.cmp("parts").ingredient(13)],prizes:[{products:[{type:"PrizePointsProduct",amount:150}]}]},{id:9,group:3,ingredients:[this.cmp("parts").ingredient(1,2),this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(7,2),this.cmp("parts").ingredient(9,3),this.cmp("parts").ingredient(11)],prizes:[{products:[{type:"PrizePointsProduct",amount:140}]}]},{id:10,group:3,ingredients:[this.cmp("parts").ingredient(1,3),this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(10,3),this.cmp("parts").ingredient(13)],prizes:[{products:[{type:"PrizePointsProduct",amount:120}]}]},{id:11,group:3,ingredients:[this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(5,2),this.cmp("parts").ingredient(6,3),this.cmp("parts").ingredient(9,2),this.cmp("parts").ingredient(13,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:150}]}]},{id:12,group:3,ingredients:[this.cmp("parts").ingredient(1,3),this.cmp("parts").ingredient(2,3),this.cmp("parts").ingredient(3,3),this.cmp("parts").ingredient(12),this.cmp("parts").ingredient(13)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]},{id:13,group:4,ingredients:[this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(15),this.cmp("parts").ingredient(18,2),this.cmp("parts").ingredient(21)],prizes:[{products:[{type:"PrizePointsProduct",amount:70}]}]},{id:14,group:4,ingredients:[this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(15,3),this.cmp("parts").ingredient(7,2),this.cmp("parts").ingredient(22,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:15,group:4,ingredients:[this.cmp("parts").ingredient(14,3),this.cmp("parts").ingredient(15),this.cmp("parts").ingredient(16,2),this.cmp("parts").ingredient(22,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:16,group:4,ingredients:[this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(15,2),this.cmp("parts").ingredient(16,2),this.cmp("parts").ingredient(23)],prizes:[{products:[{type:"PrizePointsProduct",amount:80}]}]},{id:17,group:4,ingredients:[this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(15,2),this.cmp("parts").ingredient(17,2),this.cmp("parts").ingredient(21),this.cmp("parts").ingredient(26)],prizes:[{products:[{type:"PrizePointsProduct",amount:60}]}]},{id:18,group:5,ingredients:[this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(6,2),this.cmp("parts").ingredient(18,2),this.cmp("parts").ingredient(19)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:19,group:5,ingredients:[this.cmp("parts").ingredient(2),this.cmp("parts").ingredient(3),this.cmp("parts").ingredient(14,3),this.cmp("parts").ingredient(20,2),this.cmp("parts").ingredient(22)],prizes:[{products:[{type:"PrizePointsProduct",amount:90}]}]},{id:20,group:5,ingredients:[this.cmp("parts").ingredient(3,2),this.cmp("parts").ingredient(14),this.cmp("parts").ingredient(6),this.cmp("parts").ingredient(19),this.cmp("parts").ingredient(9,3)],prizes:[{products:[{type:"PrizePointsProduct",amount:110}]}]},{id:21,group:5,ingredients:[this.cmp("parts").ingredient(14,3),this.cmp("parts").ingredient(7,2),this.cmp("parts").ingredient(20,2),this.cmp("parts").ingredient(24),this.cmp("parts").ingredient(25,2)],prizes:[{products:[{type:"PrizePointsProduct",amount:120}]}]},{id:22,group:5,ingredients:[this.cmp("parts").ingredient(14,2),this.cmp("parts").ingredient(9,1),this.cmp("parts").ingredient(22,2),this.cmp("parts").ingredient(11)],prizes:[{products:[{type:"PrizePointsProduct",amount:100}]}]}]});var o=[{products:[{type:"PartProduct",partId:1}]},{products:[{type:"PartProduct",partId:2}]},{products:[{type:"PartProduct",partId:3}]},{products:[{type:"PartProduct",partId:4}]},{products:[{type:"PartProduct",partId:14}]},{products:[{type:"PartProduct",partId:15}]}],a=[{products:[{type:"PartProduct",partId:5}]},{products:[{type:"PartProduct",partId:6}]},{products:[{type:"PartProduct",partId:7}]},{products:[{type:"PartProduct",partId:16}]},{products:[{type:"PartProduct",partId:17}]},{products:[{type:"PartProduct",partId:18}]},{products:[{type:"PartProduct",partId:19}]}],n=[{products:[{type:"PartProduct",partId:8}]},{products:[{type:"PartProduct",partId:9}]},{products:[{type:"PartProduct",partId:10}]},{products:[{type:"PartProduct",partId:20}]},{products:[{type:"PartProduct",partId:21}]},{products:[{type:"PartProduct",partId:22}]}];this.addComponent(BonusWorldContinuityComponent,{specialPrizes:[{rule:function(){return 2===t.getCurrentLevel()},prize:new SimplePrizeCreater({name:"first_basket",products:[{type:"PartProduct",partId:1},{type:"PartProduct",partId:2},{type:"PartProduct",partId:4},{type:"PartProduct",partId:6}]})}],prizes:[{stage:1,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a})]})},{stage:2,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:n})]})},{stage:3,prize:new MultiplePrizeCreator({prizes:[new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:o}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:a}),new RandomPrizeCreater({variants:n}),new RandomPrizeCreater({variants:n}),new RandomPrizeCreater({variants:[{products:[{type:"PartProduct",partId:11}]},{products:[{type:"PartProduct",partId:12}]},{products:[{type:"PartProduct",partId:13}]},{products:[{type:"PartProduct",partId:23}]},{products:[{type:"PartProduct",partId:24}]},{products:[{type:"PartProduct",partId:25}]},{products:[{type:"PartProduct",partId:26}]}]})]})}]}),this.addComponent(RecipeGroupComponent,{forge:this.cmp("forge"),groups:[{id:1,recipes:[{id:1},{id:2},{id:3},{id:4}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"30m"}]}]},{id:2,recipes:[{id:4},{id:5},{id:6},{id:7},{id:8}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]}]},{id:3,recipes:[{id:9},{id:10},{id:11},{id:12}],prizes:[{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"90m"}]}]},{id:4,recipes:[{id:13},{id:14},{id:15},{id:16},{id:17}],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:"2h"}]}]},{id:5,recipes:[{id:18},{id:19},{id:20},{id:21},{id:22}],prizes:[{products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:2},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"4h"}]}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.deliciousadventure",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.deliciousadventure .animationSprite1",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.deliciousadventure .animationSprite2",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.deliciousadventure .animationSprite3",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,talkKey:3},{type:StoryAnimationElement,owner:this,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.deliciousadventure .animationSprite4",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,talkKey:4},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.deliciousadventure",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.deliciousadventure",persistentClass:"hidden"}]}]},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.deliciousadventure .startCurrentLevel",name:"firstLevelForce",id:2},{type:StoryGroup,once:"onCompleteLevel1",noRetry:!0,id:3,stories:[{type:StoryTalkElement,talkKey:5,owner:this},{type:StoryForceElement,el:".deliciousadventure .continuityButton",name:"forgeForce0"},{type:StoryForceElement,el:".deliciousadventure_content .recipeGroupsWrapper",name:"forgeForce1",delayAfter:0},{type:StoryForceElement,el:".deliciousadventure_content .recipeGroupsWrapper .recipeBlock.recipe1 .assembleBtn",name:"forgeForce2"},{type:StoryForceElement,once:"prizeControllerAfterTakePrize",el:".deliciousadventure_content .prizeControllerOuterProgressBar",name:"forgeForce3"}]},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize1",id:4,talkKey:6},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize2",id:5,talkKey:7},{type:StoryTalkElement,on:"beforeGiveRecipeGroupPrize3",id:6,talkKey:8},{type:StoryTalkElement,on:"pointsProgress50",id:7,talkKey:9},{type:StoryTalkElement,on:"pointsProgress75",id:8,talkKey:10},{type:StoryTalkElement,on:"prizeControllerBeforeTakePrize20",id:9,talkKey:11},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize20",params:{noTakePrize:!0,groupPrize:!0,prize:this.prizeController.getPrizeByProgress(this.prizeController.getMaxProgress()).prize},delayAfter:0,id:100},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevelAfterDelay80",params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0,publicationOff:!0},delayAfter:0,id:101},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onCompleteLevelAfterDelay80",delayAfter:0,id:102}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.DropByContinuityComponent,id:4,rewardAd:Config.adsRewards.get("basketArtefact"),stage:1},{dropType:Artifacts.DropByContinuityComponent,id:3,coins:800,stage:3},{dropType:Artifacts.DropByContinuityComponent,id:2,coins:600,stage:2},{dropType:Artifacts.DropByContinuityComponent,id:1,coins:300,stage:1}]}),this.addComponent(ActionWorldComponent,{worldEvents:["prizeControllerAfterTakePrize"],rules:rules.Rule(function(){return!t.cmp("prizes").isFinal()})}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:60,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(ReturnWorldComponent)},episodeChanged:function(){return!0},openPrizeControllerInfo:function(){new WorldInfo({world:this})},onCompleteBonusWorldLevelBeforeStatistic:function(e,t){var i=this;BonusWorld.prototype.onCompleteBonusWorldLevelBeforeStatistic.call(this,e,t),application.waitPage("main").then(function(){return delay(500)}).then(function(){return i.trigger("onCompleteLevelAfterDelay"+e,i,e,t)})}}),i$e,m$e,n$e;PearlCell.prototype.animateTakeLife=(i$e=PearlCell.prototype.animateTakeLife,function(e){if("deliciousadventure"!==episode.get("num"))return i$e.call(this,e);if(0<this.life)for(var t=1;t<=3;t++){var i=GameBaseView.createFallDownExplodePiece("iceExplode","iceExplode".concat(t));i.alignTo(this.$div),gameView.fallDownExplodePiece(i)}this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}),figureRulesProcess.deliciousadventureBonusClasses=function(){FigureRules.add(".episode_deliciousadventure .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deliciousadventure/artifactPart.2f6f17533a.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_deliciousadventure .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("deliciousadventure","attribute_lollipop"),featuresAdder.addFeature("deliciousadventure","iceberg_berry"),featuresAdder.addFeature("deliciousadventure","frozenegg_berry"),featuresAdder.addFeature("deliciousadventure","floor_flour"),featuresAdder.addFeature("deliciousadventure","pearl_frozenfish"),featuresAdder.addFeature("deliciousadventure","mermaid_oven"),featuresAdder.addFeature("deliciousadventure","bug_cake"),featuresAdder.addFeature("deliciousadventure","ground_sweetdish"),featuresAdder.addFeature("deliciousadventure","strongbox_bearsafe"),featuresAdder.addFeature("deliciousadventure","dropcell_flour"),featuresAdder.addFeature("deliciousadventure","chocolate_dough"),featuresAdder.addFeature("deliciousadventure","snail_newyearsnail")},figureRulesProcess.additionalBonusScaleImages=(m$e=figureRulesProcess.additionalBonusScaleImages,function(){m$e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/deliciousadventure/artifactPart.2f6f17533a.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(n$e=figureRulesProcess.additionalBonusClasses,function(){n$e.call(this),figureRulesProcess.deliciousadventureBonusClasses()});var Halloween2021WorldView=BonusWorldView.extend({events:_.defaults({"click .timeoutCause.timerBlock":"showTriesInfo"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.$el.append($('<div class="prizeControllerContainer"></div>')),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new TriesInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=$(".wrapper"),t=0;t<5;++t)e.removeClass(this.model.get("name")+"_screen"+t);e.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.updateRandomLevelBtn(),this.updateTimer(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("onCompleteLevel",this.updateTimer,this),this.model.on("afterChangeLocation",this.updateTimer,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateStartBtn,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("onCompleteLevel",this.updateTimer,this),this.model.off("afterChangeLocation",this.updateTimer,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateStartBtn,this)},updateRandomLevelBtn:function(){var e=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",e>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()),this.$randomBtn.find(".mRandomLevelBtnText").html(e)},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation())},updateTimer:function(){var e=1<=this.model.getComponent(PrizeController).getProgress()&&"1"===this.model.get("location").toString()&&this.model.isClosingSoon();this.timeoutCause&&(this.model.isOnFinalLocation()||e)&&(this.timeoutCause.model=this.model,this.timeoutCause.$el.find(".mWarning").addClass("helpWindow"),this.timeoutCause.$el.find(".mWarning").html(messages[this.model.get("name")+"TimerEnd"]))},showTriesInfo:function(){new TriesInfo({world:this.model})}}),Halloween2021World=BonusWorld.extend({screens:3,defaults:_.defaults((_$defaults={name:"halloween2021world",version:20211018,levelsInEpisode:100,helpWindow:!0,viewId:Halloween2021WorldView,showFinalForce:!0,durationDays:!1,suggestPlayForLife:!0},_defineProperty(_$defaults,"helpWindow",!1),_defineProperty(_$defaults,"lastLevelOpen",!0),_defineProperty(_$defaults,"production",!0),_defineProperty(_$defaults,"saveReplayLevel",!0),_defineProperty(_$defaults,"episode",1),_defineProperty(_$defaults,"level",2),_defineProperty(_$defaults,"minEpisodeToEnter",2),_defineProperty(_$defaults,"minLevelToEnter",2),_defineProperty(_$defaults,"openDate",null),_defineProperty(_$defaults,"showProgress",!0),_defineProperty(_$defaults,"forceId",!0),_defineProperty(_$defaults,"actionQueue",new ActionQueue),_defineProperty(_$defaults,"livesInstance",new BonusWorldLives({maxLives:7,lives:7})),_defineProperty(_$defaults,"withoutInnerWindow",!0),_defineProperty(_$defaults,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives",amount:2}]),_defineProperty(_$defaults,"unlimitedName","unlimitedBonusWorldLives"),_defineProperty(_$defaults,"closeForNew",!1),_defineProperty(_$defaults,"allowPaid",!0),_defineProperty(_$defaults,"allowProlong",!1),_defineProperty(_$defaults,"prolongMaxTimes",1),_defineProperty(_$defaults,"finishWindowInStories",!0),_defineProperty(_$defaults,"allowAfterWin",!0),_defineProperty(_$defaults,"prizes",[]),_defineProperty(_$defaults,"progressComponent",ProgressSimpleIncrementComponent),_defineProperty(_$defaults,"finalLocation",5),_defineProperty(_$defaults,"noArtifactPartOnReplay",!1),_defineProperty(_$defaults,"endDate",new Date("2021/12/23 00:00")),_$defaults),BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(TriesComponent,{conditioner:TriesConditionerPresets.alwaysTrue,reminderWindowThreshold:4,variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:4}]}},{tries:2,prizes:{products:[{type:"PrizePointsProduct",amount:3}]}},{tries:3,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!0,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,accountant:new PrizeProgressAccount([8,15,30,60,90]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]},{progress:3,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"CoinsProduct",amount:200},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:5,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"SpinProduct",amount:1},{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]}]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.halloween2021world",dropOnReplayLevel:!0,artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.PartDropper({chances:{15:21,7:12},generatingModel:Artifacts.WeighedPartGeneration}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:100}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:200}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"spins",amount:1},{type:"coins",amount:200}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:7200,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"spins",amount:1},{type:"good",name:"unlimitedLifes",amount:3}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2021world .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2021world .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2021world .animationSprite3",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2021world .animationSprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.halloween2021world",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.halloween2021world",persistentClass:"hidden"}]},{type:StoryTalkElement,owner:this,page:"main",once:"prizeControllerAfterTakePrize1",talkKey:6},{type:StoryTalkElement,owner:this,once:"prizeControllerAfterTakePrize2",talkKey:7},{type:StoryTalkElement,owner:this,once:"prizeControllerAfterTakePrize3",talkKey:8},{type:StoryTalkElement,owner:this,once:"prizeControllerAfterTakePrize4",talkKey:9},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"photo4"},on:"prizeControllerAfterTakePrize5"},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"photo4"},on:"timeoutCause"},{type:StoryTalkElement,owner:this,on:"allPrizesCollected",isAvailable:function(){return 1!==t.get("location")&&5!==t.get("location")},talkKey:[10,11,12,13,14]},{type:StoryTalkElement,owner:this,on:"timeoutCause",isAvailable:function(){return 1!==t.get("location")&&5!==t.get("location")},talkKey:[15,16,17,18,19]},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:[20,21]},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes9",talkKey:22},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes12",talkKey:23},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes14",talkKey:24},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes17",talkKey:25},{type:StoryTalkElement,owner:this,once:"enterLocation5",talkKey:26},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.halloween2021world",name:"halloween2021worldForce2"},{type:StoryForceElement,owner:this.artifactController,once:"activate",page:"artifacts",id:202,el:".artifactWorkshop.halloween2021world .tree .button1",name:"halloween2021worldForce3"},{type:StoryForceElement,owner:this,once:"enter",id:204,el:".bonusWorldUI.halloween2021world .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,once:"onFinishLevel2",id:205,el:".bonusWorldUI.halloween2021world .startCurrentLevel",name:this.get("name")+"Force1"}]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new CompletePrizesCause,new TimeoutCause({time:"3d",conditions:[new ActivationCondition({minLocation:2,minProgress:1})]})],changeoverEffects:[new ResetPrizesEffect({subject:this.prizeController}),new ChangeLocationEffect({world:this,locations:[{num:2,condition:function(){return!t.isClosingSoon()}},{num:3,condition:function(){return!t.isClosingSoon()}},{num:4,condition:function(){return!t.isClosingSoon()}},{num:5,condition:function(){return t.isClosingSoon()}}]})]}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0})}}),M$e,N$e;figureRulesProcess.halloween2021worldBonusClasses=function(){},figureRulesProcess.additionalBonusScaleImages=(M$e=figureRulesProcess.additionalBonusScaleImages,function(){M$e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/halloween2021world/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/artifactPart.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/chainBlast.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/chainBlast2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/chainBlast3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/chainBlastAlt.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/candy.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/candyChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/cat.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandy1.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandy2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandy3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandyBig1.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandyBig2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandyBig3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/iceberg.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/icebergDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/sheep_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/sheepDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/sheepFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/bottle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/bottleBreak.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/bottleCrack.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/bottleNoCork.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/cork.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/ghostFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/ghostInside.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandyBigHorizontal.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2021world/frozenCandyBigVertical.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(N$e=figureRulesProcess.additionalBonusClasses,function(){N$e.call(this),figureRulesProcess.halloween2021worldBonusClasses(),FigureRules.add(".episode_halloween2021world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/artifactPlatform.png"}),FigureRules.add(".episode_halloween2021world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_halloween2021world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_halloween2021world .decorator_blocked_alt, .episode_halloween2021world .decorator_blocked_alt_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/chainBlastAlt.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_alt_remove_animatePiece1.decorator_blocked_alt_remove_animatePiece",{"background-position-x":180,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_alt_remove_animatePiece2.decorator_blocked_alt_remove_animatePiece",{"background-position-x":360,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2021world .decorator_blocked_alt_remove_animatePiece3.decorator_blocked_alt_remove_animatePiece",{"background-position-x":540,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_alt_remove_animatePiece4.decorator_blocked_alt_remove_animatePiece",{"background-position-x":720,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked, .episode_halloween2021world .decorator_blocked_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/chainBlast.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":180,"margin-left":-17/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":360,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2021world .decorator_blocked_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":540,"margin-left":14/60*Config.cellWidth,"margin-top":14/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":720,"margin-left":23/60*Config.cellWidth,"margin-top":23/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/chainBlast2.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2_remove_animatePiece",{"background-position-x":360,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/chainBlast2.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2_remove_animatePiece1.decorator_blocked_remove_animatePiece",{"background-position-x":360,"margin-left":.1*Config.cellWidth,"margin-top":-.13*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2_remove_animatePiece2.decorator_blocked_remove_animatePiece",{"background-position-x":540,"margin-left":-.18*Config.cellWidth,"margin-top":.13*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2_remove_animatePiece3.decorator_blocked_remove_animatePiece",{"background-position-x":720,"margin-left":.35*Config.cellWidth,"margin-top":-.38*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked2_remove_animatePiece4.decorator_blocked_remove_animatePiece",{"background-position-x":900,"margin-left":-.38*Config.cellWidth,"margin-top":.37*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked3, .episode_halloween2021world .decorator_blocked3_remove_animatePiece",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/chainBlast3.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked3",{"background-position-x":0}),FigureRules.add(".episode_halloween2021world .decorator_blocked3_remove_animatePiece",{"background-position-x":180}),FigureRules.add(".episode_halloween2021world .decorator_blocked3_remove_animatePiece1.decorator_blocked3_remove_animatePiece",{"background-position-x":360,"margin-left":-22/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked3_remove_animatePiece2.decorator_blocked3_remove_animatePiece",{"background-position-x":540,"margin-left":-4/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked3_remove_animatePiece3.decorator_blocked3_remove_animatePiece",{"background-position-x":720,"margin-left":11/60*Config.cellWidth,"margin-top":1/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .decorator_blocked3_remove_animatePiece4.decorator_blocked3_remove_animatePiece",{"background-position-x":900,"margin-left":31/60*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .attribute_coin",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/candy.png"}),FigureRules.add(".episode_halloween2021world .attribute_coin_remove",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/candy.png"}),FigureRules.add(".episode_halloween2021world .coinChestHeadCell",{width:131/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2021world/candyChest.png"}),FigureRules.add(".episode_halloween2021world .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_halloween2021world .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_halloween2021world .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/cat.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_halloween2021world .icebergCellBg",{"background-image":"../../../gems/site/img/features/halloween2021world/iceberg.png"}),FigureRules.add(".episode_halloween2021world .icebergExplode",{"background-image":"../../../gems/site/img/features/halloween2021world/icebergDie.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandy3.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbig1",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBig1.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbig2",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBig2.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbig3",{"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBig3.png"}),FigureRules.add(".episode_halloween2021world .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2021world/sheep_xlarge.png"}),FigureRules.add(".episode_halloween2021world .pastureCell.life2 .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2021world/sheepDark_xlarge.png"}),FigureRules.add(".episode_halloween2021world .attribute_animal.animateCollect",{"background-image":"../../../gems/site/img/features/halloween2021world/sheepFlying.png"}),FigureRules.add(".episode_halloween2021world .caviarCell .cellStone",{"background-width":70,"background-height":66,width:70/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell3 .cellStone",{frame:0}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell3 .stable",{animation:null}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell2 .stable",{animation:null}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".episode_halloween2021world .caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".episode_halloween2021world .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_R.png"}),FigureRules.add(".episode_halloween2021world .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_G.png"}),FigureRules.add(".episode_halloween2021world .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_B.png"}),FigureRules.add(".episode_halloween2021world .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_Y.png"}),FigureRules.add(".episode_halloween2021world .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_P.png"}),FigureRules.add(".episode_halloween2021world .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/halloween2021world/spider_W.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottle.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.gravityGroundLife2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.gravityGroundLife1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.gravityGroundLife1 .attributeIcon1, .episode_halloween2021world .gravityGroundCell.gravityGroundLife1 .attributeIcon2, .episode_halloween2021world .gravityGroundCell.gravityGroundLife1 .attributeIcon3, .episode_halloween2021world .gravityGroundCell.gravityGroundLife1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life1 .attributeIcon1,.episode_halloween2021world .gravityGroundCell.life1 .attributeIcon2,.episode_halloween2021world .gravityGroundCell.life1 .attributeIcon3,.episode_halloween2021world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life1 .attributeIcon2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life1 .attributeIcon3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2021world .groundLife2.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .groundLife1.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .attribute_ground",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/ghostInside.png","margin-left":-7,"margin-top":-5,scale:1}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".episode_halloween2021world .gravityGroundCell.explode",{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_halloween2021world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleBreak.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundExplode2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleBreak.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/bottleBreak.png"}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":180}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":360}),FigureRules.add(".episode_halloween2021world .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":540}),FigureRules.add(".episode_halloween2021world .cork",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/cork.png"}),FigureRules.add(".episode_halloween2021world .attribute_ground.flying",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2021world .attribute_ground.flying.attributeColor2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2021world .attribute_ground.flying.attributeColor3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2021world .attribute_ground.flying.attributeColor4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2021world .bugCell .bugCellBg",{width:136/60*Config.cellWidth,height:2.2*Config.cellHeight,"background-width":136,"background-height":132,"background-image":"../../../gems/site/img/features/halloween2021world/horsemanIdle.png","margin-left":-40/180*Config.cellWidth,"margin-top":-10/180*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/halloween2021world/horsemanIdle.png",spriteFrames:10,duration:1e3,delay:[1e3,4e3],playRound:!0}),FigureRules.add(".episode_halloween2021world .bugCell .bugCellBg.blink",{"background-image":"../../../gems/site/img/features/halloween2021world/horsemanIdle.png",spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_halloween2021world .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/halloween2021world/horsemanEat.png",spriteFrames:10,duration:1e3}),FigureRules.add(".episode_halloween2021world .bugCell .mTask",{width:185/180*Config.cellWidth,height:.4*Config.cellHeight,"background-width":185,"background-height":72,"background-image":"../../../gems/site/img/features/halloween2021world/bugLifeBlock.png"}),FigureRules.add(".episode_halloween2021world .bugCell .mTask1",{"margin-left":0*Config.cellWidth,"margin-top":65/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .bugCell .mTask1 .taskIco",{width:.5*Config.cellWidth,height:.5*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2021world/shmandyTask.png","margin-left":-8/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .bugCell .mTask2",{"margin-left":0*Config.cellWidth,"margin-top":95/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .bugCell .mTask2 .taskIco",{width:.5*Config.cellWidth,height:.5*Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/halloween2021world/spiderTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_halloween2021world .bugCell .text.mCurrentCount",{"margin-left":32/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_halloween2021world .bugCell .text.divider",{"margin-left":40/60*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_halloween2021world .bugCell .text.mMaxCount",{"margin-left":.8*Config.cellWidth,"margin-top":.25*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigVertical1",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigVertical2",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigVertical3",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigHorizontal1",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigHorizontal.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigHorizontal2",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigHorizontal.png"}),FigureRules.add(".episode_halloween2021world .frozen_frozenegg.variantbigHorizontal3",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2021world/frozenCandyBigHorizontal.png"})});var Thanksgivingday2021WorldView=BonusWorldView.extend({events:_.defaults({"click .markSmall":"openInfo"},BonusWorldView.prototype.events),initialize:function(){var e=this;BonusWorldView.prototype.initialize.call(this),this.model.once("enter",function(){e.model.artifactController.createWorkShopView().$el.appendTo($("#map .scrolledBlock"))}),this.rulesBtn=new TicketInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var t=$(".mainTemplates .mPrizeControllerOuterProgressBar"),i=this.$(".mPrizeControllerOuterProgressBarWrapper"),o=$("#rewardChain .mPrizeControllerOuterProgressBarWrapper");i.addClass("onMain").addClass(this.model.get("name")),o.addClass(this.model.get("name"));var a=t.clone().appendTo(i),n=t.clone().appendTo(o);this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:a,model:this.model.getComponent(PrizeController)}),new PrizeControllerOuterProgressBarNextAllPts({el:n,model:this.model.getComponent(PrizeController)})},openInfo:function(){new TicketInfo({world:this.model})}}),Thanksgivingday2021world=BonusWorld.extend({defaults:_.defaults({name:"thanksgivingday2021world",viewId:Thanksgivingday2021WorldView,version:20201019,levelsInEpisode:100,endDate:new Date("2022/01/20 17:00"),durationDays:!1,production:!0,closeForNew:!1,showFinalForce:!0,episode:1,level:1,allowAfterWin:!0,minEpisodeToEnter:2,minLevelToEnter:2,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,withoutInnerWindow:!0,skipLevelPublication:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],prizes:[{type:"finalPrize",level:100,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:1e3},{type:"good",cssClass:"starInField",name:"starInField",amount:32},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:72},{type:"spins",name:"spins",cssClass:"spins",amount:2},{type:"ExactArtifactPartProduct",name:"ExactArtifactPartProduct",cssClass:"part202",partId:202},{type:"ExactArtifactPartProduct",name:"ExactArtifactPartProduct",cssClass:"part101",partId:101}]}],unlimitedName:"unlimitedBonusWorldLives2"},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.battlePass=new BattlePass({world:this,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedBonusWorldLives2},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]}}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,autoRender:!1,artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:200,parts:[{type:PartMaterial.NORMAL,chance:1}]},{dropType:Artifacts.PartShopByMaterial,id:2,coins:600,parts:[{type:PartMaterial.NORMAL,chance:.6},{type:PartMaterial.RARE,chance:.4}]},{id:3,coins:699,dropType:Artifacts.PartShopByMaterial,parts:[{type:PartMaterial.NORMAL,chance:.5},{type:PartMaterial.RARE,chance:.3,box:[1]},{type:PartMaterial.LEGEND,chance:.2,box:[2]}]}]},artifactWorkshop:{partSource:new Artifacts.PartDroopperByMaterial({chances:{15:55,7:55},perMoveChance:{15:{normal:.35,rare:.15,legend:.05},7:{normal:.3,rare:.2,legend:.05}}}),config:{showAll:!1,parts:[{id:1,material:PartMaterial.NORMAL,chance:.5},{id:2,material:PartMaterial.NORMAL,chance:.5},{id:3,material:PartMaterial.NORMAL,chance:.5},{id:4,material:PartMaterial.NORMAL,chance:.5},{id:5,material:PartMaterial.NORMAL,chance:.5},{id:6,material:PartMaterial.NORMAL,chance:.5},{id:7,material:PartMaterial.NORMAL,chance:.5},{id:8,material:PartMaterial.NORMAL,chance:.5},{id:9,material:PartMaterial.NORMAL,chance:.5},{id:10,material:PartMaterial.NORMAL,chance:.5},{id:11,material:PartMaterial.NORMAL,chance:.5},{id:12,material:PartMaterial.NORMAL,chance:.5},{id:13,material:PartMaterial.NORMAL,chance:.5},{id:14,material:PartMaterial.NORMAL,chance:.5},{id:15,material:PartMaterial.NORMAL,chance:.5},{id:16,material:PartMaterial.NORMAL,chance:.5},{id:101,material:PartMaterial.RARE,chance:.375},{id:102,material:PartMaterial.RARE,chance:.375},{id:103,material:PartMaterial.RARE,chance:.375},{id:104,material:PartMaterial.RARE,chance:.375},{id:105,material:PartMaterial.RARE,chance:.375},{id:106,material:PartMaterial.RARE,chance:.375},{id:107,material:PartMaterial.RARE,chance:.375},{id:108,material:PartMaterial.RARE,chance:.375},{id:109,material:PartMaterial.RARE,chance:.375},{id:110,material:PartMaterial.RARE,chance:.375},{id:201,material:PartMaterial.LEGEND,chance:.125},{id:202,material:PartMaterial.LEGEND,chance:.125},{id:203,material:PartMaterial.LEGEND,chance:.125},{id:204,material:PartMaterial.LEGEND,chance:.125},{id:205,material:PartMaterial.LEGEND,chance:.125},{id:206,material:PartMaterial.LEGEND,chance:.125}],artifacts:[{id:1,parts:[1,2,3,4],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:2,parts:[2,5,103,101],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:3,parts:[2,5,101,201],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"PrizePointsProduct",amount:15}]}},{id:4,parts:[6,16,4,102],prize:{products:[{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:5,parts:[5,4,104,103],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:6,parts:[5,8,102,202],prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:"30m",goodId:i},{type:"PrizePointsProduct",amount:15}]}},{id:7,parts:[2,7,14,103],prize:{products:[{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:5}]}},{id:8,parts:[2,12,106,109],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:9,parts:[14,7,104,203],prize:{products:[{type:"BoosterProduct",boosterId:"DeleteCell",amount:1},{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:15}]}},{id:10,parts:[6,15,14,101],prize:{products:[{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:11,parts:[13,11,106,105],prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"PrizePointsProduct",amount:10}]}},{id:12,parts:[6,13,108,205],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:"1h",goodId:i},{type:"PrizePointsProduct",amount:15}]}},{id:13,parts:[5,4,12,108],prize:{products:[{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:5}]}},{id:14,parts:[12,1,108,102],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:15,parts:[15,1,104,202],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",addTime:"1h",goodId:i},{type:"PrizePointsProduct",amount:15}]}},{id:16,parts:[8,9,7,109],prize:{products:[{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:17,parts:[8,3,106,108],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:18,parts:[12,9,106,204],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1},{type:"PrizePointsProduct",amount:15}]}},{id:19,parts:[14,3,16,109],prize:{products:[{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:5}]}},{id:20,parts:[7,15,102,101],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:21,parts:[4,3,104,203],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.starInField},{type:"PrizePointsProduct",amount:15}]}},{id:22,parts:[13,11,9,110],prize:{products:[{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:23,parts:[10,13,105,110],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"PrizePointsProduct",amount:10}]}},{id:24,parts:[11,9,107,206],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"SpinProduct",amount:1},{type:"PrizePointsProduct",amount:15}]}},{id:25,parts:[6,13,16,103],prize:{products:[{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:5}]}},{id:26,parts:[6,10,105,110],prize:{products:[{type:"BoosterProduct",boosterId:"DeleteCell",amount:1},{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:10}]}},{id:27,parts:[16,13,107,205],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.addThreeMoves},{type:"PrizePointsProduct",amount:15}]}},{id:28,parts:[10,12,9,107],prize:{products:[{type:"BoosterProduct",boosterId:"DeleteCell",amount:1},{type:"CoinsProduct",amount:50},{type:"PrizePointsProduct",amount:5}]}},{id:29,parts:[11,13,110,107],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"CoinsProduct",amount:100},{type:"PrizePointsProduct",amount:10}]}},{id:30,parts:[10,11,105,201],prize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1},{type:"PrizePointsProduct",amount:15}]}}],slots:[{id:1,artifacts:[1,2,3]},{id:2,artifacts:[4,5,6]},{id:3,artifacts:[7,8,9]},{id:4,artifacts:[10,11,12]},{id:5,artifacts:[13,14,15]},{id:6,artifacts:[16,17,18]},{id:7,artifacts:[19,20,21]},{id:8,artifacts:[22,23,24]},{id:9,artifacts:[25,26,27]},{id:10,artifacts:[28,29,30]}]}}});var o=this.artifactController.getSlots().filter(function(e){return e.getArtifact()}).length;this.artifactController.getSlots().on("change:artifact",function(){var e=t.artifactController.getSlots().filter(function(e){return e.getArtifact()}).length;o!=e&&(o=e,t.trigger("setArtifactCount"+e))}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,once:"enter",delayAfter:0},{type:StoryTalkElement,once:"enter",talkKey:1},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},once:"enter"},{type:StoryTalkElement,delay:1500,once:"enter",talkKey:2},{type:StoryForceElement,once:"enter",el:".thanksgivingday2021world .mStartBtn",name:this.get("name")+"Force0"},{type:StoryTalkElement,once:"onCompleteLevel1",talkKey:3},{type:StoryForceElement,once:"onCompleteLevel1",el:".thanksgivingday2021world .mStartBtn",name:this.get("name")+"Force1"},{type:StoryForceElement,on:"onCompleteLevel2",scrollTo:".thanksgivingday2021world .tree .button1",el:".thanksgivingday2021world .tree .button1",name:this.get("name")+"Force2"},{type:StoryForceElement,once:"artifactCollectionWindowOpened",el:".artifactCollectionWindow .artifact28 .artifactPart9",name:this.get("name")+"Force3"},{type:StoryForceElement,once:"onCompleteLevel2",el:".thanksgivingday2021world_content .thanksgivingday2021world .mPrizeControllerOuterProgressBarWrapper",name:this.get("name")+"Force4"},{type:StoryForceElement,once:"onCompleteLevel2",el:".rewardChainBtn.thanksgivingday2021world",name:this.get("name")+"Force5"},{type:StoryForceElement,once:"onCompleteLevel3",el:".thanksgivingday2021world .mMiniTaskBtn",name:this.get("name")+"Force6"},{type:StoryTalkElement,once:"onFinishLevel20",talkKey:5},{type:StoryTalkElement,once:"onFinishLevel20",talkKey:6},{type:StoryTalkElement,once:"onFinishLevel40",talkKey:10},{type:StoryTalkElement,once:"onFinishLevel40",talkKey:11},{type:StoryTalkElement,once:"onFinishLevel100",talkKey:14},{type:StoryAnimationElement,once:"setArtifactCount1",scrollTo:".task1",elements:[{el:".mapAnimationsMiddle .task1",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount1",talkKey:4},{type:StoryAnimationElement,once:"setArtifactCount2",scrollTo:".task2",elements:[{el:".mapAnimationsMiddle .task2",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount2",talkKey:7},{type:StoryAnimationElement,once:"setArtifactCount3",scrollTo:".task3",elements:[{el:".mapAnimationsMiddle .task3",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount3",talkKey:8},{type:StoryAnimationElement,once:"setArtifactCount4",scrollTo:".task4",elements:[{el:".mapAnimationsMiddle .task4",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount4",talkKey:9},{type:StoryAnimationElement,once:"setArtifactCount5",scrollTo:".task5",elements:[{el:".mapAnimationsMiddle .task5",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount5",talkKey:12},{type:StoryAnimationElement,once:"setArtifactCount6",scrollTo:".task6",elements:[{el:".mapAnimationsMiddle .task6",persistentClass:"visible1"}]},{type:StoryTalkElement,once:"setArtifactCount6",talkKey:13}]}),this.addComponent(PrizeEventController,{world:this,event:"winLevel",prize:{products:[{type:"PrizePointsProduct",amount:1}]}}),this.addComponent(PrizeController,{world:this,accountant:new PrizeProgressAccount([5,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:5,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:6,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"}]},{progress:7,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:8,type:"middlePrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:9,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:10,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:11,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:12,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:13,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:15,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"3h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"3h"}]},{progress:16,type:"middlePrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:17,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:i,addTime:"2h"}]},{progress:18,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1}]},{progress:19,type:"middlePrize",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"8h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"48h"}]},{progress:1,type:"battlePass",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"}]},{progress:2,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:3,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:4,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"}]},{progress:5,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"GoodProduct",goodId:i,addTime:"2h"},{type:"ExactArtifactPartProduct",partId:107}]},{progress:6,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:7,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"4h"},{type:"ExactArtifactPartProduct",partId:105}]},{progress:8,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"SpinProduct",amount:1}]},{progress:9,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"2h"},{type:"ExactArtifactPartProduct",partId:104}]},{progress:10,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:11,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"},{type:"GoodProduct",goodId:i,addTime:"2h"},{type:"ExactArtifactPartProduct",partId:101}]},{progress:12,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:13,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:14,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:15,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:16,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:17,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:18,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"ExactArtifactPartProduct",partId:201},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:19,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"8h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"8h"}]}]}),this.addComponent(MiniTasksComponent,{items:[{id:1,task:new CompletedLevelTask({level:3}),prize:{products:[{type:"PrizePointsProduct",amount:5}]}},{id:2,task:new CompletedLevelTask({level:7}),prize:{products:[{type:"PrizePointsProduct",amount:10}]}},{id:3,task:new CompletedLevelTask({level:15}),prize:{products:[{type:"PrizePointsProduct",amount:15}]}},{id:4,task:new CompletedLevelTask({level:30}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:5,task:new CompletedLevelTask({level:50}),prize:{products:[{type:"PrizePointsProduct",amount:30}]}},{id:6,task:new CompletedLevelTask({level:75}),prize:{products:[{type:"PrizePointsProduct",amount:35}]}},{id:7,task:new CompletedLevelTask({level:100}),prize:{products:[{type:"PrizePointsProduct",amount:45}]}},{id:8,task:new InsertArtifactsTask({amount:1}),prize:{products:[{type:"PrizePointsProduct",amount:10}]}},{id:9,task:new InsertArtifactsTask({amount:3}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:10,task:new InsertArtifactsTask({amount:6}),prize:{products:[{type:"PrizePointsProduct",amount:30}]}},{id:11,task:new InsertArtifactsTask({amount:10}),prize:{products:[{type:"PrizePointsProduct",amount:40}]}},{id:12,task:new AssemblyArtifactsTask({artifacts:[1,2,3]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:13,task:new AssemblyArtifactsTask({artifacts:[4,5,6]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:14,task:new AssemblyArtifactsTask({artifacts:[7,8,9]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:15,task:new AssemblyArtifactsTask({artifacts:[10,11,12]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:16,task:new AssemblyArtifactsTask({artifacts:[13,14,15]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:17,task:new AssemblyArtifactsTask({artifacts:[16,17,18]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:18,task:new AssemblyArtifactsTask({artifacts:[19,20,21]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:19,task:new AssemblyArtifactsTask({artifacts:[22,23,24]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:20,task:new AssemblyArtifactsTask({artifacts:[25,26,27]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}},{id:21,task:new AssemblyArtifactsTask({artifacts:[28,29,30]}),prize:{products:[{type:"PrizePointsProduct",amount:20}]}}]})}}),d_e,e_e;figureRulesProcess.additionalBonusScaleImages=(d_e=figureRulesProcess.additionalBonusScaleImages,function(){d_e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{})}),figureRulesProcess.additionalBonusClasses=(e_e=figureRulesProcess.additionalBonusClasses,function(){e_e.call(this)});var BigFishGameWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:this.$(".mPrizeControllerOuterProgressBar"),model:this.model.getComponent(PrizeController)}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model});var e=this.model.getComponent(PrizeController);if(e){var t=$("#prizeControllerTemplates .prizeInfoBox").clone(),i=this.$(".prizesInfoContainer");i.addClass(this.model.get("name")),t.appendTo(i),t.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:t,model:e})}},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=this.model.getComponent(PrizeController),t=$(".wrapper"),i=0;i<3;++i)t.removeClass(this.model.get("name")+"_screen"+i);t.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn(),this.updateRandomLevelBtn(),this.updatePrizesFinishedClass(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateStartBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("afterChangeLocation",this.updateStartBtn,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateStartBtn,this),e.off("change:points",this.updatePrizesFinishedClass,this)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()&&e.getPoints()<e.getMaxPointsPossible()),this.$randomBtn.find(".mRandomLevelBtnText").html(t)},updateStartBtn:function(){var e=this.model.getComponent(PrizeController),t=this.$ui.find(".mStartBtn"),i=this.model.get("progress"),o=this.model.getCurrentLevel();t.find(".mLevel").html(i),t.toggleClass("active",o<=this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()&&e.getPoints()<e.getMaxPointsPossible())},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())}}),BigFishGameWorld=BonusWorld.extend({defaults:_.defaults((_$defaults2={name:"bigfishgameworld",viewId:BigFishGameWorldView,version:20210921,production:!0,levelsInEpisode:80,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:23,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,closeForNew:!1,helpWindow:!0},_defineProperty(_$defaults2,"helpWindow",!0),_defineProperty(_$defaults2,"showFinalForce",!0),_defineProperty(_$defaults2,"allowAfterWin",!0),_defineProperty(_$defaults2,"allowPaid",!0),_defineProperty(_$defaults2,"allowProlong",!1),_defineProperty(_$defaults2,"prolongMaxTimes",1),_defineProperty(_$defaults2,"actionQueue",new ActionQueue),_defineProperty(_$defaults2,"prizes",[]),_defineProperty(_$defaults2,"livesInstance",new BonusWorldLives),_defineProperty(_$defaults2,"endDate",new Date("2021/11/23 07:00")),_defineProperty(_$defaults2,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}]),_defineProperty(_$defaults2,"unlimitedName","unlimitedBonusWorldLives2"),_defineProperty(_$defaults2,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults2,"progressComponent",ProgressSimpleIncrementComponent),_defineProperty(_$defaults2,"noArtifactPartOnReplay",!1),_$defaults2),BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0}),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!0,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,pointEvents:[50,75],accountant:new PrizeProgressAccount([1e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"CoinsProduct",amount:1500},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:3},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:43200},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:86400},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:10800},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:10800}]}]});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.NORMAL},{id:3,material:PartMaterial.NORMAL},{id:4,material:PartMaterial.NORMAL},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.RARE},{id:7,material:PartMaterial.RARE},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.LEGEND},{id:11,material:PartMaterial.LEGEND},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,{recipes:[{id:1,ingredients:[o.ingredient(1,10)],prizes:[{products:[{type:"CoinsProduct",amount:30},{type:"PrizePointsProduct",amount:10}]},{type:"BattlePassPrize",products:[{type:"CoinsProduct",amount:40},{type:"PrizePointsProduct",amount:5}]}]},{id:2,ingredients:[o.ingredient(2),o.ingredient(3),o.ingredient(4),o.ingredient(5)],prizes:[{products:[{type:"CoinsProduct",amount:30},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:1800},{type:"PrizePointsProduct",amount:15}]},{type:"BattlePassPrize",products:[{type:"CoinsProduct",amount:70},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"GoodProduct",goodId:i,addTime:3600},{type:"PrizePointsProduct",amount:10}]}]},{id:3,ingredients:[o.ingredient(3),o.ingredient(4),o.ingredient(6),o.ingredient(7)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:3600},{type:"SpinProduct",amount:1},{type:"PrizePointsProduct",amount:25}]},{type:"BattlePassPrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"PrizePointsProduct",amount:15}]}]},{id:4,ingredients:[o.ingredient(4),o.ingredient(7),o.ingredient(8),o.ingredient(9)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"PrizePointsProduct",amount:35}]},{type:"BattlePassPrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800},{type:"GoodProduct",goodId:i,addTime:7200},{type:"PrizePointsProduct",amount:25}]}]},{id:5,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:3600},{type:"GoodProduct",goodId:i,addTime:3600},{type:"PrizePointsProduct",amount:45}]},{type:"BattlePassPrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800},{type:"PrizePointsProduct",amount:35}]}]},{id:6,ingredients:[o.ingredient(5),o.ingredient(8),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:3600},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:7200},{type:"PrizePointsProduct",amount:60}]},{type:"BattlePassPrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:3600},{type:"SpinProduct",amount:1},{type:"PrizePointsProduct",amount:45}]}]},{id:7,ingredients:[o.ingredient(10),o.ingredient(11),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"PrizePointsProduct",amount:70}]},{type:"BattlePassPrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:7200},{type:"PrizePointsProduct",amount:60}]}]}]}),this.addComponent(CollectorsAgency,{collectors:[new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:4,perMoveChance:14,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.425,normal:.365,rare:.16,legend:.05},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:14,rules:[rules.NoBattlePass(this)],materials:{trash:.525,normal:.325,rare:.125,legend:.025},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:18,rules:[rules.HasBattlePass(this)],materials:{trash:.425,normal:.365,rare:.16,legend:.05},parts:o.getParts()})]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new ForgeRecipeCompleteCause({targetNum:6,forge:this.getComponent(ForgeComponent),ignoredItems:[1]})],changeoverEffects:[new ChangeLocationEffect({world:this,locations:[{num:1,condition:function(){return!0}},{num:2,condition:function(){return!0}},{num:3,condition:function(){return!0}}]})]}),this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,catchupWindowRule:rules.EveryTimePerRule(4,function(){return t.storage},"showCatchupRule"),catchupWindowActivator:new EventSignal("itemCrafted",this.getComponent("forge")),instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedBonusWorldLives2},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"PrizePointsProduct",amount:100}]}}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.bigfishgameworld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.bigfishgameworld .animationSprite2",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.bigfishgameworld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.bigfishgameworld .animationSprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:3},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"enter"},{type:StoryAnimationElement,owner:this,once:"enter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.bigfishgameworld",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".bonusWorldAnimations.bigfishgameworld",persistentClass:"hidden"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",talkKey:5},{type:StoryTalkElement,once:"itemCrafted1",talkKey:6},{type:StoryTalkElement,once:"itemCrafted2",talkKey:7},{type:StoryTalkElement,once:"itemCrafted3",talkKey:8},{type:StoryTalkElement,once:"itemCrafted4",talkKey:9},{type:StoryTalkElement,once:"itemCrafted5",talkKey:10},{type:StoryTalkElement,once:"itemCrafted6",talkKey:11},{type:StoryTalkElement,once:"itemCrafted7",talkKey:12},{type:StoryTalkElement,on:"beforeChangeLocation",talkKey:13},{type:StoryTalkElement,on:"enterLocation1",talkKey:14},{type:StoryTalkElement,on:"enterLocation2",talkKey:15},{type:StoryTalkElement,on:"enterLocation13",talkKey:16},{type:StoryTalkElement,on:"pointsProgress50",talkKey:17},{type:StoryTalkElement,on:"pointsProgress75",talkKey:18},{type:StoryTalkElement,on:"allPrizesCollected",talkKey:19},{type:StoryTalkElement,isAvailable:function(){return!t.get("hasBattlePass")},on:"afterChangeLocation",talkKey:20},{type:StoryTalkElement,isAvailable:function(){return!t.get("hasBattlePass")},on:"itemCrafted",talkKey:20},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".bonusWorldUI.bigfishgameworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,on:"onFinishLevel3",id:201,el:".bigfishgameworld .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onFinishLevel3",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:202}]})},episodeChanged:function(){return!0}}),K_e,L_e;figureRulesProcess.bigfishgameworldBonusClasses=function(){FigureRules.add(".episode_bigfishgameworld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/bigfishgameworld/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_bigfishgameworld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_bigfishgameworld .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/basket.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_bigfishgameworld .wellCell.wellLevel2",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_bigfishgameworld .wellCell.wellLevel3",{"background-position-x":360,"background-position-y":0,spriteFrames:2,duration:300,playRound:!1}),FigureRules.add(".episode_bigfishgameworld .wellCell.wellLevel4",{"background-position-x":360,"background-position-y":0,spriteFrames:2,duration:300,playRound:!1}),FigureRules.add(".episode_bigfishgameworld .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/fish.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .color_N.waterAnimated",{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_bigfishgameworld .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/fish.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/fishMiniTask.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_bigfishgameworld .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":362,"background-height":371,"background-image":"../../../gems/site/img/features/bigfishgameworld/catStable.png","margin-left":0,"margin-top":0,spriteFrames:17,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],duration:1400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_bigfishgameworld .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/bigfishgameworld/catDamaged.png",spriteFrames:19,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],duration:1500,playRound:!1,delay:0}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .currentLife, .episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .divider, .episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_bigfishgameworld .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_bigfishgameworld .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/garment1.png"}),FigureRules.add(".episode_bigfishgameworld .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/garment2.png"}),FigureRules.add(".episode_bigfishgameworld .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/garment3.png"}),FigureRules.add(".episode_bigfishgameworld .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bigfishgameworld/garment4.png"}),FigureRules.add(".episode_bigfishgameworld .attribute_key",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"margin-left":0,"margin-top":0,"background-image":"../../../gems/site/img/features/bigfishgameworld/attribute_blotchkey.png"}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse",{"background-position-y":0,"background-width":133,"background-height":148,"background-image":"../../../gems/site/img/features/bigfishgameworld/fishAnimation.png",width:133/180*Config.cellWidth,height:148/180*Config.cellHeight,"margin-left":23.5/180*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,"scale-x":-1}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse.takeLife",{"background-position-x":399,spriteFrames:3,duration:300,playRound:!0}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_bigfishgameworld .move_crabMouse, .episode_bigfishgameworld .crabMouseCollect",{"scale-x":-1,"background-position-x":798,"background-position-y":0,"background-width":133,"background-height":148,"background-image":"../../../gems/site/img/features/bigfishgameworld/fishAnimation.png",width:133/180*Config.cellWidth,height:148/180*Config.cellHeight,"margin-left":23.5/180*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,spriteFrames:3,duration:500,playRound:!0}),FigureRules.add(".episode_bigfishgameworld .move_crabMouse.moveRight",{"scale-x":1,"margin-left":23.5/180*Config.cellWidth}),FigureRules.add(".episode_bigfishgameworld .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse .lifeBlock",{"scale-x":-1,"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":56/60*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#ff0"}),FigureRules.add(".episode_bigfishgameworld .decorator_crabMouse.lifeLevel1 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_bigfishgameworld .groundCell .decorator",{"margin-left":.1*Config.cellWidth,"margin-top":.1*Config.cellWidth}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmCell",{"background-position-x":0,"background-position-y":0,"background-width":185,"background-height":200,"background-image":"../../../gems/site/img/features/bigfishgameworld/fishCoral.png",width:185/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-3/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmCellCrabMouse",{"background-position-x":1230,"background-position-y":0,"background-width":123,"background-height":116,"background-image":"../../../gems/site/img/features/bigfishgameworld/fishSpawn.png",width:123/180*Config.cellWidth,height:116/180*Config.cellHeight,"margin-left":28.5/180*Config.cellWidth}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel0 .crabMouseFarmCellCrabMouse.stable",{"background-image":""}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":123,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":492,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":861,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":0,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":492,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_bigfishgameworld .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":861,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_bigfishgameworld .pumpkinCell",{"background-image":""}),FigureRules.add(".episode_bigfishgameworld .pumpkin",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/bigfishgameworld/jellyfish.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0}),FigureRules.add(".episode_bigfishgameworld .pumpkin.pumpkinShot",{"background-image":"../../../gems/site/img/features/bigfishgameworld/jellyfish.png",spriteFrames:12,duration:800}),FigureRules.add(".episode_bigfishgameworld .pumpkin.pumpkinDamage",{spriteFrames:1,playRound:!1,duration:1}),FigureRules.add(".episode_bigfishgameworld .pumpkinFire",{opacity:0}),FigureRules.add(".episode_bigfishgameworld .pumpkin.pumpkinDie",{"background-image":"../../../gems/site/img/features/bigfishgameworld/jellyfish.png",spriteFrames:1,duration:1,animation:{params:{width:[1*Config.cellWidth,.25*Config.cellWidth],height:[1*Config.cellHeight,.25*Config.cellHeight],"margin-left":[0*Config.cellWidth,20/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,20/60*Config.cellHeight],opacity:[1,0]},duration:500}}),FigureRules.add(".episode_bigfishgameworld .pumpkinLife",{width:20/60*Config.cellWidth,height:14/60*Config.cellHeight,font:"bold "+14/60*Config.cellWidth+"px/"+.2*Config.cellWidth+"px Tahoma",color:"#6b1200","text-left":43/60*Config.cellWidth,"text-top":67/60*Config.cellHeight,textAlign:"center"}),FigureRules.add(".episode_bigfishgameworld .cannonball",{"background-position-x":0,"background-position-y":0,"background-width":65,"background-height":79,"background-image":"../../../gems/site/img/features/bigfishgameworld/inkParticle.png",width:65/180*Config.cellWidth,height:79/180*Config.cellHeight,"margin-left":25/65*Config.cellWidth,"margin-top":23/79*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .cannonball.cannonballExplosion",{opacity:0}),FigureRules.add(".episode_bigfishgameworld .pumpkin .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"../../../gems/site/img/features/bigfishgameworld/lifeBlock.png",width:56/60*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":.75*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .pumpkin .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:5/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_bigfishgameworld .pumpkin .pumpkinLife",{opacity:0}),FigureRules.add(".episode_bigfishgameworld .pumpkin .less50PercentLife.lifeBar",{"background-color":"#ffff00"}),FigureRules.add(".episode_bigfishgameworld .pumpkin .less25PercentLife.lifeBar",{"background-color":"#f2342c"})},figureRulesProcess.additionalBonusScaleImages=(K_e=figureRulesProcess.additionalBonusScaleImages,function(){K_e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/bigfishgameworld/inkParticle.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/basket.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/catDamaged.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/catStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/fishAnimation.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/fishSpawn.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/bigfishgameworld/garment4.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(L_e=figureRulesProcess.additionalBonusClasses,function(){L_e.call(this),figureRulesProcess.bigfishgameworldBonusClasses()});var BirthDay2021WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:this.$(".mPrizeControllerOuterProgressBar"),model:this.model.getComponent(PrizeController)}),this.model.on("change:team",this.onUpdateTeam,this),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.$randomBtn=this.$(".mRunRandomLevelBtn");var e=this.model.getComponent(PrizeController);if(e){var t=$("#prizeControllerTemplates .prizeInfoBox").clone(),i=this.$(".prizesInfoContainer");i.addClass(this.model.get("name")),t.appendTo(i),t.addClass(this.model.get("name")),this.prizeInfo=new PrizeInfoView({el:t,model:e})}},onUpdateTeam:function(){var e=this.model.get("team");$(".wrapper").removeClass("team1 team2").addClass(e)},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);var e=this.model.getComponent(PrizeController);this.prizeControllerProgressbar.update(),this.onUpdateTeam(),this.updateRandomLevelBtn(),this.updatePrizesFinishedClass(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updatePrizesFinishedClass,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updatePrizesFinishedClass,this)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&e.getPoints()<e.getMaxPointsPossible()),this.$randomBtn.find(".mRandomLevelBtnText").html(messages[this.model.get("name")+"LookForItems"])},updatePrizesFinishedClass:function(){var e=this.model.getComponent(PrizeController);$("#main").toggleClass(this.model.get("name")+"_allPrizesCollected",e.isFinished())}}),Birthday2021world=BonusWorld.extend({defaults:_.defaults((_$defaults3={name:"birthday2021world",viewId:BirthDay2021WorldView,version:20210830,production:!0,helpWindow:!0,showFinalForce:!0,levelsInEpisode:60,durationDays:!1,episode:1,level:2,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:2,finishWindowInStories:!0,withoutInnerWindow:!0,forceId:!0,openDate:null,suggestPlayForLife:!0},_defineProperty(_$defaults3,"helpWindow",!0),_defineProperty(_$defaults3,"closeForNew",!1),_defineProperty(_$defaults3,"allowAfterWin",!0),_defineProperty(_$defaults3,"allowPaid",!0),_defineProperty(_$defaults3,"saveReplayLevel",!0),_defineProperty(_$defaults3,"allowProlong",!1),_defineProperty(_$defaults3,"prolongMaxTimes",1),_defineProperty(_$defaults3,"actionQueue",new ActionQueue),_defineProperty(_$defaults3,"livesInstance",new BonusWorldLives),_defineProperty(_$defaults3,"endDate",new Date("2021/10/26 17:00")),_defineProperty(_$defaults3,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives",amount:2}]),_defineProperty(_$defaults3,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults3,"showProgress",!0),_defineProperty(_$defaults3,"prizes",[]),_$defaults3),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e);var t="unlimitedBonusWorldLives";this.prizeController=this.addComponent(PrizeController,{world:this,accountant:new PrizeProgressAccount([10,80,200,400,600,1e3,400,1200,800,2e3,1e3,3e3]),prizes:[{progress:1,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:1,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:2,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"SpinProduct",amount:1}]},{progress:3,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:3,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:t,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:4,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"},{type:"SpinProduct",amount:1}]},{progress:5,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:5,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:t,addTime:"30m"}]},{progress:6,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1}]},{progress:6,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:7,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:7,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:8,type:"middlePrize",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1}]},{progress:8,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"1h"},{type:"GoodProduct",goodId:t,addTime:"1h"}]},{progress:9,type:"battlePass",products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:10,type:"middlePrize",products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"1h"}]},{progress:10,type:"battlePass",products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:2},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:11,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:11,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1}]},{progress:12,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"48h"}]},{progress:12,type:"battlePass",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"12h"}]}]}),this.battlePass=new BattlePass({world:this,catchupWindowRule:catchupWindowShowRules.everyThirdPrize,catchupWindowActivator:new EventSignal("change:progress",this.getComponent(PrizeController)),instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedBonusWorldLives},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"PrizePointsProduct",amount:200}]}}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!1,saveReplayLevel:!0}),this.questController=new QuestController({world:this,hasTasksWindow:!0,name:this.get("name"),tasks:[{id:1,price:1},{id:2,price:1,required:[1]},{id:3,price:2,required:[2]},{id:4,price:1,required:[3]},{id:5,price:2,required:[4]},{id:6,price:2,required:[5]},{id:7,price:1,required:[6]},{id:8,price:2,required:[7]},{id:9,price:1,required:[8]},{id:10,price:3,world:this,required:[9],modifier:"team",options:!0,options_isShadow:!0,options_viewId:"SelectTeamOptionView",prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedBonusWorldLives}]}},{id:11,price:1,required:[10]},{id:12,price:2,required:[11]},{id:13,price:2,required:[12]},{id:14,price:1,required:[13]},{id:15,price:3,required:[14]},{id:16,price:1,required:[15]},{id:17,price:2,required:[16]},{id:18,price:3,required:[17]},{id:19,price:1,required:[18]},{id:20,price:2,required:[19]},{id:21,price:2,required:[20]},{id:22,price:2,required:[21]},{id:23,price:2,required:[22]},{id:24,price:2,required:[23],options:!0},{id:25,price:3,world:this,required:[24],prize:{products:[{type:"GoodProduct",addTime:7200,goodId:GoodTypes.unlimitedBonusWorldLives},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn}]}},{id:26,price:2,required:[25]},{id:27,price:2,required:[26],options:!0,options_isShadow:!0},{id:28,price:2,required:[27]},{id:29,price:2,required:[28]},{id:30,price:2,required:[29]},{id:31,price:2,required:[30]},{id:32,price:3,world:this,required:[31],prize:{products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.addThreeMoves},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"SpinProduct",amount:1}]}}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0},{type:StoryTalkElement,owner:this,once:"enter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".questContainer.birthday2021world .screen1.birthday2021world .bg.pirate",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this,once:"enter",talkKey:2},{type:StoryForceElement,owner:this,once:"enter",delay:1e3,el:".questUi_birthday2021world .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",el:".birthday2021world_content .birthday2021world .mPrizeControllerOuterProgressBarWrapper",name:"talkBattlePassTutorial1"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",el:".bonusworld_birthday2021world .episode_birthday2021world .buyBattlePassBtn.birthday2021world",name:"talkBattlePassTutorial2"},{type:StoryTalkElement,owner:this,once:"onFinishLevel1",talkKey:36},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",scrollTo:".task1",elements:[{el:".screen1.birthday2021world .task1.docmage",persistentClass:"visible1"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask1",talkKey:3},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask2",talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3",scrollTo:".task1",elements:[{el:".screen1.birthday2021world .task1.docmage",persistentClass:"updated"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"updated"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"updated"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask3",talkKey:5},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask4",talkKey:6},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",talkKey:7},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",scrollTo:".task5",elements:[{el:".screen1.birthday2021world .task5",persistentClass:"visible1"},{el:".screen1.birthday2021world .task1.docmage",cleanClass:"updated"},{el:".screen1.birthday2021world .task1.mabelnagel",cleanClass:"updated"},{el:".screen1.birthday2021world .bg.girl",cleanClass:"updated"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",talkKey:8},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask6",scrollTo:".task5",elements:[{el:".screen1.birthday2021world .task5",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask6",talkKey:9},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",scrollTo:".task5",elements:[{el:".screen1.birthday2021world .task1.docmage",persistentClass:"updated"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"updated"},{el:".screen1.birthday2021world .bg.girl",cleanClass:"updated"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask7",talkKey:10},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",scrollTo:".task5",elements:[{el:".screen1.birthday2021world .task5",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask8",talkKey:11},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",scrollTo:".task8",elements:[{el:".screen1.birthday2021world .task8",persistentClass:"visible1"},{el:".screen1.birthday2021world .task1.docmage",persistentClass:"updated"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"updated"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"updated"},{el:".screen1.birthday2021world .task5",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask9",talkKey:12},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9",scrollTo:".task8",elements:[{el:".screen1.birthday2021world .task8",persistentClass:"updated"},{el:".screen1.birthday2021world .task1.docmage",persistentClass:"hidden1"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"hidden1"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"beforeTaskOption10",talkKey:13},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10Option1",scrollTo:".task10",elements:[{el:".screen2.birthday2021world ",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10Option2",scrollTo:".task10",elements:[{el:".screen2.birthday2021world ",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",delayAfter:0,elements:[{el:".questContainer .screen1.birthday2021world",className:"fadeOut"},{el:".questContainer .screen2.birthday2021world",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",elements:[{el:".questContainer .screen1.birthday2021world",persistentClass:"hide"},{el:".questContainer .screen2.birthday2021world",persistentClass:"show"},{el:".screen2.birthday2021world .task12.trash",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask11",talkKey:14,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",scrollTo:".task12",elements:[{el:".screen2.birthday2021world .task12.trash",persistentClass:"hidden1"},{el:".screen2.birthday2021world .task12.clean",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask12",talkKey:15,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",scrollTo:".task12",elements:[{el:".screen2.birthday2021world .task13",persistentClass:"visible1"},{el:".screen2.birthday2021world .task12.clean",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask13",talkKey:16,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask14",scrollTo:".task12",elements:[{el:".screen2.birthday2021world .task14",persistentClass:"visible1"},{el:".screen2.birthday2021world .task13",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask14",talkKey:17,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask15",scrollTo:".task12",elements:[{el:".screen2.birthday2021world .task15",persistentClass:"visible1"},{el:".screen2.birthday2021world .task14",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask15",talkKey:18,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask16",scrollTo:".task16",elements:[{el:".screen2.birthday2021world .task16",persistentClass:"visible1"},{el:".screen2.birthday2021world .task15",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask16",talkKey:19,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask17",scrollTo:".task17",elements:[{el:".screen2.birthday2021world .task17",persistentClass:"visible1"},{el:".screen2.birthday2021world .task16",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask17",talkKey:20,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask18",scrollTo:".task18",elements:[{el:".screen2.birthday2021world .task18",persistentClass:"visible1"},{el:".screen2.birthday2021world .task17",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask18",talkKey:21,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",scrollTo:".task19",elements:[{el:".screen2.birthday2021world .task19",persistentClass:"visible1"},{el:".screen2.birthday2021world .task18",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask19",talkKey:22,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",scrollTo:".task20",elements:[{el:".screen2.birthday2021world .task20",persistentClass:"visible1"},{el:".screen2.birthday2021world .task19",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask20",talkKey:23,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",scrollTo:".task21",elements:[{el:".screen2.birthday2021world .task21",persistentClass:"visible1"},{el:".screen2.birthday2021world .task20",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask21",talkKey:24,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",scrollTo:".task22",elements:[{el:".screen2.birthday2021world .task22",persistentClass:"visible1"},{el:".screen2.birthday2021world .task21",persistentClass:"hidden1"},{el:".screen2.birthday2021world .task18",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask22",talkKey:25,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",scrollTo:".task23",elements:[{el:".screen2.birthday2021world .task23",persistentClass:"visible1"},{el:".screen2.birthday2021world .task22",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask23",talkKey:26,postfix:"team"},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask24",talkKey:27,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",scrollTo:".task24",elements:[{el:".screen2.birthday2021world .task24.cake",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24Option1",elements:[{el:".screen1.birthday2021world .task28",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24Option2",scrollTo:".task10",elements:[{el:".screen1.birthday2021world .task28",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24Option3",scrollTo:".task10",elements:[{el:".screen1.birthday2021world .task28",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask25",talkKey:28,postfix:"team"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",delayAfter:0,elements:[{el:".questContainer .screen2.birthday2021world",className:"fadeOut"},{el:".questContainer .screen2.birthday2021world",cleanClass:"fadeIn"},{el:".questContainer .screen1.birthday2021world",className:"fadeIn"},{el:".questContainer .screen1.birthday2021world",cleanClass:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",elements:[{el:".questContainer .screen2.birthday2021world",persistentClass:"hidden1"},{el:".questContainer .screen1.birthday2021world",persistentClass:"visible1"},{el:".screen1.birthday2021world .task1.docmage",persistentClass:"visible2"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClass:"visible2"},{el:".screen1.birthday2021world .task1.docmage",persistentClean:"updated"},{el:".screen1.birthday2021world .task1.mabelnagel",persistentClean:"updated"},{el:".screen1.birthday2021world .task8",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask26",talkKey:29},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask26",scrollTo:".task8",elements:[{el:".screen1.birthday2021world .task8",persistentClass:"hidden1"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"visible2"},{el:".screen1.birthday2021world .bg.girl",persistentClean:"updated"}]},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask27",talkKey:30},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask27",scrollTo:".task27",elements:[{el:".screen1.birthday2021world .task27.decorations",persistentClass:"visible1"},{el:".screen1.birthday2021world .task27.balloons",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask28",scrollTo:".task28",elements:[{el:".screen1.birthday2021world .task28.cake1",persistentClass:"visible1"},{el:".screen1.birthday2021world .task28.cake2",persistentClass:"visible1"},{el:".screen1.birthday2021world .task28.pirate",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask28",talkKey:31},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask29",talkKey:32},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask30",talkKey:33},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask30",scrollTo:".task28",elements:[{el:".screen1.birthday2021world .task28.pirate",persistentClass:"updated"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask30",talkKey:34},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask31",talkKey:35},{type:StoryAnimationElement,owner:this.questController,once:"beforeCompleteTask32",scrollTo:".task32",elements:[{el:".screen1.birthday2021world .task32.characters",persistentClass:"visible1"},{el:".screen1.birthday2021world .task32.cake1",persistentClass:"visible1"},{el:".screen1.birthday2021world .task32.cake2",persistentClass:"visible1"},{el:".screen1.birthday2021world .task28.pirate",persistentClass:"hidden1"},{el:".screen1.birthday2021world .task28.cake1",persistentClass:"hidden1"},{el:".screen1.birthday2021world .task28.cake2",persistentClass:"hidden1"},{el:".screen1.birthday2021world .task1.docmage ",persistentClass:"hidden2"},{el:".screen1.birthday2021world .task1.mabelnagel ",persistentClass:"hidden2"},{el:".screen1.birthday2021world .bg.girl",persistentClass:"hidden2"}]},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this.questController,on:"afterCompleteTask32"},{type:StoryTalkElement,owner:this.battlePass,on:"catchupWindow",talkKey:"PlsBuyBattlePass"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",id:201,el:".mBonusWorldTasksWindowBtn.birthday2021world",name:"birthday2021worldForce1"},{type:StoryForceElement,owner:this,once:"onFinishLevel2",id:203,el:".episode_birthday2021world .questUi_birthday2021world .artifactWorkshopButton.birthday2021world",name:"birthday2021worldForce3"},{type:StoryForceElement,owner:this.artifactController,once:"activate",page:"artifacts",id:204,el:".artifactWorkshop.birthday2021world .treeBlock .button1",name:"birthday2021worldForce4"},{type:StoryForceElement,owner:this.artifactController,once:"activate",page:"artifacts",el:".bonusworld_birthday2021world .artifact.artifact1 .artifactPartsBlock",name:this.get("name")+"Force5",id:205},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},owner:this.questController,on:"afterCompleteTask32"},{type:BaseStoryWindowElement,window:TakePrizeWindow,params:{world:this,publicationId:"BonusWorldFinalPrizePublication",worldName:this.get("name")},owner:this,on:"allPrizesCollected",delayAfter:0}]}),this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector]}),this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".questUi_birthday2021world",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),quantity:1,parts:[2,3,4,5,6,7,8,9,10,11,12]},{dropType:Artifacts.PartShopByParts,id:3,coins:700,quantity:3,parts:[2,3,4,5,6,7,8,9,10,11,12]},{dropType:Artifacts.PartShopByParts,id:2,coins:500,quantity:2,parts:[2,3,4,5,6,7,8,9,10,11,12]},{dropType:Artifacts.PartShopByParts,id:1,coins:300,quantity:1,parts:[2,3,4,5,6,7,8,9,10,11,12]}]},artifactWorkshop:{scrollable:!0,anchorEl:".button1",partSource:new Artifacts.PartDroppperLite({chances:{15:30,7:40},generatingModel:Artifacts.PartRandomizer}),config:{showAll:!0,parts:[{id:1,chance:0},{id:2,chance:.06},{id:3,chance:.09},{id:4,chance:.1},{id:5,chance:.09},{id:6,chance:.05},{id:7,chance:.07},{id:8,chance:.08},{id:9,chance:.07},{id:10,chance:.06},{id:11,chance:.03},{id:12,chance:.03}],artifacts:[{id:1,parts:[1,2,3,4,5],cooldown:36e3,ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"PrizePointsProduct",amount:20}]},{id:2,parts:[2,3,4,5,6],cooldown:28800,ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:100},{type:"PrizePointsProduct",amount:30}]},{id:3,parts:[3,4,5,7,8],cooldown:21600,ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50},{type:"PrizePointsProduct",amount:50}]},{id:4,parts:[3,4,6,8,9],cooldown:14400,ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"coins",amount:50},{type:"PrizePointsProduct",amount:60}]},{id:5,parts:[3,7,10,11,12],cooldown:7200,ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"starInField",amount:8},{type:"coins",amount:200},{type:"PrizePointsProduct",amount:80}]},{id:6,parts:[4,8,10,11,12],cooldown:7200,ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"addThreeMoves",amount:8},{type:"coins",amount:200},{type:"PrizePointsProduct",amount:80}]},{id:7,parts:[5,9,10,11,12],cooldown:7200,ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:150},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"spins",amount:1},{type:"PrizePointsProduct",amount:80}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,artifacts:[7]}]}}}),this.getComponent(CollectorsAgency).addCollector(new PrizePointsCollector),this.addComponent(PrizeMarksDropper,{chance:35})}}),d0e,e0e;figureRulesProcess.birthday2021worldBonusClasses=function(){FigureRules.add(".episode_birthday2021world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2021world/artifactPlatform.png"}),FigureRules.add(".episode_birthday2021world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/birthday2021world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_birthday2021world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_birthday2021world .secondAttribute_prizePointMark",{"background-position-x":0,"background-position-y":0,"background-width":30,"background-height":30,"background-image":"../../../gems/site/img/features/birthday2021world/cupcake.png",width:.5*Config.cellWidth,height:.5*Config.cellHeight,"margin-top":.5*Config.cellHeight,"margin-left":.5*Config.cellWidth}),FigureRules.add(".episode_birthday2021world .decorator_chocolate.stable",{"background-position-x":936,"background-position-y":0,"background-width":104,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2021world/doughAppear.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-22/60*Config.cellHeight}),FigureRules.add(".episode_birthday2021world .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2021world/doughAppear.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-22/60*Config.cellHeight,spriteFrames:10,duration:800}),FigureRules.add(".episode_birthday2021world .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":103,"background-height":102,"background-image":"../../../gems/site/img/features/birthday2021world/doughDie.png",width:104/60*Config.cellWidth,height:1.7*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_birthday2021world .flowerHead",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/birthday2021world/cakeBg.png",width:2*Config.cellWidth,height:2*Config.cellHeight}),FigureRules.add(".episode_birthday2021world .flowerFrog",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/flower/flowerHead.700b43b95b.png",width:2*Config.cellWidth,height:2*Config.cellHeight,opacity:"0"}),FigureRules.add(".episode_birthday2021world .flowerHead.powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-left":Config.cellWidth-20/60*Config.cellWidth,"margin-top":Config.cellHeight+20/60*Config.cellHeight}),FigureRules.add(".episode_birthday2021world .flowerFrog.stable",{spriteFrames:5,framesOrder:[0,1,2,3,2,1,0],delay:[2e3,6e3],lastFrame:0,duration:600,playRound:!0}),FigureRules.add(".episode_birthday2021world .flowerLife",{width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_birthday2021world .flowerLife1, .episode_birthday2021world .flowerLife0",{"background-position-x":0,"background-width":23,"background-height":34,"background-image":"../../../gems/site/img/features/birthday2021world/cakeCandle.png",width:23/60*Config.cellWidth,height:34/60*Config.cellHeight,spriteFrames:10,duration:500,playRound:!0}),FigureRules.add(".episode_birthday2021world .flowerLife1",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .flowerLife0",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .flowerType_1_0 .flowerLife",{"scale-x":1}),FigureRules.add(".episode_birthday2021world .flowerType_0_1 .flowerLife",{"scale-y":1}),FigureRules.add(".episode_birthday2021world .flowerType_1_1 .flowerLife",{"scale-x":1,"scale-y":1}),FigureRules.add(".episode_birthday2021world .flowerLifeDone",{"background-position-x":0,animation:{params:{scale:[1,0]},duration:300}}),FigureRules.add(".episode_birthday2021world .flowerTakeLife",{spriteFrames:1,duration:1}),FigureRules.add(".episode_birthday2021world .flowerHead.die",{"background-image":""}),FigureRules.add(".episode_birthday2021world .flowerHead.die .flowerFrog",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/birthday2021world/cakeBg.png",width:2*Config.cellWidth,height:2*Config.cellHeight,opacity:1,animation:{params:{scale:[1,.2]},duration:200}}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_0_0, .episode_birthday2021world  .dieFlower .flowerType_1_0, .episode_birthday2021world .dieFlower .flowerType_0_1, .episode_birthday2021world .dieFlower .flowerType_1_1",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/birthday2021world/cakeBg.png",width:2*Config.cellWidth,height:2*Config.cellHeight,opacity:0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_0_0",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_1_0",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_0_1",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_1_1",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_0_0",{"margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_1_0",{"margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_0_1",{"margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2021world .dieFlower .flowerType_1_1",{"margin-left":0,"margin-top":0}),FigureRules.add(".episode_birthday2021world .flowerType_0_0 .flowerLife0",{"margin-left":10,"margin-top":-8}),FigureRules.add(".episode_birthday2021world .flowerType_0_0 .flowerLife1",{"margin-left":0,"margin-top":14}),FigureRules.add(".episode_birthday2021world .flowerType_0_1 .flowerLife0",{"margin-left":15,"margin-top":-25}),FigureRules.add(".episode_birthday2021world .flowerType_0_1 .flowerLife1",{"margin-left":34,"margin-top":-16}),FigureRules.add(".episode_birthday2021world .flowerType_1_0 .flowerLife0",{"margin-left":26,"margin-top":-8}),FigureRules.add(".episode_birthday2021world .flowerType_1_0 .flowerLife1",{"margin-left":38,"margin-top":14}),FigureRules.add(".episode_birthday2021world .flowerType_1_1 .flowerLife0",{"margin-left":24,"margin-top":-25}),FigureRules.add(".episode_birthday2021world .flowerType_1_1 .flowerLife1",{"margin-left":5,"margin-top":-16}),FigureRules.add(".episode_birthday2021world .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2021world/garment1.png"}),FigureRules.add(".episode_birthday2021world .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2021world/garment2.png"}),FigureRules.add(".episode_birthday2021world .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2021world/garment3.png"}),FigureRules.add(".episode_birthday2021world .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/birthday2021world/garment4.png"})},figureRulesProcess.additionalBonusScaleImages=(d0e=figureRulesProcess.additionalBonusScaleImages,function(){d0e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/birthday2021world/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_R.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_G.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_B.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_P.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_Y.png":_Figure.scaleKoef,"../../../gems/site/img/features/birthday2021world/chest_W.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(e0e=figureRulesProcess.additionalBonusClasses,function(){e0e.call(this),figureRulesProcess.birthday2021worldBonusClasses()});var FireworksPartyWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this)},onEnter:function(){var e=this;BonusWorldView.prototype.onEnter.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onCompleteLevel:function(){var e=this;BonusWorldView.prototype.onCompleteLevel.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onGameFailed:function(){var e=this;episode.isBonusWorld()&&"fireworkspartyworld"===episode.getEpisodeName()&&"game"===application.get("page")&&application.once("main",function(){setTimeout(function(){return e.scrollToTargetLevel()},1e3)},this)},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1))}}),FireworksPartyWorld=BonusWorld.extend({defaults:_.defaults({name:"fireworkspartyworld",viewId:FireworksPartyWorldView,version:20230627,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:10,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,alwaysCancelNext:!1,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"middlePrize",level:20,prize:[{type:"coins",amount:200},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"coins",amount:500},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12},{type:"spins",name:"spins",cssClass:"spins",amount:1}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 1<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",params:{silent:!0}},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.fireworkspartyworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,once:"winLevel3",talkKey:2},{type:StoryTalkElement,owner:this,on:"winLevel5",talkKey:9},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize5",scrollTo:".bonusWorldPrize.level5",delayAfter:2500,elements:[{el:".bonusWorldPrize.level5",className:"fireworksAnimation"}]},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize5",scrollTo:".bonusWorldPrize.level5",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level5",persistentClass:"finished"}],id:100},{type:StoryTalkElement,owner:this,on:"winLevel6",talkKey:3},{type:StoryTalkElement,owner:this,on:"winLevel8",talkKey:4},{type:StoryTalkElement,owner:this,on:"winLevel10",talkKey:10},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize10",scrollTo:".bonusWorldPrize.level10",delayAfter:2500,elements:[{el:".bonusWorldPrize.level10",className:"fireworksAnimation"}]},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize10",scrollTo:".bonusWorldPrize.level10",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level10",persistentClass:"finished"}],id:101},{type:StoryTalkElement,owner:this,on:"winLevel14",talkKey:5},{type:StoryTalkElement,owner:this,on:"winLevel18",talkKey:6},{type:StoryTalkElement,owner:this,on:"winLevel20",talkKey:11},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize20",scrollTo:".bonusWorldPrize.level20",delayAfter:2500,elements:[{el:".bonusWorldPrize.level20",className:"fireworksAnimation"}]},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize20",scrollTo:".bonusWorldPrize.level20",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level20",persistentClass:"finished"}],id:102},{type:StoryTalkElement,owner:this,on:"winLevel22",talkKey:7},{type:StoryTalkElement,owner:this,on:"winLevel27",talkKey:8},{type:StoryTalkElement,owner:this,on:"takeMiddlePrize30",talkKey:12},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,on:"takeMiddlePrize30",delayAfter:0,id:200},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize30",scrollTo:".bonusWorldPrize.prizeFinal.level30",delayAfter:2500,elements:[{el:".bonusWorldPrize.level30",className:"fireworksAnimation"}]},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize30",scrollTo:".bonusWorldPrize.prizeFinal.level30",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level30",persistentClass:"finished"}],id:103},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:13}]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)},renderChests:function(){var t=this;BonusWorld.prototype.renderChests.call(this),this.get("prizes").forEach(function(e){$(".episode_fireworkspartyworld .scrolledBlock .bonusWorldPrizes .level"+e.level).toggleClass("finished",e.level+1<t.getCurrentLevel())})}}),z0e;figureRulesProcess.fireworkspartyworldBonusClasses=function(){featuresAdder.addFeature("fireworkspartyworld","episodecollectiondroppable"),featuresAdder.addFeature("fireworkspartyworld","dropcell_chest"),featuresAdder.addFeature("fireworkspartyworld","strongbox_candysafe")},figureRulesProcess.additionalBonusClasses=(z0e=figureRulesProcess.additionalBonusClasses,function(){z0e.call(this),figureRulesProcess.fireworkspartyworldBonusClasses()});var PushkinBirthDayWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this)},onEnter:function(){var e=this;BonusWorldView.prototype.onEnter.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onCompleteLevel:function(){var e=this;BonusWorldView.prototype.onCompleteLevel.call(this),application.waitPage("main").then(function(){setTimeout(function(){return e.scrollToTargetLevel()},500)})},onGameFailed:function(){var e=this;episode.isBonusWorld()&&"pushkinbirthdayworld"===episode.getEpisodeName()&&"game"===application.get("page")&&application.once("main",function(){setTimeout(function(){return e.scrollToTargetLevel()},1e3)},this)},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1))}}),PushkinBirthDayWorld=BonusWorld.extend({defaults:_.defaults({name:"pushkinbirthdayworld",viewId:PushkinBirthDayWorldView,version:20240614,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:6,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime3",skipLevelPublication:!0,actionQueue:new ActionQueue,alwaysCancelNext:!1,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:20,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"coins",amount:400},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12},{type:"good",name:"starInField",cssClass:"starInField",amount:12},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48},{type:"gift",cssClass:"gift_egg",name:"gift_egg",ids:["gift_egg"],amount:1}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",params:{silent:!0}},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.pushkinbirthdayworld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.pushkinbirthdayworld .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.pushkinbirthdayworld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.pushkinbirthdayworld",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.pushkinbirthdayworld",persistentClass:"hidden"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",scrollTo:"#level1",delayBefore:1e3,delayAfter:1e3,id:211,elements:[]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.pushkinbirthdayworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize5",talkKey:5},{type:StoryTalkElement,owner:this,once:"winLevel7",talkKey:6},{type:StoryTalkElement,owner:this,once:"winLevel8",talkKey:7},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize10",talkKey:8},{type:StoryTalkElement,owner:this,once:"winLevel14",talkKey:9},{type:StoryTalkElement,owner:this,once:"winLevel18",talkKey:10},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize20",talkKey:8},{type:StoryTalkElement,owner:this,once:"winLevel22",talkKey:11},{type:StoryTalkElement,owner:this,once:"winLevel27",talkKey:12},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize30",talkKey:13},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"takeMiddlePrize30",id:210},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:14}]}),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 1<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)}}),Q0e,R0e;figureRulesProcess.pushkinbirthdayworldBonusClasses=function(){featuresAdder.addFeature("pushkinbirthdayworld","episodecollectiondroppable"),FigureRules.add(".episode_pushkinbirthdayworld .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkinbirthdayworld/special8.25a966c9be.png"}),featuresAdder.addFeature("pushkinbirthdayworld","dropcell_book"),featuresAdder.addFeature("pushkinbirthdayworld","frog_queen"),featuresAdder.addFeature("pushkinbirthdayworld","shooter_squirrel"),featuresAdder.addFeature("pushkinbirthdayworld","ground_greenstone"),featuresAdder.addFeature("pushkinbirthdayworld","chocolate_honey"),featuresAdder.addFeature("pushkinbirthdayworld","genrymorgan_coshey"),FigureRules.add(".episode_pushkinbirthdayworld .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":35,"background-height":27,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkinbirthdayworld/butterfly.fdac0d962b.png",width:35/60*Config.cellWidth,height:.45*Config.cellHeight,"margin-left":13/60*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:1,duration:400,playRound:!0}),featuresAdder.addFeature("pushkinbirthdayworld","pearl_comb")},figureRulesProcess.additionalBonusScaleImages=(Q0e=figureRulesProcess.additionalBonusScaleImages,function(){Q0e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/pushkinbirthdayworld/special8.25a966c9be.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(R0e=figureRulesProcess.additionalBonusClasses,function(){R0e.call(this),figureRulesProcess.pushkinbirthdayworldBonusClasses()});var ArcheologistsWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.$el.append($('<div class="prizeControllerContainer"></div>')),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new TicketInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=$(".wrapper"),t=0;t<5;++t)e.removeClass(this.model.get("name")+"_screen"+t);e.addClass(this.model.get("name")+"_screen"+this.model.get("location")),this.updateRandomLevelBtn(),this.updateTimer(),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("onCompleteLevel",this.updateTimer,this),this.model.on("afterChangeLocation",this.updateTimer,this),this.model.on("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.on("afterChangeLocation",this.updateStartBtn,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("onCompleteLevel",this.updateTimer,this),this.model.off("afterChangeLocation",this.updateTimer,this),this.model.off("afterChangeLocation",this.updateRandomLevelBtn,this),this.model.off("afterChangeLocation",this.updateStartBtn,this)},updateRandomLevelBtn:function(){var e=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",e>this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation()),this.$randomBtn.find(".mRandomLevelBtnText").html(e)},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode")&&!this.model.isOnFinalLocation())},updateTimer:function(){var e=1<=this.model.getComponent(PrizeController).getProgress()&&"1"===this.model.get("location").toString()&&this.model.isClosingSoon();this.timeoutCause&&(this.model.isOnFinalLocation()||e)&&(this.timeoutCause.model=this.model,this.timeoutCause.$el.find(".mWarning").addClass("willCloseSoon"),this.timeoutCause.$el.find(".mWarning").html(messages[this.model.get("name")+"TimerEnd"]))}}),ArcheologistsWorld=BonusWorld.extend({screens:3,defaults:_.defaults({name:"archeologistsworld",version:20230710,levelsInEpisode:100,viewId:ArcheologistsWorldView,showFinalForce:!1,durationDays:!1,helpWindow:!1,lastLevelOpen:!0,production:!0,saveReplayLevel:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:8,openDate:null,showProgress:!0,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives({maxLives:7,lives:7}),withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0,prizes:[{type:"finalPrize",level:100,prize:[{type:"coins",amount:300},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]}],progressComponent:ProgressSimpleIncrementComponent,finalLocation:5,noArtifactPartOnReplay:!1,alwaysCancelNext:!1},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(TriesComponent,{conditioner:TriesConditionerPresets.alwaysTrue,reminderWindowThreshold:4,variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:4}]}},{tries:2,prizes:{products:[{type:"PrizePointsProduct",amount:3}]}},{tries:3,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.prizeController=this.addComponent(PrizeController,{world:this,isShowTakePrizeWindow:!0,viewClass:PrizeControllerViewLite,saveCollectedPrizes:!0,accountant:new PrizeProgressAccount([9,17,30,60,90]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]},{progress:3,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"CoinsProduct",amount:100},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]},{progress:5,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"SpinProduct",amount:1},{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:this.get("unlimitedName"),addTime:"30m"}]}]}),this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.archeologistsworld",dropOnReplayLevel:!0,artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.BoxPartDroppper({chances:{15:12,7:21},generatingModel:Artifacts.WeighedPartGeneration,rule:function(){return 2<t.getCurrentLevel()}}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:100}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:200}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"spins",amount:1},{type:"coins",amount:200}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]}]}}}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:800,parts:3}]}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.archeologistsworld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.archeologistsworld .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.archeologistsworld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.archeologistsworld",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.archeologistsworld",persistentClass:"hidden"}],id:100},{type:StoryForceElement,owner:this,once:"enter",id:204,el:".bonusWorldUI.archeologistsworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this,page:"main",once:"prizeControllerBeforeTakePrize1",talkKey:4},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize2",talkKey:5},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize3",talkKey:6},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize4",talkKey:7},{type:StoryTalkElement,owner:this,isAvailable:function(){return 1==t.get("location")},once:"prizeControllerAfterTakePrize5",talkKey:8},{type:StoryTalkElement,owner:this,isAvailable:function(){return 1==t.get("location")},once:"timeoutCause",talkKey:9},{type:StoryTalkElement,owner:this,isAvailable:function(){return 5!=t.get("location")},once:"changeLocation",talkKey:10},{type:StoryTalkElement,owner:this,isAvailable:function(){return 1!=t.get("location")},once:"prizeControllerAfterTakePrize1",talkKey:11},{type:StoryTalkElement,owner:this,on:"prizeControllerAfterTakePrize5",isAvailable:function(){return 1!=t.get("location")&&5!=t.get("location")},talkKey:[13,14,15,16,17,18,19,20,21,22]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"photo4"},on:"prizeControllerAfterTakePrize5"},{type:StoryTalkElement,owner:this,on:"timeoutCause",isAvailable:function(){return 1!=t.get("location")&&5!=t.get("location")},talkKey:[23,24,25,26,27,28,29,30,31,32,33]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"photo4"},on:"timeoutCause"},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:[34,35]},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes9",talkKey:36},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes12",talkKey:37},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes14",talkKey:38},{type:StoryTalkElement,owner:this,once:"numCollectedPrizes17",talkKey:39},{type:StoryTalkElement,owner:this,once:"enterLocation5",talkKey:40},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.archeologistsworld",name:"archeologistsworldForce2"},{type:StoryForceElement,owner:this.artifactController,once:"activate",page:"artifacts",id:202,el:".artifactWorkshop.archeologistsworld .tree .button1",name:"archeologistsworldForce4"},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,lastLevelFinishWindow:!0,publicationOff:!0},owner:this,once:"onFinishLevel101",id:210},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onFinishLevel101",delayAfter:0,id:211}]}),this.addComponent(ChangeoverComponent,{changeoverCauses:[new CompletePrizesCause,new TimeoutCause({time:"3d",conditions:[new ActivationCondition({minLocation:2,minProgress:1})]})],changeoverEffects:[new ResetPrizesEffect({subject:this.prizeController}),new ChangeLocationEffect({world:this,locations:[{num:2,condition:function(){return!t.isClosingSoon()}},{num:3,condition:function(){return!t.isClosingSoon()}},{num:4,condition:function(){return!t.isClosingSoon()}},{num:5,condition:function(){return t.isClosingSoon()}}]})]}),this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:80,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(ActionWorldComponent,{offerId:"saleWorld2"}),this.addComponent(ReturnWorldComponent)}}),t1e,u1e;figureRulesProcess.archeologistsworldBonusClasses=function(){},figureRulesProcess.additionalBonusScaleImages=(t1e=figureRulesProcess.additionalBonusScaleImages,function(){t1e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{})}),figureRulesProcess.additionalBonusClasses=(u1e=figureRulesProcess.additionalBonusClasses,function(){u1e.call(this),figureRulesProcess.archeologistsworldBonusClasses(),featuresAdder.addFeature("archeologistsworld","frog_duck"),featuresAdder.addFeature("archeologistsworld","dropcell_ankh"),featuresAdder.addFeature("archeologistsworld","chocolate_chocolate"),featuresAdder.addFeature("archeologistsworld","alligator_mummy"),featuresAdder.addFeature("archeologistsworld","fishball_bird"),featuresAdder.addFeature("archeologistsworld","caviar_chick"),featuresAdder.addFeature("archeologistsworld","tortoise_plant"),featuresAdder.addFeature("archeologistsworld","bar_cactus"),FigureRules.add(".episode_archeologistsworld .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/archeologistsworld/artifactPlatform.9da3162586.png"}),FigureRules.add(".episode_archeologistsworld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/archeologistsworld/artifactPart.163743f058.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_archeologistsworld .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_archeologistsworld .bugCell .mTask1 .taskIco",{width:60/180*Config.cellWidth,height:60/180*Config.cellHeight,"background-width":100,"background-height":100,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/coin/coinTask.0c717169a2.png","margin-left":-5/60*Config.cellWidth,"margin-top":0})});var OlympicgamesView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.starChests=this.model.getComponent(StarChestController).get("chests"),this.renderStarChestPrizes()},renderFires:function(){var e=$("#map .scrolledBlock"),t=$('<div class="olympicgamesFireBlock"></div>');e.append(t);for(var i=1;i<=7;i++){var o=$('<div class="olympicgamesFires fire_'+String(i)+'"></div>');t.append(o)}},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.updateStarChests(),this.renderFires(),this.starChests.on("change:opened",this.updateStarChests,this),episode.scores.on("change:stars add",this.updateStarChests,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),$(".olympicgamesFireBlock").remove(),this.starChests.off("change:opened",this.updateStarChests,this),episode.scores.off("change:stars add",this.updateStarChests,this)},updateStarChests:function(){var i=$(".bonusWorldStarBoxes");this.model.getComponent(StarChestController);this.starChests.forEach(function(e){var t=i.find("#starBox"+e.get("id"));t.addClass("olympicgamesStarChest"),t.data("chestId",e.get("id")),t.find(".actualStars").html(e.getCurrentStars()),t.toggleClass("opened",e.get("opened"))})},renderStarChestPrizes:function(){var a=$(".bonusWorldStarBoxes");this.starChests.forEach(function(e){var t=e.get("id"),i=a.find("#starBox"+t),o=$('<div class="description">'+messages.olympicgamesLevelPrizeMainDescription[t]+"</div>");i.find(".requiredStars").html(e.get("stars")),new UserPrizesView({model:e.get("prize"),el:i.find(".prizes"),isGroup:!0}),i.find(".prizes").append(o)})}}),Olympicgames=BonusWorld.extend({defaults:_.defaults({name:"olympicgames",viewId:OlympicgamesView,version:20220824,production:!1,levelsInEpisode:24,durationDays:4,episode:2,level:4,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:4,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,skipLevelPublication:!0,actionQueue:new ActionQueue,prizes:[{type:"finalPrize",level:24,prize:[{type:"coins",amount:100},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:24}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(StarChestController,{ChestModel:LevelLimitedStarChest,chests:[{id:1,stars:16,levelFrom:1,levelTo:6,publicationId:"BonusWorldPrizeOnLevel6",prize:{name:this.get("name")+"_18",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.DeleteCell}]}},{id:2,levelFrom:7,levelTo:12,stars:16,publicationId:"BonusWorldPrizeOnLevel12",prize:{name:this.get("name")+"_36",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedLifes}]}},{id:3,levelFrom:13,levelTo:18,stars:16,publicationId:"BonusWorldPrizeOnLevel18",prize:{name:this.get("name")+"_54",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField},{type:"SpinProduct",amount:1}]}},{id:4,levelFrom:19,levelTo:24,stars:16,publicationId:"BonusWorldPrizeOnLevel24",isGroup:!0,prize:{name:this.get("name")+"_72",products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"GoodProduct",addTime:43200,goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.addThreeMoves}]}}]});this.getComponent(StarChestController);this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:1},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:2,talkKey:1},{type:StoryForceElement,isAvailable:function(){return t.getCurrentLevel()<=1},owner:this,delay:200,once:"beforeEnter",el:"#level1",name:"firstLevelForce",id:201},{type:StoryTalkElement,owner:this,once:"openedStarChest1",id:3,talkKey:2},{type:StoryTalkElement,owner:this,once:"openedStarChest2",id:4,talkKey:3},{type:StoryTalkElement,owner:this,once:"openedStarChest3",id:5,talkKey:4},{type:StoryTalkElement,owner:this,once:"openedStarChest4",id:6,talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:7,talkKey:6},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(1)},owner:this,once:"openedStarChest1",id:8},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(2)},owner:this,once:"openedStarChest2",id:9},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(3)},owner:this,once:"openedStarChest3",id:10},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(4)},owner:this,once:"openedStarChest4",id:11},{type:StoryWindowElement,window:BonusWorldFinishedWindow,params:{showAnimatedPrizesWindow:!0,prize:[{type:"coins",name:"coins",cssClass:"coins",amount:100},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:24}]},owner:this,once:"onFinishLevel24",id:12}]})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},episodeChanged:function(){return!0}}),$1e,_1e;figureRulesProcess.additionalBonusScaleImages=($1e=figureRulesProcess.additionalBonusScaleImages,function(){$1e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/olympicgames/special8.png":_Figure.scaleKoef})}),figureRulesProcess.olympicgamesBonusClasses=function(){FigureRules.add(".episode_olympicgames .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/olympicgames/special8.png"})},figureRulesProcess.additionalBonusClasses=(_1e=figureRulesProcess.additionalBonusClasses,function(){_1e.call(this),figureRulesProcess.olympicgamesBonusClasses()});var ClimbingStoriesView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.starChests=this.model.getComponent(StarChestController).get("chests"),this.renderStarChestPrizes()},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.updateStarChests(),this.starChests.on("change:opened",this.updateStarChests,this),episode.scores.on("change:stars add",this.updateStarChests,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.starChests.off("change:opened",this.updateStarChests,this),episode.scores.off("change:stars add",this.updateStarChests,this)},updateStarChests:function(){var i=$(".bonusWorldStarBoxes");this.starChests.forEach(function(e){var t=i.find("#starBox"+e.get("id"));t.addClass("climbingstoriesStarChest"),t.data("chestId",e.get("id")),t.find(".actualStars").html(e.getCurrentStars()),t.toggleClass("opened",e.get("opened"))})},renderStarChestPrizes:function(){var a=$(".bonusWorldStarBoxes");this.starChests.forEach(function(e){var t=e.get("id"),i=a.find("#starBox"+t),o=$('<div class="description">'+messages.climbingstoriesLevelPrizeMainDescription[t]+"</div>");i.find(".requiredStars").html(e.get("stars")),new UserPrizesView({model:e.get("prize"),el:i.find(".prizes"),isGroup:!0}),i.find(".prizes").append(o)})}}),ClimbingStories=BonusWorld.extend({defaults:_.defaults({name:"climbingstories",viewId:ClimbingStoriesView,version:20230802,production:!0,levelsInEpisode:30,durationDays:5,episode:2,level:4,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:8,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,skipLevelPublication:!0,actionQueue:new ActionQueue,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",helpWindowPrize:[{type:"good",name:"unlimitedLifes",amount:2}],prizes:[{type:"finalPrize",level:24,prize:[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:2},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:24}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(StarChestController,{ChestModel:LevelLimitedStarChest,chests:[{id:1,stars:18,levelFrom:1,levelTo:6,publicationId:"PrizeForChest1",prize:{name:this.get("name")+"_18",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:"30m",goodId:GoodTypes.unlimitedLifes}]}},{id:2,levelFrom:7,levelTo:13,stars:21,publicationId:"PrizeForChest2",prize:{name:this.get("name")+"_36",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"episodeCollectionPart",cssClass:"episodeCollectionPart",amount:1,partId:1,world:this.get("name")}]}},{id:3,levelFrom:14,levelTo:21,stars:24,publicationId:"PrizeForChest3",prize:{name:this.get("name")+"_54",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.starInField}]}},{id:4,levelFrom:22,levelTo:30,stars:27,publicationId:"PrizeForChest4",isGroup:!0,prize:{name:this.get("name")+"_72",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"GoodProduct",addTime:"12h",goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:"6h",goodId:GoodTypes.addThreeMoves}]}}]}),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,rule:function(){return application.level.num==t.getCurrentLevel()}})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest",part:new EpisodeCollection.Part({id:1,price:100,chance:100})})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.climbingstories",persistentClass:"active"},{el:".bonusWorldAnimations.climbingstories .animationSprite1",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:2},{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.climbingstories .animationSprite2",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2,id:4},{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.climbingstories .animationSprite3",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3,id:6},{type:StoryAnimationElement,owner:this,delayAfter:500,elements:[{el:".bonusWorldAnimations.climbingstories .animationSprite4",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,talkKey:4},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.climbingstories",persistentClass:"hide"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.climbingstories",persistentClean:"active"}]}]},{type:StoryForceElement,isAvailable:function(){return t.getCurrentLevel()<=1},owner:this,delay:200,once:"beforeEnter",el:"#level1",name:"firstLevelForce",id:2},{type:StoryTalkElement,owner:this,once:"onFinishLevel6",talkKey:5,id:3},{type:StoryTalkElement,owner:this,once:"onFinishLevel13",talkKey:6,id:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel21",talkKey:7,id:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel30",talkKey:8,id:6},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(1)},owner:this,once:"openedStarChest1",id:7},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(2)},owner:this,once:"openedStarChest2",id:8},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(3)},owner:this,once:"openedStarChest3",id:9},{type:StoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(4)},owner:this,once:"openedStarChest4",id:10},{type:StoryWindowElement,window:BonusWorldFinishedWindow,params:{showAnimatedPrizesWindow:!0,prize:this.get("prizes")[this.get("prizes").length-1].prize},owner:this,once:"onFinishLevel30",id:11}]}),this.addComponent(ProlongateWorldComponent)},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},episodeChanged:function(){return!0}}),w2e,B2e,F2e,G2e,H2e;ParrotCell.prototype.animateRemoval=(w2e=ParrotCell.prototype.animateRemoval,function(e){if("climbingstories"!==episode.get("num"))return w2e.call(this,e);for(var t=1;t<=4;t++){var i=GameBaseView.createFallDownExplodePiece("parrotExplode","parrotExplode".concat(t));i.alignTo(this.$div),gameView.fallDownExplodePiece(i)}var o=FigureView.createByTemplate(".invisible .emptyTemplate").addClass(this.baseName);_Figure.blockedAnimations.append(o),o.alignTo(this.$div),Game.trigger("removed"+this.getCapitalisedBaseName(),o),o.remove(),this.$div.remove(),e()}),ParrotCell.prototype.animateTakeLife=(B2e=ParrotCell.prototype.animateTakeLife,function(e){if("climbingstories"!==episode.get("num"))return B2e.call(this,e);this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable");var t=GameBaseView.createFallDownExplodePiece("die_parrotShard");t.alignTo(this.$div),gameView.fallDownExplodePiece(t),e()}),figureRulesProcess.additionalBonusScaleImages=(F2e=figureRulesProcess.additionalBonusScaleImages,function(){F2e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/climbingstories/special8.25a966c9be.png":_Figure.scaleKoef})}),figureRulesProcess.climbingstoriesBonusClasses=function(){FigureRules.add(".episode_climbingstories .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/climbingstories/special8.25a966c9be.png","margin-left":0,"margin-top":0}),featuresAdder.addFeature("climbingstories","attribute_scarab"),featuresAdder.addFeature("climbingstories","dropcell_rustyanchorcell")},figureRulesProcess.additionalBonusScaleImages=(G2e=figureRulesProcess.additionalBonusScaleImages,function(){G2e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/climbingstories/special8.25a966c9be.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(H2e=figureRulesProcess.additionalBonusClasses,function(){H2e.call(this),figureRulesProcess.climbingstoriesBonusClasses()});var Eggs2021WorldPrizeController=PrizeController.extend({givePrize:function(t){var i=this;return Promise.resolve().then(function(){return t.take()}).then(function(){return i.get("isOpenPrizePage")&&i.view?i.openPrizeRoom():application.waitPage("main")}).then(function(){return i.get("world").emit("prizeControllerBeforeTakePrize",i,i.getProgress())}).then(function(){return i.get("world").emit("prizeControllerBeforeTakePrize"+i.getProgress(),i,i.getProgress())}).then(function(){return i.get("world").emit("prizeControllerAfterTakePrize",i,i.getProgress())}).then(function(){return i.get("world").emit("prizeControllerAfterTakePrize"+i.getProgress(),i,i.getProgress())}).then(function(){return i.get("saveCollectedPrizes")?(i.set("numCollectedPrizes",new ObscureNumber(i.getNumCollectedPrizes()+1)),i.get("world").emit("numCollectedPrizes"+i.getNumCollectedPrizes(),i,i.getNumCollectedPrizes())):Promise.resolve()}).then(function(){if(i.isFinished())return i.get("world").emit("allPrizesCollected",i)}).then(function(){return i.showTakePrizeWindow(t)}).then(function(){return application.waitPage("main")}).then(function(){return delay(200)}).then(function(){i.get("world").emit("prizeControllerTakePrize",i,i.getProgress()),i.get("world").emit("prizeControllerTakePrize"+i.getProgress(),i,i.getProgress()),i.get("world").get("actionQueue").push({run:function(){return new Promise(function(e){new AnimatedPrizesWindow({prizes:t,worldName:i.get("world").get("name"),onClose:e,notGive:!0})})}},ActionQueue.Priority.normal)})}}),Eggs2021WorldPrizeControllerView=PrizeControllerView.extend({render:function(){var e=this,t=_.values(this.model.getPrizesGrouped("progress")),n=this.$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),i=$(".mainTemplates .rewardComponentPage"),o=$(".invisible.mainTemplates .progressBarByLevel"),a=this.$el.find(".freePlate"),s=this.$el.find(".battlepassPlate");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page),this.clarification=null,this.needClarify=!0;var l=i.clone(),d=o.clone();l.addClass(this.model.get("world").get("name")),l.append(d),a.html(messages.forFree),s.html(messages[this.model.get("world").get("name")+"BattlePassTitle"]),t.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("progress"+e.progress).addClass(e.type).data("id",e.cid),a){var i=n.clone();i.addClass("progress"+e.progress).addClass("placeholder"),l.append(i)}if("battlePass"===e.type||"finalPrize"===e.type){var o=r.clone();o.addClass("marker"+e.progress),o.html(e.progress),d.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.prize),isGroup:!0}),l.append(t)},this)},this),this.$wrapper.append(l),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:l,mainEl:this.$("#user"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.needClarify=!1,e.closeClarification()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("world").battlePass&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.createButton()}}),Eggs2021WorldView=BonusWorldView.extend({events:_.defaults({"click .mRunRandomLevelBtn":"runRandomLevel"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:this.$(".mPrizeControllerOuterProgressBar"),model:this.model.getComponent(PrizeController)}),this.rulesBtn=new TicketInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.$randomBtn.find(".mRandomLevelBtnText").html(messages[this.model.get("name")+"LookForBunniesBtn"]);var e=$(".mainTemplates .mPrizeControllerOuterProgressBar"),t=this.$(".mPrizeControllerOuterProgressBarWrapper");t.addClass("onMain").addClass(this.model.get("name"));var i=e.clone().appendTo(t);this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:i,model:this.model.getComponent(PrizeController)}),this.progressBtn=new TicketInfoButton({el:this.$(".mPrizeControllerOuterProgressBar .markSmall"),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);var e=this.model.getComponent(PrizeController);if(!this.nextPrizeProgressbar){var t=$(".mainTemplates .mPrizeControllerOuterProgressBar"),i=$(".rewardChainContainer .mPrizeControllerOuterProgressBarWrapper");i.addClass(this.model.get("name"));var o=t.clone().appendTo(i);this.nextPrizeProgressbar=new PrizeControllerOuterProgressBarNextAllPts({el:o,model:this.model.getComponent(PrizeController)})}this.updateScreen(),this.updateRandomLevelBtn(),this.updateTotalCounter(),this.prizeControllerProgressbar.update(),this.model.on("onCompleteLevel",this.updateScreen,this),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.on("onCompleteLevel",this.updateTotalCounter,this),e.on("change:points",this.updateRandomLevelBtn,this),e.on("change:points",this.updateTotalCounter(),this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("onCompleteLevel",this.updateScreen,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),this.model.off("onCompleteLevel",this.updateTotalCounter,this),e.off("change:points",this.updateRandomLevelBtn,this),e.off("change:points",this.updateTotalCounter(),this)},updateScreen:function(){for(var e=this.model.getCurrentLevel(),t=0;t<=this.model.screens;++t)$(".wrapper").removeClass(this.model.get("name")+"_screen"+t);var i=this.model.get("name")+"_screen1";25<e&&e<=this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen2"),e>this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen3"),$(".wrapper").addClass(i)},updateRandomLevelBtn:function(){var e=this.model.getComponent(PrizeController),t=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",t>this.model.get("levelsInEpisode")&&e.getPoints()<e.getMaxPointsPossible())},updateTotalCounter:function(){var e=$(".rewardChainBtn."+this.model.get("name")+" .mPointsCounter"),t=this.model.getComponent(PrizeController),i=t.getMaxPointsPossible(),o=t.getPoints();e.toggleClass("complete",i<=o),e.html(Math.min(o,i)+"/"+i)},runRandomLevel:function(){this.model.runRandomLevel()}}),Eggs2021World=BonusWorld.extend({screens:3,defaults:_.defaults({name:"eggs2021world",version:20220419,levelsInEpisode:50,endDate:new Date("2022/06/26 00:00"),showFinalForce:!0,viewId:Eggs2021WorldView,durationDays:!1,helpWindow:!1,suggestPlayForLife:!1,lastLevelOpen:!0,production:!0,saveReplayLevel:!0,episode:1,level:1,minEpisodeToEnter:2,minLevelToEnter:2,openDate:null,showProgress:!0,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,skipLevelPublication:!0,withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],unlimitedName:"unlimitedBonusWorldLives2",closeForNew:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0,prizes:[{type:"finalPrize",level:50,prize:[{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:8},{type:"good",cssClass:"starInField",name:"starInField",amount:8},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"spins",name:"spins",cssClass:"spins",amount:2}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.addComponent(RandomLevelComponent,{lowerMargin:16,upperMargin:40,useLevelSet:!1,saveReplayLevel:!0}),this.addComponent(TriesComponent,{conditioner:{isTryValid:function(e,t){return t<=e.world.getCurrentLevel()},canGivePrize:function(e,t){return t<=e.world.getCurrentLevel()}},variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:4}]}},{tries:2,prizes:{products:[{type:"PrizePointsProduct",amount:3}]}},{tries:3,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.prizeController=this.addComponent(Eggs2021WorldPrizeController,{world:this,viewClass:Eggs2021WorldPrizeControllerView,isOpenPrizePage:!1,accountant:new PrizeProgressAccount([12,7,12,18,29,47,75]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:3,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:6,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"2h"},{type:"SpinProduct",amount:1}]},{progress:1,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:2,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:3,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:4,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:5,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:6,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:7,type:"battlePass",products:[{type:"CoinsProduct",amount:350},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"2h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"}]}]}),this.battlePass=new BattlePass({world:this}),this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.eggs2021world",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{scrollable:!0,partSource:new Artifacts.PartDropper({chances:{15:55,7:55},generatingModel:Artifacts.WeighedPartGeneration}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:100},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:2},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:10800,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",amount:2},{type:"spins",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}});var o=0;this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++o},{type:StoryTalkElement,owner:this,once:"enter",id:++o,talkKey:1},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,isAvailable:function(){return!t.get("hasBattlePass")},params:{model:this.battlePass},owner:this,once:"enter",id:++o},{type:StoryTalkElement,owner:this,delay:1500,once:"enter",id:++o,talkKey:2},{type:StoryTalkElement,owner:this,once:"enter",id:++o,talkKey:3},{type:StoryForceElement,owner:this,once:"enter",id:204,el:".bonusWorldUI.eggs2021world .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",id:205,el:"#map .rewardChainBtn.eggs2021world",name:this.get("name")+"Force7"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",id:206,el:".bonusWorldUI.eggs2021world .startCurrentLevel",name:this.get("name")+"Force8"},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",id:++o,talkKey:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel10",id:++o,talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel15",id:++o,talkKey:6},{type:StoryTalkElement,owner:this,once:"onFinishLevel20",id:++o,talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel25",id:++o,talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel30",id:++o,talkKey:9},{type:StoryAnimationElement,owner:this.questController,once:"onFinishLevel30",id:++o,scrollTo:".sprite2",elements:[{el:".mapAnimationsMiddle .sprite1",persistentClass:"hidden1"},{el:".mapAnimationsMiddle .sprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"onFinishLevel35",id:++o,talkKey:10},{type:StoryAnimationElement,owner:this.questController,once:"onFinishLevel35",id:++o,scrollTo:".sprite3",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"hidden1"},{el:".mapAnimationsMiddle .sprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"onFinishLevel40",id:++o,talkKey:11},{type:StoryTalkElement,owner:this,once:"onFinishLevel42",id:++o,talkKey:12},{type:StoryTalkElement,owner:this,once:"onFinishLevel45",id:++o,talkKey:13},{type:StoryAnimationElement,owner:this.questController,once:"onFinishLevel45",id:++o,scrollTo:".sprite4",elements:[{el:".mapAnimationsMiddle .sprite3",persistentClass:"hidden1"},{el:".mapAnimationsMiddle .sprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:++o,talkKey:14},{type:StoryTalkElement,owner:this,once:"onFinishLevel50",id:++o,talkKey:15},{type:StoryTalkElement,owner:this,once:"onFinishLevel50",isAvailable:function(){return t.prizeController.getPoints()===t.prizeController.getMaxPointsPossible()},id:203,talkKey:16},{type:StoryTalkElement,owner:this,once:"onFinishLevel50",isAvailable:function(){return t.prizeController.getPoints()!==t.prizeController.getMaxPointsPossible()},id:++o,talkKey:17},{type:StoryAnimationElement,owner:this.questController,once:"onFinishLevel50",id:++o,scrollTo:".sprite1",elements:[{el:".mapAnimationsMiddle .sprite4",persistentClass:"updated"},{el:".mapAnimationsMiddle .sprite5",persistentClass:"updated"},{el:".mapAnimationsMiddle .sprite6",persistentClass:"updated"}]},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize7",id:208,talkKey:18},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize},owner:this,once:"onFinishLevel50",id:++o},{type:StoryCallbackElement,owner:this,page:"main",on:"prizeControllerTakePrize",callback:function(){t.prizeController.openPrizeRoom()},id:207},{type:StoryTalkElement,owner:this,once:"prizeControllerTakePrize1",id:++o,talkKey:19},{type:StoryTalkElement,owner:this,once:"prizeControllerTakePrize4",id:++o,talkKey:20},{type:StoryTalkElement,owner:this,once:"prizeControllerTakePrize7",id:++o,talkKey:21},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,isAvailable:function(){return!t.get("hasBattlePass")},params:{model:this.battlePass},owner:this,once:"prizeControllerBeforeTakePrize1",id:++o},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,isAvailable:function(){return!t.get("hasBattlePass")},params:{model:this.battlePass},owner:this,once:"prizeControllerBeforeTakePrize4",id:++o},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,isAvailable:function(){return!t.get("hasBattlePass")},params:{model:this.battlePass},owner:this,once:"prizeControllerBeforeTakePrize7",id:++o},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:202,el:".artifactWorkshopButton.eggs2021world",name:"eggs2021worldForce1"},{type:StoryForceElement,owner:this.artifactController,page:"artifacts",once:"openWorkshop",id:201,el:".artifactWorkshop.eggs2021world .tree .button1",name:"eggs2021worldForce2"}]})},configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},getRandomWorldLevelNum:function(){return _.random(16,40)}}),X3e,Z3e,d4e,j4e,p4e,q4e;CollectParrot.prototype.getCapitalisedBaseName=(X3e=CollectParrot.prototype.getCapitalisedBaseName,function(e){return"eggs2021world"===episode.get("num")?"Catbox":X3e.call(this)}),ParrotCell.prototype.animateTakeLife=(Z3e=ParrotCell.prototype.animateTakeLife,function(t){var i=this;if("eggs2021world"===episode.get("num")){application.playSound(this.getTakeLifeSound());var o=this.life;this.$div.queue(function(e){i.$div.removeClass(i.baseName+"Level"+(o+1)).addClass(i.baseName+"ChangeLevel"+o).find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).delay(500).queue(function(e){i.$div.addClass(i.baseName+"Level"+o).removeClass(i.baseName+"ChangeLevel"+o).find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e(),t()})}else Z3e.call(this,t)}),ParrotCell.prototype.animateRemoval=(d4e=ParrotCell.prototype.animateRemoval,function(t){var i=this;if("eggs2021world"!==episode.get("num"))return d4e.call(this,t);var o=this.life;this.$div.queue(function(e){i.$div.removeClass(i.baseName+"Level"+(o+1)).addClass(i.baseName+"ChangeLevel0").find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).delay(500).queue(function(e){i.$div.addClass(i.baseName+"Level0").find("."+i.baseName+"CellBg").removeClass("stable").addClass("stable"),d4e.call(i,function(){e(),t()})})}),PumpkinCell.prototype.animateTakeLife=(j4e=PumpkinCell.prototype.animateTakeLife,function(e){var t=this;if("eggs2021world"!==episode.get("num"))return j4e.call(this,e);application.playSound("pumpkinCellTakeLife");var i=this.$div.find(".pumpkin");this.$div.clearQueue(),this.$div.queue(function(e){i.removeClass("stableAnimation"),i.addClass("pumpkinDamage"),e()}).delay(400).queue(function(e){i.removeClass("pumpkinDamage").addClass("stableAnimation"),t.$div.find(".pumpkinLife").html(t.life),e()}),e()}),figureRulesProcess.eggs2021worldBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(p4e=figureRulesProcess.additionalBonusClasses,function(){p4e.call(this),figureRulesProcess.eggs2021worldBonusClasses(),FigureRules.add(".episode_eggs2021world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/eggs2021world/artifactPlatform.png"}),FigureRules.add(".episode_eggs2021world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/eggs2021world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_eggs2021world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_eggs2021world .attribute_key",{width:Config.cellWidth,height:Config.cellHeight,"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/eggs2021world/mark.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_eggs2021world .bomb.color_Y .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombY.png"}),FigureRules.add(".episode_eggs2021world .bomb.color_R .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombR.png"}),FigureRules.add(".episode_eggs2021world .bomb.color_W .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombW.png"}),FigureRules.add(".episode_eggs2021world .bomb.color_P .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombP.png"}),FigureRules.add(".episode_eggs2021world .bomb.color_B .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombB.png"}),FigureRules.add(".episode_eggs2021world .bomb.color_G .cellSubBg",{"background-image":"../../../gems/site/img/features/eggs2021world/bombG.png"}),FigureRules.add(".episode_eggs2021world .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"../../../gems/site/img/features/eggs2021world/well.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_eggs2021world .wellLevel1.wellCell",{"background-position-x":80,"background-position-y":0}),FigureRules.add(".episode_eggs2021world .wellLevel2.wellCell",{"background-position-x":160,"background-position-y":0}),FigureRules.add(".episode_eggs2021world .wellCell.wellLevel3",{"background-position-x":240,"background-position-y":0,spriteFrames:3,duration:500,delay:[1e3,4e3],playRound:!0}),FigureRules.add(".episode_eggs2021world .wellCell.wellLevel4",{"background-position-x":480,"background-position-y":0,spriteFrames:1,duration:300,playRound:!0}),FigureRules.add(".episode_eggs2021world .color_N",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"../../../gems/site/img/features/eggs2021world/paint.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_eggs2021world .color_N.waterAnimated",{framesOrder:[0,1,2,1,0,1,2,1,0],duration:800,delay:[4200,5e3],playRound:!0}),FigureRules.add(".episode_eggs2021world .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":80,"background-image":"../../../gems/site/img/features/eggs2021world/paint.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_eggs2021world .flamyCellBg",{width:95/60*Config.cellWidth,height:2*Config.cellHeight,"background-width":161,"background-height":202,"background-image":"../../../gems/site/img/features/eggs2021world/eggStable.png","margin-left":.2*Config.cellWidth,"margin-top":4/60*Config.cellHeight,spriteFrames:7,framesOrder:[0,1,2,3,2,1,0],duration:600,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".episode_eggs2021world .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/eggs2021world/eggDamaged_xlarge.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200,playRound:!1,delay:[1,2]}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .taskIco",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"../../../gems/site/img/features/eggs2021world/paint.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .lifeText .currentLife, .episode_eggs2021world .flamyCell .lifeBlock .lifeText .divider, .episode_eggs2021world .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4"}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_eggs2021world .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_eggs2021world .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":138,"background-height":120,"background-image":"../../../gems/site/img/features/eggs2021world/darkFoxStable.png",width:2.3*Config.cellWidth,height:2*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:15,delay:[2e3,4e3],duration:1200,playRound:!0}),FigureRules.add(".episode_eggs2021world .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":138,"background-height":120,"background-image":"../../../gems/site/img/features/eggs2021world/darkFoxDamaged.png",width:2.3*Config.cellWidth,height:2*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:8,duration:500}),FigureRules.add(".episode_eggs2021world .alligatorFly",{"background-position-x":0,"background-position-y":0,"background-width":138,"background-height":120,"background-image":"../../../gems/site/img/features/eggs2021world/darkFoxDamaged.png",width:2.3*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:8,duration:500,playRound:!0,animation:{params:{width:[2.3*Config.cellWidth,.6*Config.cellWidth],height:[2*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_eggs2021world .alligatorLifeBlock",{"margin-top":1.7*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(q4e=figureRulesProcess.additionalBonusScaleImages,function(){q4e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/eggs2021world/mark.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombB.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombG.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombP.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombR.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombW.png":_Figure.scaleKoef,"../../../gems/site/img/features/eggs2021world/bombY.png":_Figure.scaleKoef})});var TicketEventView=BonusWorldView.extend({events:_.defaults({"click .openBtn":"openFinalChest","touchend .openBtn":"openFinalChest"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.model.on("change:timer",this.updateTimer,this),this.model.getComponent(OffersDeskComponent)&&(this.offers=new OffersDeskComponentView({el:this.$(".bwOffers"),model:this.model.getComponent(OffersDeskComponent)})),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.renderProgress(),this.listenTo(this.model,"completeLevel enter",this.updateProgress),this.renderChest()},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("offerBought",this.updateFinalChest,this),this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),this.updateFinalChest(),this.updateRandomLevelBtn()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("offerBought",this.updateFinalChest,this),this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this)},renderChest:function(){this.$chest=$(".mainTemplates .progressChest").clone(),this.$chest.find(".openBtn").html(messages.open),this.$(".bonusWorldUI.ticketevent").append(this.$chest)},renderProgress:function(){var e=this.model.get("prizes").find(function(e){return"finalPrize"===e.type}).prize.find(function(e){return"lotteryTicket"===e.name});e&&this.$(".progressBarLine").toggleClass("special",-1!==e.networks.indexOf(network)),this.$(".bonusWorldProgressGoal").html(this.model.minRandomLevel-1)},updateProgress:function(){var e=this.model.minRandomLevel,t=this.model.getCurrentLevel()-1;if(e-1<=t)this.$(".mPrizeControllerOuterProgressBar").hide();else{var i=this.$el.find(".progressBarLine"),o=Math.ceil(t/e*100);i.css({width:o+"%"})}},updateTimer:function(e,t){var i;i=formatTime(86400<=t?"%j"+messages.bonusWorldLeftTime[2]+"%G"+messages.bonusWorldLeftTime[0]:"%H:%i:%s",t),this.$ui.find(".bonusWorldTimer").html(i)},updateFinalChest:function(){var e=this.model.getComponent(OffersDeskComponent),t=e.getSoldOutOffersAmount(),i=e.offers.length;this.$chest.find(".openBtn").toggleClass("active",this.model.canOpenFinalChest()),this.$chest.find(".progressBlock").toggleClass("active",!this.model.canOpenFinalChest()),this.$chest.find(".value").html(t+"/"+i)},openFinalChest:function(){this.model.openFinalChest()},updateRandomLevelBtn:function(){var e=this.model.getCurrentLevel()>=this.model.minRandomLevel;this.$randomBtn.toggleClass("active",e&&!!this.model.getRandomWorldLevelNum())},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress");e.find(".mLevel").html(t),e.toggleClass("active",this.model.getCurrentLevel()<this.model.minRandomLevel)}}),TicketEvent=BonusWorld.extend({minRandomLevel:16,midRandomLevel:40,maxRandomLevel:60,defaults:_.defaults({name:"ticketevent",version:20210419,viewId:TicketEventView,finishWindowInStories:!0,levelsInEpisode:60,helpWindow:!1,closeForNew:!0,lastLevelOpen:!0,durationDays:3,production:!1,episode:1,level:1,minEpisodeToEnter:1,minLevelToEnter:16,allowProlong:!0,prolongMaxTimes:1,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,beginDate:new Date("2021/05/01 00:00"),unlimitedName:"unlimitedBonusWorldLives",offersCompletePrize:{name:"offersCompletePrize",products:[{type:"GoodProduct",addTime:86400,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:172800,goodId:"unlimitedKeys"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"SpinProduct",amount:1,showGacha:!1}]},prizes:[{type:"finalPrize",level:15,prize:[{type:"coins",cssClass:"coins",amount:400},{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:4},{type:"good",cssClass:"unlimitedBonusWorldLives",name:"unlimitedBonusWorldLives",amount:6},{type:"IntegrationEventPrize",cssClass:"lotteryTicket",name:"lotteryTicket",amount:1,eventType:"quest_completed",networks:["vkontakte","test"]}]}]},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e);this.ticketComponent=this.addComponent(TicketsComponent,{name:this.get("name")}),this.addComponent(TriesComponent,{conditioner:{isTryValid:function(e,t){return t<=e.world.getCurrentLevel()},canGivePrize:function(e,t){return!0}},variants:[{tries:1,prizes:[{type:"tickets",amount:5}]},{tries:2,prizes:[{type:"tickets",amount:4}]},{tries:1/0,prizes:[{type:"tickets",amount:3}]}]}),this.addComponent(OffersDeskComponent,{forceOfferId:"offer1",world:this,offers:[{id:"offer1",price:10,supply:2,paymentAdapter:this.ticketComponent,products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.unlimitedBonusWorldLives,addTime:"2h"}]},{id:"offer2",price:15,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"3h"},{type:"spins",amount:1}]},{id:"offer3",price:15,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"2h"}]},{id:"offer4",price:20,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedBonusWorldLives,addTime:"4h"}]},{id:"offer5",price:25,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{id:"offer6",price:25,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"3h"},{type:"spins",amount:1}]},{id:"offer7",price:30,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedBonusWorldLives,addTime:"4h"}]},{id:"offer8",price:30,supply:1,paymentAdapter:this.ticketComponent,products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"spins",amount:1}]}]}),this.storyController=new StoryController({name:this.get("name"),world:this,stories:[{type:StoryForceElement,owner:this,noRetry:!0,once:"enter",id:1,el:".bonusWorldUI.ticketevent .startCurrentLevel",name:this.get("name")+"Force1"},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize},owner:this,once:"onFinishLevel15",id:2},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,id:3,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},owner:this,once:"onFinishLevel15"},{type:StoryForceElement,owner:this.getComponent(OffersDeskComponent),noRetry:!0,on:"showForce",id:205,el:".bwOffers .offer1 .mBuyBtn",name:this.get("name")+"Force2"}]},{actionQueue:this.get("actionQueue")})},configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.storyController.configure(e))},getRandomWorldLevelNum:function(){var t=this,i=episode.scores,e=Object.keys(episode.get("levels")).map(function(e){return parseInt(e,10)}),o=e.filter(function(e){return e>=t.minRandomLevel&&e<=t.midRandomLevel&&!i.findWhere({level:e})});return o.length<=0&&(o=e.filter(function(e){return e>t.midRandomLevel&&e<=t.maxRandomLevel&&!i.findWhere({level:e})})),RANDOM(o)},canOpenFinalChest:function(){var t=0;return this.getComponent(OffersDeskComponent).offers.forEach(function(e){t+=e.getLimit()}),t<=0},openFinalChest:function(){new BonusWorldFinalPrizeWindow({prize:new UserPrizes(UserPrizes.convertFromCocos(this.get("offersCompletePrize"))),world:this})},onBonusWorldTakePrize:function(){this.get("offerChestTaken")&&BonusWorld.prototype.onBonusWorldTakePrize.call(this)}}),q5e;figureRulesProcess.ticketeventBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(q5e=figureRulesProcess.additionalBonusClasses,function(){q5e.call(this),figureRulesProcess.ticketeventBonusClasses()});var StPatricksDay=BonusWorld.extend({defaults:_.defaults((_$defaults4={name:"stpatricksday",version:20210312,levelsInEpisode:9,helpWindow:!1,showFinalForce:!1,durationDays:3},_defineProperty(_$defaults4,"helpWindow",!1),_defineProperty(_$defaults4,"suggestPlayForLife",!0),_defineProperty(_$defaults4,"lastLevelOpen",!0),_defineProperty(_$defaults4,"production",!1),_defineProperty(_$defaults4,"episode",1),_defineProperty(_$defaults4,"level",1),_defineProperty(_$defaults4,"minEpisodeToEnter",2),_defineProperty(_$defaults4,"minLevelToEnter",2),_defineProperty(_$defaults4,"openDate",null),_defineProperty(_$defaults4,"showProgress",!0),_defineProperty(_$defaults4,"forceId",!0),_defineProperty(_$defaults4,"closeForNew",!0),_defineProperty(_$defaults4,"allowPaid",!0),_defineProperty(_$defaults4,"allowProlong",!0),_defineProperty(_$defaults4,"prolongMaxTimes",1),_defineProperty(_$defaults4,"allowAfterWin",!1),_defineProperty(_$defaults4,"prizes",[{type:"middlePrize",level:2,prize:[{type:"coins",name:"coins",cssClass:"coins",amount:50}]},{type:"middlePrize",level:4,prize:[{type:"coins",name:"coins",cssClass:"coins",amount:150}]},{type:"middlePrize",level:6,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"middlePrize",level:8,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"finalPrize",prize:[{type:"good",cssClass:"starInField",name:"starInField",amount:24},{type:"coins",name:"coins",cssClass:"coins",amount:500},{type:"gift",cssClass:"gift_sticker8",name:"gift_sticker8",ids:["gift_sticker8"],amount:1}]}]),_$defaults4),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e)},configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},onCloseFinishWindow:function(){this.exit()}}),x5e,y5e;figureRulesProcess.stpatricksdayBonusClasses=function(){FigureRules.add(".episode_stpatricksday .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/beer.00f50d86b4.png"}),FigureRules.add(".episode_stpatricksday .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/clover.ae2701a85b.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:0,framesOrder:[0],duration:0,delay:0,playRound:!1}),FigureRules.add(".snakeLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":34/60*Config.cellWidth,"margin-top":88/60*Config.cellHeight}),FigureRules.add(".snakeLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".less50PercentLifesnakeLife",{"background-color":"#ff0"}),FigureRules.add(".less25PercentLife.snakeLife",{"background-color":"#F2342C"}),FigureRules.add(".snakeHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight}),FigureRules.add(".snakeBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/snakeStable.6402f278ae.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],delay:[2e3,4e3],duration:500,playRound:!0}),FigureRules.add(".snakeBg.snakeAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/snakeDamage.151505ee82.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400}),FigureRules.add(".snakeFly",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/snakeDamage.151505ee82.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:0,framesOrder:[0],duration:0,playRound:!1,animation:{params:{width:[2*Config.cellWidth,Config.cellWidth],height:[2*Config.cellHeight,Config.cellHeight],"margin-left":[0,Config.cellWidth/2],"margin-top":[0,Config.cellHeight],opacity:[1,0]},duration:1e3}})},figureRulesProcess.additionalBonusClasses=(x5e=figureRulesProcess.additionalBonusClasses,function(){x5e.call(this),figureRulesProcess.stpatricksdayBonusClasses()}),figureRulesProcess.additionalBonusScaleImages=(y5e=figureRulesProcess.additionalBonusScaleImages,function(){y5e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/beer.00f50d86b4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/snakeDamage.151505ee82.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/stpatricksday/snakeStable.6402f278ae.png":_Figure.scaleKoef})});var PashaWorldView=BonusWorldView.extend({onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.questController.tasks.on("change",this.updateProgressBar,this),this.updateProgressBar()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.questController.tasks.on("change",this.updateProgressBar,this)},updateProgressBar:function(){var e=this.$(".mPrizeControllerOuterProgressBar .progressBarLine"),t=this.model.questController.getProgressToNextPrize();this.$(".mPrizeControllerOuterProgressBar").toggleClass("active",!!this.model.questController.getNextPrizedTask()),e.css("width",t+"%")}}),PashaWorld=BonusWorld.extend({defaults:_.defaults((_$defaults5={name:"pashaworld",viewId:PashaWorldView,version:20210318,levelsInEpisode:45,helpWindow:!0,closeForNew:!0,lastLevelOpen:!0},_defineProperty(_$defaults5,"helpWindow",!0),_defineProperty(_$defaults5,"durationDays",!1),_defineProperty(_$defaults5,"production",!0),_defineProperty(_$defaults5,"episode",1),_defineProperty(_$defaults5,"level",1),_defineProperty(_$defaults5,"minEpisodeToEnter",2),_defineProperty(_$defaults5,"minLevelToEnter",2),_defineProperty(_$defaults5,"forceId",!0),_defineProperty(_$defaults5,"actionQueue",new ActionQueue),_defineProperty(_$defaults5,"finishWindowInStories",!0),_defineProperty(_$defaults5,"withoutInnerWindow",!0),_defineProperty(_$defaults5,"allowAfterWin",!0),_defineProperty(_$defaults5,"showFinalForce",!0),_defineProperty(_$defaults5,"endDate",new Date("2021/05/18 17:00")),_defineProperty(_$defaults5,"helpWindowPrize",[{type:"good",name:"unlimitedLifes",amount:2}]),_defineProperty(_$defaults5,"prizes",[{type:"middlePrize",level:45,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]}]),_defineProperty(_$defaults5,"allowPaid",!0),_defineProperty(_$defaults5,"allowProlong",!1),_$defaults5),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.questController=new QuestController({world:this,hasTasksWindow:!0,name:this.get("name"),tasks:[{id:1,price:1},{id:2,price:1,required:[1]},{id:3,price:1,required:[2]},{id:4,world:this,price:2,required:[3],prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell}]}},{id:5,price:1,required:[4]},{id:6,price:2,required:[4]},{id:7,price:1,required:[5,6],options:!0},{id:8,price:2,required:[7]},{id:9,price:1,required:[8]},{id:10,price:1,required:[9]},{id:11,price:2,required:[10]},{id:12,price:1,required:[11]},{id:13,price:2,world:this,required:[12],options:!0,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedLifes}]}},{id:14,price:1,required:[13]},{id:15,price:2,required:[14]},{id:16,price:2,required:[15],options:!0},{id:17,price:2,required:[16]},{id:18,price:3,required:[16]},{id:19,price:2,required:[17,18],options:!0},{id:20,price:2,world:this,required:[19],prize:{products:[{type:"CoinsProduct",amount:350},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.unlimitedLifes},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField}]}},{id:21,price:2,required:[20]},{id:22,price:2,required:[21]},{id:23,price:2,required:[22]},{id:24,price:2,required:[23]},{id:25,price:3,required:[24]},{id:26,price:2,world:this,required:[25],hasReservedPrize:!0,prize:{products:[{type:"CoinsProduct",amount:1e3},{type:"GoodProduct",addTime:86400,goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.addThreeMoves},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.Shuffle},{type:"SpinProduct",amount:2}]}}]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.pashaworld",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{anchorEl:".button4",scrollable:!0,partSource:new Artifacts.PartDropper({chances:{15:30,7:40},generatingModel:Artifacts.PartRandomizer}),config:{showAll:!0,parts:[{id:1,chance:.06},{id:2,chance:.06},{id:3,chance:.09},{id:4,chance:.1},{id:5,chance:.09},{id:6,chance:.05},{id:7,chance:.07},{id:8,chance:.08},{id:9,chance:.07},{id:10,chance:.06},{id:11,chance:.06},{id:12,chance:.06},{id:13,chance:.06},{id:14,canBeSold:!1,chance:.03},{id:15,canBeSold:!1,chance:.03},{id:16,canBeSold:!1,chance:.03}],artifacts:[{id:1,parts:[1,2,3,4,5],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:50}]},{id:2,parts:[2,3,4,5,6],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:100}]},{id:3,parts:[3,4,5,7,8],ability:{type:Artifacts.EmptyAbility},cssClass:".indicator1",prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:50}]},{id:4,parts:[3,4,5,8,9],ability:{type:Artifacts.EmptyAbility},cssClass:".indicator2",prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:5,parts:[3,4,5,9,10],passive:!0,ability:{type:Artifacts.EmptyAbility},cssClass:".indicator3",prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:6,parts:[4,5,9,10,11],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:7,parts:[4,5,10,11,12],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:50}]},{id:8,parts:[9,10,11,12,13],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:50}]},{id:9,parts:[3,7,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"starInField",amount:8},{type:"coins",amount:100}]},{id:10,parts:[4,8,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"addThreeMoves",amount:8},{type:"coins",amount:200}]},{id:11,parts:[5,9,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"unlimitedLifes",amount:24},{type:"coins",amount:300}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,artifacts:[7]},{id:8,autoSet:!0,artifacts:[8]},{id:9,autoSet:!0,artifacts:[9]},{id:10,autoSet:!0,artifacts:[10]},{id:11,autoSet:!0,artifacts:[11]}]}}});var t=0;this.storyController=new StoryController({name:this.name,world:this,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++t},{type:StoryTalkElement,owner:this,once:"enter",id:++t,talkKey:1},{type:StoryForceElement,owner:this,once:"enter",id:210,delay:1e3,el:".questUi_pashaworld .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,owner:this,on:"onFinishLevel1",id:211,delay:1e3,el:".mBonusWorldTasksWindowBtn.pashaworld",name:this.get("name")+"Force2"},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask1",id:++t,talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++t,scrollTo:".task1",elements:[{el:".screen1 .friend",persistentClass:"hidden1"},{el:".screen1 .task1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask1",id:++t,talkKey:3},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++t,scrollTo:".task1",elements:[{el:".screen1 .task1",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask1",id:++t,talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++t,scrollTo:".task1",elements:[{el:".screen1 .task1",persistentClass:"updated2"},{el:".screen1 .task1",className:"onAnimate"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask1",id:++t,talkKey:5},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask2",id:++t,talkKey:6},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask2",id:++t,scrollTo:".task2",elements:[{el:".screen1 .bg.girl",persistentClass:"hidden1"},{el:".screen1 .task2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask2",id:++t,talkKey:7},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask3",id:++t,talkKey:8},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3",id:++t,scrollTo:".task3",elements:[{el:".screen1 .task3",persistentClass:"visible1"},{el:".screen1 .task3",className:"onAnimate"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask3",id:++t,talkKey:9},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask4",id:++t,talkKey:10},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++t,scrollTo:".task4",elements:[{el:".screen1 .task2",persistentClass:"hidden1"},{el:".screen1 .task3",persistentClass:"hidden1"},{el:".screen1 .task4.table",persistentClass:"visible1"},{el:".screen1 .task4.girl",persistentClass:"visible1"},{el:".screen1 .task4.girl",persistentClass:"onAnimate"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask4",id:++t,talkKey:11},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++t,delayAfter:0,elements:[{el:".questContainer .screen1",className:"fadeOut"},{el:".questContainer .screen2",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++t,elements:[{el:".questContainer .screen1",persistentClass:"hide"},{el:".questContainer .screen2",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask4",id:++t,talkKey:12},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++t,scrollTo:".task6",elements:[{el:".screen2 .task6",persistentClass:"visible1"},{el:".screen2 .bg.girl",persistentClass:"hidden1"},{el:".screen2 .friend",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask5",id:++t,talkKey:13},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask6",id:++t,scrollTo:".task6",elements:[{el:".screen2 .task6",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask6",id:++t,talkKey:14},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask7",id:++t,talkKey:15},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",id:++t,scrollTo:".task7",elements:[{el:".screen2 .bg.clubok",persistentClass:"hidden1"},{el:".screen2 .task7",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask7",id:++t,talkKey:16},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",id:++t,scrollTo:".task8",elements:[{el:".screen2 .task8",persistentClass:"visible1"},{el:".screen2 .task6",persistentClass:"hidden1"},{el:".screen2 .friend ",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask8",id:++t,talkKey:17},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",id:++t,scrollTo:".task8",elements:[{el:".screen2 .task8",persistentClass:"hidden1"},{el:".screen2 .task9 ",persistentClass:"visible1"},{el:".screen2 .cat",persistentClass:"updated1"},{el:".screen2 .cat",className:"onAnimate"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask8",id:++t,talkKey:18},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask9",id:++t,talkKey:19},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",id:++t,scrollTo:".task10",elements:[{el:".screen2 .task9",persistentClass:"hidden1"},{el:".screen2 .task10.girl",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask10",id:++t,talkKey:20},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",id:++t,scrollTo:".task10",elements:[{el:".screen2 .task10.eggs",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask10",id:++t,talkKey:21},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask11",id:++t,talkKey:22},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++t,scrollTo:".task9",elements:[{el:".screen2 .task9",persistentClass:"visible2"},{el:".screen2 .task10.girl",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask12",id:++t,talkKey:23},{type:StoryAnimationElement,owner:this.questController,once:"beforeCompleteTask13",id:++t,scrollTo:".task10",elements:[{el:".screen2 .task10.girl",persistentClass:"visible2"},{el:".screen2 .task9",persistentClass:"hidden2"}]},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask13",id:++t,talkKey:24},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++t,scrollTo:".task13",elements:[{el:".screen2 .task13",persistentClass:"visible1"},{el:".screen2 .task10.girl",persistentClass:"hidden3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask13",id:++t,talkKey:25},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++t,scrollTo:".task13",elements:[{el:".screen2 .task10.eggs",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask13",id:++t,talkKey:26},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++t,delayAfter:0,elements:[{el:".questContainer .screen2",className:"fadeOut"},{el:".questContainer .screen3",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++t,elements:[{el:".questContainer .screen2",persistentClass:"hide"},{el:".questContainer .screen3",persistentClass:"show"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask14",id:++t,scrollTo:".task14",elements:[{el:".screen3 .bg.girl",persistentClass:"hidden1"},{el:".screen3 .task14",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask14",id:++t,talkKey:27},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask15",id:++t,scrollTo:".task5",elements:[{el:".screen3 .task14",persistentClass:"hidden1"},{el:".screen3 .bg.mouse",persistentClass:"hidden1"},{el:".screen3 .task15",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask15",id:++t,talkKey:28},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask16",id:++t,talkKey:29},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask16",id:++t,scrollTo:".task16",elements:[{el:".screen3 .bg.table",persistentClass:"hidden1"},{el:".screen3 .task16",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask16",id:++t,talkKey:30},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask16",id:++t,talkKey:31},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask17",id:++t,talkKey:32},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask17",id:++t,scrollTo:".task17",elements:[{el:".screen3 .task17.brokenEgg ",persistentClass:"visible1"},{el:".screen3 .task17.girl ",persistentClass:"visible1"},{el:".screen3 .bg.mouse ",persistentClass:"visible2"},{el:".screen3 .task15 ",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask18",id:++t,talkKey:33},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask18",id:++t,scrollTo:".task18",elements:[{el:".screen3 .task18",persistentClass:"visible1"},{el:".screen3 .task15",persistentClass:"visible2"},{el:".screen3 .task17.girl",persistentClass:"hidden1"},{el:".screen3 .bg.mouse",persistentClass:"hidden2"}]},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask19",id:++t,talkKey:34},{type:StoryAnimationElement,owner:this.questController,once:"beforeCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen3 .task19.pirateEgg",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask19",id:++t,talkKey:35},{type:StoryAnimationElement,owner:this.questController,once:"beforeCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen3 .task19.mouseEgg",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask19",id:++t,talkKey:36},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen3 .task19.girlEgg",persistentClass:"visible1"},{el:".screen3 .task19.girl",persistentClass:"visible1"},{el:".screen3 .task15",persistentClass:"hidden2"},{el:".screen3 .bg.mouse",persistentClass:"visible3"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19Option1",id:++t,scrollTo:".task19",elements:[{el:".screen4 .task24.queen",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19Option2",id:++t,scrollTo:".task19",elements:[{el:".screen4 .task24.queen",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19Option3",id:++t,scrollTo:".task19",elements:[{el:".screen4 .task24.queen",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:37},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask20",id:++t,talkKey:38},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++t,delayAfter:0,elements:[{el:".questContainer .screen3",className:"fadeOut"},{el:".questContainer .screen4",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++t,elements:[{el:".questContainer .screen3",persistentClass:"hide"},{el:".questContainer .screen4",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask20",id:++t,talkKey:39},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:40},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++t,scrollTo:".task21",elements:[{el:".screen4 .bg.girl",persistentClass:"hidden1"},{el:".screen4 .task21.girl",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:41},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++t,scrollTo:".task21",elements:[{el:".screen4 .bg.king",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:42},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++t,scrollTo:".task21",elements:[{el:".screen4 .task21.eggs",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:43},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask22",id:++t,talkKey:44},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",id:++t,scrollTo:".task21",elements:[{el:".screen4 .task21.eggs",persistentClass:"hidden1"},{el:".screen4 .task21.king",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask23",id:++t,talkKey:45},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++t,scrollTo:".task21",elements:[{el:".screen4 .task21.king",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask24",id:++t,talkKey:46},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++t,scrollTo:".task24",elements:[{el:".screen .task21.girl",persistentClass:"hidden1"},{el:".screen .task24.girl",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask24",id:++t,talkKey:47},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++t,scrollTo:".task24",elements:[{el:".screen .bg.queen",persistentClass:"hidden1"},{el:".screen .task24.queen",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask24",id:++t,talkKey:48},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask25",id:++t,talkKey:49},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,delayAfter:0,elements:[{el:".questContainer .screen4",className:"fadeOut"},{el:".questContainer .screen5",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,elements:[{el:".questContainer .screen4",persistentClass:"hide"},{el:".questContainer .screen5",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask26",id:++t,talkKey:50},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:UserPrizes.convertFromCocos(this.questController.tasks.at(25).get("prize"))},owner:this.questController,once:"afterCompleteTask26",id:++t},{type:BaseStoryWindowElement,window:BonusWorldTasksWindow,params:{taskController:this.questController},owner:this,delay:1e3,once:"onFinishLevel45",id:++t},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask26",id:212,elements:[{el:".mBonusWorldTasksWindowBtn",persistentClass:"hide"},{el:".mQuestGold",persistentClass:"hide"}]},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.pashaworld",name:"pashaworldForce2"},{type:StoryForceElement,owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.pashaworld .tree .button4",name:"pashaworldForce4"}]},{actionQueue:this.get("actionQueue")})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.storyController.configure(e))}}),J5e,K5e;figureRulesProcess.additionalBonusScaleImages=(J5e=figureRulesProcess.additionalBonusScaleImages,function(){J5e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/pashaworld/barrelKey.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/barrelMonkey.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/bigEgg.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/clock.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/coin.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/coinChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/egg1.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/egg2.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/egg3.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass1.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass2.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass3.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass1Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass2Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/grass3Die.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/king.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/rabbit.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/rose.png":_Figure.scaleKoef,"../../../gems/site/img/features/pashaworld/special10.png":_Figure.scaleKoef})}),figureRulesProcess.pashaworldBonusClasses=function(){FigureRules.add(".episode_pashaworld .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/special10.png"}),FigureRules.add(".episode_pashaworld .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/clock.png",width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":-10/60*Config.cellHeight,spriteFrames:4,framesOrder:[0,1,2,0],duration:400,delay:[3e3,4e3],playRound:!0}),FigureRules.add(".episode_pashaworld .color_0, .episode_pashaworld .color_1, .episode_pashaworld .color_2",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/rose.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_pashaworld .color_0",{"background-position-x":1440}),FigureRules.add(".episode_pashaworld .color_1",{"background-position-x":0}),FigureRules.add(".episode_pashaworld .collectedcolor_1",{spriteFrames:9,duration:900,framesOrder:[0,1,2,3,4,5,6,7,8]}),FigureRules.add(".episode_pashaworld .color_2",{"background-position-x":1440}),FigureRules.add(".episode_pashaworld .collectedcolor_2",{spriteFrames:4,duration:900,framesOrder:[0,1,2,3]}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/pashaworld/egg1.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/pashaworld/egg2.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/pashaworld/egg3.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/pashaworld/egg1.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/pashaworld/egg2.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variantbig",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/bigEgg.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variantbig1",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/bigEgg.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variantbig2",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/bigEgg.png"}),FigureRules.add(".episode_pashaworld .frozen_frozenegg.variantbig3",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/bigEgg.png"}),FigureRules.add(".episode_pashaworld .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass1.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass2.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass3.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .iceBlast1.iceBlast, .episode_pashaworld .iceBlast2.iceBlast, .episode_pashaworld .iceBlast3.iceBlast, .episode_pashaworld .iceBlast4.iceBlast, .episode_pashaworld .iceBlast5.iceBlast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass1Die.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .iceBlast2.iceBlast",{"background-position-x":222}),FigureRules.add(".episode_pashaworld .iceBlast3.iceBlast",{"background-position-x":444}),FigureRules.add(".episode_pashaworld .iceBlast4.iceBlast",{"background-position-x":666}),FigureRules.add(".episode_pashaworld .iceBlast5.iceBlast",{"background-position-x":888}),FigureRules.add(".episode_pashaworld .ice1Blast1.ice1Blast, .episode_pashaworld .ice1Blast2.ice1Blast, .episode_pashaworld .ice1Blast3.ice1Blast.episode_pashaworld .ice1Blast4.ice1Blast.episode_pashaworld .ice1Blast5.ice1Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass1Die.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .ice1Blast2.ice1Blast",{"background-position-x":222}),FigureRules.add(".episode_pashaworld .ice1Blast3.ice1Blast",{"background-position-x":444}),FigureRules.add(".episode_pashaworld .ice1Blast4.ice1Blast",{"background-position-x":666}),FigureRules.add(".episode_pashaworld .ice1Blast5.ice1Blast",{"background-position-x":888}),FigureRules.add(".episode_pashaworld .ice2Blast1.ice2Blast, .episode_pashaworld .ice2Blast2.ice2Blast, .episode_pashaworld .ice2Blast3.ice2Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass2Die.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .ice2Blast2.ice2Blast",{"background-position-x":222}),FigureRules.add(".episode_pashaworld .ice3Blast1.ice3Blast, .episode_pashaworld .ice3Blast2.ice3Blast, .episode_pashaworld .ice3Blast3.ice3Blast",{"background-position-x":0,"background-position-y":0,"background-width":222,"background-height":224,"background-image":"../../../gems/site/img/features/pashaworld/grass3Die.png","margin-left":-7/60*Config.cellWidth,"margin-top":-23/3/60*Config.cellHeight,width:74/60*Config.cellWidth,height:224/3/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .ice3Blast2.ice3Blast",{"background-position-x":222}),FigureRules.add(".episode_pashaworld .ice3Blast3.ice3Blast",{"background-position-x":444}),FigureRules.add(".episode_pashaworld .decorator_greedypirate",{"background-image":"../../../gems/site/img/features/pashaworld/greedyPirate1.png"}),FigureRules.add(".episode_pashaworld .move_greedypirate",{"background-image":"../../../gems/site/img/features/pashaworld/greedyPirate1.png"}),FigureRules.add(".episode_pashaworld .grab_greedypirate",{"background-image":"../../../gems/site/img/features/pashaworld/greedyPirate1.png"}),FigureRules.add(".episode_pashaworld .attribute_coin",{"background-image":"../../../gems/site/img/features/pashaworld/coin.png"}),FigureRules.add(".episode_pashaworld .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/pashaworld/coin.png"}),FigureRules.add(".episode_pashaworld .coinChestHeadCell",{"background-image":"../../../gems/site/img/features/pashaworld/coinChest.png"}),FigureRules.add(".episode_pashaworld .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_pashaworld .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_pashaworld .shooterCell",{width:238/180*Config.cellWidth,height:291/180*Config.cellHeight,"background-width":238,"background-height":291,"margin-left":-15/180*Config.cellWidth,"margin-top":-111/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/pashaworld/barrelMonkey.png"}),FigureRules.add(".episode_pashaworld .shooterCell.powerUpHighlight",{animation:{params:{"margin-top":[-111/180*Config.cellHeight,-120/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_pashaworld .shooterCell.active",{"background-position-x":1428}),FigureRules.add(".episode_pashaworld .shooterCell.deactivated",{"background-position-x":1428,spriteFrames:11,duration:1100,playRound:!1}),FigureRules.add(".episode_pashaworld .shooterTask",{width:116/180*Config.cellWidth,height:102/180*Config.cellHeight,"background-width":116,"background-height":102,"background-image":"../../../gems/site/img/features/pashaworld/barrelKey.png"}),FigureRules.add(".episode_pashaworld .decorator_crabMouse",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/rabbit.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:400,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_pashaworld .decorator_crabMouse.takeLife",{"background-position-x":540,spriteFrames:3,duration:150,playRound:!0}),FigureRules.add(".episode_pashaworld .decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_pashaworld .move_crabMouse, .episode_pashaworld .crabMouseCollect",{"background-position-x":1080,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/rabbit.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:3,duration:500,playRound:!1}),FigureRules.add(".episode_pashaworld .move_crabMouse.moveRight",{"scale-x":-1,"margin-left":0}),FigureRules.add(".episode_pashaworld .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_pashaworld .decorator_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_pashaworld .decorator_crabMouse .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":5/60*Config.cellWidth,"margin-top":.9*Config.cellHeight}),FigureRules.add(".episode_pashaworld .decorator_crabMouse .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#ff0"}),FigureRules.add(".episode_pashaworld .decorator_crabMouse.lifeLevel1 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_pashaworld .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/king.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:9,framesOrder:[0,1,2,1,0,1,2,1,0],duration:900,playRound:!0,delay:[1e3,3e3]}),FigureRules.add(".episode_pashaworld .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/king.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[3,4,5,4,3],duration:500}),FigureRules.add(".episode_pashaworld .alligatorSpecial",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/pashaworld/king.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[6,7,8,9],duration:400,playRound:!0,animation:{params:{width:[2*Config.cellWidth,.5*Config.cellWidth],height:[2*Config.cellHeight,.5*Config.cellHeight],"margin-left":[0,.75*Config.cellWidth],"margin-top":[0,.75*Config.cellHeight],opacity:[1,0]},duration:800}}),FigureRules.add(".episode_pashaworld .alligatorLifeBlock",{"margin-top":100/60*Config.cellHeight}),FigureRules.add(".episode_pashaworld .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/pashaworld/artifactPlatform.png"}),FigureRules.add(".episode_pashaworld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/pashaworld/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_pashaworld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_pashaworld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_pashaworld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_pashaworld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_pashaworld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_pashaworld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_pashaworld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_pashaworld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_pashaworld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_pashaworld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_pashaworld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_pashaworld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_pashaworld .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_pashaworld .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_pashaworld .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_pashaworld .artifactPartCell.part16 .part",{frame:15})},figureRulesProcess.additionalBonusClasses=(K5e=figureRulesProcess.additionalBonusClasses,function(){K5e.call(this),figureRulesProcess.pashaworldBonusClasses()});var PiratesDayWorld=BonusWorld.extend({defaults:_.defaults({name:"piratesdayworld",version:20230929,levelsInEpisode:70,helpWindow:!1,showFinalForce:!1,durationDays:!1,lastLevelOpen:!0,production:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:16,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],unlimitedName:"unlimitedBonusWorldLives2",openDate:null,closeForNew:!1,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0,showProgress:!0,sounds:{narrator:!1,pirate1:!1,pirate2:!1,pirate3:!1,pirate4:!1,girl1:!1,girl2:!1,girl3:!1,girl4:!1,kudrik1:!1,kudrik2:!1,kudrik3:!1,jack1:!1,jack2:!1,candybeard1:!1,candybeard2:!1,candybeard3:!1,admiral1:!1,admiral2:!1,admiral3:!1,ctulhu1:!1,ctulhu2:!1,persik1kudrik1:!1,pirate3jack1candybeard1:!1,persik1:!1}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);this.questController=new QuestController({hasTasksWindow:!0,name:this.get("name"),tasks:[{id:1,price:1,options:!0},{id:2,price:1,required:[1],options:!0},{id:3,price:1,world:this,required:[2],options:!0,interim:!0,prize:{products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]}},{id:4,price:1,required:[3],options:!0},{id:5,price:2,world:this,required:[4],prize:{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedBonusWorldLives2}]}},{id:6,price:2,required:[5]},{id:7,price:2,required:[6],options:!0},{id:8,price:2,world:this,required:[7],options:!0,interim:!0,prize:{products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]}},{id:9,price:2,required:[8],options:!0},{id:10,price:2,required:[9],options:!0},{id:11,price:3,world:this,required:[10],prize:{products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField}]}},{id:12,price:2,required:[11]},{id:13,price:3,required:[12]},{id:14,price:3,required:[13]},{id:15,price:3,world:this,required:[14],interim:!0,prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedBonusWorldLives2}]}},{id:16,price:3,required:[15]},{id:17,price:3,required:[16]},{id:18,price:3,world:this,required:[17],prize:{products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField}]}},{id:19,price:3,required:[18],options:!0},{id:20,price:4,required:[19]},{id:21,price:4,required:[20]},{id:22,price:4,world:this,required:[21],options:!0,interim:!0,prize:{products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow}]}},{id:23,price:4,required:[22]},{id:24,price:4,required:[23]},{id:25,price:4,required:[24]},{id:26,price:5,world:this,required:[25],prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:43200,goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}}]},this),this.battlePass=new BattlePass({world:this,instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives2"},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}}),this.rewardChain=new RewardChain({viewClass:PiratesDayWorldRewardChainView,world:this,name:this.get("name"),alternativeProgressBar:!0,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"battlePass",level:5,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"battlePass",level:10,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:1}]},{type:"middlePrize",level:15,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:50},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"battlePass",level:15,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",amount:1}]},{type:"middlePrize",level:20,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"battlePass",level:20,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"middlePrize",level:25,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"battlePass",level:25,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:30,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:2}]},{type:"battlePass",level:30,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:2},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:1}]},{type:"middlePrize",level:35,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:1}]},{type:"battlePass",level:35,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:300},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:40,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{type:"battlePass",level:40,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"middlePrize",level:45,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"battlePass",level:45,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"middlePrize",level:50,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"battlePass",level:50,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:2}]},{type:"middlePrize",level:55,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"battlePass",level:55,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"middlePrize",level:60,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"battlePass",level:60,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"spins",amount:1}]},{type:"middlePrize",level:65,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"battlePass",level:65,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:70,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:1e3},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12}]}]}),this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:"#map .questUi_"+this.get("name"),artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3}]},artifactWorkshop:{partSource:new Artifacts.BoxPartDroppper({generatingModel:Artifacts.WeighedPartGeneration,rule:function(){return 2<t.getCurrentLevel()},chanceStrategyCls:OnRandomMoveChanceStrategy,movesOrder:"straight",chanceForLevel:70}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"spins",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:7200,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:4},{type:"spins",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}});var i=0;this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"enter",id:++i,elements:[{el:".questContainer .screen1",persistentClass:"show"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++i},{type:StoryTalkElement,owner:this,once:"enter",id:++i,talkKey:1},{type:StoryForceElement,owner:this,once:"enter",id:203,delay:1e3,el:".mBonusWorldTasksWindowBtn.piratesdayworld",name:this.get("name")+"Force0"},{type:StoryForceElement,once:"enter",window:BonusWorldTasksWindow,el:".tasksListContent .specialWorldTask .priceBlock .buyTask",name:this.get("name")+"Force100",id:201},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask1",id:++i,talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++i,scrollTo:".task1",elements:[{el:".screen .task1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask1",id:++i,talkKey:3},{type:StoryForceElement,owner:this.questController,once:"taskProgressUpdated1",id:204,el:".questUi_piratesdayworld .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask2",id:++i,talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask2",id:++i,scrollTo:".task2",elements:[{el:".screen .task2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask2",id:++i,talkKey:5},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask2",id:++i,scrollTo:".task2",elements:[{el:".screen .task2",persistentClass:"hidden1"}]},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this.questController,once:"afterCompleteTask2",delayAfter:4e3,id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask2",id:++i,talkKey:6},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask3",id:++i,talkKey:7},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3",id:++i,scrollTo:".task1",elements:[{el:".screen .task3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask3",id:++i,talkKey:8},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask4",id:++i,talkKey:9},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++i,scrollTo:".task4",elements:[{el:".screen .task4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask4",id:++i,talkKey:10},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++i,scrollTo:".task5",elements:[{el:".screen .task5",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:11},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++i,delayAfter:0,elements:[{el:".questContainer .screen1",className:"fadeOut"},{el:".questContainer .screen2",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++i,elements:[{el:".questContainer .screen1",persistentClass:"hide"},{el:".questContainer .screen2",persistentClass:"show"},{el:".screen .task8",persistentClass:"show"},{el:".screen .task9",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask6",id:++i,talkKey:12},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask6",id:++i,talkKey:13},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",id:++i,scrollTo:".task7",elements:[{el:".screen .task7",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask7",id:++i,talkKey:14},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask7",id:++i,talkKey:15},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",id:++i,scrollTo:".task8",elements:[{el:".screen .task8",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask8",id:++i,talkKey:16},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask9",id:++i,talkKey:17},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9",id:++i,scrollTo:".task9",elements:[{el:".screen .task9",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask9",id:++i,talkKey:18},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask10",id:++i,talkKey:19},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask10",id:++i,talkKey:20},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask10",id:++i,talkKey:21},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask11",id:++i,delayAfter:0,elements:[{el:".questContainer .screen2",className:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask11",id:++i,delayAfter:0,elements:[{el:".questContainer .screen2",persistentClass:"hide"},{el:".questContainer .screen3",className:"fadeIn"},{el:".questContainer .screen3",persistentClass:"show"},{el:".screen .task12.chest",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask11",id:++i,talkKey:22},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask12",id:++i,talkKey:23},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++i,scrollTo:".task12",elements:[{el:".screen3 .bg.characters",persistentClass:"hidden1"},{el:".screen .task12.characters",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask12",id:++i,talkKey:24},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++i,scrollTo:".task12",elements:[{el:".screen .task12.chest",persistentClass:"hidden1"},{el:".screen .task12.monster",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask12",id:++i,talkKey:25},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask13",id:++i,talkKey:26},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask14",id:++i,talkKey:27},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask15",id:++i,talkKey:28},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask16",id:++i,talkKey:29},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask17",id:++i,talkKey:30},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask17",id:++i,talkKey:31},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask18",id:++i,talkKey:32},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask18",id:++i,talkKey:33},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask18",id:++i,delayAfter:0,elements:[{el:".questContainer .screen3",className:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask18",id:++i,delayAfter:0,elements:[{el:".questContainer .screen3",persistentClass:"hide"},{el:".questContainer .screen4",className:"fadeIn"},{el:".questContainer .screen4",persistentClass:"show"},{el:".screen4 .task21.bush",persistentClass:"visible1"},{el:".screen4 .task21.crocodile",persistentClass:"visible1"},{el:".screen4 .task22.trunk1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask18",id:++i,talkKey:34},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask18",id:++i,talkKey:35},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++i,scrollTo:".task19",elements:[{el:".screen4 .task19",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask19",id:++i,talkKey:36},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask20",id:++i,talkKey:37},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++i,scrollTo:".task20",elements:[{el:".screen4 .characters",persistentClass:"hidden1"},{el:".screen4 .girl",persistentClass:"hidden1"},{el:".screen4 .characters2",persistentClass:"visible1"},{el:".screen4 .girl2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask21",id:++i,talkKey:38},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++i,scrollTo:".task21",elements:[{el:".screen4 .task21.bush",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask21",id:++i,talkKey:39},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask22",id:++i,talkKey:40},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask22",id:++i,talkKey:41},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",id:++i,scrollTo:".task22",elements:[{el:".screen4 .task22.trunk1",persistentClass:"hidden1"},{el:".screen4 .task22.trunk2",persistentClass:"visible1"},{el:".screen4 .task21.crocodile",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask22",id:++i,talkKey:42},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask23",id:++i,talkKey:43},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++i,scrollTo:".task23",elements:[{el:".screen4 .task23.hole",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask23",id:++i,talkKey:44},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++i,scrollTo:".task23",elements:[{el:".screen4 .task23.chest",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask30",id:++i,talkKey:45},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++i,scrollTo:".task23",elements:[{el:".screen4 .task23.admiral",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask23",id:++i,talkKey:46},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask24",id:++i,talkKey:47},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++i,scrollTo:".task24",elements:[{el:".screen4 .pirate",persistentClass:"hidden1"},{el:".screen4 .pirate2",persistentClass:"visible1"},{el:".screen4 .prize",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask31",id:++i,talkKey:48},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++i,delayAfter:0,elements:[{el:".questContainer .screen4",className:"fadeOut2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++i,delayAfter:0,elements:[{el:".questContainer .screen4",persistentClass:"hide"},{el:".questContainer .screen1",className:"fadeIn2"},{el:".questContainer .screen1",persistentClass:"visible1"},{el:".screen1 .task5",persistentClass:"hidden1"},{el:".screen1 .girl",persistentClass:"hidden1"},{el:".screen1 .pirate2",persistentClass:"visible1"},{el:".screen1 .girl2",persistentClass:"visible1"},{el:".screen1 .candybeard",persistentClass:"visible1"},{el:".screen1 .admiral",persistentClass:"visible1"},{el:".screen1 .jack",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask24",id:++i,talkKey:49},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask25",id:++i,talkKey:50},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++i,scrollTo:".task25",elements:[{el:".screen1 .jack",persistentClass:"hidden2"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask26",id:++i,talkKey:51},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this.questController,once:"afterCompleteTask26",id:++i},{type:StoryWindowElement,window:BonusWorldHandyWindow,isAvailable:function(){return t.questController.hasIncompleteTasks()},params:{world:this,title:messages[this.get("name")+"LevelPrizeTitle"][70],auxText:messages[this.get("name")+"LevelPrizeMainText"][70],otherElements:[{selector:"close okayBt",content:messages.okay}]},owner:this,once:"onFinishLevel70",id:++i},{type:StoryTalkElement,owner:this.rewardChain,once:"showRewardChain",id:++i,talkKey:52},{type:StoryTalkElement,owner:this.rewardChain,once:"showRewardChain",id:++i,talkKey:53},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize5",id:++i,talkKey:54},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize10",id:++i,talkKey:55},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize15",id:++i,talkKey:56},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize20",id:++i,talkKey:57},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize25",id:++i,talkKey:58},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize30",id:++i,talkKey:59},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize35",id:++i,talkKey:60},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize40",id:++i,talkKey:61},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize45",id:++i,talkKey:62},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize50",id:++i,talkKey:63},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize55",id:++i,talkKey:64},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize60",id:++i,talkKey:65},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize65",id:++i,talkKey:66},{type:StoryTalkElement,owner:this,once:"rewardChainBeforeTakePrize70",id:++i,talkKey:67},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:205,el:".questUi_piratesdayworld .artifactWorkshopButton.piratesdayworld",name:"piratesdayworldForce2"},{type:StoryForceElement,page:"artifacts",owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.piratesdayworld .tree .button1",name:"piratesdayworldForce4"}]}),this.addComponent(ReturnWorldComponent)}}),S5e,T5e;figureRulesProcess.additionalBonusScaleImages=(S5e=figureRulesProcess.additionalBonusScaleImages,function(){S5e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottle.d98b88fe30.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/bottleNoCork.664b215e56.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ground_bottle/mapInside.ac3e6f83b9.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranha.f4d203f692.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaDamage.b9af7e962c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaFlying.36704e13ae.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaMark.310fbe41b4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/strongbox_withgems/strongbox_xlarge.117e5ca401.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCenter.2dee3da3df.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusCorner.4c4a5415b0.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusEdge.5a1ba1b94c.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_B.b80fa28a5e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_G.608b85bf2e.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_multi.f04dbe5ea1.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_P.cd4a56d595.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_R.20a8979f3a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_W.54d7038e34.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusLife_Y.6ebfb2ab88.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusMiddle.7889ed9079.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/bar_cactus/cactusSide.670d00e885.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/special10.4d2d53708e.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(T5e=figureRulesProcess.additionalBonusClasses,function(){T5e.call(this),featuresAdder.addFeature("piratesdayworld","ground_bottle"),featuresAdder.addFeature("piratesdayworld","strongbox_withgems"),featuresAdder.addFeature("piratesdayworld","bar_cactus"),featuresAdder.addFeature("piratesdayworld","genrymorgan_jack"),FigureRules.add(".episode_piratesdayworld .fish2.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/special10.4d2d53708e.png"}),FigureRules.add(".episode_piratesdayworld .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/special10.4d2d53708e.png"}),FigureRules.add(".episode_piratesdayworld .pumpkinCell",{"background-image":""}),FigureRules.add(".episode_piratesdayworld .pumpkin",{"background-position-x":0,"background-position-y":0,"background-width":155,"background-height":162,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranha.f4d203f692.png",width:155/180*Config.cellWidth,height:.9*Config.cellHeight,"margin-left":15/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_piratesdayworld .pumpkin.stableAnimation",{spriteFrames:12,duration:1200,delay:[3600,4e3],playRound:!0}),FigureRules.add(".episode_piratesdayworld .pumpkin.pumpkinShot",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranha.f4d203f692.png",startFrame:11,spriteFrames:12,duration:1200}),FigureRules.add(".episode_piratesdayworld .pumpkin.pumpkinDamage",{animation:{params:{"margin-top":[-20/180*Config.cellWidth,-20/180*Config.cellWidth],"margin-left":[15/180*Config.cellHeight,15/180*Config.cellHeight]},duration:400},"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaDamage.b9af7e962c.png",spriteFrames:6,duration:600}),FigureRules.add(".episode_piratesdayworld .pumpkinFire",{opacity:0}),FigureRules.add(".episode_piratesdayworld .pumpkin.pumpkinDie",{animation:{params:{"margin-top":[-20/180*Config.cellWidth,-20/180*Config.cellWidth],"margin-left":[15/180*Config.cellHeight,15/180*Config.cellHeight]},duration:400},"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaDamage.b9af7e962c.png",spriteFrames:6,duration:600}),FigureRules.add(".episode_piratesdayworld .pumpkinLife",{opacity:0}),FigureRules.add(".episode_piratesdayworld .pumpkin .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":56,"background-height":11,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/lifeBlock.ee75f3f17b.png",width:56/60*Config.cellWidth,height:11/60*Config.cellHeight,"margin-left":-.05*Config.cellWidth,"margin-top":.9*Config.cellHeight}),FigureRules.add(".episode_piratesdayworld .pumpkin .lifeBar",{"background-color":"#a1ec00",width:50/60*Config.cellWidth,height:7/60*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":2/60*Config.cellHeight}),FigureRules.add(".episode_piratesdayworld .pumpkin_remove_animatePiece",{"background-position-x":0,"background-position-y":0,"background-width":155,"background-height":162,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranha.f4d203f692.png",width:155/180*Config.cellWidth,height:.9*Config.cellHeight,"margin-left":15/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_piratesdayworld .pumpkin_remove_animatePiece1.pumpkin_remove_animatePiece",{"background-position-x":0}),FigureRules.add(".episode_piratesdayworld .pumpkin_remove_animatePiece2.pumpkin_remove_animatePiece",{opacity:0}),FigureRules.add(".episode_piratesdayworld .pumpkin_remove_animatePiece3.pumpkin_remove_animatePiece",{opacity:0}),FigureRules.add(".episode_piratesdayworld .pumpkin_remove_animatePiece4.pumpkin_remove_animatePiece",{opacity:0}),FigureRules.add(".episode_piratesdayworld .attribute_key",{width:134/180*Config.cellWidth,height:106/180*Config.cellHeight,"margin-left":25/180*Config.cellWidth,"margin-top":0*Config.cellHeight,"background-width":134,"background-height":106,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaMark.310fbe41b4.png"}),FigureRules.add(".episode_piratesdayworld .cannonball",{"background-position-x":0,"background-position-y":0,"background-width":69,"background-height":59,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/piranhaFlying.36704e13ae.png",width:69/180*Config.cellWidth,height:59/180*Config.cellHeight,"margin-left":30/180*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem1",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem2",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem3",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem4",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .barCellLifeBlock .lifeGem5",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .barCell",{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_piratesdayworld .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/artifactPlatform.9da3162586.png"}),FigureRules.add(".episode_piratesdayworld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/piratesdayworld/artifactPart.a279abbb32.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_piratesdayworld .artifactPartCell.part20 .part",{frame:19})});var PiratesDayWorldRewardChainView=Backbone.View.extend({el:"#rewardChain",events:{"click .backBtn":"back","click .buyBattlePassBtn":"openBattlePass"},initialize:function(){this.render(),this.listenTo(this.model,"enter",this.update),this.listenTo(this.model,"rewardChainBeforeTakePrize",this.activatePrize),this.listenTo(this.model,"updateLevel",this.update),this.listenToOnce(this.model.get("world"),"change:hasBattlePass",this.update),this.update()},render:function(){var e=_.values(this.model.getPrizesGroupedByLevel()),n=$(".mainTemplates .invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),t=$(".mainTemplates .rewardComponentPage"),i=$(".invisible.mainTemplates .progressBarByLevel"),o=this.$el.find(".freePlate"),a=this.$el.find(".battlepassPlate");this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page);var s=t.clone(),l=i.clone();s.append(l),o.html(messages.forFree),a.html(messages[this.model.get("name")+"BattlePassTitle"]),e.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("level"+e.get("level")).addClass(e.get("type")).data("id",e.cid),a){var i=n.clone();i.addClass("level"+e.get("level")).addClass("placeholder"),s.append(i)}if("battlePass"===e.get("type")||"finalPrize"===e.get("type")){var o=r.clone();o.addClass("marker"+e.get("level")),o.html(e.get("level")),l.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.get("prize")),isGroup:!0}),s.append(t)},this)},this),this.$wrapper.append(s),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:s,mainEl:this.$("#user"),keyIntervalTime:15}),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("battlePass")&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$el.find(".background").append(this.$bpButton))},update:function(){this.model.get("prizes").forEach(function(e){var t=this.$(".rewardObject.level"+e.get("level")+"."+e.get("type")),i=this.$(".marker"+e.get("level")),o=this.$(".level"+e.get("level")+".placeholder");t.removeClass("current"),i.removeClass("current"),0<o.length&&o.removeClass("current"),this.model.isOpened(e)&&t.addClass("opened"),e.get("level")===this.model.getNextPrizeLevel()&&(i.addClass("current"),t.addClass("current"),0<o.length&&o.addClass("current"))},this),this.$bpButton.toggleClass("active",!this.model.get("battlePass").hasBattlePass()),this.updateProgressBar()},activatePrize:function(){return Promise.resolve()},updateProgressBar:function(){var e=this.$el.find(".progressBarByLevel .progressBarLineByLevel"),t=(this.model.get("world").getCurrentLevel()-10)/(this.model.get("world").get("levelsInEpisode")-10),i=90*t+10;t<0&&i<0&&(i=1),e.css("width",i+"%")},show:function(){return this.model.emit("showRewardChain",this),application.set("page","rewardChain"),this.$el.addClass("active"),$("#main .buyBattlePassBtn").toggleClass("active",!1),$("#main").show(),this.$bpButton.toggleClass("active",!this.model.get("battlePass").hasBattlePass()),this.mapController.scrollTo($(".rewardComponentMarker.current")),Promise.resolve()},openBattlePass:function(){new BuyBattlePassWindow({model:this.model.get("battlePass")})},back:function(){this.$el.removeClass("active"),application.set("page","main"),$("#main .buyBattlePassBtn").toggleClass("active",!this.model.get("battlePass").hasBattlePass())}}),SpaceWorldBlockedLevelWindow=TWindow.extend({templateClass:".bonusWorldLevelBlockedWindow_template",events:{"click .close":"close","click .action":"action"},onOpen:function(){this.$el.addClass(Config.bonusWorld.get("name")).toggleClass("opened",Boolean(this.options.opened)),this.$(".windowTitle").html(messages[Config.bonusWorld.get("name")+"LastLevel"+(this.options.opened?"Open":"Locked")+"WindowTitle"]),this.$(".windowMessage").html(messages[Config.bonusWorld.get("name")+"LastLevel"+(this.options.opened?"Open":"Locked")+"WindowMessage"])},action:function(){this.options.action&&this.options.action(),this.close()}}),SpaceWorld=BonusWorld.extend({defaults:_.defaults((_$defaults6={beginDate:new Date("2021/04/10 00:00"),name:"spaceworld",version:20210326,levelsInEpisode:12,helpWindow:!1,showFinalForce:!1,durationDays:3},_defineProperty(_$defaults6,"helpWindow",!1),_defineProperty(_$defaults6,"suggestPlayForLife",!1),_defineProperty(_$defaults6,"lastLevelOpen",!1),_defineProperty(_$defaults6,"production",!1),_defineProperty(_$defaults6,"episode",1),_defineProperty(_$defaults6,"level",1),_defineProperty(_$defaults6,"minEpisodeToEnter",2),_defineProperty(_$defaults6,"minLevelToEnter",2),_defineProperty(_$defaults6,"openDate",null),_defineProperty(_$defaults6,"closeForNew",!0),_defineProperty(_$defaults6,"allowPaid",!0),_defineProperty(_$defaults6,"allowProlong",!0),_defineProperty(_$defaults6,"prolongMaxTimes",1),_defineProperty(_$defaults6,"prizes",[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"middlePrize",level:9,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"finalPrize",level:12,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:72},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:3},{type:"gift",ids:["gift_sticker14"]}]}]),_defineProperty(_$defaults6,"lastLevelBlocked",!0),_defineProperty(_$defaults6,"starsForLastLevel",31),_$defaults6),BonusWorld.prototype.defaults),configure:function(e,t){BonusWorld.prototype.configure.call(this,e,t),this.get("init")||(this.set("init",!0),this.listenTo(application,"pinsUpdated",this.onPinsUpdated))},onCloseFinishWindow:function(){this.exit()},levelCheckAvailable:function(e,t){return e!==this.get("levelsInEpisode")||this.get("lastLevelOpen")?!this.levelLaunchStarted&&(!window.mobile&&user.get("lives")&&e===this.get("levelsInEpisode")?(this.levelLaunchStarted=!0,$(".bonusWorldBtn").removeClass("bonusWorld"),$("#main").addClass("toLastLevel"),_.delay(_.bind(function(){t(e),this.levelLaunchStarted=!1,_.delay(function(){$(".bonusWorldBtn").addClass("bonusWorld"),$("#main").removeClass("toLastLevel")},3e3)},this),3e3)):t(e),!0):(new SpaceWorldBlockedLevelWindow,!1)},onCompleteBonusWorldLevel:function(e){BonusWorld.prototype.onCompleteBonusWorldLevel.call(this,e),this.renderLastLevelIndicator()},onEnterBonusWorld:function(){BonusWorld.prototype.onEnterBonusWorld.call(this),episode.isBonusWorld()&&this.checkStars()},getBarClass:function(e){if(0<e)for(var t=[6,12,18,24,30,999],i=0;i<t.length;i++)if(e<=t[i])return"bar-"+(i+1);return"bar-0"},checkStars:function(){var e=_.reduce(episode.scores.pluck("stars"),function(e,t){return e+t},0);if(this.set("lastLevelOpen",e>=this.get("starsForLastLevel")),this.get("lastLevelOpen")&&!this.previous("lastLevelOpen")){var t=this;new SpaceWorldBlockedLevelWindow({opened:!0,action:function(){t.levelCheckAvailable(12,_.bind(gameView.start,gameView))}})}this.passedLevelNumber&&this.passedLevelNumber===this.levelsInEpisode-1&&!this.get("lastLevelOpen")&&application.once("change:page",function(){"game"!==application.get("page")&&new SpaceWorldBlockedLevelWindow});for(var i=0;i<=6;i++)$("#main").removeClass("bar-"+i);$("#main").addClass(this.getBarClass(e)),$("#main").toggleClass("caveOpen",this.get("lastLevelOpen"))},onPinsUpdated:function(){episode.get("num")===this.name&&$("#level12").on("click touchend",_.bind(function(e){e.stopPropagation(),e.preventDefault(),this.levelCheckAvailable(12,_.bind(gameView.start,gameView))},this)),this.renderLastLevelIndicator()},renderLastLevelIndicator:function(){if(episode.get("num")===this.name){var e=_.reduce(episode.scores.pluck("stars"),function(e,t){return e+t},0),t=episode.levelsInEpisode(),i=episodeView.$el.find(".levels #level".concat(t));if(0!==i.length){var o=i.find(".lastLevelEpisodeIndicator");0!==o.length&&o.remove();var a='<div>\n\t\t\t\t\t<div class="lastLevelEpisodeIndicator">\n\t\t\t\t\t\t<div class="amount">'.concat(Math.min(this.get("starsForLastLevel"),e),'</div>\n\t\t\t\t\t\t<div class="slash">/</div>\n\t\t\t\t\t\t<div class="totalAmount">').concat(this.get("starsForLastLevel"),'</div>\n\t\t\t\t\t\t<div class="icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>');i.append($(a).html())}}},onWinBonusWorldLevel:function(e){BonusWorld.prototype.onWinBonusWorldLevel.call(this,e),this.passedLevelNumber=e},openNewEpisodeWindow:function(){new NewEpisodeWindow({onClose:function(){var e=episodeView.$el.find(".levelNow");0!==e.length&&e.click()}})},renderStars:function(){this.$stars=$(".invisible .bonusWorldLastLevelStarsBlock").clone().appendTo(episodeView.$el).on("click touchend",_.bind(function(e){e.stopPropagation(),e.preventDefault(),this.onStarsClick()},this)),this.$stars.find(".requiredStars").html(this.get("lastLevelStarsNeeded"))}}),LevelPartSpitter=Artifacts.PartSpitter.extend({defaults:{chances:[{level:2,probability:1},{level:4,probability:1},{level:6,probability:1},{level:8,probability:1},{level:10,probability:1}],lowerMovesThreshold:3,generatingModel:Artifacts.WeighedPartGeneration,activationMove:0,weightAssembled:1,weightStarted:2,weightFresh:4},_onBeforeStartGame:function(e){Artifacts.PartSpitter.prototype._onBeforeStartGame.call(this,e),this.game.once("beforeWin",this._createPartBeforeWin,this)},_createPartBeforeWin:function(){if(this.workshop.get("controller").isValidWorld(episode.get("num"))&&this._isOnLevel()&&!this.isCreated()){var t=[];this.game.each(function(e){e.constructor!==Cell||e.decorator||e.attribute||t.push(e)});var e=t[_.random(0,t.length-1)],i=this.partGenerator.getPart();i&&(this.setCreated(i),this.animateThrowPart(e,i))}},_isOnLevel:function(){var e=this.workshop.get("controller").get("artifactWorkshopMinLevel"),t=this.get("chances").find(function(e){return e.level==application.level.num});return!(application.level.num!=e&&!t)&&(Math.random()<t.probability&&application.level.num>=e)}}),StoryHandlerElement=BaseEventStoryElement.extend({defaults:_.defaults({el:"#map"},BaseEventStoryElement.prototype.defaults),updateState:function(){this.get("status")===StoryStatus.complete&&this._handle(this.get("handlers"))},onActivate:function(){var e=this;return application.waitPage("main").then(function(){return e.showAnimation()})},showAnimation:function(){var e=this,t=this.get("handlers");return Promise.resolve().then(function(){e._handle(t)})},_handle:function(e){var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,a=o.target,n=o.callBack,r=o.params;if(!a||!n)return;_.bind(n,a,r)()}}catch(e){i.e(e)}finally{i.f()}}}),photosOnPage=6,photoLevels=[1,3,3,6,6,6,9,9,9,12,12,12],AlbumView=Backbone.View.extend({events:{"click .prevPageBtn":"prevPage","click .nextPageBtn":"nextPage"},initialize:function(){this.createPhotos()},createSlide:function(e){var t=$(".mainTemplates .albumSlide").clone();t.addClass("slide"+String(e+1));var i=messages[this.model.get("name")+"ClosedPhotoLabel"].replace("%level%",photoLevels[e]);t.find(".levelLabel").html(i),this.$el.append(t)},createPhotos:function(){this.currentPage=1;for(var e=0;e<photoLevels.length;e++)this.createSlide(e),this.setVisibleSlide(e+1,!1)},setVisiblePhoto:function(e,t){var i=this.$el.find(".slide"+String(e)+" .photo"),o=this.$el.find(".slide"+String(e)+" .levelLabel");t?(i.addClass("show"),o.addClass("hided")):(i.removeClass("show"),o.removeClass("hided"))},setVisibleSlide:function(e,t){var i=this.$el.find(".slide"+String(e));t?i.removeClass("hided"):i.addClass("hided")},prevPage:function(){this.updatePage(-1)},nextPage:function(){this.updatePage(1)},setPage:function(e){this.currentPage=e;for(var t=1;t<=photoLevels.length;t++)this.setVisibleSlide(t,Math.ceil(t/photosOnPage)==e);e<=1?this.$(".prevPageBtn").addClass("hided"):this.$(".prevPageBtn").removeClass("hided"),e>=Math.ceil(photoLevels.length/photosOnPage)?this.$(".nextPageBtn").addClass("hided"):this.$(".nextPageBtn").removeClass("hided")},setPageByLevel:function(e){for(var t=1,i=photoLevels.length-1;0<i;i--)if(e>photoLevels[i]){t=i;break}var o=Math.ceil(t/photosOnPage);this.setPage(o)},updatePage:function(e){if(this.currentPage){var t=Math.ceil(photoLevels.length/photosOnPage),i=Math.min(t,Math.max(1,this.currentPage+e));this.setPage(i)}}}),FirstBonusworld2View=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=this.$(".bonusWorldUI"),t=$(".mainTemplates .album").clone();e.prepend(t),this.album=new AlbumView({model:this.model,el:t})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.album.setPage(1)},showPhoto:function(e){this.album.setPage(e.pageNum),this.album.setVisiblePhoto(e.photoNum,!0)},setAlbumPageByLevel:function(e){this.album.setPageByLevel(e)}}),FirstBonusworld2ArtifactButtonView=Backbone.View.extend({events:{click:"_onClickWorkshopButton"},showAvailableNewArtifactPart:function(){this.$el.addClass("availableNewArtifactPart")},hideAvailableNewArtifactPart:function(){this.$el.removeClass("availableNewArtifactPart")},_onClickWorkshopButton:function(){this.trigger("click",this)},show:function(){this.$el.addClass("active")},hide:function(){this.$el.removeClass("active")}}),FirstBonusworld2ArtefactController=ArtifactController.extend({initialize:function(e){ArtifactController.prototype.initialize.call(this,e),this._artifactWorkshop.set("isAddPart",!0)},_initArtifactsView:function(){var e=this.getArtifactWorkshop(),t=$(".invisible.artifactWorkshopTemplate").find(".artifactWorkshopButton").clone().addClass(this.get("world").get("name"));t.appendTo(this.get("container")),this._artifactWorkshopButtonView=new FirstBonusworld2ArtifactButtonView({el:t}),this._artifactWorkshopButtonView.show(),this._artifactWorkshopButtonView.on("click",function(){setLocalStorage(this.getAvailableNewArtifactPartKey(),!1),this.checkNotify(),this.set("notify",!1);var e=this.getArtifactWorkshop().artifacts;new FirstBonusworld2ArtefactWindow({artifacts:e,world:this.get("world")}),this.trigger("openWorkshop",this)},this),e.on("receivePart",function(){setLocalStorage(this.getAvailableNewArtifactPartKey(),!0),this.checkNotify()},this),getLocalStorage(this.getAvailableNewArtifactPartKey(),!1)&&this.checkNotify()},checkNotify:function(){var e=!1;getLocalStorage(this.getAvailableNewArtifactPartKey(),!1)&&(e=!0),this.set("notify",e),this._artifactWorkshopButtonView&&(e?this._artifactWorkshopButtonView.showAvailableNewArtifactPart():this._artifactWorkshopButtonView.hideAvailableNewArtifactPart())}}),FirstBonusworld2ArtefactWindow=TWindow.extend({templateClass:".artifactwindownoborder_template",events:{"click .closeBtn":"close","click .commonBtn":"takePrizeClick"},onOpen:function(){TWindow.prototype.onOpen.call(this);var e=this.options.prefix||"",t=this.options.world.get("name");this.$el.addClass(e),this.$(".description").html(messages[t+"ArtifactWorkshopDescription"]),this.addParts(),this.renderChest(t)},renderChest:function(e){var t=this.options.artifacts.first();if(t.isAvailable())return this.$(".stateImage").addClass("availabled"),void this.$(".commonBtn").addClass("hided");t.canAssembled()&&this.$(".commonBtn").html(messages[e+"ollect"])},addParts:function(){var e=this.$(".content");e.empty();var t,i=this.options.artifacts.first(),o=_createForOfIteratorHelper(i.get("parts"));try{for(o.s();!(t=o.n()).done;){var a=t.value;a.get("amount")||i.isAvailable()?e.append('<div class="item'+a.get("id")+'"></div>'):e.append('<div class="item'+a.get("id")+' shadow"></div>')}}catch(e){o.e(e)}finally{o.f()}},takePrizeClick:function(){var e=this.options.artifacts.first();!e.isAvailable()&&e.canAssembled()&&e.getPrize()&&(e.assemble(),e.getPrize().take("artifactprize"),new Artifacts.ArtifactAssemblePrizeWindow({prize:e.getPrize(),model:e,firstPriority:!0})),this.close()}}),FirstBonusworld2=BonusWorld.extend({defaults:_.defaults({name:"firstbonusworld2",viewId:FirstBonusworld2View,version:20200904,levelsInEpisode:12,helpWindow:!1,showOpenedOnly:!0,lastLevelOpen:!0,showFinalForce:!1,durationDays:!1,maxPoints:95,production:!0,episode:1,level:3,minEpisodeToEnter:2,force:!1,minLevelToEnter:3,forceId:!0,listIndex:1,sounds:{groundexplode:"ice"},livesInstance:new BonusWorldLives,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},openDate:null,closeForNew:!1,minEpisodeToCloseForOld:4,allowPaid:!0,allowProlong:!1,allowAfterWin:!1,finishWindowInStories:!0,withoutInnerWindow:!0,actionQueue:new ActionQueue,unlimitedName:"unlimitedFirstBonusWorldLives"},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.questController=new QuestController({name:this.get("name"),tasks:[{id:1,price:1},{id:2,price:3,required:[1]},{id:3,price:3,required:[2]},{id:4,price:3,required:[3]},{id:5,price:3,required:[4]}]},this),this.questController.calcGold=function(){var e=this.get("world").get("progress"),t=0;this.tasks.forEach(function(e){e.get("complete")&&(t+=e.get("price"))}),this.set("gold",e-t)},this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!0,collectors:[new BoxPartCollector({world:this,collectNotOpened:!0})]}),this.artifactController=this.addComponent(FirstBonusworld2ArtefactController,{world:this,artifactWorkshopMinLevel:2,container:"#map .questUi.questUi_firstbonusworld2",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3]},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.BoxPartDroppper({chances:{2:100},movesOrder:"straight",generatingModel:Artifacts.WeighedPartGeneration,rule:function(){return-1!==[4,6,8,10].indexOf(t.getCurrentLevel())}}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5}],artifacts:[{id:1,parts:[1,2,3,4,5],cooldown:10,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",amount:2},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]}]}}});var i=0;this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"enter",id:++i,elements:[{el:".questContainer .screen1",persistentClass:"show"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++i},{type:StoryTalkElement,owner:this,once:"enter",id:++i,talkKey:1},{type:StoryForceElement,owner:this,once:"enter",id:++i,el:".questUi_firstbonusworld2 .completeTask",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask1",id:++i,talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++i,elements:[{el:".bonusWorldUI.firstbonusworld2 .album",persistentClass:"active"}]},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask1",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:1}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo1"},once:"afterCompleteTask1",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask1",id:++i,talkKey:3},{type:StoryForceElement,owner:this.questController,once:"afterCompleteTask1",id:++i,el:".questUi_firstbonusworld2 .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:49,el:".artifactWorkshopButton.firstbonusworld2",name:this.get("name")+"Force2"},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask2",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:2}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo2"},once:"afterCompleteTask2",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask2",id:++i,talkKey:4},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask2",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:3}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo3"},once:"afterCompleteTask2",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask2",id:++i,talkKey:5},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask3",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:4}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo4"},once:"afterCompleteTask3",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask3",id:++i,talkKey:6},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask3",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:5}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo5"},once:"afterCompleteTask3",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask3",id:++i,talkKey:7},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask3",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:1,photoNum:6}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo6"},once:"afterCompleteTask3",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask3",id:++i,talkKey:8},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask4",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:7}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo7"},once:"afterCompleteTask4",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask4",id:++i,talkKey:9},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask4",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:8}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo8"},once:"afterCompleteTask4",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask4",id:++i,talkKey:10},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask4",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:9}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo9"},once:"afterCompleteTask4",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask4",id:++i,talkKey:11},{type:StoryForceElement,owner:this,once:"onFinishLevel10",id:++i,el:".artifactWorkshopButton.firstbonusworld2",name:this.get("name")+"Force3"},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask5",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:10}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo10"},once:"afterCompleteTask5",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:12},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask5",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:11}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo11"},once:"afterCompleteTask5",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:13},{type:StoryHandlerElement,owner:this.questController,once:"afterCompleteTask5",id:++i,handlers:[{target:this,callBack:this.showPhoto,params:{pageNum:2,photoNum:12}}]},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this.questController,params:{world:this,picture:"photo12"},once:"afterCompleteTask5",id:++i},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:14},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++i,elements:[{el:".bonusWorldUI.firstbonusworld2 .album",cleanClass:"active"},{el:".questContainer .screen1",cleanClass:"show"},{el:".questContainer .screen2",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:15},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask5",id:++i,talkKey:16},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:[{type:"coins",name:"coins",cssClass:"coins",amount:150},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12}]},owner:this.questController,on:"afterCompleteTask5",id:++i}]})},configure:function(e){BonusWorld.prototype.configure.call(this,e),!e&&this.isAvailableToEnter()&&new BonusWorldForce({world:this}),this.get("init")||(this.set("init",!0),this.get("livesInstance").set("lifeRestoreTime",900))},isAvailableToEnter:function(){var e=this.get("minLevelToEnter"),t=this.get("minEpisodeToCloseForOld");return this.bonusWorldFinishTime||user.getRealLevel()>=e&&user.get("episode")<t},checkAllNotifies:function(){!this.bonusWorldFinishTime&&user.get("episode")>=this.get("minEpisodeToCloseForOld")||this.isFinished()?this.set("notify",!1):BonusWorld.prototype.checkAllNotifies.call(this)},showPhoto:function(e){this.view.showPhoto(e)},onEnterBonusWorld:function(){BonusWorld.prototype.onEnterBonusWorld.call(this),this.view.setAlbumPageByLevel(this.get("progress"))},onCloseFinishWindow:function(){this.get("allowAfterWin")||Config.bonusWorld.exit()}}),p9e;figureRulesProcess.firstbonusworld2BonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(p9e=figureRulesProcess.additionalBonusClasses,function(){p9e.call(this),figureRulesProcess.firstbonusworld2BonusClasses()});var NewYear2020WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.lawn=$('<div class="homeLawnBg"></div>'),this.decorations=$('<div class="decorations"></div>'),this.characters=$('<div class="characters decor"></div>'),this.santa=$('<div class="santa decor"></div>'),this.lawn.append(this.decorations),this.lawn.append(this.characters),this.lawn.append(this.santa),this.$el.append(this.lawn)},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("afterRegattaLineCrossedAtLevel100",this.updateBackground,this),this.model.on("change:costumes change:decorations",this.updateDecorations,this),this.updateDecorations()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("change:costumes change:decorations",this.updateDecorations,this)},updateDecorations:function(){for(var e=0;e<=3;++e)this.$el.removeClass("costumes_"+e),this.$el.removeClass("decorations_"+e);this.$el.addClass("costumes_"+this.model.get("costumes")),this.$el.addClass("decorations_"+this.model.get("decorations"))}}),NewYear2020World=BonusWorld.extend({defaults:_.defaults((_$defaults7={listIndex:3,name:"newyear2020world",viewId:NewYear2020WorldView,version:20201202,endDate:new Date("2021-02-12T12:00:00"),production:!0,levelsInEpisode:100,durationDays:!1,withoutInnerWindow:!0,helpWindow:!1,showFinalForce:!0},_defineProperty(_$defaults7,"helpWindow",!1),_defineProperty(_$defaults7,"episode",1),_defineProperty(_$defaults7,"level",2),_defineProperty(_$defaults7,"minEpisodeToEnter",2),_defineProperty(_$defaults7,"minLevelToEnter",2),_defineProperty(_$defaults7,"forceId",!0),_defineProperty(_$defaults7,"closeForNew",!0),_defineProperty(_$defaults7,"allowAfterWin",!0),_defineProperty(_$defaults7,"allowPaid",!0),_defineProperty(_$defaults7,"allowProlong",!1),_defineProperty(_$defaults7,"prolongMaxTimes",1),_defineProperty(_$defaults7,"actionQueue",new ActionQueue),_defineProperty(_$defaults7,"finishWindowInStories",!0),_defineProperty(_$defaults7,"livesInstance",new BonusWorldLives),_defineProperty(_$defaults7,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives",amount:2}]),_defineProperty(_$defaults7,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults7,"sounds",{narrator:!1,pirate1:!1,pirate2:!1,pirate3:!1,pirate4:!1,pirate5:!1,pirate6:!1,girl1:!1,girl2:!1,girl3:!1,girl4:!1,grandfather1:!1,grandfather2:!1,grandfather3:!1,charon1:!1,charon2:!1,charon3:!1,charon4:!1,monsters1:!1,candybeard1:!1,candybeard2:!1,candybeard3:!1}),_defineProperty(_$defaults7,"unlimitedName","unlimitedBonusWorldLives"),_defineProperty(_$defaults7,"prizes",[]),_$defaults7),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e);var t="unlimitedBonusWorldLives";this.battlePass=new BattlePass({world:this}),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell}]}},{place:"consolation",prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:43200,goodId:GoodTypes.starInField}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:28800,goodId:GoodTypes.starInField}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:14400,goodId:GoodTypes.starInField}]}},{place:"consolation",prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1200},{type:"GoodProduct",addTime:43200,goodId:GoodTypes.addThreeMoves},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:800},{type:"GoodProduct",addTime:28800,goodId:GoodTypes.addThreeMoves},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:14400,goodId:GoodTypes.addThreeMoves},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}},{place:"consolation",prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1700},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:129600,goodId:"unlimitedLifes"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:1200},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:129600,goodId:"unlimitedLifes"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:700},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:86400,goodId:"unlimitedLifes"}]}},{place:"consolation",prize:{products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:7200,goodId:"unlimitedLifes"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:4,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:1800,goodId:t}]},{level:9,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:7200,goodId:t}]},{level:19,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves}]},{level:24,type:"middlePrize",products:[{type:"ExactArtifactPartProduct",partId:12,amount:1},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:3600,goodId:t}]},{level:29,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:3600,goodId:t}]},{level:34,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField}]},{level:44,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:t},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]},{level:49,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves}]},{level:54,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]},{level:59,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:1800,goodId:t}]},{level:69,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]},{level:74,type:"middlePrize",products:[{type:"GoodProduct",addTime:10800,goodId:GoodTypes.starInField},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:10800,goodId:GoodTypes.addThreeMoves}]},{level:79,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.Shuffle}]},{level:84,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:14400,goodId:t}]},{level:94,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:7200,goodId:t}]},{level:5,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:7200,goodId:t},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField}]},{level:10,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:7200,goodId:t},{type:"ExactArtifactPartProduct",partId:5,amount:1}]},{level:15,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:14400,goodId:t}]},{level:20,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:14400,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:7200,goodId:t},{type:"CoinsProduct",amount:100}]},{level:25,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:3600,goodId:t},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField},{type:"CoinsProduct",amount:200}]},{level:30,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:10800,goodId:t}]},{level:35,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:14400,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:7200,goodId:t},{type:"CoinsProduct",amount:200}]},{level:40,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:3600,goodId:t},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves},{type:"CoinsProduct",amount:100}]},{level:45,type:"battlePass",products:[{type:"GoodProduct",addTime:7200,goodId:t},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField}]},{level:50,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:3600,goodId:t},{type:"CoinsProduct",amount:100}]},{level:55,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:t},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves}]},{level:60,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:t},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]},{level:65,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:1800,goodId:t},{type:"CoinsProduct",amount:100}]},{level:70,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:1800,goodId:t},{type:"CoinsProduct",amount:100}]},{level:75,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:3600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:1800,goodId:t},{type:"CoinsProduct",amount:200}]},{level:80,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:1800,goodId:t}]},{level:85,type:"battlePass",products:[{type:"ExactArtifactPartProduct",partId:24,amount:1},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:1800,goodId:t},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.addThreeMoves}]},{level:90,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:7200,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:1800,goodId:t}]},{level:95,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:7200,goodId:t},{type:"GoodProduct",addTime:14400,goodId:GoodTypes.starInField},{type:"CoinsProduct",amount:200}]},{level:100,type:"battlePass",products:[{type:"GoodProduct",addTime:259200,goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.starInField},{type:"SpinProduct",amount:4},{type:"CoinsProduct",amount:1200}]}]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".regatta-newyear2020world .scrollWrapper",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3]},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.PartDropper({chances:{15:55,7:55},generatingModel:Artifacts.WeighedPartGeneration}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20},{id:21},{id:22},{id:23},{id:24}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:50},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:50},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:2}]},{id:6,parts:[21,22,23,24],cooldown:3600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"spins",amount:1}]},{id:7,type:"finish",relative:[1,2,3,4,5,6],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:3},{type:"spins",amount:1},{type:"good",name:"addThreeMoves",amount:12}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,fixed:!0,artifacts:[7]}]}}});var i=0;this.storyController=new StoryController({name:this.name,world:this,stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++i,elements:[{el:".homeLawnBg",persistentClass:"active"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:207,el:"#main",elements:[{el:".regatta-newyear2020world",persistentClass:"firstScreen"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:++i},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++i,talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++i,elements:[{el:".homeLawnBg .characters",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++i,talkKey:2},{type:BaseStoryWindowElement,window:BonusWorldSelectOptionWindow,params:{world:this,optionId:"costumes"},owner:this,once:"beforeEnter",id:++i},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++i,talkKey:3},{type:BaseStoryWindowElement,window:BonusWorldSelectOptionWindow,params:{world:this,optionId:"decorations"},owner:this,once:"beforeEnter",id:++i},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++i,talkKey:4},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++i,elements:[{el:".homeLawnBg .santa",persistentClass:"visible"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++i,talkKey:5},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++i,elements:[{el:".homeLawnBg",persistentClean:"active"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:208,el:"#main",elements:[{el:".regatta-newyear2020world",persistentClean:"firstScreen"}]},{type:StoryForceElement,owner:this,once:"beforeEnter",id:++i,el:".regattaStartBtn",name:"newyear2020worldForce0"},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"onFinishLevel1",id:++i},{type:StoryTalkElement,owner:this,once:"onFinishLevel1",id:++i,talkKey:6},{type:StoryTalkElement,owner:this,once:"onFinishLevel1",id:++i,talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",id:++i,talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:++i,talkKey:9},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:++i,talkKey:10},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",id:++i,talkKey:11},{type:StoryTalkElement,owner:this,once:"onFinishLevel6",id:++i,talkKey:12},{type:StoryTalkElement,owner:this,once:"onFinishLevel7",id:++i,talkKey:13},{type:StoryTalkElement,owner:this,once:"onFinishLevel8",id:++i,talkKey:14},{type:StoryTalkElement,owner:this,once:"onFinishLevel9",id:++i,talkKey:15},{type:StoryTalkElement,owner:this,once:"onFinishLevel10",id:++i,talkKey:16},{type:StoryTalkElement,owner:this,once:"onFinishLevel11",id:++i,talkKey:17},{type:StoryTalkElement,owner:this,once:"onFinishLevel13",id:++i,talkKey:18},{type:StoryTalkElement,owner:this,once:"onFinishLevel14",id:++i,talkKey:19},{type:StoryTalkElement,owner:this,once:"onFinishLevel14",id:++i,talkKey:20},{type:StoryTalkElement,owner:this,once:"onFinishLevel15",id:++i,talkKey:21},{type:StoryTalkElement,owner:this,once:"onFinishLevel16",id:++i,talkKey:22},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",id:++i,talkKey:23},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,id:++i,params:{world:this,picture:"dialoguePicture_3",auxText:messages.skipInfoText},once:"onFinishLevel17"},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",id:++i,talkKey:24},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,id:++i,params:{world:this,picture:"dialoguePicture_4",auxText:messages.skipInfoText},once:"onFinishLevel17"},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",id:++i,talkKey:25},{type:StoryTalkElement,owner:this,once:"onFinishLevel18",id:++i,talkKey:26},{type:StoryTalkElement,owner:this,once:"onFinishLevel19",id:++i,talkKey:27},{type:StoryTalkElement,owner:this,once:"onFinishLevel20",id:++i,talkKey:28},{type:StoryTalkElement,owner:this,once:"onFinishLevel23",id:++i,talkKey:29},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:++i,talkKey:30},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:++i,talkKey:31},{type:StoryTalkElement,owner:this,once:"onFinishLevel26",id:++i,talkKey:32},{type:StoryTalkElement,owner:this,once:"onFinishLevel28",id:++i,talkKey:33},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:++i,talkKey:34},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:++i,talkKey:35},{type:StoryTalkElement,owner:this,once:"onFinishLevel31",id:++i,talkKey:36},{type:StoryTalkElement,owner:this,once:"onFinishLevel33",id:++i,talkKey:37},{type:StoryTalkElement,owner:this,once:"onFinishLevel34",id:++i,talkKey:38},{type:StoryTalkElement,owner:this,once:"onFinishLevel34",id:++i,talkKey:39},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place1",id:++i,talkKey:40},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place2",id:++i,talkKey:41},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place3",id:++i,talkKey:42},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35NotPrize",id:++i,talkKey:43},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel35",id:++i,talkKey:44},{type:StoryTalkElement,owner:this,once:"onFinishLevel38",id:++i,talkKey:45},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:++i,talkKey:46},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:++i,talkKey:47},{type:StoryTalkElement,owner:this,once:"onFinishLevel42",id:++i,talkKey:48},{type:StoryTalkElement,owner:this,once:"onFinishLevel43",id:++i,talkKey:49},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:++i,talkKey:50},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:++i,talkKey:51},{type:StoryTalkElement,owner:this,once:"onFinishLevel45",id:++i,talkKey:52},{type:StoryTalkElement,owner:this,once:"onFinishLevel46",id:++i,talkKey:53},{type:StoryTalkElement,owner:this,once:"onFinishLevel47",id:++i,talkKey:54},{type:StoryTalkElement,owner:this,once:"onFinishLevel48",id:++i,talkKey:55},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:++i,talkKey:56},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:++i,talkKey:57},{type:StoryTalkElement,owner:this,once:"onFinishLevel50",id:++i,talkKey:58},{type:StoryTalkElement,owner:this,once:"onFinishLevel53",id:++i,talkKey:59},{type:StoryTalkElement,owner:this,once:"onFinishLevel54",id:++i,talkKey:60},{type:StoryTalkElement,owner:this,once:"onFinishLevel54",id:++i,talkKey:61},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place1",id:++i,talkKey:62},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place2",id:++i,talkKey:63},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place3",id:++i,talkKey:64},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55NotPrize",id:++i,talkKey:65},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel55",id:++i,talkKey:66},{type:StoryTalkElement,owner:this,once:"onFinishLevel56",id:++i,talkKey:67},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,id:++i,params:{world:this,picture:"dialoguePicture_2",auxText:messages.skipInfoText},once:"onFinishLevel56"},{type:StoryTalkElement,owner:this,once:"onFinishLevel57",id:++i,talkKey:68},{type:StoryTalkElement,owner:this,once:"onFinishLevel58",id:++i,talkKey:69},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:++i,talkKey:70},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:++i,talkKey:71},{type:StoryTalkElement,owner:this,once:"onFinishLevel61",id:++i,talkKey:72},{type:StoryTalkElement,owner:this,once:"onFinishLevel63",id:++i,talkKey:73},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:++i,talkKey:74},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:++i,talkKey:75},{type:StoryTalkElement,owner:this,once:"onFinishLevel66",id:++i,talkKey:76},{type:StoryTalkElement,owner:this,once:"onFinishLevel68",id:++i,talkKey:77},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:++i,talkKey:78},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:++i,talkKey:79},{type:StoryTalkElement,owner:this,once:"onFinishLevel71",id:++i,talkKey:80},{type:StoryTalkElement,owner:this,once:"onFinishLevel72",id:++i,talkKey:81},{type:StoryTalkElement,owner:this,once:"onFinishLevel73",id:++i,talkKey:82},{type:StoryTalkElement,owner:this,once:"onFinishLevel74",id:++i,talkKey:83},{type:StoryTalkElement,owner:this,once:"onFinishLevel74",id:++i,talkKey:84},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place1",id:++i,talkKey:85},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place2",id:++i,talkKey:86},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place3",id:++i,talkKey:87},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75NotPrize",id:++i,talkKey:88},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel75",id:++i,talkKey:89},{type:StoryTalkElement,owner:this,once:"onFinishLevel76",id:++i,talkKey:90},{type:StoryTalkElement,owner:this,once:"onFinishLevel78",id:++i,talkKey:91},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:++i,talkKey:92},{type:StoryTalkElement,owner:this,once:"onFinishLevel81",id:++i,talkKey:93},{type:StoryTalkElement,owner:this,once:"onFinishLevel82",id:++i,talkKey:94},{type:StoryTalkElement,owner:this,once:"onFinishLevel83",id:++i,talkKey:95},{type:StoryTalkElement,owner:this,once:"onFinishLevel84",id:++i,talkKey:96},{type:StoryTalkElement,owner:this,once:"onFinishLevel84",id:++i,talkKey:97},{type:StoryTalkElement,owner:this,once:"onFinishLevel87",id:++i,talkKey:98},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,id:++i,params:{world:this,picture:"dialoguePicture_1",auxText:messages.skipInfoText},once:"onFinishLevel87"},{type:StoryTalkElement,owner:this,once:"onFinishLevel88",id:++i,talkKey:99},{type:StoryTalkElement,owner:this,once:"onFinishLevel95",id:++i,talkKey:100},{type:StoryTalkElement,owner:this,once:"onFinishLevel96",id:++i,talkKey:101},{type:StoryTalkElement,owner:this,once:"onFinishLevel98",id:++i,talkKey:102},{type:StoryTalkElement,owner:this,once:"onFinishLevel99",id:++i,talkKey:103},{type:StoryTalkElement,owner:this,once:"onFinishLevel99",id:++i,talkKey:104},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place1",id:++i,talkKey:105},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place2",id:++i,talkKey:106},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place3",id:++i,talkKey:107},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100NotPrize",id:++i,talkKey:108},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++i,talkKey:109},{type:StoryAnimationElement,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++i,elements:[{el:".homeLawnBg",persistentClass:"active"}]},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++i,talkKey:110},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++i},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.newyear2020world",name:"newyear2020worldForce1"},{type:StoryForceElement,owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.newyear2020world .tree .button1",name:"newyear2020worldForce2"},{type:StoryForceElement,owner:this.artifactController,once:"canCollectArtifact",id:203,el:"#artifactWorkshopButton",name:"newyear2020worldForce3",isAvailable:function(e,t){return e.findSlotByArtifact(t)}}]},{actionQueue:this.get("actionQueue")})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.storyController.configure(e))}}),E9e,F9e;figureRulesProcess.newyear2020worldBonusClasses=function(){FigureRules.add(".episode_newyear2020world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/artifactPlatform.png"}),FigureRules.add(".episode_newyear2020world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/newyear2020world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part9 .part",{frame:9}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part10 .part",{frame:10}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part11 .part",{frame:8}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part21 .part",{frame:20}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part22 .part",{frame:21}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part23 .part",{frame:22}),FigureRules.add(".episode_newyear2020world .artifactPartCell.part24 .part",{frame:23}),FigureRules.add(".episode_newyear2020world .attribute_coin",{"background-image":"../../../gems/site/img/features/newyear2020world/christmasCandy.png","background-width":84,"background-height":120,width:84/180*Config.cellWidth,height:120/180*Config.cellHeight,x:48/180*Config.cellWidth,y:-5/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .coinChestHeadCell",{"background-image":"../../../gems/site/img/features/newyear2020world/coinChest_large.png"}),FigureRules.add(".episode_newyear2020world .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/candySafe.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .strongboxCell.closed .strongboxBg.stable",{frame:0}),FigureRules.add(".episode_newyear2020world .strongboxCell.opened .strongboxBg.stable",{frame:5}),FigureRules.add(".episode_newyear2020world .strongboxCell.animateOpening .strongboxBg.stable",{spriteFrames:6,duration:700}),FigureRules.add(".episode_newyear2020world .strongboxCell.animateClosing .strongboxBg.stable",{startFrame:7,spriteFrames:4,duration:500}),FigureRules.add(".episode_newyear2020world .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:10,spriteFrames:10,duration:800}),FigureRules.add(".episode_newyear2020world .strongboxCellLoot",{"background-position-x":0,"background-width":243,"background-height":312,width:1.35*Config.cellWidth,height:312/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/candySafeCollectItem.png","margin-left":-35/180*Config.cellWidth,"margin-top":-100/180*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .fishBallCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/mysteryBall_xlarge.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:6,framesOrder:[0,1,2,3,4,5],delay:[2e3,4e3],duration:600,playRound:!0}),FigureRules.add(".episode_newyear2020world .fishBallCell.powerUpHighlight",{animation:{params:{"margin-top":[-0*Config.cellHeight,-24/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallAngry",{startFrame:6,spriteFrames:8,duration:600,playRound:!1}),FigureRules.add(".episode_newyear2020world .fishBallCell.create",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/mysteryBall_xlarge.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:14,duration:800,playRound:!1}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallDie",{startFrame:14,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallFly",{startFrame:19,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_newyear2020world .fishBallCell .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallDie .lifeBlock, .episode_newyear2020world .fishBallCell.fishBallFly .lifeBlock, .episode_newyear2020world .fishBallCell.create .lifeBlock",{opacity:0}),FigureRules.add(".episode_newyear2020world .fishBallCell .life",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallLevel2 .life",{"background-color":"#ffff00"}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallLevel1 .life",{"background-color":"#f2342c"}),FigureRules.add(".episode_newyear2020world .fishBallCell.fishBallStartLevel2.fishBallLevel2 .life",{"background-color":"#a1ec00"}),FigureRules.add(".episode_newyear2020world .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/newyear2020world/yetiStable.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:750,playRound:!0,delay:[1e3,3e3]}),FigureRules.add(".episode_newyear2020world .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/newyear2020world/yetiDamaged.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500}),FigureRules.add(".episode_newyear2020world .alligatorSpecial",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/newyear2020world/yetiStable.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,playRound:!0,animation:{params:{width:[2*Config.cellWidth,.5*Config.cellWidth],height:[2*Config.cellHeight,.5*Config.cellHeight],"margin-left":[0,.75*Config.cellWidth],"margin-top":[0,.75*Config.cellHeight],opacity:[1,0]},duration:800}}),FigureRules.add(".episode_newyear2020world .alligatorLifeBlock",{"margin-top":100/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/ice1.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2020world .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/ice2.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2020world .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/ice3.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".floorLevelAnimation1",{"background-position-x":0,"background-position-y":0,"background-width":113,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png",width:113/60*Config.cellWidth,height:3.3*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-26/60*Config.cellHeight,spriteFrames:4,duration:350}),FigureRules.add(".episode_newyear2020world .decorator_chocolate.stable",{"background-position-x":1035,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"../../../gems/site/img/features/newyear2020world/iceCubeAppear.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":-89/180*Config.cellWidth,"margin-top":-73/180*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"../../../gems/site/img/features/newyear2020world/iceCubeAppear.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":-89/180*Config.cellWidth,"margin-top":-73/180*Config.cellHeight,spriteFrames:3,duration:300}),FigureRules.add(".episode_newyear2020world .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"../../../gems/site/img/features/newyear2020world/iceCubeAnnihilation.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_newyear2020world .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/garment1.png"}),FigureRules.add(".episode_newyear2020world .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/garment2.png"}),FigureRules.add(".episode_newyear2020world .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/garment3.png"}),FigureRules.add(".episode_newyear2020world .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/garment4.png"}),FigureRules.add(".episode_newyear2020world .stable.decorator_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceMove.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,delay:[1,2],playRound:!1}),FigureRules.add(".episode_newyear2020world .decorator_crabIce.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceDie.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,duration:300}),FigureRules.add(".episode_newyear2020world .decorator_crabIce.magicCrabIce",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceMagic.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:3,duration:300}),FigureRules.add(".episode_newyear2020world .move_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceMove.png",width:Config.cellWidth,height:Config.cellHeight,spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".episode_newyear2020world .decorator_crabIce_remove_animatePiece1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceParts.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2020world .decorator_crabIce_remove_animatePiece2",{"background-position-x":180,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceParts.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2020world .decorator_crabIce_remove_animatePiece3",{"background-position-x":360,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/crabIceParts.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_newyear2020world .decorator_crabIce .life, .episode_newyear2020world .move_crabIce .life",{font:"bold "+16/60*Config.cellWidth+"px/"+.3*Config.cellWidth+"px Marvin",color:"#000000","text-left":25/60*Config.cellWidth,"text-top":.8*Config.cellWidth}),FigureRules.add(".episode_newyear2020world .decorator_crabIce.magicCrabIce .life",{"text-left":.425*Config.cellWidth}),FigureRules.add(".episode_newyear2020world .fireFlowerFireBg.run",{"background-width":125,"background-height":140,"background-position-x":0,"background-position-y":0,width:125/180*Config.cellWidth,height:140/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":-8/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/fireFlowerFire.png",spriteFrames:12,duration:1200,playRound:!0}),FigureRules.add(".episode_newyear2020world .fireFlowerFireballExplosion",{"background-image":""}),FigureRules.add(".episode_newyear2020world .fireFlowerFireball.run",{"background-position-x":0,"background-position-y":0,"background-image":"../../../gems/site/img/features/newyear2020world/fireFlowerFireball.png","background-width":158,"background-height":146,"margin-left":5/60*Config.cellWidth,"margin-top":5/60*Config.cellHeight,width:158/180*Config.cellWidth,height:146/180*Config.cellHeight,spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".episode_newyear2020world .fireFlowerExplosion.run",{"background-position-x":0,"background-position-y":0,"background-image":"../../../gems/site/img/features/newyear2020world/fireFlowerExplosion.png","background-width":311,"background-height":295,"margin-left":-66/180*Config.cellWidth,"margin-top":-40/180*Config.cellHeight,width:311/180*Config.cellWidth,height:295/180*Config.cellHeight,spriteFrames:7,duration:700,playRound:!1}),FigureRules.add(".episode_newyear2020world .decorator_crabMedusa.special",{"background-position-x":0,"background-position-y":0,"background-width":187,"background-height":180,width:187/180*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/snail.png","margin-top":0,spriteFrames:5,framesOrder:[0,1,2,3,4],duration:500,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_newyear2020world .move_crabMedusa.special",{"background-position-x":0,"background-position-y":0,"background-width":187,"background-height":180,width:187/180*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/snail.png",startFrame:9,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .move_crabMedusa.special.delay",{"background-position-x":0,"background-position-y":0,"background-width":187,"background-height":180,width:187/180*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/snail.png",spriteFrames:5,framesOrder:[5,6,7,8,9],duration:250,playRound:!1}),FigureRules.add(".episode_newyear2020world .die_crabMedusa.special",{"background-width":187,"background-height":180,width:187/180*Config.cellWidth,height:Config.cellHeight,"background-image":"../../../gems/site/img/features/newyear2020world/snail.png"}),FigureRules.add(".episode_newyear2020world .crabMedusaMovesBlock .crabMedusaMoves",{opacity:0}),FigureRules.add(".episode_newyear2020world .lighthouseHeadCell",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":""}),FigureRules.add(".episode_newyear2020world .lighthouseBg",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png"}),FigureRules.add(".episode_newyear2020world .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .lighthouseBg.lighthouseAngry",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,1,0],duration:500,playRound:!1}),FigureRules.add(".episode_newyear2020world .less50PercentLife .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .less50PercentLife .lighthouseBg.lighthouseAngry",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:5,framesOrder:[0,1,2,1,0],duration:500,playRound:!1}),FigureRules.add(".episode_newyear2020world .less25PercentLife .lighthouseBg.stable",{"background-position-x":0,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .less0PercentLife .lighthouseBg.stable",{"background-position-x":720,"background-position-y":0,width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouse.png","margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .lighthouseFly",{"background-position-x":720,"background-position-y":0,"background-width":360,"background-height":540,"background-image":"../../../gems/site/img/features/newyear2020world/lighthouseDone.png",width:2*Config.cellWidth,height:3*Config.cellHeight,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[3*Config.cellHeight,.8*Config.cellHeight],"margin-left":[0*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[0*Config.cellHeight,1.1*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_newyear2020world .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":260,"background-image":"../../../gems/site/img/features/newyear2020world/deer_xlarge.png",width:206/180*Config.cellWidth,height:260/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-.25*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .pastureCell.life2 .attribute_animal",{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":260,"background-image":"../../../gems/site/img/features/newyear2020world/deerDark_xlarge.png",width:206/180*Config.cellWidth,height:260/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-.25*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .attribute_animal.animateCollect",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/newyear2020world/deerFlying.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variantbig1",{"background-image":"../../../gems/site/img/features/newyear2020world/treasurebig1.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variantbig2",{"background-image":"../../../gems/site/img/features/newyear2020world/treasurebig2.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variantbig3",{"background-image":"../../../gems/site/img/features/newyear2020world/treasurebig3.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/newyear2020world/treasure1.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/newyear2020world/treasure2.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/newyear2020world/treasure3.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/newyear2020world/treasure1.png"}),FigureRules.add(".episode_newyear2020world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/newyear2020world/treasure2.png"}),FigureRules.add(".episode_newyear2020world .giftboxCell.cell",{"background-image":""}),FigureRules.add(".episode_newyear2020world .giftboxCellBg",{"background-position-y":0,"background-width":73,"background-height":76,"background-image":"../../../gems/site/img/features/newyear2020world/boxRed.png",width:73/60*Config.cellWidth,height:76/60*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":-16/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .giftboxLevel1 .giftboxCellBg",{"background-position-x":438}),FigureRules.add(".episode_newyear2020world .giftboxLevel1 .giftboxCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .giftboxLevel2 .giftboxCellBg",{"background-position-x":219}),FigureRules.add(".episode_newyear2020world .giftboxLevel2 .giftboxCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .giftboxLevel3 .giftboxCellBg",{"background-position-x":0}),FigureRules.add(".episode_newyear2020world .giftboxLevel3 .giftboxCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_newyear2020world .giftboxCellCage",{opacity:0}),FigureRules.add(".episode_newyear2020world .giftboxChangeLevel2 .giftboxCellBg.stable",{spriteFrames:4,duration:400,playRound:!1}),FigureRules.add(".episode_newyear2020world .giftboxChangeLevel1 .giftboxCellBg.stable",{spriteFrames:4,duration:400,framesOrder:[3,4,5,6],playRound:!1}),FigureRules.add(".episode_newyear2020world .giftboxChangeLevel0 .giftboxCellBg.stable",{spriteFrames:4,duration:400,framesOrder:[6,7,8,9],playRound:!1}),FigureRules.add(".episode_newyear2020world .giftbox",{"background-position-x":657,"background-position-y":0,"background-width":73,"background-height":76,"background-image":"../../../gems/site/img/features/newyear2020world/boxRed.png",width:73/60*Config.cellWidth,height:76/60*Config.cellHeight,"margin-left":-.1*Config.cellWidth,"margin-top":-16/60*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .decoration_2 .giftboxCellBg",{"background-image":"../../../gems/site/img/features/newyear2020world/boxYellow.png"}),FigureRules.add(".episode_newyear2020world .decoration_3 .giftboxCellBg",{"background-image":"../../../gems/site/img/features/newyear2020world/boxBlue.png"}),FigureRules.add(".episode_newyear2020world .giftbox.decoration_2",{"background-image":"../../../gems/site/img/features/newyear2020world/boxYellow.png"}),FigureRules.add(".episode_newyear2020world .giftbox.decoration_3",{"background-image":"../../../gems/site/img/features/newyear2020world/boxBlue.png"}),FigureRules.add(".episode_newyear2020world .gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fish3.png"}),FigureRules.add(".episode_newyear2020world .gravityGroundCell.gravityGroundLife2",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fish2.png"}),FigureRules.add(".episode_newyear2020world .gravityGroundCell.gravityGroundLife1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fish3.png"}),FigureRules.add(".episode_newyear2020world .groundLife2.gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fish2.png"}),FigureRules.add(".episode_newyear2020world .groundLife3.gravityGroundCell",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fish1.png"}),FigureRules.add(".episode_newyear2020world .gravityGroundCell.explode",{spriteFrames:1,duration:1}),FigureRules.add(".episode_newyear2020world .attribute_ground",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fishAttribute2.png","margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,scale:1}),FigureRules.add(".episode_newyear2020world .gravityGroundLife3 .attribute_ground",{opacity:0}),FigureRules.add(".episode_newyear2020world .groundLife3 .attribute_ground",{opacity:0}),FigureRules.add(".episode_newyear2020world .gravityGroundLife2 .attribute_ground",{opacity:1}),FigureRules.add(".episode_newyear2020world .gravityGroundLife1 .attribute_ground",{opacity:1}),FigureRules.add(".episode_newyear2020world .gravityGroundLife1 .attribute_ground",{"background-image":"../../../gems/site/img/features/newyear2020world/fishAttribute1.png"}),FigureRules.add(".episode_newyear2020world .life1 .attribute_ground",{"background-image":"../../../gems/site/img/features/newyear2020world/fishAttribute1.png"}),FigureRules.add(".episode_newyear2020world .attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".episode_newyear2020world .attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".episode_newyear2020world .attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".episode_newyear2020world .attribute_ground.flying",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/fishFlying.png","margin-left":-4/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,scale:1}),FigureRules.add(".episode_newyear2020world .gravityGroundExplode1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/jelly.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .gravityGroundExplode2",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/jelly.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .gravityGroundExplode1",{width:1*Config.cellWidth,height:1*Config.cellHeight,"background-width":195,"background-height":192,"background-image":"../../../gems/site/img/features/newyear2020world/jelly.png","margin-left":.05*Config.cellWidth,"margin-top":.05*Config.cellHeight}),FigureRules.add(".episode_newyear2020world .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_newyear2020world .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":195}),FigureRules.add(".episode_newyear2020world .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":390}),FigureRules.add(".episode_newyear2020world .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":585})},figureRulesProcess.additionalBonusScaleImages=(E9e=figureRulesProcess.additionalBonusScaleImages,function(){E9e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/newyear2020world/christmasCandy.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/coinChest_large.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/candySafe.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/candySafeCollectItem.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/mysteryBall_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/yetiStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/yetiDamaged.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/ice1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/ice2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/ice3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/iceCubeAnnihilation.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/iceCubeAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/crabIceDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/crabIceMagic.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/crabIceMove.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/crabIceParts.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fireFlowerExplosion.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fireFlowerFire.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fireFlowerFireball.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/snail.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/lighthouse.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/deer_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/deerDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/deerFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasure1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasure2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasure3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasurebig1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasurebig2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/treasurebig3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fish1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fish2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fish3.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fishAttribute1.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fishAttribute2.png":_Figure.scaleKoef,"../../../gems/site/img/features/newyear2020world/fishFlying.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(F9e=figureRulesProcess.additionalBonusClasses,function(){F9e.call(this),figureRulesProcess.newyear2020worldBonusClasses()});var Halloween2020WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.lawn=$('<div class="homeLawnBg"></div>'),this.$el.append(this.lawn)},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("afterRegattaLineCrossedAtLevel100",this.updateBackground,this),this.updateBackground()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterRegattaLineCrossedAtLevel100",this.updateBackground,this)},updateBackground:function(){this.lawn.toggleClass("active",this.model.getCurrentLevel()>this.model.get("levelsInEpisode"))}}),Halloween2020World=BonusWorld.extend({defaults:_.defaults((_$defaults8={name:"halloween2020world",viewId:Halloween2020WorldView,version:20200928,production:!0,levelsInEpisode:100,durationDays:!1,helpWindow:!1,showFinalForce:!0},_defineProperty(_$defaults8,"helpWindow",!1),_defineProperty(_$defaults8,"endDate",new Date("2020/12/23 00:00")),_defineProperty(_$defaults8,"episode",1),_defineProperty(_$defaults8,"level",2),_defineProperty(_$defaults8,"minEpisodeToEnter",3),_defineProperty(_$defaults8,"minLevelToEnter",2),_defineProperty(_$defaults8,"forceId",!0),_defineProperty(_$defaults8,"closeForNew",!1),_defineProperty(_$defaults8,"allowAfterWin",!0),_defineProperty(_$defaults8,"allowPaid",!0),_defineProperty(_$defaults8,"allowProlong",!1),_defineProperty(_$defaults8,"prolongMaxTimes",1),_defineProperty(_$defaults8,"actionQueue",new ActionQueue),_defineProperty(_$defaults8,"finishWindowInStories",!0),_defineProperty(_$defaults8,"livesInstance",new BonusWorldLives),_defineProperty(_$defaults8,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives",amount:2}]),_defineProperty(_$defaults8,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults8,"showTimer",!0),_defineProperty(_$defaults8,"showProgress",!1),_defineProperty(_$defaults8,"sounds",{narrator:!1,pirate1:!1,pirate2:"piratenegative",pirate3:!1,pirate4:"piratepositive",pirate5:"piratenegative",pirate6:"piratepositive",girl1:!1,girl2:"woman",girl3:"piratewomannegative",girl4:!1,grandfather1:"daddypositive",grandfather2:"daddynegative",grandfather3:!1,charon1:!1,charon2:!1,charon3:"kharonangry",charon4:"kharonlaugh",monsters1:"monstersroar",candybeard1:"candybeardpositive",candybeard2:"candybeardnegative",candybeard3:"candybeardpositive"}),_defineProperty(_$defaults8,"unlimitedName","unlimitedBonusWorldLives"),_defineProperty(_$defaults8,"prizes",[]),_$defaults8),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.battlePass=new BattlePass({world:this}),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prizes:[{type:"coins",amount:1e3},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1}]},{place:2,prizes:[{type:"coins",amount:600},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1}]},{place:3,prizes:[{type:"coins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]}]},{level:55,places:[{place:1,prizes:[{type:"coins",amount:1200},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"starInField",amount:12}]},{place:2,prizes:[{type:"coins",amount:800},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"starInField",amount:8}]},{place:3,prizes:[{type:"coins",amount:400},{type:"good",name:"starInField",amount:4},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]}]},{level:75,places:[{place:1,prizes:[{type:"coins",amount:1500},{type:"good",name:"addThreeMoves",amount:12},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1}]},{place:2,prizes:[{type:"coins",amount:1e3},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",amount:8}]},{place:3,prizes:[{type:"coins",amount:500},{type:"good",name:"addThreeMoves",amount:4},{type:"powerUp",name:"shufflePowerUp",amount:1}]}]},{level:100,places:[{place:1,prizes:[{type:"coins",amount:2e3},{type:"powerUp",name:"deleteCellPowerUp",amount:3},{type:"powerUp",name:"lightingPowerUp",amount:3},{type:"good",name:"unlimitedLifes",amount:72}]},{place:2,prizes:[{type:"coins",amount:1500},{type:"powerUp",name:"deleteCellPowerUp",amount:2},{type:"powerUp",name:"lightingPowerUp",amount:2},{type:"good",name:"unlimitedLifes",amount:48}]},{place:3,prizes:[{type:"coins",amount:1e3},{type:"powerUp",name:"deleteCellPowerUp",amount:2},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",amount:24}]},{place:"consolation",prizes:[{type:"coins",amount:800},{type:"powerUp",name:"deleteCellPowerUp",amount:2},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",amount:24}]}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{type:"middlePrize",level:4,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"battlePass",level:5,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:4},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"middlePrize",level:9,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:150}]},{type:"battlePass",level:10,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:4}]},{type:"middlePrize",level:14,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"battlePass",level:15,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:4},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:19,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"battlePass",level:20,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:6},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2}]},{type:"middlePrize",level:24,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"battlePass",level:25,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2}]},{type:"middlePrize",level:29,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"battlePass",level:30,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:4}]},{type:"middlePrize",level:34,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"battlePass",level:35,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2}]},{type:"middlePrize",level:39,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"battlePass",level:40,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:44,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"battlePass",level:45,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:49,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"battlePass",level:50,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:1}]},{type:"battlePass",level:55,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:2},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:59,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"coins",cssClass:"coinsbonuswindow",amount:100},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"battlePass",level:60,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:64,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"battlePass",level:65,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:69,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"battlePass",level:70,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"battlePass",level:75,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:250},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:2},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:1}]},{type:"middlePrize",level:79,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:2},{type:"coins",cssClass:"coinsbonuswindow",amount:200}]},{type:"battlePass",level:80,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:84,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:4}]},{type:"battlePass",level:85,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:2},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:89,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:200}]},{type:"battlePass",level:90,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:.5}]},{type:"middlePrize",level:94,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2},{type:"coins",cssClass:"coinsbonuswindow",amount:250}]},{type:"battlePass",level:95,prize:[{type:"good",name:"unlimitedBonusWorldLives",cssClass:"unlimitedBonusWorldLives",amount:2},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:4}]}]}),this.artifactController=new ArtifactController({world:this,artifactWorkshopMinLevel:2,container:".regatta-halloween2020world .scrollWrapper",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3]},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.PartSpitter({world:this,perLevelChance:.35}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20},{id:21},{id:22},{id:23},{id:24}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:50},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:50},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:2}]},{id:6,parts:[21,22,23,24],cooldown:3600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"spins",amount:1}]},{id:7,type:"finish",relative:[1,2,3,4,5,6],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:3},{type:"spins",amount:1},{type:"good",name:"addThreeMoves",amount:12}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,fixed:!0,artifacts:[7]}]}}});var t=0;this.storyController=new StoryController({name:this.name,world:this,stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++t,elements:[{el:".homeLawnBg",persistentClass:"active"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++t,talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",id:++t,elements:[{el:".homeLawnBg",cleanClass:"active"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++t,talkKey:2},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"beforeEnter",id:++t},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:++t,talkKey:3},{type:StoryForceElement,owner:this,once:"beforeEnter",id:++t,el:".regattaStartBtn",name:"halloween2020worldForce0"},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",id:++t,talkKey:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:++t,talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:++t,talkKey:6},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",id:++t,talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel6",id:++t,talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel7",id:++t,talkKey:9},{type:StoryTalkElement,owner:this,once:"onFinishLevel8",id:++t,talkKey:10},{type:StoryTalkElement,owner:this,once:"onFinishLevel9",id:++t,talkKey:11},{type:StoryTalkElement,owner:this,once:"onFinishLevel9",id:++t,talkKey:12},{type:StoryTalkElement,owner:this,once:"onFinishLevel11",id:++t,talkKey:13},{type:StoryTalkElement,owner:this,once:"onFinishLevel12",id:++t,talkKey:14},{type:StoryTalkElement,owner:this,once:"onFinishLevel13",id:++t,talkKey:15},{type:StoryTalkElement,owner:this,once:"onFinishLevel14",id:++t,talkKey:16},{type:StoryTalkElement,owner:this,once:"onFinishLevel15",id:++t,talkKey:17},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",id:++t,talkKey:18},{type:StoryTalkElement,owner:this,once:"onFinishLevel18",id:++t,talkKey:19},{type:StoryTalkElement,owner:this,once:"onFinishLevel19",id:++t,talkKey:20},{type:StoryTalkElement,owner:this,once:"onFinishLevel19",id:++t,talkKey:21},{type:StoryTalkElement,owner:this,once:"onFinishLevel21",id:++t,talkKey:22},{type:StoryTalkElement,owner:this,once:"onFinishLevel22",id:++t,talkKey:23},{type:StoryTalkElement,owner:this,once:"onFinishLevel23",id:++t,talkKey:24},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:++t,talkKey:25},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:++t,talkKey:26},{type:StoryTalkElement,owner:this,once:"onFinishLevel27",id:++t,talkKey:27},{type:StoryTalkElement,owner:this,once:"onFinishLevel28",id:++t,talkKey:28},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:++t,talkKey:29},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:++t,talkKey:30},{type:StoryTalkElement,owner:this,once:"onFinishLevel31",id:++t,talkKey:31},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place1",id:++t,talkKey:32},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place2",id:++t,talkKey:33},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place3",id:++t,talkKey:34},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35NotPrize",id:++t,talkKey:35},{type:StoryTalkElement,owner:this,once:"onFinishLevel36",id:++t,talkKey:36},{type:StoryTalkElement,owner:this,once:"onFinishLevel37",id:++t,talkKey:37},{type:StoryTalkElement,owner:this,once:"onFinishLevel38",id:++t,talkKey:38},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:++t,talkKey:39},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:++t,talkKey:40},{type:StoryTalkElement,owner:this,once:"onFinishLevel42",id:++t,talkKey:41},{type:StoryTalkElement,owner:this,once:"onFinishLevel43",id:++t,talkKey:42},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:++t,talkKey:43},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:++t,talkKey:44},{type:StoryTalkElement,owner:this,once:"onFinishLevel47",id:++t,talkKey:45},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:++t,talkKey:46},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:++t,talkKey:47},{type:StoryTalkElement,owner:this,once:"onFinishLevel52",id:++t,talkKey:48},{type:StoryTalkElement,owner:this,once:"onFinishLevel53",id:++t,talkKey:49},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place1",id:++t,talkKey:50},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place2",id:++t,talkKey:51},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place3",id:++t,talkKey:52},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55NotPrize",id:++t,talkKey:53},{type:StoryTalkElement,owner:this,once:"onFinishLevel57",id:++t,talkKey:54},{type:StoryTalkElement,owner:this,once:"onFinishLevel58",id:++t,talkKey:55},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:++t,talkKey:56},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:++t,talkKey:57},{type:StoryTalkElement,owner:this,once:"onFinishLevel62",id:++t,talkKey:58},{type:StoryTalkElement,owner:this,once:"onFinishLevel63",id:++t,talkKey:59},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:++t,talkKey:60},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:++t,talkKey:61},{type:StoryTalkElement,owner:this,once:"onFinishLevel65",id:++t,talkKey:62},{type:StoryTalkElement,owner:this,once:"onFinishLevel67",id:++t,talkKey:63},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:++t,talkKey:64},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:++t,talkKey:65},{type:StoryTalkElement,owner:this,once:"onFinishLevel72",id:++t,talkKey:66},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place1",id:++t,talkKey:67},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place2",id:++t,talkKey:68},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place3",id:++t,talkKey:69},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75NotPrize",id:++t,talkKey:70},{type:StoryTalkElement,owner:this,once:"onFinishLevel76",id:++t,talkKey:71},{type:StoryTalkElement,owner:this,once:"onFinishLevel77",id:++t,talkKey:72},{type:StoryTalkElement,owner:this,once:"onFinishLevel78",id:++t,talkKey:73},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:++t,talkKey:74},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:++t,talkKey:75},{type:StoryTalkElement,owner:this,once:"onFinishLevel81",id:++t,talkKey:76},{type:StoryTalkElement,owner:this,once:"onFinishLevel83",id:++t,talkKey:77},{type:StoryTalkElement,owner:this,once:"onFinishLevel86",id:++t,talkKey:78},{type:StoryTalkElement,owner:this,once:"onFinishLevel88",id:++t,talkKey:79},{type:StoryTalkElement,owner:this,once:"onFinishLevel89",id:++t,talkKey:80},{type:StoryTalkElement,owner:this,once:"onFinishLevel89",id:++t,talkKey:81},{type:StoryTalkElement,owner:this,once:"onFinishLevel91",id:++t,talkKey:82},{type:StoryTalkElement,owner:this,once:"onFinishLevel92",id:++t,talkKey:83},{type:StoryTalkElement,owner:this,once:"onFinishLevel93",id:++t,talkKey:84},{type:StoryTalkElement,owner:this,once:"onFinishLevel93",id:++t,talkKey:85},{type:StoryTalkElement,owner:this,once:"onFinishLevel96",id:++t,talkKey:86},{type:StoryTalkElement,owner:this,once:"onFinishLevel99",id:++t,talkKey:87},{type:StoryTalkElement,owner:this,once:"onFinishLevel99",id:++t,talkKey:88},{type:StoryTalkElement,owner:this,once:"onFinishLevel99",id:++t,talkKey:89},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100",id:++t,talkKey:90},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place1",id:++t,talkKey:91},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place2",id:++t,talkKey:92},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place3",id:++t,talkKey:93},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100NotPrize",id:++t,talkKey:94},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++t,talkKey:95},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:++t},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.halloween2020world",name:"halloween2020worldForce1"},{type:StoryForceElement,owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.halloween2020world .tree .button1",name:"halloween2020worldForce2"},{type:StoryForceElement,owner:this.artifactController,once:"canCollectArtifact",id:203,el:"#artifactWorkshopButton",name:"halloween2020worldForce3",isAvailable:function(e,t){return e.findSlotByArtifact(t)}}]},{actionQueue:this.get("actionQueue")})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.storyController.configure(e))}}),S9e,T9e;figureRulesProcess.halloween2020worldBonusClasses=function(){FigureRules.add(".episode_halloween2020world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/artifactPlatform.png"}),FigureRules.add(".episode_halloween2020world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/halloween2020world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part21 .part",{frame:20}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part22 .part",{frame:21}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part23 .part",{frame:22}),FigureRules.add(".episode_halloween2020world .artifactPartCell.part24 .part",{frame:23}),FigureRules.add(".episode_halloween2020world .bugCell .bugCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2020world/charonIdle.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/halloween2020world/charonIdle.png",spriteFrames:6,duration:600,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_halloween2020world .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/halloween2020world/charonEat.png",spriteFrames:8,duration:800}),FigureRules.add(".episode_halloween2020world .bugCell .bugCellBg.die",{"background-image":"../../../gems/site/img/features/halloween2020world/charonDie_xlarge.png",spriteFrames:7,duration:700}),FigureRules.add(".episode_halloween2020world .bugCell .mTask1",{"margin-left":55/60*Config.cellWidth,"margin-top":97/60*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .bugCell .mTask1 .taskIco",{width:47/95*Config.cellWidth,height:47/95*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/candyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .bugCell .mTask2",{"margin-left":55/60*Config.cellWidth,"margin-top":1.2*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .bugCell .mTask2 .taskIco",{width:.5*Config.cellWidth,height:.5*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/shmandyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .bugCell .text.mCurrentCount",{"margin-left":28/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .bugCell .text.divider",{"margin-left":40/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .bugCell .text.mMaxCount",{"margin-left":52/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2020world/ghostDragonIdle.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:6,duration:600,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_halloween2020world .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2020world/ghostDragonAngry.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:3,framesOrder:[3,4,5],duration:300}),FigureRules.add(".episode_halloween2020world .alligatorFly",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2020world/ghostDragonAngry.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:4,framesOrder:[0,3,4,5],duration:400,playRound:!0,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_halloween2020world .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/candy.png","margin-left":0,"margin-top":-.25*Config.cellHeight,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_halloween2020world .caviarCell .cellStone",{"background-width":70,"background-height":66,width:70/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell3 .cellStone",{frame:0}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell3 .stable",{animation:null}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell2 .stable",{animation:null}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".episode_halloween2020world .caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".episode_halloween2020world .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_R.png"}),FigureRules.add(".episode_halloween2020world .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_G.png"}),FigureRules.add(".episode_halloween2020world .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_B.png"}),FigureRules.add(".episode_halloween2020world .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_Y.png"}),FigureRules.add(".episode_halloween2020world .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_P.png"}),FigureRules.add(".episode_halloween2020world .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/halloween2020world/spider_W.png"}),FigureRules.add(".episode_halloween2020world .fish4.fishcellBg",{"background-image":"../../../gems/site/img/features/halloween2020world/pumpkin.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2020world .fish9.fishcellBg",{"background-image":"../../../gems/site/img/features/halloween2020world/pumpkin.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem1",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem2",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem3",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem4",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock .lifeGem5",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_R .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_R.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_G .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_G.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_B .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_B.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_Y .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_Y.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_P .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_P.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_W .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_W.png"}),FigureRules.add(".episode_halloween2020world .barCellLifeBlock.color_s .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusLife_multi.png"}),FigureRules.add(".episode_halloween2020world .barCell",{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_halloween2020world .barCell.Middle",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusCenter.png"}),FigureRules.add(".episode_halloween2020world .barCell.TopLeftCorner",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusCorner.png","scale-x":-1}),FigureRules.add(".episode_halloween2020world .barCell.TopRightCorner",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusCorner.png"}),FigureRules.add(".episode_halloween2020world .barCell.BottomLeftCorner",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusCorner.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_halloween2020world .barCell.BottomRightCorner",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusCorner.png","scale-y":-1}),FigureRules.add(".episode_halloween2020world .barCell.LeftSide",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusSide.png",rotate:-90}),FigureRules.add(".episode_halloween2020world .barCell.TopSide",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusSide.png"}),FigureRules.add(".episode_halloween2020world .barCell.RightSide",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusSide.png",rotate:90}),FigureRules.add(".episode_halloween2020world .barCell.BottomSide",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusSide.png","scale-y":-1}),FigureRules.add(".episode_halloween2020world .barCell.VerticalTop",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusEdge.png"}),FigureRules.add(".episode_halloween2020world .barCell.VerticalMiddle",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusMiddle.png"}),FigureRules.add(".episode_halloween2020world .barCell.VerticalBottom",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusEdge.png","scale-y":-1}),FigureRules.add(".episode_halloween2020world .barCell.HorizontalLeft",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusEdge.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_halloween2020world .barCell.HorizontalMiddle",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusMiddle.png",rotate:90}),FigureRules.add(".episode_halloween2020world .barCell.HorizontalRight",{"background-image":"../../../gems/site/img/features/halloween2020world/cactusEdge.png",rotate:90}),FigureRules.add(".episode_halloween2020world .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ice1.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2020world .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ice2.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2020world .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ice3.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2020world .gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottle.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.gravityGroundLife2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.gravityGroundLife1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.gravityGroundLife1 .attributeIcon1, .episode_halloween2020world .gravityGroundCell.gravityGroundLife1 .attributeIcon2, .episode_halloween2020world .gravityGroundCell.gravityGroundLife1 .attributeIcon3, .episode_halloween2020world .gravityGroundCell.gravityGroundLife1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life1 .attributeIcon1,.episode_halloween2020world .gravityGroundCell.life1 .attributeIcon2,.episode_halloween2020world .gravityGroundCell.life1 .attributeIcon3,.episode_halloween2020world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life1 .attributeIcon2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life1 .attributeIcon3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2020world .groundLife2.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .groundLife1.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .attribute_ground",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ghostInside.png","margin-left":-7,"margin-top":-5,scale:1}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".episode_halloween2020world .gravityGroundCell.explode",{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_halloween2020world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleBreak.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundExplode2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleBreak.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/bottleBreak.png"}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":180}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":360}),FigureRules.add(".episode_halloween2020world .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":540}),FigureRules.add(".episode_halloween2020world .cork",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/cork.png"}),FigureRules.add(".episode_halloween2020world .attribute_ground.flying",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2020world .attribute_ground.flying.attributeColor2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2020world .attribute_ground.flying.attributeColor3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2020world .attribute_ground.flying.attributeColor4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2020world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2020world .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2020world/sheep_xlarge.png"}),FigureRules.add(".episode_halloween2020world .pastureCell.life2 .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2020world/sheepDark_xlarge.png"}),FigureRules.add(".episode_halloween2020world .attribute_animal.animateCollect",{"background-image":"../../../gems/site/img/features/halloween2020world/sheepFlying.png"}),FigureRules.add(".episode_halloween2020world .icebergCellBg",{"background-image":"../../../gems/site/img/features/halloween2020world/iceberg.png"}),FigureRules.add(".episode_halloween2020world .icebergExplode",{"background-image":"../../../gems/site/img/features/halloween2020world/icebergDie.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandy3.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variantbig1",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandyBig1.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variantbig2",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandyBig2.png"}),FigureRules.add(".episode_halloween2020world .frozen_frozenegg.variantbig3",{"background-image":"../../../gems/site/img/features/halloween2020world/frozenCandyBig3.png"}),FigureRules.add(".episode_halloween2020world .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":24,"background-height":22,"background-image":"../../../gems/site/img/features/halloween2020world/appleInside.png",width:60/180*Config.cellWidth,height:56/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin1",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin2",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin3",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin4",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin5",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.muffin6",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2020world .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":74,"background-height":77,"background-image":"../../../gems/site/img/features/halloween2020world/apple.png",width:96/180*Config.cellWidth,height:100/180*Config.cellHeight})},figureRulesProcess.additionalBonusScaleImages=(S9e=figureRulesProcess.additionalBonusScaleImages,function(){S9e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/halloween2020world/charonDie_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/charonEat.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/charonIdle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ghostDragonAngry.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ghostDragonIdle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/candy.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/pumpkin.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ice1.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ice2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ice3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/bottle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/bottleNoCork.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/ghostInside.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/sheep_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/sheepDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/iceberg.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/icebergDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2020world/sheepFlying.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(T9e=figureRulesProcess.additionalBonusClasses,function(){T9e.call(this),figureRulesProcess.halloween2020worldBonusClasses()});var BookOfLove=BonusWorld.extend({defaults:_.defaults({listIndex:2,name:"bookoflove",version:20210127,levelsInEpisode:50,helpWindow:!1,showFinalForce:!0,endDate:new Date("2021/03/09 17:00"),durationDays:!1,lastLevelOpen:!0,production:!0,episode:1,level:1,minEpisodeToEnter:2,minLevelToEnter:14,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],unlimitedName:"unlimitedBonusWorldLives2",openDate:null,closeForNew:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.questController=new QuestController({world:this,name:this.get("name"),tasks:[{id:1,price:1},{id:2,price:1,required:[1]},{id:3,price:1,required:[2],options:!0},{id:4,price:1,required:[3]},{id:5,price:1,required:[4]},{id:6,price:2,required:[5]},{id:7,price:1,required:[6],options:!0},{id:8,price:1,required:[7],options:!0},{id:9,price:1,required:[8],options:!0},{id:10,price:2,required:[9]},{id:11,price:1,required:[10]},{id:12,price:1,required:[11]},{id:13,price:1,required:[12]},{id:14,price:2,required:[13]},{id:15,price:1,required:[14],options:!0},{id:16,price:2,required:[15]},{id:17,price:2,required:[16]},{id:18,price:1,required:[17]},{id:19,price:2,required:[18]},{id:20,price:2,required:[19]},{id:21,price:1,required:[20]},{id:22,price:2,required:[21]},{id:23,price:2,required:[22]},{id:24,price:1,required:[23]},{id:25,price:2,required:[24]},{id:26,price:2,required:[25]},{id:27,price:1,required:[26]},{id:28,price:2,required:[27]},{id:29,price:2,required:[28]},{id:30,price:1,required:[29]},{id:31,price:2,required:[30]},{id:32,price:2,required:[31]},{id:33,price:1,required:[32]},{id:34,price:3,required:[33]}]}),this.battlePass=new BattlePass({world:this}),this.rewardChain=new RewardChain({viewClass:RewardChainView,world:this,name:this.get("name"),alternativeProgressBar:!0,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"battlePass",level:5,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:4},{type:"coins",cssClass:"coinsbonuswindow",amount:100}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:2}]},{type:"battlePass",level:10,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:4},{type:"coins",cssClass:"coinsbonuswindow",amount:150}]},{type:"middlePrize",level:15,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"battlePass",level:15,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:4},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:20,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"battlePass",level:20,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:2}]},{type:"middlePrize",level:25,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"battlePass",level:25,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"good",name:"starInField",cssClass:"starInField",amount:2},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"battlePass",level:30,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:4},{type:"coins",cssClass:"coinsbonuswindow",amount:200}]},{type:"middlePrize",level:35,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"battlePass",level:35,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:200},{type:"good",name:"starInField",cssClass:"starInField",amount:6}]},{type:"middlePrize",level:40,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"battlePass",level:40,prize:[{type:"coins",cssClass:"coinsbonuswindow",amount:250},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"middlePrize",level:45,prize:[{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"coins",cssClass:"coinsbonuswindow",amount:150},{type:"good",name:"unlimitedBonusWorldLives2",cssClass:"unlimitedBonusWorldLives2",amount:.5}]},{type:"battlePass",level:45,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"finalPrize",level:50,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:72},{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:72},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:72},{type:"spins",name:"spins",cssClass:"spins",amount:2}]}]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:"#map .questUi.questUi_bookoflove",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:200,parts:[{type:PartMaterial.NORMAL,chance:1}]},{dropType:Artifacts.PartShopByMaterial,id:2,coins:600,parts:[{type:PartMaterial.NORMAL,chance:.6},{type:PartMaterial.RARE,chance:.4}]},{id:3,coins:699,dropType:Artifacts.PartShopByMaterial,parts:[{type:"normal",chance:.5},{type:"rare",chance:.3,box:[1]},{type:"legendary",chance:.2,box:[2]}]}]},artifactWorkshop:{partSource:new Artifacts.PartDroopperByMaterial({chances:{15:55,7:55},perMoveChance:{15:{normal:.35,rare:.15,legend:.05},7:{normal:.3,rare:.2,legend:.05}}}),config:{showAll:!0,parts:[{id:1,chance:0,material:"normal"},{id:2,chance:.5,material:"normal"},{id:3,chance:.5,material:"normal"},{id:4,chance:.5,material:"normal"},{id:5,chance:.5,material:"normal"},{id:6,chance:.5,material:"normal"},{id:7,chance:.5,material:"normal"},{id:8,chance:.5,material:"normal"},{id:9,chance:.375,material:"rare"},{id:10,chance:.375,material:"rare"},{id:11,chance:.375,material:"rare"},{id:12,chance:.375,material:"rare"},{id:13,chance:.125,material:"legendary"},{id:14,chance:.125,material:"legendary"}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[3,4,5,9],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:3,parts:[5,6,9,10],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:4,parts:[6,7,11,13],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[8,12,13,14],cooldown:43200,ability:{type:Artifacts.CoinsAbility,coins:15},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:500},{type:"good",name:"unlimitedLifes",amount:3},{type:"spins",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}});var t=0;this.storyController=new StoryController({name:this.name,world:this,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++t},{type:StorySpineAnimationElement,owner:this,once:"enter",id:++t,spine:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.json",el:"#map .spine-animation-screen",removeDelay:200,x:377,y:225,animation:"closed_book_appear"},{type:StoryAnimationElement,owner:this,once:"enter",id:++t,elements:[{el:".questContainer .screen1",persistentClass:"show"}]},{type:StoryTalkElement,owner:this,once:"enter",id:++t,talkKey:1},{type:StoryAnimationElement,owner:this,once:"enter",id:++t,scrollTo:".task1",elements:[{el:".screen .task1.amur",persistentClass:"visible1"},{el:".screen .task1.couple",persistentClass:"visible1"},{el:".screen .pirate",persistentClass:"hidden1"},{el:".screen .girl",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this,once:"enter",id:++t,talkKey:2},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"enter",id:++t},{type:StoryTalkElement,owner:this,once:"enter",id:++t,talkKey:3},{type:StoryForceElement,owner:this,once:"enter",id:++t,delay:1e3,el:".questUi_bookoflove .completeTask",name:this.get("name")+"Force0"},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask1",id:++t,talkKey:4},{type:StoryForceElement,owner:this.questController,once:"afterCompleteTask1",id:++t,delayAfter:1e3,el:".questUi_bookoflove .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask2",id:++t,talkKey:5},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask2",id:++t,scrollTo:".task2",elements:[{el:".screen .task2",persistentClass:"visible1"},{el:".screen .task1",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask2",id:++t,talkKey:6},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask3",id:++t,talkKey:7},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3",id:++t,scrollTo:".task1",elements:[{el:".screen .task1",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3Option1",id:++t,scrollTo:".task3",elements:[{el:".screen .rings",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3Option2",id:++t,scrollTo:".task3",elements:[{el:".screen .rings",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3Option3",id:++t,scrollTo:".task3",elements:[{el:".screen .rings",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask3",id:++t,talkKey:8},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask4",id:++t,talkKey:9},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++t,scrollTo:".task4",elements:[{el:".screen .task4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask4",id:++t,talkKey:10},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask5",id:++t,talkKey:11},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++t,scrollTo:".task5",elements:[{el:".screen .task5",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask5",id:++t,talkKey:12},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask6",id:++t,talkKey:13},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask6",id:++t,talkKey:14},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask6",id:++t,duration:500,delayAfter:0,elements:[{el:".questContainer .screen1",persistentClass:"fadeOut"}]},{type:StorySpineAnimationElement,owner:this.questController,once:"afterCompleteTask6",id:++t,spine:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.json",el:"#map .spine-animation-screen",removeDelay:1500,x:377,y:225,animation:"change_page"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask6",id:++t,delayAfter:0,elements:[{el:".questContainer .screen1",persistentClass:"hide"},{el:".questContainer .screen2",className:"fadeIn"},{el:".questContainer .screen2",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask7",id:++t,talkKey:15},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",id:++t,scrollTo:".task7",elements:[{el:".screen .task7",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7Option1",id:++t,scrollTo:".task3",elements:[{el:".screen .task12.ark",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7Option2",id:++t,scrollTo:".task3",elements:[{el:".screen .task12.ark",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7Option3",id:++t,scrollTo:".task3",elements:[{el:".screen .task12.ark",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask7",id:++t,talkKey:16},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask8",id:++t,talkKey:17},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",id:++t,scrollTo:".task8",elements:[{el:".screen .task8",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8Option1",id:++t,scrollTo:".task8",elements:[{el:".screen .task12.table",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8Option2",id:++t,scrollTo:".task8",elements:[{el:".screen .task12.table",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8Option3",id:++t,scrollTo:".task8",elements:[{el:".screen .task12.table",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask8",id:++t,talkKey:18},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask9",id:++t,talkKey:19},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9",id:++t,scrollTo:".task9",elements:[{el:".screen .task9",persistentClass:"visible1"},{el:".screen2 .locationTop ",persistentClass:"hidden1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9Option1",id:++t,scrollTo:".task9",elements:[{el:".screen .task12.flowers",persistentClass:"variant1"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9Option2",id:++t,scrollTo:".task9",elements:[{el:".screen .task12.flowers",persistentClass:"variant2"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask9Option3",id:++t,scrollTo:".task9",elements:[{el:".screen .task12.flowers",persistentClass:"variant3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask9",id:++t,talkKey:20},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask10",id:++t,talkKey:21},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",id:++t,scrollTo:".task1",elements:[{el:".screen .task10",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask10",id:++t,talkKey:22},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask11",id:++t,talkKey:23},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask12",id:++t,talkKey:24},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++t,scrollTo:".task12",elements:[{el:".screen .task8",persistentClass:"hidden1"},{el:".screen .bg.table",persistentClass:"hidden1"},{el:".screen .task12.table",persistentClass:"visible1"},{el:".screen .task12.characters",persistentClass:"visible1"},{el:".screen2 .bg.characters",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask12",id:++t,talkKey:25},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++t,scrollTo:".task12",elements:[{el:".screen .task9",persistentClass:"hidden1"},{el:".screen .task12.flowers",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask12",id:++t,talkKey:26},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++t,scrollTo:".task12",elements:[{el:".screen .task7",persistentClass:"hidden1"},{el:".screen .task12.ark",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask12",id:++t,talkKey:27},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask13",id:++t,talkKey:28},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++t,scrollTo:".task13",elements:[{el:".screen .task13",persistentClass:"visible1"},{el:".screen .task10",persistentClass:"hidden2"},{el:".screen2 bg.characters",persistentClass:"closer"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask13",id:++t,talkKey:29},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask14",id:++t,talkKey:30},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask14",id:++t,duration:500,delayAfter:0,elements:[{el:".questContainer .screen2",className:"fadeOut"}]},{type:StorySpineAnimationElement,owner:this.questController,once:"afterCompleteTask14",id:++t,spine:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.json",el:"#map .spine-animation-screen",removeDelay:1500,x:377,y:225,animation:"change_page"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask14",id:++t,delayAfter:0,elements:[{el:".questContainer .screen2",persistentClass:"hide"},{el:".questContainer .screen3",className:"fadeIn"},{el:".questContainer .screen3",persistentClass:"show"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask14",id:++t,talkKey:31},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask15",id:++t,talkKey:32},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask15",id:++t,scrollTo:".task15",elements:[{el:".screen .task15",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask15",id:++t,talkKey:33},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask16",id:++t,talkKey:34},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask16",id:++t,scrollTo:".task16",elements:[{el:".screen3 .grass",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask16",id:++t,talkKey:35},{type:StoryTalkElement,owner:this.questController,once:"afterCompleteTask17",id:++t,talkKey:36},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask17",id:++t,scrollTo:".task17",elements:[{el:".screen3 .characters",persistentClass:"closer"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask17",id:++t,talkKey:37},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask18",id:++t,talkKey:38},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask18",id:++t,scrollTo:".task1",elements:[{el:".screen3 .characters",persistentClass:"higher"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask18",id:++t,talkKey:39},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:40},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen3 .characters",cleanClass:"higher"},{el:".screen3 .bg.wheel",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:41},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen .task19.wheel",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:42},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen .bg.gate",persistentClass:"hidden1"},{el:".screen .task20",persistentClass:"visible1"},{el:".screen .task19.cage",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:43},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask19",id:++t,scrollTo:".task19",elements:[{el:".screen .task19.ship",persistentClass:"visible1"},{el:".screen3 .characters",persistentClass:"hidden1"},{el:".screen .task19.characters",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask19",id:++t,talkKey:44},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask20",id:++t,talkKey:45},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++t,scrollTo:".task20",elements:[{el:".screen .task19.characters",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask20",id:++t,talkKey:46},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++t,scrollTo:".task20",elements:[{el:".screen .task20",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask20",id:++t,talkKey:47},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:48},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++t,scrollTo:".task21",elements:[{el:".screen3 .task19.characters",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask21",id:++t,talkKey:49},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask22",id:++t,talkKey:50},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask22",id:++t,talkKey:51},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",id:++t,scrollTo:".task22",elements:[{el:".screen .task22.parents",persistentClass:"visible1"},{el:".screen .task22.boat",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask22",id:++t,talkKey:52},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",id:++t,scrollTo:".task22",elements:[{el:".screen .task19.characters",persistentClass:"hidden2"},{el:".screen .task22.pirate",persistentClass:"visible2"},{el:".screen .task19.cage",persistentClass:"hidden2"},{el:".screen .task22.cage",persistentClass:"visible1"},{el:".screen .task22.boat",persistentClass:"hidden2"},{el:".screen .task22.skeleton",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask22",id:++t,talkKey:53},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask23",id:++t,talkKey:54},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++t,scrollTo:".task23",elements:[{el:".screen .task22.pirate",persistentClass:"hidden3"},{el:".screen .task23.pirate",persistentClass:"visible2"},{el:".screen .task20",persistentClass:"mirrored"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask23",id:++t,talkKey:55},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++t,scrollTo:".task23",elements:[{el:".screen .task20",persistentClass:"updated2"},{el:".screen .task22.cage",persistentClass:"hidden1"},{el:".screen .task23.cage",persistentClass:"visible1"},{el:".screen .task23.pirate",persistentClass:"hidden2"},{el:".screen .task19.characters",persistentClass:"visible3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask23",id:++t,talkKey:56},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++t,scrollTo:".task23",elements:[{el:".screen .task22.skeleton",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask23",id:++t,talkKey:57},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask24",id:++t,talkKey:58},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++t,scrollTo:".task24",elements:[{el:".screen .task22.parents",persistentClass:"updated1"},{el:".screen .task19.characters",persistentClass:"updated3"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask24",id:++t,talkKey:59},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask25",id:++t,talkKey:60},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,duration:500,delayAfter:0,elements:[{el:".questContainer .screen3",persistentClass:"fadeOut"}]},{type:StorySpineAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,spine:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.json",el:"#map .spine-animation-screen",removeDelay:1500,x:377,y:225,animation:"change_page"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,delayAfter:0,elements:[{el:".questContainer .screen2",cleanClass:"fadeOut"},{el:".questContainer .screen2",persistentClass:"visible1"},{el:".screen2 .task12.characters",persistentClass:"hidden1"},{el:".questContainer .screen2",persistentClass:"fadeIn2"},{el:".questContainer .screen3",persistentClass:"hide"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++t,elements:[{el:".screen .task25",persistentClass:"visible1"},{el:".screen .bg.characters",persistentClass:"hidden1"},{el:".screen .task13",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask25",id:++t,talkKey:61},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask26",id:++t,talkKey:62},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask26",id:++t,scrollTo:".task26",elements:[{el:".screen .task12.ark",persistentClass:"hidden1"},{el:".screen .task7",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask26",id:++t,talkKey:63},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask27",id:++t,talkKey:64},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask27",id:++t,scrollTo:".task27",elements:[{el:".screen .task12.table",persistentClass:"hidden1"},{el:".screen .task8",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask27",id:++t,talkKey:65},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask28",id:++t,talkKey:66},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask28",id:++t,scrollTo:".task28",elements:[{el:".screen .task12.flowers",persistentClass:"hidden1"},{el:".screen .task9",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask28",id:++t,talkKey:67},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask29",id:++t,talkKey:68},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask29",id:++t,scrollTo:".task29",elements:[{el:".screen .task29",persistentClass:"visible1"},{el:".screen .task25.parents",persistentClass:"hidden1"},{el:".screen .task25.characters",persistentClass:"hidden1"},{el:".screen .task12.characters",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask29",id:++t,talkKey:69},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask30",id:++t,talkKey:70},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask30",id:++t,scrollTo:".task30",elements:[{el:".screen .task30.guests",persistentClass:"visible1"},{el:".screen .task30",persistentClass:"visible1"},{el:".screen .task29",persistentClass:"hidden1"},{el:".screen .task25.parents",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask30",id:++t,talkKey:71},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask31",id:++t,talkKey:72},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask31",id:++t,scrollTo:".task31",elements:[{el:".screen .task31",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask31",id:++t,talkKey:73},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask32",id:++t,talkKey:74},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask32",id:++t,scrollTo:".task32",elements:[{el:".screen .rings",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask32",id:++t,talkKey:75},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask33",id:++t,talkKey:76},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask33",id:++t,scrollTo:".task1",elements:[{el:".screen .task30.characters",persistentClass:"hidden1"},{el:".screen .task33",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask33",id:++t,talkKey:77},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask34",id:++t,talkKey:78},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask34",id:++t,duration:500,delayAfter:0,elements:[{el:".questContainer .screen2",persistentClass:"fadeOut2"}]},{type:StorySpineAnimationElement,owner:this.questController,once:"afterCompleteTask34",id:++t,spine:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodebookoflove/spine/book.15186e0c6f.json",el:"#map .spine-animation-screen",removeDelay:1500,x:377,y:225,animation:"change_page"},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask34",id:++t,delayAfter:0,scrollTo:".task34",elements:[{el:".questContainer .screen2",persistentClass:"hidden1"},{el:".questContainer .screen4",persistentClass:"fadeIn"},{el:".questContainer .screen4",persistentClass:"show"},{el:".screen .task34",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,on:"afterCompleteTask34",id:++t,talkKey:79},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this.questController,once:"afterCompleteTask34",id:++t},{type:StoryTalkElement,owner:this.rewardChain,once:"showRewardChain",id:++t,talkKey:80},{type:StoryTalkElement,owner:this.rewardChain,once:"showRewardChain",id:++t,talkKey:81},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize5",id:++t,talkKey:82},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize10",id:++t,talkKey:83},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize15",id:++t,talkKey:84},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize20",id:++t,talkKey:85},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize25",id:++t,talkKey:86},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize30",id:++t,talkKey:87},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize35",id:++t,talkKey:88},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize40",id:++t,talkKey:89},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize45",id:++t,talkKey:90},{type:StoryTalkElement,owner:this,on:"rewardChainBeforeTakePrize50",id:++t,talkKey:91},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".questUi_bookoflove  .artifactWorkshopButton.bookoflove",name:"bookofloveForce2"},{type:StoryForceElement,owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.bookoflove .tree .button1",name:"bookofloveForce4"}]},{actionQueue:this.get("actionQueue")})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.storyController.configure(e))}}),Z9e,$9e,_9e,aaf,baf,caf,daf,eaf;figureRulesProcess.additionalBonusScaleImages=(Z9e=figureRulesProcess.additionalBonusScaleImages,function(){Z9e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/bookoflove/cupidonSmile.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/cupidonStable.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/frogGirl.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/frogLove.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/greedyPirate1.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/greedyPirate2.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/heart.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/heartChest.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/heartFlower.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/hitHeart.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/jealousy.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/special10.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/strongboxHearts_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/bookoflove/artifactPlatform.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=($9e=figureRulesProcess.additionalBonusClasses,function(){$9e.call(this),FigureRules.add(".episode_bookoflove .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/special10.png"}),FigureRules.add(".episode_bookoflove .color_N",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_bookoflove .flyWater",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/hitHeart.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_bookoflove .color_N.waterAnimated",{framesOrder:0,duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_bookoflove .wellCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/heartFlower.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_bookoflove .wellCell.wellLevel1",{"background-position-x":180,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_bookoflove .wellCell.wellLevel2",{"background-position-x":720,"background-position-y":0,spriteFrames:4,duration:400,lastFrame:3}),FigureRules.add(".episode_bookoflove .wellCell.wellLevel3",{"background-position-x":1260,"background-position-y":0,spriteFrames:3,duration:200,lastFrame:2,delay:0,playRound:!1}),FigureRules.add(".episode_bookoflove .wellCell.wellLevel4",{"background-position-x":1620,"background-position-y":0,spriteFrames:6,duration:600,playRound:!1}),FigureRules.add(".episode_bookoflove .flamyCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/bookoflove/cupidonStable.png","margin-left":0,"margin-top":0,spriteFrames:4,framesOrder:[0,1,2,3],duration:400,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_bookoflove .flamyCellBg.damaged",{"background-image":"../../../gems/site/img/features/bookoflove/cupidonSmile.png",spriteFrames:7,framesOrder:[0,1,2,3,4,5,6],duration:700,playRound:!1,delay:0}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock",{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .taskIco",{width:25/60*Config.cellWidth,height:25/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/hitHeart.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .lifeText",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .lifeText .currentLife, .episode_bookoflove .flamyCell .lifeBlock .lifeText .divider, .episode_bookoflove .flamyCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .lifeText .currentLife",{textAlign:"right"}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .lifeText .divider",{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_bookoflove .flamyCell .lifeBlock .lifeText .maxLife",{"margin-left":.15*Config.cellWidth}),FigureRules.add(".episode_bookoflove .decorator_greedypirate",{"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .move_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,lastFrame:2,duration:130,playRound:!1}),FigureRules.add(".episode_bookoflove .grab_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate1.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:7,framesOrder:[3,4,5,6,7,8,9],duration:500,playRound:!1}),FigureRules.add(".episode_bookoflove .decorator_greedypirate.hasCoins",{"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate2.png",spriteFrames:4,duration:400,playRound:!0}),FigureRules.add(".episode_bookoflove .decorator_greedypirate .coins",{opacity:0,font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#ffffff","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_bookoflove .sleep_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:3,duration:300,framesOrder:[7,8,9],playRound:!0}),FigureRules.add(".episode_bookoflove .hit_greedypirate",{"background-position-x":0,"background-position-y":0,"background-width":202,"background-height":204,"background-image":"../../../gems/site/img/features/bookoflove/greedyPirate2.png",width:202/3/60*Config.cellWidth,height:68/60*Config.cellHeight,"margin-left":-10/3/60*Config.cellWidth,"margin-top":-4/60*Config.cellHeight,spriteFrames:2,lastFrame:2,framesOrder:[5,6],duration:250,playRound:!1}),FigureRules.add(".episode_bookoflove .coinChestHeadCell",{width:393/180*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-16.5/180*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"../../../gems/site/img/features/bookoflove/heartChest.png"}),FigureRules.add(".episode_bookoflove .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_bookoflove .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_bookoflove .attribute_coin",{"background-image":"../../../gems/site/img/features/bookoflove/heart.png"}),FigureRules.add(".episode_bookoflove .attribute_coin_remove",{"background-image":"../../../gems/site/img/features/bookoflove/heart.png"}),FigureRules.add(".episode_bookoflove .frogtarget",{width:1*Config.cellWidth,height:209/180*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":-32/180*Config.cellHeight,"background-width":180,"background-height":209,"background-image":"../../../gems/site/img/features/bookoflove/frogGirl.png",spriteFrames:7,duration:700,delay:[3e3,5e3]}),FigureRules.add(".episode_bookoflove .frogtarget.done",{width:287/180*Config.cellWidth,height:232/180*Config.cellHeight,"margin-left":-.35*Config.cellWidth,"margin-top":-57/180*Config.cellHeight,"background-width":287,"background-height":232,"background-image":"../../../gems/site/img/features/bookoflove/frogLove.png",spriteFrames:12,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,11],duration:1200}),FigureRules.add(".episode_bookoflove .decorator_crabMouse",{"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/jealousy.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .decorator_crabMouse.stable",{"background-position-x":1260,spriteFrames:3,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_bookoflove .decorator_crabMouse.takeLife",{"background-position-x":0,spriteFrames:3,duration:300}),FigureRules.add(".episode_bookoflove .decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_bookoflove .move_crabMouse, .episode_bookoflove .crabMouseCollect",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/jealousy.png",width:Config.cellWidth,height:Config.cellHeight,"margin-top":-10/60*Config.cellHeight,spriteFrames:2,duration:260,playRound:!0}),FigureRules.add(".episode_bookoflove .move_crabMouse.moveRight",{"scale-x":-1,"margin-left":0}),FigureRules.add(".episode_bookoflove .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_bookoflove .decorator_crabMouse .life, .episode_autumnworld .decorator_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_bookoflove .decorator_crabMouse .lifeBlock, .episode_autumnworld .decorator_crabMouse .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":56/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .decorator_crabMouse .lifeBar, .episode_autumnworld .decorator_crabMouse .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_bookoflove .decorator_crabMouse.lifeLevel2 .lifeBar, .episode_autumnworld .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#ff0"}),FigureRules.add(".episode_bookoflove .decorator_crabMouse.lifeLevel1 .lifeBar, .episode_autumnworld .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_bookoflove .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":232,"background-height":374,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/bookoflove/strongboxHearts_xlarge.png","margin-left":-34/180*Config.cellWidth,"margin-top":-.9*Config.cellHeight}),FigureRules.add(".episode_bookoflove .strongboxCellLoot",{"background-position-x":0,"background-width":230,"background-height":329,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/bookoflove/strongboxHeartsCollectItem.png","margin-left":-34/180*Config.cellWidth,"margin-top":-1*Config.cellHeight}),FigureRules.add(".episode_bookoflove .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/bookoflove/artifactPlatform.png"}),FigureRules.add(".episode_bookoflove .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/bookoflove/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_bookoflove .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_bookoflove .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_bookoflove .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_bookoflove .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_bookoflove .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_bookoflove .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_bookoflove .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_bookoflove .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_bookoflove .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_bookoflove .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_bookoflove .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_bookoflove .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_bookoflove .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_bookoflove .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_bookoflove .artifactPartCell.part15 .part",{frame:14})}),figureRulesProcess.cloudrace2BonusClasses=function(){FigureRules.add(".episode_cloudrace2 .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/artifactPlatform.png"}),FigureRules.add(".episode_cloudrace2 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/cloudrace2/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_cloudrace2 .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_cloudrace2 .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":302,"background-height":402,width:302/180*Config.cellWidth,height:402/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/cloudrace2/strongbox_xlarge.png","margin-left":-75/180*Config.cellWidth,"margin-top":-175/180*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .strongboxCellLoot",{"background-position-x":0,"background-width":230,"background-height":329,width:232/180*Config.cellWidth,height:374/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/cloudrace2/strongboxCollectItem.png","margin-left":-34/180*Config.cellWidth,"margin-top":-1*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .strongboxCell.removeStrongbox .strongboxBg.stable",{startFrame:10,spriteFrames:10,duration:500}),FigureRules.add(".episode_cloudrace2 .fishBallCell",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/mysteryBall_xlarge.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:6,framesOrder:[0,1,2,3,4,5],delay:[2e3,4e3],duration:600,playRound:!0}),FigureRules.add(".episode_cloudrace2 .fishBallCell.powerUpHighlight",{animation:{params:{"margin-top":[-0*Config.cellHeight,-24/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallAngry",{startFrame:6,spriteFrames:8,duration:600,playRound:!1}),FigureRules.add(".episode_cloudrace2 .fishBallCell.create",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/mysteryBall_xlarge.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:14,duration:800,playRound:!1}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallDie",{startFrame:14,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallFly",{startFrame:19,spriteFrames:5,duration:500,playRound:!1}),FigureRules.add(".episode_cloudrace2 .fishBallCell .lifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallDie .lifeBlock, .episode_cloudrace2 .fishBallCell.fishBallFly .lifeBlock, .episode_cloudrace2 .fishBallCell.create .lifeBlock",{opacity:0}),FigureRules.add(".episode_cloudrace2 .fishBallCell .life",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallLevel2 .life",{"background-color":"#ffff00"}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallLevel1 .life",{"background-color":"#f2342c"}),FigureRules.add(".episode_cloudrace2 .fishBallCell.fishBallStartLevel2.fishBallLevel2 .life",{"background-color":"#a1ec00"}),FigureRules.add(".episode_cloudrace2 .fish2.fishcellBg",{"background-image":"../../../gems/site/img/features/cloudrace2/special2.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .bugCell .bugCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/cloudrace2/balloon_large.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_cloudrace2 .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/cloudrace2/balloon_large.png",spriteFrames:7,duration:700,playRound:!0,delay:[1,2]}),FigureRules.add(".episode_cloudrace2 .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/cloudrace2/balloon_large.png",spriteFrames:5,startFrame:7,duration:800}),FigureRules.add(".episode_cloudrace2 .bugCell .bugCellBg.die",{startFrame:0,"background-image":"../../../gems/site/img/features/cloudrace2/balloon_large.png",spriteFrames:7,duration:700,playRound:!0}),FigureRules.add(".episode_cloudrace2 .bugCell .mTask",{width:194/180*Config.cellWidth,height:70/180*Config.cellHeight,"background-width":194,"background-height":70,"background-image":"../../../gems/site/img/features/cloudrace2/pirateLifeBlock.png"}),FigureRules.add(".episode_cloudrace2 .bugCell .mTask1 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":30,"background-height":30,"background-image":"../../../gems/site/img/features/cloudrace2/bugCoinTask.png","margin-left":-2/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .bugCell .mTask2",{"margin-left":55/60*Config.cellWidth,"margin-top":97/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .bugCell .mTask2 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":30,"background-height":30,"background-image":"../../../gems/site/img/features/cloudrace2/bugEggsTask.png","margin-left":-2/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .bugCell .text.mCurrentCount",{"margin-left":28/60*Config.cellWidth}),FigureRules.add(".episode_cloudrace2 .bugCell .text.divider",{"margin-left":40/60*Config.cellWidth}),FigureRules.add(".episode_cloudrace2 .bugCell .text.mMaxCount",{"margin-left":52/60*Config.cellWidth}),FigureRules.add(".episode_cloudrace2 .attribute_falling",{"background-image":"../../../gems/site/img/features/cloudrace2/fire.png","background-width":60,"background-height":60,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,framesOrder:[0],duration:1,delay:[1,1],playRound:!1}),FigureRules.add(".episode_cloudrace2 .fishcellBg.fish12",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/garmentB1.png"}),FigureRules.add(".episode_cloudrace2 .fishcellBg.fish13",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/garmentB2.png"}),FigureRules.add(".episode_cloudrace2 .fishcellBg.fish14",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/garmentB3.png"}),FigureRules.add(".episode_cloudrace2 .fishcellBg.fish15",{"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/garmentB4.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell .cellStone",{"background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight,"margin-left":0}),FigureRules.add(".episode_cloudrace2 .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickR.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickG.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickB.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickY.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickP.png"}),FigureRules.add(".episode_cloudrace2 .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/cloudrace2/chickW.png"}),FigureRules.add(".episode_cloudrace2 .skatCellBg",{"background-position-y":0,"background-width":193,"background-height":194,"background-image":"../../../gems/site/img/features/cloudrace2/electroBird.png",width:193/180*Config.cellWidth,height:194/180*Config.cellHeight,"margin-left":-7/180*Config.cellWidth,"margin-top":-15/180*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .skatCellBg.stable",{"background-position-x":0,spriteFrames:5,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_cloudrace2 .skatCellBg.angrySkat",{"background-position-x":0,startFrame:5,spriteFrames:6,duration:500,playRound:!0}),FigureRules.add(".episode_cloudrace2 .skatCellBg.eatSkat",{"background-position-x":0,startFrame:11,spriteFrames:5,duration:500,playRound:!0}),FigureRules.add(".episode_cloudrace2 .die_skat",{"background-position-x":0,"background-position-y":0,"background-width":193,"background-height":194,"background-image":"../../../gems/site/img/features/cloudrace2/electroBird.png",width:193/180*Config.cellWidth,height:194/180*Config.cellHeight,"margin-left":-7/180*Config.cellWidth,"margin-top":-7/180*Config.cellHeight,frame:0}),FigureRules.add(".episode_cloudrace2 .skatCell .life",{"background-position-y":0,"background-width":50,"background-height":17,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/devilfish-life.c940445916.png",width:38/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":11/60*Config.cellWidth,"margin-top":47/60*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .life.skatLevel3",{"background-position-x":0}),FigureRules.add(".episode_cloudrace2 .life.skatLevel2",{"background-position-x":50}),FigureRules.add(".episode_cloudrace2 .life.skatLevel1",{"background-position-x":100}),FigureRules.add(".episode_cloudrace2 .decorator_chocolate.stable",{"background-position-x":750,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/cloudrace2/chocolateAppear.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .decorator_chocolate.chocolate_appearance",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/cloudrace2/chocolateAppear.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":-35/180*Config.cellWidth,"margin-top":-30/180*Config.cellHeight,spriteFrames:4,duration:300}),FigureRules.add(".episode_cloudrace2 .chocolate_annihilation",{"background-position-x":0,"background-position-y":0,"background-width":250,"background-height":241,"background-image":"../../../gems/site/img/features/cloudrace2/chocolateDie.png",width:250/180*Config.cellWidth,height:241/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400}),FigureRules.add(".episode_cloudrace2 .decorator_monkey",{"background-position-x":0,"background-position-y":0,"background-width":80,"background-height":69,"background-image":"../../../gems/site/img/features/cloudrace2/seagull.png",width:80/60*Config.cellWidth,height:1.15*Config.cellHeight,"margin-left":-10/60*Config.cellWidth,"margin-top":-.15*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .decorator_monkey.die",{"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_cloudrace2 .decorator_monkey.monkeyCollect",{"background-position-x":400}),FigureRules.add(".episode_cloudrace2 .coinChestHeadCell",{"background-image":"../../../gems/site/img/features/cloudrace2/coinChest_large.png"}),FigureRules.add(".episode_cloudrace2 .attribute_coin",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/coin.png"}),FigureRules.add(".episode_cloudrace2 .attribute_coin_remove",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/cloudrace2/coin.png"}),FigureRules.add(".episode_cloudrace2 .genrymorganLeftHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/cloudrace2/faneHand.png","scale-x":-1}),FigureRules.add(".episode_cloudrace2 .genrymorganRightHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/cloudrace2/faneHand.png"}),FigureRules.add(".episode_cloudrace2 .genrymorganFly",{width:140/60*Config.cellWidth,height:136/60*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":4/60*Config.cellHeight,"background-width":140,"background-height":136,"background-image":"../../../gems/site/img/features/cloudrace2/faneFly.png",spriteFrames:10,duration:900}),FigureRules.add(".episode_cloudrace2 .genrymorganHeadCell",{width:140/60*Config.cellWidth,height:136/60*Config.cellHeight,"margin-left":-10/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight,"background-width":140,"background-height":136,"background-image":"../../../gems/site/img/features/cloudrace2/fane.png"}),FigureRules.add(".episode_cloudrace2 .genrymorganLifeBlock",{"margin-left":.75*Config.cellWidth})},figureRulesProcess.additionalBonusScaleImages=(_9e=figureRulesProcess.additionalBonusScaleImages,function(){_9e.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/cloudrace2/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/balloon_large.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/garmentB1.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/garmentB2.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/garmentB3.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/garmentB4.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickR.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickG.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickB.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickY.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickP.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chickW.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/electroBird.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/strongbox_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/mysteryBall_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/chocolateDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/coin.png":_Figure.scaleKoef,"../../../gems/site/img/features/cloudrace2/coinChest_large.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(aaf=figureRulesProcess.additionalBonusClasses,function(){aaf.call(this),figureRulesProcess.cloudrace2BonusClasses()}),figureRulesProcess.deepseaBonusClasses=function(){FigureRules.add(".episode_deepsea .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/special10.2a521f5b62.png"}),FigureRules.add(".episode_deepsea .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/artifactPlatform.9da3162586.png"}),FigureRules.add(".episode_deepsea .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/artifactPart.03ac57b3a6.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_deepsea .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_deepsea .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_deepsea .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_deepsea .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_deepsea .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_deepsea .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_deepsea .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_deepsea .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_deepsea .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_deepsea .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_deepsea .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_deepsea .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_deepsea .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_deepsea .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_deepsea .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_deepsea .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_deepsea .decorator_crabMouse",{"background-position-y":0,"background-width":133,"background-height":148,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fish.15bea6baa4.png",width:133/180*Config.cellWidth,height:148/180*Config.cellHeight,"margin-left":23.5/180*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,"scale-x":-1}),FigureRules.add(".episode_deepsea .decorator_crabMouse.stable",{"background-position-x":0,spriteFrames:3,duration:300,delay:[3e3,5e3],playRound:!0}),FigureRules.add(".episode_deepsea .decorator_crabMouse.takeLife",{"background-position-x":399,spriteFrames:3,duration:150,playRound:!0}),FigureRules.add(".episode_deepsea .decorator_crabMouse .life",{font:"bold "+20/60*Config.cellWidth+"px/"+22/60*Config.cellWidth+"px tahoma",color:"#996500","text-left":28/60*Config.cellWidth,"text-top":.9*Config.cellWidth,textAlign:"center"}),FigureRules.add(".episode_deepsea .move_crabMouse, .episode_deepsea .crabMouseCollect",{"scale-x":-1,"background-position-x":798,"background-position-y":0,"background-width":133,"background-height":148,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fish.15bea6baa4.png",width:133/180*Config.cellWidth,height:148/180*Config.cellHeight,"margin-left":23.5/180*Config.cellWidth,"margin-top":-10/60*Config.cellWidth,spriteFrames:3,duration:260,playRound:!0}),FigureRules.add(".episode_deepsea .move_crabMouse.moveRight",{"scale-x":1,"margin-left":23.5/180*Config.cellWidth}),FigureRules.add(".episode_deepsea .move_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_deepsea .decorator_crabMouse .life",{opacity:"0"}),FigureRules.add(".episode_deepsea .decorator_crabMouse .lifeBlock",{"scale-x":-1,"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":56/60*Config.cellHeight}),FigureRules.add(".episode_deepsea .decorator_crabMouse .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_deepsea .decorator_crabMouse.lifeLevel2 .lifeBar",{"background-color":"#ff0"}),FigureRules.add(".episode_deepsea .decorator_crabMouse.lifeLevel1 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_deepsea .groundCell .decorator",{"margin-left":.1*Config.cellWidth,"margin-top":.1*Config.cellWidth}),FigureRules.add(".episode_deepsea .crabMouseFarmCell",{"background-position-x":0,"background-position-y":0,"background-width":185,"background-height":200,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fishCoral.67a6510a15.png",width:185/180*Config.cellWidth,height:200/180*Config.cellHeight,"margin-left":-3/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight}),FigureRules.add(".episode_deepsea .crabMouseFarmCellCrabMouse",{"background-position-x":1230,"background-position-y":0,"background-width":123,"background-height":116,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fishSpawn.9027c73648.png",width:123/180*Config.cellWidth,height:116/180*Config.cellHeight,"margin-left":28.5/180*Config.cellWidth}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel0 .crabMouseFarmCellCrabMouse.stable",{"background-image":""}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":123,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":492,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.stable",{"background-position-x":861,spriteFrames:3,duration:400,delay:[500,1500],playRound:!0}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel1 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":0,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel2 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":492,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_deepsea .crabMouseFarmLevel3 .crabMouseFarmCellCrabMouse.crabMouseFarmMove",{"background-position-x":861,spriteFrames:1,duration:100,delay:[0,0]}),FigureRules.add(".episode_deepsea .attribute_key",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bonuslevel0/bonusLevelFish1.7c56771edf.png",width:.5*Config.cellWidth,height:.5*Config.cellHeight,"margin-left":.25*Config.cellWidth,"margin-top":.25*Config.cellHeight}),FigureRules.add(".episode_deepsea .fish2.fishcellBg",{"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/special2.260f753f49.png"})},figureRulesProcess.additionalBonusScaleImages=(baf=figureRulesProcess.additionalBonusScaleImages,function(){baf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fish.15bea6baa4.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fishCoral.67a6510a15.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/fishSpawn.9027c73648.png":1.5*_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/special2.260f753f49.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/deepsea/special10.2a521f5b62.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(caf=figureRulesProcess.additionalBonusClasses,function(){caf.call(this),figureRulesProcess.deepseaBonusClasses()}),figureRulesProcess.thanksgivingday2021worldBonusClasses=function(){FigureRules.add(".episode_thanksgivingday2021world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/artifactPlatform.png"}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part101 .part",{frame:16}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part102 .part",{frame:17}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part103 .part",{frame:18}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part104 .part",{frame:19}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part105 .part",{frame:20}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part106 .part",{frame:21}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part107 .part",{frame:22}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part108 .part",{frame:23}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part109 .part",{frame:24}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part110 .part",{frame:25}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part201 .part",{frame:26}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part202 .part",{frame:27}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part203 .part",{frame:28}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part204 .part",{frame:29}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part205 .part",{frame:30}),FigureRules.add(".episode_thanksgivingday2021world .artifactPartCell.part206 .part",{frame:31}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem1",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem2",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem3",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem4",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock .lifeGem5",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_R .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_R.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_G .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_G.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_B .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_B.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_Y .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_Y.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_P .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_P.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_W .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_W.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCellLifeBlock.color_s .lifeGem",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusLife_multi.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell",{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .barCell.Middle",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusCenter.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell.TopLeftCorner",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusCorner.png","scale-x":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.TopRightCorner",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusCorner.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell.BottomLeftCorner",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusCorner.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.BottomRightCorner",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusCorner.png","scale-y":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.LeftSide",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusSide.png",rotate:-90}),FigureRules.add(".episode_thanksgivingday2021world .barCell.TopSide",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusSide.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell.RightSide",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusSide.png",rotate:90}),FigureRules.add(".episode_thanksgivingday2021world .barCell.BottomSide",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusSide.png","scale-y":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.VerticalTop",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusEdge.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell.VerticalMiddle",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusMiddle.png"}),FigureRules.add(".episode_thanksgivingday2021world .barCell.VerticalBottom",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusEdge.png","scale-y":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.HorizontalLeft",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusEdge.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_thanksgivingday2021world .barCell.HorizontalMiddle",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusMiddle.png",rotate:90}),FigureRules.add(".episode_thanksgivingday2021world .barCell.HorizontalRight",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cactusEdge.png",rotate:90}),FigureRules.add(".episode_thanksgivingday2021world .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cup.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_thanksgivingday2021world .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass1.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice1Blast1, .episode_thanksgivingday2021world .ice1Blast2, .episode_thanksgivingday2021world .ice1Blast3, .episode_thanksgivingday2021world .ice1Blast4, .episode_thanksgivingday2021world .ice1Blast5",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass1Die.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice1Blast2",{"background-position-x":240}),FigureRules.add(".episode_thanksgivingday2021world .ice1Blast3",{"background-position-x":480}),FigureRules.add(".episode_thanksgivingday2021world .ice1Blast4",{"background-position-x":480}),FigureRules.add(".episode_thanksgivingday2021world .ice1Blast5",{"background-position-x":480}),FigureRules.add(".episode_thanksgivingday2021world .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass2.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice2Blast1, .episode_thanksgivingday2021world .ice2Blast2",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass2Die.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice2Blast2",{"background-position-x":240}),FigureRules.add(".episode_thanksgivingday2021world .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass3.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice3Blast1, .episode_thanksgivingday2021world .ice3Blast2, .episode_thanksgivingday2021world .ice3Blast3",{"background-position-x":0,"background-position-y":0,"background-width":240,"background-height":223,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/grass3Die.png",width:240/180*Config.cellWidth,height:223/180*Config.cellHeight,"margin-left":-30/180*Config.cellWidth,"margin-top":-25/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .ice3Blast2",{"background-position-x":240}),FigureRules.add(".episode_thanksgivingday2021world .ice3Blast3",{"background-position-x":480}),FigureRules.add(".episode_thanksgivingday2021world .pearlCell.cell",{"background-image":""}),FigureRules.add(".episode_thanksgivingday2021world .pearlCellBg",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/fishBg.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .pearlCellBg.stable",{spriteVertical:!0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_thanksgivingday2021world .pearlLevel1.pearlCell .pearlCellBg",{"background-position-x":0,"background-position-y":0}),FigureRules.add(".episode_thanksgivingday2021world .pearlLevel2.pearlCell .pearlCellBg",{"background-position-x":180,"background-position-y":0}),FigureRules.add(".episode_thanksgivingday2021world .pearlLevel3.pearlCell .pearlCellBg",{"background-position-x":360,"background-position-y":0}),FigureRules.add(".episode_thanksgivingday2021world .pearlLevel4.pearlCell .pearlCellBg",{"background-position-x":540,"background-position-y":0}),FigureRules.add(".episode_thanksgivingday2021world .die_pearl",{"background-position-x":720,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/fishBg.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .pearl",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/fish.png",width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berry1.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berry2.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berry3.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berry1.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berry2.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variantbig1",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berrybig1.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variantbig2",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berrybig2.png"}),FigureRules.add(".episode_thanksgivingday2021world .frozen_frozenegg.variantbig3",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berrybig3.png"}),FigureRules.add(".episode_thanksgivingday2021world .icebergCellBg",{"background-width":156,"background-height":137,width:2.6*Config.cellWidth,height:137/60*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berryTreeX_xlarge.png","margin-left":-.4*Config.cellWidth,"margin-top":-.1*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .icebergCellBg.animate",{animation:{params:{"margin-top":[-.1*Config.cellHeight,-.1*Config.cellHeight]},duration:900}}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell .icebergCellBg.animateTakeLife4",{startFrame:0,spriteFrames:5,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell.icebergLevel3 .icebergCellBg",{frame:4}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell .icebergCellBg.animateTakeLife3",{startFrame:4,spriteFrames:5,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell.icebergLevel2 .icebergCellBg",{frame:8}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell .icebergCellBg.animateTakeLife2",{startFrame:8,spriteFrames:5,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell.icebergLevel1 .icebergCellBg",{frame:12}),FigureRules.add(".episode_thanksgivingday2021world .icebergHeadCell .icebergCellBg.nutTreeDie",{startFrame:12,spriteFrames:9,duration:700}),FigureRules.add(".episode_thanksgivingday2021world .icebergCellWater",{"background-width":151,"background-height":143,width:151/180*Config.cellWidth,height:143/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berryTreeLeaf.png","margin-left":-24/180*Config.cellWidth,"margin-top":160/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .icebergCellWater",{startFrame:0,spriteFrames:12,duration:1800,lastFrame:11,delay:[1e3,5e3],playRound:!0}),FigureRules.add(".episode_thanksgivingday2021world .flyingIceShard",{"background-position-x":0,"background-position-y":0,"background-width":273,"background-height":222,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berryTreeShard.png",width:273/180*Config.cellWidth,height:222/180*Config.cellHeight,"margin-left":-24/180*Config.cellWidth,"margin-top":-12/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .flyingIceShard.splash",{spriteFrames:4,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .icebergExplode",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .mermaidCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/ovenIdle.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:11,duration:1e3,playRound:!0,delay:[1e3,5e3]}),FigureRules.add(".episode_thanksgivingday2021world .mermaidCell .lifeBlock",{width:201/180*Config.cellWidth,height:71/180*Config.cellHeight,"background-width":201,"background-height":71,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/ovenLifes.png","margin-left":.9*Config.cellWidth,"margin-top":94/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .mermaidCell .lifeBlock .taskIco",{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/ovenFish.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .mermaidCellBg.ovenEating",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":120,"background-height":120,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/ovenEat.png","margin-left":-4/180*Config.cellWidth,"margin-top":-4/180*Config.cellHeight,spriteFrames:17,duration:1e3,delay:0}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell .cellStone",{"background-width":57,"background-height":62,width:.95*Config.cellWidth,height:62/60*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":-2/60*Config.cellWidth}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell.caviarCell3 .cellStone",{frame:0}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyR.png"}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyG.png"}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyB.png"}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyY.png"}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyP.png"}),FigureRules.add(".episode_thanksgivingday2021world .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyW.png"}),FigureRules.add(".episode_thanksgivingday2021world .fishcellBg.fish12",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/garment1.png"}),FigureRules.add(".episode_thanksgivingday2021world .fishcellBg.fish13",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/garment2.png"}),FigureRules.add(".episode_thanksgivingday2021world .fishcellBg.fish14",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/garment3.png"}),FigureRules.add(".episode_thanksgivingday2021world .fishcellBg.fish15",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/garment4.png"}),FigureRules.add(".episode_thanksgivingday2021world .strongboxCell .strongboxBg",{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/catSafe_xlarge.png","margin-left":-.25*Config.cellWidth,"margin-top":-125/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .strongboxCellLoot",{"background-position-x":0,"background-width":268,"background-height":350,width:268/180*Config.cellWidth,height:350/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/catSafeCollectItem.png","margin-left":-20/180*Config.cellWidth,"margin-top":-160/180*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .bugCellBg",{width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cakeIdle.png","margin-left":-5/60*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cakeIdle.png",width:2*Config.cellWidth,height:2.1*Config.cellHeight,"background-width":120,"background-height":126,spriteFrames:10,lastFrame:0,duration:700,delay:[1e3,3e3],playRound:!0}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .bugCellBg.blink",{animation:null}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/cakeAngry.png",spriteFrames:8,lastFrame:0,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .bugCellBg.die",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/bug/kingBugDie_xlarge.a019589917.png",spriteFrames:8,duration:800}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .mTask1 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/jellyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2021world .bugCell .mTask2 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/berryTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce.stable",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500,playRound:!0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce.magicCrabIce",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoCast.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .move_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .die_crabIce",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoDie.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:19,duration:1e3}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce_remove_animatePiece1",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce_remove_animatePiece2",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce_remove_animatePiece3",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce .life, .episode_autumnworld .decorator_crabIce .life",{opacity:"0"}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce .decoratorLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/dragonLifeBlock.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":20/60*Config.cellWidth,"margin-top":71/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce .lifeBar, .episode_autumnworld .decorator_crabIce .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce.lifeLevel1 .lifeBar, .episode_autumnworld .decorator_crabIce.lifeLevel2 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2.stable",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500,playRound:!0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2.takeLife",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2.magicCrabIce2",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoCast.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight,spriteFrames:6,duration:500}),FigureRules.add(".episode_thanksgivingday2021world .move_crabIce2",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoIdle.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":-16/60*Config.cellWidth,"margin-top":-25/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .die_crabIce2",{"background-position-x":0,"background-position-y":0,"background-width":104,"background-height":91,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tornadoDie.png",width:104/60*Config.cellWidth,height:91/60*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:19,duration:1e3}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2_remove_animatePiece1",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2_remove_animatePiece2",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2_remove_animatePiece3",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2 .life, .episode_autumnworld .decorator_crabIce2 .life",{opacity:"0"}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2 .decoratorLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/dragonLifeBlock.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":20/60*Config.cellWidth,"margin-top":71/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2 .lifeBar, .episode_autumnworld .decorator_crabIce2 .lifeBar",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_thanksgivingday2021world .decorator_crabIce2.lifeLevel1 .lifeBar, .episode_autumnworld .decorator_crabIce2.lifeLevel2 .lifeBar",{"background-color":"#f2342c"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box3.png",frame:0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell.gravityGroundLife2",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box2.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell.gravityGroundLife1",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box3.png"}),FigureRules.add(".episode_thanksgivingday2021world .groundLife2.gravityGroundCell",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box2.png"}),FigureRules.add(".episode_thanksgivingday2021world .groundLife3.gravityGroundCell",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box1.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell.gravityGroundExplode",{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell.gravityGroundExplodeCell2",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box2.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell.gravityGroundExplodeCell1",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/box2.png"}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png",frame:3}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.attributeColor2",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png","background-position-x":0}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.attributeColor3",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOyster.png","background-position-x":0}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.attributeColor4",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxShrimp.png","background-position-x":0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attribute_ground",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png",frame:0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attribute_ground.attributeColor2",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attribute_ground.attributeColor3",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOyster.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attribute_ground.attributeColor4",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxShrimp.png"}),FigureRules.add(".episode_thanksgivingday2021world .groundLife2.gravityGroundCell .attribute_ground",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .groundLife3.gravityGroundCell .attribute_ground",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundLife1.gravityGroundCell .attribute_ground",{opacity:1}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.flying",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-8/180*Config.cellWidth,"margin-top":-8/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png",scale:1}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.attributeColor3.flying",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxOyster.png"}),FigureRules.add(".episode_thanksgivingday2021world .attribute_ground.attributeColor4.flying",{"background-image":"../../../gems/site/img/features/thanksgivingday2021world/boxShrimp.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attributeIcon1",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tentacleIcon.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attributeIcon2",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/tentacleIcon.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attributeIcon3",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/oysterIcon.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundCell .attributeIcon4",{width:1.05*Config.cellWidth,height:186/180*Config.cellHeight,"background-width":189,"background-height":186,"margin-left":-6/180*Config.cellWidth,"margin-top":-6/180*Config.cellHeight,"background-image":"../../../gems/site/img/features/thanksgivingday2021world/shrimpIcon.png"}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundExplode1",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundExplode2",{opacity:0}),FigureRules.add(".episode_thanksgivingday2021world .gravityGroundExplode1",{opacity:0})},figureRulesProcess.additionalBonusScaleImages=(daf=figureRulesProcess.additionalBonusScaleImages,function(){daf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/thanksgivingday2021world/cactusCenter.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/cactusCorner.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/cactusEdge.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/cactusMiddle.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/cactusSide.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/cup.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/grass1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/grass2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/grass3.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/fish.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/fishBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/ovenLifes.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/ovenFish.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/garment1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/garment2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/garment3.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/garment4.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/catSafe_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/catSafeCollectItem.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/box1.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/box2.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/box3.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/boxOctopus.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/boxOyster.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/boxShrimp.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/oysterIcon.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/shrimpIcon.png":_Figure.scaleKoef,"../../../gems/site/img/features/thanksgivingday2021world/tentacleIcon.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(eaf=figureRulesProcess.additionalBonusClasses,function(){eaf.call(this),figureRulesProcess.thanksgivingday2021worldBonusClasses()});var JapanWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),application.on("game_fail",this.onGameFailed,this)},onEnter:function(){var e=this;BonusWorldView.prototype.onEnter.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onCompleteLevel:function(){var e=this;BonusWorldView.prototype.onCompleteLevel.call(this),setTimeout(function(){return e.scrollToTargetLevel()},1e3)},onGameFailed:function(){var e=this;episode.isBonusWorld()&&"japanworld"===episode.getEpisodeName()&&"game"===application.get("page")&&application.once("main",function(){setTimeout(function(){return e.scrollToTargetLevel()},1e3)},this)},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";1!==e&&(e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1))}}),JapanWorld=BonusWorld.extend({defaults:_.defaults({name:"japanworld",viewId:JapanWorldView,version:20230918,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:12,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,alwaysCancelNext:!1,prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"coins",amount:100},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:15,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5}]},{type:"middlePrize",level:22,prize:[{type:"coins",amount:200},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"coins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:12}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.japanworld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.japanworld .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"picture1",text:messages[this.get("name")+"Letter"]},once:"beforeEnter"},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.japanworld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:3e3,elements:[{el:".bonusWorldAnimations.japanworld .animationSprite4",persistentClass:"visible1"},{el:".bonusWorldAnimations.japanworld .animationSprite5",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.japanworld",persistentClass:"disappear"},{el:".bonusWorldAnimations.japanworld .animationSprite5",persistentClass:"parked"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.japanworld",persistentClass:"hidden"}]},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".bonusWorldUI.japanworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize3",scrollTo:".bonusWorldPrize.level3",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level3",persistentClass:"finished"}],id:100},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize8",scrollTo:".bonusWorldPrize.level8",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level8",persistentClass:"finished"}],id:101},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize15",scrollTo:".bonusWorldPrize.level15",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level15",persistentClass:"finished"}],id:102},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize22",scrollTo:".bonusWorldPrize.level22",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level22",persistentClass:"finished"}],id:103},{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize30",scrollTo:".bonusWorldPrize.level30",delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level30",persistentClass:"finished"}],id:104},{type:StoryTalkElement,owner:this,once:"takeMiddlePrize30",talkKey:5},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,on:"takeMiddlePrize30",delayAfter:0,id:200}]}),this.addComponent(ProlongateWorldComponent)},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)},renderChests:function(){var t=this;BonusWorld.prototype.renderChests.call(this),this.get("prizes").forEach(function(e){$(".episode_japanworld .scrolledBlock .bonusWorldPrizes .level"+e.level).toggleClass("finished",e.level+1<t.getCurrentLevel())})}}),zaf;figureRulesProcess.japanworldBonusClasses=function(){featuresAdder.addFeature("japanworld","episodecollectiondroppable"),featuresAdder.addFeature("japanworld","dropcell_chest"),featuresAdder.addFeature("japanworld","coinchest_carrotchest")},figureRulesProcess.additionalBonusClasses=(zaf=figureRulesProcess.additionalBonusClasses,function(){zaf.call(this),figureRulesProcess.japanworldBonusClasses()});var Halloween2023WorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeProgressBar=new ProgressPrizeProgressBarView({el:$('<div class="progressBar"><div class="progressBarLineWrapper"><div class="progressBarLine"></div></div><div class="prizes"></div></div>').appendTo(this.$el),model:this.model.cmp("taskPrize")}),this.infoPrizeBtn=new RewardInfoButton({el:this.$(".mPrizeControllerOuterProgressBar .markSmall"),model:this.model}),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new BonusWorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.updateRandomLevelBtn(),this.appendRadialProgressbar();var e=this.model.cmp("task"),t=this.model.cmp("prizes");this.model.on("onCompleteLevel",this.updateRandomLevelBtn,this),e.on("afterCompleteTask",this.updateRandomLevelBtn,this),t.on("change:points",this.updateRandomLevelBtn,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.cmp("task"),t=this.model.cmp("prizes");this.model.off("onCompleteLevel",this.updateRandomLevelBtn,this),e.off("afterCompleteTask",this.updateRandomLevelBtn,this),t.off("change:points",this.updateRandomLevelBtn,this),this.radialProgressBar.remove()},updateRandomLevelBtn:function(){var e=this.model.cmp("task"),t=this.model.cmp("prizes"),i=this.model.getCurrentLevel();this.$randomBtn.toggleClass("active",i>this.model.get("levelsInEpisode")&&(e.hasIncompleteTasks()||!t.isFinished())),this.$randomBtn.find(".mRandomLevelBtnText").html(i)},appendRadialProgressbar:function(){this.rcButton=$(".halloween2023world.rewardChainBtn"),this.radialProgressBar=new RadialProgressBar({el:$(".mainTemplates .radialProgressBar").clone().appendTo(this.rcButton),model:new PrizeProgressBarViewModel(this.model.cmp("prizes")),min:-180,max:0})}}),RewardInfoButton=Backbone.View.extend({events:{click:"onOpen"},onOpen:function(){new RewardTicketInfo({world:this.model})}}),RewardTicketInfo=TicketInfo.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TicketInfo.prototype.onOpen.call(this),this.$el.attr("from","rewardInfo")}}),BonusWorldInfoButton=Backbone.View.extend({events:{click:"onOpen"},onOpen:function(){new BonusWorldTicketInfo({world:this.model})}}),BonusWorldTicketInfo=TicketInfo.extend({templateClass:".ticketsInfoWindow_template",events:{click:"close"},onOpen:function(){TicketInfo.prototype.onOpen.call(this);var e=this.options.world.get("name");this.$(".description1").html(messages[e+"HelpWindowDescription1"]||""),this.$(".description2").html(messages[e+"HelpWindowDescription2"]||""),this.$(".description3").html(messages[e+"HelpWindowDescription3"]||""),this.$(".pressToClose").html(messages[e+"HelpWindowExitButton"]||"")}}),Halloween2023World=BonusWorld.extend({defaults:_.defaults({name:"halloween2023world",viewId:Halloween2023WorldView,version:20231005,levelsInEpisode:80,durationDays:!1,episode:1,level:16,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:16,saveReplayLevel:!0,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,actionQueue:new ActionQueue,withoutInnerWindow:!0,alwaysCancelNext:!1,livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},progressComponent:ProgressSimpleIncrementComponent},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";this.addComponent(RandomLevelComponent,{lowerMargin:21,upperMargin:this.get("levelsInEpisode"),useLevelSet:!0,saveReplayLevel:!0});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.NORMAL},{id:4,material:PartMaterial.RARE},{id:5,material:PartMaterial.TRASH},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.TRASH},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.TRASH},{id:14,material:PartMaterial.RARE},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND},{id:17,material:PartMaterial.NORMAL},{id:18,material:PartMaterial.RARE},{id:19,material:PartMaterial.LEGEND},{id:20,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,1),o.ingredient(2,1),o.ingredient(3,1),o.ingredient(4,1)],prizes:[{products:[{type:"GoodProduct",goodId:i,addTime:1800}]}]},{id:2,ingredients:[o.ingredient(5,1),o.ingredient(6,1),o.ingredient(7,1),o.ingredient(8,1)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(9,1),o.ingredient(10,1),o.ingredient(11,1),o.ingredient(12,1)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}]},{id:4,ingredients:[o.ingredient(13,1),o.ingredient(14,1),o.ingredient(15,1),o.ingredient(16,1)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(17,1),o.ingredient(18,1),o.ingredient(19,1),o.ingredient(20,1)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]}]});this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,rule:function(){return 2<t.getCurrentLevel()},minMove:3,chanceStrategyCls:OnRandomMoveChanceStrategy,dropperPartGeneratorCls:MaterialDropperPartGenerator,movesOrder:MovesOrder.straight,materials:{trash:.36,normal:.28,rare:.21,legend:.15},parts:o.getParts()})]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.36},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.NORMAL,chance:.21},{type:PartMaterial.NORMAL,chance:.15}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.36},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.NORMAL,chance:.21},{type:PartMaterial.NORMAL,chance:.15}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:2,coins:500,count:2,parts:[{type:PartMaterial.TRASH,chance:.36},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.NORMAL,chance:.21},{type:PartMaterial.NORMAL,chance:.15}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:700,count:3,parts:[{type:PartMaterial.TRASH,chance:.36},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.NORMAL,chance:.21},{type:PartMaterial.NORMAL,chance:.15}]}]}),this.addComponent(TriesComponent,{conditioner:TriesConditionerPresets.alwaysTrue,reminderWindowThreshold:2,variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.prizeController=this.addComponent(PrizeController,{world:this,viewClass:Halloween2023WorldPrizeControllerView,accountant:new PrizeProgressAccount([1,2,3,5,5,10,15,20,25,30,40]),prizes:[{progress:1,type:"middlePrize",products:[{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:3,type:"middlePrize",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:4,type:"middlePrize",products:[{type:"CoinsProduct",amount:50},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:6,type:"middlePrize",products:[{type:"SpinProduct",amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]},{progress:7,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:8,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:9,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:10,type:"middlePrize",products:[{type:"CoinsProduct",amount:150}]},{progress:11,type:"middlePrize",products:[{type:"GroupBoosterProduct",amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:21600},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:21600}]},{progress:1,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]},{progress:2,type:"battlePass",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]},{progress:3,type:"battlePass",products:[{type:"CoinsProduct",amount:100}]},{progress:4,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{progress:5,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]},{progress:6,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:7,type:"battlePass",products:[{type:"CoinsProduct",amount:150}]},{progress:8,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]},{progress:9,type:"battlePass",products:[{type:"CoinsProduct",amount:150}]},{progress:10,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:11,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:21600},{type:"SpinProduct",amount:1}]}]}),this.battlePass=new BattlePass({world:this,catchupWindowActivator:new EventSignal("prizeControllerAfterTakePrize",this),catchupWindowRule:catchupWindowShowRules.byPrizeControllerThreshold(4),instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:8,boosterId:BoosterTypes.DeleteRow},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}}),this.addComponent(TicketsComponent,{id:"gold"}),this.addComponent(InvestigationTaskComponent,{name:this.get("name"),goldSource:new TicketsGoldSource(this.cmp("gold")),tasks:TasksFromGroup([{id:1,group:1,price:50},{id:2,group:2,price:200},{id:3,group:2,price:300},{id:4,group:2,price:400},{id:5,group:3,price:300},{id:6,group:3,price:400},{id:7,group:4,price:200},{id:8,group:5,price:300},{id:9,group:5,price:400},{id:10,group:6,price:250},{id:11,group:6,price:450},{id:12,group:6,price:300},{id:13,group:7,price:500}]),locations:[{name:"1",event:"selectLoacation1",required:[1,2,3,4,5,6]},{name:"2",event:"selectLoacation2",required:[7,8,9,10,11,12]},{name:"1",event:"selectLoacation3",required:[13]}]}),this.addComponent(ProgressPrizeComponent,{id:"taskPrize",counter:new TaskProgressPrizeCounter(this.cmp("task")),prizes:[{progress:3,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:7,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:13,type:"finalPrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"}]}]}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:101,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.halloween2023world",persistentClass:"visible"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2023world .animationSprite1",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2023world .animationSprite2",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2023world",persistentClass:"shaking"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.halloween2023world .animationSprite3",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.halloween2023world",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.halloween2023world",persistentClass:"hidden"}],delayAfter:0}]},{type:StoryGroup,id:102,once:"beforeEnter",stories:[{type:StoryTalkElement,owner:this,talkKey:2},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"beforeEnter",delayAfter:2e3},{type:StoryTalkElement,owner:this,delay:1e3,talkKey:3}]},{type:StoryGroup,id:103,once:"beforeEnter",stories:[{type:StoryCallbackElement,callback:function(){t.cmp("task").goldSource.set(50)}},{type:StoryForceElement,owner:this,scrollTo:".investigationTask .secretView.task1",el:".investigationTask .secretView.task1 .icon",name:this.get("name")+"Force0"},{type:StoryForceElement,window:InvestigationOpenTaskWindow,el:"#investigationOpenTaskWindow .button",name:this.get("name")+"Force1",page:this.getPageName()}]}].concat(this._taskStory(1,4,5),[{type:StoryForceElement,id:104,on:"afterCompleteTask1",owner:this.cmp("task"),el:".bonusWorldUI.".concat(this.getName()," .startCurrentLevel"),name:this.get("name")+"Force2"},{type:StoryGroup,id:105,once:"prizeControllerBeforeTakePrize",stories:[{type:StoryForceElement,page:this.getPageName(),el:".halloween2023world.rewardChainBtn",name:this.get("name")+"Force5"},{type:StoryForceElement,page:"rewardChain",el:".rewardChain .mPrizeControllerOuterProgressBarWrapper",name:this.get("name")+"Force6",delayAfter:0}],delayAfter:0},{type:StoryGroup,id:106,once:"onFinishLevel3",stories:[{type:StoryForceElement,el:".halloween2023world .mForgeBtn",name:this.get("name")+"Force3"},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force4"}]}],this._taskStory(2,6,7),this._taskStory(3,8,9),this._taskStory(4,10,11),this._taskStory(5,12,13),this._taskStory(6,14,15),[{type:StoryTalkElement,owner:this.cmp("task"),on:"selectLoacation2",talkKey:16,id:107}],this._taskStory(7,17,18),this._taskStory(8,19,20),this._taskStory(9,21,22),this._taskStory(10,23,24),this._taskStory(11,25,26),this._taskStory(12,27,28),[{type:StoryTalkElement,owner:this.cmp("task"),on:"selectLoacation3",talkKey:29,id:108}],this._taskStory(13,30,31),[{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.cmp("rulsRunLevel").isCanRunLevel()},owner:this,once:"onFinishLevel81",delayAfter:0,id:109},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this.cmp("task"),once:"afterCompleteTask13",delayAfter:0,id:110}])}),this.addComponent(PrizeMarksDropper,{chance:12,defaultMarkLimit:50}),this.addComponent(CollectorsAgency),this.cmp("collectors").add(BoxPartCollector),this.cmp("collectors").add(TicketsCollector,{componentId:"gold"}),this.addComponent(ReturnWorldComponent),this.addComponent(SuguestComponent,{suguestions:[new InvestigationTaskSuguestion(this,{component:this.cmp("task")}),new NodeSuguestion(this,new Getter(function(){return t.view.startLevel}))]})},episodeChanged:function(){return!0},onClickBonusWorldTutorial:function(){1===this.getCurrentLevel()&&episode.get("num")===this.get("name")&&gameView.start(1)},renderChests:function(){var t=this;BonusWorld.prototype.renderChests.call(this),this.get("prizes").forEach(function(e){$(".episode_halloween2023world .scrolledBlock .bonusWorldPrizes .level"+e.level).toggleClass("finished",e.level+1<t.getCurrentLevel())})},openPrizeControllerInfo:function(){this.prizeController.getNextProgressPoints()?new PrizeControllerInfoWindow({world:this,prizeController:this.prizeController}):this.get("hasBattlePass")||new CatchUpBattlePassWindow({model:this.battlePass})},getProgress:function(){return this.prizeController.getCurrProgressPoints()},_taskStory:function(e,t,i){return[{type:StoryTalkElement,id:200+e,owner:this.cmp("task"),on:"beforeCompleteTask".concat(e),talkKey:t,delayAfter:0},{type:StoryTalkElement,id:300+e,owner:this.cmp("task"),on:"afterCompleteTask".concat(e),talkKey:i}]}}),Halloween2023WorldPrizeControllerView=PrizeControllerView.extend({totalPrizeOnPage:4,render:function(){var e=this,t=_.values(this.model.getPrizesGrouped("progress"));new PrizeControllerOuterProgressBar({el:$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$(".mPrizeControllerOuterProgressBarWrapper")),model:this.model}),this.infoPrizeBtn=new RewardInfoButton({el:this.$(".mPrizeControllerOuterProgressBar .markSmall"),model:this.model.get("world")});var n=this.$(".invisible .rewardObject"),r=$(".mainTemplates .rewardComponentMarker"),i=$(".mainTemplates .rewardComponentPage"),o=$(".invisible.mainTemplates .progressBarByLevel"),a=this.$el.find(".freePlate"),s=this.$el.find(".battlepassPlate");this.page=this.getPageId(),this.$wrapper=this.$el.find(".rewardComponentWrapper"),this.$wrapper.addClass("page"+this.page),this.clarification=null,this.needClarify=!0;var l=i.clone(),d=o.clone();l.addClass(this.model.get("world").get("name")),l.append(d),a.html(messages.forFree),s.html(messages[this.model.get("world").get("name")+"BattlePassTitle"]),t.forEach(function(e){var a=!1;e.length<2&&(a=!0),e.forEach(function(e){var t=n.clone();if(t.addClass("progress"+e.progress).addClass(e.type).data("id",e.cid),a){var i=n.clone();i.addClass("progress"+e.progress).addClass("placeholder"),l.append(i)}if("battlePass"===e.type||"finalPrize"===e.type){var o=r.clone();o.addClass("marker"+e.progress),o.html(e.progress),d.find(".progressMarks").append(o)}new UserPrizesView({el:t.find(".prizes"),model:new UserPrizes(e.prize),isGroup:!0}),l.append(t)},this)},this),this.$wrapper.append(l),this.mapController=BigMapControllerFactory.create({el:this.$wrapper,bgEl:l,mainEl:this.$("#user"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.needClarify=!1,e.closeClarification()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.model.get("world").battlePass&&(this.$bpButton=this.$(".invisible .buyBattlePassBtn").clone(),this.$bpButton.addClass(this.model.get("world").get("name")),this.$el.find(".background").append(this.$bpButton)),this.createButton()},getPageId:function(){return this.model.getProgress()%this.totalPrizeOnPage+1}}),Dbf;figureRulesProcess.halloween2023worldBonusClasses=function(){FigureRules.add(".episode_halloween2023world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/halloween2023world/artifactPart.576e87ac56.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_halloween2023world .artifactPartCell.part20 .part",{frame:19}),FigureRules.add(".episode_halloween2023world .secondAttribute_prizePointMark",{"background-position-x":0,"background-position-y":0,"background-width":74,"background-height":84,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/halloween2023world/prizeMark.d406dea1d5.png",width:74/180*Config.cellWidth,height:84/180*Config.cellHeight,"margin-top":.5*Config.cellHeight,"margin-left":.5*Config.cellWidth}),FigureRules.add(".episode_halloween2023world .fortHeadCell .taskIconContainer .taskIco.color_CollectCaviar",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/caviar_spider/spiderTask.59d56775ce.png","background-height":60,"background-width":60,height:1*Config.cellHeight,width:1*Config.cellWidth}),FigureRules.add(".episode_halloween2023world .attribute_key",{"margin-top":0*Config.cellHeight}),featuresAdder.addFeature("halloween2023world","fishball_mysteryball"),featuresAdder.addFeature("halloween2023world","tortoise_plant"),featuresAdder.addFeature("halloween2023world","coinchest_candychest"),featuresAdder.addFeature("halloween2023world","caviar_spider"),featuresAdder.addFeature("halloween2023world","bug_ghost")},figureRulesProcess.additionalBonusClasses=(Dbf=figureRulesProcess.additionalBonusClasses,function(){Dbf.call(this),figureRulesProcess.halloween2023worldBonusClasses()});var LeakyPierWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.checkPoint=$(".levels #level1"),this.listenTo(this.model,"onCompleteLevel",this.onCompleteLevel)},onCompleteLevel:function(){BonusWorldView.prototype.onCompleteLevel.call(this),this.afterLoadPage()},onFailLevel:function(){BonusWorldView.prototype.onFailLevel.call(this),this.afterLoadPage()},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.afterLoadPage()},updatePirate:function(){var t=this.model.getCurrentLevel()-1;0!==t&&($(".mapAnimationsMiddle .sprite1").addClass("hidden"),this.checkPoint.removeClass("pirate"),this.checkPoint=$(".levels #level".concat(t)),this.checkPoint.addClass("pirate"),this.checkPoint.toggleClass("animateIdle",!this.model.get("prizes").find(function(e){return e.level===t})))},scrollToTargetLevel:function(){var e=this.model.getCurrentLevel(),t=".sprite1";e<=this.model.get("levelsInEpisode")&&(t="#level"+e),episodeView.mapController.scrollTo(t,!1)},showPrizeProgress:function(e,t){var i=this.model.getProgressData();i&&(e.css("width",i.lastPercentage+"%"),e.addClass("animating"),t.html(i.lastValue+"/"+i.total),setTimeout(function(){e.css("width",i.percentage+"%"),t.addClass("animating"),t.html(i.value+"/"+i.total)},1e3))},afterLoadPage:function(){var e=this;application.waitPage("main").then(function(){e.updatePirate(),setTimeout(function(){return e.scrollToTargetLevel()},500)})}}),LeakyPierWorld=BonusWorld.extend({defaults:_.defaults({name:"leakypierworld",viewId:LeakyPierWorldView,version:20231030,production:!0,levelsInEpisode:30,episode:1,level:16,durationDays:5,showTimer:!0,alwaysCancelNext:!1,minEpisodeToEnter:1,minLevelToEnter:28,finishWindowInStories:!0,forceId:!0,openDate:null,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,skipLevelPublication:!0,prizes:[{type:"middlePrize",level:4,prize:[{type:"good",name:GoodTypes.unlimitedLifes,cssClass:"unlimitedLifes",amount:.5},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1}]},{type:"middlePrize",level:9,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5}]},{type:"middlePrize",level:15,prize:[{type:"coins",amount:50},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:GoodTypes.unlimitedLifes,cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:22,prize:[{type:"coins",amount:100},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:GoodTypes.starInField,cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",level:30,prize:[{type:"coins",name:"coins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:GoodTypes.unlimitedKeys,cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.prepareStoryController(),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this,defaultPart:new EpisodeCollection.Part({id:1})})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest"})]}),this.addComponent(ProlongateWorldComponent)},prepareStoryController:function(){var e=1;this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.leakypierworld .animationSprite1",persistentClass:"visible1"}],id:e++},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1,id:e++},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.leakypierworld .animationSprite2",persistentClass:"visible1"}],id:e++},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2,id:e++},{type:StoryAnimationElement,owner:this.questController,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.leakypierworld .animationSprite3",persistentClass:"visible1"}],id:e++},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3,id:e++},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,elements:[{el:".bonusWorldAnimations.leakypierworld .animationSprite4",persistentClass:"visible1"}],id:e++},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4,id:e++},{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".bonusWorldAnimations.leakypierworld",persistentClass:"hidden"}],id:e++},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0,groupPrize:!0},id:e++},{type:StoryForceElement,owner:this,once:"enter",el:".bonusWorldUI.leakypierworld .startCurrentLevel",name:this.get("name")+"Force0",id:e++},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize4",talkKey:5,id:e++},{type:StoryTalkElement,owner:this,once:"winLevel7",talkKey:6,id:e++},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize9",talkKey:7,id:e++},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize15",talkKey:8,id:e++},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize22",talkKey:9,id:e++},{type:StoryTalkElement,owner:this,once:"winLevel28",talkKey:10,id:e++},{type:StoryTalkElement,owner:this,once:"winLevel30",talkKey:11,id:e++},this.getAnimationElement(4,102),this.getAnimationElement(9,103),this.getAnimationElement(15,104),this.getAnimationElement(22,105),{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,params:{groupPrize:!0,showAnimatedPrizesWindow:!0,prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize},on:"onFinishLevel30",id:101},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:12,id:e++}]})},getProgressData:function(){for(var e=this.getCurrentLevel()-1,t=-1,i=this.get("prizes"),o=0;o<i.length;o++)if(i[o].level>=e){t=o;break}if(-1===t)return!1;var a=0<t?i[t-1].level:0,n=e-a,r=i[t].level-a,s=Math.max(0,n-1);return{lastValue:s,value:n,total:r,lastPercentage:Math.ceil(100*Math.min(1,s/r)),percentage:Math.ceil(100*Math.min(1,n/r))}},getAnimationElement:function(e,t){return{type:StoryAnimationElement,owner:this,once:"takeMiddlePrize".concat(e),scrollTo:".bonusWorldPrize.level".concat(e),delayBefore:2500,delayAfter:1e3,updateAlways:!0,elements:[{el:".bonusWorldPrize.level".concat(e),persistentClass:"finished"}],id:t}}}),mcf,ncf;figureRulesProcess.leakypierworldBonusClasses=function(){featuresAdder.addFeature("leakypierworld","episodecollectiondroppable"),featuresAdder.addFeature("leakypierworld","dropcell_rustyanchorcell")},figureRulesProcess.additionalBonusScaleImages=(mcf=figureRulesProcess.additionalBonusScaleImages,function(){mcf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/leakypierworld/special8.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(ncf=figureRulesProcess.additionalBonusClasses,function(){ncf.call(this),figureRulesProcess.leakypierworldBonusClasses()});var CloudRace2=BonusWorld.extend({defaults:_.defaults((_$defaults9={name:"cloudrace2",version:20210730,production:!1,levelsInEpisode:100,durationDays:!1,helpWindow:!0,showFinalForce:!0,suggestPlayForLife:!0},_defineProperty(_$defaults9,"helpWindow",!0),_defineProperty(_$defaults9,"episode",1),_defineProperty(_$defaults9,"level",16),_defineProperty(_$defaults9,"minEpisodeToEnter",2),_defineProperty(_$defaults9,"minLevelToEnter",2),_defineProperty(_$defaults9,"forceId",!0),_defineProperty(_$defaults9,"closeForNew",!1),_defineProperty(_$defaults9,"allowAfterWin",!0),_defineProperty(_$defaults9,"allowPaid",!0),_defineProperty(_$defaults9,"allowProlong",!1),_defineProperty(_$defaults9,"prolongMaxTimes",1),_defineProperty(_$defaults9,"actionQueue",new ActionQueue),_defineProperty(_$defaults9,"endDate",new Date("2021/09/21 00:00")),_defineProperty(_$defaults9,"finishWindowInStories",!0),_defineProperty(_$defaults9,"livesInstance",new BonusWorldLives),_defineProperty(_$defaults9,"helpWindowPrize",[{type:"good",name:"unlimitedBonusWorldLives",amount:2}]),_defineProperty(_$defaults9,"livesConfig",{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500}),_defineProperty(_$defaults9,"showProgress",!0),_defineProperty(_$defaults9,"sounds",{narrator:!1,pirate1:!1,pirate2:!1,pirate3:!1,pirate4:!1,pirate5:!1,girl1:!1,girl2:!1,girl3:!1,mabel1:!1,mabel2:!1,mabel3:!1,jack1:!1,jack2:!1,mage1:!1,mage2:!1,mage3:!1,doc1:!1,doc2:!1,doc1mage1:!1}),_defineProperty(_$defaults9,"unlimitedName","unlimitedBonusWorldLives"),_defineProperty(_$defaults9,"prizes",[]),_$defaults9),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.battlePass=new BattlePass({world:this}),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:43200,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:800},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:28800,goodId:"starInField"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:14400,goodId:"starInField"}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:1500},{type:"GoodProduct",addTime:43200,goodId:"addThreeMoves"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:1e3},{type:"GoodProduct",addTime:28800,goodId:"addThreeMoves"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:14400,goodId:"addThreeMoves"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:2e3},{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:2,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:172800,goodId:"unlimitedLifes"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:1200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:129600,goodId:"unlimitedLifes"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:700},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:86400,goodId:"unlimitedLifes"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:4,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:9,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:150}]},{level:14,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:19,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:24,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:29,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:7200,goodId:"starInField"}]},{level:34,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:39,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:44,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:49,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:54,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:59,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:1800,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:64,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:69,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:74,type:"middlePrize",products:[{type:"GoodProduct",addTime:10800,goodId:"starInField"},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:10800,goodId:"addThreeMoves"}]},{level:79,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:84,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"}]},{level:89,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:94,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"CoinsProduct",amount:350},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"}]},{level:99,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"GoodProduct",addTime:57600,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:57600,goodId:"starInField"}]},{level:5,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:10,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"CoinsProduct",amount:150},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"}]},{level:15,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"}]},{level:20,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:21600,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:200}]},{level:25,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:150}]},{level:30,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:14400,goodId:"unlimitedBonusWorldLives"}]},{level:35,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:21600,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:150}]},{level:40,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:150}]},{level:45,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:50,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:100}]},{level:55,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"}]},{level:60,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:65,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:300}]},{level:70,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:75,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"CoinsProduct",amount:250}]},{level:80,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:85,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"}]},{level:90,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:95,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives"},{type:"GoodProduct",addTime:14400,goodId:"starInField"}]},{level:100,type:"battlePass",products:[{type:"GoodProduct",addTime:115200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:115200,goodId:"starInField"},{type:"CoinsProduct",amount:1e3}]}]}),this.artifactController=new ArtifactController({world:this,artifactWorkshopMinLevel:2,container:".regatta-cloudrace2 .scrollWrapper",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByParts,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[1,2,3,4,5,6,7,8,9,10]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:200,parts:[{type:PartMaterial.NORMAL,chance:1}]},{dropType:Artifacts.PartShopByMaterial,id:2,coins:600,parts:[{type:PartMaterial.NORMAL,chance:.6},{type:PartMaterial.RARE,chance:.4}]},{id:3,coins:699,dropType:Artifacts.PartShopByMaterial,parts:[{type:"normal",chance:.5},{type:"rare",chance:.3,box:[1]},{type:"legendary",chance:.2,box:[2]}]}]},artifactWorkshop:{partSource:new Artifacts.PartDroopperByMaterial({chances:{15:55,7:55},perMoveChance:{15:{normal:.35,rare:.15,legend:.05},7:{normal:.3,rare:.2,legend:.05}}}),config:{showAll:!0,parts:[{id:1,chance:0,material:"normal"},{id:2,material:"normal",chance:.5},{id:3,material:"normal",chance:.5},{id:4,material:"normal",chance:.5},{id:5,material:"normal",chance:.5},{id:6,material:"normal",chance:.5},{id:7,material:"normal",chance:.5},{id:8,material:"rare",chance:.375},{id:9,material:"rare",chance:.375},{id:10,material:"normal",chance:.5},{id:11,material:"normal",chance:.5},{id:12,material:"rare",chance:.375},{id:13,material:"legendary",chance:.125},{id:14,material:"rare",chance:.375},{id:15,material:"normal",chance:.5},{id:16,material:"rare",chance:.375},{id:17,material:"legendary",chance:.125},{id:18,material:"rare",chance:.375},{id:19,material:"rare",chance:.375},{id:20,material:"legendary",chance:.125}],artifacts:[{id:1,parts:[1,2,3,4],arrangePartsByQuality:!0,cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:2,parts:[5,6,7,8],arrangePartsByQuality:!0,cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:3,parts:[10,11,9,12],arrangePartsByQuality:!0,cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:4,parts:[13,14,15,16],arrangePartsByQuality:!0,cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],arrangePartsByQuality:!0,cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"spins",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:7200,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:3},{type:"spins",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}}),this.storyController=this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryTalkElement,owner:this,once:"beforeEnter",id:1,talkKey:1},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"beforeEnter",id:2},{type:StoryTalkElement,owner:this,once:"beforeEnter",id:3,talkKey:2},{type:StoryForceElement,owner:this,once:"beforeEnter",id:4,el:".regattaStartBtn",name:"cloudrace2Force0"},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",id:7,talkKey:3},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:8,talkKey:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",id:9,talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",id:10,talkKey:6},{type:StoryTalkElement,owner:this,once:"onFinishLevel7",id:11,talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel8",id:12,talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel9",id:13,talkKey:9},{type:StoryTalkElement,owner:this,once:"onFinishLevel11",id:14,talkKey:10},{type:StoryTalkElement,owner:this,once:"onFinishLevel12",id:15,talkKey:11},{type:StoryTalkElement,owner:this,once:"onFinishLevel13",id:16,talkKey:12},{type:StoryTalkElement,owner:this,once:"onFinishLevel14",id:17,talkKey:13},{type:StoryTalkElement,owner:this,once:"onFinishLevel15",id:18,talkKey:14},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",id:19,talkKey:15},{type:StoryTalkElement,owner:this,once:"onFinishLevel18",id:20,talkKey:16},{type:StoryTalkElement,owner:this,once:"onFinishLevel19",id:21,talkKey:17},{type:StoryTalkElement,owner:this,once:"onFinishLevel21",id:22,talkKey:18},{type:StoryTalkElement,owner:this,once:"onFinishLevel22",id:23,talkKey:19},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:24,talkKey:20},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",id:25,talkKey:21},{type:StoryTalkElement,owner:this,once:"onFinishLevel27",id:26,talkKey:22},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:27,talkKey:23},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",id:28,talkKey:24},{type:StoryTalkElement,owner:this,once:"onFinishLevel31",id:28,talkKey:25},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place1",id:29,talkKey:26},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place2",id:30,talkKey:27},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place3",id:31,talkKey:28},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35NotPrize",id:32,talkKey:29},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Prize",id:33,talkKey:30},{type:StoryTalkElement,owner:this,once:"onFinishLevel37",id:34,talkKey:31},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:35,talkKey:32},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",id:36,talkKey:33},{type:StoryTalkElement,owner:this,once:"onFinishLevel42",id:36,talkKey:34},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:37,talkKey:35},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",id:38,talkKey:36},{type:StoryTalkElement,owner:this,once:"onFinishLevel47",id:39,talkKey:37},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",id:40,talkKey:38},{type:StoryTalkElement,owner:this,once:"onFinishLevel52",id:41,talkKey:39},{type:StoryTalkElement,owner:this,once:"onFinishLevel55",id:42,talkKey:40},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place1",id:43,talkKey:41},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place2",id:44,talkKey:42},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place3",id:45,talkKey:43},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55NotPrize",id:46,talkKey:44},{type:StoryTalkElement,owner:this,once:"onFinishLevel57",id:47,talkKey:45},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:48,talkKey:46},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",id:49,talkKey:47},{type:StoryTalkElement,owner:this,once:"onFinishLevel63",id:50,talkKey:48},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:51,talkKey:49},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",id:52,talkKey:50},{type:StoryTalkElement,owner:this,once:"onFinishLevel67",id:53,talkKey:51},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:54,talkKey:52},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",id:54,talkKey:53},{type:StoryTalkElement,owner:this,once:"onFinishLevel72",id:55,talkKey:54},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place1",id:56,talkKey:55},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place2",id:57,talkKey:56},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place3",id:58,talkKey:57},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75NotPrize",id:59,talkKey:58},{type:StoryTalkElement,owner:this,once:"onFinishLevel76",id:60,talkKey:59},{type:StoryTalkElement,owner:this,once:"onFinishLevel77",id:61,talkKey:60},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:62,talkKey:61},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:62,talkKey:62},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",id:63,talkKey:63},{type:StoryTalkElement,owner:this,once:"onFinishLevel81",id:64,talkKey:64},{type:StoryTalkElement,owner:this,once:"onFinishLevel82",id:65,talkKey:65},{type:StoryTalkElement,owner:this,once:"onFinishLevel83",id:66,talkKey:66},{type:StoryTalkElement,owner:this,once:"onFinishLevel84",id:67,talkKey:67},{type:StoryTalkElement,owner:this,once:"onFinishLevel87",id:68,talkKey:68},{type:StoryTalkElement,owner:this,once:"onFinishLevel89",id:69,talkKey:69},{type:StoryTalkElement,owner:this,once:"onFinishLevel89",id:70,talkKey:70},{type:StoryTalkElement,owner:this,once:"onFinishLevel93",id:71,talkKey:71},{type:StoryTalkElement,owner:this,once:"onFinishLevel94",id:72,talkKey:72},{type:StoryTalkElement,owner:this,once:"onFinishLevel94",id:73,talkKey:73},{type:StoryTalkElement,owner:this,once:"onFinishLevel96",id:74,talkKey:74},{type:StoryTalkElement,owner:this,once:"onFinishLevel98",id:75,talkKey:75},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place1",id:76,talkKey:76},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place2",id:77,talkKey:77},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place3",id:78,talkKey:78},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100NotPrize",id:79,talkKey:79},{type:StoryTalkElement,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:80,talkKey:80},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"afterRegattaLineCrossedAtLevel100",id:81},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.cloudrace2",name:"cloudrace2Force1"},{type:StoryForceElement,owner:this.artifactController,once:"activate",page:"artifacts",id:202,el:".artifactWorkshop.cloudrace2 .tree .button1",name:"cloudrace2Force2"}]})}}),DeepSeaView=BonusWorldView.extend({onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.questController.tasks.on("change",this.updateProgressBar,this),this.updateProgressBar()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.questController.tasks.on("change",this.updateProgressBar,this)},updateProgressBar:function(){var e=this.$(".mPrizeControllerOuterProgressBar .progressBarLine"),t=this.model.questController.getProgressToNextPrize();this.$(".mPrizeControllerOuterProgressBar").toggleClass("active",!!this.model.questController.getNextPrizedTask()),e.css("width",t+"%")}}),DeepSeaWorld=BonusWorld.extend({defaults:_.defaults((_$defaults10={name:"deepsea",version:20210817,viewId:DeepSeaView,levelsInEpisode:45,helpWindow:!0,closeForNew:!1,lastLevelOpen:!0,showFinalForce:!0},_defineProperty(_$defaults10,"helpWindow",!1),_defineProperty(_$defaults10,"durationDays",!1),_defineProperty(_$defaults10,"production",!0),_defineProperty(_$defaults10,"episode",1),_defineProperty(_$defaults10,"level",1),_defineProperty(_$defaults10,"minEpisodeToEnter",2),_defineProperty(_$defaults10,"minLevelToEnter",2),_defineProperty(_$defaults10,"forceId",!0),_defineProperty(_$defaults10,"actionQueue",new ActionQueue),_defineProperty(_$defaults10,"finishWindowInStories",!0),_defineProperty(_$defaults10,"withoutInnerWindow",!0),_defineProperty(_$defaults10,"allowAfterWin",!0),_defineProperty(_$defaults10,"endDate",new Date("2021/10/12 17:00")),_defineProperty(_$defaults10,"helpWindowPrize",[{type:"good",name:"unlimitedLifes",amount:2}]),_defineProperty(_$defaults10,"openDate",null),_defineProperty(_$defaults10,"allowPaid",!0),_defineProperty(_$defaults10,"allowProlong",!0),_defineProperty(_$defaults10,"prolongMaxTimes",1),_defineProperty(_$defaults10,"scrollEnabled",!0),_defineProperty(_$defaults10,"scrollDuration",250),_defineProperty(_$defaults10,"scrollDistance",250),_defineProperty(_$defaults10,"scrollThreshold",25),_defineProperty(_$defaults10,"artifactWorkshopMinLevel",3),_defineProperty(_$defaults10,"artifactWorkshopMinStars",3),_defineProperty(_$defaults10,"prizes",[]),_$defaults10),BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.prepareArtefactController(),this.prepareQuestController(),this.prepareStoryController()},prepareQuestController:function(){this.questController=new QuestController({world:this,hasTasksWindow:!0,name:this.get("name"),tasks:[{id:1,world:this,price:1,prize:{middle:!0,products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedLifes}]}},{id:2,price:1,required:[1]},{id:3,price:1,required:[1],options:!0},{id:4,price:1,required:[1],options:!0},{id:5,price:1,required:[2,3,4]},{id:6,price:1,required:[5]},{id:7,world:this,price:1,required:[6],prize:{products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"SpinProduct",amount:1}]}},{id:8,price:1,required:[7]},{id:9,price:1,required:[8]},{id:10,price:1,required:[9],options:!0},{id:11,price:2,required:[9]},{id:12,price:1,required:[9],options:!0},{id:13,price:1,world:this,required:[10,11,12],prize:{middle:!0,products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedLifes},{type:"CoinsProduct",amount:50}]}},{id:14,price:1,required:[13]},{id:15,world:this,price:2,required:[14],prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.starInField}]}},{id:16,price:1,required:[15]},{id:17,price:2,required:[15]},{id:18,price:1,required:[15]},{id:19,world:this,price:1,required:[16,17,18],prize:{middle:!0,products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.addThreeMoves},{type:"SpinProduct",amount:1}]}},{id:20,price:1,required:[19]},{id:21,price:1,required:[20]},{id:22,price:1,required:[20]},{id:23,world:this,price:1,required:[21,22],prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle}]}},{id:24,price:1,required:[23]},{id:25,price:1,required:[23]},{id:26,price:1,required:[23],options:!0},{id:27,world:this,price:1,required:[24,25,26],options:!0,prize:{middle:!0,products:[{type:"GoodProduct",addTime:3600,goodId:GoodTypes.unlimitedLifes}]}},{id:28,price:1,required:[27]},{id:29,price:1,required:[28]},{id:30,world:this,price:1,required:[29],prize:{middle:!0,products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"SpinProduct",amount:1}]}},{id:31,price:1,required:[30]},{id:32,world:this,price:1,required:[31],prize:{middle:!0,products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.starInField},{type:"CoinsProduct",amount:50}]}},{id:33,price:1,required:[32]},{id:34,price:1,required:[33]},{id:35,price:1,required:[34]},{id:36,price:1,required:[35]},{id:37,world:this,price:1,required:[36],prize:{middle:!0,products:[{type:"GoodProduct",addTime:1800,goodId:GoodTypes.unlimitedLifes},{type:"CoinsProduct",amount:50}]}},{id:38,price:1,required:[37]},{id:39,price:1,required:[38],options:!0},{id:40,world:this,price:3,hasReservedPrize:!0,required:[39],prize:{products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",amount:2,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys},{type:"GoodProduct",addTime:86400,goodId:GoodTypes.unlimitedLifes}]}}]}),this.questController.calcGold=function(){var t=1;this.tasks.forEach(function(e){e.get("complete")&&(t+=e.get("price"))}),this.set("gold",this.get("world").getCurrentLevel()-t)}},prepareStoryController:function(){var e=0;this.storyController=this.addComponent(StoryController,{name:this.name,actionQueue:this.get("actionQueue"),world:this,stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:++e},{type:StoryTalkElement,owner:this,id:++e,once:"enter",talkKey:1},{type:StoryForceElement,owner:this,once:"enter",id:210,delay:1e3,el:".questUi_deepsea .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,once:"winLevel1",id:211,delay:1e3,el:".mBonusWorldTasksWindowBtn.deepsea",name:this.get("name")+"Force1"},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask1",talkKey:2},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask1",id:++e,scrollTo:".task1",elements:[{el:".screen1.deepsea .bg.friend",persistentClass:"hidden1"},{el:".screen1.deepsea .bg.pirate",persistentClass:"hidden1"},{el:".screen1.deepsea .task1.friend",persistentClass:"visible1"},{el:".screen1.deepsea .task1.pirate",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask1",talkKey:3},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask2",talkKey:4},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask2",id:++e,scrollTo:".task2",elements:[{el:".screen1.deepsea .task1.friend",persistentClass:"hidden1"},{el:".screen1.deepsea .task2.trash",persistentClass:"hidden1"},{el:".screen1.deepsea .task2.friend",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask2",talkKey:5},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask3",id:++e,talkKey:6},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask3",id:++e,scrollTo:".task3",elements:[{el:".screen1.deepsea .task3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask3",talkKey:7},{type:StoryTalkElement,owner:this.questController,once:"beforeCompleteTask4",id:++e,talkKey:8},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask4",id:++e,scrollTo:".task4",elements:[{el:".screen1.deepsea .task4.pirate",persistentClass:"visible1"},{el:".screen1.deepsea .task4.fishingRod",persistentClass:"visible1"},{el:".screen1.deepsea .task1.pirate",persistentClass:"hidden1"},{el:".screen1.deepsea .task2.friend",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask4",talkKey:9},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask5",talkKey:10},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++e,scrollTo:".task5",elements:[{el:".screen1.deepsea .task5",persistentClass:"visible1"},{el:".screen1.deepsea .task4.pirate",persistentClass:"hidden1"},{el:".screen1.deepsea .task4.fishingRod",persistentClass:"hidden1"},{el:".screen1.deepsea .task2.friend",persistentClass:"visible2"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask5",talkKey:11},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++e,scrollTo:".task5",elements:[{el:".screen1.deepsea .task5",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask5",talkKey:12},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++e,scrollTo:".task5",elements:[{el:".screen1.deepsea .task5",persistentClass:"animation"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask5",talkKey:13},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask5",id:++e,scrollTo:".task5",elements:[{el:".screen1.deepsea .task5",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask6",talkKey:14},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask6",id:++e,scrollTo:".task6",elements:[{el:".screen1.deepsea .task6",persistentClass:"visible1"},{el:".screen1.deepsea .task2.friend",persistentClass:"hidden2"},{el:".screen1.deepsea .task5",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask6",talkKey:15},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask7",talkKey:16},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",id:++e,delayAfter:0,elements:[{el:".questContainer .screen1.deepsea",className:"fadeOut"},{el:".questContainer .screen2.deepsea",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask7",id:++e,elements:[{el:".questContainer .screen1.deepsea",persistentClass:"hide"},{el:".questContainer .screen2.deepsea",persistentClass:"show"},{el:".screen2.deepsea .task11",persistentClass:"visible1"},{el:".screen2.deepsea .task12",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask8",talkKey:17},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask8",id:++e,scrollTo:".task8",elements:[{el:".screen2.deepsea .bg.pirate",persistentClass:"hidden1"},{el:".screen2.deepsea .task8",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask8",talkKey:18},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask9",talkKey:19},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask9",talkKey:20},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask10",talkKey:21},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask10",id:++e,scrollTo:".task10",elements:[{el:".screen2.deepsea .task10",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask10",talkKey:22},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask11",talkKey:23},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask11",id:++e,scrollTo:".task11",elements:[{el:".screen2.deepsea .task11",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask11",talkKey:24},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask12",talkKey:25},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask12",id:++e,scrollTo:".task12",elements:[{el:".screen2.deepsea .task12",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask12",talkKey:26},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask13",talkKey:27},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask13",talkKey:28},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask13",talkKey:29},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask13",id:++e,scrollTo:".task13",elements:[{el:".screen2.deepsea .task13",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask13",talkKey:30},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask14",talkKey:31},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask14",talkKey:32},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask15",id:++e,delayAfter:0,elements:[{el:".questContainer .screen2.deepsea",className:"fadeOut"},{el:".questContainer .screen3.deepsea",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask15",id:++e,elements:[{el:".questContainer .screen2.deepsea",persistentClass:"hide"},{el:".questContainer .screen3.deepsea",persistentClass:"show"},{el:".screen3.deepsea .task16",persistentClass:"visible1"},{el:".screen3.deepsea .task17",persistentClass:"visible1"},{el:".screen3.deepsea .task18",persistentClass:"visible1"},{el:".screen3.deepsea .task19",persistentClass:"visible1"},{el:".screen3.deepsea .task21",persistentClass:"visible1"},{el:".screen3.deepsea .task22",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask16",talkKey:33},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask16",talkKey:34},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask16",id:++e,scrollTo:".task16",elements:[{el:".screen3.deepsea .task16",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask16",talkKey:35},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask17",talkKey:36},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask17",id:++e,scrollTo:".task17",elements:[{el:".screen3.deepsea .task17",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask17",talkKey:37},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask18",talkKey:38},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask18",talkKey:39},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask19",talkKey:40},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask20",talkKey:41},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask20",id:++e,scrollTo:".task18",elements:[{el:".screen3.deepsea .task18",persistentClass:"hidden1"},{el:".screen3.deepsea .task19",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask21",talkKey:42},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask21",talkKey:43},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask21",id:++e,scrollTo:".task21",elements:[{el:".screen3.deepsea .task21",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask21",talkKey:44},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask22",talkKey:45},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask22",id:++e,scrollTo:".task22",elements:[{el:".screen3.deepsea .task22",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask22",talkKey:46},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask23",talkKey:47},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++e,delayAfter:0,elements:[{el:".questContainer .screen3.deepsea",className:"fadeOut"},{el:".questContainer .screen4.deepsea",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask23",id:++e,elements:[{el:".questContainer .screen3.deepsea",persistentClass:"hide"},{el:".questContainer .screen4.deepsea",persistentClass:"show"},{el:".screen4.deepsea .task23.pirate",persistentClass:"visible1"},{el:".screen4.deepsea .task23.girl",persistentClass:"visible1"},{el:".screen4.deepsea .task24",persistentClass:"visible1"},{el:".screen4.deepsea .task25",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask24",talkKey:48},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask24",id:++e,scrollTo:".task24",elements:[{el:".screen4.deepsea .task24",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask24",talkKey:49},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask25",talkKey:50},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask25",id:++e,scrollTo:".task25",elements:[{el:".screen4.deepsea .task25",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask25",talkKey:51},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask26",talkKey:52},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask26",id:++e,scrollTo:".task26",elements:[{el:".screen4.deepsea .task26",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask26",talkKey:53},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask27",talkKey:54},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask27",id:++e,scrollTo:".task27",elements:[{el:".screen4.deepsea .task27",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask28",talkKey:55},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask28",talkKey:56},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask28",id:++e,scrollTo:".task28",elements:[{el:".screen4.deepsea .task28.pirate",persistentClass:"visible1"},{el:".screen4.deepsea .task28.neptune",persistentClass:"visible1"},{el:".screen4.deepsea .task23.pirate",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask28",talkKey:57},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask29",talkKey:58},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask30",talkKey:59},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask30",id:++e,delayAfter:0,elements:[{el:".questContainer .screen4.deepsea",className:"fadeOut"},{el:".questContainer .screen4.deepsea",cleanClass:"fadeIn"},{el:".questContainer .screen3.deepsea",className:"fadeIn"},{el:".questContainer .screen3.deepsea",cleanClass:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask30",id:++e,elements:[{el:".questContainer .screen4.deepsea",persistentClass:"hidden1"},{el:".questContainer .screen3.deepsea",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask31",talkKey:60},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask31",talkKey:61},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask32",talkKey:62},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask32",id:++e,delayAfter:0,elements:[{el:".questContainer .screen3.deepsea",className:"fadeOut"},{el:".questContainer .screen3.deepsea",cleanClass:"fadeIn"},{el:".questContainer .screen2.deepsea",className:"fadeIn"},{el:".questContainer .screen2.deepsea",cleanClass:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask32",id:++e,elements:[{el:".questContainer .screen3.deepsea",persistentClass:"hidden1"},{el:".questContainer .screen2.deepsea",persistentClass:"visible1"},{el:".screen2.deepsea .task32",persistentClass:"visible1"},{el:".screen2.deepsea .task8",persistentClass:"visible2"},{el:".screen2.deepsea .task13",persistentClass:"visible2"},{el:".screen2.deepsea .bg.fish",persistentClass:"hidden1"},{el:".screen2.deepsea .bg.neptune",persistentClass:"hidden1"},{el:".screen2.deepsea .bg.staff",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask32",talkKey:63},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask33",talkKey:64},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask33",id:++e,scrollTo:".task33",elements:[{el:".screen2.deepsea .task32",persistentClass:"hidden1"},{el:".screen2.deepsea .task33",persistentClass:"visible1"},{el:".screen2.deepsea .task8",persistentClass:"hidden2"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask33",talkKey:65},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask33",id:++e,scrollTo:".task33",elements:[{el:".screen2.deepsea .task33",persistentClass:"updated1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask33",talkKey:66},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask33",id:++e,scrollTo:".task33",elements:[{el:".screen2.deepsea .task33",persistentClass:"updated2"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask34",talkKey:67},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask35",talkKey:68},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask35",id:++e,scrollTo:".task35",elements:[{el:".screen2.deepsea .task33",persistentClass:"hidden1"},{el:".screen2.deepsea .task35",persistentClass:"visible1"},{el:".screen2.deepsea .task13",persistentClass:"hidden2"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask35",talkKey:69},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask36",talkKey:70},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask36",id:++e,delayAfter:0,elements:[{el:".questContainer .screen2.deepsea",className:"fadeOut"},{el:".questContainer .screen2.deepsea",cleanClass:"fadeIn"},{el:".questContainer .screen4.deepsea",className:"fadeIn"},{el:".questContainer .screen4.deepsea",cleanClass:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask36",id:++e,elements:[{el:".questContainer .screen2.deepsea",persistentClass:"hidden2"},{el:".questContainer .screen4.deepsea",persistentClass:"visible2"},{el:".screen4.deepsea .task36",persistentClass:"visible1"},{el:".screen4.deepsea .task23.girl",persistentClass:"hidden1"},{el:".screen4.deepsea .task28.pirate",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask37",talkKey:71},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask37",talkKey:72},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask37",id:++e,delayAfter:0,elements:[{el:".questContainer .screen4.deepsea",className:"fadeOut"},{el:".questContainer .screen4.deepsea",cleanClass:"fadeIn"},{el:".questContainer .screen1.deepsea",className:"fadeIn"},{el:".questContainer .screen1.deepsea",cleanClass:"fadeOut"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask37",id:++e,elements:[{el:".questContainer .screen4.deepsea",persistentClass:"hidden2"},{el:".questContainer .screen1.deepsea",persistentClass:"visible2"},{el:".screen1.deepsea .task37",persistentClass:"visible1"},{el:".screen1.deepsea .task6",persistentClass:"hidden1"},{el:".screen1.deepsea .task3",persistentClass:"hidden1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask37",talkKey:73},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask38",talkKey:74},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask38",id:++e,scrollTo:".task38",elements:[{el:".screen1.deepsea .task37",persistentClass:"hidden1"},{el:".screen1.deepsea .task38",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask38",talkKey:75},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask39",talkKey:76},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask39",id:++e,scrollTo:".task39",elements:[{el:".screen1.deepsea .task38",persistentClass:"hidden1"},{el:".screen1.deepsea .task39",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask39",talkKey:77},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask40",id:++e,delayAfter:0,elements:[{el:".questContainer .screen1.deepsea",className:"fadeOut"},{el:".questContainer .screen5",className:"fadeIn"}]},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask40",id:++e,elements:[{el:".questContainer .screen1.deepsea",persistentClass:"hidden3"},{el:".questContainer .screen5",persistentClass:"visible3"}]},{type:StoryTalkElement,owner:this.questController,id:++e,once:"afterCompleteTask40",talkKey:78},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:UserPrizes.convertFromCocos(this.questController.tasks.at(39).get("prize"))},owner:this.questController,once:"afterCompleteTask40",id:++e},{type:StoryAnimationElement,owner:this.questController,once:"afterCompleteTask40",id:212,elements:[{el:".mBonusWorldTasksWindowBtn",persistentClass:"hide"},{el:".mQuestGold",persistentClass:"hide"}]},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.deepsea",name:"deepseaForce2"},{type:StoryForceElement,owner:this.artifactController,page:"artifacts",once:"activate",id:202,el:".artifactWorkshop.deepsea .tree .button4",name:"deepseaForce4"}]})},prepareArtefactController:function(){this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.deepsea",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{anchorEl:".button4",scrollable:!0,partSource:new Artifacts.PartDropper({chances:{15:30,7:40},generatingModel:Artifacts.PartRandomizer}),config:{showAll:!0,parts:[{id:1,chance:.06},{id:2,chance:.06},{id:3,chance:.09},{id:4,chance:.1},{id:5,chance:.09},{id:6,chance:.05},{id:7,chance:.07},{id:8,chance:.08},{id:9,chance:.07},{id:10,chance:.06},{id:11,chance:.06},{id:12,chance:.06},{id:13,chance:.06},{id:14,canBeSold:!1,chance:.03},{id:15,canBeSold:!1,chance:.03},{id:16,canBeSold:!1,chance:.03}],artifacts:[{id:1,parts:[1,2,3,4,5],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:50}]},{id:2,parts:[2,3,4,5,6],ability:{type:Artifacts.EmptyAbility},prize:[{type:"coins",amount:100}]},{id:3,parts:[3,4,5,7,8],ability:{type:Artifacts.EmptyAbility},cssClass:".indicator1",prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:50}]},{id:4,parts:[3,4,5,8,9],ability:{type:Artifacts.EmptyAbility},cssClass:".indicator2",prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:5,parts:[3,4,5,9,10],passive:!0,ability:{type:Artifacts.EmptyAbility},cssClass:".indicator3",prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:100}]},{id:6,parts:[4,5,9,10,11],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"coins",amount:50}]},{id:7,parts:[4,5,10,11,12],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:50}]},{id:8,parts:[9,10,11,12,13],ability:{type:Artifacts.EmptyAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"coins",amount:50}]},{id:9,parts:[3,7,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"starInField",amount:8},{type:"coins",amount:100}]},{id:10,parts:[4,8,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"addThreeMoves",amount:8},{type:"coins",amount:200}]},{id:11,parts:[5,9,14,15,16],ability:{type:Artifacts.EmptyAbility},prize:[{type:"good",name:"unlimitedLifes",amount:24},{type:"coins",amount:300}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,artifacts:[7]},{id:8,autoSet:!0,artifacts:[8]},{id:9,autoSet:!0,artifacts:[9]},{id:10,autoSet:!0,artifacts:[10]},{id:11,autoSet:!0,artifacts:[11]}]}}})}}),VictoryDayWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.starChests=this.model.getComponent(StarChestController).get("chests"),this.renderStarChestPrizes()},onEnter:function(){var t=this;BonusWorldView.prototype.onEnter.call(this),this.updateStarChests(),$(".victoryDayWorldStarChest").on("click touchend",function(e){return t.onChestClick(e)}),this.starChests.on("change:opened",this.updateStarChests,this),episode.scores.on("change:stars add",this.updateStarChests,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this),$(".victoryDayWorldStarChest").off("click touchend"),this.starChests.off("change:opened",this.updateStarChests,this),episode.scores.off("change:stars add",this.updateStarChests,this)},updateStarChests:function(){var i=$(".bonusWorldStarBoxes"),o=this.model.getComponent(StarChestController);this.starChests.forEach(function(e){var t=i.find("#starBox"+e.get("id"));t.addClass("victoryDayWorldStarChest"),t.data("chestId",e.get("id")),t.find(".actualStars").html(Math.min(o.getCurrStars(),e.get("stars"))),t.toggleClass("opened",e.get("opened"))})},renderStarChestPrizes:function(){var i=$(".bonusWorldStarBoxes");this.starChests.forEach(function(e){var t=i.find("#starBox"+e.get("id"));t.find(".requiredStars").html(e.get("stars")),new UserPrizesView({model:e.get("prize"),el:t.find(".prizes"),isGroup:!0})})},onChestClick:function(e){var t=$(e.currentTarget).data("chestId"),i=this.starChests.findWhere({id:t});i&&!i.get("opened")&&new StarChestClosedWindow({chest:i,world:this.model})}}),VictoryDayWorld=BonusWorld.extend({defaults:_.defaults({name:"victorydayworld",viewId:VictoryDayWorldView,version:20230420,production:!0,levelsInEpisode:30,durationDays:5,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:4,finishWindowInStories:!0,forceId:!0,openDate:null,showProgress:!1,allowAfterWin:!0,allowPaid:!0,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime3",skipLevelPublication:!0,allowProlong:!0,prolongMaxTimes:1,actionQueue:new ActionQueue,prizes:[{type:"finalPrize",level:30,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",cssClass:"addThreeMoves",name:"addThreeMoves",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]}]},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(StarChestController,{chests:[{id:1,stars:10,publicationId:"PrizeForChest1",prize:{name:this.get("name")+"_10",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.unlimitedLifes}]}},{id:2,stars:30,publicationId:"PrizeForChest2",prize:{name:this.get("name")+"_30",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.addThreeMoves}]}},{id:3,stars:60,publicationId:"PrizeForChest3",prize:{name:this.get("name")+"_60",products:[{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"GoodProduct",addTime:"1h",goodId:GoodTypes.unlimitedLifes},{type:"SpinProduct",amount:1}]}},{id:4,stars:90,publicationId:"PrizeForChest4",isGroup:!0,prize:{name:this.get("name")+"_90",products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteCell},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.Shuffle},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteColumn},{type:"BoosterProduct",amount:1,boosterId:BoosterTypes.DeleteRow},{type:"GoodProduct",addTime:"24h",goodId:GoodTypes.unlimitedLifes},{type:"GoodProduct",addTime:"12h",goodId:GoodTypes.starInField}]}}]}),this.addComponent(ShootingRangeComponent,{}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,scrollTo:".animationSprite1",elements:[{el:".bonusWorldAnimations.victorydayworld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,scrollTo:".animationSprite2",elements:[{el:".bonusWorldAnimations.victorydayworld .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:2e3,scrollTo:".animationSprite3",elements:[{el:".bonusWorldAnimations.victorydayworld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:3},{type:StoryAnimationElement,owner:this,once:"beforeEnter",delayAfter:1e3,scrollTo:".bonusWorldAnimations.victorydayworld",elements:[{el:".bonusWorldAnimations.victorydayworld",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,once:"beforeEnter",scrollTo:".bonusWorldAnimations.victorydayworld",elements:[{el:".bonusWorldAnimations.victorydayworld",persistentClass:"hidden"}]},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:4},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".episode_victorydayworld #map .levelNow",name:this.get("name")+"Force0",id:201},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel10",talkKey:6},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,picture:"storypic"},once:"onFinishLevel10"},{type:StoryTalkElement,owner:this,once:"onFinishLevel16",talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel30",talkKey:9},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize},owner:this,once:"onFinishLevel30"},{type:StoryTalkElement,owner:this,once:"openedStarChest1",talkKey:10},{type:BaseStoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(1)},owner:this,once:"openedStarChest1"},{type:StoryTalkElement,owner:this,once:"openedStarChest2",talkKey:11},{type:BaseStoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(2)},owner:this,once:"openedStarChest2"},{type:StoryTalkElement,owner:this,once:"openedStarChest3",talkKey:12},{type:BaseStoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(3)},owner:this,once:"openedStarChest3"},{type:StoryTalkElement,owner:this,once:"openedStarChest4",talkKey:13},{type:BaseStoryWindowElement,window:StarChestOpenWindow,params:{world:this,chest:this.getComponent(StarChestController).getChest(4)},owner:this,once:"openedStarChest4"},{type:StoryDailyTalkElement,owner:this,on:"enter",talkKey:14}]}),this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(ProlongateWorldComponent)},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},episodeChanged:function(){return!0}}),$cf;figureRulesProcess.victorydayworldBonusClasses=function(){featuresAdder.addFeature("victorydayworld","episodecollectiondroppable"),featuresAdder.addFeature("victorydayworld","strongbox_bearsafe"),featuresAdder.addFeature("victorydayworld","chocolate_chocolate"),featuresAdder.addFeature("victorydayworld","parrot_shoottarget"),featuresAdder.addFeature("victorydayworld","fishball_chicken"),featuresAdder.addFeature("victorydayworld","crabmouse_shootmouse"),featuresAdder.addFeature("victorydayworld","crabmousefarm_shootmousefarm"),featuresAdder.addFeature("victorydayworld","frog_steamtrain"),featuresAdder.addFeature("victorydayworld","alligator_bandit")},figureRulesProcess.additionalBonusClasses=($cf=figureRulesProcess.additionalBonusClasses,function(){$cf.call(this),figureRulesProcess.victorydayworldBonusClasses()});var SeasonSearchTreasuresRunWindow=TWindow.extend({templateClass:".seasonsearchtreasuresRunWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.listenTo(this.options.world,"change:timer",this.updateTimer),this.updateTimer()},updateTimer:function(){var e=this.options.world.get("timer"),t="";e&&(t=formatTime(86400<=e?"%j"+messages.bonusWorldLeftTime[2]+"%G"+messages.bonusWorldLeftTime[0]:"%H:%i:%s",e)),this.$(".mTimer").html(t)},onClose:function(){TWindow.prototype.onClose.call(this),this.options.world.open()}}),SeasonSearchTreasuresTimeIsOverWindow=TWindow.extend({templateClass:".seasonsearchtreasuresTimeIsOverWindow_template",events:{"click .close":"close"}}),SeasonSearchTreasuresLoseWindow=TWindow.extend({templateClass:".seasonsearchtreasuresLoseWindow_template",events:{"click .close":"close"}}),SeasonSearchTreasuresView=Backbone.View.extend({events:{"click .mExitBtn":"onExit"},initialize:function(){var e=this;this.listenTo(this.model,"enter",this.onEnter),this.listenTo(this.model,"change:progress",this.updateProgress),this.listenTo(this.model,"change:timer",this.updateTimer),this.listenTo(application,"gameStart",this.focusOnMainElement),this.updateProgress(),this.updateTimer(),this.rulesBtn=new WorldInfoButton({el:$(".seasonsearchtreasuresUI .infoBtn"),model:this.model}),this.$treasureArrow=$(".treasureArrow"),this.mapController=BigMapControllerFactory.create({el:$("#map"),bgEl:$(".scrolledBlock"),mainEl:$(".pirateWithLives"),keyIntervalTime:15}),this.mapController.on("transition",function(){e.onScroll()},this),new BigMapControllerView({model:this.mapController,el:this.$(".mapController")}),this.livesInstance=this.model.get("livesInstance")},onEnter:function(){this.livesInstance&&this.livesInstance.on("change:lives",this.updatePirateLives,this),this.updatePirateLives(),this.focusOnMainElement()},onExit:function(){this.livesInstance&&this.livesInstance.off("change:lives",this.updatePirateLives,this),this.model.exit()},onPlay:function(){this.model.playCurrentLevel()},onInfo:function(){this.model.showInfo()},updateProgress:function(){this.$(".mLevel").html(this.model.get("progress"))},updateTimer:function(){var e=this.model.get("timer"),t="";e&&(t=formatTime(86400<=e?"%j"+messages.bonusWorldLeftTime[2]+"%G"+messages.bonusWorldLeftTime[0]:"%H:%i:%s",e)),this.$(".mTimer").html(t)},updatePirateLives:function(){var e=this.model.livesController.getLives();$(".pirateWithLives .lives").removeClass("lives1 lives2 lives3").addClass("lives".concat(e))},focusOnMainElement:function(){var e=this;application.waitPage("main").then(function(){setTimeout(function(){e.mapController.focusMainElement(!0).then(function(){e.onScroll()})},10)})},onScroll:function(){-442<parseInt(this.mapController.bgImage.css("transform").split(",")[5])?this.$treasureArrow.removeClass("hidden"):this.$treasureArrow.addClass("hidden")}}),SeasonSearchTreasures=BonusWorld.extend({defaults:_.defaults({name:"seasonsearchtreasures",production:!0,levelsInEpisode:10,group:"seasonsearchtreasures",episode:3,level:1,minEpisodeToEnter:3,minLevelToEnter:1,world:null,force:!1,finishTime:null,numberOfMaps:24,duration:172800,firstStartDate:"2022.08.16 06:00",cooldown:1209600,allowProlong:!1,actionQueue:new ActionQueue,dontBuyLives:!0,skipLevelPublication:!0,prizes:[{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:200},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:200},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:2},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:300},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:400},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:400},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",prize:[{type:"coins",name:"coins",cssClass:"bonusWindowCoins",amount:500},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:2},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:2},{type:"good",name:"starInField",cssClass:"starInField",amount:2}]}],livesInstance:new BonusWorldLives({maxLives:3,lives:3,lifeRestoreTime:864e5}),timeIsOver:!0,unlimitedName:"unlimitedBonusWorldLivesSeasonSearchTreasures"},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.cooldownTimer=new Timer,this.listenTo(this.cooldownTimer,"finish",this.restart),Application.onReady(_.bind(function(){new SelectBonusWorldButtonView({el:$('<div id="seasonsearchtreasuresBtn"></div>').appendTo("#map"),worlds:[this]}).render()},this)),this.on("change:active",this.onChangeActive,this),this.on("onCompleteLevel",this.onCompleteLevel,this),this.on("progressReseted",this.onProgressReseted,this),this.on("refuseBuyMoves",this.onRefuseBuyMoves,this),this.addComponent(StoryController,{name:this.get("name"),world:this,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,on:"restart",owner:this,isAvailable:function(){return(!Config.bonusWorld||Config.bonusWorld.get("isFreeEpisode"))&&!application.get("forceOpenNow")},stories:[{type:StoryTalkElement,owner:this,talkKey:"StartTalk",selector:"seasonSearchTresuresTalk"},{type:StoryWindowElement,window:SeasonSearchTreasuresRunWindow,params:{world:this}}]},{type:StoryTalkElement,owner:this,on:"finish",talkKey:"EndTalk",delay:0,selector:"seasonSearchTresuresTalk"}]}),this.addComponent(ResetProgressComponent,{world:this})},configure:function(e){return BonusWorld.prototype.configure.call(this,e)},checkAvailability:function(t){var e,i=_createForOfIteratorHelper(Config.bonusWorlds);try{for(i.s();!(e=i.n()).done;){e.value.on("beforeShowForce",this.onShowForce,this)}}catch(e){i.e(e)}finally{i.f()}var o=this;return service("../../../levelbase/src/services/seasonsearchtreasures/getdata.php",{}).then(function(e){return e?(o.set({firstRun:!1,progress:parseInt(e.progress),map:parseInt(e.map),finishTime:parseInt(e.finishTime),timeIsOver:Boolean(parseInt(e.timeIsOver)),prize:parseInt(e.prize)}),o.get("livesInstance").set("lives",parseInt(e.lives))):o.set({firstRun:!0,progress:1,map:1,finishTime:0,prize:1}),o.get("firstRun")||o.isClosed()?(o.getComponent(StoryController).once("configured",function(){return o.onStoryControllerConfigured()}),!1):(o.name="seasonsearchtreasures"+o.get("map"),o.set("finished",o.isFinished()),o.bonusWorldFinishTime=o.get("finishTime"),o.runBonusWorldTimer(),!(!o.get("allowAfterWin")&&o.isFinished()))}).catch(function(e){return console.error(e),!1}).then(function(e){return t(e),o.configure(e),e})},onEnterBonusWorld:function(){this.set("visited",!0),this.trigger("beforeEnter",this),$(".wrapper").addClass("bonusworld_"+this.get("name")),this.get("finishTime")||this.set("finishTime",application.getCurrentServerTime()+this.get("duration")),this.view=new SeasonSearchTreasuresView({model:this,el:$(".mainTemplates .mSeasonSearchTreasures").clone().appendTo("#map")}),this.trigger("enter",this),this.renderChests(),this.renderPrizeBlock()},onExit:function(){BonusWorld.prototype.onExit.call(this),$(".wrapper").removeClass("bonusworld_"+this.get("name")),this.view.remove(),this.view=null},onEnterCheckFunction:function(e){var t=this;BonusWorld.prototype.onEnterCheckFunction.call(this,function(){t.isClosed()?t.restart().then(e):e()})},getGameClasses:function(){return["episode_"+this.get("name")]},isFinished:function(){return this.get("progress")>this.get("levelsInEpisode")},isClosed:function(){return this.get("finishTime")<application.getCurrentServerTime()},isCanRestarted:function(){return 1e3*application.getCurrentServerTime()>=this.getStartTime()&&1e3*application.getCurrentServerTime()<=this.getFinishTime()},getStartTime:function(){var e=(application.getCurrentServerTime()-Date.parse(this.get("firstStartDate"))/1e3)%this.get("cooldown");return 0<=e&&e<=this.get("duration")?new Date(1e3*(application.getCurrentServerTime()-e)):e<0?Date.parse(this.get("firstStartDate")):new Date(1e3*(application.getCurrentServerTime()-e+this.get("cooldown")))},getFinishTime:function(){var e=this.getStartTime();return new Date(e.setSeconds(e.getSeconds()+this.get("duration")))},onStoryControllerConfigured:function(){this.isCanRestarted()?this.restart():(this.cooldownTimer.start(Math.round(this.getStartTime()/1e3)-application.getCurrentServerTime()),this.get("finished")||this.get("timeIsOver")||(this.set("timeIsOver",!0),this.save(),new SeasonSearchTreasuresTimeIsOverWindow({world:this})))},restart:function(){var e=this;if(!this.dontRestart){var t=this.get("firstRun")?1:this.get("map");return(1!==t||this.isFinished())&&(t=getRandomInt(2,this.get("numberOfMaps"))),this.runMap(t).then(function(){return e.emit("restart",e)}).then(function(){e.set("active",!0),e.get("livesInstance").set("lives",e.get("livesInstance").get("maxLives")),e.get("livesInstance").sendLives()})}},runMap:function(e){console.assert(e<=this.get("numberOfMaps")||1<=e,"      1 ... "+this.get("numberOfMap"));var t=1;1<e&&(t=getRandomInt(2,this.get("prizes").length)),this.set({map:e,finishTime:Math.round(this.getStartTime()/1e3)+this.get("duration"),progress:1,timeIsOver:!1,prize:t});var i=this;return this.save().then(function(e){i.set(e),i.name="seasonsearchtreasures"+i.get("map"),i.set("finished",i.isFinished()),i.bonusWorldFinishTime=i.get("finishTime"),i.runBonusWorldTimer()})},save:function(){var e=this.pick("map","finishTime","progress","timeIsOver","prize");return e.timeIsOver=Number(e.timeIsOver),service("../../../levelbase/src/services/seasonsearchtreasures/setdata.php",e)},levelCheckAvailable:function(e,t){return e==this.get("progress")&&e<=this.get("levelsInEpisode")&&(t(e),!0)},onBonusWorldTakePrize:function(){this.get("allowAfterWin")||this.set("active",!1);var e=this;this.set("finished",!0),this.emit("finish",this).then(function(){e.exit()})},onCompleteBonusWorld:function(){this.stopListening(),new BonusWorldFinishedWindow(this.get("prizes")[this.get("prize")-1])},showInfo:function(){this.view.rulesBtn.onOpen()},onChangeActive:function(){var e=this;this.get("active")||(setTimeout(function(){e.cooldownTimer.start(Math.round(e.getStartTime()/1e3)-application.getCurrentServerTime())},2e3),Config.bonusWorld==this&&application.waitPage("main").then(function(){e.exit()}),this.isFinished()||(this.set("timeIsOver",!0),this.save(),new SeasonSearchTreasuresTimeIsOverWindow({world:this})))},onCompleteLevel:function(e,t,i){this.isClosed()&&i.cancelNext()},onProgressReseted:function(){new SeasonSearchTreasuresLoseWindow},onRefuseBuyMoves:function(e){e.exitGameOnCancel=!1,new LivesCogentWindow},renderChest:function(){var e=this.get("prizes")[this.get("prize")-1],t=$(".invisible .bonusWorldChest"),i=$("#map .bonusWorldPrizes");if(i.empty(),e){var o=t.clone();o.addClass("bonusWorldPrize"),o.addClass("prizeFinal"),o.addClass("level"+e.level),o.addClass("prizes"+e.prize.length),i.append(o)}},renderPrizeBlock:function(){$("#map .bonusWorldPrizeBlock.final").html("");var e=this.get("prizes")[this.get("prize")-1];if(e){var i=$("#map .bonusWorldPrize.prizeFinal").find(".bonusWorldPrizeBlock");i.empty(),_.each(e.prize,function(e){var t=$(".invisible .bonusWorldPrize").clone();t.find(".amount").html(e.amount),-1!==_.indexOf(["addThreeMoves","unlimitedLifes","starInField","unlimitedKeys"],e.name)&&e.amount&&t.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),t.addClass(e.cssClass).addClass(e.type).addClass(e.name),i.append(t)})}},onShowForce:function(){this.dontRestart=!0}}),Halloween2022WorldView=BonusWorldView.extend({spines:{fire:{atlas:"../../../gems/site/img/episode/episodehalloween2022world/spine/fire.50536c7af8.atlas",json:"../../../gems/site/img/episode/episodehalloween2022world/spine/fire.8f334e8459.json",img:"../../../gems/site/img/episode/episodehalloween2022world/spine/fire.91acc74643.png"},boloto:{atlas:"../../../gems/site/img/episode/episodehalloween2022world/spine/boloto.6169475d93.atlas",json:"../../../gems/site/img/episode/episodehalloween2022world/spine/boloto.a67b3c3a1c.json",img:"../../../gems/site/img/episode/episodehalloween2022world/spine/boloto.dfc5b3def1.png"},maket_finish:{atlas:"../../../gems/site/img/episode/episodehalloween2022world/spine/maket_finish.b2c3297c98.atlas",json:"../../../gems/site/img/episode/episodehalloween2022world/spine/maket_finish.37837f1af3.json",img:"../../../gems/site/img/episode/episodehalloween2022world/spine/maket_finish.0d93c0746d.png"}},initialize:function(){BonusWorldView.prototype.initialize.call(this),this.lawn=$('<div class="homeLawnBg active"></div>'),this.$el.append(this.lawn),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("regattaAfterPrizeWindowShowed100",this.updateBackground,this),this.renderAnimations(),this._renderedSpines=[],this.renderSpines()},onExit:function(){if(BonusWorldView.prototype.onExit.call(this),this.model.off("afterRegattaLineCrossedAtLevel100",this.updateBackground,this),this._renderedSpines&&0<this._renderedSpines.length){var e,t=_createForOfIteratorHelper(this._renderedSpines);try{for(t.s();!(e=t.n()).done;){removeSpine(e.value)}}catch(e){t.e(e)}finally{t.f()}}},renderAnimations:function(){var e=$(".regatta-halloween2022world .scrollWrapper .map"),t=e.find(".animatedDecors");t.get(0)?t.empty():(t=$('<div class="animatedDecors"></div>'),e.append(t));for(var i=[{selector:"candle",amount:11},{selector:"lightSphere",amount:2},{selector:"lightEnterEgypt",amount:1},{selector:"lightEyesBig",amount:2},{selector:"lightEyesEgypt",amount:1},{selector:"lightManyWindows",amount:1},{selector:"lightTwoWindows",amount:1},{selector:"lightTwoWindowsLow",amount:1},{selector:"lightDoor",amount:1},{selector:"flashlightBlue",amount:2},{selector:"lightEyes1",amount:2},{selector:"lightEyes2",amount:2},{selector:"lightEyes3",amount:2},{selector:"castleLight",amount:1},{selector:"lightEnter1",amount:1},{selector:"lightEnter2",amount:1},{selector:"lightEnter3",amount:2},{selector:"lightEnterLeft",amount:1},{selector:"lightWindowsLeft",amount:1},{selector:"lightWindow1",amount:1},{selector:"lightWindow2",amount:1}],o=0;o<i.length;o++)for(var a=0;a<i[o].amount;a++){var n=$('<div class="animationDecor '.concat(i[o].selector," ").concat(i[o].selector).concat(a+1,'"></div>'));t.append(n)}},createSpines:function(n,e,t){var i=this,o=$('<div class="'.concat(t,'"></div>'));e.append(o);for(var a=function(a){var e=i.spines[n[a].resName];if(e){var t=new spine.SpineWidget(o.get(0),{x:n[a].pos.x,y:n[a].pos.y,addX:void 0,addY:void 0,scale:n[a].scale,loop:!0,fitToCanvas:!1,alpha:!0,premultipliedAlpha:n[a].premultipliedAlpha||!1,backgroundColor:"#00000000",atlas:e.atlas,json:e.json,atlasPages:[e.img.substring(e.img.lastIndexOf("/")+1)],textureFileName:e.img.substring(e.img.lastIndexOf("/")+1),animation:n[a].animation,skin:n[a].skin||"default",error:function(e){console.log("[halloween2022bonusworld]    candle  !",e)},success:function(o){if(o.skeleton.flipX=n[a].reflect||!1,n[a].randomRepeat){!function e(t){var i=n[a].randomRepeat;t.paused||setTimeout(function(){o.state.setAnimation(0,n[a].animation,!1),e(t)},1e3*(i[0]+Math.random()*(i[1]-i[0])))}(o)}else o.state.setAnimation(0,n[a].animation,!0)}});-1===i._renderedSpines.map(function(e){return e.canvas}).indexOf(t.canvas)&&i._renderedSpines.push(t)}else console.warn("     ".concat(n[a].resName))},r=0;r<n.length;r++)a(r)},renderSpines:function(){var e=$(".regatta-halloween2022world .scrollWrapper .map"),t=e.find(".spines");t.get(0)?t.empty():(t=$('<div class="spines"></div>'),e.append(t)),this.createSpines([{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:30,y:630}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:697,y:470}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:70,y:2273}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:28,y:2904}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:100,y:2944}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_green",pos:{x:662,y:3564}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_yellow",pos:{x:686,y:3014}},{scale:.7,resName:"fire",animation:"fire",skin:"fire_yellow",pos:{x:696,y:1839}},{scale:.8,resName:"fire",animation:"flashlight_blue+firefly",skin:"default",pos:{x:375,y:151}},{scale:.7,resName:"fire",reflect:!0,animation:"flashlight_blue+firefly",skin:"default",pos:{x:540,y:654}},{scale:.7,resName:"fire",animation:"flashlight_blue+firefly",skin:"default",pos:{x:94,y:1178}},{scale:.7,resName:"fire",animation:"flashlight_haron",skin:"default",pos:{x:187,y:201}}],t,"bg1Spines"),this.createSpines([{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:692,y:44}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:112,y:663}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:701,y:1922}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:121,y:2623}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:676,y:3539}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"light",skin:"default",pos:{x:120,y:4210}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",reflect:!0,animation:"light",skin:"default",pos:{x:52,y:990}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"ghost_fly",skin:"default",pos:{x:240,y:4180}},{scale:.7,premultipliedAlpha:!0,resName:"boloto",animation:"looking",skin:"default",pos:{x:780,y:4e3},randomRepeat:[10,15]}],t,"bg2Spines"),this.createSpines([{scale:.7,resName:"maket_finish",animation:"FlashlightMain",skin:"default",pos:{x:583,y:28}},{scale:.7,resName:"maket_finish",animation:"FlashlightMain",reflect:!0,skin:"default",pos:{x:186,y:28}}],t,"bg3Spines")},updateBackground:function(){this.lawn.toggleClass("active",this.model.getCurrentLevel()>this.model.get("levelsInEpisode"))}}),Halloween2022World=BonusWorld.extend({defaults:_.defaults({name:"halloween2022world",viewId:Halloween2022WorldView,version:20221027,production:!0,levelsInEpisode:100,durationDays:!1,helpWindow:!1,showFinalForce:!1,endDate:new Date("2022/12/19 00:00"),episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:3,forceId:!0,closeForNew:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],livesConfig:{lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300},showTimer:!0,showProgress:!1,sounds:{narrator:!1,pirate1:!1,pirate2:"piratenegative",pirate3:!1,pirate4:"piratepositive",pirate5:"piratenegative",pirate6:"piratepositive",girl1:!1,girl2:"woman",girl3:"piratewomannegative",girl4:!1,grandfather1:"daddypositive",grandfather2:"daddynegative",grandfather3:!1,charon1:!1,charon2:!1,charon3:"kharonangry",charon4:"kharonlaugh",monsters1:"monstersroar",candybeard1:"candybeardpositive",candybeard2:"candybeardnegative",candybeard3:"candybeardpositive"},spines:[{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/kudrik.d563932691.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/kudrik.4318321875.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/kudrik.cf2df1b407.json",characters:[{name:"narrator",idle:"Idle",randomRepeat:{action:"Idle+blinking",range:[5,20]},skin:"kudrik_vampire"}],offset:{x:100,y:220},scale:.25},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/pirate.d99128af19.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/pirate.382d4f4ed3.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/pirate.ffc000ec7a.json",characters:[{name:"pirate1",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"general"},{name:"pirate2",idle:"Sad",randomRepeat:{action:"SadBlinking",range:[5,20]},skin:"general"},{name:"pirate3",idle:"Thoughtful",randomRepeat:{action:"ThoughtfulBlinking",range:[5,20]},skin:"general"},{name:"pirate4",idle:"Unhappy",randomRepeat:{action:"UnhappyBlinking",range:[5,20]},skin:"general"},{name:"pirate5",idle:"Scared",randomRepeat:{action:"ScaredBlinking",range:[5,20]},skin:"general"},{name:"pirate6",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"general_fangs"},{name:"pirate1battlepass",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"halloween"},{name:"pirate2battlepass",idle:"Sad",randomRepeat:{action:"SadBlinking",range:[5,20]},skin:"halloween"},{name:"pirate3battlepass",idle:"Thoughtful",randomRepeat:{action:"ThoughtfulBlinking",range:[5,20]},skin:"halloween"},{name:"pirate4battlepass",idle:"Unhappy",randomRepeat:{action:"UnhappyBlinking",range:[5,20]},skin:"halloween"},{name:"pirate5battlepass",idle:"Scared",randomRepeat:{action:"ScaredBlinking",range:[5,20]},skin:"halloween"},{name:"pirate6battlepass",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"halloween"}],offset:{x:140,y:-80},scale:.35},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/girl.e07677cb9a.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/girl.a746ebe71a.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/girl.31a19dcd73.json",characters:[{name:"girl1",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"halloween"},{name:"girl2",idle:"Sad",randomRepeat:{action:"SadBlinking",range:[5,20]},skin:"halloween"},{name:"girl3",idle:"Surprised",randomRepeat:{action:"SurprisedBlinking",range:[5,20]},skin:"halloween"},{name:"girl4",idle:"Unhappy",randomRepeat:{action:"UnhappyBlinking",range:[5,20]},skin:"halloween"}],reflect:!0,offset:{x:160,y:-60},scale:.27},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/haron.b7fcb4fa5c.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/haron.86b5a77db8.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/haron.914da34e01.json",characters:[{name:"charon1",idle:"Idle",skin:"default",randomRepeat:{action:"IdleBlinking",range:[5,20]}},{name:"charon2",idle:"Surprised",skin:"default",randomRepeat:{action:"SurprisedBlinking",range:[5,20]}},{name:"charon3",idle:"Unhappy",skin:"default",randomRepeat:{action:"UnhappyBlinking",range:[5,20]}},{name:"charon4",idle:"Kind",skin:"default",randomRepeat:{action:"KindBlinking",range:[5,20]}}],offset:{x:50,y:200},scale:.25},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/konfetnayaBoroda.28b63f5c13.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/konfetnayaBoroda.88c088b372.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/konfetnayaBoroda.96504ca9b9.json",characters:[{name:"candybeard1",idle:"Idle",skin:"General",randomRepeat:{action:"IdleBlinking",range:[5,20]}},{name:"candybeard2",idle:"Idle",skin:"Angry",randomRepeat:{action:"IdleBlinking",range:[5,20]},otherTracks:[{name:"CorrAngryMonster",index:1,repeat:!0}]},{name:"candybeard3",idle:"Idle",skin:"Monster",randomRepeat:{action:"IdleBlinking",range:[5,20]},otherTracks:[{name:"CorrAngryMonster",index:1,repeat:!0}]}],offset:{x:40,y:270},scale:.2},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/monsters.1c96f5f4a7.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/monsters.9845df08d7.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/monsters.92b9d2dc22.json",characters:[{name:"monsters1",idle:"Idle",randomRepeat:{action:["IdleBlinkingFrankenstein","IdleBlinkingWolf","IdleBlinkingMummy"],range:[1,7]},skin:"default"}],offset:{x:140,y:-40},scale:.3},{img:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/grandfather.8c971e9e94.png",atlas:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/grandfather.8be779a5a5.atlas",json:"//gems-ok.akamaized.net/gems/gems/site/img/episode/episodehalloween2022world/spine/grandfather.9a876c802a.json",characters:[{name:"grandfather1",idle:"Happy",randomRepeat:{action:"HappyBlinking",range:[5,20]},skin:"default"},{name:"grandfather2",idle:"Base",randomRepeat:{action:"BaseBlinking",range:[5,20]},skin:"default"},{name:"grandfather3",idle:"Serious",randomRepeat:{action:"SeriousBlinking",range:[5,20]},skin:"default"}],offset:{x:140,y:-40},scale:.25}],finishPrize:{progress:100,type:"finalPrize",products:[{type:"coins",amount:500,cssClass:"bonusWindowCoins"},{type:"good",amount:24,name:"unlimitedLifes",cssClass:"unlimitedLifes"},{type:"good",amount:6,name:"addThreeMoves",cssClass:"addThreeMoves"},{type:"good",amount:6,name:"starInField",cssClass:"starInField"}]},unlimitedName:"unlimitedBonusWorldLives",prizes:[]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,catchupWindowRule:function(){return!1},instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16}]}});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ForceInstantPartsCollector({world:this,minLevel:2,maxLevel:2,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:6,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.45,normal:.33,rare:.15,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:12}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:3,activationMove:3,perMoveChance:9,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.45,normal:.33,rare:.15,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:16}],parts:o.getParts()})]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500}}}),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteCel"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCel"}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:4,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:i}]},{level:9,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:100}]},{level:19,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:24,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteCell"}]},{level:29,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:34,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{level:39,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:44,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:i}]},{level:49,type:"middlePrize",products:[{type:"CoinsProduct",amount:200}]},{level:54,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteRow"}]},{level:59,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:64,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"}]},{level:69,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:74,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:79,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"Shuffle"}]},{level:84,type:"middlePrize",products:[{type:"SpinProduct",amount:2}]},{level:89,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:94,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:99,type:"middlePrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:5,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:10,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:15,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:20,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:25,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:30,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:35,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:40,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:45,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:50,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:55,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:60,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:65,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:70,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:75,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:80,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:85,type:"battlePass",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:90,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:95,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:100,type:"battlePass",products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:7200,goodId:"starInField"}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryAnimationElement,owner:this,once:"beforeEnter",elements:[{el:".homeLawnBg",persistentClass:"active"}],id:1},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:2},{type:StoryTalkElement,once:"enter",talkKey:1,id:3},{type:StoryAnimationElement,owner:this,once:"enter",elements:[{el:".homeLawnBg",persistentClean:"active"}],id:4},{type:StoryTalkElement,once:"enter",talkKey:2,id:5},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"enter",delayAfter:2e3,id:6},{type:StoryTalkElement,delay:500,once:"enter",talkKey:3,id:7},{type:StoryTalkElement,on:"onFinishLevel3",talkKey:4,id:8},{type:StoryTalkElement,on:"onFinishLevel4",talkKey:5,id:9},{type:StoryTalkElement,on:"onFinishLevel4",talkKey:6,id:10},{type:StoryTalkElement,on:"onFinishLevel5",talkKey:7,id:11},{type:StoryTalkElement,on:"onFinishLevel6",talkKey:8,id:12},{type:StoryTalkElement,on:"onFinishLevel7",talkKey:9,id:13},{type:StoryTalkElement,on:"onFinishLevel8",talkKey:10,id:14},{type:StoryTalkElement,on:"onFinishLevel9",talkKey:11,id:15},{type:StoryTalkElement,on:"onFinishLevel9",talkKey:12,id:16},{type:StoryTalkElement,on:"onFinishLevel11",talkKey:13,id:17},{type:StoryTalkElement,on:"onFinishLevel12",talkKey:14,id:18},{type:StoryTalkElement,on:"onFinishLevel13",talkKey:15,id:19},{type:StoryTalkElement,on:"onFinishLevel14",talkKey:16,id:20},{type:StoryTalkElement,on:"onFinishLevel15",talkKey:17,id:21},{type:StoryTalkElement,on:"onFinishLevel17",talkKey:18,id:22},{type:StoryTalkElement,on:"onFinishLevel18",talkKey:19,id:23},{type:StoryTalkElement,on:"onFinishLevel19",talkKey:20,id:24},{type:StoryTalkElement,on:"onFinishLevel19",talkKey:21,id:25},{type:StoryTalkElement,on:"onFinishLevel21",talkKey:22,id:26},{type:StoryTalkElement,on:"onFinishLevel22",talkKey:23,id:27},{type:StoryTalkElement,on:"onFinishLevel23",talkKey:24,id:28},{type:StoryTalkElement,on:"onFinishLevel24",talkKey:25,id:29},{type:StoryTalkElement,on:"onFinishLevel24",talkKey:26,id:30},{type:StoryTalkElement,on:"onFinishLevel27",talkKey:27,id:31},{type:StoryTalkElement,on:"onFinishLevel28",talkKey:28,id:32},{type:StoryTalkElement,on:"onFinishLevel29",talkKey:29,id:33},{type:StoryTalkElement,on:"onFinishLevel29",talkKey:30,id:34},{type:StoryTalkElement,on:"onFinishLevel31",talkKey:31,id:35},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place1",talkKey:32,id:36},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place2",talkKey:33,id:37},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place3",talkKey:34,id:38},{type:StoryTalkElement,once:"regattaLineCrossLevel35Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:35,id:39},{type:StoryTalkElement,on:"onFinishLevel36",talkKey:36,id:40},{type:StoryTalkElement,on:"onFinishLevel37",talkKey:37,id:41},{type:StoryTalkElement,on:"onFinishLevel38",talkKey:38,id:42},{type:StoryTalkElement,on:"onFinishLevel39",talkKey:39,id:43},{type:StoryTalkElement,on:"onFinishLevel39",talkKey:40,id:44},{type:StoryTalkElement,on:"onFinishLevel42",talkKey:41,id:45},{type:StoryTalkElement,on:"onFinishLevel43",talkKey:42,id:46},{type:StoryTalkElement,on:"onFinishLevel44",talkKey:43,id:47},{type:StoryTalkElement,on:"onFinishLevel44",talkKey:44,id:48},{type:StoryTalkElement,on:"onFinishLevel48",talkKey:45,id:49},{type:StoryTalkElement,on:"onFinishLevel49",talkKey:46,id:50},{type:StoryTalkElement,on:"onFinishLevel49",talkKey:47,id:51},{type:StoryTalkElement,on:"onFinishLevel52",talkKey:48,id:52},{type:StoryTalkElement,on:"onFinishLevel53",talkKey:49,id:53},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place1",talkKey:50,id:54},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place2",talkKey:51,id:55},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place3",talkKey:52,id:56},{type:StoryTalkElement,once:"regattaLineCrossLevel55Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:53,id:57},{type:StoryTalkElement,on:"onFinishLevel57",talkKey:54,id:58},{type:StoryTalkElement,on:"onFinishLevel58",talkKey:55,id:59},{type:StoryTalkElement,on:"onFinishLevel59",talkKey:56,id:60},{type:StoryTalkElement,on:"onFinishLevel59",talkKey:57,id:61},{type:StoryTalkElement,on:"onFinishLevel62",talkKey:58,id:62},{type:StoryTalkElement,on:"onFinishLevel63",talkKey:59,id:63},{type:StoryTalkElement,on:"onFinishLevel64",talkKey:60,id:64},{type:StoryTalkElement,on:"onFinishLevel64",talkKey:61,id:65},{type:StoryTalkElement,on:"onFinishLevel65",talkKey:62,id:66},{type:StoryTalkElement,on:"onFinishLevel68",talkKey:63,id:67},{type:StoryTalkElement,on:"onFinishLevel69",talkKey:64,id:68},{type:StoryTalkElement,on:"onFinishLevel69",talkKey:65,id:69},{type:StoryTalkElement,on:"onFinishLevel72",talkKey:66,id:70},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place1",talkKey:67,id:71},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place2",talkKey:68,id:72},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place3",talkKey:69,id:73},{type:StoryTalkElement,once:"regattaLineCrossLevel75Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:70,id:74},{type:StoryTalkElement,on:"onFinishLevel76",talkKey:71,id:75},{type:StoryTalkElement,on:"onFinishLevel77",talkKey:72,id:76},{type:StoryTalkElement,on:"onFinishLevel78",talkKey:73,id:77},{type:StoryTalkElement,on:"onFinishLevel79",talkKey:74,id:78},{type:StoryTalkElement,on:"onFinishLevel79",talkKey:75,id:79},{type:StoryTalkElement,on:"onFinishLevel81",talkKey:76,id:80},{type:StoryTalkElement,on:"onFinishLevel83",talkKey:77,id:81},{type:StoryTalkElement,on:"onFinishLevel86",talkKey:78,id:82},{type:StoryTalkElement,on:"onFinishLevel88",talkKey:79,id:83},{type:StoryTalkElement,on:"onFinishLevel89",talkKey:80,id:84},{type:StoryTalkElement,on:"onFinishLevel89",talkKey:81,id:85},{type:StoryTalkElement,on:"onFinishLevel91",talkKey:82,id:86},{type:StoryTalkElement,on:"onFinishLevel93",talkKey:83,id:87},{type:StoryTalkElement,on:"onFinishLevel94",talkKey:84,id:88},{type:StoryTalkElement,on:"onFinishLevel94",talkKey:85,id:89},{type:StoryTalkElement,on:"onFinishLevel96",talkKey:86,id:90},{type:StoryTalkElement,on:"onFinishLevel99",talkKey:87,id:91},{type:StoryTalkElement,on:"onFinishLevel99",talkKey:88,id:92},{type:StoryTalkElement,on:"onFinishLevel99",talkKey:89,id:93},{type:StoryTalkElement,on:"onFinishLevel100",talkKey:90,id:94},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place1",talkKey:91,id:95},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place2",talkKey:92,id:96},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place3",talkKey:93,id:97},{type:StoryTalkElement,once:"regattaLineCrossLevel100Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:94,id:98},{type:StoryAnimationElement,owner:this,once:"regattaAfterPrizeWindowShowed100",elements:[{el:".homeLawnBg",persistentClass:"active"}],id:99},{type:StoryTalkElement,once:"regattaAfterPrizeWindowShowed100",talkKey:95,id:100},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,params:{prize:this.get("finishPrize").products,lastLevelFinishWindow:!0},delayAfter:0,once:"regattaAfterPrizeWindowShowed100",id:101},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:96,id:102},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:97,id:103},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:98,id:104},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:99,id:105},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:100,id:106},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:101,id:107},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:102,id:108},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".regatta-halloween2022world .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryForceElement,owner:this,once:"onCompleteLevel1",delay:200,id:201,el:".regatta-halloween2022world .startCurrentLevel",name:this.get("name")+"Force1"},{type:StoryForceElement,on:"onCompleteLevel2",page:"main",delay:200,id:202,el:".halloween2022world .mForgeBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,on:"onCompleteLevel2",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"Force3",id:203},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel())},on:"onAfterFinishLevel",delayAfter:4e3,id:204}]})}}),Sff,Xff,Yff;GravityGroundCell.prototype.animateTakeLife=(Sff=GravityGroundCell.prototype.animateTakeLife,function(t){if("halloween2022world"!==episode.get("num"))return Sff.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),figureRulesProcess.halloween2022worldBonusClasses=function(){FigureRules.add(".episode_halloween2022world .artifactPartCellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/artifactPlatform.png"}),FigureRules.add(".episode_halloween2022world .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"../../../gems/site/img/features/halloween2022world/artifactPart.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_halloween2022world .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_halloween2022world .bugCell .bugCellBg",{width:2*Config.cellWidth,height:2*Config.cellHeight,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2022world/charonIdle.png","margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .bugCell .bugCellBg.stable",{"background-image":"../../../gems/site/img/features/halloween2022world/charonIdle.png",spriteFrames:6,duration:600,playRound:!0,delay:[3e3,5e3]}),FigureRules.add(".episode_halloween2022world .bugCell .bugCellBg.damaged",{"background-image":"../../../gems/site/img/features/halloween2022world/charonEat.png",spriteFrames:8,duration:800}),FigureRules.add(".episode_halloween2022world .bugCell .bugCellBg.die",{"background-image":"../../../gems/site/img/features/halloween2022world/charonDie_xlarge.png",spriteFrames:7,duration:700}),FigureRules.add(".episode_halloween2022world .bugCell .mTask1",{"margin-left":55/60*Config.cellWidth,"margin-top":97/60*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .bugCell .mTask1 .taskIco",{width:47/95*Config.cellWidth,height:47/95*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/candyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":0*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .bugCell .mTask2",{"margin-left":55/60*Config.cellWidth,"margin-top":1.2*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .bugCell .mTask2 .taskIco",{width:.5*Config.cellWidth,height:.5*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/shmandyTask.png","margin-left":-5/60*Config.cellWidth,"margin-top":-5/60*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .bugCell .text.mCurrentCount",{"margin-left":28/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .bugCell .text.divider",{"margin-left":40/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .bugCell .text.mMaxCount",{"margin-left":52/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2022world/ghostDragonIdle.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:6,duration:600,delay:[2e3,3e3],playRound:!0}),FigureRules.add(".episode_halloween2022world .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2022world/ghostDragonAngry.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:3,framesOrder:[3,4,5],duration:300}),FigureRules.add(".episode_halloween2022world .alligatorFly",{"background-position-x":0,"background-position-y":0,"background-width":360,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2022world/ghostDragonAngry.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0*Config.cellWidth,"margin-top":0*Config.cellHeight,spriteFrames:4,framesOrder:[0,3,4,5],duration:400,playRound:!0,animation:{params:{width:[127/60*Config.cellWidth,32/60*Config.cellWidth],height:[127/60*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[-.05*Config.cellWidth,44/60*Config.cellWidth],"margin-top":[-4/60*Config.cellHeight,44/60*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_halloween2022world .attribute_falling",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/candy.png","margin-left":0,"margin-top":-.25*Config.cellHeight,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_halloween2022world .caviarCell .cellStone",{"background-width":70,"background-height":66,width:70/60*Config.cellWidth,height:1.1*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"margin-top":0}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell3 .cellStone",{frame:0}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell3 .stable",{animation:null}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell2 .cellStone",{frame:1}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell2 .stable",{animation:null}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell1 .cellStone",{frame:7}),FigureRules.add(".episode_halloween2022world .caviarCell.caviarCell0 .cellStone",{frame:8}),FigureRules.add(".episode_halloween2022world .caviarCell_R .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_R.png"}),FigureRules.add(".episode_halloween2022world .caviarCell_G .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_G.png"}),FigureRules.add(".episode_halloween2022world .caviarCell_B .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_B.png"}),FigureRules.add(".episode_halloween2022world .caviarCell_Y .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_Y.png"}),FigureRules.add(".episode_halloween2022world .caviarCell_P .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_P.png"}),FigureRules.add(".episode_halloween2022world .caviarCell_W .cellStone",{"background-image":"../../../gems/site/img/features/halloween2022world/spider_W.png"}),FigureRules.add(".episode_halloween2022world .fish5.fishcellBg",{"background-image":"../../../gems/site/img/features/halloween2022world/pumpkin.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2022world .fish9.fishcellBg",{"background-image":"../../../gems/site/img/features/halloween2022world/pumpkin.png","background-width":180,"background-height":180,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem1",{width:110/180*Config.cellWidth,height:101/180*Config.cellHeight,"background-width":110,"background-height":101,"margin-left":-50/180*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem2",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem3",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":10/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem4",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":-25/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock .lifeGem5",{width:55/180*Config.cellWidth,height:50/180*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-25/60*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_R .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_R.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_G .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_G.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_B .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_B.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_Y .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_Y.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_P .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_P.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_W .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_W.png"}),FigureRules.add(".episode_halloween2022world .barCellLifeBlock.color_s .lifeGem",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusLife_multi.png"}),FigureRules.add(".episode_halloween2022world .barCell",{width:188/180*Config.cellWidth,height:185/180*Config.cellHeight,"background-width":188,"background-height":185,"margin-left":-3/180*Config.cellWidth}),FigureRules.add(".episode_halloween2022world .barCell.Middle",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusCenter.png"}),FigureRules.add(".episode_halloween2022world .barCell.TopLeftCorner",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusCorner.png","scale-x":-1}),FigureRules.add(".episode_halloween2022world .barCell.TopRightCorner",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusCorner.png"}),FigureRules.add(".episode_halloween2022world .barCell.BottomLeftCorner",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusCorner.png","scale-x":-1,"scale-y":-1}),FigureRules.add(".episode_halloween2022world .barCell.BottomRightCorner",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusCorner.png","scale-y":-1}),FigureRules.add(".episode_halloween2022world .barCell.LeftSide",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusSide.png",rotate:-90}),FigureRules.add(".episode_halloween2022world .barCell.TopSide",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusSide.png"}),FigureRules.add(".episode_halloween2022world .barCell.RightSide",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusSide.png",rotate:90}),FigureRules.add(".episode_halloween2022world .barCell.BottomSide",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusSide.png","scale-y":-1}),FigureRules.add(".episode_halloween2022world .barCell.VerticalTop",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusEdge.png"}),FigureRules.add(".episode_halloween2022world .barCell.VerticalMiddle",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusMiddle.png"}),FigureRules.add(".episode_halloween2022world .barCell.VerticalBottom",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusEdge.png","scale-y":-1}),FigureRules.add(".episode_halloween2022world .barCell.HorizontalLeft",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusEdge.png",rotate:-90,"scale-y":-1}),FigureRules.add(".episode_halloween2022world .barCell.HorizontalMiddle",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusMiddle.png",rotate:90}),FigureRules.add(".episode_halloween2022world .barCell.HorizontalRight",{"background-image":"../../../gems/site/img/features/halloween2022world/cactusEdge.png",rotate:90}),FigureRules.add(".episode_halloween2022world .floorLevel1",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ice1.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2022world .floorLevel2",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ice2.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight,spriteFrames:0,framesOrder:[0],duration:0,delay:0,playRound:!1}),FigureRules.add(".episode_halloween2022world .floorLevel3",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ice3.png","margin-left":0,"margin-top":0,width:Config.cellWidth,height:Config.cellHeight}),FigureRules.add(".episode_halloween2022world .floorLevelAnimation3, .episode_halloween2022world .floorLevelAnimation2, .episode_halloween2022world .floorLevelAnimation1",{"background-position-x":0,"background-position-y":0,"background-width":113,"background-height":198,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/floor/iceBlast2.cd7c30e237.png",width:113/60*Config.cellWidth,height:3.3*Config.cellHeight,"margin-left":-26/60*Config.cellWidth,"margin-top":-26/60*Config.cellHeight,spriteFrames:4,duration:350}),FigureRules.add(".episode_halloween2022world .gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottle.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.gravityGroundLife2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.gravityGroundLife1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.gravityGroundLife1 .attributeIcon1, .episode_halloween2022world .gravityGroundCell.gravityGroundLife1 .attributeIcon2, .episode_halloween2022world .gravityGroundCell.gravityGroundLife1 .attributeIcon3, .episode_halloween2022world .gravityGroundCell.gravityGroundLife1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1 .attributeIcon1,.episode_halloween2022world .gravityGroundCell.life1 .attributeIcon2,.episode_halloween2022world .gravityGroundCell.life1 .attributeIcon3,.episode_halloween2022world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1 .attributeIcon1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1 .attributeIcon2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1 .attributeIcon3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.life1 .attributeIcon4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleCrack.png",frame:1}),FigureRules.add(".episode_halloween2022world .groundLife2.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .groundLife1.gravityGroundCell",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleNoCork.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .attribute_ground",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ghostInside.png","margin-left":-7,"margin-top":-5,scale:1}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .attribute_ground.attributeColor2",{"background-position-x":0}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .attribute_ground.attributeColor3",{"background-position-x":0}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .attribute_ground.attributeColor4",{"background-position-x":0}),FigureRules.add(".episode_halloween2022world .gravityGroundCell.explode",{spriteFrames:1,duration:1,animation:null}),FigureRules.add(".episode_halloween2022world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleBreak.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundExplode2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleBreak.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundExplode1",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/bottleBreak.png"}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .groundExplode1.gravityGroundExplode",{"background-position-x":0}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .groundExplode2.gravityGroundExplode",{"background-position-x":180}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .groundExplode3.gravityGroundExplode",{"background-position-x":360}),FigureRules.add(".episode_halloween2022world .gravityGroundCell .groundExplode4.gravityGroundExplode",{"background-position-x":540}),FigureRules.add(".episode_halloween2022world .cork",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/cork.png"}),FigureRules.add(".episode_halloween2022world .eelDecoratorOnCell .attributeIcon1, .episode_halloween2022world .eelDecoratorOnCell .attributeIcon2, .episode_halloween2022world .eelDecoratorOnCell .attributeIcon3, .episode_halloween2022world .eelDecoratorOnCell .attributeIcon4",{opacity:0}),FigureRules.add(".episode_halloween2022world .attribute_ground.flying",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2022world .attribute_ground.flying.attributeColor2",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2022world .attribute_ground.flying.attributeColor3",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2022world .attribute_ground.flying.attributeColor4",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/ghostFlying.png","background-position-x":0}),FigureRules.add(".episode_halloween2022world .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2022world/sheep_xlarge.png"}),FigureRules.add(".episode_halloween2022world .pastureCell.life2 .attribute_animal",{"background-image":"../../../gems/site/img/features/halloween2022world/sheepDark_xlarge.png"}),FigureRules.add(".episode_halloween2022world .attribute_animal.animateCollect",{"background-image":"../../../gems/site/img/features/halloween2022world/sheepFlying.png"}),FigureRules.add(".episode_halloween2022world .icebergCellBg",{"background-image":"../../../gems/site/img/features/halloween2022world/iceberg.png"}),FigureRules.add(".episode_halloween2022world .icebergExplode",{"background-image":"../../../gems/site/img/features/halloween2022world/icebergDie.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variant1",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variant2",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variant3",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandy3.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variant4",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandy1.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variant5",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandy2.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbig1",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBig1.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbig2",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBig2.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbig3",{"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBig3.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigVertical1",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigVertical2",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigVertical3",{width:2*Config.cellWidth,height:3*Config.cellHeight,"background-width":344,"background-height":525,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigVertical.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigHorizontal1",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigHorizontal.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigHorizontal2",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigHorizontal.png"}),FigureRules.add(".episode_halloween2022world .frozen_frozenegg.variantbigHorizontal3",{width:3*Config.cellWidth,height:2*Config.cellHeight,"background-width":525,"background-height":343,"background-image":"../../../gems/site/img/features/halloween2022world/frozenCandyBigHorizontal.png"}),FigureRules.add(".episode_halloween2022world .muffin.muffin",{"background-position-x":0,"background-position-y":0,"background-width":24,"background-height":22,"background-image":"../../../gems/site/img/features/halloween2022world/appleInside.png",width:60/180*Config.cellWidth,height:56/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin1",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin2",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin3",{"margin-top":132/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin4",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin5",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.muffin6",{"margin-top":202/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .muffin.flyingMuffin",{"background-position-x":0,"background-position-y":0,"background-width":74,"background-height":77,"background-image":"../../../gems/site/img/features/halloween2022world/apple.png",width:96/180*Config.cellWidth,height:100/180*Config.cellHeight}),FigureRules.add(".episode_halloween2022world .sail .taskIconContainer .taskIco.color_ClearFallingCellAttributes",{"background-height":180,"background-width":180,"background-image":"../../../gems/site/img/features/halloween2022world/candyTask.png"}),FigureRules.add(".episode_halloween2022world .coinChestHeadCell",{width:131/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5.5/60*Config.cellHeight,"margin-top":0,"background-width":393,"background-height":360,"background-image":"../../../gems/site/img/features/halloween2022world/candyChest.png"}),FigureRules.add(".episode_halloween2022world .coinChestHeadCell.opened",{spriteFrames:6,duration:500,playRound:!1}),FigureRules.add(".episode_halloween2022world .coinChestHeadCell.closed",{framesOrder:[5,4,3,2,1,0],spriteFrames:6,duration:250,playRound:!1}),FigureRules.add(".episode_halloween2022world .attribute_coin",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/coinCandy.png"}),FigureRules.add(".episode_halloween2022world .attribute_coin_remove",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"../../../gems/site/img/features/halloween2022world/coinCandyTask.png"})},figureRulesProcess.additionalBonusScaleImages=(Xff=figureRulesProcess.additionalBonusScaleImages,function(){Xff.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/halloween2022world/charonDie_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/charonEat.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/charonIdle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ghostDragonAngry.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ghostDragonIdle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/candy.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/artifactPlatform.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/pumpkin.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ice1.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ice2.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ice3.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/bottle.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/bottleNoCork.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/bottleBreak.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/bottleCrack.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/ghostInside.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/sheep_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/sheepDark_xlarge.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/iceberg.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/icebergDie.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/sheepFlying.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/frozenCandyBigHorizontal.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/frozenCandyBigVertical.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/coinCandy.png":_Figure.scaleKoef,"../../../gems/site/img/features/halloween2022world/candyChest.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(Yff=figureRulesProcess.additionalBonusClasses,function(){Yff.call(this),figureRulesProcess.halloween2022worldBonusClasses()});var SpringWorldView=BonusWorldView.extend({events:_.defaults({"click .prizeControllerOuterProgressBar .infoWindowClick":"onProgressBarClick"},BonusWorldView.prototype.events),initialize:function(){BonusWorldView.prototype.initialize.call(this),this.prizeControllerProgressbar=new PrizeControllerOuterProgressBar({el:$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$el),model:this.model.getComponent(PrizeController)}),this.ticketsInfoButton=new TriesInfoButton({el:$("#rewardChain .freePlate"),model:this.model});var e=$(".invisible.mainTemplates .mRunRandomLevelBtn");this.randomBtn=new StartLevelView({model:this.model,el:e.clone().appendTo(this.$(".bonusWorldUI")),rules:this.model.cmp("rulsRunLevel")}),this.randomBtn.$el.find(".mRandomLevelBtnText").html(messages[this.model.get("name")+"LookForBunniesBtn"])},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);var e=this.model.getComponent(PrizeController);this.updateScreen(),this.updateTotalCounter(),this.prizeControllerProgressbar.update(),this.model.on("onCompleteLevel",this.updateScreen,this),this.model.on("onCompleteLevel",this.updateTotalCounter,this),e.on("change:points",this.updateTotalCounter,this)},onExit:function(){BonusWorldView.prototype.onExit.call(this);var e=this.model.getComponent(PrizeController);this.model.off("onCompleteLevel",this.updateScreen,this),this.model.off("onCompleteLevel",this.updateTotalCounter,this),e.off("change:points",this.updateTotalCounter,this)},updateScreen:function(){for(var e=this.model.getCurrentLevel(),t=0;t<=this.model.screens;++t)$(".wrapper").removeClass(this.model.get("name")+"_screen"+t);var i=this.model.get("name")+"_screen1";25<e&&e<=this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen2"),e>this.model.get("levelsInEpisode")&&(i=this.model.get("name")+"_screen3"),$(".wrapper").addClass(i)},updateTotalCounter:function(){var e=$(".rewardChainBtn."+this.model.get("name")+" .mPointsCounter"),t=this.model.getComponent(PrizeController),i=t.getMaxPointsPossible(),o=t.getPoints();e.toggleClass("complete",i<=o),e.html(Math.min(o,i)+"/"+i)},onProgressBarClick:function(){this.model.openPrizeControllerInfo()}}),SpringWorld=BonusWorld.extend({screens:3,defaults:_.defaults({name:"springworld",version:20240402,levelsInEpisode:50,helpWindow:!1,viewId:SpringWorldView,showFinalForce:!1,durationDays:!1,suggestPlayForLife:!0,lastLevelOpen:!0,production:!0,saveReplayLevel:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:6,openDate:null,showProgress:!0,forceId:!0,actionQueue:new ActionQueue,livesInstance:new BonusWorldLives,withoutInnerWindow:!0,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives",amount:2}],unlimitedName:"unlimitedBonusWorldLives",allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,finishWindowInStories:!0,allowAfterWin:!0,sounds:{narrator:!1,pirate1:!1,pirate2:!1,pirate3:!1,pirate4:!1,girl1:!1,girl2:!1,girl3:!1,girl4:!1,kudrik1:!1,kudrik2:!1,kudrik3:!1,jack1:!1,jack2:!1,candybeard1:!1,candybeard2:!1,candybeard3:!1,admiral1:!1,admiral2:!1,admiral3:!1,ctulhu1:!1,ctulhu2:!1,persik1kudrik1:!1,pirate3jack1candybeard1:!1,persik1:!1},prizes:[{type:"finalPrize",level:50,prize:[{type:"coins",amount:300},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives";this.addComponent(TriesComponent,{conditioner:{isTryValid:function(e,t){return t<=e.world.getCurrentLevel()},canGivePrize:function(e,t){return t<=e.world.getCurrentLevel()}},reminderWindowThreshold:1/0,variants:[{tries:1,prizes:{products:[{type:"PrizePointsProduct",amount:4}]}},{tries:2,prizes:{products:[{type:"PrizePointsProduct",amount:3}]}},{tries:3,prizes:{products:[{type:"PrizePointsProduct",amount:2}]}},{tries:1/0,prizes:{products:[{type:"PrizePointsProduct",amount:1}]}}]}),this.prizeController=this.addComponent(PrizeController,{world:this,accountant:new PrizeProgressAccount([12,7,12,18,29,47,75]),prizes:[{progress:1,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:2,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:3,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:4,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"SpinProduct",amount:1}]},{progress:5,type:"middlePrize",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"30m"}]},{progress:6,type:"middlePrize",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:7,type:"middlePrize",products:[{type:"CoinsProduct",amount:400},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"12h"},{type:"GoodProduct",goodId:GoodTypes.unlimitedKeys,addTime:"24h"},{type:"SpinProduct",amount:1}]},{progress:1,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{progress:2,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:3,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:2},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{progress:4,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:5,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{progress:6,type:"battlePass",products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:i,addTime:"1h"}]},{progress:7,type:"battlePass",products:[{type:"CoinsProduct",amount:350},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"4h"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"4h"}]}]}),this.battlePass=new BattlePass({world:this,catchupWindowRule:catchupWindowShowRules.byPrizeControllerThreshold(2),catchupWindowActivator:new EventSignal("prizeControllerAfterTakePrize",this),instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:1800,goodId:i},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}}),this.addComponent(RandomLevelComponent,{lowerMargin:16,upperMargin:40,useLevelSet:!0,saveReplayLevel:!0}),this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".bonusWorldUI.springworld",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{scrollable:!0,partSource:new Artifacts.BoxPartDroppper({chances:{15:55,7:55},generatingModel:Artifacts.WeighedPartGeneration,rule:function(){return 2<t.getCurrentLevel()}}),config:{showAll:!0,parts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"good",name:i,amount:.5}]},{id:2,parts:[5,6,7,8],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"starInField",amount:1}]},{id:3,parts:[9,10,11,12],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",amount:1}]},{id:4,parts:[13,14,15,16],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:100},{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[17,18,19,20],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:2},{type:"powerUp",name:"deleteRowPowerUp",amount:1}]},{id:6,type:"finish",relative:[1,2,3,4,5],cooldown:10800,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",amount:2},{type:"spins",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,fixed:!0,artifacts:[6]}]}}}),this.addComponent(StoryController,{name:this.name,world:this,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"enter",delayAfter:0,id:1},{type:StoryTalkElement,owner:this,once:"enter",id:2,talkKey:1},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"enter",delayAfter:2e3,id:3},{type:StoryTalkElement,owner:this,once:"enter",id:4,talkKey:2},{type:StoryTalkElement,owner:this,once:"enter",id:5,talkKey:3},{type:StoryForceElement,owner:this,once:"enter",id:6,el:".bonusWorldUI.springworld .startCurrentLevel",name:this.get("name")+"Force0"},{type:StoryGroup,id:7,once:"onFinishLevel1",stories:[{type:StoryForceElement,owner:this,once:"onFinishLevel1",el:"#map .rewardChainBtn.springworld",name:this.get("name")+"Force7"},{type:StoryForceElement,owner:this,once:"onFinishLevel1",el:".bonusWorldUI.springworld .startCurrentLevel",name:this.get("name")+"Force8"}]},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel5",id:8,talkKey:4},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel10",id:9,talkKey:5},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel15",id:10,talkKey:6},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel20",id:11,talkKey:7},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel25",id:12,talkKey:8},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel30",id:13,talkKey:9},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel35",id:14,talkKey:10},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel40",id:15,talkKey:11},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel42",id:16,talkKey:12},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel45",id:17,talkKey:13},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel50",id:18,talkKey:14},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel50",isAvailable:function(){return t.prizeController.getProgress()===t.prizeController.getMaxProgress()},id:19,talkKey:15},{type:StoryTalkElement,owner:this,page:"main",once:"onFinishLevel50",isAvailable:function(){return t.prizeController.getProgress()!==t.prizeController.getMaxProgress()},id:20,talkKey:16},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize7",id:203,talkKey:15},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"prizeControllerBeforeTakePrize7",delayAfter:0,id:21},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,lastLevelFinishWindow:!0,publicationOff:!0},owner:this,once:"onFinishLevel50",id:22},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,params:{world:this,title:messages[this.get("name")+"KeepPlayingTitle"],picture:"goToPlay",auxText:messages[this.get("name")+"KeepPlayingDescription"],otherElements:[{selector:"close okayBt",content:messages.okay}]},isAvailable:function(){return t.prizeController.getProgress()<t.prizeController.getMaxProgress()},owner:this,once:"onFinishLevel50",delayAfter:0,id:23},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize1",id:25,talkKey:17},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize3",id:26,talkKey:18},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize6",id:27,talkKey:19},{type:StoryTalkElement,owner:this,once:"prizeControllerBeforeTakePrize7",id:28,talkKey:20},{type:StoryForceElement,owner:this.artifactController,once:"activate",id:201,el:".artifactWorkshopButton.springworld",name:"springworldForce2",delayAfter:0},{type:StoryForceElement,page:"artifacts",owner:this.artifactController,once:"openWorkshop",id:202,el:".artifactWorkshop.springworld .tree .button1",name:"springworldForce4"}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".artifactWorkshopButton")},duration:1500}}}),this.addComponent(ReturnWorldComponent)},openPrizeControllerInfo:function(){new WorldInfo({world:this})}}),Ggf,Hgf;figureRulesProcess.springworldBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(Ggf=figureRulesProcess.additionalBonusClasses,function(){Ggf.call(this),figureRulesProcess.springworldBonusClasses(),FigureRules.add(".episode_springworld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/springworld/artifactPart.2d455aed8e.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_springworld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_springworld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_springworld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_springworld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_springworld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_springworld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_springworld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_springworld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_springworld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_springworld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_springworld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_springworld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_springworld .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_springworld .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_springworld .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_springworld .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_springworld .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_springworld .artifactPartCell.part18 .part",{frame:17}),FigureRules.add(".episode_springworld .artifactPartCell.part19 .part",{frame:18}),FigureRules.add(".episode_springworld .artifactPartCell.part20 .part",{frame:19}),featuresAdder.addFeature("springworld","parrot_rabbit"),featuresAdder.addFeature("springworld","coinchest_carrotchest"),featuresAdder.addFeature("springworld","well_plant"),featuresAdder.addFeature("springworld","flamy_fairy"),featuresAdder.addFeature("springworld","greedypirate_carrot")}),figureRulesProcess.additionalBonusScaleImages=(Hgf=figureRulesProcess.additionalBonusScaleImages,function(){Hgf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/springworld/rabbitTask.png":_Figure.scaleKoef})});var summersearchworldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this);var e=$("#map .scrolledBlock");this.$parts=$('<div class="parts">'),e.append(this.$parts),this.renderItems(),$(".mainTemplates .mPrizeControllerOuterProgressBar").clone().appendTo(this.$el.find(".mPrizeControllerOuterProgressBarWrapper"))},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.updateProgressBar()},onCompleteLevel:function(){BonusWorldView.prototype.onCompleteLevel.call(this),this.updateProgressBar()},renderItems:function(){for(var e=this.model.get("prizes").filter(function(e){return"middlePrize"===e.type}),t=0;t<e.length;t++)this.createPart("mess chest"+(t+1));this.createPart("startPirate"),this.createPart("girl"),this.createPart("ship")},createPart:function(e){var t=$(".invisible .bonusWorldPart").clone();t.addClass(e),this.$parts.append(t)},updateProgressBar:function(){var e=this.$(".mPrizeControllerOuterProgressBar"),t=this.model.getCurrentLevel()-1;if(t!==this.model.get("levelsInEpisode")){e.addClass("active");for(var i=e.find(".progressBarLine"),o=e.find(".bonusWorldProgressText"),a=this.model.get("prizes").filter(function(e){return"middlePrize"===e.type}),n=0,r=0,s=0;s<a.length;s++)if(t<a[s].level){r=a[s].level,0<s&&(n=a[s-1].level);break}var l=e.find(".bonusWorldPrizes");l.length?(l.addClass("progress_bar_prizes"),l.empty()):(l=$('<div class="bonusWorldPrizes progress_bar_prizes"></div>'),e.append(l));var d=a.find(function(e){return e.level===r})||this.model.get("prizes").find(function(e){return"finalPrize"===e.type}),c=$('<div class="reward"><div class="products level'.concat(d.level,'"></div></div>'));new UserPrizesView({model:new Backbone.Collection(d.prize.map(function(e){return new UserPrize(e)})),el:c.find(".products"),isGroup:!0}),l.append(c),e.find(".markSmall").toggleClass("hide",0===r),e.find(".markBig").toggleClass("hide",0<r),r||(n=a[a.length-1].level,r=this.model.get("levelsInEpisode"));var g=r-n,u=g-(r-t);i.width(Math.ceil(100*u/g)+"%"),o.html(u+"/"+g)}else e.removeClass("active")}}),SummerSearchWorld=BonusWorld.extend({defaults:_.defaults({name:"summersearchworld",viewId:summersearchworldView,version:20230425,production:!0,levelsInEpisode:40,durationDays:5,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",episode:1,level:2,showTimer:!0,minEpisodeToEnter:2,minLevelToEnter:14,finishWindowInStories:!0,forceId:!0,openDate:null,closeForNew:!1,withoutInnerWindow:!0,skipLevelPublication:!0,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,actionQueue:new ActionQueue,prizes:[{type:"middlePrize",level:4,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:9,prize:[{type:"coins",amount:100},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{type:"middlePrize",level:15,prize:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"middlePrize",level:22,prize:[{type:"coins",amount:200},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:30,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]},{type:"finalPrize",level:40,prize:[{type:"coins",name:"coins",cssClass:"coins",amount:500},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:2},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:12},{type:"good",name:"starInField",cssClass:"starInField",amount:12}]}]},BonusWorld.prototype.defaults),initialize:function(e){BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{collectors:[new ArtifactPartsCollector({world:this})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,once:"enter",delayAfter:0,id:1},{type:StoryAnimationElement,owner:this,once:"enter",scrollTo:".scrolledBlock .parts .startPirate",elements:[{el:".scrolledBlock .parts .startPirate",persistentClass:"visible"}],id:2},{type:StoryTalkElement,owner:this,once:"enter",talkKey:1,id:3},{type:StoryAnimationElement,owner:this,once:"enter",scrollTo:".scrolledBlock .parts .chest1",elements:[{el:".scrolledBlock .parts .startPirate",persistentClean:"visible"},{el:".scrolledBlock .parts .chest1",persistentClass:"beforeOpen"}],id:4},{type:StoryForceElement,owner:this,once:"enter",el:".bonusWorldUI.summersearchworld .startCurrentLevel",name:this.get("name")+"Force0",id:5},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize4",scrollTo:".scrolledBlock .parts .chest1",elements:[],id:6},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize4",talkKey:2,id:7},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize4",scrollTo:".scrolledBlock .parts .chest1",elements:[{el:".scrolledBlock .parts .chest1",persistentClean:"beforeOpen"},{el:".scrolledBlock .parts .chest1",persistentClass:"afterOpen"}],id:8},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize4",scrollTo:".scrolledBlock .parts .chest2",elements:[{el:".scrolledBlock .parts .chest1",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest1",persistentClass:"opened"},{el:".scrolledBlock .parts .chest2",persistentClass:"beforeOpen"}],id:9},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize9",scrollTo:".scrolledBlock .parts .chest2",elements:[{el:".scrolledBlock .parts .chest1",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest1",persistentClass:"opened"},{el:".scrolledBlock .parts .chest2",persistentClass:"beforeOpen"}],id:10},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize9",talkKey:3,id:11},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize9",scrollTo:".scrolledBlock .parts .chest2",elements:[{el:".scrolledBlock .parts .chest2",persistentClean:"beforeOpen"},{el:".scrolledBlock .parts .chest2",persistentClass:"afterOpen"}],id:12},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize9",scrollTo:".scrolledBlock .parts .chest3",elements:[{el:".scrolledBlock .parts .chest2",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest2",persistentClass:"opened"},{el:".scrolledBlock .parts .chest3",persistentClass:"beforeOpen"}],id:13},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize15",scrollTo:".scrolledBlock .parts .chest3",elements:[{el:".scrolledBlock .parts .chest2",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest2",persistentClass:"opened"},{el:".scrolledBlock .parts .chest3",persistentClass:"beforeOpen"}],id:14},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize15",talkKey:4,id:15},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize15",scrollTo:".scrolledBlock .parts .chest3",elements:[{el:".scrolledBlock .parts .chest3",persistentClean:"beforeOpen"},{el:".scrolledBlock .parts .chest3",persistentClass:"afterOpen"}],id:16},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize15",scrollTo:".scrolledBlock .parts .chest4",elements:[{el:".scrolledBlock .parts .chest3",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest3",persistentClass:"opened"},{el:".scrolledBlock .parts .chest4",persistentClass:"beforeOpen"}],id:17},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize22",scrollTo:".scrolledBlock .parts .chest4",elements:[{el:".scrolledBlock .parts .chest3",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest3",persistentClass:"opened"},{el:".scrolledBlock .parts .chest4",persistentClass:"beforeOpen"}],id:18},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize22",talkKey:5,id:19},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize22",scrollTo:".scrolledBlock .parts .chest4",elements:[{el:".scrolledBlock .parts .chest4",persistentClean:"beforeOpen"},{el:".scrolledBlock .parts .chest4",persistentClass:"afterOpen"}],id:20},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize22",scrollTo:".scrolledBlock .parts .chest5",elements:[{el:".scrolledBlock .parts .chest4",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest4",persistentClass:"opened"},{el:".scrolledBlock .parts .chest5",persistentClass:"beforeOpen"}],id:21},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize30",scrollTo:".scrolledBlock .parts .chest5",elements:[{el:".scrolledBlock .parts .chest4",persistentClean:"afterOpen"},{el:".scrolledBlock .parts .chest4",persistentClass:"opened"},{el:".scrolledBlock .parts .chest5",persistentClass:"beforeOpen"}],id:22},{type:StoryTalkElement,owner:this,once:"beforeTakeLevelPrize30",talkKey:6,id:23},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize30",scrollTo:".scrolledBlock .parts .chest1",elements:[{el:".scrolledBlock .parts .chest5",persistentClean:"beforeOpen"},{el:".scrolledBlock .parts .chest5",persistentClass:"opened"},{el:".scrolledBlock .parts .startPirate",persistentClass:"searchFinish"}],id:24},{type:StoryTalkElement,owner:this,once:"winLevel40",talkKey:7,id:25},{type:StoryAnimationElement,owner:this,once:"winLevel40",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.summersearchworld",persistentClass:"show"}],id:26},{type:StoryAnimationElement,owner:this,once:"winLevel40",scrollTo:".scrolledBlock .parts .ship",elements:[{el:".scrolledBlock .parts .startPirate",persistentClean:"searchFinish"},{el:".scrolledBlock .parts .startPirate",persistentClass:"finish"},{el:".scrolledBlock .parts .girl",persistentClass:"visible"},{el:".scrolledBlock .parts .ship",persistentClass:"visible"}],id:27},{type:StoryAnimationElement,owner:this,once:"winLevel40",scrollTo:".scrolledBlock .parts .ship",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.summersearchworld",persistentClean:"show"},{el:".bonusWorldAnimations.summersearchworld",persistentClass:"hide"}],id:28},{type:StoryTalkElement,owner:this,once:"winLevel40",talkKey:8,id:29},{type:StoryAnimationElement,owner:this,once:"winLevel40",scrollTo:".scrolledBlock .parts .ship",delayAfter:1e3,elements:[{el:".bonusWorldAnimations.summersearchworld",persistentClean:"show"},{el:".bonusWorldAnimations.summersearchworld",persistentClean:"hide"}],id:30},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:this.get("prizes").find(function(e){return"finalPrize"===e.type}).prize},owner:this,on:"winLevel40",id:31}]}),this.addComponent(ProlongateWorldComponent)}}),nhf,qhf,shf,vhf,yhf,Dhf,Ehf;BossCell.prototype.animateTakeLife=(nhf=BossCell.prototype.animateTakeLife,function(e){if("summersearchworld"===episode.get("num")){if(0===this.life)gameView.fallDownExplodeWithoutRemove(this.$div,3,"trashPiece");else{var t=_.random(1,3);gameView.fallDownExplodeWithoutRemove(this.$div,1,"trashPiece"+t)}return nhf.call(this,e)}return nhf.call(this,e)}),BossCell.prototype.playRemoveAnimation=(qhf=BossCell.prototype.playRemoveAnimation,function(e){return"summersearchworld"===episode.get("num")&&gameView.fallDownExplodeWithoutRemove(this.$div,3,"trashPiece"),qhf.call(this,e)}),ParrotCell.prototype.createDiv=(shf=ParrotCell.prototype.createDiv,function(e){if("summersearchworld"===episode.get("num")){var t=BaseCell.prototype.createDiv.call(this);return this.decorationVariant=RANDOM([1,2,3]),t.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").addClass("stable"),t.addClass("decoration_"+this.decorationVariant),t}return shf.call(this)}),ParrotCell.prototype.animateTakeLife=(vhf=ParrotCell.prototype.animateTakeLife,function(e){"summersearchworld"===episode.get("num")?(application.playSound(this.getTakeLifeSound()),this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel"+this.life).delay(500).queue(function(e){this.addClass(this.baseName+"Level"+this.life).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable"),e()):vhf.call(this,e)}),ParrotCell.prototype.animateRemoval=(yhf=ParrotCell.prototype.animateRemoval,function(i){if("summersearchworld"!==episode.get("num"))return yhf.call(this,i);var o=this;this.$div.removeClass(this.baseName+"Level"+(this.life+1)).addClass(this.baseName+"ChangeLevel0").delay(500).queue(function(e){this.addClass(o.baseName+"Level0").find("."+o.baseName+"CellBg").removeClass("stable").addClass("stable"),e();var t=FigureView.createByTemplate(".invisible .emptyTemplate").addClass(o.baseName);_Figure.blockedAnimations.append(t),t.alignTo(o.$div),Game.trigger("removed"+o.getCapitalisedBaseName(),t),t.remove(),o.$div.remove(),i()}).find("."+this.baseName+"CellBg").removeClass("stable").addClass("stable")}),figureRulesProcess.summersearchworldBonusClasses=function(){},figureRulesProcess.additionalBonusScaleImages=(Dhf=figureRulesProcess.additionalBonusScaleImages,function(){Dhf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/inkParticle.974cab3d5a.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/genry_xlarge.acda8e793b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/genryFly_xlarge.e35cda84cb.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/hand.425227061b.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/special8.25a966c9be.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/lifeBlock.e80b9c4868.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(Ehf=figureRulesProcess.additionalBonusClasses,function(){var e;Ehf.call(this),figureRulesProcess.summersearchworldBonusClasses(),FigureRules.add(".episode_summersearchworld .specialItemRemove",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/special8.25a966c9be.png"}),FigureRules.add(".episode_summersearchworld .fish.fishcellBg",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/rustyAnchorCell.89bc7ecda9.png"}),FigureRules.add(".episode_summersearchworld .alligatorBg.stable",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMess.5e2fbf2424.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_summersearchworld .alligatorBg.alligatorAngry",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMess.5e2fbf2424.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1}),FigureRules.add(".episode_summersearchworld .alligatorFly",{"background-position-x":0,"background-position-y":0,"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMess.5e2fbf2424.png",width:2*Config.cellWidth,height:2*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:1,duration:1,playRound:!1,animation:{params:{width:[2*Config.cellWidth,32/60*Config.cellWidth],height:[2*Config.cellHeight,32/60*Config.cellHeight],"margin-left":[0,44/60*Config.cellWidth],"margin-top":[0,1.5*Config.cellHeight],opacity:[1,0]},duration:1400}}),FigureRules.add(".episode_summersearchworld .alligatorLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":34/60*Config.cellWidth,"margin-top":88/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .alligatorLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .less50PercentLife.alligatorLife",{"background-color":"#ffff00"}),FigureRules.add(".episode_summersearchworld .less25PercentLife.alligatorLife",{"background-color":"#f2342c"}),FigureRules.add(".episode_summersearchworld .alligatorHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-20/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .trashPiece1",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMessParticle11.9dc9337616.png","background-width":148,"background-height":177,width:148/180*Config.cellWidth,height:177/180*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .trashPiece2",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMessParticle21.060635ae5c.png","background-width":198,"background-height":153,width:1.1*Config.cellWidth,height:.85*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .trashPiece3",{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/smallMessParticle31.94b4f07596.png","background-width":137,"background-height":153,width:137/180*Config.cellWidth,height:.85*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .genrymorganLeftHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/hand.425227061b.png","scale-x":-1}),FigureRules.add(".episode_summersearchworld .genrymorganRightHand",{width:Config.cellWidth,height:Config.cellHeight,"margin-left":0,"margin-top":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/hand.425227061b.png"}),FigureRules.add(".episode_summersearchworld .genrymorganLeftHand.process, .episode_summersearchworld .genrymorganRightHand.process",{"background-position-x":180}),FigureRules.add(".episode_summersearchworld .genrymorganLeftHand.stable",{"margin-left":-.4*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .genrymorganRightHand.stable",{"margin-left":.4*Config.cellWidth,"margin-top":10/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .genrymorganFly",{width:373/180*Config.cellWidth,height:399/180*Config.cellHeight,"margin-left":-6/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,"background-width":373,"background-height":399,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/genryFly_xlarge.e35cda84cb.png",spriteFrames:10,duration:1e3}),FigureRules.add(".episode_summersearchworld .genrymorganLifeBlock",{"background-position-x":0,"background-position-y":0,"background-width":52,"background-height":13,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlock.e80b9c4868.png",width:52/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":.5*Config.cellWidth,"margin-top":110/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .genrymorganLife",{"background-color":"#a1ec00",width:46/60*Config.cellWidth,height:.1*Config.cellHeight,"margin-left":.05*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .less50PercentLife.genrymorganLife",{"background-color":"#ffff00"}),FigureRules.add(".episode_summersearchworld .less25PercentLife.genrymorganLife",{"background-color":"#f2342c"}),FigureRules.add(".episode_summersearchworld .genrymorganHeadCell",{width:373/180*Config.cellWidth,height:399/180*Config.cellHeight,"margin-left":-6/180*Config.cellWidth,"margin-top":-20/180*Config.cellHeight,"background-width":373,"background-height":399,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/genry_xlarge.acda8e793b.png"}),FigureRules.add(".episode_summersearchworld .genrymorganHeadCell .powerUpHighlightBg.powerUpHighlightBgAnimation",{"margin-top":Config.cellWidth+.55*Config.cellWidth,"margin-left":Config.cellHeight-17/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .genrymorganHeadCell.stable",{spriteFrames:17,duration:1800,framesOrder:[0,1,2,3,4,5,6,7,8,5,6,7,8,5,6,7,8],playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".episode_summersearchworld .genrymorganHeadCell.genrymorganAngry",{spriteFrames:3,framesOrder:[8,9,10,11,0],duration:400}),FigureRules.add(".episode_summersearchworld .genrymorganLifeBlock .genrymorganLife",{opacity:1,textAlign:"center",font:"normal "+20/60*Config.cellWidth+"px 'Marvin', 'Tahoma'",color:"#ffc600","text-left":65/60*Config.cellWidth,"text-top":.6*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .parrotCell.cell",{"background-image":""}),FigureRules.add(".episode_summersearchworld .parrotCellBg",{"background-position-y":0,"background-width":84,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/clothesBox.de51d80691.png",width:1.4*Config.cellWidth,height:80/60*Config.cellHeight,"margin-left":-.2*Config.cellWidth,"margin-top":-10/60*Config.cellHeight}),FigureRules.add(".episode_summersearchworld .parrotLevel1 .parrotCellBg",{"background-position-x":672}),FigureRules.add(".episode_summersearchworld .parrotLevel1 .parrotCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_summersearchworld .parrotLevel2 .parrotCellBg",{"background-position-x":336}),FigureRules.add(".episode_summersearchworld .parrotLevel2 .parrotCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_summersearchworld .parrotLevel3 .parrotCellBg",{"background-position-x":0}),FigureRules.add(".episode_summersearchworld .parrotLevel3 .parrotCellBg.stable",{spriteFrames:1,duration:1,playRound:!1}),FigureRules.add(".episode_summersearchworld .parrotCellCage",{opacity:0}),FigureRules.add(".episode_summersearchworld .parrotChangeLevel2 .parrotCellBg.stable",(_defineProperty(e={spriteFrames:5},"spriteFrames",5),_defineProperty(e,"duration",400),_defineProperty(e,"playRound",!1),e)),FigureRules.add(".episode_summersearchworld .parrotChangeLevel1 .parrotCellBg.stable",{spriteFrames:5,duration:400,framesOrder:[4,5,6,7,8],playRound:!1}),FigureRules.add(".episode_summersearchworld .parrotChangeLevel0 .parrotCellBg.stable",{spriteFrames:5,duration:400,framesOrder:[8,9,10,11,12],playRound:!1}),FigureRules.add(".episode_summersearchworld .parrot",{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/summersearchworld/clothesBoxTarget.ec77f774bc.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:0,framesOrder:[0],playRound:!1})});var WildWildWestView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})}}),WildWildWest=BonusWorld.extend({defaults:_.defaults({name:"wildwildwest",version:20230428,viewId:WildWildWestView,production:!0,levelsInEpisode:100,durationDays:!1,helpWindow:!0,showFinalForce:!0,showProgress:!0,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:3,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,withoutInnerWindow:!0,prolongMaxTimes:1,actionQueue:new ActionQueue,finishWindowInStories:!0,livesInstance:new BonusWorldLives,livesConfig:{lifeRestoreTimeWithBattlePass:900,maxLivesWithBattlePass:8,refillPriceWithBattlePass:500},unlimitedName:"unlimitedBonusWorldLives",sounds:{narrator:!1,pirate1:!1,pirate2:!1,pirate3:!1,pirate4:!1,pirate5:!1,girl1:!1,girl2:!1,girl3:!1,mabel1:!1,mabel2:!1,mabel3:!1,jack1:!1,jack2:!1,mage1:!1,mage2:!1,mage3:!1,doc1:!1,doc2:!1,doc1mage1:!1},finishPrize:{progress:100,type:"finalPrize",products:[{type:"coins",amount:500,cssClass:"bonusWindowCoins"},{type:"good",amount:24,name:"unlimitedLifes",cssClass:"unlimitedLifes"},{type:"good",amount:6,name:"addThreeMoves",cssClass:"addThreeMoves"},{type:"good",amount:6,name:"starInField",cssClass:"starInField"}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.battlePass=new BattlePass({world:this,catchupWindowRule:function(){return!1},instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives"}]}}),this.addComponent(ReturnWorldComponent),this.regatta=new Regatta({name:this.name,world:this,rotation:45,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:4,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"unlimitedBonusWorldLives"}]},{level:9,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:14,type:"middlePrize",products:[{type:"CoinsProduct",amount:100}]},{level:19,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:24,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteCell"}]},{level:29,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:34,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{level:39,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:44,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"}]},{level:49,type:"middlePrize",products:[{type:"CoinsProduct",amount:200}]},{level:54,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteRow"}]},{level:59,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:64,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"}]},{level:69,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:74,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:79,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"Shuffle"}]},{level:84,type:"middlePrize",products:[{type:"SpinProduct",amount:2}]},{level:89,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:94,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:99,type:"middlePrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:5,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:10,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:15,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"}]},{level:20,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:25,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives"}]},{level:30,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:35,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:40,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"}]},{level:45,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:50,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:55,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"}]},{level:60,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:65,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:70,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:75,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:"unlimitedBonusWorldLives"}]},{level:80,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:85,type:"battlePass",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:"unlimitedBonusWorldLives"}]},{level:90,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:95,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:100,type:"battlePass",products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:7200,goodId:"starInField"}]}]}),this.artifactController=this.addComponent(ArtifactController,{world:this,artifactWorkshopMinLevel:2,container:".regatta-wildwildwest",artifactPartsShop:{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:700,parts:3},{dropType:Artifacts.PartShopByQuantity,id:2,coins:500,parts:2},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1}]},artifactWorkshop:{partSource:new Artifacts.BoxPartDroppper({world:this,chances:{15:55,7:55},rule:function(){return 2<t.getCurrentLevel()}}),config:{showAll:!0,parts:[{id:1,chance:.5,material:"normal"},{id:2,material:"normal",chance:.5},{id:3,material:"normal",chance:.5},{id:4,material:"normal",chance:.5},{id:5,material:"normal",chance:.5},{id:6,material:"normal",chance:.5},{id:7,material:"normal",chance:.5},{id:8,material:"normal",chance:.5},{id:9,material:"normal",chance:.5},{id:10,material:"normal",chance:.5},{id:11,material:"rare",chance:.375},{id:12,material:"rare",chance:.375},{id:13,material:"rare",chance:.375},{id:14,material:"rare",chance:.375},{id:15,material:"rare",chance:.375},{id:16,material:"rare",chance:.375},{id:17,material:"legendary",chance:.125},{id:18,material:"legendary",chance:.125}],artifacts:[{id:1,parts:[1,2,3,4],cooldown:36e3,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",amount:.5}]},{id:2,parts:[3,4,5,11],cooldown:28800,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{id:3,parts:[5,6,4,13],cooldown:21600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1}]},{id:4,parts:[6,7,11,12],cooldown:14400,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"coins",amount:100},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{id:5,parts:[8,7,13,14],cooldown:7200,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives",amount:1}]},{id:6,parts:[8,9,15,17],cooldown:3600,ability:{type:Artifacts.WorldLifeAbility},prize:[{type:"coins",amount:100},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"starInField",amount:1}]},{id:7,parts:[10,16,17,18],cooldown:43200,ability:{type:Artifacts.CoinsAbility,coins:15},prize:[{type:"powerUp",name:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"powerUp",name:"shufflePowerUp",amount:1}]},{id:8,type:"finish",relative:[1,2,3,4,5,6,7],cooldown:10800,ability:{type:Artifacts.LifeAbility},prize:[{type:"coins",amount:200},{type:"good",name:"unlimitedLifes",amount:2},{type:"spins",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1}]}],slots:[{id:1,autoSet:!0,artifacts:[1]},{id:2,autoSet:!0,artifacts:[2]},{id:3,autoSet:!0,artifacts:[3]},{id:4,autoSet:!0,artifacts:[4]},{id:5,autoSet:!0,artifacts:[5]},{id:6,autoSet:!0,artifacts:[6]},{id:7,autoSet:!0,artifacts:[7]},{id:8,autoSet:!0,fixed:!0,artifacts:[8]}]}}}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByQuantity,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:1},{dropType:Artifacts.PartShopByQuantity,id:1,coins:300,parts:1},{dropType:Artifacts.PartShopByQuantity,id:3,coins:800,parts:3}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:1},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,once:"beforeEnter"},{type:StoryTalkElement,owner:this,once:"beforeEnter",talkKey:2},{type:StoryForceElement,owner:this,once:"beforeEnter",el:".regattaStartBtn",name:"wildwildwestForce0"},{type:StoryTalkElement,owner:this,once:"onFinishLevel3",talkKey:3},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",talkKey:4},{type:StoryTalkElement,owner:this,once:"onFinishLevel4",talkKey:5},{type:StoryTalkElement,owner:this,once:"onFinishLevel5",talkKey:6},{type:StoryTalkElement,owner:this,once:"onFinishLevel7",talkKey:7},{type:StoryTalkElement,owner:this,once:"onFinishLevel8",talkKey:8},{type:StoryTalkElement,owner:this,once:"onFinishLevel9",talkKey:9},{type:StoryTalkElement,owner:this,once:"onFinishLevel11",talkKey:10},{type:StoryTalkElement,owner:this,once:"onFinishLevel12",talkKey:11},{type:StoryTalkElement,owner:this,once:"onFinishLevel13",talkKey:12},{type:StoryTalkElement,owner:this,once:"onFinishLevel14",talkKey:13},{type:StoryTalkElement,owner:this,once:"onFinishLevel15",talkKey:14},{type:StoryTalkElement,owner:this,once:"onFinishLevel17",talkKey:15},{type:StoryTalkElement,owner:this,once:"onFinishLevel18",talkKey:16},{type:StoryTalkElement,owner:this,once:"onFinishLevel19",talkKey:17},{type:StoryTalkElement,owner:this,once:"onFinishLevel21",talkKey:18},{type:StoryTalkElement,owner:this,once:"onFinishLevel22",talkKey:19},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",talkKey:20},{type:StoryTalkElement,owner:this,once:"onFinishLevel24",talkKey:21},{type:StoryTalkElement,owner:this,once:"onFinishLevel27",talkKey:22},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",talkKey:23},{type:StoryTalkElement,owner:this,once:"onFinishLevel29",talkKey:24},{type:StoryTalkElement,owner:this,once:"onFinishLevel31",talkKey:25},{type:StoryTalkElement,owner:this,once:"onFinishLevel34",talkKey:26},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place1",talkKey:27},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place2",talkKey:28},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Place3",talkKey:29},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35NotPrize",talkKey:30},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel35Prize",talkKey:31},{type:StoryTalkElement,owner:this,once:"onFinishLevel37",talkKey:32},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",talkKey:33},{type:StoryTalkElement,owner:this,once:"onFinishLevel39",talkKey:34},{type:StoryTalkElement,owner:this,once:"onFinishLevel42",talkKey:35},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",talkKey:36},{type:StoryTalkElement,owner:this,once:"onFinishLevel44",talkKey:37},{type:StoryTalkElement,owner:this,once:"onFinishLevel48",talkKey:38},{type:StoryTalkElement,owner:this,once:"onFinishLevel49",talkKey:39},{type:StoryTalkElement,owner:this,once:"onFinishLevel52",talkKey:40},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55",talkKey:41},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place1",talkKey:42},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place2",talkKey:43},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55Place3",talkKey:44},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel55NotPrize",talkKey:45},{type:StoryTalkElement,owner:this,once:"onFinishLevel58",talkKey:46},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",talkKey:47},{type:StoryTalkElement,owner:this,once:"onFinishLevel59",talkKey:48},{type:StoryTalkElement,owner:this,once:"onFinishLevel63",talkKey:49},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",talkKey:50},{type:StoryTalkElement,owner:this,once:"onFinishLevel64",talkKey:51},{type:StoryTalkElement,owner:this,once:"onFinishLevel68",talkKey:52},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",talkKey:53},{type:StoryTalkElement,owner:this,once:"onFinishLevel69",talkKey:54},{type:StoryTalkElement,owner:this,once:"onFinishLevel73",talkKey:55},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75",talkKey:56},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place1",talkKey:57},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place2",talkKey:58},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75Place3",talkKey:59},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel75NotPrize",talkKey:60},{type:StoryTalkElement,owner:this,once:"onFinishLevel76",talkKey:61},{type:StoryTalkElement,owner:this,once:"onFinishLevel77",talkKey:62},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",talkKey:63},{type:StoryTalkElement,owner:this,once:"onFinishLevel79",talkKey:64},{type:StoryTalkElement,owner:this,once:"onFinishLevel80",talkKey:65},{type:StoryTalkElement,owner:this,once:"onFinishLevel81",talkKey:66},{type:StoryTalkElement,owner:this,once:"onFinishLevel82",talkKey:67},{type:StoryTalkElement,owner:this,once:"onFinishLevel83",talkKey:68},{type:StoryTalkElement,owner:this,once:"onFinishLevel84",talkKey:69},{type:StoryTalkElement,owner:this,once:"onFinishLevel85",talkKey:70},{type:StoryTalkElement,owner:this,once:"onFinishLevel88",talkKey:71},{type:StoryTalkElement,owner:this,once:"onFinishLevel89",talkKey:72},{type:StoryTalkElement,owner:this,once:"onFinishLevel93",talkKey:73},{type:StoryTalkElement,owner:this,once:"onFinishLevel94",talkKey:74},{type:StoryTalkElement,owner:this,once:"onFinishLevel96",talkKey:75},{type:StoryTalkElement,owner:this,once:"onFinishLevel98",talkKey:76},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place1",talkKey:77},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place2",talkKey:78},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100Place3",talkKey:79},{type:StoryTalkElement,owner:this,once:"regattaLineCrossLevel100NotPrize",talkKey:80},{type:StoryTalkElement,owner:this,once:"regattaAfterMoveFromLevel100",talkKey:81},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,once:"regattaAfterMoveFromLevel100",params:{prize:this.get("finishPrize").products}},{type:StoryForceElement,owner:this,once:"onCompleteLevel2",id:201,el:".artifactWorkshopButton.wildwildwest",name:"wildwildwestForce1",delayAfter:0},{type:StoryForceElement,owner:this.artifactController,once:"openWorkshop",page:"artifacts",id:202,el:".artifactWorkshop.wildwildwest .tree .button1",name:"wildwildwestForce2",delay:0,delayAfter:0},{type:StoryForceElement,owner:this.artifactController,once:"openArtifactCollectionWindow",window:Artifacts.ArtifactCollectionWindow,page:"artifacts",el:".bonusworld_wildwildwest .artifact.artifact1",name:"wildwildwestForce3",id:205,delay:450},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass,noCatchUpWindowAfter:!0},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(10<t.getCurrentLevel())&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()))},on:"onAfterFinishLevel",delayAfter:4e3,id:203},{type:BaseStoryWindowElement,window:CatchUpBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(t.getCurrentLevel()<19)&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()))},on:"onAfterFinishLevel",delayAfter:4e3,id:204}]}),this.addComponent(CollectorsAgency,{collectors:[new BoxPartCollector({world:this})]})}}),Uhf,_hf;FrogCell.prototype.swap=(Uhf=FrogCell.prototype.swap,function(e,t){if("wildwildwest"!==episode.get("num"))return Uhf.call(this,e,t);Game.field[this.y][this.x]=e;var i=(Game.field[e.y][e.x]=this).x;this.x=e.x,e.x=i,i=this.y,this.y=e.y,e.y=i;var o=this.getCoords(),a=e.getCoords();e.$div.ourAnimate(a,300,"linear",_.noop),this.$div.ourAnimate(o,300,"linear",function(){t()})}),figureRulesProcess.wildwildwestBonusClasses=function(){FigureRules.add(".episode_wildwildwest .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/wildwildwest/artifactPart.d4b9352e60.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part16 .part",{frame:15}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part17 .part",{frame:16}),FigureRules.add(".episode_wildwildwest .artifactPartCell.part18 .part",{frame:17}),featuresAdder.addFeature("wildwildwest","chocolate_chocolate"),featuresAdder.addFeature("wildwildwest","coinschest_aztecchest"),featuresAdder.addFeature("wildwildwest","alligator_bandit"),featuresAdder.addFeature("wildwildwest","boy_cowboy"),featuresAdder.addFeature("wildwildwest","caviar_armadillo"),featuresAdder.addFeature("wildwildwest","bug_stagecoach"),featuresAdder.addFeature("wildwildwest","frog_cart"),featuresAdder.addFeature("wildwildwest","bar_cactus")},figureRulesProcess.additionalBonusClasses=(_hf=figureRulesProcess.additionalBonusClasses,function(){_hf.call(this),figureRulesProcess.wildwildwestBonusClasses()});var DiceAdventureWorldView=function(e){_inherits(i,BaseWorldView);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"initialize",value:function(e,t){_get(_getPrototypeOf(i.prototype),"initialize",this).call(this,e,t),this.addView(DiceAdventureView,{model:this.model.cmp("diceAdventure")}),this.addView(TicketsView,{el:$(".mainTemplates .tickets").clone(),model:this.model.cmp("diceTickets")},"ui"),this.addView(LeaderBoardButtonView,{el:$(".worldTemplates .btnLeaderBoard").clone(),model:this.model.cmp("leaderBoard")},"ui"),this.addView(WorldInfoButton,{el:$(".mainTemplates .ticketsInfoButton").clone(),model:this.model,world:this.model},"ui"),this.diceButton=this.addView(DiceRollButtonView,{el:$(".worldTemplates .btnLabelAndPrice").clone(),model:this.model.cmp("diceRoller")}),this.diceButton.Enabled=!this.model.cmp("story").hasActivatedStory(),this.model.cmp("story").on("change:hasActivatedStory",this.onChangeStoryActivated,this),this.addView(DiceRollView,{el:$(".worldTemplates .diceRoll").clone(),delay:3e3,model:this.model.cmp("diceRoller")}),this.addView(DiceAdventureInfoView,{el:$(".worldTemplates .diceAdventureInfo").clone(),model:this.model.cmp("ciclePrize")})}},{key:"onChangeStoryActivated",value:function(){console.log("onChangeStoryActivated "+!this.model.cmp("story").hasActivatedStory()),this.diceButton.Enabled=!this.model.cmp("story").hasActivatedStory()}}]),i}(),DiceAdventureWorld=function(e){_inherits(c,BaseWorld);var d=_createSuper(c);function c(e){var i;_classCallCheck(this,c),(i=d.call(this,e)).addComponent(WorldDataComponent),i.addComponent(TicketsComponent,{id:"diceTickets",initialAmount:100}),i.addComponent(PrizeMarksDropper,{id:"prizeMarksDropper",markKey:"diceAdventurePrizePointMark",validatorGame:function(e,t){return(!episode.isBonusWorld()||Config.bonusWorld.get("isFreeEpisode"))&&!episode.isSpecialLevel(application.level.num)&&t.currentLevel()&&i.get("active")&&i.isAvailability()&&i.isAvailabilityEnter()},chance:8,defaultMarkLimit:40}),i.addComponent(PrizeMarksDropper,{id:"prizeMarksDropperForHard",markKey:"diceAdventurePrizePointMark",validatorGame:function(e,t){return(!episode.isBonusWorld()||Config.bonusWorld.get("isFreeEpisode"))&&episode.isSpecialLevel(application.level.num)&&t.currentLevel()&&i.get("active")&&i.isAvailability()&&i.isAvailabilityEnter()},chance:16,defaultMarkLimit:50});var t=new TicketsCollector({world:_assertThisInitialized(i),componentId:"diceTickets",collectionEvent:"removedSecondAttribute_diceAdventurePrizePointMark"});i.addComponent(CollectorsAgency,{validatorGame:function(e,t){return(!episode.isBonusWorld()||Config.bonusWorld.get("isFreeEpisode"))&&t.currentLevel()&&i.get("active")&&i.isAvailability()&&i.isAvailabilityEnter()},collectors:[t]});var o=i.addComponent(DiceRollerComponent,{dices:DiceCreate("2d6"),offer:new Offer({id:"rollDiceAdventure",price:20,paymentAdapter:i.cmp("diceTickets"),products:[{type:"RollStockProduct",world:_assertThisInitialized(i)}]}),specialDices:[[new SpecialDice(2),new SpecialDice(3)],[new SpecialDice(1),new SpecialDice(1)]]});i.addComponent(DiceAdventureParticipantsBehavior,{collector:new BotTicketsCollector(t,"diceTickets"),behaviors:[new DiceRollStrategy({id:"currentUser",roller:i.cmp("diceRoller")}),new BotRollStrategy({id:"group1",firstDice:DiceCreate("2d6"),firstDiceAmount:5,ticketRollOptions:[{diff:-14,dices:DiceCreate("2d6 1d4")},{diff:14,dices:DiceCreate("2d6 1d2")},{diff:42,dices:DiceCreate("2d6")},{diff:66,dices:DiceCreate("1d6 1d1")}],timeout:"8h",timeRollOptions:[{rolls:3,dices:DiceCreate("1d6 1d3")},{rolls:6,dices:DiceCreate("1d5 1d1")},{rolls:9,dices:DiceCreate("1d3 1d1")},{rolls:15,dices:DiceCreate("1d2 1d1")}]}),new BotRollStrategy({id:"group2",firstDice:DiceCreate("2d6 1d3"),firstDiceAmount:5,ticketRollOptions:[{diff:-24,dices:DiceCreate("3d6")},{diff:-12,dices:DiceCreate("1d6 1d4")},{diff:1,dices:DiceCreate()},{diff:1/0,dices:DiceCreate("2d2")}],timeout:"8h",timeRollOptions:[{rolls:3,dices:DiceCreate("2d6 1d3")},{rolls:6,dices:DiceCreate("1d6 1d3 1d1")},{rolls:9,dices:DiceCreate("1d6 1d1")},{rolls:15,dices:DiceCreate("1d4 1d1")}]}),new BotRollStrategy({id:"group3",firstDice:DiceCreate("2d6 1d5"),firstDiceAmount:5,ticketRollOptions:[{diff:1,dices:DiceCreate("1d6 1d3")},{diff:1/0,dices:DiceCreate("2d4")}],timeout:"8h",timeRollOptions:[{rolls:3,dices:DiceCreate("1d6 1d3")},{rolls:6,dices:DiceCreate("1d6 1d1")},{rolls:15,dices:DiceCreate("1d4 1d1")}]}),new BotRollStrategy({id:"group4",firstDice:DiceCreate("2d6 1d4"),firstDiceAmount:5,ticketRollOptions:[{diff:1/0,dices:DiceCreate("1d6")}],timeout:"12h",timeRollOptions:[{rolls:2,rollsFrom:1,dices:DiceCreate("1d3 1d1")},{rolls:4,rollsFrom:1,dices:DiceCreate("1d5 1d1")},{rolls:6,rollsFrom:1,dices:DiceCreate("1d6 1d3")},{rolls:10,rollsFrom:1,dices:DiceCreate("1d6 1d1")}]}),new BotRollStrategy({id:"group5",firstDice:DiceCreate("2d6"),firstDiceAmount:[0,3],timeout:"12h",timeRollOptions:[{rolls:2,rollsFrom:0,dices:DiceCreate("1d3 1d1")},{rolls:4,rollsFrom:0,dices:DiceCreate("1d5 1d1")},{rolls:6,rollsFrom:0,dices:DiceCreate("1d6 1d3")},{rolls:10,rollsFrom:0,dices:DiceCreate("1d6 1d6")}]}),new BotRollStrategy({id:"group6"})]});var a=function(){return{type:"tickets",prize:new Prize({name:"diceTickets",products:[{type:"TicketsProduct",amount:10,world:_assertThisInitialized(i),componentId:"diceTickets"}]})}},n=function(){return{type:"coins",prize:new Prize({name:"diceCoins",products:[{type:"CoinsProduct",amount:30}]})}},r=function(){return{type:"collection",prize:[new Prize({available:function(){return i.cmp("diceAdventure").CurrentUser.Progress===i.cmp("diceAdventure").get("specialPinPrizeProgress")},name:"diceCollection",products:[{type:"ExactArtifactPartProduct",partId:8,world:_assertThisInitialized(i)}]}),new Prize({name:"diceCollection",products:[{type:"RandomArtifactPartProduct",parts:[{type:PartMaterial.TRASH,chance:.43},{type:PartMaterial.NORMAL,chance:.3},{type:PartMaterial.RARE,chance:.18},{type:PartMaterial.LEGEND,chance:.09}],world:_assertThisInitialized(i)}]})]}};i.addComponent(DiceAdventureComponent,{userInfos:i.getBotsLocale(),users:[{id:1,strategy:i.cmp("behaviorStrategy").behavior("currentUser")},{id:2,strategy:i.cmp("behaviorStrategy").behavior("group1")},{id:3,strategy:i.cmp("behaviorStrategy").behavior("group2")},{id:4,strategy:i.cmp("behaviorStrategy").behavior("group3")},{id:5,strategy:i.cmp("behaviorStrategy").behavior("group3")},{id:6,strategy:i.cmp("behaviorStrategy").behavior("group3")},{id:7,strategy:i.cmp("behaviorStrategy").behavior("group4")},{id:8,strategy:i.cmp("behaviorStrategy").behavior("group4")},{id:9,strategy:i.cmp("behaviorStrategy").behavior("group4")},{id:10,strategy:i.cmp("behaviorStrategy").behavior("group4")},{id:11,strategy:i.cmp("behaviorStrategy").behavior("group4")},{id:12,strategy:i.cmp("behaviorStrategy").behavior("group5")},{id:13,strategy:i.cmp("behaviorStrategy").behavior("group5")},{id:14,strategy:i.cmp("behaviorStrategy").behavior("group5")},{id:15,strategy:i.cmp("behaviorStrategy").behavior("group5")},{id:16,strategy:i.cmp("behaviorStrategy").behavior("group5")},{id:17,strategy:i.cmp("behaviorStrategy").behavior("group6")},{id:18,strategy:i.cmp("behaviorStrategy").behavior("group6")},{id:19,strategy:i.cmp("behaviorStrategy").behavior("group6")},{id:20,strategy:i.cmp("behaviorStrategy").behavior("group6")}],items:[{type:"start"},{type:"empty"},r(),{type:"empty"},{type:"empty"},a(),{type:"empty"},r(),{type:"empty"},{type:"empty"},n(),{type:"empty"},{type:"addThreeMoves",prize:new Prize({name:"diceAddThreeMoves",products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"15m"}]})},{type:"empty"},r(),{type:"empty"},a(),{type:"empty"},{type:"empty"},r(),{type:"empty"},n(),{type:"empty"},{type:"empty"},{type:"starInField",prize:new Prize({name:"diceStarInField",products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"15m"}]})},{type:"empty"},r(),{type:"empty"}],specialPinPrizeProgress:7}),i.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.NORMAL},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),i.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("diceAdventureArtifactPartsFree"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.43},{type:PartMaterial.NORMAL,chance:.3},{type:PartMaterial.RARE,chance:.18},{type:PartMaterial.LEGEND,chance:.09}]},{dropType:Artifacts.PartShopByMaterial,id:3,coins:800,amount:3,parts:[{type:PartMaterial.TRASH,chance:.43},{type:PartMaterial.NORMAL,chance:.3},{type:PartMaterial.RARE,chance:.18},{type:PartMaterial.LEGEND,chance:.09}]}]});var s=i.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:i.cmp("parts").ingredients(1,4,5,8),prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]}]},{id:2,ingredients:i.cmp("parts").ingredients(2,6,9,10),prizes:[{products:[{type:"CoinsProduct",amount:30},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]}]},{id:3,ingredients:i.cmp("parts").ingredients(3,7,11,12),prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]}]},{id:4,ingredients:i.cmp("parts").ingredients(13,14,15,16),prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]}]}]});i.addComponent(CiclePrizeComponent,{acounter:new DiceAdventureCirclesAcounter(i.cmp("diceAdventure")),prizes:[{cicle:1,products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]},{cicle:3,products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1}]},{cicle:5,products:[{type:"SpinProduct",amount:1}]},{cicle:7,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"15m"}]},{cicle:10,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"15m"}]},{cicle:12,products:[{type:"CoinsProduct",amount:100}]},{cicle:15,products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]},{cicle:18,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{cicle:20,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{cicle:25,products:[{type:"SpinProduct",amount:2}]},{cicle:30,products:[{type:"CoinsProduct",amount:150},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{cicle:35,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"}]},{cicle:40,products:[{type:"CoinsProduct",amount:200}]},{cicle:45,products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{cicle:50,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]},{cicle:55,products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1}]},{cicle:60,products:[{type:"CoinsProduct",amount:100},{type:"SpinProduct",amount:1}]},{cicle:65,products:[{type:"GroupBoosterProduct",amount:1}]}],endlessPrize:{calcCicle:function(e){return Math.max(5*Math.ceil(e/5),70)},products:[{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]}});var l=i.addComponent(LeaderBoardComponent,{currentUser:i.cmp("diceAdventure").CurrentUser,users:i.cmp("diceAdventure").Users,prizes:[{place:1,products:[{type:"CoinsProduct",amount:500},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.unlimitedLifes,addTime:"1h"}]},{place:2,products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:"30m"}]},{place:3,products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:"30m"}]}],consolationPrize:{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}});return o.once("roll",function(){return l.set("started",!0)}),i.addComponent(TimekeeperComponent,{originDate:i.get("originDate"),duration:i.get("duration"),cooldown:i.get("cooldown")}),i.addComponent(StoryController,{name:i.getName(),actionQueue:i.actionQueue,stories:[{type:StoryCallbackElement,page:"main",on:"start",callback:function(){return i.showEnterForce()}},{type:StoryGroup,on:"start",stories:[{type:StoryTalkElement,talkKey:1,owner:_assertThisInitialized(i),selector:i.getName()+"Talk"},{type:StoryForceElement,owner:_assertThisInitialized(i),page:i.getPageName(),el:".world.diceAdventure .diceRollButton",name:i.get("name")+"Force0",onAfterOpen:function(){i.view.diceButton.Enabled=!0},inWorld:!1}]},{type:StoryGroup,once:"rollActionsEnded",owner:i.getComponent("diceRoller"),isAvailable:function(){return 5===i.cmp("diceAdventure").CurrentUser.Progress&&i.get("firstStart")},stories:[{type:StoryForceElement,owner:_assertThisInitialized(i),page:i.getPageName(),el:".world.diceAdventure .tickets",name:i.get("name")+"Force1",inWorld:!1},{type:StoryForceElement,owner:_assertThisInitialized(i),page:i.getPageName(),el:".world.diceAdventure .diceRollButton",name:i.get("name")+"Force2",onAfterOpen:function(){i.view.diceButton.Enabled=!0},inWorld:!1}]},{type:StoryGroup,once:"rollActionsEnded",owner:i.getComponent("diceRoller"),isAvailable:function(){return 7===i.cmp("diceAdventure").CurrentUser.Progress&&i.get("firstStart")},stories:[{type:StoryForceElement,el:".world.diceAdventure .forgeInButton",name:i.get("name")+"Force3",page:i.getPageName(),inWorld:!1},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe1",name:i.get("name")+"Force4",page:i.getPageName(),inWorld:!1}]},{type:StoryGroup,once:"rollActionsEnded",owner:i.getComponent("diceRoller"),isAvailable:function(){return 7<i.cmp("diceAdventure").CurrentUser.Progress&&i.get("firstStart")},stories:[{type:StoryTalkElement,talkKey:2,owner:_assertThisInitialized(i),selector:i.getName()+"Talk"},{type:StoryForceElement,owner:_assertThisInitialized(i),page:i.getPageName(),el:".world.diceAdventure .btnLeaderBoard",name:i.get("name")+"Force5",inWorld:!1}]},{type:StoryTalkElement,once:"itemCrafted1",owner:s,talkKey:3,selector:i.getName()+"Talk"},{type:StoryTalkElement,once:"itemCrafted2",owner:s,talkKey:4,selector:i.getName()+"Talk"},{type:StoryTalkElement,once:"itemCrafted3",owner:s,talkKey:5,selector:i.getName()+"Talk"},{type:StoryTalkElement,once:"itemCrafted4",owner:s,talkKey:6,selector:i.getName()+"Talk"},{type:StoryTalkElement,owner:i.cmp("leaderBoard"),page:"main",on:"takePlace1",talkKey:7,selector:i.getName()+"Talk"},{type:StoryTalkElement,owner:i.cmp("leaderBoard"),page:"main",on:"takePlace2",talkKey:8,selector:i.getName()+"Talk"},{type:StoryTalkElement,owner:i.cmp("leaderBoard"),page:"main",on:"takePlace3",talkKey:9,selector:i.getName()+"Talk"},{type:StoryTalkElement,owner:i.cmp("leaderBoard"),page:"main",on:"lose",talkKey:10,selector:i.getName()+"Talk"},{type:StoryCallbackElement,on:"failedBuyRollStock",owner:i.getComponent("diceRoller"),callback:function(){new Promise(function(e){new WorldInfo({world:_assertThisInitialized(i),onClose:function(){return e()}})}).then(function(){return delay(500)}).then(function(){return i.exit()}).then(function(){return application.startCurrentLevel({showStatistics:!0,showWithoutResult:!0})})}}]}),i.addComponent(TakePrizeAnimationComponent,{world:_assertThisInitialized(i),page:"main",container:function(){return $("#map")},animationConfig:{TicketsProduct:{target:function(){return $("#bonusworldListButton")},duration:1500}}}),i.addComponent(ActionWorldComponent,{rules:rules.Rule(function(){return!application.getComponent("actionManager").getById("chainSaleWithFreeGift4Item").isCompleted()}),offerId:"saleWorld3",daysAgo:1,minLevel:0}),i}return _createClass(c,[{key:"showEnterForce",value:function(){new BonusWorldForce({world:this,eventFunctionActivator:function(){this.startEvent(user,!0)}})}},{key:"getBotsLocale",value:function(){return DiceAdventureBots[locale]?DiceAdventureBots[locale]:DiceAdventureBots[Config.botsLocaleByDefault]}}]),c}();DiceAdventureWorld.prototype.defaults=_.defaults({name:"diceAdventure",view:DiceAdventureWorldView,minRealLevelToEnter:41,availability:{episode:2,level:1},duration:"5d",cooldown:"14d",active:!1},BaseWorld.prototype.defaults);var ChristmasTreeWorldView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=$(".wrapper"),t=0;t<3;++t)e.removeClass(this.model.get("name")+"_screen"+t);e.addClass(this.model.get("name")+"_screen"+this.model.get("location")),application.once("game_win",this.onCompleteLevel,this),application.once("game_fail",this.onGameFailed,this),this.scrollToCurrent(),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterChangeLocation",this.updateStartBtn,this)},onCompleteLevel:function(){application.on("change:page",this.scrollToCurrent,this)},onGameFailed:function(){application.on("change:page",this.scrollToCurrent,this)},scrollToCurrent:function(){var e=this;setTimeout(function(){e.model.cmp("story").get("stories").any(function(e){return 1===e.get("status")})||episodeView.mapController.scrollTo(".levels .levelNow")},1e3)},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode"))}}),UnlimitedBonusWorldLivesId="unlimitedBonusWorldLives3",ChristmasTreeWorld=BonusWorld.extend({defaults:_.defaults({name:"ChristmasTreeWorld",viewId:ChristmasTreeWorldView,version:20231116,production:!0,levelsInEpisode:60,episode:1,level:16,durationDays:!1,showTimer:!0,alwaysCancelNext:!1,minEpisodeToEnter:1,minLevelToEnter:36,finishWindowInStories:!0,forceId:!0,openDate:null,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,skipLevelPublication:!0,livesInstance:new BonusWorldLives({maxLives:7,lives:7}),prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:14,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:21,prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"middlePrize",level:29,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:38,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:48,prize:[{type:"coins",amount:200},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:60,prize:[{type:"coins",amount:300},{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"starInField",cssClass:"starInField",amount:12}]}],helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives3",amount:2}],unlimitedName:"unlimitedBonusWorldLives3",noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.addComponent(ReturnWorldComponent);var i=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.NORMAL},{id:4,material:PartMaterial.RARE},{id:5,material:PartMaterial.TRASH},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.TRASH},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.TRASH},{id:14,material:PartMaterial.RARE},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(3),i.ingredient(4)],prizes:[{products:[{type:"GoodProduct",goodId:"unlimitedBonusWorldLives3",addTime:1800}]}]},{id:2,ingredients:[i.ingredient(5),i.ingredient(6),i.ingredient(7),i.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[i.ingredient(9),i.ingredient(10),i.ingredient(11),i.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}]},{id:4,ingredients:[i.ingredient(13),i.ingredient(14),i.ingredient(15),i.ingredient(16)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]}]});this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,rule:function(){return 1<t.getCurrentLevel()},minMove:3,chanceStrategyCls:OnRandomMoveChanceStrategy,dropperPartGeneratorCls:MaterialDropperPartGenerator,movesOrder:MovesOrder.straight,materials:{trash:.31,normal:.27,rare:.23,legend:.19},parts:i.getParts()})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:101,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:3},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.ChristmasTreeWorld",persistentClass:"hidden"}],delayAfter:0}]},{type:StoryAnimationElement,owner:this,once:"enter",id:9,scrollTo:"#level1",elements:[]},{type:StoryGroup,id:10,once:"prizeControllerBeforeTakePrize",stories:[{type:StoryForceElement,page:this.getPageName(),el:".ChristmasTreeWorld.rewardChainBtn",name:this.get("name")+"Force2"},{type:StoryForceElement,page:"rewardChain",el:".rewardChain .mPrizeControllerOuterProgressBarWrapper",name:this.get("name")+"Force3",delayAfter:0}],delayAfter:0},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",id:11,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:4,id:12},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",id:13,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite3",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:5,id:14},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize14",id:15,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite3",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite4",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize14",talkKey:6,id:16},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize21",id:17,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite4",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite5",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize21",talkKey:7,id:18},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize29",id:19,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite5",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite6",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize29",talkKey:8,id:20},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize38",id:21,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite6",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite7",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize38",talkKey:9,id:22},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize48",id:23,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite7",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite1",persistentClass:"updated"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize48",talkKey:10,id:24},{type:StoryAnimationElement,owner:this,once:"onFinishLevel60",id:25,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite1",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite8",persistentClass:"visible"}]},{type:StoryTalkElement,once:"onFinishLevel60",talkKey:11,id:26},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,publicationOff:!0},owner:this,once:"onFinishLevel60",id:201},{type:StoryForceElement,owner:this,once:"enter",id:202,el:".bonusWorldUI.ChristmasTreeWorld .startCurrentLevel",name:"christmastree2023Force1"},{type:StoryGroup,id:203,once:"onFinishLevel1",stories:[{type:StoryForceElement,el:".ChristmasTreeWorld .mForgeBtn",name:"christmastree2023Force2"},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:"christmastree2023Force3"}]}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.7}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:2,coins:500,count:2,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.7}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:700,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.7}]}]})},episodeChanged:function(){return!0}}),yjf,zjf;figureRulesProcess.ChristmasTreeWorldBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(yjf=figureRulesProcess.additionalBonusClasses,function(){yjf.call(this),figureRulesProcess.ChristmasTreeWorldBonusClasses(),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/ChristmasTreeWorld/artifactPart.80815352f2.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_ChristmasTreeWorld .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("ChristmasTreeWorld","parrot_gift"),featuresAdder.addFeature("ChristmasTreeWorld","frog_steamtrain"),featuresAdder.addFeature("ChristmasTreeWorld","strongbox_bearsafe"),featuresAdder.addFeature("ChristmasTreeWorld","crabmedusa_snail"),featuresAdder.addFeature("ChristmasTreeWorld","coinchest_newyear"),featuresAdder.addFeature("ChristmasTreeWorld","frozenegg_gingerbread"),featuresAdder.addFeature("ChristmasTreeWorld","attribute_lollipop"),featuresAdder.addFeature("ChristmasTreeWorld","shooter_mailbox")}),figureRulesProcess.additionalBonusScaleImages=(zjf=figureRulesProcess.additionalBonusScaleImages,function(){zjf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/ChristmasTreeWorld/frozenFishBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/ChristmasTreeWorld/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/ChristmasTreeWorld/color_G.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/ChristmasTreeWorld/artifactPart.80815352f2.png":_Figure.scaleKoef})});var ChineseNewYear2024View=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=$(".wrapper"),t=0;t<3;++t)e.removeClass(this.model.get("name")+"_screen"+t);e.addClass(this.model.get("name")+"_screen"+this.model.get("location")),application.once("game_win",this.onCompleteLevel,this),application.once("game_fail",this.onGameFailed,this),this.scrollToCurrent(),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterChangeLocation",this.updateStartBtn,this)},onCompleteLevel:function(){application.on("change:page",this.scrollToCurrent,this)},onGameFailed:function(){application.on("change:page",this.scrollToCurrent,this)},scrollToCurrent:function(){var e=this;setTimeout(function(){e.model.cmp("story").get("stories").any(function(e){return 1===e.get("status")})||episodeView.mapController.scrollTo(".levels .levelNow")},1e3)},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode"))}}),ChineseNewYear2024=BonusWorld.extend({defaults:_.defaults({name:"chinesenewyear2024",viewId:ChineseNewYear2024View,version:20240122,production:!0,levelsInEpisode:60,episode:1,level:16,durationDays:!1,showTimer:!0,alwaysCancelNext:!1,minEpisodeToEnter:1,minLevelToEnter:36,finishWindowInStories:!0,forceId:!0,openDate:null,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,skipLevelPublication:!0,livesInstance:new BonusWorldLives({maxLives:7,lives:7}),prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:14,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:21,prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"middlePrize",level:29,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:38,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:48,prize:[{type:"coins",amount:200},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:60,prize:[{type:"coins",amount:300},{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"starInField",cssClass:"starInField",amount:12}]}],helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives3",amount:2}],unlimitedName:"unlimitedBonusWorldLives3",noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.addComponent(ReturnWorldComponent);var i=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.NORMAL},{id:4,material:PartMaterial.RARE},{id:5,material:PartMaterial.TRASH},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.RARE},{id:9,material:PartMaterial.TRASH},{id:10,material:PartMaterial.NORMAL},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.LEGEND},{id:13,material:PartMaterial.TRASH},{id:14,material:PartMaterial.RARE},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(3),i.ingredient(4)],prizes:[{products:[{type:"GoodProduct",goodId:"unlimitedBonusWorldLives3",addTime:1800}]}]},{id:2,ingredients:[i.ingredient(5),i.ingredient(6),i.ingredient(7),i.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[i.ingredient(9),i.ingredient(10),i.ingredient(11),i.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1}]}]},{id:4,ingredients:[i.ingredient(13),i.ingredient(14),i.ingredient(15),i.ingredient(16)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]}]});this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,rule:function(){return 1<t.getCurrentLevel()},minMove:3,chanceStrategyCls:OnRandomMoveChanceStrategy,dropperPartGeneratorCls:MaterialDropperPartGenerator,movesOrder:MovesOrder.straight,materials:{trash:.31,normal:.27,rare:.23,legend:.19},parts:i.getParts()})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.chinesenewyear2024",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.chinesenewyear2024 .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.chinesenewyear2024 .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.chinesenewyear2024 .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:3},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,text:messages[this.get("name")+"AfterSomeTime"],closeTimeout:2e3},delayAfter:0},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.chinesenewyear2024",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.chinesenewyear2024",persistentClass:"hidden"}],delayAfter:0},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,delayAfter:0,params:{silent:!0}}]},{type:StoryAnimationElement,owner:this,once:"enter",id:2,scrollTo:"#level1",elements:[]},{type:StoryForceElement,owner:this,once:"enter",id:3,el:".bonusWorldUI.chinesenewyear2024 .startCurrentLevel",name:"chinesenewyear2024Force1"},{type:StoryGroup,id:4,once:"onFinishLevel1",stories:[{type:StoryForceElement,el:".chinesenewyear2024 .mForgeBtn",name:"chinesenewyear2024Force2"},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:"chinesenewyear2024Force3"}]},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize3",id:5,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite3",persistentClass:"visible"},{el:".mapAnimationsMiddle .sprite4",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:4,id:6},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",id:7,scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite5",persistentClass:"visible"},{el:".mapAnimationsMiddle .sprite6",persistentClass:"visible"}]},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:5,id:8},{type:StoryTalkElement,once:"beforeTakeLevelPrize14",talkKey:6,id:9},{type:StoryTalkElement,once:"beforeTakeLevelPrize21",talkKey:7,id:10},{type:StoryTalkElement,once:"beforeTakeLevelPrize29",talkKey:8,id:11},{type:StoryTalkElement,once:"beforeTakeLevelPrize38",talkKey:9,id:12},{type:StoryTalkElement,once:"beforeTakeLevelPrize48",talkKey:10,id:13},{type:StoryTalkElement,once:"onFinishLevel60",talkKey:11,id:14},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize,publicationOff:!0},owner:this,once:"onFinishLevel60",id:15}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:2,coins:500,count:2,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:700,count:3,parts:[{type:PartMaterial.TRASH,chance:.51},{type:PartMaterial.NORMAL,chance:.28},{type:PartMaterial.RARE,chance:.14},{type:PartMaterial.LEGEND,chance:.07}]}]})},episodeChanged:function(){return!0}}),Wjf,Xjf;figureRulesProcess.chinesenewyear2024BonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(Wjf=figureRulesProcess.additionalBonusClasses,function(){Wjf.call(this),figureRulesProcess.chinesenewyear2024BonusClasses(),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chinesenewyear2024/artifactPart.2b8be58e3d.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_chinesenewyear2024 .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("chinesenewyear2024","parrot_gift"),featuresAdder.addFeature("chinesenewyear2024","frog_steamtrain"),featuresAdder.addFeature("chinesenewyear2024","strongbox_bearsafe"),featuresAdder.addFeature("chinesenewyear2024","crabmedusa_snail"),featuresAdder.addFeature("chinesenewyear2024","coinchest_newyear"),featuresAdder.addFeature("chinesenewyear2024","frozenegg_gingerbread"),featuresAdder.addFeature("chinesenewyear2024","attribute_fireworks"),featuresAdder.addFeature("chinesenewyear2024","shooter_mailbox"),featuresAdder.addFeature("chinesenewyear2024","floor_winter"),featuresAdder.addFeature("chinesenewyear2024","fishball_mysteryball"),featuresAdder.addFeature("chinesenewyear2024","caviar_jellybear"),featuresAdder.addFeature("chinesenewyear2024","boy_chinese")}),figureRulesProcess.additionalBonusScaleImages=(Xjf=figureRulesProcess.additionalBonusScaleImages,function(){Xjf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/chinesenewyear2024/frozenFishBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/chinesenewyear2024/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/chinesenewyear2024/color_G.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/chinesenewyear2024/artifactPart.2b8be58e3d.png":_Figure.scaleKoef})});var WinterTownView=BonusWorldView.extend({renderFires:function(){var e=$("#map .scrolledBlock"),t=$('<div class="wintertownFireBlock"></div>');e.append(t);for(var i=1;i<=8;i++){var o=$('<div class="wintertownFires fire_'+String(i)+'"></div>');t.append(o)}},onEnter:function(){this.updateClouds(),this.model.on("updateClouds",this.updateClouds,this),BonusWorldView.prototype.onEnter.call(this),this.renderFires()},onExit:function(){this.model.off("updateClouds",this.updateClouds,this),BonusWorldView.prototype.onExit.call(this),$(".wintertownFireBlock").remove()},updateClouds:function(){var i=this.model.getCurrentLevel();$(".episode_wintertown .clouds .cloud").each(function(e,t){+t.getAttribute("data-level")<=i?$(t).css("display","none"):$(t).css("display","block")})}}),WinterTown=BonusWorld.extend({defaults:_.defaults({name:"wintertown",viewId:WinterTownView,version:20240305,production:!0,levelsInEpisode:25,durationDays:3,episode:1,level:16,showTimer:!0,minEpisodeToEnter:1,minLevelToEnter:34,finishWindowInStories:!0,skipLevelPublication:!0,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",playOnlyCurrentLevel:!0,actionQueue:new ActionQueue,prizes:[{type:"middlePrize",level:5,prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1},{type:"good",cssClass:"starInField",name:"starInField",amount:.5}]},{type:"middlePrize",level:10,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:.5}]},{type:"middlePrize",level:20,prize:[{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"finalPrize",level:25,prize:[{type:"coins",amount:300,cssClass:"coins"},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:6},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:3},{type:"good",name:"unlimitedKeys",cssClass:"unlimitedKeys",amount:48}]}]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{collectors:[new EpisodeCollectionArtifactBoxPartCollector({world:this})]}),this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,chance:2,rule:function(){return 2<t.getCurrentLevel()},chances:{15:20,7:55},chanceStrategyCls:OnExactMoveChanceStrategy,dropperPartGeneratorCls:SimpleDropperPartGenerator,movesOrder:"rest",part:new EpisodeCollection.Part({id:1,price:100,chance:100})})]}),this.prepareStoryController(),this.addComponent(ProlongateWorldComponent)},prepareStoryController:function(){this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.wintertown",persistentClass:"visible"}]},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,delayAfter:0,params:{silent:!0}},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.wintertown .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.wintertown .animationSprite2",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.wintertown .animationSprite3",persistentClass:"visible1"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.wintertown .animationSprite4",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.wintertown",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.wintertown",persistentClass:"hidden"}],delayAfter:0}]},{type:StoryForceElement,owner:this,once:"enter",id:2,el:".bonusWorldUI.wintertown .startCurrentLevel",name:"wintertownForce0"},{type:StoryTalkElement,owner:this,id:4,once:"beforeTakeLevelPrize5",talkKey:3},{type:StoryTalkElement,owner:this,id:5,once:"beforeTakeLevelPrize10",talkKey:4},{type:StoryTalkElement,owner:this,id:6,once:"onCompleteLevel15",talkKey:5},{type:StoryTalkElement,owner:this,id:7,once:"beforeTakeLevelPrize20",talkKey:6},{type:StoryTalkElement,owner:this,id:8,once:"onCompleteLevel24",talkKey:7},{type:StoryGroup,id:9,once:"onCompleteLevel25",stories:[{type:StoryTalkElement,owner:this,id:9,once:"onCompleteLevel25",talkKey:8},{type:StoryTalkElement,owner:this,id:10,once:"onCompleteLevel25",talkKey:9}]},{type:BaseStoryWindowElement,id:11,window:BonusWorldLevelPrizeWindow,owner:this,params:{world:this,level:25,prize:this.get("prizes")[3].prize},once:"onCompleteLevel25"},{type:BaseStoryWindowElement,id:12,window:BonusWorldFinishedWindow,owner:this,once:"onCompleteLevel25",params:{},delayAfter:0}]})},configure:function(e){BonusWorld.prototype.configure.call(this,e),this.get("init")||(this.set("init",!0),this.cloudAnimationView=new CloudAnimationView({world:this}))},episodeChanged:function(){return!0}}),qkf,rkf;figureRulesProcess.wintertownBonusClasses=function(){featuresAdder.addFeature("wintertown","episodecollectiondroppable"),featuresAdder.addFeature("wintertown","floor_winter"),featuresAdder.addFeature("wintertown","alligator_yeti"),featuresAdder.addFeature("wintertown","chocolate_icecube")},figureRulesProcess.additionalBonusScaleImages=(qkf=figureRulesProcess.additionalBonusScaleImages,function(){qkf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/wintertown/fish.png":_Figure.scaleKoef,"../../../gems/site/img/features/wintertown/fishBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/wintertown/yetiFish.png":_Figure.scaleKoef,"../../../gems/site/img/features/wintertown/yetiLifes.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(rkf=figureRulesProcess.additionalBonusClasses,function(){rkf.call(this),figureRulesProcess.wintertownBonusClasses()});var EasterRegattaView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.lawn=$('<div class="homeLawnBg active"></div>'),this.$el.append(this.lawn),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model})},onEnter:function(){BonusWorldView.prototype.onEnter.call(this),this.model.on("regattaAfterPrizeWindowShowed100",this.updateBackground,this);var e=$(".invisible .rewardObject").clone();e.addClass("level100").addClass("middlePrize"),e.toggleClass("opened",this.model.get("finished")),new UserPrizesView({el:e.find(".prizes"),model:new UserPrizes(this.model.get("finishPrize").products)}),$(".waterShade").append(e),this.renderAnimations()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterRegattaLineCrossedAtLevel100",this.updateBackground,this)},renderAnimations:function(){var e=$(".regatta-easterregatta .scrollWrapper .map"),t=e.find(".animatedDecors");t.get(0)?t.empty():(t=$('<div class="animatedDecors"></div>'),e.append(t));for(var i=[{selector:"candle",amount:11},{selector:"lightSphere",amount:2},{selector:"lightEnterEgypt",amount:1},{selector:"lightEyesBig",amount:2},{selector:"lightEyesEgypt",amount:1},{selector:"lightManyWindows",amount:1},{selector:"lightTwoWindows",amount:1},{selector:"lightTwoWindowsLow",amount:1},{selector:"lightDoor",amount:1},{selector:"flashlightBlue",amount:2},{selector:"lightEyes1",amount:2},{selector:"lightEyes2",amount:2},{selector:"lightEyes3",amount:2},{selector:"castleLight",amount:1},{selector:"lightEnter1",amount:1},{selector:"lightEnter2",amount:1},{selector:"lightEnter3",amount:2},{selector:"lightEnterLeft",amount:1},{selector:"lightWindowsLeft",amount:1},{selector:"lightWindow1",amount:1},{selector:"lightWindow2",amount:1}],o=0;o<i.length;o++)for(var a=0;a<i[o].amount;a++){var n=$('<div class="animationDecor '.concat(i[o].selector," ").concat(i[o].selector).concat(a+1,'"></div>'));t.append(n)}},updateBackground:function(){this.lawn.toggleClass("active",this.model.getCurrentLevel()>this.model.get("levelsInEpisode"))}}),EasterRegatta=BonusWorld.extend({defaults:_.defaults({name:"easterregatta",viewId:EasterRegattaView,version:20230313,production:!0,levelsInEpisode:100,durationDays:!1,episode:1,level:16,minEpisodeToEnter:2,minLevelToEnter:3,forceId:!0,closeForNew:!1,allowAfterWin:!0,allowPaid:!0,allowProlong:!1,prolongMaxTimes:1,actionQueue:new ActionQueue,finishWindowInStories:!0,withoutInnerWindow:!0,livesInstance:new BonusWorldLives,helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives2",amount:2}],livesConfig:{lifeRestoreTimeWithBattlePass:1800,maxLivesWithBattlePass:8,refillPriceWithBattlePass:300},showTimer:!0,showProgress:!1,sounds:{narrator:!1,pirate1:!1,pirate2:"piratenegative",pirate3:!1,pirate4:"piratepositive",pirate5:"piratenegative",pirate6:"piratepositive",girl1:!1,girl2:"woman",girl3:"piratewomannegative",girl4:!1,grandfather1:"daddypositive",grandfather2:"daddynegative",grandfather3:!1,charon1:!1,charon2:!1,charon3:"kharonangry",charon4:"kharonlaugh",monsters1:"monstersroar",candybeard1:"candybeardpositive",candybeard2:"candybeardnegative",candybeard3:"candybeardpositive"},finishPrize:{progress:100,type:"finalPrize",products:[{type:"coins",amount:500,cssClass:"bonusWindowCoins"},{type:"good",amount:24,name:"unlimitedLifes",cssClass:"unlimitedLifes"},{type:"good",amount:6,name:"addThreeMoves",cssClass:"addThreeMoves"},{type:"good",amount:6,name:"starInField",cssClass:"starInField"}]},unlimitedName:"unlimitedBonusWorldLives2",prizes:[]},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e);var i="unlimitedBonusWorldLives2";this.battlePass=new BattlePass({world:this,hasCatchupWindow:!1,catchupWindowRule:function(){return!1},instantPrize:{name:this.get("name")+"BattlePassInstantPrize",products:[{type:"GoodProduct",addTime:7200,goodId:i},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:13},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:14},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:15},{type:"ExactArtifactPartProduct",world:this.get("name"),partId:16}]}});var o=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.TRASH},{id:2,material:PartMaterial.TRASH},{id:3,material:PartMaterial.TRASH},{id:4,material:PartMaterial.TRASH},{id:5,material:PartMaterial.NORMAL},{id:6,material:PartMaterial.NORMAL},{id:7,material:PartMaterial.NORMAL},{id:8,material:PartMaterial.NORMAL},{id:9,material:PartMaterial.RARE},{id:10,material:PartMaterial.RARE},{id:11,material:PartMaterial.RARE},{id:12,material:PartMaterial.RARE},{id:13,material:PartMaterial.LEGEND},{id:14,material:PartMaterial.LEGEND},{id:15,material:PartMaterial.LEGEND},{id:16,material:PartMaterial.LEGEND}]}),a=this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[o.ingredient(1,2),o.ingredient(2,2),o.ingredient(3,2),o.ingredient(4,2)],prizes:[{products:[{type:"CoinsProduct",amount:30}]}]},{id:2,ingredients:[o.ingredient(5),o.ingredient(6),o.ingredient(7),o.ingredient(8)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:3,ingredients:[o.ingredient(6),o.ingredient(7),o.ingredient(9),o.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"GoodProduct",goodId:i,addTime:1200}]}]},{id:4,ingredients:[o.ingredient(5),o.ingredient(10),o.ingredient(11),o.ingredient(12)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"GoodProduct",goodId:GoodTypes.addThreeMoves,addTime:1800}]}]},{id:5,ingredients:[o.ingredient(8),o.ingredient(9),o.ingredient(12),o.ingredient(13)],prizes:[{products:[{type:"CoinsProduct",amount:80},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1}]}]},{id:6,ingredients:[o.ingredient(9),o.ingredient(11),o.ingredient(14),o.ingredient(15)],prizes:[{products:[{type:"CoinsProduct",amount:50},{type:"SpinProduct",amount:1}]}]},{id:7,ingredients:[o.ingredient(13),o.ingredient(14),o.ingredient(15),o.ingredient(16)],prizes:[{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",goodId:i,addTime:1800}]}]}]});this.addComponent(CollectorsAgency,{collectors:[new ForceInstantPartsCollector({world:this,minLevel:1,maxLevel:1,activationMove:2,perMoveChance:12,forceMaterial:PartMaterial.RARE,forceMoveId:2,materials:{trash:.51,normal:.28,rare:.14,legend:.07},parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:2,activationMove:3,perMoveChance:3,rules:[rules.NoBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:6}],parts:o.getParts()}),new InstantPartsCollector({world:this,minLevel:2,activationMove:3,perMoveChance:6,rules:[rules.HasBattlePass(this)],onReplay:!0,materials:{trash:.51,normal:.28,rare:.14,legend:.07},modifiers:[{levelsFromAbout:!0,perMoveChance:12}],parts:o.getParts()})]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart2"),parts:[{type:PartMaterial.TRASH,chance:.9},{type:PartMaterial.NORMAL,chance:.1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:800,count:3,parts:[{type:PartMaterial.TRASH,chance:.45},{type:PartMaterial.NORMAL,chance:.33},{type:PartMaterial.RARE,chance:.15},{type:PartMaterial.LEGEND,chance:.07}]}]}),this.addComponent(TakePrizeAnimationComponent,{world:this,actionQueue:this.get("actionQueue"),el:function(){return $(".mainTemplates .takePrizeView").clone().appendTo(t.view.$el)},animationConfig:{ExactArtifactPartProduct:{combine:!0,target:function(){return t.view.$el.find(".mForgeBtn")},duration:1500}}}),this.addComponent(ReturnWorldComponent),this.regatta=new Regatta({name:this.name,world:this,stages:[{level:35,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:200},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:100},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:55,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:50},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:75,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]},{level:100,places:[{place:1,prize:{products:[{type:"CoinsProduct",amount:600},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]}},{place:2,prize:{products:[{type:"CoinsProduct",amount:400},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]}},{place:3,prize:{products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]}},{place:"consolation",prize:{products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]}}]}]}),this.rewardChain=new AlternativeRewardChain({viewClass:RewardChainViewLite,world:this,prizes:[{level:3,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:i}]},{level:8,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:13,type:"middlePrize",products:[{type:"CoinsProduct",amount:100}]},{level:18,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:23,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteCell"}]},{level:28,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:33,type:"middlePrize",products:[{type:"SpinProduct",amount:1}]},{level:38,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:43,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:i}]},{level:48,type:"middlePrize",products:[{type:"CoinsProduct",amount:200}]},{level:53,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteRow"}]},{level:58,type:"middlePrize",products:[{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:63,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"}]},{level:68,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:73,type:"middlePrize",products:[{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:78,type:"middlePrize",products:[{type:"BoosterProduct",amount:2,boosterId:"Shuffle"}]},{level:83,type:"middlePrize",products:[{type:"SpinProduct",amount:2}]},{level:88,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:93,type:"middlePrize",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:98,type:"middlePrize",products:[{type:"CoinsProduct",amount:300},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:4,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:1800,goodId:"starInField"}]},{level:9,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:14,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:19,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:24,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:29,type:"battlePass",products:[{type:"CoinsProduct",amount:150},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:34,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:1800,goodId:"addThreeMoves"}]},{level:39,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:44,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"}]},{level:49,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:54,type:"battlePass",products:[{type:"CoinsProduct",amount:100},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:59,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:64,type:"battlePass",products:[{type:"GoodProduct",addTime:3600,goodId:"starInField"},{type:"GoodProduct",addTime:3600,goodId:"addThreeMoves"}]},{level:69,type:"battlePass",products:[{type:"CoinsProduct",amount:200},{type:"BoosterProduct",amount:1,boosterId:"Shuffle"}]},{level:74,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"},{type:"GoodProduct",addTime:7200,goodId:i}]},{level:79,type:"battlePass",products:[{type:"CoinsProduct",amount:250},{type:"BoosterProduct",amount:1,boosterId:"DeleteCell"}]},{level:84,type:"battlePass",products:[{type:"BoosterProduct",amount:2,boosterId:"DeleteColumn"},{type:"GoodProduct",addTime:3600,goodId:i}]},{level:89,type:"battlePass",products:[{type:"CoinsProduct",amount:300},{type:"GoodProduct",addTime:3600,goodId:"starInField"}]},{level:94,type:"battlePass",products:[{type:"BoosterProduct",amount:1,boosterId:"DeleteColumn"},{type:"BoosterProduct",amount:1,boosterId:"DeleteRow"}]},{level:99,type:"battlePass",products:[{type:"CoinsProduct",amount:500},{type:"GoodProduct",addTime:7200,goodId:"addThreeMoves"},{type:"GoodProduct",addTime:7200,goodId:"starInField"}]}]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,once:"beforeEnter",delayAfter:0,id:2},{type:StoryTalkElement,once:"enter",talkKey:1,id:3},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")},once:"enter",delayAfter:2e3,id:4},{type:StoryTalkElement,delay:500,once:"enter",talkKey:2,id:5},{type:StoryForceElement,owner:this,once:"enter",id:200,el:".regatta-easterregatta .startCurrentLevel",name:this.get("name")+"FirstLevelForce"},{type:StoryTalkElement,once:"regattaAfterMoveFromLevel1",talkKey:3,id:7},{type:StoryForceElement,on:"regattaAfterMoveFromLevel1",page:"main",delay:200,id:202,el:".easterregatta .mForgeBtn",name:this.get("name")+"ForgeForce"},{type:StoryForceElement,on:"regattaAfterMoveFromLevel1",window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:this.get("name")+"CollectionForce",id:203},{type:StoryTalkElement,once:"itemCrafted1",owner:a,talkKey:4,id:8},{type:StoryTalkElement,once:"itemCrafted2",owner:a,talkKey:5,id:9},{type:StoryTalkElement,once:"itemCrafted3",owner:a,talkKey:6,id:10},{type:StoryTalkElement,once:"itemCrafted4",owner:a,talkKey:7,id:11},{type:StoryTalkElement,once:"itemCrafted5",owner:a,talkKey:8,id:12},{type:StoryTalkElement,once:"itemCrafted6",owner:a,talkKey:9,id:13},{type:StoryTalkElement,once:"itemCrafted7",owner:a,talkKey:10,id:14},{type:StoryTalkElement,on:"onFinishLevel3",talkKey:11,id:15},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel4",talkKey:12,id:16},{type:StoryTalkElement,on:"onFinishLevel8",talkKey:13,id:17},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel9",talkKey:14,id:18},{type:StoryTalkElement,on:"onFinishLevel13",talkKey:15,id:19},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel15",talkKey:16,id:20},{type:StoryTalkElement,on:"onFinishLevel23",talkKey:17,id:21},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel24",talkKey:18,id:22},{type:StoryTalkElement,on:"onFinishLevel28",talkKey:19,id:23},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place1",talkKey:20,id:24},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place2",talkKey:21,id:25},{type:StoryTalkElement,once:"regattaLineCrossLevel35Place3",talkKey:22,id:26},{type:StoryTalkElement,once:"regattaLineCrossLevel35Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:23,id:27},{type:StoryTalkElement,on:"onFinishLevel43",talkKey:24,id:28},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel44",talkKey:25,id:29},{type:StoryTalkElement,on:"onFinishLevel48",talkKey:26,id:30},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel49",talkKey:27,id:31},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place1",talkKey:28,id:32},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place2",talkKey:29,id:33},{type:StoryTalkElement,once:"regattaLineCrossLevel55Place3",talkKey:30,id:34},{type:StoryTalkElement,once:"regattaLineCrossLevel55Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:31,id:35},{type:StoryTalkElement,on:"onFinishLevel63",talkKey:32,id:36},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel64",talkKey:33,id:37},{type:StoryTalkElement,on:"onFinishLevel68",talkKey:34,id:38},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel69",talkKey:35,id:39},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place1",talkKey:36,id:40},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place2",talkKey:37,id:41},{type:StoryTalkElement,once:"regattaLineCrossLevel75Place3",talkKey:38,id:42},{type:StoryTalkElement,once:"regattaLineCrossLevel75Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:39,id:43},{type:StoryTalkElement,on:"onFinishLevel83",talkKey:40,id:45},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel84",talkKey:41,id:46},{type:StoryTalkElement,on:"onFinishLevel88",talkKey:42,id:47},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel89",talkKey:43,id:48},{type:StoryTalkElement,on:"onFinishLevel93",talkKey:44,id:49},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel94",talkKey:45,id:50},{type:StoryTalkElement,on:"onFinishLevel98",talkKey:46,id:51},{type:StoryTalkElement,on:"regattaAfterMoveFromLevel99",talkKey:47,id:52},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place1",talkKey:48,id:53},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place2",talkKey:49,id:54},{type:StoryTalkElement,once:"regattaLineCrossLevel100Place3",talkKey:50,id:55},{type:StoryTalkElement,once:"regattaLineCrossLevel100Prize",isAvailable:function(e){return 3<e.player.get("place")},talkKey:51,id:56},{type:StoryTalkElement,once:"regattaAfterPrizeWindowShowed100",talkKey:52,id:58},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,owner:this,params:{prize:this.get("finishPrize").products},delayAfter:0,once:"regattaAfterPrizeWindowShowed100",id:59},{type:BaseStoryWindowElement,window:BuyBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(10<t.getCurrentLevel()-1)&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()-1))},on:"regattaAfterMove",delayAfter:4e3,id:204},{type:BaseStoryWindowElement,window:CatchUpBattlePassWindow,params:{model:this.battlePass},owner:this,isAvailable:function(){return!t.get("hasBattlePass")&&(!(t.getCurrentLevel()-1<=10)&&-1!==t.rewardChain.getPrizes().filter(function(e){return"battlePass"===e.get("type")}).map(function(e){return e.get("level")}).indexOf(t.getCurrentLevel()-1))},on:"regattaAfterMove",delayAfter:4e3,id:205}]})}}),clf,hlf,ilf,jlf;GravityGroundCell.prototype.animateTakeLife=(clf=GravityGroundCell.prototype.animateTakeLife,function(t){if("easterregatta"!==episode.get("num"))return clf.call(this,t);var i=this;if(this.life+1===3){var e=GameBaseView.createFallDownExplodePiece("cork");e.alignTo(this.$div),gameView.fallDownExplodePiece(e)}this.$div.queue(function(e){this.removeClass("gravityGroundLife"+(i.life+1)),this.addClass("gravityGroundLife"+i.life),t(),e()})}),PastureCell.prototype.playRemovalSound=(hlf=PastureCell.prototype.playRemovalSound,function(){if("easterregatta"!==episode.get("num"))return hlf.call(this)}),figureRulesProcess.easterregattaBonusClasses=function(){FigureRules.add(".episode_easterregatta .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterregatta/artifactPart.b2a1cd3402.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_easterregatta .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_easterregatta .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_easterregatta .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_easterregatta .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_easterregatta .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_easterregatta .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_easterregatta .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_easterregatta .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_easterregatta .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_easterregatta .artifactPartCell.part10 .part",{frame:9}),FigureRules.add(".episode_easterregatta .artifactPartCell.part11 .part",{frame:10}),FigureRules.add(".episode_easterregatta .artifactPartCell.part12 .part",{frame:11}),FigureRules.add(".episode_easterregatta .artifactPartCell.part13 .part",{frame:12}),FigureRules.add(".episode_easterregatta .artifactPartCell.part14 .part",{frame:13}),FigureRules.add(".episode_easterregatta .artifactPartCell.part15 .part",{frame:14}),FigureRules.add(".episode_easterregatta .artifactPartCell.part16 .part",{frame:15}),featuresAdder.addFeature("easterregatta","attribute_teacup"),featuresAdder.addFeature("easterregatta","fishball_bird"),featuresAdder.addFeature("easterregatta","floor_autumngrass"),featuresAdder.addFeature("easterregatta","frozenegg_eggs"),featuresAdder.addFeature("easterregatta","iceberg_eggs"),featuresAdder.addFeature("easterregatta","dropcell_eggsbasket"),featuresAdder.addFeature("easterregatta","crabmouse_rabbit"),featuresAdder.addFeature("easterregatta","coinchest_carrotchest"),featuresAdder.addFeature("easterregatta","greedypirate_carrot"),featuresAdder.addFeature("easterregatta","well_paint"),featuresAdder.addFeature("easterregatta","caviar_chick"),featuresAdder.addFeature("easterregatta","flamy_egg")},figureRulesProcess.additionalBonusScaleImages=(ilf=figureRulesProcess.additionalBonusScaleImages,function(){ilf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/artifactPlatform.9da3162586.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/bird_large.ca4c3b6830.png":Config.cellWidth/160,"//gems-ok.akamaized.net/gems/gems/site/img/features/royalregatta/strongbox_xlarge.117e5ca401.png":_Figure.scaleKoef})}),figureRulesProcess.additionalBonusClasses=(jlf=figureRulesProcess.additionalBonusClasses,function(){jlf.call(this),figureRulesProcess.easterregattaBonusClasses()});var EasterBanquetView=BonusWorldView.extend({initialize:function(){BonusWorldView.prototype.initialize.call(this),this.$randomBtn=this.$(".mRunRandomLevelBtn"),this.rulesBtn=new WorldInfoButton({el:$(".mainTemplates .ticketsInfoButton").clone().appendTo(this.$ui),model:this.model}),this.animationActionQueue=this.model.get("actionQueue")},onEnter:function(){BonusWorldView.prototype.onEnter.call(this);for(var e=$(".wrapper"),t=0;t<3;++t)e.removeClass(this.model.get("name")+"_screen"+t);e.addClass(this.model.get("name")+"_screen"+this.model.get("location")),application.once("game_win",this.onCompleteLevel,this),application.once("game_fail",this.onGameFailed,this),this.scrollToCurrent(),this.model.on("afterChangeLocation",this.updateStartBtn,this),this.updateStartBtn()},onExit:function(){BonusWorldView.prototype.onExit.call(this),this.model.off("afterChangeLocation",this.updateStartBtn,this)},onCompleteLevel:function(){application.on("change:page",this.scrollToCurrent,this)},onGameFailed:function(){application.on("change:page",this.scrollToCurrent,this)},scrollToCurrent:function(){var e=this;setTimeout(function(){e.model.cmp("story").get("stories").any(function(e){return 1===e.get("status")})||episodeView.mapController.scrollTo(".levels .levelNow")},1e3)},updateStartBtn:function(){var e=this.$ui.find(".mStartBtn"),t=this.model.get("progress"),i=this.model.getCurrentLevel();e.find(".mLevel").html(t),e.toggleClass("active",i<=this.model.get("levelsInEpisode"))}}),EasterBanquet=BonusWorld.extend({defaults:_.defaults({name:"easterbanquet",viewId:EasterBanquetView,version:20240415,production:!0,levelsInEpisode:60,episode:2,level:4,durationDays:!1,showTimer:!0,alwaysCancelNext:!1,minEpisodeToEnter:2,minLevelToEnter:16,finishWindowInStories:!0,forceId:!0,openDate:null,allowAfterWin:!0,allowPaid:!0,allowProlong:!0,prolongMaxTimes:1,prolongDuration:172800,prolongAvailableDuration:86400,extensionOfBonusWorldTimeOfferId:"extensionOfBonusWorldTime1",actionQueue:new ActionQueue,withoutInnerWindow:!0,skipLevelPublication:!0,livesInstance:new BonusWorldLives({maxLives:7,lives:7}),prizes:[{type:"middlePrize",level:3,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:8,prize:[{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"powerUp",name:"lightingPowerUp",amount:1}]},{type:"middlePrize",level:14,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:21,prize:[{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1}]},{type:"middlePrize",level:29,prize:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:.5},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{type:"middlePrize",level:38,prize:[{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:.5},{type:"good",name:"unlimitedBonusWorldLives3",cssClass:"unlimitedBonusWorldLives3",amount:.5}]},{type:"middlePrize",level:48,prize:[{type:"coins",amount:200},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"starInField",cssClass:"starInField",amount:1}]},{type:"finalPrize",level:60,prize:[{type:"coins",amount:300},{type:"powerUp",name:"shufflePowerUp",amount:1},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:24},{type:"good",name:"starInField",cssClass:"starInField",amount:12}]}],helpWindowPrize:[{type:"good",name:"unlimitedBonusWorldLives3",amount:2}],unlimitedName:"unlimitedBonusWorldLives3",noArtifactPartOnReplay:!1,finishPrize:{progress:30,type:"middlePrize",products:[{type:"CoinsProduct",amount:1e3},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.Shuffle,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:43200,goodId:"unlimitedLifes"},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.starInField},{type:"GoodProduct",addTime:21600,goodId:GoodTypes.addThreeMoves},{type:"GoodProduct",addTime:172800,goodId:GoodTypes.unlimitedKeys}]}},BonusWorld.prototype.defaults),initialize:function(e){var t=this;BonusWorld.prototype.initialize.call(this,e),this.addComponent(CollectorsAgency,{canCollectorsCogentWindow:!1,collectors:[new BoxPartCollector({world:this})]}),this.addComponent(ReturnWorldComponent);var i=this.addComponent(PartsComponent,{parts:[{id:1,material:PartMaterial.NORMAL},{id:2,material:PartMaterial.NORMAL},{id:3,material:PartMaterial.RARE},{id:4,material:PartMaterial.RARE},{id:5,material:PartMaterial.RARE},{id:6,material:PartMaterial.RARE},{id:7,material:PartMaterial.LEGEND},{id:8,material:PartMaterial.LEGEND},{id:9,material:PartMaterial.LEGEND},{id:10,material:PartMaterial.LEGEND}]});this.addComponent(ForgeComponent,{showPrizeWindow:!0,recipes:[{id:1,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(3),i.ingredient(6)],prizes:[{products:[{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1800}]}]},{id:2,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(4),i.ingredient(8)],prizes:[{products:[{type:"CoinsProduct",amount:40},{type:"powerUp",name:"shufflePowerUp",amount:1}]}]},{id:3,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(5),i.ingredient(9)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteRow,amount:1},{type:"GoodProduct",addTime:1800,goodId:GoodTypes.addThreeMoves}]}]},{id:4,ingredients:[i.ingredient(1),i.ingredient(2),i.ingredient(7),i.ingredient(10)],prizes:[{products:[{type:"BoosterProduct",boosterId:BoosterTypes.DeleteCell,amount:1},{type:"BoosterProduct",boosterId:BoosterTypes.DeleteColumn,amount:1},{type:"GoodProduct",goodId:GoodTypes.starInField,addTime:1200}]}]}]});this.addComponent(DroppersAgency,{droppers:[new BoxDropper({world:this,rule:function(){return 1<t.getCurrentLevel()},minMove:3,chanceStrategyCls:OnRandomMoveChanceStrategy,dropperPartGeneratorCls:MaterialDropperPartGenerator,movesOrder:MovesOrder.straight,materials:{normal:.48,rare:.34,legend:.18},parts:i.getParts()})]}),this.addComponent(StoryController,{world:this,name:this.name,actionQueue:this.get("actionQueue"),stories:[{type:StoryGroup,id:1,once:"beforeEnter",stories:[{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.easterbanquet",persistentClass:"visible"}]},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterbanquet .animationSprite1",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:1},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterbanquet .animationSprite2",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:2},{type:StoryAnimationElement,owner:this.questController,delayAfter:2e3,elements:[{el:".bonusWorldAnimations.easterbanquet .animationSprite3",persistentClass:"visible1"}]},{type:StoryTalkElement,owner:this,talkKey:3},{type:BaseStoryWindowElement,window:BonusWorldHandyWindow,owner:this,params:{world:this,text:messages[this.get("name")+"AfterSomeTime"],closeTimeout:2e3},delayAfter:0},{type:StoryAnimationElement,owner:this,delayAfter:1e3,elements:[{el:".bonusWorldAnimations.easterbanquet",persistentClass:"disappear"}]},{type:StoryAnimationElement,owner:this,elements:[{el:".bonusWorldAnimations.easterbanquet",persistentClass:"hidden"}],delayAfter:0},{type:BaseStoryWindowElement,window:NewEpisodeWindow,owner:this,delayAfter:0,params:{silent:!0}}]},{type:StoryAnimationElement,owner:this,once:"enter",id:2,scrollTo:"#level1",elements:[]},{type:StoryForceElement,owner:this,once:"enter",id:3,el:".bonusWorldUI.easterbanquet .startCurrentLevel",name:"easteradventureForce1"},{type:StoryGroup,once:"onFinishLevel1",stories:[{type:StoryForceElement,el:".easterbanquet .mForgeBtn",name:"christmastree2023Force2"},{type:StoryForceElement,window:ForgeWindow,el:"#forgeWindow .mRecipes .recipe2",name:"christmastree2023Force3"}],id:4},{type:StoryTalkElement,once:"beforeTakeLevelPrize3",talkKey:4,id:5},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize8",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"visible"}],id:6},{type:StoryTalkElement,once:"beforeTakeLevelPrize8",talkKey:5,id:7},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize14",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite2",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite3",persistentClass:"visible"}],id:8},{type:StoryTalkElement,once:"beforeTakeLevelPrize14",talkKey:6,id:9},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize21",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite3",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite4",persistentClass:"visible"}],id:10},{type:StoryTalkElement,once:"beforeTakeLevelPrize21",talkKey:7,id:11},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize29",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite4",persistentClass:"hidden"}],id:12},{type:StoryTalkElement,once:"beforeTakeLevelPrize29",talkKey:8,id:13},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize38",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite5",persistentClass:"visible"}],id:14},{type:StoryTalkElement,once:"beforeTakeLevelPrize38",talkKey:9,id:15},{type:StoryAnimationElement,owner:this,once:"beforeTakeLevelPrize48",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite5",persistentClass:"hidden"},{el:".mapAnimationsMiddle .sprite6",persistentClass:"visible"}],id:16},{type:StoryTalkElement,once:"beforeTakeLevelPrize48",talkKey:10,id:17},{type:StoryAnimationElement,owner:this,once:"onFinishLevel60",scrollTo:"#level1",elements:[{el:".mapAnimationsMiddle .sprite1",persistentClass:"worldFinished"},{el:".mapAnimationsMiddle .sprite2",persistentClass:"worldFinished"},{el:".mapAnimationsMiddle .sprite3",persistentClass:"worldFinished"},{el:".mapAnimationsMiddle .sprite4",persistentClass:"worldFinished"},{el:".mapAnimationsMiddle .sprite5",persistentClass:"worldFinished"},{el:".mapAnimationsMiddle .sprite6",persistentClass:"worldFinished"}],id:18},{type:StoryTalkElement,once:"onFinishLevel60",talkKey:11,id:19},{type:BaseStoryWindowElement,window:BonusWorldFinishedWindow,params:{prize:_.find(this.get("prizes"),{type:"finalPrize"}).prize},owner:this,once:"onFinishLevel60",id:20}]}),this.addComponent(PartShopComponent,{items:[{dropType:Artifacts.PartShopByMaterial,id:4,rewardAd:Config.adsRewards.get("rewardAdArtifactPart"),parts:[{type:PartMaterial.NORMAL,chance:1}]},{dropType:Artifacts.PartShopByMaterial,id:1,coins:300,parts:[{type:PartMaterial.NORMAL,chance:.48},{type:PartMaterial.RARE,chance:.34},{type:PartMaterial.LEGEND,chance:.18}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:2,coins:500,count:2,parts:[{type:PartMaterial.NORMAL,chance:.48},{type:PartMaterial.RARE,chance:.34},{type:PartMaterial.LEGEND,chance:.18}]},{dropType:Artifacts.MultiplePartShopByMaterial,id:3,coins:700,count:3,parts:[{type:PartMaterial.NORMAL,chance:.48},{type:PartMaterial.RARE,chance:.34},{type:PartMaterial.LEGEND,chance:.18}]}]})},episodeChanged:function(){return!0}}),Glf,Hlf;figureRulesProcess.easterbanquetBonusClasses=function(){},figureRulesProcess.additionalBonusClasses=(Glf=figureRulesProcess.additionalBonusClasses,function(){Glf.call(this),figureRulesProcess.easterbanquetBonusClasses(),FigureRules.add(".episode_easterbanquet .artifactPartCell .part",{width:Config.cellWidth,height:Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/easterbanquet/artifactPart.f7003d8026.png","margin-left":0,"margin-top":0}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part1 .part",{frame:0}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part2 .part",{frame:1}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part3 .part",{frame:2}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part4 .part",{frame:3}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part5 .part",{frame:4}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part6 .part",{frame:5}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part7 .part",{frame:6}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part8 .part",{frame:7}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part9 .part",{frame:8}),FigureRules.add(".episode_easterbanquet .artifactPartCell.part10 .part",{frame:9}),featuresAdder.addFeature("easterbanquet","floor_foliage"),featuresAdder.addFeature("easterbanquet","frozenegg_eggs"),featuresAdder.addFeature("easterbanquet","ground_sweetdish"),featuresAdder.addFeature("easterbanquet","attribute_teacup"),featuresAdder.addFeature("easterbanquet","dropcell_eggsbasket"),featuresAdder.addFeature("easterbanquet","iceberg_eggs"),featuresAdder.addFeature("easterbanquet","caviar_chick"),featuresAdder.addFeature("easterbanquet","strongbox_withgems"),FigureRules.add(".episode_easterbanquet .bugCell .mTask1 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/attribute_teacup/cupTask.e4a945df31.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight}),FigureRules.add(".episode_easterbanquet .bugCell .mTask2 .taskIco",{width:75/180*Config.cellWidth,height:75/180*Config.cellHeight,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/frozenegg_eggs/eggsTask.0cb67c6534.png","margin-left":-5/60*Config.cellWidth,"margin-top":-2/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(Hlf=figureRulesProcess.additionalBonusScaleImages,function(){Hlf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"../../../gems/site/img/features/easterbanquet/frozenFishBg.png":_Figure.scaleKoef,"../../../gems/site/img/features/easterbanquet/chocolateAppear.png":_Figure.scaleKoef,"../../../gems/site/img/features/easterbanquet/color_G.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/easterbanquet/artifactPart.f7003d8026.png":_Figure.scaleKoef})}),Config.bonusWorlds.push(new FirstBonusworld2),Config.bonusWorlds.push(new OpenSeaWorld);var WorldsConfig=function(){return[new DiceAdventureWorld({originDate:new Date("2023-10-31T00:00:00.002Z")}),new RoyalTreasury({originDate:new Date("2024-02-27T00:00:00.002Z")})]};Config.bonusWorlds.push(new EasterBanquet),Config.bonusWorlds.push(new SummerFishing),Config.bonusWorlds.push(new PushkinBirthDayWorld);var BanController=Backbone.Model.extend({resetBan:function(){var e=this;callService("../../../levelbase/src/services/resetban.php",function(){e.clearCounters(),document.location.reload()})},clearCounters:function(){var e=new Date(1e3*application.getCurrentServerTime()),t="income_"+e.getUTCFullYear()+(e.getUTCMonth()+1),i="outcome_"+e.getUTCFullYear()+(e.getUTCMonth()+1);setLocalStorage(t,0),setLocalStorage(i,0)},isActiveBan:function(){if(-1==["odnoklassniki","vkontakte","test"].indexOf(network))return!1;if(!user.get("ban"))return!1;return user.powerUps.each(function(e){e.get("amount")}),3e5<Number(user.get("coins"))}});Application.on("ready",function(){var e=new BanController;e.isActiveBan()&&new BanWindow({banController:e})});var BanWindow=TWindow.extend({templateClass:".banWindow_template",events:{"click .close":"resetBan","click .resetBan":"resetBan"},resetBan:function(){this.options&&this.options.banController&&(this.options.banController.resetBan(),this.close())}});Config&&Config.shopProducts&&_.each(Config.shopProducts,function(e){_.each(e,function(e){if("coins"!==e.type)return!1;if(!_.isNumber(e.price))return!1;var t=new ObscureNumber(e.price);e.price=function(){return t.get()}})});var SpecialLevelWindow=TWindow.extend({templateClass:".specialLevelWindow_template",events:{"click .close":"close","click .playBtn":"play","click .powerup":"shop"},play:function(){this.onClose=function(){gameView.start(this.options.level,{startSpecialLevel:!0})},this.close()},shop:function(){var e=this.options.level;this.onClose=function(){new ShopWindow({page:3,firstPriority:!0}).onClose=function(){new SpecialLevelWindow({level:e})}},this.close()},onOpen:function(){TWindow.prototype.onOpen.call(this),user.powerUps&&user.powerUps.models&&_.each(user.powerUps.models,function(e){this.$el.find("."+e.id+" .amount").html(e.get("amount"))},this)}}),LoseProgressWarningWindow=OutOfMovesWindow.extend({templateClass:".loseProgressWarningWindow_template",events:{"click .continueBt":"buy","click .exitBt":"cancel","click .close":"cancel"},render:function(){this.$el.addClass(this.model.get("name"));var e=messages[this.model.get("name")];this.$(".windowTitle").html(e.eventTitle),this.$(".cancel").html(e.cancel),this.$(".message").html(e.loseProgress);var t=this.model.get("lastStage");this.renderPirate(t),this.renderReward(t),this.$(".outOfMovesMoves").html(Config.outOfMoves.moves),Config.outOfMoves.product?(this.$(".outOfMovesPrice").html(Number(prices[Config.outOfMoves.product].desc.price)),this.$(".inlineCoinBuy").remove(),this.listenToOnce(user,"buyAddMoves",this.onBuyMovesByMoney)):this.$(".outOfMovesPrice").html(Config.outOfMoves.price+Config.outOfMoves.upPrice*Game.get("buyedMoves"))},renderPirate:function(e){var t=$('<div class="pirate'+e+'"></div>');this.$(".content").append(t)},renderReward:function(e){var t=$('<div class="chest'+e+'"></div>');this.$(".content").append(t);var i=$('<div class="reward'+e+'"></div>');this.$(".content").append(i)},onOpen:function(){this.render(),TWindow.prototype.onOpen.call(this)},cancel:function(){Game.exit(),TWindow.prototype.close.call(this)}}),omf,pmf,qmf,rmf,smf,tmf,umf,wmf,xmf,ymf,zmf;BonusLevelDoneWindow.prototype.togglePublicCheckbox=(omf=BonusLevelDoneWindow.prototype.togglePublicCheckbox,function(){omf.call(this),this.rememberCheckboxState()}),BonusLevelDoneWindow.prototype.onOpen=(pmf=BonusLevelDoneWindow.prototype.onOpen,function(){pmf.call(this),this.applyCheckboxState()}),BonusWorldFinishedWindow.prototype.togglePublicCheckbox=(qmf=BonusWorldFinishedWindow.prototype.togglePublicCheckbox,function(){qmf.call(this),this.rememberCheckboxState()}),BonusWorldFinishedWindow.prototype.onOpen=(rmf=BonusWorldFinishedWindow.prototype.onOpen,function(){rmf.call(this),this.applyCheckboxState()}),StatisticAfterWindow.prototype.togglePublicCheckbox=(smf=StatisticAfterWindow.prototype.togglePublicCheckbox,function(){smf.call(this),this.rememberCheckboxState()}),StatisticAfterWindow.prototype.onOpen=(tmf=StatisticAfterWindow.prototype.onOpen,function(){tmf.call(this),this.applyCheckboxState(),user.timeReward&&user.timeReward.run()}),StatisticAfterWindow.prototype.onClose=(umf=StatisticAfterWindow.prototype.onClose,function(){var e=user.timeReward&&user.timeReward.isCompleted()&&!user.timeReward.isRewarded();e&&(this.backToMain=function(){application.once("main",function(){e&&setTimeout(function(){new TimeRewardWindow},100)}),application.set("page","main")}),umf.call(this)}),PrizeDoneWindow.prototype.togglePublicCheckbox=(wmf=PrizeDoneWindow.prototype.togglePublicCheckbox,function(){wmf.call(this),this.rememberCheckboxState()}),PrizeDoneWindow.prototype.onOpen=(xmf=PrizeDoneWindow.prototype.onOpen,function(){xmf.call(this),this.applyCheckboxState()}),PrizeDoneOneOfManyWindow.prototype.togglePublicCheckbox=(ymf=PrizeDoneOneOfManyWindow.prototype.togglePublicCheckbox,function(){ymf.call(this),this.rememberCheckboxState()}),PrizeDoneOneOfManyWindow.prototype.onOpen=(zmf=PrizeDoneOneOfManyWindow.prototype.onOpen,function(){zmf.call(this),this.applyCheckboxState(),0<this.$(".playerPowerupsBlock").length&&(this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}))}),PrizeDoneOneOfManyWindow.prototype.close=function(){window.mobile&&!this.prizeGetted||TWindow.prototype.close.call(this)};var GiftWindow=TWindow.extend({templateClass:!1,events:{"click .take":"takePrize","click .close":"close","click .needPublicCheckbox":"togglePublicCheckbox"},prize:[],name:"defaultgiftwindow",version:"00000000",onOpen:function(){TWindow.prototype.onOpen.call(this),this.applyCheckboxState()},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox(),this.rememberCheckboxState()},takePrize:function(){if(!user.get(this.name)){var t=user.get("coins");_.each(this.prize,_.bind(function(e){"powerUp"==e.type&&user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0),"coins"==e.type&&(t=new ObscureNumber(t.get()+e.amount)),"gift"==e.type&&void 0!==Gifts&&Gifts.receiveGift(Gifts.findGiftById(e.giftId))},this)),user.set({coins:t,powerUps:user.calcPowerUps()}),user.set(this.name,!0),callService("../../../gems/site/service/giftswindows.php",_.noop,_.noop,{name:this.name,version:this.version,userId:user.get("userId")})}this.needPublic&&user.defaultPublication(this.name+"Publication"),this.close()}}),PiratesBirthdayGiftWindow=GiftWindow.extend({templateClass:".piratesBirthdayGiftWindow_template",name:"piratesbirthdaygift",version:"20170919",prize:[{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:2},{type:"gift",giftId:"gift_sticker5",cssClass:"gift_sticker5",amount:1}]});Application.on("ready",function(){user.get("piratesbirthdaygift")||network&&-1!=_.indexOf(["test","mailru","vkontakte","odnoklassniki"],network)&&Date.now()<Date.parse("19 September 2017 00:00:00")&&new PiratesBirthdayGiftWindow});var BonusWorldSelectWindow=TWindow.extend({templateClass:".bonusWorldSelectWindow_template",events:{"click .start":"start","click .close":"close"},start:function(e){if(Config.bonusWorld){var t=$(e.currentTarget).attr("data-name")||!1;if(t){var i=_.find(Config.bonusWorlds,function(e){return e.get("name")===t},this);i&&(i.open(),this.close())}}},updateTimer:function(e,t){e.get("name");var i=this.$el.find(".bonusworldBlock."+e.get("name"));if(i&&i.length)if(0<t){var o="";o=t<3600?formatTime("%i:%s",t):formatPeriod(t<86400?Math.round(t/60):60*Math.round(t/60/60)),i.find(".timer").html(o),i.find(".timerBlock").show(),i.find(".timer").show()}else i.find(".timer").hide(),i.find(".timerBlock").hide()},onOpen:function(){for(var e=0;e<Config.bonusWorlds.length;++e){var t=Config.bonusWorlds[e];if(!(t.isSatellite()||t.get("showOpenedOnly")&&!t.isOpenedForUser())){var i=$($(".bonusWorldSelectWindowItem_template").html());i.addClass(t.get("name")),i.find(".start").attr("data-name",t.get("name")),i.find(".description").html(messages[t.get("name")+"NewBonusWorldName"]),this.$el.find(".windowContent").append(i),t.get("timer")&&t.get("showTimer")&&i.addClass(t.get("name")+"_withTimer"),t.on("change:timer",this.updateTimer,this)}}},onClose:function(){Config.bonusWorlds.forEach(function(e){e.off("change:timer",this.updateTimer,this)},this)}}),GiantPrizeWindow=TWindow.extend({templateClass:".giantPrizeWindow_template",events:{"click .refuse":"refuse","click .accept":"accept"},onOpen:function(){TWindow.prototype.onOpen.call(this)},takePrize:function(){var t=new UserPrizes;_.each(this.options.prize,_.bind(function(e){t.add(e)},this)),t.take("returnUser")},accept:function(){this.close(),callService("../../../gems/site/service/returnuser.php",this.takePrize.bind(this),function(){},{accepted:1})},refuse:function(){this.close(),callService("../../../gems/site/service/returnuser.php",function(){},function(){},{accepted:2})}}),PromoWindow=TWindow.extend({templateClass:".promoWindow_template",events:{"click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.addClass(this.options.name),messages[this.options.name]&&_.each(messages[this.options.name],function(e,t){this.$(".m"+_.firstToUpperCase(t)).html(e)},this),this.$(".mPrizes").empty(),this.userPrizeBlock=new UserPrizesView({model:new UserPrizes(this.options.prize),el:this.$(".mPrizes"),isGroup:!0})},onClose:function(){TWindow.prototype.onClose.call(this),this.userPrizeBlock.model.take(this.options.name)},remove:function(){TWindow.prototype.remove.call(this),this.userPrizeBlock.remove(),this.userPrizeBlock=null}}),BasePromo=function(){function t(e){_classCallCheck(this,t),this.options=e}return _createClass(t,[{key:"check",value:function(){}},{key:"take",value:function(){}}]),t}(),VKPromo=function(e){_inherits(i,BasePromo);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"check",value:function(){var e=this;return new Promise(function(t){VK.api("apps.promoHasActiveGift",{promo_id:e.options.promoId},function(e){t(e.response)})})}},{key:"take",value:function(){var e=this;return new Promise(function(t){new PromoWindow(_.extend({onClose:function(){VK.api("apps.promoUseGift",{promo_id:e.options.promoId},function(e){console.log(e),t(e.response)})}},e.options))})}}]),i}(),TestPromo=function(e){_inherits(i,BasePromo);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"check",value:function(){return Promise.resolve(JSON.parse(getLocalStorage("promo"+this.options.promoId)||"false"))}},{key:"take",value:function(){var t=this;return new Promise(function(e){new PromoWindow(_.extend({onClose:function(){removeLocalStorage("promo"+t.options.promoId),e(!0)}},t.options))})}}]),i}(),OKPromo=function(e){_inherits(i,BasePromo);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"check",value:function(){var e=this;return new Promise(function(o){FAPI.Client.call({method:"users.checkFlag",flag:e.options.promoId},function(e,t,i){o(t.success)})})}},{key:"take",value:function(){var e=this;return new Promise(function(o){new PromoWindow(_.extend({onClose:function(){FAPI.Client.call({method:"users.resetFlag",flag:e.options.promoId},function(e,t,i){console.log(t),o(t.success)})}},e.options))})}}]),i}();function PromoCreate(e){switch(network){case"vkontakte":return new VKPromo(e);case"odnoklassniki":return new OKPromo(e);case"test":return new TestPromo(e)}}function PromosCreate(){return"vkontakte"==network&&Config.vkPromos?Config.vkPromos.map(function(e){return PromoCreate(e)}):"odnoklassniki"===network&&Config.okPromos?Config.okPromos.map(function(e){return PromoCreate(e)}):"test"===network?[].concat(Config.vkPromos,Config.okPromos).map(function(e){return PromoCreate(e)}):[]}function setTestPromo(e){setLocalStorage("promo"+e,JSON.stringify(!0))}function PromoCheck(){return Promise.all(PromosCreate().map(function(t){return t.check().then(function(e){if(e)return t})})).then(function(e){return e.filter(function(e){return e})})}Application.on("ready",function(){PromoCheck().then(function(t){if(t.length){!function e(){2<=user.getCurrentLevel()?(Game&&Game.cancelNext(),application.waitPage("main").then(function(){t.forEach(function(e){e.take()})})):user.once("change:level",e)}()}})});var AnnouncementActionWindow=TWindow.extend({templateClass:".announcementActionWindow_template",events:{"click .close":"close"},onOpen:function(){var e=this.$(".blueBtn.details"),t="odnoklassniki"===network?"https://ok.ru/piratetreasures/topic/151398947830640":(network,"https://my.games/playathome/rules");e.attr("href",t),TWindow.prototype.onOpen.call(this)}}),StartLevelView=Backbone.View.extend({events:{click:"onStartLevel"},initialize:function(e){this.rules=e.rules,this.rules.on("change:canRunLevel",this.update,this),this.model.on("change:progress",this.update,this)},update:function(){this.$el.find(".mLevel").html(this.model.get("progress")),this.$el.toggleClass("active",this.rules.get("canRunLevel")),this.$el.toggleClass("longNumber",this.isLongNumber(this.model.get("progress")))},onStartLevel:function(){this.model.startNextLevel()},isLongNumber:function(e){return 3<e.toString().length}}),UserPrizeView=Backbone.View.extend({className:"",initialize:function(e){this.options=e;var t=$(".invisible.user-prizes .prize_"+this.model.get("cssClass"));0===t.length&&(t=$(".invisible.user-prizes .prize_simple")),this.setElement(t.clone()),this.render()},render:function(){this.model.get("amount")&&(this.$el.addClass("amount"+this.model.get("amount")),this.$el.find(".amount").html("good"==this.model.get("type")||"prolong"==this.model.get("type")?formatPeriod(60*this.model.get("amount"),!0):this.model.get("amount"))),this.$el.addClass(this.model.get("cssClass")).addClass(this.model.get("componentId")).addClass(this.model.get("type")).addClass(this.model.get("name")).addClass(this.options.className)}}),UserPrizesView=Backbone.View.extend({className:"prizes",elementClassName:"",dontClearContainer:!1,initialize:function(e){this.options=e,this.render(this.$el)},render:function(i){this.options.dontClearContainer||i.empty();var e,o=this.options.isGroup;if(o)for(var t=0;t<Config.powerUpIdsOrder.length;++t){var a=this.model.findWhere({type:"powerUp",name:Config.powerUpIdsOrder[t]});if(!a||e&&e!==a.get("amount")){o=!1;break}e=a.get("amount")}var n=this.model.length-(o?3:0);i.addClass("prizes"+n);var r=this;if(this.model.each(function(e){if(!o||"powerUp"!==e.get("type")){if(e.get("networks"))if("phonegap"===network){if(-1===e.get("networks").indexOf(phonegapNetwork))return}else if("wizq"===network){if(-1===e.get("networks").indexOf(wizqnetwork))return}else if(-1===e.get("networks").indexOf(network))return;var t=new UserPrizeView({model:e,className:r.options.elementClassName});i.append(t.$el)}}),o){var s=$(".invisible.user-prizes .prize_simple").clone();s.addClass("type-powerUp-group").addClass(this.options.elementClassName),s.find(".mAmount").html('<span class="amountLessText">x</span>'+e),i.append(s)}}}),PublicationBlock=Backbone.View.extend({events:{"click .needPublicCheckbox":"togglePublicCheckbox"},initialize:function(){this.needPublic=this.$(".needPublicCheckbox").hasClass("checkboxOn")},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox()},isNeedPublic:function(){return this.needPublic}}),ShopPowerUpsWindow=TWindow.extend({templateClass:".shopPowerUpsWindow_template",events:{"click .close":"close","click .myBuyBtn":"buy"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.$el.addClass(this.options.name),this.$(".mTitle").html(messages[this.options.name].title),this.$(".mDescription").html(messages[this.options.name].description);var i=this.$(".mOffers"),o=this.$(".templates .offer");this.options.offers.forEach(function(e){var t=o.clone().appendTo(i);new UserPrizesView({model:e.products,el:t.find(".mPrizes")}),t.find(".mPrice").html(e.get("coins")),t.find(".myBuyBtn").data("offer",e).addClass("coins"),e.get("discount")&&(t.addClass("discounted"),t.find(".mDiscount").html(e.get("discount")))},this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.updateCoins(),user.on("change:coins",this.updateCoins,this)},updateCoins:function(){this.$(".mCoins").html(user.get("coins").get())},buy:function(e){$(e.currentTarget).data("offer").buy()&&this.close()},onClose:function(){user.off("change:coins",this.updateCoins,this),TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0)}}),ActivateTournamentWindow=TWindow.extend({templateClass:".newTournamentActivationWindow_template",events:{"click .close":"close","click .playBtn":"activate"},onOpen:function(){var n=application.tournament;if(n&&n.model.get("activateEnabled")){var e=function(e,t){var i=n.model.get("state"),o=episode.scores.findWhere({level:e}),a=!!o&&(o&&3<=o.get("stars"));i==ActivateTournament.ACTIVATE_RUNNING?(this.$(".rockets").html(this.options.model.get("activateSuccessScore")-this.options.model.get("activateScore")),!a&&t?this.$(".playBtn").text(messages.playGame):this.$(".playBtn").text(messages.ForceButtonTexts.Okay),n.model.on("change:state",function(){var e=application.tournament.model.get("state");e==ActivateTournament.ACTIVATE_RUNNING&&e==ActivateTournament.ACTIVATE_FINISHED||this.close()},this)):(this.$(".rockets").html("0"),!a&&t?this.$(".playBtn").text(messages.playGame):this.$(".playBtn").text(messages.ForceButtonTexts.Okay),n.model.on("change:state",function(){var e=application.tournament.model.get("state");e==ActivateTournament.FINISHED&&e==ActivateTournament.RESTART||this.close()},this))};n.model.get("singlePassage")&&this.$el.addClass("singlePassage"),n.model.get("upStar")&&this.$el.addClass("upStar");var t=user.get("level"),i=!0;episode.isBonusWorld()?(t>episode.levelsInEpisode()&&(i=!1),t>Config.bonusWorld.getCurrentLevel()&&(i=!1),Config.bonusWorld.levelCheckAvailable&&(Config.bonusWorld.levelCheckAvailable(t,e.bind(this,t)),i=!1)):(t>episode.levelsInEpisode()&&(i=!1),(episode.get("num")>user.get("episode")||episode.get("num")==user.get("episode")&&t>user.get("level"))&&(i=!1)),e.call(this,t,i)}this.runTimer()},onClose:function(){this.stopTimer()},activate:function(){if(this.close(),"main"==application.get("page")){var e=function(e){var t=episode.scores.findWhere({level:e});!!t&&(t&&3<=t.get("stars"))||gameView.start(e)},t=user.get("level");if(episode.isBonusWorld()){if(t>episode.levelsInEpisode())return!1;if(t>Config.bonusWorld.getCurrentLevel())return!1;if(Config.bonusWorld.levelCheckAvailable)return Config.bonusWorld.levelCheckAvailable(t,e.bind(this,t)),!1}else{if(t>episode.levelsInEpisode())return!1;if(episode.get("num")>user.get("episode")||episode.get("num")==user.get("episode")&&t>user.get("level"))return!1}e.call(this,t)}},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=!1)},runTimer:function(e){this.stopTimer(),this.timerInterval=setInterval(_.bind(this.renderTimer,this),1e3),this.renderTimer()},renderTimer:function(){var e=this.model.getLeftTime();e<=0&&(e=0,2==this.model.get("state")&&_.defer(_.bind(this.close,this)));var t=Config.tournamentTimerFormat||"%H:%i:%s";this.$(".timer").html(formatTime(t,e))}}),wpf;MoreCoinsActionWindow.prototype.render=(wpf=MoreCoinsActionWindow.prototype.render,function(){wpf.apply(this,arguments),Config.specialWorld&&user.get("coinsAction")&&this.$el.addClass("birthdayworldCoinsAction"),this.$el.addClass("newCoinsWindow1")}),AddCoinsWindow.prototype.render=function(e){user.getCasteId();this.$el.addClass("newCoinsWindow1"),BaseCoinsWindow.prototype.render.call(this,e)},AddCoinsWindow.prototype.isCasteProductPurchasedToday=function(e){var t=getLocalStorage("lastPaymentTime_caste"+e,0);return application.getCurrentServerTime()-t<86400};var GameFridayWindow=TWindow.extend({templateClass:".gameFridayWindow_template",events:{"click .buy":"buy","click .close":"close"},onOpen:function(){TWindow.prototype.onOpen.call(this),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")}),this.$el.addClass(this.model.get("name"));var i=this,e=this.$("#timer");this.timer=setInterval(function(){e.html(formatPeriod(Math.round(i.model.getTimer()/60)))},1e3),this.listenTo(this.model,"change:active",function(e,t){t||i.close()}),this.listenTo(this.model,"change:stage",this.updateStage),this.listenTo(this.model,"change:process",this.updateProcess),this.updateStage();var l=this.$(".invisible .prize"),d=this.model.get("stage");this.model.getItems().length;this.model.get("offers").forEach(function(e,t){var i=this.$(".box"+(t+1));0<e.getPrice()?(i.find(".buy").html(e.getDisplayPrice()),i.find(".shield").html(e.getOldDisplayPrice())):i.addClass("free"),t<d&&(i.addClass("opened"),i.addClass("received")),d<t&&i.find(".buy").addClass("deactivated");var o,a,n=e.getProducts(),r=4<n.length;if(r)for(t=0;t<Config.powerUpIdsOrder.length;++t){var s=n.findWhere({type:"powerUp",name:Config.powerUpIdsOrder[t]});if(!s||o&&o!==s.get("amount")){r=!1;break}o=s.get("amount")}n.forEach(function(e){r&&"powerUp"===e.getType()||((a=l.clone()).appendTo(i.find(".prizes")),a.addClass(e.getType()).addClass(e.getName()),"good"===e.getType()?a.find(".amount").html(formatPeriod(60*e.getDisplayAmount(),!0)):a.find(".amount").html(e.getDisplayAmount()))},this),r&&((a=l.clone()).appendTo(i.find(".prizes")),a.addClass("powerUp-group"),a.find(".amount").html('<span class="amountLessText">x</span>'+o))},this)},updateProcess:function(){this.$el.toggleClass("processBuy",this.model.get("process"))},updateStage:function(){var e=this.model.get("stage"),t=this.model.getItems().length,i=this.$(".box"+t).find(".progressBar .progressBarText");this.$el.removeClass("stage0 stage1 stage2 stage3 stage4"),this.$el.addClass("stage"+this.model.get("stage")),e<t&&i.html(e+"/"+(t-1))},buy:function(e){var t=$(e.target).data("item");if(!(t>this.model.get("stage"))){var i=this,o=this.model.get("offers")[t].getProducts(),a=this.$(".box"+(t+1)),n=this.$(".box"+(t+2)),r=a.find(".lock"),s=this.$(".box"+this.model.get("items").length).find(".keyTarget");this.model.takeBox(t,function(){i.model.get("process")||(a.addClass("openbox"),a.addClass("opened"),n.find(".buy").removeClass("deactivated"),r.ourAnimate({target:s},500,"linear",function(){r.remove(),a.addClass("received")}),setTimeout(_.bind(function(){a.removeClass("openbox"),new AnimatedPrizesWindow({urgent:!0,prizes:o,worldName:"gameFridayPrizes",notGive:!0}),i.close()},i),1e3))})}},onClose:function(){TWindow.prototype.onClose.call(this),void 0!==this.powerUpsAndCoinsWindowBlock&&(this.powerUpsAndCoinsWindowBlock.close(),this.powerUpsAndCoinsWindowBlock=void 0),clearInterval(this.timer)}}),GameFriday=Backbone.Model.extend({defaults:{active:!1,stage:0},initialize:function(e){this.set("begin",new Date(e.begin).getTime()/1e3),this.set("end",new Date(e.end).getTime()/1e3),this.set("offers",this.get("items").map(function(e){return new Shop.Offer({productId:e})})),this.listenTo(user,"buyProduct",this.onBuyProduct)},isActive:function(){return this.get("active")},isAvailability:function(){if(user.getCurrentLevel()<22)return!1;if(this.get("networks")&&-1===this.get("networks").indexOf(network))return!1;if(this.get("notNetworks")&&-1!==this.get("notNetworks").indexOf(network))return!1;var e=application.getCurrentServerTime();return e>this.get("begin")&&e<this.get("end")},checkAvailability:function(){this.isAvailability()?callService("../../../gems/site/service/gamefridayget.php",_.bind(function(e){this.set("stage",e.stage),this.set("active",!0),this.timerCheckAvailability&&clearTimeout(this.timerCheckAvailability),this.get("active")&&(this.timerCheckAvailability=setTimeout(this.checkAvailability.bind(this),1e3*this.getTimer()+100),this.showWindow||(this.showWindow=!0,new GameFridayWindow({model:this})))},this),_.noop,{actionId:this.get("actionId")}):this.set("active",!1)},getTimer:function(){return this.get("end")-application.getCurrentServerTime()},getCurrentProduct:function(e){var t=e||this.get("stage"),i=this.get("items")[t];if(i)return prices[i]},getItems:function(){return this.get("items").map(function(e){return prices[e]})},takeBox:function(e,t){if(!this.get("process")){var i=this.getCurrentProduct(e);if(i)return this.set("process",!0),this.callback=t,0<i.price?showBuy(i):socialNetwork.trigger("success_payment",i),void setTimeout(_.bind(function(){this.set("process",!1)},this),1e4)}t()},onBuyProduct:function(e){if(this.isActive()){var t=this.getCurrentProduct();t&&t.product==e.product?callService("../../../gems/site/service/gamefridayset.php",_.bind(function(e){this.set("stage",e.stage),this.timerCheckAvailability&&clearTimeout(this.timerCheckAvailability),this.get("active")&&(this.timerCheckAvailability=setTimeout(this.checkAvailability.bind(this),this.getTimer()+100)),this.set("process",!1),this.callback&&(this.callback(this),this.callback=null)},this),_.noop,{actionId:this.get("actionId")}):(this.set("process",!1),this.callback&&(this.callback(this),this.callback=null))}}}),Eqf,Fqf;Application.on("ready",function(){if(Config.gameFriday){var e=new GameFriday(Config.gameFriday);$("#gameFridayAction").addClass(e.get("name")),$("#gameFridayAction").click(function(){new GameFridayWindow({model:e})}),e.on("change:active",function(){$("#gameFridayAction").toggleClass("active",e.isActive())}),e.checkAvailability()}}),_Figure.prototype.animationByName=(Eqf=_Figure.prototype.animationByName,Fqf=function(e){var t=e+"_"+episode.getEpisodeName(),i=FigureAnimations[t]?t:e;return Eqf.call(this,i)},Fqf.base=Eqf,Fqf);var ShooterCell=BaseCell.extend({constructor:function(){BaseCell.prototype.constructor.apply(this,arguments),this.color="none",this.removeOnRemoveNear=!0,this.active=!1,this.setVersion(),this.shooterColor="none"!=application.level["shooterColor"+this.version]&&application.level["shooterColor"+this.version],this.movingAvailable=2==parseInt(application.level["shooterState"+this.version]),this.isMoving=!1,this.movable=!1,Game.on("fallDownStart",this.resetDiv,this)},setVersion:function(){switch(application.level.map[this.y].charAt(this.x)){case"}":this.version=1;break;case"{":this.version=2;break;case"[":this.version=3;break;case"_":this.version=4;break;default:this.version=1}},createDiv:function(e){void 0===e&&(e=[this.calcColor()]);var t=FigureView.createByTemplate(".invisible ."+this.getTemplateClass(),e);return FigureView.findById("shootercell").append(t),t.set(this.getCoords()),this.$div=t,this.setX(this.x),this.setY(this.y),this.movingAvailable&&this.$div.addClass("movable"),this.shooterColor?this.$div.find(".color").addClass("color"+this.shooterColor):this.$div.find(".color").hide(),this.$div},removeNear:function(e,t,i,o,a){this.medusaBlocked||this.isBlocked("removable")||this.shooterColor&&this.shooterColor!=t||this.remove()},getTemplateClass:function(){return"shooterCell"},remove:function(){if(!this.medusaBlocked&&!this.isBlocked("removable")){var e=_.find(Game.tasks.models,function(e){return"CollectShooter"==e.get("name")});if(e&&!e.get("completed")&&!this.isBlocked("removable")){var t=Game.animate(),i=this.$div;this.active?i.queue(function(e){i.addClass("deactivated"),e(),setTimeout(function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("shooterTask");_Figure.blockedAnimations.append(e),e.alignTo(i),Game.trigger("removedShooter",e),application.playSound("monkeyRemove"),e.remove()},400)}).delay(1100).queue(function(e){i.removeClass("deactivated").removeClass("active"),e(),t()}):(application.playSound("monkeyRemove"),i.queue(function(e){i.addClass("activated"),e()}).delay(700).queue(function(e){i.removeClass("activated").addClass("active"),e(),t()})),this.active=!this.active}}},getPossibleNeighbors:function(r){r=r||[];var s=this,l=[];return _.each([{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}],function(e){var t=s.x+e.x,i=s.y+e.y;if(Game.inField(t,i)){var o=Game.field[i][t],a=[Cell,DroppableCell,BombCell,ArrowCell,MultiColorCell,EggCell,CandyCell,FireFlowerCell],n=!1;_.each(a,function(e){o instanceof e&&(n=!0)}),o instanceof Cell&&!o.isRegular&&(n=!1),!n||o.decorator&&"changecolor"!=o.decorator.get("name")||o.medusaBlocked||o.isBlocked("removeOnRemoveNear")||this.lastPosition==o||-1!==_.indexOf(r,o)||-1!==_.indexOf(ShooterCell.blockedCells,o)||l.push(o)}},this),l},getMoveCell:function(e){var t=!1,i=this.getPossibleNeighbors(e);return i.length&&(t=RANDOM(i)),t},move:function(t){var i=this.$div,o=this;this.steps=1,this.moved=!1,this.lastPosition=!1,this.isMoving=!0,this.active&&this.getMoveCell()?i.queue(function(e){i.removeClass("show").addClass("hide"),e()}).delay(400).queue(function(e){e(),o.step(t)}):this.step(t)},step:function(t){var i=this.getMoveCell();if(i){ShooterCell.blockedCells.push(i);var o=this.$div,a=this;this.lastPosition=i,this.moved=!0,o.queue(function(e){o.removeClass("hide").removeClass("show").removeClass("moving").removeClass("movingStart").removeClass("movingLeft").removeClass("movingRight"),i.x<a.x?o.addClass("movingLeft"):o.addClass("movingRight"),o.addClass("movingStart"),e()}).delay(200).queue(function(e){o.removeClass("movingStart").addClass("moving"),e(),a.swap(i,_.bind(function(){a.steps<2?(++a.steps,a.step(t)):a.stop(t)},a))})}else this.stop(t)},stop:function(t){this.isMoving=!1;var i=this.$div;i.removeClass("moving").removeClass("movingStart").removeClass("movingLeft").removeClass("movingRight").removeClass("hide"),this.active&&this.moved?i.queue(function(e){i.addClass("show"),e()}).delay(400).queue(function(e){e(),t()}):t()},swap:function(e,t){Game.field[this.y][this.x]=e;var i=(Game.field[e.y][e.x]=this).x;this.x=e.x,e.x=i,i=this.y,this.y=e.y,e.y=i,e.$div.ourAnimate(e.getCoords(),250,"linear",_.noop),this.$div.ourAnimate(this.getCoords(),250,"linear",function(){t()})}},{chars:"}{[_",blockedCells:[],process:function(){var e=_.find(Game.tasks.models,function(e){return"CollectShooter"==e.get("name")});e&&!e.get("completed")&&(ShooterCell.blockedCells=[],Game.each(function(e){if(!(e instanceof ShooterCell)||!e.movingAvailable||e.isBlocked("movable")||e.medusaBlocked||e.isMoving)return!1;e.move(Game.animate())}))}}),ActiveShooterCell=BaseCell.extend({constructor:function(){BaseCell.prototype.constructor.apply(this,arguments),this.color="none",this.removeOnRemoveNear=!0,this.active=!0,this.setVersion(),this.shooterColor="none"!==application.level["shooterColor"+this.version]&&application.level["shooterColor"+this.version],this.movingAvailable=2===parseInt(application.level["shooterState"+this.version]),this.isMoving=!1,this.movable=!1},setVersion:function(){switch(application.level.map[this.y].charAt(this.x)){case"":this.version=1;break;case"":this.version=2;break;case"":this.version=3;break;case"":this.version=4;break;default:this.version=1}},createDiv:function(e){void 0===e&&(e=[this.calcColor()]);var t=FigureView.createByTemplate(".invisible ."+this.getTemplateClass(),e);return FigureView.findById("shootercell").append(t),t.set(this.getCoords()),this.$div=t,this.setX(this.x),this.setY(this.y),this.movingAvailable&&this.$div.addClass("movable"),this.shooterColor?this.$div.find(".color").addClass("color"+this.shooterColor):this.$div.find(".color").hide(),this.active&&this.$div.addClass("active"),this.$div},removeNear:function(e,t){this.isBlocked("removeOnRemoveNear")||this.medusaBlocked||this.shooterColor&&this.shooterColor!==t||this.remove()},getTemplateClass:function(){return"shooterCell"},remove:function(){if(!this.medusaBlocked&&!this.isBlocked("removable")){var e=ActiveShooterCell.getTask();if(e&&!e.get("completed")&&this.active&&!this.isBlocked("removable")){var t=Game.animate(),i=this.$div;application.playSound("monkeyRemove"),i.queue(function(e){i.addClass("animateShot"),i.find(".shooterBg").addClass("animateShot"),e(),setTimeout(function(){var e=FigureView.createByTemplate(".invisible .emptyTemplate").addClass("shooterTask");_Figure.blockedAnimations.append(e),e.alignTo(i),Game.trigger("removedShooter",e),e.remove()},400)}).delay(600).queue(function(e){i.removeClass("animateShot"),i.find(".shooterBg").removeClass("animateShot"),e(),t()})}}},getPossibleNeighbors:function(r){r=r||[];var s=this,l=[];return _.each([{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}],function(e){var t=s.x+e.x,i=s.y+e.y;if(Game.inField(t,i)){var o=Game.field[i][t],a=[Cell,DroppableCell,BombCell,ArrowCell,MultiColorCell,EggCell,CandyCell,FireFlowerCell],n=!1;_.each(a,function(e){o instanceof e&&(n=!0)}),o instanceof Cell&&!o.isRegular&&(n=!1),!n||o.decorator&&"changecolor"!==o.decorator.get("name")||o.isBlocked("removeOnRemoveNear")||o.medusaBlocked||this.lastPosition===o||-1!==_.indexOf(r,o)||-1!==_.indexOf(ActiveShooterCell.blockedCells,o)||l.push(o)}},this),l},getMoveCell:function(e){var t=!1,i=this.getPossibleNeighbors(e);return i.length&&(t=RANDOM(i)),t},move:function(t){var i=this.$div,o=this;this.steps=1,this.moved=!1,this.lastPosition=!1,this.isMoving=!0,this.active&&this.getMoveCell()?i.queue(function(e){i.removeClass("show").addClass("hide"),e()}).delay(400).queue(function(e){e(),o.step(t)}):this.step(t)},step:function(t){var i=this.getMoveCell();if(i){ActiveShooterCell.blockedCells.push(i);var o=this.$div,a=this;this.lastPosition=i,this.moved=!0,o.queue(function(e){o.removeClass("hide").removeClass("show").removeClass("moving").removeClass("movingStart").removeClass("movingLeft").removeClass("movingRight"),i.x<a.x?o.addClass("movingLeft"):o.addClass("movingRight"),o.addClass("movingStart"),e()}).delay(200).queue(function(e){o.removeClass("movingStart").addClass("moving"),e(),a.swap(i,_.bind(function(){a.steps<2?(++a.steps,a.step(t)):a.stop(t)},a))})}else this.stop(t)},stop:function(t){this.isMoving=!1;var i=this.$div;i.removeClass("moving").removeClass("movingStart").removeClass("movingLeft").removeClass("movingRight").removeClass("hide"),this.active&&this.moved?i.queue(function(e){i.addClass("show"),e()}).delay(400).queue(function(e){e(),t()}):t()},swap:function(e,t){Game.field[this.y][this.x]=e;var i=(Game.field[e.y][e.x]=this).x;this.x=e.x,e.x=i,i=this.y,this.y=e.y,e.y=i,e.$div.ourAnimate(e.getCoords(),250,"linear",_.noop),this.$div.ourAnimate(this.getCoords(),250,"linear",function(){t()})}},{chars:"",blockedCells:[],process:function(){var e=ActiveShooterCell.getTask();e&&(e.get("completed")?Game.filter(function(e){return e instanceof ActiveShooterCell}).forEach(function(t){t.active&&(t.active=!1,t.removable=!1,t.$div.queue(function(e){t.$div.addClass("animateRemoval"),e()}).delay(500).queue(function(e){t.$div.removeClass("animateRemoval").removeClass("active"),e()}))}):(ActiveShooterCell.blockedCells=[],Game.each(function(e){if(!(e instanceof ActiveShooterCell)||!e.movingAvailable||e.medusaBlocked||e.isMoving||e.isBlocked("movable"))return!1;e.move(Game.animate())})))},getTask:function(){return _.find(Game.tasks.models,function(e){return"CollectShooter"===e.get("name")})}}),CollectShooter=Task.extend({initialize:function(){this.set("event","removedShooter"),this.set("type","CollectShooter");var e=this.get("description").amount;e&&0<e&&this.set("amount",e),Task.prototype.initialize.call(this)},tick:function(e){this.animateCollect(e,GameScores.shooter,Game.endTurnAnimate(function(){Task.prototype.tick.call(this),e.remove()},this))},animateCollect:function(e,t,i,o,a){if(e.length){var n=e.clone(),r=Game.animate();_Figure.blockedAnimations.append(n),n.set({"margin-left":0,"margin-top":0}),n.alignTo(e),n.find(".arrow").remove(),n.find(".decorator").remove(),void 0!==o&&n.delay(o);var s=360;this instanceof Task?(a&&a!=this.target&&this.precalc(a),s=this.getAnimateCollectRotation()):Task.prototype.precalc.call(this,a),r(),application.playSound("monkeyThrow"),n.ourAnimate({target:this.target,ajust:this.ajust,scale:.75,rotate:s},6*Game.get("speed"),void 0,_.bind(function(){Game.set("score",Math.max(0,Game.get("score")+t)),this.showPoints(n,t),i()},this)).ourAnimate({opacity:0},2*Game.get("speed"),void 0,function(){n.remove()})}else i()}}),EverydayQuest=Backbone.Model.extend({defaults:{enabled:!1,minLevel:0,interval:172800,levelPrizes:[],startTime:0,allowed:!1,outdated:!1,restarted:!1,progress:!1,prizeSets:0},initialize:function(){var e=Config.everydayQuest||{};this.set(e),this.handleEvents(),this.init()},isActive:function(){return this.get("enabled")&&this.get("allowed")&&!this.get("disabled")&&!this.get("outdated")&&!this.get("currentTarget").done},isFinishedOnCurrentLevel:function(){return!this.isActive()&&this.get("progress")>=_.last(this.get("levelPrizes")).level},get:function(e){var t=this.attributes.levelPrizes,i=this.attributes.interval+this.attributes.startTime,o=this.attributes.progress,a=_.find(t,function(e){return e.level>o})||{done:!0},n=a.level,r=_.findLastIndex(t,function(e){return e.level<n}),s=t[r]||{level:0},l=this.attributes.progress-s.level,d=a.level-s.level,c=l/(n-s.level),g=_.last(t)||{level:1},u=user.getMaxLevel()-g.level+1,h=this.attributes.enabled&&user.getCurrentLevel()>=this.attributes.minLevel,p=!h||this.attributes.outdated,m=void 0!==r?r+1:0;switch(e){case"leftTime":return i-application.getCurrentServerTime();case"finishTime":return i;case"spentTime":return application.getCurrentServerTime()-this.get("startTime");case"currentTarget":return a;case"currentTargetLevel":return n;case"previousTarget":return s;case"currentTargetProgress":return l;case"currentTargetProgressMax":return d;case"currentTargetProgressPercent":return c;case"allowed":return h;case"disabled":return p;case"done":return!p&&!!a.done;case"maxLevel":return u;case"finishedTargetsCount":return m;default:return this.attributes[e]}},handleEvents:function(){var e=this;this.on("change:restarted",function(){this.get("restarted")&&("main"==application.get("page")?new EverydayQuestWindow({model:this}):application.once("main",function(){new EverydayQuestWindow({model:this})},this),this.update(),this.set("restarted",!1))}),this.on("change:progress",this.onProgress),this.on("change:enabled change:minLevel",function(){this.init()}),this.on("change:startTime change:interval",this.checkOutdate),this.on("change:prizeSets",this.setLevelPrizes);var t=Config.bonusWorlds.getByName(Config.freeEpisodeName);t&&t.on("completeLevel",function(){user.isAllLevelsCompleted()&&e.updateProgress()},this),user.on("change:level",function(){this.updateProgress(),user.getPreviousLevel()<this.get("minLevel")&&this.get("allowed")&&this.init()},this),new EverydayQuestBtn({model:this})},updateProgress:function(){this.get("allowed")&&!this.get("outdated")&&this.set("progress",this.get("progress")+1),this.update()},onProgress:function(){var e=this.get("levelPrizes"),t=this.get("progress"),i=this.previous("progress"),o=_.find(e,{level:t});o&&!1!==i&&i<t&&new EverydayQuestWindow({model:this,levelPrize:o})},checkOutdate:function(){if(this.get("allowed")){var e=this.get("leftTime")<=0,t=1800<this.get("leftTime")?1800:this.get("leftTime")<0?0:this.get("leftTime");this.set("outdated",e),e?this.restart():setTimeout(_.bind(this.checkOutdate,this),1e3*t)}},init:function(){if(this.get("allowed")){var e=user.get("everydayQuestStartTime")||this.get("startTime"),t=user.get("everydayQuestProgress")||user.getPassedLevels()-user.get("everydayQuestStartLevel")||this.get("progress"),i=user.get("everydayQuestPrizeSets")||this.get("prizeSets");this.set({startTime:e,progress:t,prizeSets:i}),this.checkOutdate(),this.setLevelPrizes()}},restart:function(){this.get("allowed")&&(user.timeReward&&user.timeReward.isAvailable()&&user.timeReward.get("progress")||user.getCurrentLevel()>this.get("maxLevel")||this.set({startTime:application.getCurrentServerTime(),progress:0,prizeSets:this.genPrizeSets(),restarted:!0}))},update:function(){callServiceAddInQueue("../../../gems/site/service/everydayquestupdate.php",{startTime:this.get("startTime"),progress:this.get("progress"),prizeSets:this.get("prizeSets")})},setLevelPrizes:function(){var i=this.get("prizeSets"),e=this.get("levelPrizes");_.each(e,function(e){var t=i%10;this.set("prizeId",t),i=(i-t)/10,t%=e.prizesSet.length,e.prizes=e.prizesSet[t]},this)},genPrizeSets:function(){var t;t=user.get("paid")?Config.everydayQuest.prizeId:_.random(2,3);var i=0,e=this.get("levelPrizes"),o=1;return void 0===t&&(t=_.random(0,1)),this.set("prizeId",t),_.each(e,function(e){i+=t*o,o*=10}),i}});Application.on("ready",function(){application.everydayQuest=new EverydayQuest});var EverydayQuestWindow=TWindow.extend({templateClass:".everydayQuestWindow_template",onOpen:function(){this.render(),this.setupTimer(),this.listenTo(this.model,"change:outdated",this.renderTimer)},onClose:function(){this.cleanupTimer()},render:function(){this.options.levelPrize&&this.$el.addClass("givenPrize"),this.$el.addClass("state"+this.model.get("finishedTargetsCount")),this.$el.addClass("prizes"+this.model.get("prizeId")),this.renderLevelPrizes(),this.renderGivenPrize(),this.renderCakeScore(),this.renderTimer(),this.givePrizes()},renderLevelPrizes:function(){_.each(this.model.get("levelPrizes"),_.bind(this.renderLevelPrize,this))},renderLevelPrize:function(e){var t=this.$(".invisible .levelPrize").clone(),i=this.model.get("currentTargetProgressPercent"),o=e.level-this.model.get("progress"),a=messages.everydayQuestWindowPrizeDescLabel;a||(a=["","",""]);var n=sprintf(messages.everydayQuestWindowPrizeDesc,{levelsLeft:o,levelsWord:plural(messages.levels,o),labelWord:plural(a,o)}),r=e.level===this.model.get("currentTargetLevel"),s=Math.round(100*i);t.addClass("level"+e.level),t.toggleClass("done",o<=0),t.toggleClass("currentTarget",r),r&&0<o&&t.find(".desc").html(n),t.find(".progressAmount").html(this.model.get("currentTargetProgress")+"/"+this.model.get("currentTargetProgressMax")),t.find(".progressBar").toggleClass("lessThanHalf",s<50),r&&t.find(".progressLine").width(0).animate({width:s+"%"},600),_.each(e.prizes,this.renderPrize(t.find(".prizes")),this),this.$(".levelPrizes").append(t)},renderPrize:function(o){return _.bind(function(e){if(e.checkAvailable&&!e.checkAvailable())return!1;var t=this.$(".invisible .prize_"+e.cssClass);0===t.length&&(t=this.$(".invisible .prize_simple"));var i=t.clone();e.amount&&i.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),i.addClass(e.cssClass),o.append(i)},this)},renderTimer:function(){this.$(".timer").html(formatTime("%H:%i:%s",this.model.get("leftTime"))),this.model.get("outdated")&&this.close()},setupTimer:function(){this.timerId=setInterval(_.bind(this.renderTimer,this),1e3)},cleanupTimer:function(){this.timerId&&clearInterval(this.timerId)},renderGivenPrize:function(){if(this.options.levelPrize){var e=this.options.levelPrize,t=(this.model.get("spentTime"),this.$(".levelPrize.level"+e.level));window.mobile?t.addClass("done"):t.removeClass("done").delay(600).animate({scale:1.2},300).animate({scale:1},300).queue(function(){t.addClass("done")}),this.$(".playerPowerupsBlock").removeClass("invisible"),this.powerUpsAndCoinsWindowBlock=new PowerUpsAndCoinsWindowBlock({el:this.$(".playerPowerupsBlock")})}},renderCakeScore:function(){var e=(this.model.get("levelPrizes").indexOf(this.model.get("currentTarget"))+4)%4,t=e+"/"+this.model.get("levelPrizes").length;this.$(".cakeScore").html(t),this.$(".cakeBlock").addClass("cakeLevel"+e)},givePrizes:function(){if(this.options.levelPrize){this.model.isFinishedOnCurrentLevel()&&user.trigger("everydayquestcompleted");var e=this.options.levelPrize.prizes,t=user.get("coins");_.each(e,_.bind(function(e){if(e.checkAvailable&&!e.checkAvailable())return!1;"coins"==e.type&&(t=new ObscureNumber(t.get()+e.amount)),"powerUp"==e.type&&user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0),"good"==e.type&&goods.goodBuyed(e.name,e.amount,!0),"gift"==e.type&&void 0!==Gifts&&Gifts.receiveGift(Gifts.findGiftById(e.giftId))},this)),user.set({powerUps:user.calcPowerUps(),coins:t,actionName:"everydayQuestLevel"+this.options.levelPrize.level,actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0})}}}),EverydayQuestBtn=Backbone.View.extend({el:"#EverydayQuestBtn",events:{click:"onClick",touchend:"onClick"},initialize:function(){this.checkModel(),this.checkPage(),this.listenTo(this.model,"change",this.checkModel),this.listenTo(application,"change:page",this.checkPage)},checkModel:function(){(this.model.get("outdated")||this.model.get("done"))&&this.cleanupTimer(),this.model.get("disabled")||this.checkPage(),this.render()},checkPage:function(){"game"==application.get("page")?this.cleanupTimer():this.model.get("disabled")||this.setupTimer(),this.renderTimer()},render:function(){this.$el.toggleClass("invisible",this.model.get("disabled")||this.model.get("done")),this.renderTimer()},onClick:function(){new EverydayQuestWindow({model:this.model})},renderTimer:function(){this.$(".timer").html(formatTime("%H:%i:%s",this.model.get("leftTime"))),this.$(".timer").toggleClass("invisible",this.model.get("outdated"))},setupTimer:function(){this.timerId||(this.timerId=setInterval(_.bind(this.renderTimer,this),1e3))},cleanupTimer:function(){this.timerId&&clearInterval(this.timerId),this.timerId=!1}}),cvf,dvf,rvf;StatisticAfterWindow.prototype.onOpen=(cvf=StatisticAfterWindow.prototype.onOpen,dvf=function(){cvf.call(this),this.renderEverydayQuestBlock()},dvf.base=cvf,dvf),StatisticAfterWindow.prototype.renderEverydayQuestBlock=function(){var e=application.everydayQuest;if(e.isActive()&&!episode.isBonusWorld()){var t=e.get("currentTarget");this.$el.addClass("everyDayQuestAvailable");var i=this.$(".everydayQuestBlock");i.addClass("prizes"+e.get("prizeId"));var o=e.get("currentTargetProgressPercent"),a=t.level-e.get("progress"),n=i.find(".prizes"),r=messages.everydayQuestWindowPrizeDescLabel;r||(r=["","",""]);var s=sprintf(messages.everydayQuestWindowPrizeDesc,{levelsLeft:a,levelsWord:plural(messages.levels,a),labelWord:plural(r,a)}),l=Math.round(100*o);i.removeClass("invisible"),i.addClass("level"+t.level),i.find(".desc").html(s),i.find(".progressLine").width(0).animate({width:l+"%"},600),i.find(".progressAmount").html(e.get("currentTargetProgress")+"/"+e.get("currentTargetProgressMax")),i.find(".progressBar").toggleClass("lessThanHalf",l<50),_.each(t.prizes,function(e){if(!e.checkAvailable||e.checkAvailable()){var t=this.$(".invisible .everydayQuestPrize_"+e.cssClass);0===t.length&&(t=this.$(".invisible .everydayQuestPrize_simple"));var i=t.clone();e.amount&&i.find(".amount").html("good"==e.type?formatPeriod(60*e.amount,!0):e.amount),i.addClass(e.cssClass),n.append(i)}},this)}},rvf=[[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}],[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:2},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:2}],[{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:4},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:2},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1}]],Config.everydayQuest={enabled:!0,minLevel:21,prizeId:void 0,levelPrizes:[{level:4,prizesSet:[rvf[0],rvf[0],rvf[0],rvf[0]]},{level:9,prizesSet:[rvf[1],rvf[1],rvf[1],rvf[1]]},{level:15,prizesSet:[rvf[2],rvf[2],rvf[2],rvf[2]]}]};var TimeReward=Backbone.Model.extend({defaults:{name:"timereward",duration:86400,timeout:172800,level:81,prize:[],beginTime:0,prizeTime:0,timer:0,progress:0,progressGoal:12,isInited:!1,method:!1},initialize:function(){this.process("init",!1),user.on("createNewGame",function(e,t){this.set("method","init"),this.listenTo(Game,"win",function(){episode.scores.findWhere({level:application.level.num})||episode.isBonusWorld()||this.set("method","setProgress")},this)},this)},getTimerPeriod:function(){return this.get("duration")-(application.getCurrentServerTime()-this.get("beginTime"))},show:function(){if(this.isAvailable()){var e=new TimeRewardView({model:this,el:$(".invisible .timeReward").clone().appendTo("#statisticWindow")}),t=_.bind(function(){this.set("timer",this.getTimerPeriod()),0<this.get("timer")?setTimeout(t,1e3):e.remove()},this);setTimeout(t,1e3)}},run:function(){return!!this.isAvailable()&&(this.isCompleted()||"init"==this.get("method")&&this.get("isInited")?this.show():this.process(this.get("method"),!0),!0)},restart:function(){callServiceAddInQueue("../../../gems/site/service/timereward.php",{method:"reset"}),this.set("prizeTime",0),this.set("progress",0),this.set("beginTime",0),this.set("isInited",!1)},complete:function(){callServiceAddInQueue("../../../gems/site/service/timereward.php",{method:"setPrize"}),this.set("prizeTime",application.getCurrentServerTime()),this.set("progress",0),this.set("beginTime",0),this.set("isInited",!1)},process:function(e,t){callService("../../../gems/site/service/timereward.php",_.bind(function(e){this.set("prizeTime",e.prizeTime),this.set("beginTime",e.beginTime),this.set("progress",e.progress),this.get("beginTime")&&(this.set("isInited",!0),t&&this.show())},this),_.noop,{method:e})},getExpireTime:function(){return!!this.get("beginTime")&&this.get("beginTime")+this.get("duration")},isExpired:function(){var e=this.getExpireTime();return!this.isCompleted()&&e&&application.getCurrentServerTime()>=e},isCompleted:function(){return this.get("progress")>=this.get("progressGoal")},isRewarded:function(){return 0<this.get("prizeTime")},isTimeoutOver:function(){var e=0;return this.isExpired()?e=this.get("beginTime")+this.get("duration")+this.get("timeout"):this.isRewarded()&&(e=this.get("prizeTime")+this.get("timeout")),e&&application.getCurrentServerTime()>=e},isAvailable:function(){return(!application.everydayQuest||!application.everydayQuest.isActive()&&!application.everydayQuest.isFinishedOnCurrentLevel())&&(!(user.getRealLevel()<this.get("level"))&&(!(this.isExpired()&&!this.isTimeoutOver())&&!(this.isRewarded()&&!this.isTimeoutOver())))}}),TimeRewardView=Backbone.View.extend({events:{},initialize:function(){this.$el.addClass(this.model.get("name")),$("#statisticWindow").addClass("timeRewardAvailable"),this.model.get("css")&&this.$el.addClass(this.model.get("css")),user.timeReward&&user.timeReward.isAvailable()&&this.render(),this.listenTo(this.model,"change:timer",this.renderTimer)},render:function(){user.timeReward&&user.timeReward.isAvailable()?this.$el.show():this.$el.hide(),this.renderTimer(this.model,this.model.get("timer")),this.renderProgress(this.model)},renderProgress:function(e){this.$(".timeRewardProgress").html(e.get("progress")),this.$(".timeRewardProgressGoal").html(e.get("progressGoal"));var t=Math.floor(100*e.get("progress")/e.get("progressGoal"));this.$(".timeRewardProgressBarLine").css("width",t+"%")},renderTimer:function(e,t){3600<t?this.$(".timeRewardTimer").html(formatPeriod(Math.ceil(t/60))):this.$(".timeRewardTimer").html(formatTime("%i:%s",t))}}),TimeRewardWindow=TWindow.extend({templateClass:".timeRewardWindow_template",events:{"click .close":"close","click .needPublicCheckbox":"togglePublicCheckbox"},prize:[{type:"good",cssClass:"unlimitedLifes",name:"unlimitedLifes",amount:2},{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}],takePrize:function(){_.each(this.prize,_.bind(function(e){"powerUp"==e.type?user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0):"good"==e.type&&goods.goodBuyed(e.name,e.amount,!0)},this)),user.set({powerUps:user.calcPowerUps()}),user.timeReward&&user.timeReward.complete()},onClose:function(){this.takePrize(),this.needPublic&&user.defaultPublication("timeRewardPublication")},onOpen:function(){TWindow.prototype.onOpen.call(this),this.applyCheckboxState()},offPublicCheckbox:function(){this.needPublic=!1,this.$(".needPublicCheckbox").removeClass("checkboxOn").addClass("checkboxOff")},onPublicCheckbox:function(){this.needPublic=!0,this.$(".needPublicCheckbox").removeClass("checkboxOff").addClass("checkboxOn")},togglePublicCheckbox:function(){this.needPublic?this.offPublicCheckbox():this.onPublicCheckbox(),this.rememberCheckboxState()}}),bwf,hwf,jwf,mwf,nwf,owf,rwf,twf,uwf,Vwf;Application.on("ready",function(){Config.timeRewardEnabled&&(user.timeReward=new TimeReward)}),UserView.prototype.renderUser=(bwf=UserView.prototype.renderUser,function(){bwf.call(this);var t="levelSpecial",i="",e=user.get("level");if(episode.isBonusWorld()&&(e=Config.bonusWorld.getCurrentLevel()),Config.needShowEpisodes){var o=episode.isBonusWorld()?episode.previous("num"):episode.get("num");i=" #levelsBlock"+((o-1)%Config.needShowEpisodes+1)+" "}$(i+".level").removeClass(t),_.each(episode.getSpecialLevels(),function(e){$(i+"#level"+e).addClass(t)},this),$(i+".outerLevelAnimation").toggleClass(t,episode.isSpecialLevel(e))}),void 0!==TasksWindow&&(TasksWindow.prototype.onOpen=(hwf=TasksWindow.prototype.onOpen,function(){hwf.call(this),episode.isSpecialLevel(application.level.num)&&this.$el.addClass("levelSpecial")})),ThreeInRowBaseView.prototype.afterStart=(jwf=ThreeInRowBaseView.prototype.afterStart,function(){jwf.call(this);var e="levelSpecial";if(episode.isSpecialLevel(application.level.num)){$("#game").addClass(e);var t=FigureView.findById("moves");t&&t.addClass(e)}}),TasksView.prototype.onBeforeWin=(mwf=TasksView.prototype.onBeforeWin,function(){episode.isSpecialLevel(application.level.num)||mwf.call(this)}),StatisticAfterWindow.prototype.onOpen=(nwf=StatisticAfterWindow.prototype.onOpen,owf=function(){nwf.call(this);episode.isSpecialLevel(application.level.num)&&this.$el.addClass("levelSpecial")},owf.base=nwf,owf),StatisticBeforeWindow.prototype.onOpen=(rwf=StatisticBeforeWindow.prototype.onOpen,function(){rwf.call(this),episode.isSpecialLevel(this.options.level)&&this.$el.addClass("levelSpecial")}),Application.prototype.getPageSound=(twf=Application.prototype.getPageSound,function(){return"game"==this.get("page")&&episode.isSpecialLevel(this.level.num)&&Config.specialLevels.gamemusic?Config.specialLevels.gamemusic:twf.call(this)}),FailedWindow.prototype.onOpen=(uwf=FailedWindow.prototype.onOpen,function(){uwf.call(this),episode.isSpecialLevel(application.level.num)&&this.$el.addClass("levelSpecial")}),window.mobile||(_.override(AreYouSureExitWindow,{exit:function(){user.set({actionName:"exit game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0}),this.override()}}),_.override(FailedWindow,{play:function(){user.set({actionName:"replay game",actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0}),this.override()}}),_.override(StatisticAfterWindow,{tune:function(e){this.override(e),user.set({actionName:"stars "+this.score.get("stars"),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0})}}),_.override(PowerUp,{run:function(){this.override(),user.set({actionName:"use "+this.get("id").replace("PowerUp",""),actionEpisode:episode.getNumForStatistics(),actionLevel:application.level.num,actionPrice:0})}})),User.prototype.defaultPublication=function(e,t){if(messages[e+"Message"]){var i=RANDOM(messages[e+"Message"]);_.isArray(i)&&(i=i[this.get("gender")]),_doPublication(i,messages[e+"Image"],messages[e+"Caption"][this.get("gender")],void 0,t,e)}else console.log("no publication for: "+e)},User.prototype.needForceNow=function(){var e=episode.get("about").force,t=application.level.num,i=!window.testRun&&e&&e[t]&&!this.skipLevelForceOnce;if(i&&e[t][0]&&e[t][0].powerUpForce){if(episode.isForceEpisode())return!0;(application.playedLevels[episode.absoluteLevelNumber(t)]||episode.scores.findWhere({level:t}))&&(i=!1)}return i},User.prototype.isBlockedByForce=function(){var e=episode.get("about").force,t=application.level.num;return!(e[t]&&!e[t].some(function(e){return!e.freeActions}))&&this.needForceNow()},User.prototype.getCasteId=function(){var e,t=this.get("paymentStats"),i=!1;if(!t)return!((e=Config.castes[0]).daysInGameMax&&user.get("daysInGame")>e.daysInGameMax)&&((0!==e.paid||!user.get("paid"))&&e.id);for(var o=0;o<Config.castes.length;o++){e=Config.castes[o];var a=parseInt(t.paymentsCount),n=parseFloat(t.sumAvg),r=parseFloat(t.sumMax);e.daysInGameMax&&user.get("daysInGame")>e.daysInGameMax||(0===e.paid&&user.get("paid")||e.paymentsCount&&a!=e.paymentsCount||e.paymentsCountMin&&a<e.paymentsCountMin||e.paymentsCountMax&&a>e.paymentsCountMax||e.sumAvgMin&&n<e.sumAvgMin||e.sumAvgMax&&n>e.sumAvgMax||e.sumMax&&r>e.sumMax||(i=e.id))}return i},User.prototype.isFreeHelpAvailable=(Vwf=User.prototype.isFreeHelpAvailable,function(){return!Game.get("buyedMoves")&&Vwf.call(this)}),User.prototype.showGachaWindow=function(){this.set("freeGacha",!0),new GachaWindow({firstPriority:!0})};var Piggybank=Backbone.Model.extend({defaults:{firstTime:!1,enabled:!1,hidden:!1,available:!1,coinsForLevel:0,coinsForSpecialLevel:0,timeStart:0},initialize:function(){this.set("data",new PiggybankData)},load:function(){return this.get("data").fetch()},hide:function(){var e=this;e.set("hidden",!0),setTimeout(function(){e.set("hidden",!1)},6e4)},setupTimer:function(){this.timerId=setInterval(_.bind(this.updateTimer,this),1e3)},updateTimer:function(){this.get("data").get("inited")&&(this.get("available")?this.isExpired()&&this.stop():this.isActive()?this.set("available",!0):this.isCooldown()||this.start())},isBreakable:function(){return this.get("data").get("coins")>=this.get("data").get("minCoins")},isCooldown:function(){return 0<this.getCooldown()},isExpired:function(){return application.getCurrentServerTime()>=this.getFinishTime()},getFinishTime:function(){return this.get("data").get("startedAt")+this.get("data").get("lifetime")},getDuration:function(){return this.get("data").get("lifetime")},getCooldown:function(){return this.get("data").get("startedAt")+this.get("data").get("lifetime")+this.get("data").get("cooldown")-application.getCurrentServerTime()},getTimer:function(){return this.getFinishTime()-application.getCurrentServerTime()},isActive:function(){return!this.isStopped()&&application.getCurrentServerTime()<this.getFinishTime()},isStopped:function(){return this.get("data").get("stoppedAt")>this.get("data").get("startedAt")},break:function(){user.set("coins",new ObscureNumber(user.get("coins")+Number(this.get("data").get("coins")))),this.stop()},getStartTime:function(){return this.get("data").get("startedAt")},start:function(){var e=this.get("data");e.set("settingsId",0),e.set("startedAt",application.getCurrentServerTime()),e.set("stoppedAt",0),e.set("coins",0),e.setSettings(),this.set("available",!0),e.save(),setLocalStorage("piggybankShows",0)},stop:function(){var e=this.get("data");e.set("stoppedAt",application.getCurrentServerTime()),e.set("settingsId",0),this.set("available",!1),e.set("coins",0),e.save()},getStatus:function(){var e=this.get("data").get("coins");return e>=this.get("data").get("maxCoins")?"full":e>=this.get("data").get("minCoins")?"ready":"pending"},income:function(e){if(0<e){var t=this.get("data"),i=t.get("coins");(i+=e)<0?i=0:i>this.get("data").get("maxCoins")&&(i=this.get("data").get("maxCoins")),t.set("coins",i).save()}}}),PiggybankData=Backbone.Model.extend({defaults:{coins:0,startedAt:0,stoppedAt:0,settingsId:0,maxCoins:2e3,minCoins:800,product:"breakPiggybank",inited:!1,lifetime:0,cooldown:0},init:function(e){this.set("coins",e.coins),this.set("startedAt",e.startedAt),this.set("stoppedAt",e.stoppedAt),this.set("settingsId",e.settingsId),this.setSettings(),this.set("inited",!0)},setSettings:function(){var e;this.get("settingsId")&&(e=_.findWhere(Config.piggybank.settings,{id:this.get("settingsId")})),e||(e=this.findSettings(),this.set("settingsId",e.id)),e&&this.set(_.pick(e,_.keys(this.defaults)))},findSettings:function(){for(var e=Config.piggybank,t=0;t<e.settings.length;t++)if(e.settings[t].isActive())return e.settings[t];return!1},fetch:function(){return service("../../../gems/site/service/piggybankget.php").then(_.bind(function(e){this.init(e)},this))},save:function(){callService("../../../gems/site/service/piggybankset.php",_.noop,_.noop,{coins:this.get("coins"),startedAt:this.get("startedAt"),stoppedAt:this.get("stoppedAt"),settingsId:this.get("settingsId")})}}),PiggybankView=Backbone.View.extend({el:"#piggybankBlock",events:{click:"onClick"},initialize:function(){this.listenTo(this.model,"change",this.onModelChange),this.listenTo(this.model.get("data"),"change",this.onModelChange),this.prepare(),episode.on("change",_.bind(function(){$("#main").toggleClass("piggybankAvailable",Boolean(this.model.get("available")))},this)),user.on("change:episode",_.bind(function(){$("#main").toggleClass("piggybankAvailable",Boolean(this.model.get("available")))},this))},prepare:function(){this.$el.toggleClass("enabled",Boolean(this.model.get("available"))),this.model.timerId||this.$el.addClass("noTimer"),$("#main").toggleClass("piggybankAvailable",Boolean(this.model.get("available"))),this.model.get("available")&&!this.model.get("hidden")?this.$el.show():this.$el.hide(),this.resetStatus()},resetStatus:function(){this.$el.removeClass("pending").removeClass("full").removeClass("ready").addClass(this.model.getStatus())},updateTimer:function(){if(this.model.get("available")){var e,t=this.countdown(this.model.getFinishTime());if(0<t)clearTimeout(this.timeout),86400<t?(e=formatTime("%j"+messages.unlimitedLivesTimeStamp[0]+"%G"+messages.unlimitedLivesTimeStamp[1],t),this.timeout=setTimeout(_.bind(this.updateTimer,this),1e4)):(e=formatTime("%H:%i:%s",t),this.timeout=setTimeout(_.bind(this.updateTimer,this),1e3)),this.$(".timer").html(e)}},onModelChange:function(){this.prepare(),this.updateTimer()},countdown:function(e){return e-application.getCurrentServerTime()},render:function(){this.countdown(this.model.get("finishTime"));this.$(".timer").html()},onClick:function(){this.model.trigger("piggybankClicked")}}),PiggybankWindow=TWindow.extend({templateClass:".piggybankWindow_template",onOpen:function(){var e=this.model.get("data").get("coins"),t=Math.round(100*e/this.model.get("data").get("maxCoins"));this.clearStatus(),this.$el.addClass(this.model.getStatus());var i=sprintf(messages.piggybankText[0],{minCoins:this.model.get("data").get("minCoins")});this.$el.find(".textWrapper .first").html(i);var o=this.getProduct().desc.price;"breakPiggybankDiscounted"==this.model.get("data").get("product")?(this.$el.find(".salePrice").html(o),this.$el.find(".openPrice").html(prices.breakPiggybank.desc.price)):this.$el.find(".openPrice").html(o),this.$el.addClass("settings"+this.model.get("data").get("settingsId")),this.$el.find(".openBtn").html(o),this.$el.find(".coinsAmount").html(e),this.$el.find(".line").css("width",t+"%")},clearStatus:function(){this.$el.removeClass("pending").removeClass("full").removeClass("ready"),this.$el.removeClass("openPrice").removeClass("salePrice")},info:function(){new PiggybankInfoWindow({model:this.model}),this.close()},getProduct:function(){return prices[this.model.get("data").get("product")]},break:function(){this.model.isBreakable()&&(this.model.hide(),showBuy(this.getProduct()),this.close())}});PiggybankWindow.prototype.events=_.extend({"click .openBtn":"break","click .infoBtn":"info"},PiggybankWindow.prototype.events);var PiggybankAnimationWindow=TWindow.extend({templateClass:".piggybankAnimationWindow_template",events:{"click .close":"close"},initialize:function(e){TWindow.prototype.initialize.call(this,e)},onOpen:function(){this.$el.find(".coinsText").html(this.options.coins),window.mobile?this.close():setTimeout(_.bind(function(){this.$(".openBox").addClass("openBoxAnimation"),setTimeout(_.bind(function(){this.$(".openBox").addClass("openBoxAnimationDone").removeClass("openBoxAnimation"),this.close()},this),3e3)},this),500)}}),PiggybankInfoWindow=TWindow.extend({templateClass:".piggybankInfoWindow_template",events:{"click .close":"getBack"},onOpen:function(){var e=sprintf(messages.piggybankInfoText,{minCoins:this.model.get("data").get("minCoins"),maxCoins:this.model.get("data").get("maxCoins")});this.$el.find(".bankInfo").html(e)},getBack:function(){new PiggybankWindow({model:this.model}),this.close()}}),PiggybankController={init:function(){if(this._initiated)return this._initiated;var e=Config.piggybank;return e.enabled?(e.timeStart<=application.getCurrentServerTime()&&(e.timeStart=0),this.model=new Piggybank(e),this.view=new PiggybankView({model:this.model}),this.model.view=this.view,this.handleEvents(),this._initiated=this.model.load()):this._initiated=Promise.resolve()},handleEvents:function(){var e=this;this.model.on("piggybankClicked",this.open,this),this.model.on("change:firstTime",function(){this.model.get("firstTime")&&("main"==application.get("page")?this.open():application.once("main",function(){this.open()},this))},this);var t=Config.bonusWorlds.getByName(Config.freeEpisodeName);t&&t.on("completeLevel",function(){user.isAllLevelsCompleted()&&e.onUserChangeLevel()},this),user.on("change:level",this.onUserChangeLevel,this),application.on("change:page",function(e,t){if("main"==t){var i=this.model.get("data").get("coins"),o=getLocalStorage("piggybankShows");i>=this.model.get("data").get("maxCoins")&&(!o||o<2)?(setLocalStorage("piggybankShows",2),this.open()):i>=this.model.get("data").get("minCoins")&&(!o||o<1)&&(setLocalStorage("piggybankShows",1),this.open())}},this)},onUserChangeLevel:function(){1!=user.get("level")&&this.model.get("available")&&this.piggybankIncome()},piggybankIncome:function(){var e=this.getCurrentIncome();this.model.income(e)},getCurrentIncome:function(){var e=user.get("level")-1,t=episode.isSpecialLevel(e),i=this.model.get("coinsForLevel"),o=this.model.get("coinsForSpecialLevel");return t&&o&&(i=o),i},open:function(){window.mobile||new PiggybankWindow({model:this.model})},onPayment:function(e){var t=this;this.init().then(function(){t.model.break()})}};Config.piggybank={version:1,enabled:!0,settings:[{isActive:function(){return user.get("paid")},id:1,lifetime:345600,cooldown:86400,maxCoins:2e3,minCoins:800,product:"breakPiggybank"},{isActive:function(){return!user.get("paid")},id:2,lifetime:172800,cooldown:86400,maxCoins:2e3,minCoins:800,product:"breakPiggybankDiscounted"}],coinsForLevel:100,coinsForSpecialLevel:200,timeStart:0};var ScrollItem=Backbone.View.extend({events:{"mousedown .scroller-back":"back","mousedown .scroller-next":"next",mousedown:"beginTouch"},initialize:function(e){this.orentation=e.orentation||ScrollItem.Orenation.horizontal,this.itemSize=e.itemSize,this.countInPage=e.countInPage,this.scrollIndex=e.index||0,this.$elContainer=this.$(".scroller-container"),this._endTouch=this.endTouch.bind(this),this._mouseOut=this.mouseOut.bind(this),this._move=this.move.bind(this),this.$elContainer.css({left:-this.scrollIndex*this.itemSize+"px"}),this.setColumns(e.columns||0)},setColumns:function(e){this.scrollMax=Math.max(0,e-this.countInPage),0<=this.scrollMax&&this.setIndex(this.scrollIndex)},setIndex:function(e){this.scrollIndex=e,this.scrollIndex<0&&(this.scrollIndex=0),this.scrollIndex>this.scrollMax&&(this.scrollIndex=this.scrollMax),this.$elContainer.css({left:-this.scrollIndex*this.itemSize+"px"}),this.updateScrollButton()},isBack:function(){return 0!==this.scrollIndex},isNext:function(){return this.scrollIndex<this.scrollMax},updateScrollButton:function(){this.$(".scroller-back").toggleClass("enabled",this.isBack()),this.$(".scroller-next").toggleClass("enabled",this.isNext())},scrollTo:function(e){if(!this.scrolling){this.scrolling=!0;this.scrollIndex,this.itemSize;this.scrollIndex=e,this.updateScrollButton(),this.$elContainer.animate({left:-this.scrollIndex*this.itemSize+"px"},500,_.bind(function(){this.scrolling=!1},this))}},back:function(e){this.isBack()&&(this.scrollTo(this.scrollIndex-1),e.stopPropagation())},next:function(e){this.isNext()&&(this.scrollTo(this.scrollIndex+1),e.stopPropagation())},beginTouch:function(e){this.touched=!0,this.prevPosition={x:e.screenX,y:e.screenY},this.delta={x:e.screenX-this.prevPosition.x,y:e.screenY-this.prevPosition.y},this.dt=0,this.time=Date.now(),this.$el.addClass("scrolling"),$(window).bind("mouseup",this._endTouch).bind("mousemove",this._move)},mouseOut:function(){this.timeOut||(this.timeOut=setTimeout(this._endTouch,300))},endTouch:function(e){if(this.$el.removeClass("scrolling"),this.touched&&(this.timeOut&&(clearTimeout(this.timeOut),this.timeOut=null),$(window).unbind("mouseup",this._endTouch).unbind("mousemove",this._move),!this.scrolling)){this.touched=!1,this.speed=this.delta.x/this.dt||0;var t=-Math.round((parseInt(this.$elContainer.css("left"),10)+this.itemSize*this.speed)/this.itemSize);t<0&&(t=0),t>this.scrollMax&&(t=this.scrollMax),this.scrollIndex=t,this.updateScrollButton(),this.$elContainer.animate({left:-this.scrollIndex*this.itemSize+"px"},500)}},move:function(e){this.touched&&(this.timeOut&&(clearTimeout(this.timeOut),this.timeOut=null),this.delta={x:e.screenX-this.prevPosition.x,y:e.screenY-this.prevPosition.y},this.dt=Date.now()-this.time,this.time=Date.now(),this.prevPosition={x:e.screenX,y:e.screenY},this.$elContainer.css({left:parseInt(this.$elContainer.css("left"),10)+this.delta.x+"px"}))}},{Orenation:{vertical:1,horizontal:2}}),RegattaPrizeContentView=TWindow.extend({templateClass:".bonusWorldRewardChainContentWindow_template",events:{"click .close":"close"},onOpen:function(){var e=this.options.prizes,t=this.options.place;this.$(".mWindowTitle").html(messages[Config.bonusWorld.get("name")+"FinalChest"+t]),this.$el.addClass("finalChest"+t),new UserPrizesView({model:e,el:this.$(".prizes.mPrizes")})}}),Shop=Shop||{};Shop.Model="undefined"==typeof Model?Backbone.Model:Model,Shop.Collection="undefined"==typeof Model?Backbone.Collection:Collection,Shop.actions=new Shop.Collection,Shop.init=function(){var t=new Shop.Controller({offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300"},{productId:"coins3000",label:"hit"},{productId:"coins1500"},{productId:"coins8000",label:"best"}]});user.set("coinsAction",null),AddCoinsWindow=function(e){t.open(e)},Application.on("ready",function(){t.init(),application.shop=t;new Shop.Button({el:"#coinsBlock",model:t})})},Application.on("beforeRun",function(){window.mobile||Shop.init()}),Shop.Button=Backbone.View.extend({events:{},initialize:function(){this.listenTo(this.model,"change:action",this.initAction),this.initAction()},initAction:function(){this.$el.toggleClass("specialOfferOn",this.model.hasAction()),this.updateTimer()},updateTimer:function(){if(this.model.hasAction()){var e="",t=this.model.getAction().getTimer();e=t<3600?formatTime("%i:%s",t):formatPeriod(t<86400?Math.round(t/60):60*Math.round(t/60/60)),this.$(".coinsBlockSpecialOffer .timeout").html(e),setTimeout(_.bind(this.updateTimer,this),1e3)}},open:function(){this.model.open()}}),Shop.Controller=Shop.Model.extend({constructor:function(e){this.offers=new Shop.Collection,Shop.Model.call(this,e)},init:function(){this.setOffer(this.get("offers")),this.checkAction(),user.on("change:episode",this.checkAction,this)},showActionWindow:function(){var e=this.getAction(),t="action_"+e.get("name")+"_"+e.get("begin").getTime();!getCookie(t)&&2<=user.get("episode")&&(this.open({firstPriority:!0}),setCookie(t,1,new Date((new Date).getTime()+864e5).toUTCString()))},checkAction:function(){var e=this,t=Shop.actions.findWhere(function(e){return e.isAvailability()});if(this.get("action")!==t)if(this.get("action")&&this.get("action").onStop(),this.set("action",t),this.setOffer(t&&t.get("offers")?t.get("offers"):this.get("offers")),t&&(t.set("controller",this),t.onStart()),t){var i=function(){return _.any(_.pluck(prices,"price"),function(e){return 0<e})};i()?this.showActionWindow():setTimeout(function(){i()&&e.showActionWindow()},1e3),setTimeout(_.bind(this.checkAction,this),1e3*t.getTimer()+1e3)}else{var o=0,a=new Date;Shop.actions.each(function(e){e.get("begin")&&e.get("begin")>a&&(!o||o>e.get("begin"))&&(o=e.get("begin"))}),o&&setTimeout(_.bind(this.checkAction,this),o.getTime()-Date.now())}},checkBought:function(){return new Promise(_.bind(function(t){callService("../../../gems/site/service/checkbought.php",_.bind(function(e){this.getOffers().forEach(function(t){t.set("bought",Boolean(_.find(e,function(e){return e==t.getProductId()}))),t.checkAvailable()}),t()},this))},this))},hasAction:function(){return Boolean(this.get("action"))},getAction:function(){return this.get("action")},setOffer:function(e){this.offers.invoke("off"),this.offers.invoke("stopListening"),this.offers.reset(e.map(this.createOffer,this)),this.offers.forEach(function(e){e.checkAvailable()}),this.checkBought()},createOffer:function(e){return e.cls?new e.cls(e):e.timeAction?new Shop.TimeAction(e):e.productId?new Shop.Offer(e):offer.coins?new Shop.OfferForCoins(e):void 0},getOffers:function(){return this.offers},open:function(e){var t=this.offers.findWhere({productId:"set_novice4"});new Shop.Window(_.extend({model:this,startIndex:t&&t.get("enabled")?1:0},e))},buy:function(e){return e.buy().then(function(){e.set("bought",!0),e.checkAvailable()})}}),Shop.Product=Shop.Model.extend({defaults:{type:null},getType:function(){return this.get("type")},getName:function(){return this.get("name")},getDisplayAmount:function(){return this.get("amount")}}),Shop.BaseOffer=Shop.Model.extend({defaults:{closeAfterBuy:!0,enabled:!0},initialize:function(e){this.products=new Shop.Collection},createView:function(e){return new Shop.OfferView(e)},hasAction:function(){return!1},isAvailable:function(){return!this.get("available")||!this.get("available").once||!1===this.get("bought")},checkAvailable:function(){this.set("enabled",this.isAvailable())},getActionName:function(){},getProductId:function(){},getName:function(){},getLabel:function(){return this.get("label")},getType:function(){return this.get("type")},getProducts:function(){return this.products},getTitle:function(){},getDescription:function(){},getDisplayPrice:function(){},getOldPrice:function(){},getOldDisplayPrice:function(){},buy:function(){return Promise.resolve()}}),Shop.Offer=Shop.BaseOffer.extend({initialize:function(e){Shop.BaseOffer.prototype.initialize.call(this,e);var t=prices[e.productId];if(!t)throw new Error("   ",e.productId);var i=[];"bundle"===t.type?(this.set("type","bundle"),i=t.items.map(function(e){return new Shop.Product(e)})):"good"===t.type?(this.set("type",t.type),i.push(new Shop.Product({type:"good",name:t.goodName,amount:t.workHours}))):(this.set("type",t.type),i.push(new Shop.Product({type:t.type,name:t.name||t.type,amount:t.amount}))),this.products.set(i)},hasAction:function(){return Boolean(this.action)},getActionName:function(){return prices[this.get("productId")].action},getProductId:function(){return prices[this.get("productId")].product},getName:function(){return this.get("productId")},getTitle:function(){return prices[this.get("productId")].desc.product},getDescription:function(){return prices[this.get("productId")].desc.description},getPrice:function(){return prices[this.get("productId")].price},getDisplayPrice:function(){return prices[this.get("productId")].desc.price},getOldPrice:function(){var e=prices[this.get("productId")];if(e.oldPrice)return prices[this.get("productId")].price/100*e.oldPrice;if(e.discount){var t=Math.ceil(prices[this.get("productId")].price/(100-e.discount)*100*100)/100;return 10<t&&(t=Math.trunc(t)),t}return 0},getOldDisplayPrice:function(){var e=this.getOldPrice();if(e)return this.getDisplayPrice().replace(/[^0-9^,^\.^ ]+/,function(e){return'<span class="currency">'+e+"</span>"}).replace(/[0-9\.,]+/,function(){return'<span class="value">'+e+"</span>"})},buy:function(){return new Promise(_.bind(function(i,t){var o=this,a=function e(t){prices[this.get("productId")]===t&&(user.off("buyProduct",e,this),user.off("buyCancel",n,this),i())},n=function e(){user.off("buyProduct",a,o),user.off("buyCancel",e,o),t("Cancel")};user.on("buyProduct",a,this),user.on("buyCancel",n,this),0<prices[this.get("productId")].price?showBuy(prices[this.get("productId")]):(prices[this.get("productId")].queue=!1,socialNetwork.trigger("success_payment",prices[this.get("productId")]),callService("../../../gems/site/service/savebuy.php",_.noop,_.noop,{product:prices[this.get("productId")]}))},this))},getLastPayDate:function(){return this.get("lastPayDate")?new Date(this.get("lastPayDate")):null}}),Shop.OfferForCoins=Shop.BaseOffer.extend({initialize:function(e){Shop.BaseOffer.prototype.initialize.call(this,e),this.set("type","forcoins");var t=e.items.map(function(e){return new Shop.Product(e)});this.products.set(t)},getName:function(){return this.get("name")},getTitle:function(){return""},getDescription:function(){return""},getDisplayPrice:function(){return sprintf(messages.coins,{amount:this.get("coins")})},buy:function(){var e=user.get("coins").get()-this.get("coins");0<=e&&(user.set({coins:new ObscureNumber(e),actionName:this.get("name"),actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:this.get("coins")}),new UserPrizes(this.products.toJSON()).take(this.get("name")));return Promise.resolve()}}),Shop.TimeAction=Shop.Offer.extend({constructor:function(e){var t=application.timeActions.findWhere({name:e.timeAction});e.productId=t.get("product"),Shop.Offer.call(this,e),this.listenTo(t,"change",this.checkAvailable,this)},getTimeAction:function(){return application.timeActions.findWhere({name:this.get("timeAction")})},isAvailable:function(){return!(Shop.Offer.prototype.isAvailable.call(this)&&!this.getTimeAction().isActive())},createView:function(e){return new Shop.TimeActionOfferView(e)}}),Shop.OfferView=Backbone.View.extend({initialize:function(e){this.$tplProduct=e.tplProduct},render:function(){this.$el.addClass("type-"+this.model.getType()),this.$el.addClass(this.model.getName()),this.model.getLabel()&&this.$el.addClass("label-"+this.model.getLabel()),this.model.getActionName()&&this.$el.addClass("action-"+this.model.getActionName()),this.model.getOldPrice()&&(this.$el.addClass(".hasOldPrice"),this.$(".oldPrice").html(this.model.getOldDisplayPrice())),this.$(".mTitle").html(this.model.getTitle()),this.$(".mDescription").html(this.model.getDescription()),this.$(".mBuyBtn").data("offer",this.model.cid);var e,i=this.$(".mProducts"),t=this.model.getProducts(),o=5<t.length;if(o)for(var a=0;a<Config.powerUpIdsOrder.length;++a){var n=t.findWhere({type:"powerUp",name:Config.powerUpIdsOrder[a]});if(!n||e&&e!==n.get("amount")){o=!1;break}e=n.get("amount")}if(t.forEach(function(e){if(!o||"powerUp"!==e.getType()){var t=this.$tplProduct.clone().appendTo(i);t.addClass("type-"+e.getType()).addClass("name-"+e.getName()),"good"===e.getType()?t.find(".mAmount").html(formatPeriod(60*e.getDisplayAmount(),!0)):t.find(".mAmount").html(e.getDisplayAmount())}},this),o){var r=this.$tplProduct.clone().appendTo(i);r.addClass("type-powerUp-group"),r.find(".mAmount").html('<span class="amountLessText">x</span>'+e)}this.$(".mPrice").html(this.model.getDisplayPrice()),this.model.hasAction()&&this.$el.addClass("offer-action")}}),Shop.TimeActionOfferView=Shop.OfferView.extend({render:function(){Shop.OfferView.prototype.render.call(this),this.$el.addClass("timeAction"),this.updateTimer()},updateTimer:function(){clearTimeout(this.timer);var e=this.model.getTimeAction().getTimer();3600<e?(this.$(".mTimerTimeAction").html(formatPeriod(Math.ceil(e/60))),this.timer=setTimeout(_.bind(this.updateTimer,this),1e4)):(this.$(".mTimerTimeAction").html(formatTime("%i:%s",e)),this.timer=setTimeout(_.bind(this.updateTimer,this),1e3))},remove:function(){Shop.OfferView.prototype.remove.call(this),clearTimeout(this.timer)}}),Shop.Window=TWindow.extend({templateClass:".tileShopWindow_template",events:{"click .close":"close","click .infoBlock":"openInfoAction","mousedown .buyBtn":"buy"},onOpen:function(){this.scroller=new ScrollItem({itemSize:232,countInPage:3,index:this.options.startIndex||0,el:this.$el}),this.render(),this.renderAction(),this.updateCoins(),this.listenTo(this.model.getOffers(),"change",this.onChange),this.listenTo(this.model,"change:action",this.renderAction),this.listenTo(user,"change:coins",this.updateCoins);var e=this.$el.find(".mOffers");setTimeout(_.bind(function(){this.scroller.setColumns(Math.ceil(Math.max.apply(Math,e.find(".offer").map(function(e,t){return t.offsetLeft}))/this.scroller.itemSize)),this.scroller.setIndex(this.options.startIndex),this.$el.addClass("animateShow")},this),100),TWindow.prototype.onOpen.call(this)},onChange:function(){var e=this.$el.find(".mOffers");this.render(),setTimeout(_.bind(function(){this.scroller.setColumns(Math.ceil(Math.max.apply(Math,e.find(".offer").map(function(e,t){return t.offsetLeft}))/this.scroller.itemSize))},this),100)},renderAction:function(){this.$el.removeClass(function(e,t){return(t=t.split(" ").filter(function(e){return 0===e.indexOf("shop-action-")&&e})).join(" ")}),this.$el.toggleClass("shop-action",this.model.hasAction()),this.model.hasAction()&&this.$el.addClass("shop-action-"+this.model.getAction().get("name")),this.updateTimer()},updateCoins:function(){this.$(".coinsBlock").removeClass("changed").addClass("changed").find(".amount").html(user.get("coins").get())},updateTimer:function(){this.model.hasAction()&&(this.$(".action-timer").html(formatPeriod(Math.ceil(this.model.getAction().getTimer()/60))),setTimeout(_.bind(this.updateTimer,this),1e3))},render:function(){var t=this.$el.find(".mOffers");this.views&&_.invoke(this.views,"remove");var i=this.$el.find(".invisible .mOffer");this.views=this.model.getOffers().map(function(e){return this.renderOffer(e,t,i)},this).filter(function(e){return e})},renderOffer:function(e,t,i){if(e.get("enabled")){var o=this.$el.find(".invisible .mProduct"),a=e.createView({model:e,el:i.clone().appendTo(t),tplProduct:o});return a.render(),a}},buy:function(e){e.stopPropagation();var t=$(e.target),i=t.parents(".mOffer");i.addClass("purchasing");var o=this,a=this.model.getOffers().get(t.data("offer"));this.model.buy(a).then(function(){a.get("closeAfterBuy")&&o.close()}).finally(function(){i.removeClass("purchasing")})},openInfoAction:function(){if(this.model.get("action")){var e=this;this.close(),this.model.get("action").showInfo().then(function(){new Shop.Window(e.options)})}}}),Shop.Action=Shop.Model.extend({defaults:{enable:!0,begin:null,end:null,episode:null,networks:null},initialize:function(){this.get("begin")&&!_.isDate(this.get("begin"))&&this.set("begin",new Date(this.get("begin"))),this.get("end")&&!_.isDate(this.get("end"))&&this.set("end",new Date(this.get("end")))},isAvailability:function(){if(!this.get("enable"))return!1;var e=1e3*application.getCurrentServerTime();if(this.get("begin")&&this.get("begin").getTime()>e)return!1;if(this.get("end")&&this.get("end").getTime()<e)return!1;if(this.get("networks"))if("phonegap"===network){if(-1===this.get("networks").indexOf(phonegapNetwork))return!1}else if(-1===this.get("networks").indexOf(network))return!1;if(this.get("notNetworks"))if("phonegap"===network){if(-1!==this.get("notNetworks").indexOf(phonegapNetwork))return!1}else if(-1!==this.get("notNetworks").indexOf(network))return!1;return!(this.get("episode")&&this.get("episode").episode>user.get("episode"))},getTimer:function(){return this.get("end")?Math.max(0,Math.round(this.get("end").getTime()/1e3-application.getCurrentServerTime())):0},onStart:function(){},onStop:function(){},showInfo:function(){alert(999)}}),Shop.actions.add(new Shop.Action({begin:"2020-03-12T00:00:00",end:"2020-03-16T00:00:00",name:"unlimitedLifes",enable:!1,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300"},{productId:"coins3000unlimitedLifes",label:"hit"},{productId:"coins1500addCoinsPct"},{productId:"coins8000starField",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2023-05-29T00:00:00",end:"2023-06-04T00:00:00",name:"starField",enable:!1,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300starField"},{productId:"coins3000starField",label:"hit"},{productId:"coins1500starField"},{productId:"coins8000starField",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2023-06-04T00:00:00",end:"2023-06-07T00:00:00",name:"starAndMoves",enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300starAndMoves"},{productId:"coins3000starAndMoves",label:"hit"},{productId:"coins1500starAndMoves"},{productId:"coins8000starAndMoves",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2022-06-04T00:00:00",end:"2022-06-07T00:00:00",name:"unlimitedLifes",enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300unlimitedLifes"},{productId:"coins3000unlimitedLifes",label:"hit"},{productId:"coins1500unlimitedLifes"},{productId:"coins8000unlimitedLifes",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2021-05-09T00:00:00",end:"2021-05-10T00:00:00",name:"plus_50pct_coins",enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300addCoinsPct"},{productId:"coins3000addCoinsPct",label:"hit"},{productId:"coins1500addCoinsPct"},{productId:"coins8000addCoinsPct",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2024-01-19T00:00:00",end:"2024-01-22T00:00:00",name:"plus_25pct_coins",enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300addCoins25Pct"},{productId:"coins3000addCoins25Pct",label:"hit"},{productId:"coins1500addCoins25Pct"},{productId:"coins8000addCoins25Pct",label:"best"}]})),Shop.actions.add(new Shop.Action({begin:"2019-12-11T00:01:00",end:"2019-12-12T00:00:00",name:"fake",networks:["odnoklassniki","test"],enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300"},{productId:"coins3000",label:"hit"},{productId:"coins1500"},{productId:"coins8000",label:"best"}]})),Shop.randomGiftPrizes=[{cls:"prize1",products:[{type:"good",name:"starInField",cssClass:"starInField",amount:1},{type:"powerUp",name:"deleteRowPowerUp",cssClass:"deleteRowPowerUp",amount:1},{type:"coins",cssClass:"coinsbonuswindow",amount:300}]},{cls:"prize2",products:[{type:"powerUp",name:"lightingPowerUp",cssClass:"lightingPowerUp",amount:1},{type:"good",name:"unlimitedLifes",cssClass:"unlimitedLifes",amount:1},{type:"spins",name:"spins",cssClass:"spins",amount:1}]},{cls:"prize3",products:[{type:"powerUp",name:"deleteCellPowerUp",cssClass:"deleteCellPowerUp",amount:1},{type:"good",name:"addThreeMoves",cssClass:"addThreeMoves",amount:1},{type:"powerUp",name:"shufflePowerUp",cssClass:"shufflePowerUp",amount:1}]}],Shop.RandomGiftInfoWindow=TWindow.extend({templateClass:".randomGiftInfoWindow_template",events:{"click .close":"close"},onOpen:function(){for(var e=0;e<this.options.prizes.length;++e)new UserPrizesView({model:new UserPrizes(this.options.prizes[e].products),el:this.$("."+this.options.prizes[e].cls)})}}),Shop.RandomGiftOffer=Shop.Offer.extend({defaults:_.defaults({closeAfterBuy:!0,prizes:Shop.randomGiftPrizes},Shop.Offer.prototype.defaults),initialize:function(e){Shop.Offer.prototype.initialize.call(this,e),this.products.add(new Shop.Product({type:"randomGift",name:"randomGift",amount:1}))},getName:function(){return this.get("productId")+"-random-gift"},hasAction:function(){return!0},getActionName:function(){return"randomGift"}}),Shop.RandomGiftAction=Shop.Action.extend({showInfo:function(){return new Promise(function(e){new Shop.RandomGiftInfoWindow({prizes:Shop.randomGiftPrizes,onClose:e})})},onStart:function(){if(user.on("buyProduct",this.onBought,this),getLocalStorage("boughtRandomAction")){var e=this.get("controller").offers.findWhere({productId:getLocalStorage("boughtRandomAction")});e&&e instanceof Shop.RandomGiftOffer&&this.openSelectRandomGift(e.get("prizes"))}},onStop:function(){user.off("buyProduct",this.onBought,this)},onBought:function(t){var e=this.get("controller").offers.find(function(e){return prices[e.get("productId")]===t});e&&e instanceof Shop.RandomGiftOffer&&(setLocalStorage("boughtRandomAction",e.get("productId")),this.openSelectRandomGift(e.get("prizes")))},openSelectRandomGift:function(e){new SelectPrizeCoinsActionWindow({collection:e})}}),Shop.actions.add(new Shop.RandomGiftAction({begin:"2024-04-13T00:00:00",end:"2024-04-16T00:00:00",name:"randomGiftAction",enable:!0,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300"},{productId:"coins3000",label:"hit",cls:Shop.RandomGiftOffer},{productId:"coins1500",cls:Shop.RandomGiftOffer},{productId:"coins8000",label:"best",cls:Shop.RandomGiftOffer}]})),Shop.actions.add(new Shop.Action({begin:"2020-03-12T00:00:00",end:"2020-03-16T00:00:00",name:"stuffAction",enable:!1,offers:[{productId:"superPack"},{timeAction:"setNovice4"},{productId:"coins300"},{productId:"coins1500starField",label:"hit"},{productId:"coins3000starField"},{productId:"coins8000starField",label:"best"}]}));var ComponentOffer=Shop.Offer.extend({defaults:_.defaults({countPay:0,lastPayDate:null},Shop.Offer.prototype.defaults),initialize:function(e){Shop.Offer.prototype.initialize.call(this,e);var t=prices[e.productId];t&&this.set("product",t.product)}}),ApplicationOffersComponent=BaseApplicationComponent.extend({defaults:{initialized:!1},initialize:function(e){Backbone.Model.prototype.initialize.call(this,e),this.offers=new Backbone.Collection,this.initOffers()},init:function(e){this.set("initialized",!0),this.trigger("offersInitialized",this)},initOffers:function(){for(var e in prices)this.offers.add(new ComponentOffer({productId:e}))},getOffers:function(){return this.offers},getOfferById:function(e){return this.offers.findWhere({productId:e})},getOfferByProduct:function(e){return this.offers.findWhere({product:e})},load:function(e){var o=this;return new Promise(function(t){e.preloader.add(new PreloadTask({name:"loadOffers",parent:"authorization",task:function(e){t(),e()}}))}).then(function(){return service("../../../gems/site/service/checkbought.php").then(function(e){if(e)for(var t in e){var i=o.getOfferByProduct(parseInt(t));i&&i.set({countPay:parseInt(e[t].countPay),lastPayDate:e[t].lastPayDate})}})})}}),ApplicationHelpStuckFriendsComponent=BaseApplicationComponent.extend({id:"stuckFriendsHelp",initialize:function(){application.once("main",this.checkFriendsToHelp,this),application.on("game_win",this.onGameWin,this)},checkFriendsToHelp:function(){var e=friends.pluck("id");if(e&&e.length)return service("../../../gems/site/service/checkstuckfriends.php",{ids:e}).then(function(e){if(0<e.length&&user.getCurrentLevel()>Config.levelToHelpFriends){var i=_.shuffle(e.filter(function(e){return e!==user.get("userId")})).splice(0,Config.maxHelpFriends),t=friends.filter(function(t){return i.some(function(e){return e===t.get("id")})});application.canOpenNotMatterWindow()&&!getCookie("helpfriendswindow")&&new HelpFriendsWindow({friendsToHelp:t})}})},onGameWin:function(){episode.isBonusWorld()||messageCenter.clear("helpReceived")}}),ActionManagerItem=Backbone.Model.extend({init:function(){return Promise.resolve()},getTimer:function(){return 0},getCooldown:function(){return 0},isActive:function(){return!1},getDuration:function(){return 0},isAvailability:function(){return!1},run:function(){return Promise.resolve()},start:function(){return Promise.resolve()},stop:function(){return Promise.resolve()},getStartTime:function(){return 0},isCooldown:function(){return!0}}),ActionManagerTimeAction=ActionManagerItem.extend({initialize:function(e){ActionManagerItem.prototype.initialize.call(this,e),this.startedPack=new TimeAction({duration:this.get("duration"),name:"setNovice4",product:"set_novice4",episode:1,level:14}),application.timeActions.add(this.startedPack)},init:function(){return this.startedPack.isAvailability()?this.startedPack.loadFromServer(!user.get("paid")):Promise.resolve()},isActive:function(){return!!this.startedPack.isAvailability()&&this.startedPack.isActive()},getDuration:function(){return this.startedPack.duration},isAvailability:function(){return this.startedPack.isAvailability()&&0==user.get("paid")},getTimer:function(){return this.startedPack.getTimer()},isCooldown:function(){return this.startedPack.get("beginTime")+this.startedPack.get("duration")+this.get("cooldown")>application.getCurrentServerTime()},getCooldown:function(){return this.startedPack.get("beginTime")+this.startedPack.get("duration")+this.get("cooldown")-application.getCurrentServerTime()},run:function(){return this.startedPack.run(),Promise.resolve()},start:function(){return this.startedPack.restart()},stop:function(){return this.startedPack.set("beginTime",null),Promise.resolve()},getStartTime:function(){return this.startedPack.get("beginTime")}}),ActionManagerPiggybank=ActionManagerItem.extend({init:function(){return PiggybankController.init()},getTimer:function(){return PiggybankController.model.getTimer()},getCooldown:function(){return PiggybankController.model.getCooldown()},isActive:function(){return PiggybankController.model&&PiggybankController.model.isActive()},getDuration:function(){return PiggybankController.model.getDuration()},isAvailability:function(){return PiggybankController.model},run:function(){return PiggybankController.model.setupTimer(),Promise.resolve()},start:function(){return PiggybankController.model.start(),PiggybankController.model.setupTimer(),Promise.resolve()},stop:function(){return PiggybankController.model.stop(),Promise.resolve()},getStartTime:function(){return PiggybankController.model.getStartTime()},isCooldown:function(){return PiggybankController.model.isCooldown()}}),ActionManager=Backbone.Model.extend({defaults:{episode:1,level:14,action:!1,startedAt:0},initialize:function(){this.actions=new Backbone.Collection([new ActionManagerTimeAction({id:0,duration:172800,cooldown:86400}),new ActionManagerPiggybank({id:1})]),this.checkAvailable()},checkAvailable:function(){user.get("episode")<this.get("episode")||user.get("episode")==this.get("episode")&&user.get("level")<this.get("level")?this.listenToOnce(user,"change:level",this.checkAvailable,this):this.run()},loadFromserver:function(){return service("../../../gems/site/service/actionmanagerget.php").then(_.bind(function(e){this.set(e)},this))},run:function(){this.loadFromserver().then(_.bind(function(){return Promise.all(this.actions.map(function(e){return e.init()}))},this)).then(_.bind(function(){var e=this.getCurrentAction();return e&&e.isActive()?e.run():e&&e.isCooldown()?(service("../../../gems/site/service/actionmanagerset.php",{startedAt:e.getStartTime()+e.getCooldown()+e.getDuration()}),void setTimeout(_.bind(this.changeAction,this),1e3*e.getCooldown())):this.changeAction()},this)).then(_.bind(function(){var t=this.getCurrentAction();this.actions.forEach(function(e){t!==e&&e.stop()})},this))},getCurrentAction:function(){return this.actions.get(this.get("action"))},changeAction:function(){var e=this.getCurrentAction(),t=-1,i=this.actions.length;e&&(t=this.actions.indexOf(e)),++t;for(var o=0;o<i;++o)if((e=this.actions.at((t+o)%i))&&e.isAvailability()){this.set("action",e.get("id"));break}return e.start().then(_.bind(function(){return this.save()},this))},save:function(){var e=this.getCurrentAction();e&&service("../../../gems/site/service/actionmanagerset.php",{startedAt:e.getStartTime(),action:e.get("id")})}});Application.on("ready",function(){Config.disableActionManager||(application.actionManager=new ActionManager)});var BonusWorldBackForce=BaseForce.extend({defaults:{view:BaseForceView,needPage:"main",world:"",name:"",addCssClass:"forceBlackout",addZIndex:!0,additionalHeight:10},initialize:function(e){e.world&&(this.set("name",e.world.get("name")+"BackForce"),messages.ForceTexts[this.get("name")]=messages[e.world.get("name")+"FlowerCare"]),BaseForce.prototype.initialize.call(this,e)},needShow:function(){var e=this.get("world");return!e.get("finished")&&(!(user.get("specialworldprogress")>e.get("levelsInEpisode"))&&(!(user.get("specialworldprogress")<=5)&&getLocalStorage(e.get("name")+"BackForceShown")!==e.get("version")))},done:function(){setLocalStorage(this.get("world").get("name")+"BackForceShown",this.get("world").get("version")),application.trigger("shownForces",this)},getEl:function(){return $(".bonusWorldBlock")},eventFunction:function(){setTimeout(_.bind(function(){this.trigger("event")},this),700)}}),FastForce=Backbone.Model.extend({defaults:{forceId:10},init:function(){var e=this;return this.prize=new UserPrizes(this.get("prize").products),Promise.resolve().then(function(){return e.get("activator").init(e)})},activate:function(){this.run()},needActivate:function(){for(var e=this.get("rules"),t=0;t<e.length;++t)if(!e[t]())return!1;return!user.isShownForces(this.get("forceId"))},getCurrentLevel:function(){return this.get("level")},run:function(){if(this.needActivate())return console.log("[FastForce] run"),this.processForce()},processForce:function(){user.setShownForces(this.get("forceId")),this.onTakePrize()},onTakePrize:function(){this.prize.take()}}),ForceLevel=Backbone.Model.extend({defaults:{forceId:10,beforeWindowClass:"StartWindow",winWindowClass:"WinWindow"},init:function(e){var t=this;return this.views=application.views,this.set("stateName",this.get("name")),this.prize=new UserPrizes(this.get("prize").products),Promise.resolve().then(function(){return t.get("activator").init(t)})},activate:function(){var e=this;this.waitQueue().then(function(){e.run()})},waitQueue:function(){return application.windows.anyVisibleWindow()?application.windows.runAfterCloseAll():Promise.resolve()},needActivate:function(){for(var e=this.get("rules"),t=0;t<e.length;++t)if(!e[t]())return!1;return!user.isShownForces(this.get("forceId"))},getCurrentLevel:function(){return this.get("level")},onOpenForceEpisode:function(){var t=this;return new Promise(function(e){episodeView.changeEpisode(t.get("episode"),e)})},onCloseForceEpisode:function(){return new Promise(function(e){episodeView.changeEpisode(user.get("episode"),e)})},onStartLevel:function(){var e=this;return Promise.resolve().then(function(){return application.emit("startLevel")}).then(function(){gameView.start(e.getCurrentLevel()),application.once("beforeGameStart",function(){application.once("winForceLevel",e.onWinLevel,e),application.once("game_fail",e.onFailLevel,e)})})},run:function(){if(this.needActivate())return console.log("[ForceLevel] run"),this.processForce()},processForce:function(){var e=this;return Promise.resolve().then(function(){return e.onBeforeRun()}).then(function(){return e.onStartLevel()}).catch(function(e){console.error("[ForceLevel]",e)})},onBeforeRun:function(){var e=this;return this.emit("beforeRun").then(function(){return e.openBeforeWindow()}).then(function(){return e.onOpenForceEpisode()})},onWinLevel:function(e){var t=this;return this.emit("win").then(function(){return t.onTakePrize()}).then(function(){return t.onCloseForceEpisode()}).then(function(){return user.setShownForces(t.get("forceId"))}).then(function(){return t.openWinWindow()})},onFailLevel:function(e){var t=this;this.emit("fail").then(function(){return t.onCloseForceEpisode()})},onTakePrize:function(){this.prize.take()},openBeforeWindow:function(){var t=this;return new Promise(function(e){new StartLevelForceWindow({closeResolver:e,prize:t.prize,force:t})}).then(function(){application.windows.closeAll()})},openWinWindow:function(){var t=this;return new Promise(function(e){new WinLevelForceWindow({closeResolver:e,prize:t.prize,force:t})})}}),ForceLevelComponent=Backbone.Model.extend({id:"forceLevel",initialize:function(){return Promise.all([this.get("forces").map(function(e){return e.init()})])}}),EventActivator=function(){function i(e,t){_classCallCheck(this,i),this.eventName=e,this.owner=t}return _createClass(i,[{key:"init",value:function(e){return(this.owner||application).on(this.eventName,e.activate,e),!0}}]),i}(),WithParamActivator=function(){function i(e,t){_classCallCheck(this,i),this.paramName=e,this.paramsSrc=t}return _createClass(i,[{key:"init",value:function(t){var i=this;return application.once("main",function(){var e=i.paramsSrc?i.paramsSrc:application.cmp("outerParams");e&&e.hasParam(i.paramName)&&t.activate()}),!0}}]),i}(),BaseDispatcherStrategy=function(){function t(e){_classCallCheck(this,t),this.options=e}return _createClass(t,[{key:"activate",value:function(){var t=this;return this.checkRules().then(function(e){return e?t.onSuccess():t.onFail()}).catch(function(e){console.error(e)})}},{key:"onSuccess",value:function(){}},{key:"onFail",value:function(){}},{key:"checkRules",value:function(){return _checkRules(this.options.rules)}}]),t}(),PrizesStrategy=function(e){_inherits(i,BaseDispatcherStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onSuccess",value:function(){var e=new UserPrizes(UserPrizes.convertFromCocos(this.options.prize));new AnimatedPrizesWindow({prizes:e,firstPriority:!0,world:episode.get("num"),message:!1})}}]),i}(),LivesStrategy=function(e){_inherits(i,BaseDispatcherStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onSuccess",value:function(){Config.maxLives=this.options.premiumMaxLives,user.updateMaxLives(),$("#livesBlock").addClass("numericalType")}},{key:"onFail",value:function(){Config.maxLives=this.options.defaultMaxLives,user.updateMaxLives(),$("#livesBlock").removeClass("numericalType")}}]),i}(),ViaLinkPrizeStrategy=function(e){_inherits(i,BaseDispatcherStrategy);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"loadData",value:function(){var e,t=this.options.paramSrc;return t&&t.hasParam(this.options.actionKeyParam)&&(e=t.getParam(this.options.actionKeyParam)),e?service("../../../gems/site/service/requestlinkprize.php",{actionKey:e}):Promise.resolve({reason:"No action key"})}},{key:"onSuccess",value:function(){return this.loadData().then(function(e){e&&(e.prizes?new AnimatedPrizesWindow({prizes:new UserPrizes(UserPrizes.convertFromCocos(JSON.parse(e.prizes))),world:"prizeLink",message:"congratulations"}):"taken"!==e.reason&&new PrizeLinkSorryWindow)})}}]),i}(),DispatcherComponent=BaseApplicationComponent.extend({defaults:{item:[]},initialize:function(){var e,t=_createForOfIteratorHelper(this.get("items"));try{for(t.s();!(e=t.n()).done;){var i=e.value;i.activator.init(i.strategy)}}catch(e){t.e(e)}finally{t.f()}}}),PaymentSubscriptionWindowShield=Backbone.Model.extend({defaults:{targetWindowName:"",owner:null,enabled:!1},initialize:function(e){this.set("targetWindowName",e)},init:function(e){this.owner=e,this.enableByOwner(),this.listenTo(this.owner,"change:enabled",this.enableByOwner)},enableByOwner:function(){if(this.owner.get("enabled"))return this.set("enabled",!0),void this.listenTo(application,this.get("targetWindowName")+"Opened",this.onShowTargetWindow);this.set("enabled",!1),this.stopListening(application)},onButtonClick:function(e){e.close(),this.owner.showWindow()},onShowTargetWindow:function(){var e=application.windows.getById(this.get("targetWindowName"));this.renderInWindow(e)},renderInWindow:function(e){var t=messages[this.owner.get("actionName")],i=$(".invisible .paymentSubscriptionShield").clone();i.find(".description").html(t[this.get("targetWindowName")+"_shieldDescription"]),i.addClass(this.owner.get("productId"));var o=i.find(".buyButton");o.addClass("free"),o.find(".buttonText").html(t[this.get("targetWindowName")+"_shieldTryFree"]),i.on("click",_.bind(this.onButtonClick,this,e)),e.$el.append(i),e.$el.addClass("paymentSubscriptionSale")}}),PaymentSubscriptionAddLivesShield=PaymentSubscriptionWindowShield.extend({renderInWindow:function(e){PaymentSubscriptionWindowShield.prototype.renderInWindow.call(this,e),e.$el.find(".paymentSubscriptionShield").find(".label").html(messages[this.owner.get("actionName")].livesLabel),e.$el.find(".pirateDecorator").addClass(this.owner.get("productId")),e.$el.append($('<div class="light"></div>'))}}),PaymentSubscriptionPrizeTimerShield=PaymentSubscriptionWindowShield.extend({renderInWindow:function(e){var t=this,i=messages[this.owner.get("actionName")],o=$(".invisible .paymentSubscriptionShield").clone();o.find(".description").html(i.rewardTimerDescription),o.addClass("rewardTimer"),this.$completeButton=o.find(".buyButton"),this.$completeButton.toggleClass("hidden",!0),this.$completeButton.html(i.takeReward),this.$timer=o.find(".timer"),this.updateState(this.$timer,this.$completeButton);var a=setInterval(function(){t.updateState(t.$timer,t.$completeButton)},1e3);this.listenToOnce(e,"close",function(){clearInterval(a)}),this.$completeButton.on("click",_.bind(this.onButtonClick,this,e)),e.$el.append(o),e.$el.addClass("paymentSubscriptionTimer")},updateState:function(){var e=68400-application.getCurrentServerTime()%86400;user.get("everydayBonusCollected")?this.$timer.html(formatTime("%H:%i:%s",e)):this.$completeButton.toggleClass("hidden",!1)},onButtonClick:function(e){e.close(),Config.everydayBonus&&!user.get("everydayBonusCollected")&&user.get("level")>=Config.everydayBonus.level&&new EverydayBonusWindow({seria:user.get("everydayBonusSeria")})}}),PaymentSubscriptionWindow=TWindow.extend({templateClass:".paymentSubscriptionWindow_template",onOpen:function(){if(this.renderPrizes(),this.options.offerIds){var e,t=_createForOfIteratorHelper(this.options.offerIds);try{for(t.s();!(e=t.n()).done;){var i=e.value,o=prices[i];o&&this.addBuyButton({productId:i,price:o.desc.price,tryFree:Boolean(o.trial_period)})}}catch(e){t.e(e)}finally{t.f()}}},addBuyButton:function(e){var t=this.$el.find(".controls"),i=this.$(".invisible .buyButtonBlock").clone(),o=i.find(".buyButton"),a=i.find(".label"),n=messages.subscription_premium;i.addClass(e.productId),t.append(i),o.on("click",_.bind(this.buy,this,e.productId)),o.toggleClass("free",e.tryFree),a.html(e.tryFree?n.freeLabel:n[e.productId]),o.html(e.tryFree?n.tryFree:e.price)},renderPrizes:function(){for(var e=new UserPrizes(this.options.prize.products),t=0;t<e.length;t++){var i=e.at(t),o=this.$(".invisible .onePrize").clone();"good"===i.get("type")?o.find(".amount").html(formatPeriod(60*i.get("amount"))):o.find(".amount").html(i.get("amount")),o.addClass(i.get("cssClass")),this.$(".rewardBlock .prizes").append(o)}},buy:function(e){return this.close(),socialNetwork.showPaymentSubscription(e)}}),ShowAction=Backbone.Model.extend({defaults:{actionName:"dummy",activator:null,hideEvent:"dummy",forced:!1,window:null,windowOptions:{},offerIds:[],shieldForWindows:[],rules:[],enabled:!1,shown:!1},activate:function(){var t=this;return this.tryActivate().then(function(e){e||t.listenTo(application,"change:page",function(){t.tryActivate()})})},tryActivate:function(){var t=this;return this.checkActivate().then(function(e){return!!e&&(t.stopListening(application,"change:page"),t.prepare())})},checkActivate:function(){return this.get("enabled")?_checkRules(this.get("rules")):Promise.resolve(!1)},prepare:function(){var e,t=this,i=_createForOfIteratorHelper(this.get("shieldForWindows"));try{for(i.s();!(e=i.n()).done;){e.value.init(this)}}catch(e){i.e(e)}finally{i.f()}return this.listenTo(application,this.get("hideEvent"),this.disable),this.listenTo(application,this.get("showWindowEvent"),function(){t.waitQueue().then(function(){return t.showWindow()})}),!0},setEnabled:function(e){this.set("enabled",e)},canShowNow:function(){return!!this.get("forced")||!application.windows.anyWindowOpen()&&(!application.get("waitWindowLoading")&&"main"===application.get("page"))},waitQueue:function(){var t=this;return this.canShowNow()?Promise.resolve():new Promise(function(e){t.listenTo(application,"change:page windowsClosed",function(){t.canShowNow()&&(t.stopListening(application),e())})})},showWindow:function(){this.set("shown",!0);var e=this.get("window");e&&(this.get("forced")&&application.windows.closeAll(),new e(this.get("windowOptions")))},disable:function(){this.set("enabled",!1)}}),ShowActionComponent=BaseApplicationComponent.extend({id:"actionShowerComponent",items:[],initialize:function(){var e,t=_createForOfIteratorHelper(this.get("items"));try{for(t.s();!(e=t.n()).done;){var i=e.value;i.get("activator").init(i)}}catch(e){t.e(e)}finally{t.f()}},getAction:function(t){return this.get("items").find(function(e){return e.get("actionName")===t})}}),BaseInterstitialAd=Backbone.Model.extend({init:function(){return Promise.resolve(!0)},checkAdBlock:function(){var e=$('<div id="showAd">').css({width:1,height:1}).appendTo($(".wrapper")),t=!e.is(":visible");return e.remove(),t},load:function(){throw new Error('You must implement this method "load"')},isHasAdvert:function(){throw new Error('You must implement this method "isHasAdvert"')},show:function(){throw new Error('You must implement this method "show"')}}),InterstitialAdStrategy=Backbone.Model.extend({defaults:{provider:null,rules:[]},init:function(e){var t=this;return Promise.resolve().then(function(){return!t.get("provider")||t.get("provider").init(e)}).then(function(e){t.active=e})},getProvider:function(){return this.get("provider")},isAvailability:function(){if(!this.active)return!1;for(var e=this.get("rules"),t=0;t<e.length;++t)if(!e[t]())return!1;return!0}}),InterstitialAd=Backbone.Model.extend({defaults:{tag:"none",activator:null,strategies:[]},init:function(t,e){var i=this;return this.component=e,Promise.resolve().then(function(){return i.get("activator").init(i)}).then(function(){return Promise.all(i.get("strategies").map(function(e){return e.init(t)}))})},findStrategy:function(){for(var e=this.get("strategies"),t=0;t<e.length;++t)if(e[t].isAvailability())return e[t];return null},activate:function(){var t=this,e=this.findStrategy();if(e){var i=e.getProvider();if(i)return Promise.resolve().then(function(){return i.load()}).then(function(){return i.isHasAdvert()}).then(function(e){if(e)return Promise.resolve().then(function(){return i.load()}).then(function(){return i.show()}).then(function(){return t.component.trigger("showed",t)})}).catch(function(e){cc.warn("[InterstitialAd]",e)})}}}),InterstitialAdComponent=BaseApplicationComponent.extend({defaults:{adverts:null,active:!0,id:"interstitial"},initialize:function(){var t=this;this.get("adverts").map(function(e){return e.init(application,t)})}}),TestInterstitialAd=BaseInterstitialAd.extend({load:function(){return Promise.resolve()},isHasAdvert:function(){return Promise.resolve(!0)},show:function(){return new Promise(function(e){setTimeout(function(){alert(" "),e()},5e3)})}}),OKInterstitialAd=BaseInterstitialAd.extend({init:function(e){return Promise.resolve(!0)},load:function(){return console.log("[interstitial] Advert Loaded"),this._support=!this.checkAdBlock(),Promise.resolve(!0)},isHasAdvert:function(){return Promise.resolve(this._support)},show:function(){return console.log("[interstitial] Before show"),new Promise(function(o,a){socialNetwork.on("showAd",function e(t,i){"ok"===t?"ad_shown"===i&&(o(!0),socialNetwork.off("showAd",e)):(a(i),socialNetwork.off("showAd",e))}),FAPI.UI.showAd()}).catch(function(e){console.warn("[Interstitial] Ad has not been shown.",e)})}}),OKBannerAd=BaseInterstitialAd.extend({init:function(e){var o=this;return this.bannerPosition="top",FAPI.invokeUIMethod("getBannerFormats"),socialNetwork.on("getBannerFormats",function(e,t){if("ok"===e){var i=JSON.parse(t);return _.include(i.supported.vertical_outer,"right")?void o.initBannerToTheRight():void o.initBanner()}o.initBanner()}),Promise.resolve(!0)},initBanner:function(){var i=this;FAPI.invokeUIMethod("requestBannerAds"),socialNetwork.on("requestBannerAds",function(e,t){"ok"===e&&"ad_loaded"===t&&(i._bannersFind=!0,i._show())}),socialNetwork.on("showBannerAds",function(e,t){"ok"===e&&"true"===t&&"top"==i.bannerPosition&&$("#out-banners").addClass("showBanner")})},initBannerToTheRight:function(){var i=this;FAPI.invokeUIMethod("setBannerFormat","vertical_outer"),socialNetwork.on("setBannerFormat",function(e,t){("ok"===e||"event"===e&&"set_banner_format_success"===t)&&(i.bannerPosition="right"),i.initBanner()})},load:function(){return this.isHasAdvert()},isHasAdvert:function(){return Promise.resolve(!this.checkAdBlock())},_show:function(){return this._shown&&this._bannersFind&&FAPI.invokeUIMethod("showBannerAds",this.bannerPosition),Promise.resolve(!0)},show:function(){return console.log("[interstitial] FAPI Before show"),this._shown=!0,this._show()}}),VKInterstitialAd=BaseInterstitialAd.extend({init:function(e){return Promise.resolve(!0)},load:function(){return this.isHasAdvert()},isHasAdvert:function(){var t=this;return Promise.resolve("undefined"!=typeof vkBridge).then(function(e){return e&&vkBridge.supports("VKWebAppShowNativeAds")}).then(function(e){return e&&!t.checkAdBlock()}).then(function(e){return e&&vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"reward"}).then(function(e){return e.result})})},show:function(){return console.log("[interstitial] Before show"),vkBridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"}).then(function(e){return e.result}).catch(function(e){return console.error("[interstitial] VkBridgeAdvertProvider show "+JSON.stringify(e)),!1})}}),VKBannerAd=BaseInterstitialAd.extend({init:function(e){return Promise.resolve(!0)},load:function(){return this.isHasAdvert()},isHasAdvert:function(){var t=this;return Promise.resolve("undefined"!=typeof vkBridge).then(function(e){return e&&vkBridge.supports("VKWebAppShowBannerAd")}).then(function(e){return e&&!t.checkAdBlock()})},show:function(){return console.log("[interstitial] VKBannerAd Before show"),vkBridge.send("VKWebAppShowBannerAd",{banner_location:"top",can_close:!1}).then(function(e){return e.result}).catch(function(e){return console.error("[interstitial] VKBannerAd show "+JSON.stringify(e)),!1})}});function createInterstitialAdComponent(){var e=null,t=null;switch(network){case"test":e=new TestInterstitialAd;break;case"odnoklassniki":e=new OKInterstitialAd,t=new OKBannerAd;break;case"vkontakte":e=new VKInterstitialAd,t=new VKBannerAd}var i=rules.CommonRule,o=rules.EveryTimePerSessionRule,a=rules.NotFullScreen;return new InterstitialAdComponent({adverts:[new InterstitialAd({tag:"startLevel",activator:new EventActivator("preloadLevel"),strategies:[new InterstitialAdStrategy({provider:e,rules:[function(){return Config.interstitialEnable},a(),i({minLevel:30,paid:0}),o(3)]})]}),new InterstitialAd({tag:"gameBanner",activator:new EventActivator("ready"),strategies:[new InterstitialAdStrategy({provider:t,rules:[function(){return Config.interstitialEnable},a()]})]})]})}var LevelForceWindow=TWindow.extend({templateClass:".levelForceWindow_template",closeResolver:null,renderPrizes:function(){for(var e=this.options.prize,t=0;t<e.length;t++){var i=e.at(t),o=this.$(".invisible .onePrize").clone();"good"===i.get("type")?o.find(".amount").html(formatPeriod(60*i.get("amount"))):o.find(".amount").html(i.get("amount")),o.addClass(i.get("cssClass")),this.$(".descriptionBlock .prizes").append(o)}}}),WinLevelForceWindow=LevelForceWindow.extend({templateClass:".levelForceWindow_template",closeResolver:null,events:{"click .closeBtn":"onClose"},onOpen:function(){LevelForceWindow.prototype.onOpen.call(this),this.$el.addClass(this.options.force.get("winWindowClass")),this.$(".descriptionText").html(messages.deleteRowPowerUp.winForceWindowDescription),this.$(".closeBtn").html(messages.takePrize),this.renderPrizes()},onClose:function(){var e=this.options.closeResolver;e&&(e(),this.close())}}),StartLevelForceWindow=LevelForceWindow.extend({templateClass:".levelForceWindow_template",closeResolver:null,events:{"click .closeBtn":"onPlay"},onOpen:function(){LevelForceWindow.prototype.onOpen.call(this),this.$el.addClass(this.options.force.get("beforeWindowClass")),this.$(".descriptionText").html(messages.deleteRowPowerUp.forceWindowDescription),this.$(".closeBtn").html(messages.play),this.renderPrizes()},onPlay:function(){var e=this.options.closeResolver;e&&(e(),this.close())}}),xJf,CJf,DJf,JJf,KJf,VJf,WJf,XJf;Application.on("ready",function(){var e;"undefined"!=typeof createjs&&(createjs&&createjs.Sound&&createjs.Sound.activePlugin&&createjs.Sound.activePlugin.context&&"suspended"==createjs.Sound.activePlugin.context.state&&void 0!==TWindow&&(TWindow.prototype.close=(e=TWindow.prototype.close,function(){e.call(this),createjs.Sound.activePlugin.context.resume(),TWindow.prototype.close=e})))}),SlidePowerUpsView.prototype.onMoveCursor=function(e){this.wasMouseMove=!0,this.updateCell(e),e.originalEvent&&e.originalEvent.touches&&(e=e.originalEvent.touches[0]),this.model.powerUpCursor.alignTo({left:e.pageX,top:e.pageY}).show()},void 0!==TournamentPrizeWindow&&(TournamentPrizeWindow.prototype.onClose=function(){user.trigger("tournamentfinished");var t=user.get("coins");_.each(this.options.prize,_.bind(function(e){"coins"==e.type&&(t=new ObscureNumber(t.get()+e.amount)),"powerUp"==e.type&&user.setPowerUpAmount(e.name,user.getPowerUpAmount(e.name)+e.amount,!0)},this)),user.set({powerUps:user.calcPowerUps(),coins:t})}),BossCell.prototype.animateRemoval=function(e){Game.set("score",Game.get("score")+GameScores.boss),Game.trigger("showFieldPoints",this.$div,GameScores.boss,"explodeBossCell"),Game.trigger("removeBoss"+this.name),this.playRemoveSound(),this.renderLife(),this.playRemoveAnimation(e)},Decorator.prototype.isRemovable=function(){return!1!==this.removable},FriendsPanelView.prototype.fillFriendCard=(xJf=FriendsPanelView.prototype.fillFriendCard,function(e){var t=xJf.call(this,e);return t.addClass("showMedal"+1e3*Math.floor((e.get("fullLevel")-1)/1e3)),t}),void 0!==BonusWorldForce&&(BonusWorldForce.prototype.needShow=function(){return getLocalStorage(this.get("world").get("name")+"BonusWorldForceShown")!==this.get("world").get("version")},BonusWorldForce.prototype.done=function(){setLocalStorage(this.get("world").get("name")+"BonusWorldForceShown",this.get("world").get("version")),application.trigger("shownForces",this)}),_.extend(FailedWindow.prototype.events,{"click .showAd":"showAd"}),FailedWindow.prototype.showAd=function(){this.onClose=function(){var e=this.options;e=_.extend(e,{noAnimation:!0}),Config.rewardAdForLives.showAd(_.once(function(){user.set({lives:Math.min(user.get("lives")+1,Config.maxLives),actionName:"lifes for ad",actionEpisode:user.get("episode"),actionLevel:user.get("level"),actionPrice:0},{validate:!0}),new FailedWindow(e)}),function(){new FailedWindow(e)},this)},this.close()},FailedWindow.prototype.onOpen=(CJf=FailedWindow.prototype.onOpen,function(){CJf.call(this),episode.isBonusWorld()&&Config.bonusWorld.hasOwnLives()?this.$el.toggleClass("withLifes",Config.bonusWorld.hasLives()):(this.$el.toggleClass("withLifes",0<user.get("lives")||goods.checkProduct("unlimitedLifes")),Config.rewardAdForLives&&0===user.get("lives")&&!goods.checkProduct("unlimitedLifes")&&this.$el.toggleClass("advert",Config.rewardAdForLives.checkAvailable()))}),FigureView.prototype.stop=(DJf=FigureView.prototype.stop,function(){this.timeManager.lastCallTimeouts(),DJf.call(this)}),TimeManager.prototype.lastCallTimeouts=function(){for(var e=this.timeoutsHead.next;!1!==e;)e.callback&&e.callback(),e=e.next;this.timeoutsHead.next=!1},PreloadTask.prototype.done=function(){this.trigger("done",this)},void 0!==MessageCenterWindow&&(MessageCenterWindow.prototype.giftBuy=function(e){var t=$(e.currentTarget).parents(".playerBlock"),i=Gifts.findGiftById(t.data("gift"));if("coins"==i.buyType&&user.get("coins")>=Number(i.price)){var o=this.collection.where({type:"birthdayCongrate",userFrom:t.data("friend")});o&&this.collection.remove(o)}this.collection.length&&new MessageCenterWindow({collection:this.collection,firstPriority:!0}),Gifts.giftForUser(i,t.data("friend")),this.close()}),EpisodeLockedWindow.prototype.renderLocked=(JJf=EpisodeLockedWindow.prototype.renderLocked,function(){JJf.call(this),1==user.get("episode")&&this.$(".close").hide()}),SwapMoveController.changeSuggest=(KJf=SwapMoveController.changeSuggest,function(e,t){if(SwapMoveController.help&&(SwapMoveController.help.first.$div.removeClass("suggest"),SwapMoveController.help.second.$div.removeClass("suggest"),SwapMoveController.help.arrows.length&&SwapMoveController.help.arrows.fadeOut(300,function(){this.remove()}),SwapMoveController.help=null),Game._animation)return!1;KJf(e,t)}),Decorator.prototype.isArrowAllowed=function(){return-1==_.indexOf(["greedypirate","hunter","crab2"],this.get("name"))&&1==this.get("level")},SwapMoveController.changeSelected=function(e,t){var i=Game.previous("selected");void 0!==i&&i.$div.find(".selectedCellBg").remove();var o="touchend.swapmove";is_android_browser||(o+=" mouseup.swapmove"),$("#canvas").on(o,_.once(function(){if(void 0!==(i=Game.previous("selected"))&&i.$div.find(".selectedCellBg").remove(),void 0!==(t=Game.get("selected"))){var e=FigureView.createByTemplate(".invisible .selectedTemplate",[]);application.playSound("changeSelected"),t.$div.append(e)}}))},BonusLevelTimeoutWindow.prototype.canOpenNow=function(){return!gameView.tasksView.model.get("completed")},EpisodeView.prototype.backFromComingSoonEpisode=(VJf=EpisodeView.prototype.backFromComingSoonEpisode,function(){VJf.call(this),$("#main").removeClass("comingSoon")}),EpisodeView.prototype.comingSoonEpisode=(WJf=EpisodeView.prototype.comingSoonEpisode,function(){WJf.call(this),$("#main").addClass("comingSoon")}),PowerUpButtonView.prototype.use=(XJf=PowerUpButtonView.prototype.use,function(e){Game.get("moves").get()<=0||XJf.call(this,e)}),Episode.prototype.getNumForStatistics=function(){var e=this.get("num");return Config.bonusWorldsEpisodesNum&&_.isString(e)&&Config.bonusWorldsEpisodesNum[e]?Config.bonusWorldsEpisodesNum[e]:_.isString(e)?user.get("episode")+1e4:e};var mixTouchEvents=function(a,n){return _.each(a,function(t,e){var i=function(e){var t={mousedown:"touchstart",click:"touchend",mouseup:"touchend",mousemove:"touchmove"},i=e;for(var o in t)i=i.replace(o,t[o]);if(i!=e)return i}(e);if(void 0!==i&&(void 0===a[i]&&n[t])){var o=t+"_touch";a[i]=o,n[o]=function(e){n[t].apply(this,_.toArray(arguments)),e.preventDefault()}}}),a},Touchable=function(e){return e.prototype.events=mixTouchEvents(e.prototype.events,e.prototype),e};void 0!==Touchable&&(Touchable(ScrollItem),Touchable(ToastView),Touchable(TWindow),Touchable(OutOfMovesWindow),Touchable(BombExplodeWindow),Touchable(StatisticBeforeWindow),Touchable(StatisticAfterWindow),Touchable(NewEpisodeWindow),Touchable(FailedWindow),Touchable(PrizeDoneWindow),Touchable(PrizeDoneOneOfManyWindow),Touchable(BonusLevelDoneWindow),Touchable(BonusLevelInfoWindow),Touchable(BonusLevelBeginWindow),Touchable(BonusLevelTimeoutWindow),Touchable(BonusLevelTimeAddWindow),Touchable(BonusLevelFailWindow),Touchable(HappyBirthdayWindow),Touchable(AreYouSureExitWindow),Touchable(HelpFriendsWindow),Touchable(LevelOvertakenWindow),Touchable(NoCoinsWindow),Touchable(TasksWindow),Touchable(BuyPowerUpsWindow),Touchable(ApplicationBaseView),Touchable(ApplicationView),Touchable(GameBaseView),Touchable(ThreeInRowBaseView),Touchable(EpisodeView),Touchable(ForceView),Touchable(PrizesView),Touchable(MapBonusLevelView),Touchable(FriendsPanelBaseView),Touchable(StripView),Touchable(StripModelItemView),Touchable(MessageCenterBaseWindow),Touchable(MessageCenterWindow),Touchable(AddLivesWindow),Touchable(EpisodeLockedWindow),Touchable(SelectFriendWindow),Touchable(EpisodeFinishedWindow),Touchable(ThousandthLevelWindow),Touchable(MyTreasuresWindow),Touchable(GoodsPromoWindow),Touchable(ChampionWindow),Touchable(OvertakenWindow),Touchable(ShopWindow),Touchable(BundleShopWindow),Touchable(ShopRecommendedWindow),Touchable(GachaWindow),Touchable(EverydayBonusWindow),Touchable(OfferWindow),Touchable(CompleteOfferWindow),Touchable(LikeWindow),Touchable(BaseCoinsWindow),Touchable(SelectPrizeCoinsActionWindow),Touchable(X2ActionCoinsWindow),Touchable(BoringWindow),Touchable(ConnectionLostWindow),Touchable(GetCoinsForInviteWindow),Touchable(PublicationForBonusWindow),Touchable(StripWindow),Touchable(SuperOfferWindow),Touchable(NewBaseForceView),Touchable(PopUpColorFinishWindow),Touchable(HunterFinishWindow),Touchable(PowerUpButtonView),Touchable(PunishWindow),Touchable(PunishNowWindow),Touchable(SendGiftWindow),Touchable(TournamentView),Touchable(TournamentPrizeWindow),Touchable(SimpleCrossPromoWindow),Touchable(CoinsPromoWindow),Touchable(AchievmentsWindow),Touchable(AchievementDoneWindow),Touchable(BonusWorldAddLivesWindow),Touchable(BonusWorldNotAvailableWindow),Touchable(BonusWorldTimeoutWindow),Touchable(BonusWorldLevelPrizeWindow),Touchable(ChestsAndKeysView),Touchable(BanWindow),Touchable(TimeRewardWindow),Touchable(SpecialLevelWindow),Touchable(GiftWindow),Touchable(PiratesBirthdayGiftWindow),Touchable(FriendsStillNotPlay),Touchable(QuickPurchase),Touchable(NewTournamentView),Touchable(TournamentWindow),Touchable(CoinsForAdsBtnView),Touchable(ActivateTournamentWindow),Touchable(ActivateTournamentPrizeWindow),Touchable(ActivateTournamentHelpWindow),Touchable(SpecialWorldTaskWindow),Touchable(SpecialWorldTalkWindow),Touchable(SpecialWorldShopWindow),Touchable(SpecialWorldFinalForceWindow),Touchable(SpecialWorldForceView),Touchable(SpecialWorldItemWindow),Touchable(SpecialWorldInfoWindow),Touchable(SpecialWorldCollectionPrizeWindow),Touchable(SpecialWorldHelpWindow),Touchable(BonusWorldSelectWindow),Touchable(BonusworldListButtonView),Touchable(BonusworldListWindow),Touchable(AlbumView),Touchable(FirstBonusworld2ArtifactButtonView),Touchable(FirstBonusworld2ArtefactWindow),Touchable(PiggybankView),Touchable(PiggybankWindow),Touchable(PiggybankInfoWindow),Touchable(PiggybankAnimationWindow),Touchable(SpecialWorldBoxWindow),Touchable(SpecialWorldBoxItemWindow),Touchable(Artifacts.ArtifactWorkshopView),Touchable(Artifacts.ArtifactWorkshopButtonView),Touchable(Artifacts.SlotView),Touchable(Artifacts.ArtifactCollectionItemView),Touchable(Artifacts.ArtifactWindow),Touchable(Artifacts.ArtifactAssemblePrizeWindow),Touchable(Artifacts.ArtifactCollectionWindow),Touchable(Artifacts.PartWindow),Touchable(GameFridayWindow),Touchable(GDPRWindow),Touchable(EpisodeCollection.EpisodeCollectionButton),Touchable(EpisodeCollection.EpisodeCollectionWindow),Touchable(EpisodeCollection.EpisodeCollectionShopWindow),Touchable(PrizeCoinsActionWindow),Touchable(PrizeCoinsActionInfoWindow),Touchable(GiantPrizeWindow),Touchable(Shop.Window),Touchable(BuyBattlePassWindow),Touchable(CatchUpBattlePassWindow),Touchable(RewardChainView),Touchable(RewardChainContentView),Touchable(PublicationBlock),Touchable(AnimatedPrizesWindow),Touchable(PromoWindow),Touchable(StoryTalkWindow),Touchable(RegattaView),Touchable(RewardChainViewLite),Touchable(BigMapControllerView),Touchable(RegattaPrizeView),Touchable(RegattaPrizeContentView),Touchable(QuestSelectTaskOptionsWindow),Touchable(QuestView),Touchable(SelectBonusWorldButtonView),Touchable(BonusWorldHelpWindow),Touchable(ShopPowerUpsWindow),Touchable(SeasonSearchTreasuresView),Touchable(SeasonSearchTreasuresRunWindow),Touchable(SeasonSearchTreasuresTimeIsOverWindow),Touchable(SeasonSearchTreasuresLoseWindow),Touchable(BonusWorldView),Touchable(TicketInfoButton),Touchable(RewardComponentView),Touchable(AnnouncementActionWindow),Touchable(GachaComponentWindow),Touchable(GachaComponentView),Touchable(ChainSaleWithFreeGiftWindow),Touchable(BonusWorldHandyWindow),Touchable(SelectSatelliteButtonView),Touchable(StarChestClosedWindow),Touchable(StarChestOpenWindow),Touchable(PrizeControllerView),Touchable(MiniTaskWindow),Touchable(MiniTaskButtonView),Touchable(PrizeInfoWindow),Touchable(TriesInfoButton),Touchable(Eggs2021WorldView),Touchable(SpaceWorldBlockedLevelWindow),Touchable(TicketInfo),Touchable(TasksWindowButton),Touchable(BonusWorldTasksWindow),Touchable(OffersDeskComponentView),Touchable(TicketEventView),Touchable(StartLevelWindow),Touchable(PowerupMakerWindow),Touchable(LoseProgressWarningWindow),Touchable(TakePrizeWindow),Touchable(TriesReminderWindow),Touchable(TriesInfo),Touchable(PrizeControllerViewLite),Touchable(StartLevelForceWindow),Touchable(WinLevelForceWindow),Touchable(IngredientView),Touchable(RecipeView),Touchable(ForgeWindow),Touchable(ForgeButtonView),Touchable(WorldInfoButton),Touchable(WorldInfo),Touchable(Halloween2021WorldView),Touchable(Thanksgivingday2021WorldView),Touchable(EndlessTreasureWindow),Touchable(PartShopWindow),Touchable(PartShopButton),Touchable(GiftTrinketsSlotView),Touchable(BaseSlotMachineView),Touchable(PrizeControllerInfoWindow),Touchable(DeliciousAdventureView),Touchable(ComicWindow),Touchable(ComicButtonView),Touchable(WinterFishingView),Touchable(DayOfLove2022WorldView),Touchable(DayOfLove2022WorldPrizeControllerView),Touchable(SalesDayActionWindow),Touchable(PrizeLinkSorryWindow),Touchable(EasterFishingView),Touchable(ReturnRewardWindow),Touchable(FreeEpisodeHelpInfo),Touchable(FishingJune2022View),Touchable(ChristmasTreeWorld),Touchable(ChristmasTreeWorldView),Touchable(ChineseNewYear2024),Touchable(ChineseNewYear2024View),Touchable(WinterTown),Touchable(WinterTownView),Touchable(LivesCogentWindow),Touchable(OpenSeaWorld),Touchable(ReturnWorldWindow),Touchable(TimeActionWindow),Touchable(ActionWorldWindow),Touchable(ActionWorldButtonView),Touchable(OpenSeaWorldView),Touchable(PiratesDayWorldRewardChainView),Touchable(RegattaTakePrizeWindow),Touchable(RunBonusWorldWindow),Touchable(PartShopChancesWindow),Touchable(DuoBundleActionWindow),Touchable(DeliciousAdventureView),Touchable(DeliciousAdventureRecipeGroupsView),Touchable(DeliciousAdventureIngredientView),Touchable(DeliciousAdventureArtefactView),Touchable(ContinuityProgressButton),Touchable(ContinuityProgressWindow),Touchable(RecipeGroupWindow),Touchable(SpringWorldView),Touchable(ProlongateWorldButtonView),Touchable(AroundTheWorldView),Touchable(RoyalTreasuryView),Touchable(ChestsAndKeysView),Touchable(ChestsAndKeysCompleteWindow),Touchable(BaseEndlessTreasureWindow),Touchable(SecretView),Touchable(InvestigationOpenTaskWindow),Touchable(InvestigationNotEnoughValueWindow),Touchable(RewardInfoButton),Touchable(RewardTicketInfo),Touchable(BonusWorldInfoButton),Touchable(BonusWorldTicketInfo),Touchable(InvestigationInfoWindow),Touchable(HappyNewYear2021WorldView),Touchable(StartLevelView),Touchable(EasterRegatta),Touchable(EasterRegattaView),Touchable(EasterBanquet),Touchable(EasterBanquetView),Touchable(SaleTripleBenefitWindow));var Lives7Window=TWindow.extend({templateClass:".lives7Window_template"}),FriendPermissionWindow=TWindow.extend({templateClass:".friendPermissionWindow_template",events:{"click .close":"close","click .access":"access"},access:function(){var e=this;socialNetwork.takeAccessToFriends().then(function(){e.close()})}}),ServerNotification=Backbone.Model.extend({defaults:{network:null,host:null,salt:"asfasf234qw324"},init:function(){},calcSig:function(e){var t,i="",o=_createForOfIteratorHelper(_.keys(e).sort());try{for(o.s();!(t=o.n()).done;){var a=t.value;i+=a+"="+e[a]}}catch(e){o.e(e)}finally{o.f()}return i+=this.get("salt"),hexMD5(i)},extractQueryParams:function(e){for(var t=e.split("&"),i={},o=0;o<t.length;o++){var a=t[o].split("=");if(2===a.length){var n=a[0],r=a[1];r=decodeURIComponent(r.replace(/\+/g," ")),i[n]=r}}return i},queryParams:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},_send:function(e,t){t.nsig=this.calcSig(t),$.ajax({url:this.get("host")+"/"+e+"?"+this.queryParams(t),dataType:"json",type:"GET"})},add:function(e,t,i,o,a){this._send("TimeNotification/add",{network:this.get("network"),userId:user.get("userId"),type:e,delay:a,message:o})},cancel:function(e){this._send("TimeNotification/cancel",{network:this.get("network"),userId:user.get("userId"),type:e})}}),OdnoklassnikiNotification=ServerNotification.extend({_send:function(e,t){var i=_.keys(t);return(t=_.extend(this.extractQueryParams(location.search.substr(1)),t)).keys=i.join(","),ServerNotification.prototype._send.call(this,e,t)}}),VKNotification=ServerNotification.extend({_send:function(e,t){return t=_.extend(this.extractQueryParams(location.search.substr(1)),t),ServerNotification.prototype._send.call(this,e,t)}}),ReturnRewardComponent=BaseApplicationComponent.extend({defaults:{id:"returnReward",notificationTimeHours:0,notificationTimeMinutes:0},init:function(e){var t=this;if(this.get("notificationTime")){var i=this.get("notificationTime").split(":");this.set("notificationTimeHours",Number(i[0])),this.set("notificationTimeMinutes",Number(i[1]))}return e.once("run",function(){var e=t.findReward(t.getDaysCount(new Date(user.get("lastLogin")+" 00:00:00")));e&&t.showReturnRewardWindow(e),t.updateNotifications()}),Promise.resolve()},getDaysCount:function(e){var t=Date.now()-e-60*(60*this.get("notificationTimeHours")+this.get("notificationTimeMinutes"))*1e3;return Math.floor(t/864e5)},findReward:function(t){return 86400<Math.abs(application.getCurrentServerTime()-Date.now()/1e3)?null:_.sortBy(_.filter(this.get("rewards"),function(e){return e.products&&e.daysCount<=t}),function(e){return-1*e.daysCount})[0]},showReturnRewardWindow:function(e){this.get("beforeShowWindow")&&this.get("beforeShowWindow").call(this);var t=this.createPrize(e);new ReturnRewardWindow({prizes:t.get("products"),onClose:function(){t.take()}})},updateNotifications:function(){var i=this,o=application.getComponent("timeNotification");o&&this.get("rewards").forEach(function(e,t){o.add(TypeNotification["RETURN_REWARD_"+t],messages.returnRewardNotifications[e.name].ticker,messages.returnRewardNotifications[e.name].title,RANDOM(messages.returnRewardNotifications[e.name].text),i.getNotificationDelay(e.daysCount))})},getNotificationDelay:function(e){var t=new Date;return t.setDate(t.getDate()+e),t.setHours(this.get("notificationTimeHours")),t.setMinutes(this.get("notificationTimeMinutes")),(t-Date.now())/1e3},createPrize:function(e){return new Prize(e)}}),TypeNotification={RETURN_REWARD_0:105,RETURN_REWARD_1:106,RETURN_REWARD_2:107,RETURN_REWARD_3:108,RETURN_REWARD_4:109,RETURN_REWARD_5:110},TimeNotificationComponent=BaseApplicationComponent.extend({defaults:{id:"timeNotification"},init:function(){return Config.notificator&&(this.notificator=_.result(Config,"notificator")),Promise.resolve()},add:function(e,t,i,o,a){console.log("[notification] add ",e,t,i,o,a),this.notificator&&this.notificator.add(e,t,i,o,a)},cancel:function(e){console.log("[notification] cancel",e),this.notificator&&this.notificator.cancel(e)}}),PirateGameProgressBarView=Backbone.View.extend({initialize:function(e){this.render()},render:function(){var e=this,t=this.model.get("requiredStars"),i=this.model.get("actualStars");if(!(t<=i)){var o=$(".mainTemplates .progressBlock").clone();this.$el.append(o),o.addClass("pirateGame");var a=o.find(".progressBarLine"),n=a.width();a.width(n*i/t),this.$(".progressLabel").html(i+"/"+t),o.click(function(){new PrizeClosedWindow({prize:e.model,urgent:!0})})}}}),BaseProgressBar=Backbone.View.extend({initialize:function(){this._queue=new ActionQueue,this.render(),this._setUpdateProgress(),this.model.onEnter(),this.listenTo(this.model,"change",this._animateUpdateProgress),this.listenTo(this.model,"set",this._setUpdateProgress)},render:function(){},onUpdateProgress:function(e,t,i){},onUpdatedBar:function(e){},onAnimateUpdateProgress:function(e,t,i){return Promise.resolve()},remove:function(){Backbone.View.prototype.remove.call(this),this.model.onExit()},_animateUpdateProgress:function(){var e=this,t=this.model.getTotal(),i=this.model.getCurrent(),o=Math.min(100,(i/t*100||0).toFixed(3));return this._queue.push({run:function(){return e.onAnimateUpdateProgress(i,t,o).then(function(){e.onUpdateProgress(i,t,o),e.onUpdatedBar(i,t,o)})}})},_setUpdateProgress:function(){var e=this,t=this.model.getTotal(),i=this.model.getCurrent(),o=Math.min(100,(i/t*100||0).toFixed(3));return this._queue.push({run:function(){e.onUpdateProgress(i,t,o),e.onUpdatedBar(i,t,o)}})}}),RadialProgressBar=BaseProgressBar.extend({initialize:function(e){BaseProgressBar.prototype.initialize.call(this),this.min=e.min,this.max=e.max},render:function(){this.model.get("battlePass")&&(this.$progressbar=this.$(".invisible .radialProgressbar").clone(),this.$progressbar.addClass(this.model.get("world").get("name")))},onUpdateProgress:function(e,t,i){var o=this.min+(this.max-this.min)*(i/100);this.$el.find(".radialProgressBarFill").css("transform","rotate(".concat(o,"deg)")),null===this.model.getCurrentStage()&&(this.$el.find(".radialProgressBarBg").css("background-image","none"),this.$el.find(".radialProgressBarFill").css("display","none"))}}),BaseProgressBarViewModel=Backbone.Model.extend({onChange:function(){return this.emit("change",this)},onSet:function(){return this.emit("set",this)},onExit:function(){},onEnter:function(){},getCurrent:function(){throw new Error("Not implemented")},getTotal:function(){return 100}}),PrizeProgressBarViewModel=BaseProgressBarViewModel.extend({initialize:function(e){BaseProgressBarViewModel.prototype.initialize.call(this,e),this._controller=e},onEnter:function(){this._controller.on("change:points",this.onChange,this),this._controller.on("change:progress",this.onChange,this)},onExit:function(){this._controller.off("change:points",this.onChange,this),this._controller.off("change:progress",this.onChange,this)},getTotal:function(){return this._controller.getNextProgressPoints()-this._controller.getCurrProgressPoints()},getCurrent:function(){return this._controller.getPoints()-this._controller.getCurrProgressPoints()},getCurrentStage:function(){return this._controller.getNextProgress()<=this._controller.getMaxProgress()?this._controller.getNextProgress():null}}),aNf,cNf;featuresAdder.registry("chocolate_icecube",function(e){FigureRules.add(".episode_".concat(e," .decorator_chocolate.stable"),{"background-position-x":1035,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_icecube/iceCubeAppear.7955dd983e.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":-89/180*Config.cellWidth,"margin-top":-73/180*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .decorator_chocolate.chocolate_appearance"),{"background-position-x":0,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_icecube/iceCubeAppear.7955dd983e.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":-89/180*Config.cellWidth,"margin-top":-73/180*Config.cellHeight,spriteFrames:3,duration:300}),FigureRules.add(".episode_".concat(e," .chocolate_annihilation"),{"background-position-x":0,"background-position-y":0,"background-width":345,"background-height":331,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/chocolate_icecube/iceCubeAnnihilation.1f75fa69de.png",width:345/180*Config.cellWidth,height:331/180*Config.cellHeight,"margin-left":0,"margin-top":0,spriteFrames:5,duration:400})}),featuresAdder.registry("tortoise_winter",function(e){FigureRules.add(".episode_".concat(e," .turtleCell"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_winter/tortoise1.1eae6720ea.png","background-width":180,"background-height":180,width:1.3*Config.cellWidth,height:1.3*Config.cellHeight,"margin-left":-8,"margin-top":-4}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel3"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_winter/tortoise1.1eae6720ea.png"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel2"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_winter/tortoise2.08c0e8b83a.png"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel1"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_winter/tortoise3.c20a0b3cf9.png"}),FigureRules.add(".episode_".concat(e," .turtle"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise_winter/tortoise3.c20a0b3cf9.png","background-width":180,"background-height":180,width:1.3*Config.cellWidth,height:1.3*Config.cellHeight,"margin-left":-8,"margin-top":-4,spriteFrames:4,duration:300,playRound:!0}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel3 .zzz1.stable, .episode_").concat(e," .turtleCell.turtleLevel2 .zzz1.stable"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/zzz.f16ebe163a.png","background-width":20,"background-height":24,width:20/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:16,duration:1400,framesOrder:[0,1,2,3,4,5,6,7,8,9,10,10,10,10,10,10],playRound:!0}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel3 .zzz2.stable, .episode_").concat(e," .turtleCell.turtleLevel2 .zzz2.stable"),{"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/tortoise/zzz.f16ebe163a.png","background-width":20,"background-height":24,width:20/60*Config.cellWidth,height:.4*Config.cellHeight,"margin-left":10/60*Config.cellWidth,"margin-top":-14/60*Config.cellHeight,spriteFrames:16,duration:1400,framesOrder:[10,10,10,10,10,10,0,1,2,3,4,5,6,7,8,9],playRound:!0}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel2.turtleLifeTransition .zzz1, .episode_").concat(e," .turtleCell.turtleLevel2.turtleLifeTransition .zzz2"),{opacity:"0"}),FigureRules.add(".episode_".concat(e," .turtleCell.turtleLevel1 .blink.stable"),{width:25/60*Config.cellWidth,height:13/60*Config.cellHeight,"margin-left":7/60*Config.cellWidth,"margin-top":17/60*Config.cellHeight,scale:.78})}),featuresAdder.registry("eaterstars_winter",function(e){FigureRules.add(".episode_".concat(e," .eaterStarsCell"),{width:130/60*Config.cellWidth,height:2*Config.cellHeight,"margin-left":-5/60*Config.cellWidth,"background-width":130,"background-height":120}),FigureRules.add(".episode_".concat(e," .eaterStarsCell.stable"),{"background-position-x":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars_winter/eaterStarStable.5c1e863875.png",spriteFrames:8,duration:600,playRound:!0,delay:[2e3,4e3]}),FigureRules.add(".episode_".concat(e," .eaterStarsCell.beforeCollect"),{"background-position-x":0,spriteFrames:8,duration:600,playRound:!1,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars_winter/eaterStarEat.77a2440e2a.png"}),FigureRules.add(".episode_".concat(e," .eaterStarsCell.afterCollect"),{"background-position-x":0,playRound:!1,duration:100,spriteFrames:3,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/eaterstars_winter/eaterStarEaten.496d7698f7.png"}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .target"),{x:65/60*Config.cellWidth,y:70/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock"),{width:65/60*Config.cellWidth,height:26/60*Config.cellHeight,"background-width":150,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/mermaidLifes.3d5e08df37.png","margin-left":58/60*Config.cellWidth,"margin-top":95/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .taskIco"),{width:17/60*Config.cellWidth,height:17/60*Config.cellHeight,"background-width":80,"background-height":80,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/base/multicolor.3c5bbe1e0b.png","margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .lifeText"),{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-left":35/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .lifeText .currentLife, .eaterStarsCell .lifeBlock .lifeText .divider, ")+".eaterStarsCell .lifeBlock .lifeText .maxLife",{width:40/60*Config.cellWidth,height:16/60*Config.cellHeight,"margin-top":13/60*Config.cellWidth,font:"bold "+11/60*Config.cellWidth+"px/"+13/60*Config.cellWidth+"px Marvin",color:"#fcebc4",strokeStyle:"#601100",lineWidth:1}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .lifeText .currentLife"),{textAlign:"right"}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .lifeText .divider"),{"margin-left":1/60*Config.cellWidth}),FigureRules.add(".episode_".concat(e," .eaterStarsCell .lifeBlock .lifeText .maxLife"),{"margin-left":.15*Config.cellWidth})}),featuresAdder.registry("fishball_winter",function(e){FigureRules.add(".episode_".concat(e," .fishBallCell"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":222,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_winter/fishBall.ae934e9469.png","margin-left":0,"margin-top":-26/180*Config.cellHeight,width:1*Config.cellWidth,height:222/180*Config.cellHeight,spriteFrames:4,framesOrder:[0,1,2,1],delay:[1e3,2e3],duration:600,playRound:!0}),FigureRules.add(".episode_".concat(e," .fishBallCell.powerUpHighlight"),{animation:{params:{"margin-top":[-26/180*Config.cellHeight,-42/180*Config.cellHeight]},duration:200}}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallAngry"),{startFrame:3,spriteFrames:4,duration:600,playRound:!0}),FigureRules.add(".episode_".concat(e," .fishBallCell.create"),{"background-width":180,"background-height":222,"background-position-x":0,"background-position-y":0,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/fishBall/fishBallJump.0abc3f08a8.png","margin-left":0,"margin-top":-26/180*Config.cellHeight,width:1*Config.cellWidth,height:222/180*Config.cellHeight,spriteFrames:8,duration:800,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie"),{startFrame:7,spriteFrames:2,duration:200,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallFly"),{startFrame:9,spriteFrames:10,duration:800,playRound:!1}),FigureRules.add(".episode_".concat(e," .fishBallCell .lifeBlock"),{"background-position-x":0,"background-position-y":0,"background-width":170,"background-height":51,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBlockSoc.f27a59efc8.png",width:170/180*Config.cellWidth,height:51/180*Config.cellHeight,"margin-left":2/60*Config.cellWidth,"margin-top":55/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell.fishBallDie .lifeBlock, .fishBallCell.fishBallFly .lifeBlock, .fishBallCell.create .lifeBlock"),{opacity:0}),FigureRules.add(".episode_".concat(e," .fishBallCell .shallow"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeYellow.45b3115da4.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell .middle"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeGreen.c90bcd3e5f.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .fishBallCell .deep"),{"background-position-x":0,"background-position-y":0,"background-width":143,"background-height":24,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/life/dragonLifeBGreen.10127306b5.png",width:143/180*Config.cellWidth,height:24/180*Config.cellHeight,"margin-left":4/60*Config.cellWidth,"margin-top":4/60*Config.cellHeight})}),figureRulesProcess.additionalBonusScaleImages=(aNf=figureRulesProcess.additionalBonusScaleImages,function(){aNf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_winter/fishBall.ae934e9469.png":_Figure.scaleKoef,"//gems-ok.akamaized.net/gems/gems/site/img/features/fishball_winter/fishBallJump.21e0e70b86.png":_Figure.scaleKoef})}),featuresAdder.registry("pasture_deer",function(e){FigureRules.add(".episode_".concat(e," .attribute_animal"),{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":260,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deer_xlarge.4d8f0dc509.png",width:206/180*Config.cellWidth,height:260/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-.25*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .pastureCell.life2 .attribute_animal"),{"background-position-x":0,"background-position-y":0,"background-width":206,"background-height":260,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deerDark_xlarge.ec27bf4a8e.png",width:206/180*Config.cellWidth,height:260/180*Config.cellHeight,"margin-left":-20/180*Config.cellWidth,"margin-top":-.25*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .attribute_animal.animateCollect"),{"background-position-x":0,"background-position-y":0,"background-width":180,"background-height":180,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deerFlying.25ddc814f3.png",width:1*Config.cellWidth,height:1*Config.cellHeight,spriteFrames:1,duration:1e3})}),figureRulesProcess.additionalBonusScaleImages=(cNf=figureRulesProcess.additionalBonusScaleImages,function(){cNf.call(this),_Figure.scaleImages=_.extend(_Figure.scaleImages,{"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deer_xlarge.4d8f0dc509.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deerDark_xlarge.ec27bf4a8e.png":Config.cellWidth/120,"//gems-ok.akamaized.net/gems/gems/site/img/features/pasture_deer/deerFlying.25ddc814f3.png":_Figure.scaleKoef})}),featuresAdder.registry("iceberg_candy",function(e){FigureRules.add(".episode_".concat(e," .icebergCellBg"),{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_candy/iceberg.ccf2528eb3.png"}),FigureRules.add(".episode_".concat(e," .icebergExplode"),{"background-width":120,"background-height":120,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/iceberg_candy/icebergDie.14468dd636.png"}),FigureRules.add(".episode_".concat(e," .icebergCellWater"),{width:1.85*Config.cellWidth,height:110/180*Config.cellHeight,"margin-left":.06*Config.cellWidth})}),featuresAdder.registry("gemstealer_winter",function(e){FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_R"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_R.ba9189d083.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_G"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_G.fd359c653e.png",width:1*Config.cellWidth,height:1*Config.cellHeight}),FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_B"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_B.7dc2b616c6.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-top":0}),FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_Y"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_Y.26a826178c.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-top":0}),FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_P"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_P.a175c25179.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-top":0}),FigureRules.add(".episode_".concat(e," .gemStealer.gemStealer_W"),{"background-position-x":0,"background-position-y":0,"background-width":60,"background-height":60,"background-image":"//gems-ok.akamaized.net/gems/gems/site/img/features/gemstealer_winter/gemstealer_W.309591453a.png",width:1*Config.cellWidth,height:1*Config.cellHeight,"margin-top":0})})}("undefined"==typeof exports?exports={}:exports);